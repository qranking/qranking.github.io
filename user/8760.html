<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (xtetsuji)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (xtetsuji さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>879</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/555a1ef19ed21ee42873">GitHubでFork/cloneしたリポジトリを本家リポジトリに追従する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-11 23:42:52</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[GitHub]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>(興味深い手法があれば随時追加していきます at 2013/04/11)</p>

<p>ネットを検索すると、色々な手法が出てきますが、自分としては<a href="http://www.amazon.co.jp/dp/4774156167?tag=tetsujijp-22" rel="nofollow noopener" target="_blank">「WEB+DB PRESS plus 開発ツール徹底攻略」</a>p.71 に載っていた以下の手法がシンプルで良く理解できました。</p>

<p>本家リポジトリの例として、実際にGitHubに存在する練習用リポジトリ <code>git@github.com:DQNEO/Renshu.git</code> を使います</p>

<p>あなた (<em>youraccount</em>) が既にForkしているRenshuリポジトリをcloneします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone git@github.com:youraccount/Renshu.git
Cloning into 'Renshu'...
remote: Counting objects: 109, done.
remote: Compressing objects: 100% (70/70), done.
remote: Total 109 (delta 15), reused 109 (delta 15)
Receiving objects: 100% (109/109), 12.34 KiB, done.
Resolving deltas: 100% (15/15), done.    
$ cd Renshu
</pre></div></div>

<p>ブランチは以下のような状態になっているはずです (他にもあるかもしれません)。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git branch -a 
* master
  remotes/origin/HEAD -&gt; origin/master
  remotes/origin/master
</pre></div></div>

<p>リモートリポジトリとして、オリジナルのリポジトリを <strong>upstream</strong> という名前で設定します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git remote add upstream git://github.com/DQNEO/Renshu.git
</pre></div></div>

<p>以後、このリポジトリは <strong>upstream</strong> という名前で本家リポジトリを参照します。一度設定すれば再設定の必要は無いようです。</p>

<p>ブランチを確認すると、以下のように remotes/upstream/master が加わったことが分かります。環境によっては後述の <code>git fetch upstream</code> の操作を行った後で出てくる場合もありますので、出てこない場合には <code>git fetch upstream</code> を試した後に再度 <code>git branch -a</code> で確認してみてください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git branch -a
* master
  remotes/origin/HEAD -&gt; origin/master
  remotes/origin/master
  remotes/upstream/master
</pre></div></div>

<p>本家リポジトリの変更を取り出すためには <strong>fetch</strong> と <strong>merge</strong> の手順を取ります。</p>

<p>まずfetch</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git fetch upstream
remote: Counting objects: 1, done.
remote: Total 1 (delta 0), reused 1 (delta 0)
Unpacking objects: 100% (1/1), done.
From git://github.com/DQNEO/Renshu
 * [new branch]      develop    -&gt; upstream/develop
 * [new branch]      master     -&gt; upstream/master
</pre></div></div>

<p>そしてmerge</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git merge upstream/master
Updating fe579f8..a1e70ae
Fast-forward
</pre></div></div>

<p>変更が無い場合には "Already up-to-date." と表示されて終わりです。今回は差分があったので、コミットIDがfe579f8からa1e70aeまでの差分がmergeされました。</p>

<p>詳細は<a href="http://www.amazon.co.jp/dp/4774156167?tag=tetsujijp-22" rel="nofollow noopener" target="_blank">当該書籍</a>を参照ください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>98</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/31bc53e92d94b1602b5d">いかに素早く目的のディレクトリにcdするか、そのためのTips</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-09 23:30:05</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Bash]</b> <b>[Mac]</b> <b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>我々がシェルを操作している時間のうち、たぶん8割くらいは<code>cd</code>と<code>ls</code>を打っているんじゃないかとすら、私は思っています。</p>

<p>世の中には様々なシェルハックが溢れている昨今ですが、<code>ls</code>は置いといて、<code>cd</code>のコストを減らせれば、そこそこの効率化が図れるのではないでしょうか。そんなことを考えて色々な改善を考えてみたことをまとめた記事です。</p>

<p>私はBashユーザなのでBashの話ですが、Zshでも多少の改変で応用が効くのではないかと思います。</p>

<p>ここでの試行錯誤は2014年3月現在のものです。興味深い改造があれば都度書き足していきます。</p>

<h2>
<span id="cdのオプション" class="fragment"></span><a href="#cd%E3%81%AE%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>cdのオプション</h2>

<p>まず <code>man bash</code> から <code>cd</code> の説明を観てみましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>   cd [-L|-P] [dir]
          Change the current directory to dir.  The variable HOME  is  the
          default  dir.   The  variable CDPATH defines the search path for
          the directory containing dir.  Alternative  directory  names  in
          CDPATH  are  separated by a colon (:).  A null directory name in
          CDPATH is the same as the current directory,  i.e.,  ``.''.   If
          dir  begins  with  a  slash (/), then CDPATH is not used. The -P
          option says to use the physical directory structure  instead  of
          following  symbolic  links  (see  also  the -P option to the set
          builtin command); the -L option forces symbolic links to be fol-
          lowed.   An  argument  of - is equivalent to $OLDPWD.  If a non-
          empty directory name from CDPATH is used, or if - is  the  first
          argument,  and  the directory change is successful, the absolute
          pathname of the new working directory is written to the standard
          output.   The return value is true if the directory was success-
          fully changed; false otherwise.
</pre></div></div>

<p><code>cd</code>コマンド、世界中のユーザに日々相当使われているけど、オプションは相当貧弱だなと思います。<code>-L</code> も <code>-P</code> も使いどころがそれほどない。これらのオプション、日々使っている人いるんでしょうか。</p>

<p>せめてウェブブラウザでいうような「進む」「戻る」「ブックマーク」「検索」といったインターフェースがあればいいのにと思って、色々作ってみました。</p>

<p>ちなみに、<code>cd -</code> とすれば直前にいたディレクトリに戻ることができますが、履歴をたどって戻り続けるといったようなことはできません。<code>cd -</code>を連続で打っても、2つのディレクトリ間を行き来するだけです。</p>

<p>そこで私なりの<code>cd</code>ハックを以下でご紹介してみようと思います。面白そうな機能があれば取り入れていただければ幸いです。</p>

<h2>
<span id="pushdとpopdそしてdirs" class="fragment"></span><a href="#pushd%E3%81%A8popd%E3%81%9D%E3%81%97%E3%81%A6dirs"><i class="fa fa-link"></i></a>pushdとpopd、そしてdirs</h2>

<p>まずは<code>pushd</code>と<code>popd</code>について解説しておかなければなりません。</p>

<p>Bashには<code>pushd</code>と<code>popd</code>という組み込みコマンドがあるのですが、あまり使われている場面に出くわしたことがありません。<code>pushd</code>は、カレントディレクトリをスタックに保存して与えれたディレクトリに移動する、もう一つの<code>cd</code>コマンドといったものです。<code>pushd 移動したいディレクトリ</code> といった感じで、<code>cd</code> コマンドと同様に使えます。</p>

<p>スタックに積まれたディレクトリで一番新しいディレクトリに移動したい場合には<code>popd</code>コマンドを使います。これは引数無し。スタックに積まれた一番新しいディレクトリに移動して、スタックからその情報を削除します。いわゆるLIFOですね。</p>

<p>スタック一覧を見たい場合には<code>dirs</code>コマンドを使います。スタックを削除したり表示方法を替えたりといったオプションもありますが、詳しくは <code>man bash</code> の中から <code>dirs</code> の項目を参照下さい。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>dirs [-clpv] [+n] [-n]
</pre></div></div>

<h2>
<span id="cdをpushdで再定義する" class="fragment"></span><a href="#cd%E3%82%92pushd%E3%81%A7%E5%86%8D%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>cdをpushdで再定義する</h2>

<p><code>pushd</code> が <code>cd</code> の代わりとして使えるとはいえ、<code>cd</code> の方が打つのに慣れているし、<code>pushd</code> って5文字もあるしで、恒常的に <code>pushd</code> を使うのは面倒です。であれば <code>cd</code> の定義を <code>pushd</code> を使ったもので置き換えてしまおうと考えました。</p>

<p>普段から <code>cd</code> と <code>pushd</code> を使い分けている人は、この設定はスタックの履歴が混ざってしまうので問題となりますが、「普段のシェル作業で <code>pushd</code> なんて使わないよ」という人は、この設定にしてしまって問題無いと思います。私は数年間この設定で作業していますが、特段パフォーマンス的だったりといった問題が出たことはありません。</p>

<div class="code-frame" data-lang="Bash"><div class="highlight"><pre><span></span><span class="c1"># 履歴を記録する cd の再定義</span>
<span class="k">function</span> <span class="nb">cd</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="c1"># cd 連打で余計な $DIRSTACK を増やさない</span>
        <span class="nb">test</span> <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">"</span> !<span class="o">=</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">pushd</span> <span class="nv">$HOME</span> &gt; /dev/null
    <span class="k">elif</span> <span class="o">(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="p">|</span> egrep <span class="s2">"^\.\.\.+</span>$<span class="s2">"</span> &gt; /dev/null <span class="o">)</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">cd</span> <span class="k">$(</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="p">|</span> perl -ne <span class="s1">'print "../" x ( tr/\./\./ - 1 )'</span> <span class="k">)</span>
    <span class="k">else</span>
        <span class="nb">pushd</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> &gt; /dev/null
    <span class="k">fi</span>
<span class="o">}</span>

</pre></div></div>

<p>これらの関数は <code>~/.bashrc</code> に書くか、<code>~/.bashrc</code> から <code>source</code> (<code>.</code>) コマンドで読まれるファイルに書く必要があります。</p>

<p>定義の説明ですが、まず <code>cd</code> コマンドを引数無しで打ったときにホームディレクトリに戻ることができる機能があって、ここでも<code>pushd</code>でこれを再現していますが、これをホームディレクトリで打ったときに <code>pushd</code> が余計なスタックを増やさないような配慮をしています。</p>

<p>またオマケ機能として、<code>cd ..</code> で1つ上のディレクトリに戻れる機能の拡張として、<code>cd ...</code> と打つと2つ上のディレクトリに戻れ、$n$ 個のドットで $n-1$ つ上のディレクトリに戻れる機能を書いてあります。シェル力が足りなかったので、<code>egrep</code> で検査した上で必要があればPerlを起動するように書いていますが、ここのパフォーマンスが特段気になる方は削ってもよいと思います。ここの <code>then</code> 節で表れる <code>cd</code> はこの関数の再起呼び出しとして解釈されます(無限ループには注意して書いたつもりです)。</p>

<p>そうでなければシンプルに <code>pushd</code> に引数を渡してカレントディレクトリを変更しています。<code>pushd</code> はいちいちスタックに入れたディレクトリについての報告を標準出力にしてくるので、<code>&gt;/dev/null</code> しておきます。</p>

<p>この定義は、一部の人が使い慣れた <code>cd -</code> を潰したりはしません。</p>

<p>事情があって組み込みの<code>cd</code>コマンドを使いたい場合は <code>builtin cd 移動したいディレクトリ</code> というコマンドを使います。</p>

<h2>
<span id="事前指定したディレクトリへ素早く移動する" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%9F%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%B8%E7%B4%A0%E6%97%A9%E3%81%8F%E7%A7%BB%E5%8B%95%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>事前指定したディレクトリへ素早く移動する</h2>

<p>ブラウザでいう「ブックマーク」のような機能が欲しいと思って、色々考えました。</p>

<p><code>cd</code> コマンドには <code>CDPATH</code> という環境変数があって、<code>PATH</code> のように、ここにコロン区切りでパス群を入れておくと、カレントディレクトリがどこであろうと、このパス群からディレクトリを探すという機能があるのですが、私には使い勝手が悪く感じました。込み入った設定や状況にしておくと、意図しないディレクトリに飛んでしまったりとか。</p>

<p><code>pushd</code> は <code>CDPATH</code> を見るのかとか調べる以前に、意図しないことが起こらないように、これは別コマンドにしてしまったほうがいいなと感じました。最初は <code>cdjump</code> という名前だったのですが、長いので <code>cdj</code> という名前にしました。</p>

<div class="code-frame" data-lang="Bash"><div class="highlight"><pre><span></span><span class="c1"># ショートカットキーで移動するcd</span>
<span class="k">function</span> cdj <span class="o">{</span>
    <span class="c1">### cdjはCDJ_DIR_MAPという環境変数の配列の定義が必要です</span>
    <span class="c1"># CDJ_DIR_MAP配列の例は以下です。ディレクトリのエイリアスと実ディレクトリのパスを空白区切りでペアで書いていきます</span>
<span class="c1">#     export CDJ_DIR_MAP=(</span>
<span class="c1">#         dbox ~/Dropbox</span>
<span class="c1">#         cvs  ~/cvs</span>
<span class="c1">#         etc  /etc</span>
<span class="c1">#         );</span>
    <span class="nb">test</span> -n <span class="s2">"</span><span class="nv">$DEBUG</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"DEBUG: dir arg=</span><span class="nv">$arg</span><span class="s2"> #CDJ_DIR_MAP=</span><span class="si">${#</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[*]</span><span class="si">}</span><span class="s2">"</span> 
    <span class="nb">declare</span> <span class="nv">arg</span><span class="o">=</span><span class="nv">$1</span> <span class="se">\</span>
            <span class="nv">subarg</span><span class="o">=</span><span class="nv">$2</span> <span class="se">\</span>
            dir i key value warn
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> -o <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-h"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> -a -z <span class="s2">"</span><span class="nv">$subarg</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="c1">### help and usage mode</span>
        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$FUNCNAME</span><span class="s2"> &lt;directory_alias&gt;"</span>
        <span class="nb">echo</span> <span class="s2">"       </span><span class="nv">$FUNCNAME</span><span class="s2"> [-h|-v|-l &lt;directory_alias&gt;]"</span>
        <span class="nb">echo</span> <span class="s2">"-h: help"</span>
        <span class="nb">echo</span> <span class="s2">"-l: list defined lists"</span>
        <span class="nb">echo</span> <span class="s2">"-v &lt;directory_alias&gt;: view path specify alias."</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> -o <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-l"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span> 
        <span class="c1">### view detail mode</span>
        <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="nv">$i</span>&lt;<span class="si">${#</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[*]</span><span class="si">}</span><span class="p">;</span> <span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+2<span class="k">))</span> <span class="o">))</span> <span class="p">;</span> <span class="k">do</span>
            <span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
            <span class="nv">value</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[</span><span class="k">$((</span>i+1<span class="k">))</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-l"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
                <span class="k">if</span> <span class="o">[</span> ! -d <span class="s2">"</span><span class="nv">$value</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
                    <span class="nv">warn</span><span class="o">=</span><span class="s2">" ***NOT_FOUND***"</span>
                <span class="k">else</span>
                    <span class="nv">warn</span><span class="o">=</span><span class="s2">""</span>
                <span class="k">fi</span>
                <span class="nb">printf</span> <span class="s2">"%8s =&gt; %s%s\n"</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$value</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$warn</span><span class="s2">"</span>
            <span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-v"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
                <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$subarg</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
                    <span class="nb">echo</span> <span class="nv">$value</span>
                    <span class="k">return</span>
                <span class="k">fi</span>
            <span class="k">fi</span>
        <span class="k">done</span>
        <span class="k">return</span>
    <span class="k">fi</span>
    <span class="c1">### change directory mode</span>
    <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="nv">$i</span>&lt;<span class="si">${#</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[*]</span><span class="si">}</span><span class="p">;</span> <span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+2<span class="k">))</span> <span class="o">))</span> <span class="p">;</span> <span class="k">do</span>
        <span class="nv">key</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
        <span class="nv">value</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[</span><span class="k">$((</span>i+1<span class="k">))</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
        <span class="nb">test</span> -n <span class="s2">"</span><span class="nv">$DEBUG</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2"> =&gt; </span><span class="nv">$value</span><span class="s2">"</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$key</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
            <span class="k">if</span> <span class="o">[</span> -n <span class="s2">"</span><span class="nv">$subarg</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
                <span class="nv">dir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$value</span><span class="s2">/</span><span class="nv">$subarg</span><span class="s2">"</span>
            <span class="k">else</span>
                <span class="nv">dir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$value</span><span class="s2">"</span>
            <span class="k">fi</span>
            <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$dir</span><span class="s2">"</span>
            <span class="k">return</span>
        <span class="k">fi</span>
    <span class="k">done</span>
    <span class="nb">echo</span> <span class="s2">"directory alias \"</span><span class="nv">$arg</span><span class="s2">\" is not found"</span>
    <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>
</pre></div></div>

<p>大昔に書いた自分も忘れてしまった部分もあるのですが、以下のような仕掛けです。</p>

<p>まず <code>CDJ_DIR_MAP</code> という配列を定義します。これがいわゆる <code>cdj</code> コマンドでの「ブックマーク」に相当します。上のコメントで書いたような例で書きます。いくらでも書けます。</p>

<p>最近のBashでは連想配列がサポートされたという話も聞いたり聞かなかったりするのですが、世間の新しくないBashに合わせて配列にキーバリューのペアで記録する形になっています。</p>

<p>前述の例であれば、<code>cdj dbox</code> と打てば <code>cd ~/Dropbox</code> と同じ意味になります。長く深いディレクトリであればあるほど、この恩恵は大きいです。</p>

<p>ヘルプを表示する <code>-h</code>、現在の設定を確認する <code>-l</code>、与えられたキーに対する実ディレクトリを表示する <code>-v</code> といったオプションも付けました。</p>

<p><code>cd</code> コマンドは標準でディレクトリのタブ補完が効きます。<code>cdj</code> コマンドもタブ補完ができるようにしましょう。<code>function cdj</code> で <code>cdj</code> コマンドを定義した後で以下のような記述を書きます。</p>

<div class="code-frame" data-lang="Bash"><div class="highlight"><pre><span></span><span class="nb">type</span> cdj &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span>
_cdj<span class="o">()</span>
<span class="o">{</span>
    <span class="nb">local</span> cur prev opts i
    <span class="nv">COMPREPLY</span><span class="o">=()</span>
    <span class="nv">cur</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">COMP_WORDS</span><span class="p">[COMP_CWORD]</span><span class="si">}</span><span class="s2">"</span>
    <span class="nv">prev</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">COMP_WORDS</span><span class="p">[COMP_CWORD-1]</span><span class="si">}</span><span class="s2">"</span>
    <span class="nv">opts</span><span class="o">=</span><span class="k">$(for</span> i in <span class="k">$(</span>seq <span class="m">0</span> <span class="m">2</span> <span class="k">$((</span><span class="si">${#</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[*]</span><span class="si">}</span><span class="o">-</span><span class="m">2</span><span class="k">))</span> <span class="k">)</span> <span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span> <span class="p">;</span> <span class="k">done</span> <span class="p">;</span> <span class="nb">echo</span> <span class="s2">"-h -v -l"</span><span class="k">)</span>
    <span class="c1">#echo ""</span>
    <span class="c1">#echo "&gt; cur=$cur prev=$prev COMP_CWORD=$COMP_CWORD"</span>
    <span class="c1">#echo "&gt; opts=$opts"</span>
    <span class="c1">#echo "&gt; COMPWORDS=${COMP_WORDS[*]}"</span>

    <span class="k">case</span> <span class="si">${</span><span class="nv">prev</span><span class="si">}</span> in
        -l<span class="o">)</span>
            <span class="nv">opts</span><span class="o">=</span><span class="k">$(for</span> i in <span class="k">$(</span>seq <span class="m">0</span> <span class="m">2</span> <span class="k">$((</span><span class="si">${#</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[*]</span><span class="si">}</span><span class="o">-</span><span class="m">2</span><span class="k">))</span> <span class="k">)</span> <span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">CDJ_DIR_MAP</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span> <span class="p">;</span> <span class="k">done)</span>
            <span class="nv">COMPREPLY</span><span class="o">=(</span> <span class="k">$(</span><span class="nb">compgen</span> -W <span class="s2">"</span><span class="nv">$opts</span><span class="s2">"</span> -- <span class="si">${</span><span class="nv">cur</span><span class="si">}</span> <span class="k">)</span><span class="o">)</span>
            <span class="k">return</span> <span class="m">0</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="p">;;</span>
    <span class="k">esac</span>

    <span class="nv">COMPREPLY</span><span class="o">=(</span> <span class="k">$(</span><span class="nb">compgen</span> -W <span class="s2">"</span><span class="nv">$opts</span><span class="s2">"</span> -- <span class="si">${</span><span class="nv">cur</span><span class="si">}</span> <span class="k">)</span><span class="o">)</span>
    <span class="k">return</span> <span class="m">0</span>
<span class="o">}</span> <span class="o">&amp;&amp;</span>
<span class="nb">complete</span> -F _cdj cdj
</pre></div></div>

<p>bash_completion の色々な書き方を真似て <code>CDJ_DIR_MAP</code> を見るようにしてみただけです。</p>

<p>私はbash_completionを導入していますが、もしかしたら事前にbash_completionを導入しておかないといけないかもしれません。それぞれのOS/ディストリビューション事に導入方法が違いますので、検索してみてください。</p>

<h2>
<span id="取得したディレクトリ移動履歴を利用する" class="fragment"></span><a href="#%E5%8F%96%E5%BE%97%E3%81%97%E3%81%9F%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E7%A7%BB%E5%8B%95%E5%B1%A5%E6%AD%B4%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>取得したディレクトリ移動履歴を利用する</h2>

<p>前述のように <code>cd</code> コマンドを再定義したことで、<code>pushd</code> のおかげでディレクトリ履歴が取られるようになりました。</p>

<p>であれば、その履歴を番号選択して移動ができる <code>cdhist</code>、<code>cd -</code> とは違い、打ち続けると履歴をたどっていける <code>popd</code> を利用した <code>cdback</code> コマンドを定義してみましょう。</p>

<div class="code-frame" data-lang="Bash"><div class="highlight"><pre><span></span><span class="c1"># 最近の cd によって移動したディレクトリを選択</span>
<span class="k">function</span> cdhist <span class="o">{</span>
    <span class="nb">local</span> dirnum
    <span class="c1">#dirs -v | head -n $(( LINES - 3 ))</span>
    <span class="nb">dirs</span> -v <span class="p">|</span> sort -k <span class="m">2</span> <span class="p">|</span> uniq -f <span class="m">1</span> <span class="p">|</span> sort -n -k <span class="m">1</span> <span class="p">|</span> head -n <span class="k">$((</span> LINES <span class="o">-</span> <span class="m">3</span> <span class="k">))</span>
    <span class="nb">read</span> -p <span class="s2">"select number: "</span> dirnum
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$dirnum</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FUNCNAME</span><span class="s2">: Abort."</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="k">elif</span> <span class="o">(</span> <span class="nb">echo</span> <span class="nv">$dirnum</span> <span class="p">|</span> egrep <span class="s1">'^[[:digit:]]+$'</span> &gt; /dev/null <span class="o">)</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">cd</span> <span class="s2">"</span><span class="k">$(</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">DIRSTACK</span><span class="p">[</span><span class="nv">$dirnum</span><span class="p">]</span><span class="si">}</span> <span class="p">|</span> sed -e <span class="s2">"s;^~;</span><span class="nv">$HOME</span><span class="s2">;"</span> <span class="k">)</span><span class="s2">"</span>
    <span class="k">else</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FUNCNAME</span><span class="s2">: Wrong."</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> cdback <span class="o">{</span>
    <span class="c1">#popd $1 &gt;/dev/null</span>
    <span class="nb">local</span> <span class="nv">num</span><span class="o">=</span><span class="nv">$1</span> i
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$num</span><span class="s2">"</span> -o <span class="s2">"</span><span class="nv">$num</span><span class="s2">"</span> <span class="o">=</span> <span class="m">1</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">popd</span> &gt;/dev/null
        <span class="k">return</span>
    <span class="k">elif</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$num</span><span class="s2">"</span> <span class="o">=</span>~ ^<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>+$ <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="k">for</span> <span class="o">((</span> <span class="nv">i</span><span class="o">=</span><span class="m">0</span> <span class="p">;</span> i&lt;num <span class="p">;</span> i++ <span class="o">))</span> <span class="p">;</span> <span class="k">do</span>
            <span class="nb">popd</span> &gt;/dev/null
        <span class="k">done</span>
        <span class="k">return</span>
    <span class="k">else</span>
        <span class="nb">echo</span> <span class="s2">"cdback: argument is invalid."</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="k">fi</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="カレントディレクトリにある打つのが面倒なディレクトリへ移動" class="fragment"></span><a href="#%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%88%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E3%81%82%E3%82%8B%E6%89%93%E3%81%A4%E3%81%AE%E3%81%8C%E9%9D%A2%E5%80%92%E3%81%AA%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%B8%E7%A7%BB%E5%8B%95"><i class="fa fa-link"></i></a>カレントディレクトリにある、打つのが面倒なディレクトリへ移動</h2>

<p>特に最近では日本語ディレクトリが多くなってきている印象です。日本語のファイル名やディレクトリ名は利用すれば便利なのですが、それはGUIでの話であって、CUIでは<code>cd</code>のときに打つのが面倒だったりといった問題があります。</p>

<p>そこで日本語変換をオンにせずとも、カレントディレクトリの一覧を番号付きで出して、番号を打つだけで移動ができる <code>cdlist</code> コマンドを定義してみましょう。</p>

<div class="code-frame" data-lang="Bash"><div class="highlight"><pre><span></span><span class="c1"># 現在のディレクトリの中にあるディレクトリを番号指定で移動</span>
<span class="k">function</span> cdlist <span class="o">{</span>
    <span class="nb">local</span> -a dirlist <span class="nv">opt_f</span><span class="o">=</span><span class="nb">false</span>
    <span class="nb">local</span> i d <span class="nv">num</span><span class="o">=</span><span class="m">0</span> dirnum opt opt_f
    <span class="k">while</span> <span class="nb">getopts</span> <span class="s2">":f"</span> opt <span class="p">;</span> <span class="k">do</span>
        <span class="k">case</span> <span class="nv">$opt</span> in
            f <span class="o">)</span> <span class="nv">opt_f</span><span class="o">=</span><span class="nb">true</span> <span class="p">;;</span>
        <span class="k">esac</span>
    <span class="k">done</span>
    <span class="nb">shift</span> <span class="k">$((</span> OPTIND <span class="o">-</span><span class="m">1</span> <span class="k">))</span>
    dirlist<span class="o">[</span><span class="m">0</span><span class="o">]=</span>..
    <span class="c1"># external pipe scope. array is established.</span>
    <span class="k">for</span> d in * <span class="p">;</span> <span class="k">do</span> <span class="nb">test</span> -d <span class="s2">"</span><span class="nv">$d</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> dirlist<span class="o">[</span><span class="k">$((</span><span class="o">++</span>num<span class="k">))</span><span class="o">]=</span><span class="s2">"</span><span class="nv">$d</span><span class="s2">"</span> <span class="p">;</span> <span class="k">done</span>
    <span class="c1"># TODO: Is seq installed?</span>
    <span class="k">for</span> i in <span class="k">$(</span> seq <span class="m">0</span> <span class="nv">$num</span> <span class="k">)</span> <span class="p">;</span> <span class="k">do</span> <span class="nb">printf</span> <span class="s2">"%3d %s%b\n"</span> <span class="nv">$i</span> <span class="s2">"</span><span class="k">$(</span> <span class="nv">$opt_f</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> -n <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">/"</span> <span class="k">)</span><span class="si">${</span><span class="nv">dirlist</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="p">;</span> <span class="k">done</span>
    <span class="nb">read</span> -p <span class="s2">"select number: "</span> dirnum
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$dirnum</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FUNCNAME</span><span class="s2">: Abort."</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="k">elif</span> <span class="o">(</span> <span class="nb">echo</span> <span class="nv">$dirnum</span> <span class="p">|</span> egrep <span class="s1">'^[[:digit:]]+$'</span> &gt; /dev/null <span class="o">)</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">cd</span> <span class="s2">"</span><span class="si">${</span><span class="nv">dirlist</span><span class="p">[</span><span class="nv">$dirnum</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">else</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FUNCNAME</span><span class="s2">: Something wrong."</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="k">fi</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="名前でディレクトリ名を検索して移動する" class="fragment"></span><a href="#%E5%90%8D%E5%89%8D%E3%81%A7%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E5%90%8D%E3%82%92%E6%A4%9C%E7%B4%A2%E3%81%97%E3%81%A6%E7%A7%BB%E5%8B%95%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>名前でディレクトリ名を検索して移動する</h2>

<p>例えば "qiita" という文字列が入ったディレクトリを大文字小文字区別せず検索して、その検索結果から移動したい場合。よくありそうですね。</p>

<p><code>find / -iname \*qiita\* -type d</code></p>

<p>これで出てきた結果を目視して、コピーアンドペーストをして移動…。面倒な感じがします。そもそも<code>find</code>コマンド自体が検索に時間がかかります。</p>

<p>Linuxには<code>locate</code>、Macには<code>mdfind</code>という、事前に作成したインデックスファイルを利用して高速検索ができるコマンドがあるので、<code>find /</code> するくらいなら、そちらを利用したほうがよさそうです。</p>

<p>大体の場合、移動したいディレクトリが、カレントディレクトリ以下にあるのか、ホームディレクトリ以下にあるのか、それとも <code>/</code> 以下にあるのか、いちいち区別するのは不便です。</p>

<p>そこで書いてみたのが <code>mdfind</code> を利用した <code>cdmdfind</code> です。</p>

<div class="code-frame" data-lang="Bash"><div class="highlight"><pre><span></span><span class="c1"># cd shortcut by mdfind (Mac OS X Spotlight CLI)</span>
<span class="nb">type</span> mdfind &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="k">function</span> cdmdfind <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">arg</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> path <span class="nv">i</span><span class="o">=</span><span class="m">0</span> j selnum selpath OUTPUT
    <span class="nb">declare</span> -a pathes
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-h"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"Usage:"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$FUNCNAME</span><span class="s2"> STRING"</span>
        <span class="k">return</span>
    <span class="k">fi</span>
    <span class="c1"># mdfind search is case insensitive</span>
    <span class="k">for</span> path in <span class="k">$(</span>mdfind -name <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="p">|</span> sed -e <span class="s1">'s/ /+/g'</span><span class="k">)</span> <span class="p">;</span> <span class="k">do</span>
        <span class="nv">path</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$path</span><span class="s2">"</span> <span class="p">|</span> sed -e <span class="s1">'s/\+/ /g'</span><span class="k">)</span>
        <span class="nb">test</span> -d <span class="s2">"</span><span class="nv">$path</span><span class="s2">"</span> <span class="o">||</span> <span class="k">continue</span>
        <span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span>
        pathes<span class="o">[</span><span class="nv">$i</span><span class="o">]=</span><span class="s2">"</span><span class="nv">$path</span><span class="s2">"</span>
    <span class="k">done</span>
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="si">${</span><span class="nv">pathes</span><span class="p">[1]</span><span class="si">}</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="c1"># Nothing search result.</span>
        <span class="k">return</span>
    <span class="k">fi</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$i</span> -ge <span class="nv">$LINES</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nv">OUTPUT</span><span class="o">=</span><span class="nv">$PAGER</span>
        <span class="nb">test</span> -z <span class="s2">"</span><span class="nv">$OUTPUT</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nv">OUTPUT</span><span class="o">=</span>cat
    <span class="k">else</span>
        <span class="nv">OUTPUT</span><span class="o">=</span>cat
    <span class="k">fi</span>
    <span class="k">for</span> j in <span class="k">$(</span>seq <span class="m">1</span> <span class="nv">$i</span><span class="k">)</span> <span class="p">;</span> <span class="k">do</span>
        <span class="nb">printf</span> <span class="s2">"%2d: %s\n"</span> <span class="nv">$j</span> <span class="s2">"</span><span class="si">${</span><span class="nv">pathes</span><span class="p">[</span><span class="nv">$j</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">done</span> <span class="p">|</span> <span class="nv">$OUTPUT</span>
    <span class="nb">read</span> -p <span class="s2">"select number: "</span> selnum
    <span class="nv">selpath</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">pathes</span><span class="p">[</span><span class="nv">$selnum</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$selpath</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FUNCNAME</span><span class="s2">: select is wrong."</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
        <span class="k">return</span> <span class="m">1</span>
    <span class="k">fi</span>
    <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$selpath</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div></div>

<p>検索を実行すると、メニューが出て…といったところは前述の <code>cdlist</code> をそのまま真似ました。</p>

<p>さらに <code>cdmdfind</code> を真似て <code>cdlocate</code> を書きました。</p>

<div class="code-frame" data-lang="Bash"><div class="highlight"><pre><span></span><span class="c1"># cd shortcut by locate</span>
<span class="nb">type</span> locate &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="k">function</span> cdlocate <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">arg</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> path <span class="nv">i</span><span class="o">=</span><span class="m">0</span> j selnum selpath OUTPUT
    <span class="nb">declare</span> -a pathes
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-h"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"Usage:"</span>
        <span class="nb">echo</span> <span class="s2">"  </span><span class="nv">$FUNCNAME</span><span class="s2"> STRING"</span>
        <span class="k">return</span>
    <span class="k">fi</span>
    <span class="c1"># mdfind search is case insensitive</span>
    <span class="k">for</span> path in <span class="k">$(</span>locate <span class="s2">"</span><span class="nv">$arg</span><span class="s2">"</span> <span class="p">|</span> grep -i -E <span class="s2">"/[^/]*</span><span class="nv">$arg</span><span class="s2">[^/]*</span>$<span class="s2">"</span> <span class="p">|</span> sed -e <span class="s1">'s/ /+/g'</span><span class="k">)</span> <span class="p">;</span> <span class="k">do</span>
        <span class="nv">path</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$path</span><span class="s2">"</span> <span class="p">|</span> sed -e <span class="s1">'s/\+/ /g'</span><span class="k">)</span>
        <span class="nb">test</span> -d <span class="s2">"</span><span class="nv">$path</span><span class="s2">"</span> <span class="o">||</span> <span class="k">continue</span>
        <span class="nv">i</span><span class="o">=</span><span class="k">$((</span>i+1<span class="k">))</span>
        pathes<span class="o">[</span><span class="nv">$i</span><span class="o">]=</span><span class="s2">"</span><span class="nv">$path</span><span class="s2">"</span>
    <span class="k">done</span>
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="si">${</span><span class="nv">pathes</span><span class="p">[1]</span><span class="si">}</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="c1"># Nothing search result.</span>
        <span class="k">return</span>
    <span class="k">fi</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$i</span> -ge <span class="nv">$LINES</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nv">OUTPUT</span><span class="o">=</span><span class="nv">$PAGER</span>
        <span class="nb">test</span> -z <span class="s2">"</span><span class="nv">$OUTPUT</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nv">OUTPUT</span><span class="o">=</span>cat
    <span class="k">else</span>
        <span class="nv">OUTPUT</span><span class="o">=</span>cat
    <span class="k">fi</span>
    <span class="k">for</span> j in <span class="k">$(</span>seq <span class="m">1</span> <span class="nv">$i</span><span class="k">)</span> <span class="p">;</span> <span class="k">do</span>
        <span class="nb">printf</span> <span class="s2">"%2d: %s\n"</span> <span class="nv">$j</span> <span class="s2">"</span><span class="si">${</span><span class="nv">pathes</span><span class="p">[</span><span class="nv">$j</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">done</span> <span class="p">|</span> <span class="nv">$OUTPUT</span>
    <span class="nb">read</span> -p <span class="s2">"select number: "</span> selnum
    <span class="nv">selpath</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">pathes</span><span class="p">[</span><span class="nv">$selnum</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="nv">$selpath</span><span class="s2">"</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$FUNCNAME</span><span class="s2">: select is wrong."</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
        <span class="k">return</span> <span class="m">1</span>
    <span class="k">fi</span>
    <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$selpath</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div></div>

<p>ほぼ <code>cdmdfind</code> そのままです。ただ、<code>locate</code> の出力が、<code>mdfind -name</code> とは違い、パス全体の中からの一致で非常に多くの検索が出てくるので <code>grep -i -E "/[^/]*$arg[^/]*$"</code> で検索結果を適切なように絞っています。</p>

<h2>
<span id="他にもアイデアが" class="fragment"></span><a href="#%E4%BB%96%E3%81%AB%E3%82%82%E3%82%A2%E3%82%A4%E3%83%87%E3%82%A2%E3%81%8C"><i class="fa fa-link"></i></a>他にもアイデアが…</h2>

<p>この記事を書くにあたって、他にも<code>cd</code>を効率化することができるか考えたのですが、いくつか考えついたものがあります。指定ディレクトリ以下に <code>.git/</code> があるディレクトリを一覧してGitワークディレクトリを選択させるコマンドとか…。完成したら随時この記事に追記していこうとおもいます。</p>

<p>もしあなたにもアイデアがあれば、ぜひこの記事へのコメントや Twitter @<a href="https://twitter.com/xtetsuji" rel="nofollow noopener" target="_blank">xtetsuji</a> へ教えていただければ幸いです。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>私の <a href="https://github.com/xtetsuji/dotfiles/" rel="nofollow noopener" target="_blank">GitHub リポジトリの dotfiles</a> にはこれらの設定例が書かれています。ただし、<code>~/.bash_secret</code> だけは秘密のファイルとして公開はしていません。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>82</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/e8b61bb39c41b7a9345e">ブックマークレットを作るときのTips</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-22 19:17:42</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[bookmarklet]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="名前空間を汚染しない" class="fragment"></span><a href="#%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93%E3%82%92%E6%B1%9A%E6%9F%93%E3%81%97%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>名前空間を汚染しない</h2>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="c1">//javascript:</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"title"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerText</span><span class="p">;})()</span>
</pre></div></div>

<p>特に多くのページで利用されるブックマークレットは、平凡な変数名だと既に存在する変数名とバッティングする可能性が高いので、このように <code>(function(){...})()</code> することが重要になってきます。関数ブロックは変数スコープを作り、 この中で <code>var</code> で宣言した変数は外部で使われる同名の変数と別のものになります。</p>

<p>また、このようにすることでブックマークレット全体の実行結果として何も返さない(voidを返す)ことも都合が良いです。</p>

<p>すべての変数は無名関数ブロックの変数スコープ内で <code>var</code> を使って宣言しましょう。<code>var</code> は複数の代入をコロンで区切って宣言することができます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"div"</span><span class="p">),</span>
    <span class="nx">content</span> <span class="o">=</span> <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">,</span>
    <span class="nx">abc</span><span class="p">,</span>
    <span class="nx">xyz</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"xyz"</span><span class="p">);</span>
</pre></div></div>

<p>（上記は実際には一行にまとめられます）</p>

<p>ブックマークレットでは文字数の少なさが重要です。また<code>var</code>宣言はスコープの冒頭に巻きあげられる性質があるので、使う変数は関数ブロックの冒頭にまとめて宣言しておいたほうが混乱がないと思います。</p>

<h2>
<span id="引数を活用する" class="fragment"></span><a href="#%E5%BC%95%E6%95%B0%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>引数を活用する</h2>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="c1">//javascript:</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">l</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="cm">/* some code*/</span><span class="p">})(</span><span class="nb">document</span><span class="p">,</span><span class="nx">location</span><span class="p">,</span><span class="nb">encodeURIComponent</span><span class="p">);</span>
</pre></div></div>

<p>良く書く<code>document</code>といった組み込みオブジェクト等の短縮記法として引数活用をするとよい場合があります。</p>

<h2>
<span id="デバッグにconsolelogを利用する" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%ABconsolelog%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>デバッグにconsole.log()を利用する</h2>

<p>FirefoxやChromeなど、最近のモダンブラウザはデバッガが標準で付いていたりFirebugなどのデバッガを入れることができるようになりました。</p>

<p>その時にデバッグ出力をデバッガのコンソールに <code>console.log()</code> メソッドで出力することができるので、何が起こっているのかプリントデバッグのようなことができます。<code>alert()</code>でもよいのですが、オブジェクトを出力させたときにChromeでは中身を表示してくれるといったことを<code>console.log()</code>はしてくれたりするのでオススメです。</p>

<h2>
<span id="はてなletを活用する" class="fragment"></span><a href="#%E3%81%AF%E3%81%A6%E3%81%AAlet%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>はてなletを活用する</h2>

<ul>
<li><a href="http://let.hatelabo.jp/" class="autolink" rel="nofollow noopener" target="_blank">http://let.hatelabo.jp/</a></li>
</ul>

<p>ブックマークレットを公開するための便利なツールです。デバッグレットという作りながら試せる機能もあります。</p>

<h2>
<span id="javascriptのコンプレッサーを使う" class="fragment"></span><a href="#javascript%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%97%E3%83%AC%E3%83%83%E3%82%B5%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>JavaScriptのコンプレッサーを使う</h2>

<p>長いブックマークレットになってくると、最初から一行で書くのはつらくなってきます。公開したくないブックマークレットだと、はてなletを使うわけにもいかないですね。</p>

<p>そういうときには、 <strong>Google Closure Compiler</strong>  や <strong>YUI Compressor</strong> などの JavaScript コードを一行にまとめるコンプレッサーの類を使うことも検討しましょう。</p>

<p>ただ、上記ツールはJava製なので、JavaVMなどが入っていないと使えなかったりするので面倒です。</p>

<p>私(@<a href="https://twitter.com/xtetsuji" rel="nofollow noopener" target="_blank">xtetsuji</a>)の<a href="https://github.com/xtetsuji/bookmarklet" rel="nofollow noopener" target="_blank">bookmarklet GitHubリポジトリ</a>には、<code>js2let.pl</code>という簡単なPerlプログラムがあります。真面目な構文解析などはしていないので複雑なことをしているスクリプトが壊れる事もありますが、たいていの小さなブックマークレット用JavaScriptは問題なく一行にできると思います。Perlの外部モジュールへの依存もないので、どこにでも入っているPerlで使うことができます。</p>

<h2>
<span id="大きなスクリプトは外部読み込みを使う" class="fragment"></span><a href="#%E5%A4%A7%E3%81%8D%E3%81%AA%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AF%E5%A4%96%E9%83%A8%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>大きなスクリプトは外部読み込みを使う</h2>

<p>はてなletのデバッグレットでも同じ仕組みを使っていますが、大きなJavaScriptプログラムをブックマークレットにしようとした場合、ブックマークレットの長さの制限に引っかかったり可搬性が低かったりする可能性があります。そういう場合にはブックマークレットから外部JavaScriptファイルを外部読み込みする方法があります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"script"</span><span class="p">);</span>
  <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">"http://example.jp/big.js"</span><span class="p">;</span> <span class="cm">/* あなたの書いたプログラム */</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
  <span class="cm">/* この後に追加処理を書いていく */</span>
<span class="p">})()</span>
</pre></div></div>

<p>これを一行にしたものをブックマークレットとすればよいでしょう。詳しくは「createElement ブックマークレット」などで検索してみると良いと思います。</p>

<p>読み込まれるJavaScriptはbody要素の内容に追加される( <code>&lt;/body&gt;</code> の直前にscript要素が入る)ので、 <strong>既存のページの名前空間を汚染する</strong> ことを念頭に置くことができれば特に問題は起こらないでしょう。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<ul>
<li><a href="http://qiita.com/tags/bookmarklet">Qiitaのbookmarkletタグ</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>52</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/9939143a7619956997e1">Perlの正規表現の一行モード(/s)と複数行モード(/m)の覚え方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-26 16:00:18</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Perl]</b> <b>[正規表現]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Perlの正規表現のモードに「一行モード」「複数行モード」というものがあります。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="nv">$str</span> <span class="o">=~</span><span class="sr"> /^--/m</span>
    <span class="ow">and</span> <span class="k">print</span> <span class="s">"複数行モードでマッチ\n"</span><span class="p">;</span>
<span class="nv">$str</span> <span class="o">=~</span><span class="sr"> /&lt;script.*?&lt;\/script&gt;/s</span>
    <span class="ow">and</span> <span class="k">print</span> <span class="s">"一行モードでマッチ\n"</span><span class="p">;</span>
</pre></div></div>

<p>定義が分からない方は、後述で定義を解説しています。</p>

<p>一般に Perl では マッチ <code>m//</code> や置換 <code>s///</code> の右側に伴う上記の <code>m</code> や <code>s</code> のような英文字のことを<strong>修飾子</strong> (modifier) と言います (see: <a href="http://perldoc.jp/perlre" rel="nofollow noopener" target="_blank">perlre</a>)。</p>

<p>私はこれをよく間違えたり忘れたりするので、こんな覚え方を考えてみました。</p>

<h1>
<span id="そもそも名前がややこしい" class="fragment"></span><a href="#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E5%90%8D%E5%89%8D%E3%81%8C%E3%82%84%E3%82%84%E3%81%93%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>そもそも名前がややこしい</h1>

<ul>
<li>一行モード(Single line mode) m//<em>s</em> は、ドット(.)が <strong>「複数行」</strong> にわたってマッチするようになる</li>
<li>複数行モード(Multiple line mode) m//<em>m</em> は、"^" "$" が <strong>「一行」</strong> ごとにマッチするようになる</li>
</ul>

<p>つまり <strong>一行モードではない</strong> ドット(".")は、改行にはマッチしない、つまり [^\n] とほぼ同じ意味です。</p>

<p>また <strong>複数行モードではない</strong> "^" や "\$" は、検査するテキストが改行文字を含んだ論理的に複数行の場合、改行の前後にはマッチせず、検査するテキストの冒頭("^")と末尾("$")にのみマッチします。</p>

<p>誇張してややこしく説明していると思う方もいるかもしれませんが、私はいつもこれを混同して混乱していました。</p>

<p>それならばmとsを「複数行モード」「一行モード」とは違う覚え方で覚えればいいと発想の転換をしてみました。</p>

<h1>
<span id="一行モード" class="fragment"></span><a href="#%E4%B8%80%E8%A1%8C%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>一行モード</h1>

<p>一行モード /s の s は <strong>「Super dot mode」</strong> と覚えます。</p>

<p><strong>今までのドットは万能ではなく</strong> 、唯一改行文字にマッチしないという特性(欠点かどうかは別として)を持っていましたが、一行モード /s を指定するとドットは万能になり、あらゆる文字にマッチするようになります。</p>

<h1>
<span id="複数行モード" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E8%A1%8C%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>複数行モード</h1>

<p>複数行モード /m の m は <strong>「Multiple Match Mountain」</strong> と覚えます。</p>

<p>今までの山"^"は変数の冒頭にしかマッチしなかったのが、改行の直後にもマッチするようになります。詳しく書けば戻り読みゼロ幅マッチ (?&lt;=\n|) とほぼ同じ意味となります。</p>

<p>"$" も同様に、先読みゼロ幅マッチ (?=\n) と <strong>ほぼ</strong> 同じ意味になります。</p>

<p>"$" は "^" とは違う癖があるので、後述で詳細を解説します。</p>

<h1>
<span id="複数行モードの活用" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E8%A1%8C%E3%83%A2%E3%83%BC%E3%83%89%E3%81%AE%E6%B4%BB%E7%94%A8"><i class="fa fa-link"></i></a>複数行モードの活用</h1>

<p>複数行モードで ^ を使うと、メールの冒頭引用のようなことが簡単にできます。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="c1"># /g はグローバルマッチ。何回でもマッチする</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/^/&gt; /mg</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&gt; Today is fine.
&gt; 
&gt; This is a pen.
&gt; 
</pre></div></div>

<p>引用符が入りました。</p>

<p>ただ、 $ については ^ からの想像とは違う結果が複数行モードでは発生します。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/$/&lt;&lt;&lt;/mg</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span><span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Today is fine.&lt;&lt;&lt;
&lt;&lt;&lt;
This is a pen.&lt;&lt;&lt;
&lt;&lt;&lt;
&lt;&lt;&lt;
</pre></div></div>

<p>余計な (?) <code>&lt;&lt;&lt;</code> が最後に入っています。</p>

<p>これは複数行モードの \$ が、改行の直前にゼロ幅マッチし、かつ文字列変数の末尾の直前にもゼロ幅マッチするからです。</p>

<p>なお、最後に入れた <code>print "\\n";</code> はコマンドライン出力を読みやすくするために入れただけで、今回の正規表現マッチの話とは直接関係はありません。</p>

<p>改行を可視化してみると分かりやすいです。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/$/&lt;&lt;&lt;/mg</span><span class="p">;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\n/{LF}/g</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span><span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Today is fine.&lt;&lt;&lt;{LF}&lt;&lt;&lt;{LF}This is a pen.&lt;&lt;&lt;{LF}&lt;&lt;&lt;{LF}&lt;&lt;&lt;
</pre></div></div>

<p>複数行モードの ^ は直感的ですが、\$ は少々癖があることに注意するとよいでしょう。本当に改行の直前のみにマッチさせたい場合には明示的に先読みゼロ幅マッチ <code>(?=\n)</code> を使うと良いでしょう。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/(?=\n)/&lt;&lt;&lt;/mg</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span><span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Today is fine.&lt;&lt;&lt;
&lt;&lt;&lt;
This is a pen.&lt;&lt;&lt;
&lt;&lt;&lt;
</pre></div></div>

<h1>
<span id="複数行モードで文字列の冒頭と末尾を表す-a-z-z" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E8%A1%8C%E3%83%A2%E3%83%BC%E3%83%89%E3%81%A7%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E5%86%92%E9%A0%AD%E3%81%A8%E6%9C%AB%E5%B0%BE%E3%82%92%E8%A1%A8%E3%81%99-a-z-z"><i class="fa fa-link"></i></a>複数行モードで文字列の冒頭と末尾を表す \A \Z \z</h1>

<p>\A \Z \z という3つの正規表現について解説します。</p>

<p>複数行モードで ^ や \$ は文字列の冒頭末尾以外にも、改行の前後にもマッチするようになりました。「複数行モード」で以前の ^ や \$ の意味を表したい場合に使われるのが \A \Z そして \z です。</p>

<p>この正規表現トークンの名前の由来は、たぶんアルファベットの一番最初 (\A)が冒頭、アルファベットの一番最後(\Z および \z)が末尾、ということなのだと思います。</p>

<p>\A は ^ 同様、直感的です。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/^/---/mg</span><span class="p">;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\A/===/mg</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>===---Today is fine.
---
---This is a pen.
---
</pre></div></div>

<p>大文字の \A に対応しているように見える大文字の \Z ですが、とりあえず使ってみましょう。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/$/&lt;&lt;&lt;/mg</span><span class="p">;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\Z/|||/mg</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Today is fine.&lt;&lt;&lt;
&lt;&lt;&lt;
This is a pen.&lt;&lt;&lt;
&lt;&lt;&lt;
&lt;&lt;&lt;|||
</pre></div></div>

<p>直感通りのような気がします。改行を可視化してみると、以下のようになります。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/$/&lt;&lt;&lt;/mg</span><span class="p">;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\Z/|||/mg</span><span class="p">;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\n/{LF}/g</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Today is fine.&lt;&lt;&lt;{LF}&lt;&lt;&lt;{LF}This is a pen.&lt;&lt;&lt;{LF}&lt;&lt;&lt;{LF}&lt;&lt;&lt;|||
</pre></div></div>

<p>大丈夫そうです。でも前段の \$ の複数行モードのゼロ幅マッチの置換を取り除くと</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="c1">#$body =~ s/$/&lt;&lt;&lt;/mg;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\Z/|||/mg</span><span class="p">;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\n/{LF}/g</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span><span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Today is fine.{LF}{LF}This is a pen.{LF}|||{LF}|||
</pre></div></div>

<p>なんか変なことになりましたね。\Z は <strong>文字列変数の末尾が改行の場合 、文字列変数の終端だけでなく文字列変数の末尾にある改行の直前にもゼロ幅マッチしてしまう</strong> ようです。これは文字列をバリデートするときにハマる可能性があります。これは \$ の挙動を模しているかのようです(後述します)。</p>

<p>そこで厳密に文字列変数の末尾にゼロ幅マッチする <strong>\z</strong> という正規表現があります。</p>

<p>これを使うと、我々がより意図した結果になります。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="c1">#$body =~ s/$/&lt;&lt;&lt;/mg;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\z/|||/mg</span><span class="p">;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\n/{LF}/g</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Today is fine.{LF}{LF}This is a pen.{LF}{LF}|||
</pre></div></div>

<p>\Z の挙動はあまり望ましい挙動ではないケースが多いでしょう。「複数行モード」では \A と \z と変数の冒頭と末尾に使うと覚えましょう。</p>

<p>注意しなければならないのは、複数行モード <strong>ではない</strong> \$ も \Z のようなマッチをしてしまうことがあるということ。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">END_BODY</span><span class="s">;</span>
<span class="s">Today is fine.</span>

<span class="s">This is a pen.</span>

<span class="dl">END_BODY</span>

<span class="c1">#$body =~ s/$/&lt;&lt;&lt;/mg;</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/$/|||/g</span><span class="p">;</span> <span class="c1"># 複数行モードではない (mなし)</span>
<span class="nv">$body</span> <span class="o">=~</span> <span class="sr">s/\n/{LF}/g</span><span class="p">;</span>

<span class="k">print</span> <span class="nv">$body</span><span class="p">;</span><span class="k">print</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Today is fine.{LF}{LF}This is a pen.{LF}|||{LF}|||
</pre></div></div>

<p>手元のPerlのバージョンは5.16.3でした。</p>

<p>改行が入ったテキストのバリデーションに失敗してしまうと、HTTPヘッダインジェクションなどの火種になる可能性があります。改行が入る可能性がある外部入力を厳密に検査する必要がある場合は、$ や \Z は避けて、複数行モードを明示した上で \A と \z を使うようにしたほうがよいでしょう。</p>

<h1>
<span id="perl以外での注意点" class="fragment"></span><a href="#perl%E4%BB%A5%E5%A4%96%E3%81%A7%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>Perl以外での注意点</h1>

<p>PHPのpreg*関数等、Perl互換正規表現(PCRE)ではほぼ同様の振る舞いを実現していると考えてよいでしょう。Javaや.NETの正規表現もこれとほぼ同様の挙動をするようです(書籍からの情報であって実際に試したわけではありませんし、バージョンや正規表現エンジンの違いによって結果は異なることも想定されます)。特に末尾マッチ系 \$ \Z \z については実装依存の部分も多いようです。それぞれの言語のそれぞれの実装系で検証してみることをおすすめします。</p>

<h2>
<span id="ruby-での注意点" class="fragment"></span><a href="#ruby-%E3%81%A7%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>Ruby での注意点</h2>

<p>Perlと記号的に近いRubyの正規表現修飾子（Ruby のマニュアルでは「オプション」と表現されている）に関しては注意が必要で、これと同等の挙動にはならないことに注意してください。</p>

<table>
<thead>
<tr>
<th>Perlでいうモード</th>
<th>Perlでは</th>
<th>Rubyでは</th>
</tr>
</thead>
<tbody>
<tr>
<td>一行モード<br>(single line mode)</td>
<td>/pat/s</td>
<td>/pat/m</td>
</tr>
<tr>
<td>複数行モード<br>(multiple line mode)</td>
<td>/pat/m</td>
<td>最初からそう</td>
</tr>
</tbody>
</table>

<p>「一行モード」の挙動。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ perl -E '$str = "abc\ndef\nghi\n"; $str =~ /(.*)/; say "match: $1\n";'
match: abc

$ perl -E '$str = "abc\ndef\nghi\n"; $str =~ /(.*)/s; say "match: $1\n";'
match: abc
def
ghi

$ ruby -e 'str = "abc\ndef\nghi\n"; str.match(/(.*)/); puts "match: #{$1}\n";'
match: abc

$ ruby -e 'str = "abc\ndef\nghi\n"; str.match(/(.*)/s); puts "match: #{$1}\n";'
match: abc

$ ruby -e 'str = "abc\ndef\nghi\n"; str.match(/(.*)/m); puts "match: #{$1}\n";'
match: abc
def
ghi
</pre></div></div>

<p>「複数行モード」についての Perl と Ruby の差異。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ perl -E '$str = "abc\ndef\nghi\n"; $str =~ s/^/&gt;/g; say $str;'
&gt;abc
def
ghi

$ perl -E '$str = "abc\ndef\nghi\n"; $str =~ s/^/&gt;/gm; say $str;'
&gt;abc
&gt;def
&gt;ghi

$ ruby -e 'str = "abc\ndef\nghi\n"; puts str.gsub(/^/, "&gt;");'
&gt;abc
&gt;def
&gt;ghi
</pre></div></div>

<p>（Ruby の <code>String#gsub!</code> ではない非破壊版 <code>String#gsub</code> と同等のことは、Perl 5.14 以降であれば <code>s///r</code> と r 修飾子を使うことで実現できます。 <code>say $str =~ s/^/&gt;/gmr;</code> ）</p>

<p>ドットを改行にもマッチさせる、Perl でいう「一行モード」を Ruby で実現したい場合には <code>/pat/s</code>(super dot mode) ではなく <code>/pat/m</code> と書く必要があります。この <code>m</code> が何を由来としているか、multiple であるとすれば、Ruby にとっての「複数行」は、「ドットが改行を飲み込んで複数行に渡ってマッチする」ことなのでしょう。それもまた自然な命名のように感じます。</p>

<p>また <code>^</code> を冒頭だけでなく改行の直後にマッチさせる、Perl でいう「複数行モード」については、Ruby の正規表現は最初からそういう挙動になっています。Perl でいう「複数行モード」ではない <code>^</code> を Ruby で実現させるためには、明示的に <code>\A</code> を使います。</p>

<p>上記のワンライナーでの実験で、Ruby の正規表現にて <code>/pat/s</code> を指定してもエラーにならかなかったのは、それに別の意味が割り当てられているからです。それは「正規表現はいわゆる Shift_JIS で書かれている」という意味です。</p>

<p>また1.8、1.9、2.0でそれぞれRubyの正規表現エンジンは微妙に違う（1.9系は Oniguruma、2.0以降は Onigmo）ことも、古いバージョンのRubyインタープリタを視野に入れたプログラムで込み入った正規表現を使う場合に少々注意が必要かもしれません。</p>

<h2>
<span id="javascript-での注意点" class="fragment"></span><a href="#javascript-%E3%81%A7%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>JavaScript での注意点</h2>

<p>JavaScript では Perl の <code>/s</code> 修飾子（JavaScriptではフラグ(flag)と呼ばれている）にあたるものは存在しないことに注意して下さい。</p>

<table>
<thead>
<tr>
<th>Perlでいうモード</th>
<th>Perlでは</th>
<th>JavaScriptでは</th>
</tr>
</thead>
<tbody>
<tr>
<td>一行モード<br>(single line mode)</td>
<td>/pat/s</td>
<td>存在しない</td>
</tr>
<tr>
<td>複数行モード<br>(multiple line mode)</td>
<td>/pat/m</td>
<td>/pat/m</td>
</tr>
</tbody>
</table>

<p>JavaScript では正規表現中の <code>.</code> は改行文字にはマッチしません。</p>

<p>もし Perl でいう <code>/s</code> 修飾子での <code>.</code> の振る舞いを JavaScript で使いたい場合は、改行にマッチしない <code>.</code> の代わりに、以下のような記法で対応することになります。</p>

<ul>
<li>
<code>[^]</code> という特殊な文字クラス表記を使う

<ul>
<li>ただし古いブラウザでは使えないこともある</li>
<li>Perl や PCRE 的には <code>[^]</code> という表記はエラー（正規表現コンパイルエラー）になる</li>
</ul>
</li>
<li>
<code>[\s\S]</code> といった、「文字クラスとその補集合の文字クラスのどちらか」というような2つのバックスラッシュシーケンスの文字クラスを、大括弧で囲む文字クラス形式で列挙する

<ul>
<li>こちらは古いブラウザとも互換性がある</li>
<li>Perl や PCRE 的にも正しい正規表現</li>
</ul>
</li>
</ul>

<h1>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h1>

<ul>
<li><a href="http://www.amazon.co.jp/dp/4873113598?tag=tetsujijp-22" rel="nofollow noopener" target="_blank">詳説正規表現 第3版</a></li>
<li><a href="https://docs.ruby-lang.org/ja/2.4.0/doc/spec=2fregexp.html" rel="nofollow noopener" target="_blank">正規表現 (Ruby 2.4.0)</a></li>
<li>
<a href="www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf">Ecma-262.pdf</a> の21.2.2.8 Atom</li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/RegExp" rel="nofollow noopener" target="_blank">RegExp - JavaScript | MDN</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>34</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/a8490a7fea3f5a01e49c">JavaScript文字列のバイト数を数える - encodeURIComponent版</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-07 11:08:08</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://qiita.com/items/a46a70b724e3dd9378f2" class="autolink">http://qiita.com/items/a46a70b724e3dd9378f2</a> JavaScript文字列のバイト数を数える - にインスパイアされました。</p>

<p>こちらは実際にencodeURIComponent()でUTF-8のバイト列の16進数バイト表記に直して正規表現で処理する形式。バイト数をcharCodeAt()で数えるよりコストはかかるけど、たぶん正確性や保守性は高いんじゃないかな。速度を気にしない場合にどうぞ。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">bytes2.js</span></div>
<div class="highlight"><pre><span></span><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bytes2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/%../g</span><span class="p">,</span><span class="s2">"x"</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>

<p>コアのprototypeを拡張すると速度が低下することを気にする人用の関数バージョン。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">bytes2func.js</span></div>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">bytes2</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">str</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/%../g</span><span class="p">,</span><span class="s2">"x"</span><span class="p">).</span><span class="nx">length</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>

<p><strong><em>結果</em></strong></p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">output.js</span></div>
<div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">"あああa"</span><span class="p">.</span><span class="nx">bytes2</span><span class="p">()</span> <span class="p">);</span> <span class="c1">// -&gt; 10</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">"èî"</span><span class="p">.</span><span class="nx">bytes2</span><span class="p">()</span> <span class="p">);</span> <span class="c1">// -&gt; 4</span>
</pre></div>
</div>

<p>試していないけど、UTF-8には6バイトまで種類があるらしいから、これで定義しておけばしばらくは困らないんじゃないかな。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>12</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/fcaa7bc5e19cf46aeefb">cpanmでDBD::mysqlを入れる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-06 10:41:35</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Perl]</b> <b>[MySQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>plenvやperlbrewで<code>cpanm</code>を入れてそれでモジュールを入れるとDBD::mysqlが入らないケースがあります。手元にMySQL (libmysql) が入っていないからです。</p>

<p>Homebrewを使って手元に手軽にMySQLを入れてしまいましょう。</p>

<p>検証環境:</p>

<ul>
<li>MacBook Air 2013 Late</li>
<li>Mavericks</li>
</ul>

<p>なお、付記として</p>

<ul>
<li>Debian stable / Ubuntu stable</li>
</ul>

<p>の場合についても言及してあります。</p>

<h2>
<span id="homebrewでmysqlを入れる" class="fragment"></span><a href="#homebrew%E3%81%A7mysql%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>HomebrewでMySQLを入れる</h2>

<p>思いつく通りに入れれば大丈夫そうです。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$ brew install mysql
</pre></div></div>

<p>ここでトラブルが起きた場合は <code>brew doctor</code> を参考にするか、<code>brew update</code> を怠っていないかなどをチェックしましょう。<a href="http://www.karakaram.com/install-mysql56-homebrew" rel="nofollow noopener" target="_blank">HomebrewでMySQL 5.6をインストール。開発用my.cnfもさらす</a> も参考になります。</p>

<h2>
<span id="dbdmysqlインストール用の環境変数を設定する" class="fragment"></span><a href="#dbdmysql%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E7%94%A8%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>DBD::mysqlインストール用の環境変数を設定する</h2>

<p><a href="http://search.cpan.org/%7Ecapttofu/DBD-mysql-4.023/lib/DBD/mysql.pm#Environment_Variables" rel="nofollow noopener" target="_blank">DBD::mysql - Environment Variable</a> にしたがって現在のbashに環境変数を設定します。bashでない場合も同様に環境変数を設定すればよいと思います。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>export DBD_MYSQL_CFLAGS=-I/usr/local/Cellar/mysql/5.6.16/bin/mysql
export DBD_MYSQL_LIBS="-L/usr/local/Cellar/mysql/5.6.16/bin/mysql -lmysqlclient"
export DBD_MYSQL_EMBEDDED=
export DBD_MYSQL_CONFIG=/usr/local/Cellar/mysql/5.6.16/bin/mysql_config
export DBD_MYSQL_NOCATCHSTDERR=0
export DBD_MYSQL_NOFOUNDROWS=0
export DBD_MYSQL_SSL=
export DBD_MYSQL_TESTDB=test
export DBD_MYSQL_TESTHOST=localhost
export DBD_MYSQL_TESTPASSWORD=
export DBD_MYSQL_TESTPORT=3306
export DBD_MYSQL_TESTUSER=root
</pre></div></div>

<p>上記の設定を一行ずつ打っていくか、それを書いたファイルを <code>source</code> コマンドで現在のシェルに読み込ませればよいでしょう。</p>

<p>初期設定では test というデータベースは存在するし、root のパスワードは空文字なので大丈夫です。</p>

<p>パスについて、その時のHomebrewのMySQLでインストールされるパスが違うかもしれません。<code>brew info mysql</code> を参考するなどしてください。</p>

<h2>
<span id="mysqldは起動している" class="fragment"></span><a href="#mysqld%E3%81%AF%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>mysqldは起動している？</h2>

<p><code>brew info mysql</code> の指示に従ってmysqldを起動します。</p>

<p>一番簡単な方法は以下だと思います。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$ mysql.server start
</pre></div></div>

<p><code>mysql -u root -p</code> して <code>mysql</code> クライアントからデータベースに接続できることを確認します。</p>

<h2>
<span id="cpanm-dbdmysqlする" class="fragment"></span><a href="#cpanm-dbdmysql%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>cpanm DBD::mysqlする</h2>

<p>環境変数が設定されているか <code>env | grep DBD_</code> などを使って確認したあと、<code>cpanm DBD::mysql</code> します。たぶん今まで失敗していた場合も成功するのではないかと思います。</p>

<p>とりあえずMySQLクライアントインストール目的の場合は、この場で <code>brew uninstall mysql</code> しても大丈夫じゃないかなと思いますが、ちょっとここは自信がないです。mysqldがディスクの肥やしになっていることが気にならないのであれば、セキュリティ的に妥当な設定になっていることを確認して、そのままにしておくで良いかなと思います。</p>

<h2>
<span id="debianやubuntuの場合" class="fragment"></span><a href="#debian%E3%82%84ubuntu%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>DebianやUbuntuの場合</h2>

<p>Debian や、その派生OSであるUbuntuの場合は、 <strong>上記のような環境変数の設定はいりません</strong>。そのかわり、<code>libmysqlclient15-dev</code> というパッケージが必要になります。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$ sudo apt-get install libmysqlclient15-dev
</pre></div></div>

<p>このパッケージは <code>libmysqld-dev</code> などの依存関係でもインストールされるもののようです。外部のDBを利用するとしても、一時的にでも<code>mysql-server</code>パッケージを入れて手元にMySQLサーバを立てた上で、<code>cpanm DBD::mysql</code> してみるとうまくいくのではないかと思います。</p>

<p>参考:</p>

<ul>
<li><a href="http://blog.starbug1.com/archives/1277" rel="nofollow noopener" target="_blank">週記くらい | UbuntuでDBD::mysql のインストールに失敗</a></li>
</ul>

<p>Debian/Ubuntuではレアケースかと思いますが、自前でMySQLをビルドして入れているという場合には、また別の設定が必要になってくると思われます。</p>

<p>なお蛇足ですが、plenvやperlbrewによるユーザPerlではなく、システムPerlを使っているという場合であれば、<code>libdbd-mysql-perl</code> というパッケージを入れるだけで済みます。</p>

<h2>
<span id="番外編-forceモードで入れる" class="fragment"></span><a href="#%E7%95%AA%E5%A4%96%E7%B7%A8-force%E3%83%A2%E3%83%BC%E3%83%89%E3%81%A7%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>[番外編] forceモードで入れる</h2>

<p>手元がMySQLサーバではないけど、ネットの向こう側のMySQLサーバを使いたいからクライアントを入れるんだという意思がはっきりしている場合には force モードで入れてしまうという手もあります。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$ cpanm --force DBD::mysql
</pre></div></div>

<p>自分がやっていることやリスクが理解できる場合は、行儀は悪いもののこの方法でも良いと思います。</p>

<h2>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h2>

<ul>
<li><a href="http://www.karakaram.com/install-mysql56-homebrew" rel="nofollow noopener" target="_blank">HomebrewでMySQL 5.6をインストール。開発用my.cnfもさらす</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/1227e40bea05b09684e0">morboとhypnotoadの違いとハマりどころ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-04 23:35:23</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Perl]</b> <b>[Mojolicious]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>最近はMojoliciousも少しずつ使っています。@<a href="https://twitter.com/xtetsuji" rel="nofollow noopener" target="_blank">xtetsuji</a> です</p>

<p>今回は、以前どこかの勉強会で質問に挙がったことを思い出して書いてみます。</p>

<h2>
<span id="mojoliciousのビルトインサーバ2つ" class="fragment"></span><a href="#mojolicious%E3%81%AE%E3%83%93%E3%83%AB%E3%83%88%E3%82%A4%E3%83%B3%E3%82%B5%E3%83%BC%E3%83%902%E3%81%A4"><i class="fa fa-link"></i></a>Mojoliciousのビルトインサーバ2つ</h2>

<p>先日の@<a href="https://twitter.com/yusukebe" rel="nofollow noopener" target="_blank">yusukebe</a>さんのアドベントカレンダーでは、<code>plackup</code>を使ってPSGIアプリとして起動する方法が解説されていましたが、Mojoliciousには最初から以下の2つのウェブサーバが同梱されています。</p>

<ul>
<li>morbo (モーボと読むらしい)</li>
<li>hypnotoad (ハイプノトードと読むらしい)</li>
</ul>

<p>この他にも、<a href="http://search.cpan.org/dist/Mojolicious/" rel="nofollow noopener" target="_blank">Mojolicious</a>のMojo::Server::* 名前空間を見てみると、PSGIやらCGIやら、他の起動方法についてのサポートもあります。<code>mojo help</code> コマンドの出力も簡潔で参考になるでしょう。</p>

<h2>
<span id="morboとhypnotoadのプロセス起動方法の違い" class="fragment"></span><a href="#morbo%E3%81%A8hypnotoad%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E8%B5%B7%E5%8B%95%E6%96%B9%E6%B3%95%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a>morboとhypnotoadのプロセス起動方法の違い</h2>

<p><code>mojo generate app</code> もしくは <code>mojo generate lite-app</code> から作った場合、<code>script/</code> ディレクトリ以下に起動スクリプトが出来ているはずです。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="n">FindBin</span><span class="p">;</span>
<span class="k">BEGIN</span> <span class="p">{</span> <span class="nb">unshift</span> <span class="nv">@INC</span><span class="p">,</span> <span class="s">"$FindBin::Bin/../lib"</span> <span class="p">}</span>

<span class="c1"># Start command line interface for application</span>
<span class="nb">require</span> <span class="nn">Mojolicious::</span><span class="n">Commands</span><span class="p">;</span>
<span class="nn">Mojolicious::</span><span class="n">Commands</span><span class="o">-&gt;</span><span class="n">start_app</span><span class="p">(</span><span class="s">'YourApp::Web'</span><span class="p">);</span>
</pre></div></div>

<p><a href="/yusukebe" class="user-mention js-hovercard" title="yusukebe" data-hovercard-target-type="user" data-hovercard-target-name="yusukebe">@yusukebe</a> さん的に、コントローラーのために <strong>Web</strong> という名前空間のクッションを置いています。こういうふうにすることで、<code>YourApp::*</code> 直下の名前空間に、直接Mojolicious(ウェブ関連)とは関係なのないCLIツールであったりDB関連モジュールを置くことができます。</p>

<p>このスクリプトが <code>script/your_app</code> であるとして、開発時に morbo を使って起動すると以下のような出力がなされます。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ morbo script/your_app 
Server available at http://127.0.0.1:3000.
</pre></div></div>

<p>morboの詳細は<code>morbo help</code>などを参照してください。いたってシンプルです。</p>

<p>morbo は開発サーバなので、特に大規模アクセスを受ける必要のない単一のプロセスとなっています。</p>

<p><code>pstree</code>コマンドで見てみると以下のようになっています。 (<code>pstree</code>コマンドの実装によっても出力は多少変化します)</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span> <span class="p">|</span> <span class="p">|</span>-+<span class="o">=</span> <span class="m">00134</span> ogata /Applications/Utilities/Terminal.app/Contents/MacOS/Terminal -psn_0_40970
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>-+<span class="o">=</span> <span class="m">00213</span> root login -pf ogata
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="se">\-</span>+<span class="o">=</span> <span class="m">00217</span> ogata -bash
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>   <span class="se">\-</span>+<span class="o">=</span> <span class="m">33824</span> ogata perl /Users/ogata/perl5/perlbrew/perls/perl-5.18/bin/morbo script/your_app
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>     <span class="se">\-</span>-- <span class="m">33825</span> ogata /Users/ogata/perl5/perlbrew/perls/perl-5.18/bin/morbo  
</pre></div></div>

<p>起動したターミナルから1プロセスがぶら下がっているだけですね。</p>

<p>morboが便利なのは、起動しっぱなしでも起動後に更新されたモジュールがロードされるところなどでしょう(<code>plackup</code> の <code>-r</code> や <code>-R</code> オプションと同様)。</p>

<p>ただ、hypnotoad は標準で4プロセスを同時起動します。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ hypnotoad -f script/try_app 
Server available at http://127.0.0.1:8080.
</pre></div></div>

<p><code>-f</code> オプションを指定しないとバックグラウンドに回って、起動したターミナルのジョブではなくなってしまうので、とりあえずこの例では<code>-f</code>オプションをつけています。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="se">\-</span>+<span class="o">=</span> <span class="m">00217</span> ogata -bash
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>   <span class="se">\-</span>+<span class="o">=</span> <span class="m">33931</span> ogata /Users/ogata/your_app_script/your_app 
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span>--- <span class="m">33932</span> ogata /Users/ogata/your_app_script/your_app 
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span>--- <span class="m">33933</span> ogata /Users/ogata/your_app_script/your_app 
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span>--- <span class="m">33934</span> ogata /Users/ogata/your_app_script/your_app 
 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>     <span class="se">\-</span>-- <span class="m">33935</span> ogata /Users/ogata/your_app_script/your_app 
</pre></div></div>

<p>親プロセス1つに、子プロセス4つがぶら下がっている形になっています。Apacheなどでお馴染みのpreforkモデルですね。実際にHTTPの処理を行うのは子プロセスになります。</p>

<p>ただ、開発時に morbo の場合は1プロセスだったのが、商用環境時のhypnotoad ではpreforkの複数プロセスになることで、ハマるポイントが出てくるかもしれません。</p>

<p>秘匿なデータを入れられませんが、MojoliciousではCookieを少しだけ使いやすくした <code>$self-&gt;session()</code> が取り急ぎ使えるのと、大きなデータや秘匿なデータであればサーバ側にセッションストレージを持つはずなので、グローバル変数で抱えていたものがmorboからhypnotoadになってから意図しないことになったということはあまりないかと思いますが、複数人で開発しているとハマる可能性も出てくるかもしれません。アクセス数に応じてカウントアップをしているstate変数のようなものが便宜的に用いられてコード中に潜んでいるケースがあったりして、morboの場合は重複がなかったのに、hypnotoadでは1がたくさん出る、といった症状に見舞われることもあるかもしれません。</p>

<p>また、モデル側で同時接続数が限られているものについても注意が必要です。</p>

<p>Mojoliciousでは<a href="http://mojolicio.us/perldoc/Mojolicious/Guides/Cookbook#Event_loops" rel="nofollow noopener" target="_blank">イベントループ</a>の扱いも様々で、AnyEventを使ったりもできます。AnyEventは豊富なライブラリがたくさんあって多種多様なことができますが、同時並行的にモデル側(TwitterのAPIであるとか)にアクセスすると、morboの場合は顕著化しなかった複数の同時アクセスが生まれてしまうこともあり、同時アクセスに厳しいAPIがhypnotoadにすると挙動がおかしく見えるという場合もあります。</p>

<h2>
<span id="mojoliciousではmorboとhypnotoadを使ったほうがよい" class="fragment"></span><a href="#mojolicious%E3%81%A7%E3%81%AFmorbo%E3%81%A8hypnotoad%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%81%BB%E3%81%86%E3%81%8C%E3%82%88%E3%81%84"><i class="fa fa-link"></i></a>Mojoliciousではmorboとhypnotoadを使ったほうがよい？</h2>

<p><a href="/yusukebe" class="user-mention js-hovercard" title="yusukebe" data-hovercard-target-type="user" data-hovercard-target-name="yusukebe">@yusukebe</a>さんの記事だと <code>*.psgi</code> を作って <code>plackup</code> するという方法が解説されています。Mojoliciousは本当に色々なものが揃っているものの、サイトが巨大になってくると、Mojoliciousではやりづらいことが出てきても、Plackのエコシステム(Middlewareなど)でできたりするのは魅力的です。</p>

<p>Plack自体のインストールも<code>cpanm</code>コマンドで簡単にできる時代ですが、諸々の理由で環境に制約がある場合(受託納品型開発で依存モジュールが増えると苦労が増える場合など)には、Mojoliciousパッケージ単体で完結することは魅力的ではあります。</p>

<p><code>hypnotoad --help</code> をすると、簡素なことしかできないような印象を覚えますが、その場合は <code>Mojo::Server::Hypnotoad</code> を直接呼び出すスクリプトを書くなどしてパラメータの調整などが可能です。詳しくは <code>perldoc Mojo::Server::Hypnotoad</code> を参照ください。</p>

<hr>

<p>もうちょっと基本的な「Mojoliciousことはじめ」的な記事もほしいですね。余裕があればそう言うのも書いてみようと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>10</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/f373cb10412c68d046a1">Xcodeのコマンドラインツールを入れる (Xcode 5.0)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-25 02:36:17</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> <b>[Xcode]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Xcodeのコマンドラインツールを入れるのは、バージョンによって一緒に入っていたり、別途入れなきゃいけなくて大変だったりするのですが、Xcode 5.0 ではコマンドラインツールを導入するためのコマンドが用意されているようです。</p>

<p>今回確認したのは <strong>Xcode 5.0.2</strong> です。</p>

<p><a href="https://camo.qiitausercontent.com/5fb1092234a242f63d335b24a81ede532cc143a9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f383736302f64386163303465312d656363312d356265662d303264332d3937346561643464363437612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5fb1092234a242f63d335b24a81ede532cc143a9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f383736302f64386163303465312d656363312d356265662d303264332d3937346561643464363437612e706e67" alt="Xcode 5.0.2.png" title="Xcode 5.0.2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/8760/d8ac04e1-ecc1-5bef-02d3-974ead4d647a.png"></a></p>

<p>コマンドラインツールがまだ導入されていない場合、また前のバージョンのXcodeからバージョンアップをした場合、<code>xcode-select</code> というコマンドがあるので、おもむろに実行します。このコマンドは XCode そのものがインストールされてなくても Mavericks には存在しているようです。</p>

<p><a href="https://camo.qiitausercontent.com/aa48c9909bb4946969a4710c8ebd6722e3229f39/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f383736302f33633535353233342d663364652d633361632d633134622d6264373661616462393631322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/aa48c9909bb4946969a4710c8ebd6722e3229f39/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f383736302f33633535353233342d663364652d633361632d633134622d6264373661616462393631322e706e67" alt="xcode-select cli.png" title="xcode-select cli.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/8760/3c555234-f3de-c3ac-c14b-bd76aadb9612.png"></a></p>

<p>そうするとダイアログが表示されて、あとはそれに従っていくだけです。</p>

<p><a href="https://camo.qiitausercontent.com/89bf3fec3cb13e40566af1c8467031237c2cf22a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f383736302f32633634626164642d656430332d363935312d313634352d3730666530633362646563392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/89bf3fec3cb13e40566af1c8467031237c2cf22a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f383736302f32633634626164642d656430332d363935312d313634352d3730666530633362646563392e706e67" alt="xcode-select gui.png" title="xcode-select gui.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/8760/2c64badd-ed03-6951-1645-70fe0c3bdec9.png"></a></p>

<p>細かな認識違いなどあるかもしれませんが、とりあえずこの手順で Xcode 5.0.2 のもと、コマンドラインツールを手軽に入れることができました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/770875c04566489678a6">Windowsで特定のフォルダを開くコマンドやスキーム</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-26 02:10:02</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Windows]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>よく迷うのでメモとして書いておきます。</p>

<p>Windowsの深い場所にあったりするジャンプ構文というかスキームというか、そんな記法があります。</p>

<p>「ファイル名を指定して実行」もしくは「プログラムとファイルの検索」ボックスからこれらを入れると特定のフォルダを開いたりすることができます。Windows XPとWindows 7で試していますが、Windows 8以降でも使えるのではないかなと思います。</p>

<h2>
<span id="controlexe" class="fragment"></span><a href="#controlexe"><i class="fa fa-link"></i></a>control.exe</h2>

<p><code>control</code> コマンドの引数として以下のようなものを指定します。</p>

<table>
<thead>
<tr>
<th style="text-align: left">引数名</th>
<th style="text-align: left">開くフォルダなど</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">scannercamera</td>
<td style="text-align: left">スキャナとカメラ</td>
</tr>
<tr>
<td style="text-align: left">folders</td>
<td style="text-align: left">フォルダオプション</td>
</tr>
<tr>
<td style="text-align: left">netconnections</td>
<td style="text-align: left">ネットワーク接続の仮想フォルダ</td>
</tr>
<tr>
<td style="text-align: left">schedtasks</td>
<td style="text-align: left">タスクの仮想フォルダ</td>
</tr>
<tr>
<td style="text-align: left">admintools</td>
<td style="text-align: left">管理ツール</td>
</tr>
<tr>
<td style="text-align: left">fonts</td>
<td style="text-align: left">フォント</td>
</tr>
<tr>
<td style="text-align: left">printers</td>
<td style="text-align: left">プリンタ</td>
</tr>
<tr>
<td style="text-align: left">userpasswords2</td>
<td style="text-align: left">ユーザアカウント</td>
</tr>
<tr>
<td style="text-align: left">userpasswords</td>
<td style="text-align: left">ユーザアカウント旧来のやつ</td>
</tr>
<tr>
<td style="text-align: left">infrared</td>
<td style="text-align: left">赤外線 (あるばあいのみ)</td>
</tr>
<tr>
<td style="text-align: left">telephony</td>
<td style="text-align: left">所在地情報</td>
</tr>
<tr>
<td style="text-align: left">netware</td>
<td style="text-align: left">？</td>
</tr>
<tr>
<td style="text-align: left">keyboard</td>
<td style="text-align: left">キーボードのプロパティ</td>
</tr>
<tr>
<td style="text-align: left">mouse</td>
<td style="text-align: left">マウスのプロパティ</td>
</tr>
<tr>
<td style="text-align: left">international</td>
<td style="text-align: left">地域と言語のオプション</td>
</tr>
<tr>
<td style="text-align: left">ports</td>
<td style="text-align: left">システムのプロパティのコンピュータ名のタブにフォーカス</td>
</tr>
<tr>
<td style="text-align: left">date/time</td>
<td style="text-align: left">日付と時刻のプロパティ</td>
</tr>
<tr>
<td style="text-align: left">color</td>
<td style="text-align: left">画面のプロパティのスクリーンセーバにフォーカス</td>
</tr>
<tr>
<td style="text-align: left">desktop</td>
<td style="text-align: left">画面のプロパティのテーマタブにフォーカス</td>
</tr>
<tr>
<td style="text-align: left">panel</td>
<td style="text-align: left">コントロールパネルを開く</td>
</tr>
</tbody>
</table>

<p>その他、パスが通っているところにある <code>*.cpl</code> ファイルを渡すとコントロールパネルの対応するウィンドウがオープンするようです。</p>

<h2>
<span id="shellスキーム" class="fragment"></span><a href="#shell%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%A0"><i class="fa fa-link"></i></a>shellスキーム</h2>

<p>Windowsには<code>shell:</code>スキームというものがあり、URLのようにこれを上述のボックスに入れてEnterを押すことによってフォルダを開いたりすることができます。</p>

<table>
<thead>
<tr>
<th style="text-align: left">スキーム</th>
<th style="text-align: left">開くフォルダなど</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">shell:Administrative Tools</td>
<td style="text-align: left">現在ログオンしているユーザーの管理フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:AppData</td>
<td style="text-align: left">現在ログオンしているユーザーの ApplicationData フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Common Administrative Tools</td>
<td style="text-align: left">AllUsers の管理フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Common AppData</td>
<td style="text-align: left">AllUsers の ApplicationData フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Common Desktop</td>
<td style="text-align: left">現在ログオンしているユーザーのデスクトップ</td>
</tr>
<tr>
<td style="text-align: left">shell:Common Documents</td>
<td style="text-align: left">AllUsers の Documents フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Common Favorites</td>
<td style="text-align: left">AllUsers のお気に入りフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Common Programs</td>
<td style="text-align: left">AllUsers のプログラムフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Common Startup</td>
<td style="text-align: left">AllUsers のスタートアップフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Common Templates</td>
<td style="text-align: left">AllUsers の Templates フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:CommonProgramFiles</td>
<td style="text-align: left">
<code>%SystemDrive%\Program Files\Common Files</code> フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:ConnectionsFolder</td>
<td style="text-align: left">ネットワーク接続フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:ControlPanelFolder</td>
<td style="text-align: left">コントロールパネル</td>
</tr>
<tr>
<td style="text-align: left">shell:Cookies</td>
<td style="text-align: left">現在ログオンしているユーザーのクッキーフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:DesktopFolder</td>
<td style="text-align: left">現在ログオンしているユーザーのデスクトップ</td>
</tr>
<tr>
<td style="text-align: left">shell:DriveFolder</td>
<td style="text-align: left">マイコンピュータ</td>
</tr>
<tr>
<td style="text-align: left">shell:Favorites</td>
<td style="text-align: left">現在ログオンしているユーザーのお気に入りフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Fonts</td>
<td style="text-align: left">Fonts フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:History</td>
<td style="text-align: left">現在ログオンしているユーザーのヒストリーフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:InternetFolder</td>
<td style="text-align: left">IE 起動</td>
</tr>
<tr>
<td style="text-align: left">shell:Local AppData</td>
<td style="text-align: left">現在ログオンしているユーザーの <code>Local Settings\Application Data</code> フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:My Pictures</td>
<td style="text-align: left">現在ログオンしているユーザーのマイピクチャーフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:NetHood</td>
<td style="text-align: left">現在ログオンしているユーザーの NetHood フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:NetworkFolder</td>
<td style="text-align: left">マイネットワークフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Personal</td>
<td style="text-align: left">現在ログオンしているユーザーのマイドキュメントフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:PrintHood</td>
<td style="text-align: left">現在ログオンしているユーザーの PrintHood フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:PrintersFolder</td>
<td style="text-align: left">プリンタと FAX フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Profile</td>
<td style="text-align: left">現在ログオンしているユーザーのプロフィールフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:ProgramFiles</td>
<td style="text-align: left">プログラムフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Programs</td>
<td style="text-align: left">現在ログオンしているユーザーのプログラムフォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Recent</td>
<td style="text-align: left">現在ログオンしているユーザーの Recent フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:RecycleBinFolder</td>
<td style="text-align: left">「ごみ箱」フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:SendTo</td>
<td style="text-align: left">現在ログオンしているユーザーの SendTo フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:System</td>
<td style="text-align: left">System32 フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:SystemX86</td>
<td style="text-align: left">System32 フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Templates</td>
<td style="text-align: left">現在ログオンしているユーザーの Templates フォルダ</td>
</tr>
<tr>
<td style="text-align: left">shell:Windows</td>
<td style="text-align: left">
<code>%SystemDrive%\WinNT</code> フォルダ</td>
</tr>
</tbody>
</table>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>6</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/c903bd0e05787cd54ba0">Qiitaのインライン数式記法をエスケープする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-02 14:00:42</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> <b>[TeX]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://blog.qiita.com/post/76297476951/beautiful-formula-with-tex" rel="nofollow noopener" target="_blank">Qiitaでは数式が書ける</a>のですが、インライン数式モードが意図しないところで発動しておかしな表示になってしまうことがあります。</p>

<p><a href="http://qiita.com/xtetsuji/items/9939143a7619956997e1" id="reference-3c85b3f5fd6fa60ce8a5">Perlの正規表現の一行モード(/s)と複数行モード(/m)の覚え方 - Qiita</a> より。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>複数行モードで ^ や $ は文字列の冒頭末尾以外にも、改行の前後にもマッチするようになりました。「複数行モード」で以前の ^ や $ の意味を表したい場合に使われるのが \A \Z そして \z です。
</pre></div></div>

<p>一行に <code>$</code> が一つであれば大丈夫なようですが、二つ以上あると、その間がインライン数式モードになってしまいます。この場合、<code>^</code> が上付き文字として解釈されてしまい、表示がおかしくなります。</p>

<p>これをエスケープする場合は、単純にバックスラッシュ <code>\</code> を使えば良いようです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>複数行モードで ^ や \$ は文字列の冒頭末尾以外にも、改行の前後にもマッチするようになりました。「複数行モード」で以前の ^ や \$ の意味を表したい場合に使われるのが \A \Z そして \z です。
</pre></div></div>

<p><code>$</code> はエスケープ対象となり、バックスラッシュが無くなり、インライン数式モードの開始・終了といった意味を <code>$</code> は失います。また、特殊な意味を持たないアルファベットなどの前のバックスラッシュは、特に何もせず通常のバックスラッシュ文字として表示されます。</p>

<p>Qiitaの数式の仕組みは、たぶん<a href="http://www.mathjax.org/" rel="nofollow noopener" target="_blank">MathJax</a>を使って実現していると思うので、細かい挙動などを知りたい場合はその辺りを調べてみるとよさそうです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/94a1b2a5738fa3b541ae">Mojoliciousでわからない事があったらどこで聞けばいい？</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-23 09:06:37</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Perl]</b> <b>[Mojolicious]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>日本語リソースも充実しつつあるMojolicious。国内でもそうですが、世界的にもユーザ数が多いサービスではありますが、なかなか具体的な活用事例が出てきていない感じもします。</p>

<p>潜在的にMojoliciousの国内ユーザは多いと思うのですが、では困ったときにどこで聞けばいいのか、よくわからないユーザが多いと思いますので、私が知っている場所をいくつかご紹介します。</p>

<p>なお、私自身も英語が苦手なので、ここでは日本語で質問が出来る場所に限定しています。</p>

<h2>
<span id="各地のperl-mongerの集まり地域pm" class="fragment"></span><a href="#%E5%90%84%E5%9C%B0%E3%81%AEperl-monger%E3%81%AE%E9%9B%86%E3%81%BE%E3%82%8A%E5%9C%B0%E5%9F%9Fpm"><i class="fa fa-link"></i></a>各地のPerl Mongerの集まり「地域.pm」</h2>

<p>Hachioji.pm などの Perl Monger の集まりに参加すると、その中に一人くらいはMojoliciousユーザがいることでしょう。そういう人に質問をぶつけてみると良いでしょう。 <strong>顔と顔を付き合わせて聴くことが出来る生の声は一番です。</strong></p>

<p>主だった地域.pmを列挙しておきます。お近くの地域.pmに足を運んでみると相談相手が見つかるかもしれませんよ。</p>

<ul>
<li>Hokkaido.pm</li>
<li>Sendai.pm</li>
<li>Niigata.pm</li>
<li>Shibuya.pm</li>
<li>Chiba.pm</li>
<li>Yokohama.pm</li>
<li>Kamakura.pm</li>
<li>Hachioji.pm</li>
<li>Machida.pm</li>
<li>Mishima.pm</li>
<li>Nagoya.pm</li>
<li>Kansai.pm</li>
<li>Namba.pm</li>
<li>Kyoto.pm</li>
<li>Fukuoka.pm</li>
<li>Yomitan.pm</li>
</ul>

<h2>
<span id="perl入学式" class="fragment"></span><a href="#perl%E5%85%A5%E5%AD%A6%E5%BC%8F"><i class="fa fa-link"></i></a>Perl入学式</h2>

<p><a href="http://www.perl-entrance.org" rel="nofollow noopener" target="_blank">Perl入学式</a>という勉強会では、現在のカリキュラムの最後にMojoliciousで簡単なウェブサービスを作るという科目があります。これに出てみることで、Mojoliciousの基礎の基礎が分かります。</p>

<p>また直接カリキュラムに関係ないMojoliciousのアドバンスドな質問も、その時にMojoliciousに詳しいサポーターがいれば答えてくれたり一緒に考えてくれるかもしれません。</p>

<h2>
<span id="mojolicious日本語メーリングリスト" class="fragment"></span><a href="#mojolicious%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%A1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0%E3%83%AA%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>Mojolicious日本語メーリングリスト</h2>

<ul>
<li><a href="https://groups.google.com/forum/#!forum/mojolicious_ja" class="autolink" rel="nofollow noopener" target="_blank">https://groups.google.com/forum/#!forum/mojolicious_ja</a></li>
</ul>

<p>Googleグループを使ったメーリングリスト。</p>

<p>2013年12月現在、作成当時の投稿がいくつかあるだけで活発ではないようです。ただ、投稿してみると返事が返ってくるかもしれません。</p>

<h2>
<span id="irc-freenode-の-mojolicious-ja-チャンネル" class="fragment"></span><a href="#irc-freenode-%E3%81%AE-mojolicious-ja-%E3%83%81%E3%83%A3%E3%83%B3%E3%83%8D%E3%83%AB"><i class="fa fa-link"></i></a>IRC Freenode の #mojolicious-ja チャンネル</h2>

<p>Freenode には #mojolicious-ja というチャンネルがあります。時々著名な方々によって発言が行われているようです。</p>

<p>IRC や Freenode についての説明は割愛します。適宜検索してみてください。</p>

<p>チャンネルの文字コードはUTF-8です。</p>

<h2>
<span id="lingrのチャンネルmojoliciousの話題を日本語で" class="fragment"></span><a href="#lingr%E3%81%AE%E3%83%81%E3%83%A3%E3%83%B3%E3%83%8D%E3%83%ABmojolicious%E3%81%AE%E8%A9%B1%E9%A1%8C%E3%82%92%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%81%A7"><i class="fa fa-link"></i></a>Lingrのチャンネル「Mojoliciousの話題を日本語で」</h2>

<ul>
<li><a href="http://lingr.com/signup?letmein=mojo_jp" class="autolink" rel="nofollow noopener" target="_blank">http://lingr.com/signup?letmein=mojo_jp</a></li>
<li><a href="http://lingr.com/room/mojo_jp" class="autolink" rel="nofollow noopener" target="_blank">http://lingr.com/room/mojo_jp</a></li>
</ul>

<p>以前五反田で行われた<a href="http://atnd.org/events/43807" rel="nofollow noopener" target="_blank">Mojoliciousやmod_perlを話題にした飲み会 #2</a>で作成されました。同じLingrにある<a href="http://lingr.com/room/perl_jp" rel="nofollow noopener" target="_blank">「Perlの話題を日本語で」</a>の真似。</p>

<p>Lingrへの登録が必要ですがそれほど手間ではなく、IRCよりもハードルが低いのではないかと思います。現在はそれほどメンバー数も多くなく、気軽に質問できる場所といえるでしょう。少なくとも私は常にウォッチするようにしています。</p>

<hr>

<p>その他にも思いついたら追記していきます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/ec53b882e98a83d02a1e">Mojoliciousアプリをmod_perlでデプロイする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-09 22:51:34</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Perl]</b> <b>[Mojolicious]</b> <b>[mod_perl]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="mod_perlってまだいけるの" class="fragment"></span><a href="#mod_perl%E3%81%A3%E3%81%A6%E3%81%BE%E3%81%A0%E3%81%84%E3%81%91%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>mod_perlってまだいけるの？</h2>

<p>PlackベースのStarmanやStarlet、そしてMonocerosなどの優秀なウェブサーバ全盛時代、そしてApacheよりもNginxのほうが流行な昨今、Apache mod_perlが良い場合ってあるの？と聞かれることがあります。</p>

<ul>
<li>mod_perl は今も開発が進められている</li>
<li>とても安定している</li>
<li>Apacheのノウハウがある技術者がそのノウハウを活用できる</li>
<li>リバースプロキシをしたりしない分、 <strong>ミドルウェアとして起動されるデーモンが一種類減ることになり、ある種の案件では喜ばれる</strong> 場合がある</li>
</ul>

<h2>
<span id="mod_perl環境でmojoliciousアプリをデプロイする" class="fragment"></span><a href="#mod_perl%E7%92%B0%E5%A2%83%E3%81%A7mojolicious%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>mod_perl環境でMojoliciousアプリをデプロイする</h2>

<p>これは簡単な話で、MojoliciousはPSGI環境に対応しているので、<code>Plack::Handler::Apache2</code> でデプロイしてやると良いです。</p>

<p>今回は Apache2.x と mod_perl2 のみの話です。v1も同じような感じですが、あまり Apache1.3 と mod_perl1 での Plack の活用事例がないので、逆に枯れていないのではないかという欠点もあります。</p>

<p>Apacheの設定ファイルに以下のように、Mojoliciousの設定ファルを指定してやるだけです。まさにplackup感覚。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>  &lt;Location /&gt;
  SetHandler perl-script
  PerlResponseHandler Plack::Handler::Apache2
  PerlSetVar psgi_app /path/to/app.psgi
  &lt;/Location&gt;
</pre></div></div>

<p><code>app.psgi</code> の作り方は、Mojoliciousアドベントカレンダー1日目の<a href="http://qiita.com/yusukebe/items/c9fb34096e61976f062f" id="reference-8b7ae7dff42df15679e0">Mojoliciousの様々な立ち上げ方</a>を参照ください。</p>

<p>拙作ですが<a href="https://github.com/xtetsuji/p5-ModPerl-PSGI/" rel="nofollow noopener" target="_blank">ModPerl::PSGI</a> というものもあり、これはPlackとは違うApache mod_perl上のPSGI実装となっています。設定も上記とほぼ同様に可能となっております。</p>

<p>私の手元ではテストが足りていないのですが、フルスタックで全てを搭載したMojoliciousではModPerl::PSGIが作るPSGI環境でも使えると考えています。Plackが依存するモジュールの多さがネックとなる特集な案件や環境では、Perl5.8コアとmod_perl2コアのみにしか依存を持たないModPerl::PSGIの採用を検討してみるとよいかもしれません。質問などありましたらTwitter @<a href="https://twitter.com/xtetsuji" rel="nofollow noopener" target="_blank">xtetsuji</a> などでお知らせください。</p>

<h2>
<span id="mod_perl環境のmojoliciousアプリの注意点" class="fragment"></span><a href="#mod_perl%E7%92%B0%E5%A2%83%E3%81%AEmojolicious%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>mod_perl環境のMojoliciousアプリの注意点</h2>

<p>Apache の prefork MPM を使っている場合、Mojoliciousのhypnotoadとは違って、1プロセスは同時に1リクエストしか同時に処理することができません。なのでApacheの設定である<code>MaxSpareServers</code>などの設定値を適切に設定する必要があります。</p>

<h2>
<span id="プロセスが肥大化する場合の対策法" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8C%E8%82%A5%E5%A4%A7%E5%8C%96%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E5%AF%BE%E7%AD%96%E6%B3%95"><i class="fa fa-link"></i></a>プロセスが肥大化する場合の対策法</h2>

<p>巨大なファイルを扱ったりしたあとの場合、解放されないメモリがあったり、mod_perlと一体となっているApacheのpreforkした子プロセスのメモリが肥大化してサーバのメモリを食いつぶしたりする場合があります。</p>

<p>常套手段ではありますが一つの対策として、Apacheの<code>MaxRequestsPerChild</code>に最大リクエスト処理数を設定する方法があります。たくさんのリクエストを処理すればするほどプロセスサイズが肥大化しているだろうという仮定によります。</p>

<p>その他にmod_perl2に標準付属している<code>Apache2::SizeLimit</code>を使う手があります。Apacheのpreforkされた子プロセスがリクエスト処理ごとに、自らのサイズを計って規定以上の大きさの場合は自分自身のプロセスを終了します(child terminate)。Apacheの親プロセスは、子プロセスが足りなくなれば新しい子プロセスを充当します。詳細は<code>Apache2::SizeLimit</code>のperldocを参照ください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/f738bdddd3ab8f7d7329">Xcodeのコマンドラインツールを入れる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-17 11:19:59</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>この情報は古くなっています。Mavericks以上の環境では<a href="http://qiita.com/xtetsuji/items/f373cb10412c68d046a1" id="reference-39af7bab04fcc1eb61ee">Mac - Xcodeのコマンドラインツールを入れる (Xcode 5.0) - Qiita</a>を参考にしてください。</p>

<h1>
<span id="xcode43からの変更" class="fragment"></span><a href="#xcode43%E3%81%8B%E3%82%89%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>Xcode4.3からの変更</h1>

<p>Xcode4.2からバージョンアップしたら、以前導入したコマンドラインツールが使えなくなったのでメモ。</p>

<p>情報は<strong>Xcode4.5.2</strong>が最新バージョンの<strong>2012年11月現在</strong>です。</p>

<p>参考URL:</p>

<ul>
<li><a href="http://mkdir.g.hatena.ne.jp/ymrl/20120226/1330222634" rel="nofollow noopener" target="_blank">Xcode 4.3はコマンドラインツールが別に配布されるようになったらしい - 作業ログとかをメモする場所。 - mkdirグループ</a></li>
</ul>

<p>Xcode4.2以前はコマンドラインツールが同梱されていて、"/Developer" 以下にそれらが入っていたが、Xcode4.3以降はXcode本体にコマンドラインツールが同梱されなくなり、別途導入する必要がある。</p>

<p>Xcode4.2をアンインストールすると、"/Developer" は "/Developer-old" に名前を変えて避けられていることが分かる(アンインストール時の質問への回答によっても変わるかも)。"Developer-old" は 20MB 程度だった。</p>

<p>上記URLでは、実はXcode4.3以上にもコマンドラインツールは "/Application/Xcode.app/Contents/Developer/usr/bin" 以下に同梱されているが、別途 "Command Line Tools for Xcode" の導入を勧めているのでそうすることにする。</p>

<p>ちなみに、コマンドラインツールはディスクの肥やしになっているかといえば、そうでもない。</p>

<blockquote>
<p>$ du -sh /Applications/Xcode.app/Contents/Developer/usr/bin/<br>
7.9M  /Applications/Xcode.app/Contents/Developer/usr/bin/</p>
</blockquote>

<h1>
<span id="導入" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>導入</h1>

<p>というわけで <a href="https://developer.apple.com/downloads/index.action" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/downloads/index.action</a> から "Command Line Tools for Xcode" をダウンロードする。2012年11月更新の Mountain Lion 向けの *.dmg は110MBだった。</p>

<p>後は</p>

<ol>
<li>ダウンロードしたディスクイメージをマウント</li>
<li>パッケージファイルをクリックしてインストーラ起動</li>
<li>インストールを進める</li>
<li>インストールを完了</li>
</ol>

<p>という流れになる。</p>

<p><a href="https://camo.qiitausercontent.com/2448795b943c234aa1cbb35602928ba455a90a1c/687474703a2f2f6d656469612d63616368652d6c74302e70696e7465726573742e636f6d2f75706c6f61642f3139313437333432313632383836373039375f4d4b6a78664977642e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2448795b943c234aa1cbb35602928ba455a90a1c/687474703a2f2f6d656469612d63616368652d6c74302e70696e7465726573742e636f6d2f75706c6f61642f3139313437333432313632383836373039375f4d4b6a78664977642e6a7067" alt="Sing in with your Apple ID" data-canonical-src="http://media-cache-lt0.pinterest.com/upload/191473421628867097_MKjxfIwd.jpg"></a></p>

<p><a href="https://camo.qiitausercontent.com/cfcb95df9929ce83298058a22b34c45ec0a4f7cd/687474703a2f2f6d656469612d63616368652d6563352e70696e7465726573742e636f6d2f75706c6f61642f3139313437333432313632383836373039395f44776630415475422e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/cfcb95df9929ce83298058a22b34c45ec0a4f7cd/687474703a2f2f6d656469612d63616368652d6563352e70696e7465726573742e636f6d2f75706c6f61642f3139313437333432313632383836373039395f44776630415475422e6a7067" alt="Command Line Tools (OS X Mountain Lion) for Xcode." data-canonical-src="http://media-cache-ec5.pinterest.com/upload/191473421628867099_Dwf0ATuB.jpg"></a></p>

<p><a href="https://camo.qiitausercontent.com/05cba1fe0b7ba70962bc6ab92d9ba1ef25786c40/687474703a2f2f6d656469612d63616368652d6563362e70696e7465726573742e636f6d2f75706c6f61642f3139313437333432313632383836373130365f39764478326f78522e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/05cba1fe0b7ba70962bc6ab92d9ba1ef25786c40/687474703a2f2f6d656469612d63616368652d6563362e70696e7465726573742e636f6d2f75706c6f61642f3139313437333432313632383836373130365f39764478326f78522e6a7067" alt="Command Line Tools (Mountain Lion) のインストール 1." data-canonical-src="http://media-cache-ec6.pinterest.com/upload/191473421628867106_9vDx2oxR.jpg"></a></p>

<p><a href="https://camo.qiitausercontent.com/9e9afc6ac5392b1ba02e01d0d11fdbf79799c563/687474703a2f2f6d656469612d63616368652d6c74302e70696e7465726573742e636f6d2f75706c6f61642f3139313437333432313632383836373130395f534471365a6245512e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9e9afc6ac5392b1ba02e01d0d11fdbf79799c563/687474703a2f2f6d656469612d63616368652d6c74302e70696e7465726573742e636f6d2f75706c6f61642f3139313437333432313632383836373130395f534471365a6245512e6a7067" alt="Command Line Tools (Mountain Lion) のインストール 4." data-canonical-src="http://media-cache-lt0.pinterest.com/upload/191473421628867109_SDq6ZbEQ.jpg"></a></p>

<p>これで make や gcc 等のコマンドが使えるようになった</p>

<blockquote>
<p>$ type make <br>
make is hashed (/usr/bin/make)<br>
$ type gcc<br>
gcc is /usr/bin/gcc</p>
</blockquote>

<p>ちゃんと "/usr/bin" 以下に入っている。</p>

<p>以前("/Developer/usr/bin" 以下に入っていたとき)とは違い、"/usr/bin" 以下に入っていることが分かる。通常の $PATH であればここにパスは通っているはずなので、そのまま使い始めることができる。</p>

<p>最後にダウンロードしてマウントしたディスクイメージをアンマウントするのを忘れずに。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/18e2ecbdf3c92e3f3e21">Perlの&quot;bad interpreter&quot;エラー</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-11 16:00:30</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Perl]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>コマンドラインやCGIなどのPerlプログラムで<strong>bad interpreter</strong>というエラーが出て実行できない時がある。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cat crlf.pl
#!/usr/bin/perl        use strict;    use warnings;        print "Hello\n";

$ ./crlf.pl
-bash: ./crlf.pl: /usr/bin/perl^M: bad interpreter: No such file or directory
</pre></div></div>

<p>これは<strong>大抵改行コードの問題</strong>。</p>

<p>Perlインタープリターに明示的にファイル名を与えると特に問題がない。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ perl crlf.pl 
Hello
</pre></div></div>

<p>なので、ネット上ではPerlインタープリターに明示的に渡せないCGIで困っているケースが散見される。</p>

<p>"./script" などと「直接実行」した場合、まず実行しているOS環境(Linuxとか*BSDとか)が、それがスクリプトファイルなのか直接実行形式ファイルなのかを判別するが、前者の場合は1行目のshebang行が頼りになる。</p>

<p>ただ、Linuxなどの環境で改行コードとしてCR+LFを想定していない場合、shebang行がエディタでの見かけ上 #!/usr/bin/perl などとなっていても、それがCR+LF改行コードの場合には、LFが改行コードのOSにとってshebang行は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#!/usr/bin/perl&lt;CR&gt;
</pre></div></div>

<p>となってしまい「"/usr/bin/perl&lt;CR&gt;" なんて存在しない」と言われることになる。これが bad interpreter の意味。</p>

<p>解決方法は<strong>エディタで改行コードをLFに変更する</strong>こと。</p>

<p>一番上の実行例では"^M"としてCRが可視化されているから分かりやすいものの、可視化されない環境もある。</p>

<hr>

<p>ネットでは「shebang行を #!/usr/bin/perl から #!/usr/bin/perl -w に変更すれば動く」という「解決法」も紹介されているが、たまたまperlが -&lt;CR&gt; というオプションを無視するから上手くいくだけで、これはバッドノウハウでしかない。モダンなPerlプログラムはshebang行の -w で warnings を有効にするのではなく、warnings プラグマで有効にする (use warnings; する) ほうが一般的。</p>

<p>「改行コードをLFに変換したらWindowsのメモ帳で改行が無くなった」というクレームに対しては、HTMLならまだしも「通常UNIX系OSで実行されるスクリプトファイルの改行コードはLFなのだから対応するエディタを導入してください」という回答が最適だろう。そういったエディタはフリーソフトで大量に存在する。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>xtetsujiさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/xtetsuji/items/aa667e2e48260cce8c28">CentOSとmod_perlの未来</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-18 20:32:05</center>
	</td>
	<td style="width:200px;">
		@xtetsuji<br />(Gaiax Co.Ltd. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/8760/profile-images/1473681145">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Perl]</b> <b>[CentOS]</b> <b>[mod_perl]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>こんにちは、mod_perlをこよなく愛用している @<a href="https://twitter.com/xtetsuji" rel="nofollow noopener" target="_blank">xtetsuji</a> です。</p>

<p>みなさん、mod_perl使っていますか？Plack全盛の時代でも、まだレガシープロジェクトであったり、色々な理由でmod_perlを使い続けている方、結構いるんじゃないかと思っています。</p>

<p>「新しいものが良くて古いものが悪い」という考えは置いといて、mod_perlはとてもよく枯れていて実装も一つで安定したPerlの永続的実行環境の一つです。Plackやそれらのエコシステムを使えない現場では今も有力な選択肢の一つではないでしょうか。使用の際に極度にmod_perlにロックオンされないように設計すれば、中長期的な視野も入れた良いアプリケーションがかけると思います。</p>

<h2>
<span id="rhel7ベータ発表" class="fragment"></span><a href="#rhel7%E3%83%99%E3%83%BC%E3%82%BF%E7%99%BA%E8%A1%A8"><i class="fa fa-link"></i></a>RHEL7ベータ発表</h2>

<p>この記事を書いているのは2013年12月ですが、去る2013年12月11日にRHEL7のベータ版が登場しました。</p>

<ul>
<li><a href="http://news.mynavi.jp/news/2013/12/13/064/" rel="nofollow noopener" target="_blank">RHEL 7、ベータ登場 | マイナビニュース</a></li>
</ul>

<p>ネットの情報によると <strong>RHEL7ベータはmod_perl2のパッケージをコアから外した</strong> ようです。</p>

<ul>
<li><a href="https://huntingbears.nl/2013/12/17/no-mod_perl-in-rhel-7-and-centos-7/" rel="nofollow noopener" target="_blank">No mod_perl in RHEL 7 and CentOS 7 | Michiel Beijen</a></li>
</ul>

<p>その理由は「mod_perl2がApache2.4に対応していないから」だそう。要するにRHEL7でApache2.4を採用することに決めたことで、それに対応していないmod_perl2のパッケージが必然的に無くなることになるということらしいです。</p>

<p>mod_perl2がApache2.4に現状(2013年12月現在)対応していないのは、主にWindows上のApache2.4での対応に苦慮していることが原因のようです。これは Old Nabble というフォーラムで度々議論されていたのですが、その Old Nabble のサイト自体が無くなってしまい、今ではその議論を追うことができません。mod_perlのSubversionリポジトリのhttp24ブランチが現状を理解できる数少ない場所です。</p>

<h2>
<span id="今後登場するcentos7でもmod_perl削除の動きか" class="fragment"></span><a href="#%E4%BB%8A%E5%BE%8C%E7%99%BB%E5%A0%B4%E3%81%99%E3%82%8Bcentos7%E3%81%A7%E3%82%82mod_perl%E5%89%8A%E9%99%A4%E3%81%AE%E5%8B%95%E3%81%8D%E3%81%8B"><i class="fa fa-link"></i></a>今後登場するCentOS7でもmod_perl削除の動きか？</h2>

<p>RHEL7でmod_perl2のパッケージが削除されれば、それの写像といってもよいCentOS7でもmod_perl2のパッケージが削除されることが避けられないでしょう。</p>

<p>よく「システムPerlはスレッドを有効にしてコンパイルしてあるから、まずPerl、そしてApacheとmod_perlも自前でコンパイルする」という人がいますが、そういう人は大丈夫でしょう。ただ、そういったシステムPerlとはいえ、スレッドを有効にコンパイルしたことによって、ウェブの実行環境としてパフォーマンスに如実に影響を与えるかといったら、よほどの大規模サイトでない限り有意な差はないように思えます。</p>

<p>制限された案件では、ディストリビューションのコアにあるパッケージのみしか使えないという場合もありえます。今までユーザ人口の多いCentOSの新しいバージョンでmod_perlが削除されることの影響は皆無ではないでしょう。</p>

<h2>
<span id="もとからあるredhat系ディストリビューションのmod_perl問題" class="fragment"></span><a href="#%E3%82%82%E3%81%A8%E3%81%8B%E3%82%89%E3%81%82%E3%82%8Bredhat%E7%B3%BB%E3%83%87%E3%82%A3%E3%82%B9%E3%83%88%E3%83%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AEmod_perl%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>もとからあるRedHat系ディストリビューションのmod_perl問題</h2>

<p>RHELとCentOSが写像の関係であるという前提のもとでCentOSに焦点を絞ってお話ししますが、CentOSの特定のバージョンでは「mod_perl1.99」と呼ばれる、当時はmod_perl2betaであったものの、結果的にmod_perl1とmod_perl2のキメラのような、今では使ってはいけないAPIとなってしまったものを採用してしまったバージョンもあります。バージョンは失念してしまいましたが、<code>rpm</code> コマンドなどで分かるかと思います。</p>

<p>ともかく、RHELが採用するミドルウェアのバージョンは、落とし穴となるものが結構あるようなので要注意です。もちろん「全部自分でコンパイルして入れる」という人には無関係な話かもしれません。</p>

<h2>
<span id="今後のmod_perlについて" class="fragment"></span><a href="#%E4%BB%8A%E5%BE%8C%E3%81%AEmod_perl%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>今後のmod_perlについて</h2>

<p>RHELのような動きが他のディストリビューションで出てこないとは言えません。Old Nabbleのフォーラムでは「いつまでもWindows対応のおかげでLinuxのApache2.4でmod_perlが使えないのはオカシイ！Windows対応を切り捨てたApache2.4対応mod_perlを出すべきだ」という意見もあり、それへの賛同も結構ありました。Linux等のPOSIX系OSで動作する用意はできているようです。mod_perlのアップストリームの動向を観察する他ないでしょう。</p>

<p>ただ、世間のLinuxディストリビューションはPerlだけに関心があるわけではなく、最新を追っていくためにApache2.4を取り入れていくことは自然なことでしょう。その際、同様の理由でmod_perlが切り捨てられていくのか、それともmod_perlがApache2.4に「Windows環境でも完全に」サポートされリリースされて円満解決するのか、はたまたWindowsサポートを切り捨てたApache2.4対応mod_perlが出てくるのか、にわかに判断がつかない状況です。</p>

<p>ちなみに2013年12月時点、Subversionのmod_perl http24ブランチに最後にコミットがあったのは10月末です。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
