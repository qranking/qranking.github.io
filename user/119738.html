<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (akimach)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (akimach さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />1位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>191</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/af3ba7841bcb789b75a5">イマドキWebフロントエンド環境とReactを触りながらサンプルを10本書いてみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-10 21:36:13</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[HTML]</b> <b>[jQuery]</b> <b>[reactjs]</b> <b>[React]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>Webフロントエンドの知識がjQueryで知識が止まっていたので、モダンなWebフロントエンドに触れてみた。そのメモ。</p>

<h2>
<span id="良かった点" class="fragment"></span><a href="#%E8%89%AF%E3%81%8B%E3%81%A3%E3%81%9F%E7%82%B9"><i class="fa fa-link"></i></a>良かった点</h2>

<p>「今はこうなっているのかー」と分かった。今後はナウい記事を読んでもビビらないと思う。</p>

<h2>
<span id="reactのすごさ" class="fragment"></span><a href="#react%E3%81%AE%E3%81%99%E3%81%94%E3%81%95"><i class="fa fa-link"></i></a>Reactのすごさ</h2>

<p>触ってみて下の記事のいうことが理解できた。何がすごいの？と聞かれたら下の記事を掻い摘んで説明したい。</p>

<ul>
<li><a href="https://qiita.com/naruto/items/fdb61bc743395f8d8faf" id="reference-1639608b82c5a5a9afbc">Reactを使うとなぜjQueryが要らなくなるのか</a></li>
</ul>

<h2>
<span id="触ってみたもの" class="fragment"></span><a href="#%E8%A7%A6%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>触ってみたもの</h2>

<ul>
<li>ES6</li>
<li>Yarn</li>
<li>Webpack</li>
<li>Babel</li>
<li>Sass/SCSS</li>
<li>React</li>
</ul>

<p>とりあえずエディタ開いてHTMLを書くぞというタイプの人間だったので、フロントエンド開発にまずはコマンドラインを打って環境を構築する点が新鮮。自動化できるところはツールで共通化してラクできるところはラクをする、というのは分かった。Reactは使うか分からないが、Webpack/Babel/SCSSは絶対に使うと思う。</p>

<h2>
<span id="作ってみたもの" class="fragment"></span><a href="#%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>作ってみたもの</h2>

<p>以下サンプル。いくつかはドキュメントをそのまま写経したものがある。</p>

<h3>
<span id="github-repo" class="fragment"></span><a href="#github-repo"><i class="fa fa-link"></i></a>Github repo</h3>

<ul>
<li><a href="https://github.com/akimach/react-remix-10" rel="nofollow noopener" target="_blank">akimach/react-remix-10</a></li>
</ul>

<h3>
<span id="01-hello" class="fragment"></span><a href="#01-hello"><i class="fa fa-link"></i></a>01 Hello</h3>

<p><a href="https://camo.qiitausercontent.com/2941457007711bfd3fccddb406745653fe1fcc33/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363535392d37393230323330342d633633302d313165372d393035632d3461646466323265396565612e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2941457007711bfd3fccddb406745653fe1fcc33/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363535392d37393230323330342d633633302d313165372d393035632d3461646466323265396565612e6a7067" alt="01" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646559-79202304-c630-11e7-905c-4addf22e9eea.jpg"></a></p>

<h3>
<span id="02-router" class="fragment"></span><a href="#02-router"><i class="fa fa-link"></i></a>02 Router</h3>

<p>react router</p>

<p><a href="https://reacttraining.com/react-router/web/guides/" class="autolink" rel="nofollow noopener" target="_blank">https://reacttraining.com/react-router/web/guides/</a> のサンプル</p>

<p><a href="https://camo.qiitausercontent.com/18124e3e05153eefad6cd40541bb0356fa591a97/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536302d37393830613133652d633633302d313165372d393032352d3730353232323533623730332e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/18124e3e05153eefad6cd40541bb0356fa591a97/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536302d37393830613133652d633633302d313165372d393032352d3730353232323533623730332e6a7067" alt="02" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646560-7980a13e-c630-11e7-9025-70522253b703.jpg"></a></p>

<h3>
<span id="03-material-ui" class="fragment"></span><a href="#03-material-ui"><i class="fa fa-link"></i></a>03 Material-UI</h3>

<p>material ui </p>

<p><a href="https://camo.qiitausercontent.com/b0a6adbe2f92a40b8e2dd8531271b119b90693d2/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536312d37396362663739632d633633302d313165372d393436342d3839383164313561643631632e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b0a6adbe2f92a40b8e2dd8531271b119b90693d2/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536312d37396362663739632d633633302d313165372d393436342d3839383164313561643631632e6a7067" alt="03" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646561-79cbf79c-c630-11e7-9464-8981d15ad61c.jpg"></a></p>

<h3>
<span id="04-chart" class="fragment"></span><a href="#04-chart"><i class="fa fa-link"></i></a>04 Chart</h3>

<p>react chartjs 2</p>

<p><a href="https://camo.qiitausercontent.com/3934f2ad6289872c2efcfb05c3a278d7cf4a4313/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536332d37613562663039612d633633302d313165372d386233612d3265656335326530626436392e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3934f2ad6289872c2efcfb05c3a278d7cf4a4313/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536332d37613562663039612d633633302d313165372d386233612d3265656335326530626436392e6a7067" alt="04" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646563-7a5bf09a-c630-11e7-8b3a-2eec52e0bd69.jpg"></a></p>

<h3>
<span id="05-todo-list" class="fragment"></span><a href="#05-todo-list"><i class="fa fa-link"></i></a>05 Todo List</h3>

<p><a href="https://camo.qiitausercontent.com/205d573dd44f956d7aa19e97e5825f828771bbf5/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536342d37613935383863382d633633302d313165372d383734362d6462656632666261363437302e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/205d573dd44f956d7aa19e97e5825f828771bbf5/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536342d37613935383863382d633633302d313165372d383734362d6462656632666261363437302e6a7067" alt="05" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646564-7a9588c8-c630-11e7-8746-dbef2fba6470.jpg"></a></p>

<h3>
<span id="06-editor" class="fragment"></span><a href="#06-editor"><i class="fa fa-link"></i></a>06 Editor</h3>

<p>Markd</p>

<p><a href="https://camo.qiitausercontent.com/8c6aba81453f8d11c98ac7a1a1bd9b6cc8aef0bd/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363832372d64653534656232382d633633312d313165372d386230372d3732303638303230306236342e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8c6aba81453f8d11c98ac7a1a1bd9b6cc8aef0bd/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363832372d64653534656232382d633633312d313165372d386230372d3732303638303230306236342e6a7067" alt="06" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646827-de54eb28-c631-11e7-8b07-720680200b64.jpg"></a></p>

<h3>
<span id="07-form" class="fragment"></span><a href="#07-form"><i class="fa fa-link"></i></a>07 Form</h3>

<p><a href="https://camo.qiitausercontent.com/66ffe6b6cda245b753e4de2d3cb3a9ea28d43c51/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536352d37616537343230382d633633302d313165372d393434372d3037346664616336323863312e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/66ffe6b6cda245b753e4de2d3cb3a9ea28d43c51/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536352d37616537343230382d633633302d313165372d393434372d3037346664616336323863312e6a7067" alt="07" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646565-7ae74208-c630-11e7-9447-074fdac628c1.jpg"></a></p>

<h3>
<span id="08-hacker-news" class="fragment"></span><a href="#08-hacker-news"><i class="fa fa-link"></i></a>08 Hacker News</h3>

<p>Hacker News Reader</p>

<p><a href="https://camo.qiitausercontent.com/b20333eb3bf7d039098e90a409e1c9d46a8a01b9/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536362d37623164396431632d633633302d313165372d386230622d3338366134383764623337362e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b20333eb3bf7d039098e90a409e1c9d46a8a01b9/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536362d37623164396431632d633633302d313165372d386230622d3338366134383764623337362e6a7067" alt="08" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646566-7b1d9d1c-c630-11e7-8b0b-386a487db376.jpg"></a></p>

<h3>
<span id="09-google-maps" class="fragment"></span><a href="#09-google-maps"><i class="fa fa-link"></i></a>09 Google Maps</h3>

<p>react-google-map</p>

<p><a href="https://camo.qiitausercontent.com/7f217fc2a6aa90ef5c39b33a25dcdf12f339881c/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536372d37623538316537342d633633302d313165372d383565622d6133393233373836646362342e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7f217fc2a6aa90ef5c39b33a25dcdf12f339881c/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536372d37623538316537342d633633302d313165372d383565622d6133393233373836646362342e6a7067" alt="09" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646567-7b581e74-c630-11e7-85eb-a3923786dcb4.jpg"></a></p>

<h3>
<span id="10-redux" class="fragment"></span><a href="#10-redux"><i class="fa fa-link"></i></a>10 Redux</h3>

<p><a href="https://mae.chab.in/archives/2885" rel="nofollow noopener" target="_blank">Reduxの実装とReactとの連携を超シンプルなサンプルを使って解説</a>のサンプルコードをいじったやつ</p>

<p><a href="https://camo.qiitausercontent.com/8075eb0045956f0c57c75bd34ed42cb169c687ea/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536382d37623931353338382d633633302d313165372d396533372d6261363737643231396432632e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8075eb0045956f0c57c75bd34ed42cb169c687ea/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f31373537303236352f33323634363536382d37623931353338382d633633302d313165372d396533372d6261363737643231396432632e6a7067" alt="10" data-canonical-src="https://user-images.githubusercontent.com/17570265/32646568-7b915388-c630-11e7-9e37-ba677d219d2c.jpg"></a></p>

<h2>
<span id="チートシート" class="fragment"></span><a href="#%E3%83%81%E3%83%BC%E3%83%88%E3%82%B7%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>チートシート</h2>

<p>困ったらみる。</p>

<ul>
<li><a href="https://devhints.io/es6" class="autolink" rel="nofollow noopener" target="_blank">https://devhints.io/es6</a></li>
<li><a href="https://gist.github.com/revolunet/537a3448cff850231a74" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/revolunet/537a3448cff850231a74</a></li>
<li><a href="https://devhints.io/webpack" class="autolink" rel="nofollow noopener" target="_blank">https://devhints.io/webpack</a></li>
<li><a href="https://shift.infinite.red/npm-vs-yarn-cheat-sheet-8755b092e5cc" class="autolink" rel="nofollow noopener" target="_blank">https://shift.infinite.red/npm-vs-yarn-cheat-sheet-8755b092e5cc</a></li>
<li><a href="https://gist.github.com/hofmannsven/b219051467f86f2ac469" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/hofmannsven/b219051467f86f2ac469</a></li>
<li><a href="https://devhints.io/sass" class="autolink" rel="nofollow noopener" target="_blank">https://devhints.io/sass</a></li>
<li><a href="https://devhints.io/react" class="autolink" rel="nofollow noopener" target="_blank">https://devhints.io/react</a></li>
<li><a href="https://devhints.io/react-router" class="autolink" rel="nofollow noopener" target="_blank">https://devhints.io/react-router</a></li>
<li><a href="https://reactcheatsheet.com" class="autolink" rel="nofollow noopener" target="_blank">https://reactcheatsheet.com</a></li>
<li><a href="https://github.com/uanders/react-redux-cheatsheet" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/uanders/react-redux-cheatsheet</a></li>
</ul>

<h2>
<span id="awesome" class="fragment"></span><a href="#awesome"><i class="fa fa-link"></i></a>Awesome</h2>

<p>網羅的な記事。</p>

<ul>
<li><a href="https://github.com/enaqx/awesome-react" rel="nofollow noopener" target="_blank">enaqx/awesome-react</a></li>
<li><a href="https://github.com/brillout/awesome-react-components" rel="nofollow noopener" target="_blank">brillout/awesome-react-components</a></li>
</ul>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>学んでみて新鮮だったし楽しかった。ここしばらくWebフロントエンドは書いてないけど、久しぶりに何かサービスを作りたくなった。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />2位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>30</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/522834b42e3be7d3a326">怠け者のためのディープラーニング入門 - イントロ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-23 13:47:14</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[MachineLearning]</b> <b>[DeepLearning]</b> <b>[Keras]</b> <b>[TensorFlow]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="目次" class="fragment"></span><a href="#%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>目次</h2>

<ul>
<li>
<a href="https://qiita.com/akimach/items/522834b42e3be7d3a326">イントロ</a> ← 今ココ</li>
<li><a href="https://qiita.com/akimach/items/e9088ab1b98a06ae9454" id="reference-246233607ca4e3102230">Scikit-learn・Keras</a></li>
<li><a href="https://qiita.com/akimach/items/f572310b01079515eaf5" id="reference-ec27f8c70a7ad5e80ebf">モデルの性能指標・評価方法</a></li>
<li>データの前処理・データ拡張</li>
<li><a href="https://qiita.com/akimach/items/d9341df56e3bb63b33d5" id="reference-e0ff37d17a7f56542b46">早期終了(early stopping)</a></li>
<li>転移学習</li>
<li><a href="https://qiita.com/akimach/items/a10154e0f0e6dcaafdd0" id="reference-70e41d85ad2c260af632">ハイパーパラメータのチューニング</a></li>
<li>モデル圧縮</li>
<li>応用</li>
</ul>

<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>大学3年生のとき、<a href="https://www.amazon.co.jp/dp/4062883074/" rel="nofollow noopener" target="_blank">小林雅一『AIの衝撃 人工知能は人類の敵か』</a>という本をなんのきなし読んだことがあります。その本の中で「最先端のAIを実装できるのは世界でも50人くらいの研究者・大学院生くらいだ」といった文章を読み、なんだかすごそうという動機で機械学習に触れ始めました。そのころちょうど、<a href="https://github.com/tensorflow/tensorflow/tags?after=v0.7.0" rel="nofollow noopener" target="_blank">TensorFlow 0.0.5</a>が公開されて騒がれていたことを覚えていますが、当時ディープラーニングとは何かすらまったく分かりませんでした。それから約2年の月日が経ちますが、TensorFlowをはじめとしたフレームワークの普及もあってか「最先端のAI」というものを研究し実装している人たちの規模は数百倍にも膨れ上がったのではないでしょうか（もちろん昔からTheanoやTorch、PyBrainなどのライブラリはありました）。</p>

<p><a href="https://camo.qiitausercontent.com/014d270cb5f91d6499d6d4148d3c23d6a908dab6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f36396463666537332d636535322d666666392d636131372d3262623234653766666133652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/014d270cb5f91d6499d6d4148d3c23d6a908dab6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f36396463666537332d636535322d666666392d636131372d3262623234653766666133652e706e67" alt="logo.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/69dcfe73-ce52-fff9-ca17-2bb24e7ffa3e.png"></a></p>

<p>また、フレームワークの登場により非研究者でもカジュアルにディープラーニングというものに触れることができるようになりました。TensorFlowやChainerなどに触れたことがある方ならば、「アイドルの顔画像認識」や「線画の自動彩色」といった魅力的な作品を知っていると思います。一般人でもディープラーニングを学ぶ学習教材や環境は整っています。Webで読めるテキストの<a href="https://nnadl-ja.github.io/nnadl_site_ja/" rel="nofollow noopener" target="_blank">Michael Nielsen『Neural networks and deep learning』（邦題：ニューラルネットワークと深層学習）</a>やUDACITYのオンライン教材<a href="https://www.udacity.com/course/deep-learning--ud730" rel="nofollow noopener" target="_blank">『DEEP LEARNING』</a>、さらに皆さんもご存知の<a href="https://www.oreilly.co.jp/books/9784873117584/" rel="nofollow noopener" target="_blank">斎藤康毅『ゼロから作るDeep Learning ― Pythonで学ぶディープラーニングの理論と実装』（オライリージャパン）</a>もあります。この本は1万冊売れればすごいと言われている出版業界でも異例の7万部もの反響を得ているようです。世間の関心がそれだけ高いことがうかがい知れますね。</p>

<h2>
<span id="目的と動機" class="fragment"></span><a href="#%E7%9B%AE%E7%9A%84%E3%81%A8%E5%8B%95%E6%A9%9F"><i class="fa fa-link"></i></a>目的と動機</h2>

<p>導入が長くなりましたが、本記事は「三平方の定理や余弦定理の証明は分からなくてもまずはそれで問題を解いてみよう！」というノリで書きました。その後で「なんでそうなっているのか？」と疑問が生じて勉強してみるという逆向きの学習もありだと思います。</p>

<p>また、データを活用したちょっとリッチな推論機能を自分のアプリに組み込む際にどうやって開発しようかなと考えて、あとですぐに動かせるカタチで残しておきたいと思いました。</p>

<p>最後の理由としてハッカソンやプロトタイプ作成のための実践的な入門というものを念頭においています。先日、ハッカソンに参加したのですが多くのチームがアイディア出しの段階では、プロダクトやサービスのある機能を「AI」にひとまず押し込んで「便利」になるというアイディアの体裁を取っていましたが、短期間で開発するというハッカソンの性質上どのチームも実現することはできなかったようです。早いサイクルの中でAIという機能も組み込んで、コンセプト検証ができたらいいなという動機で書きました。</p>

<p>この分野はサイエンスとエンジニアリングが重なる領域なので「実験の諸元を明確にしておく」・「性能指標と評価手法をちゃんとする」ということだけは厳しくしておいて、あとはできるだけラクをしようと思います。ちなみに「怠け者のための〜」というのは、プログラマの三大美徳にあやかって最小限の努力で最高の結果を得たいという気持ちで付けてみました。</p>

<h2>
<span id="使用するライブラリのバージョン" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>使用するライブラリのバージョン</h2>

<p>使用したPythonやKerasなどのバージョンは以下のとおりです：</p>

<ul>
<li>Python 3.6.2（Python2.x系でも動くかな)</li>
<li>Numpy 1.13.1</li>
<li>Pandas 0.20.3</li>
<li>Matplotlib 2.0.2</li>
<li>Seaborn 0.8.0</li>
<li>Scikit-learn 0.19.0</li>
<li>Keras 2.0.8</li>
<li>TensorFlow 1.3.0</li>
</ul>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>アプリに組み込むためのニューラルネットを実装し学習させながら、この記事を書きました。みなさんからツッコミやコメントをいただて良い記事に育てていけたらうれしいです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />3位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/d43cd04b5de5fa99bb6a">GestureAI ― Keras + CoreML + iOS 11を用いた RNNによるジェスチャー認識</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-28 19:36:45</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iOS]</b> <b>[機械学習]</b> <b>[DeepLearning]</b> <b>[Swift]</b> <b>[Keras]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>iOS11から登場した<strong>CoreMLフレームワーク</strong>を使って、Kerasで実装したニューラルネットを動かしてみました。画像認識や自然言語処理のCoreMLのサンプルはあったのですが、iPhoneから取得したセンサーデータを<strong>RNN(Recurrent Neural Network、再帰型ニューラルネットワーク）</strong>で認識させた例がなかったようなのでトライしてみました。</p>

<p>以下の記事では、○・□・△・✕を描くジェスチャーの認識を行うRNNの学習とCoreMLでの活用について紹介します。</p>

<h2>
<span id="デモ" class="fragment"></span><a href="#%E3%83%87%E3%83%A2"><i class="fa fa-link"></i></a>デモ</h2>

<p>認識したジェスチャーに応じてHTTPリクエストを送ってSlackにメッセージを送る例 : </p>

<p><a href="https://camo.qiitausercontent.com/679614a7e91f379e17fea467478bb86e820a9018/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f34366264376537322d353464622d323339612d363366362d3539396539363232373661362e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/679614a7e91f379e17fea467478bb86e820a9018/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f34366264376537322d353464622d323339612d363366362d3539396539363232373661362e676966" alt="demo.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/46bd7e72-54db-239a-63f6-599e962276a6.gif"></a></p>

<p>iOSアプリのスクショ : </p>

<p>真ん中のボタンを押している間（最大4秒）だけジェスチャーのセンサーデータを取得して、ボタンを話したらニューラルネットにより認識を行います。</p>

<p><a href="https://camo.qiitausercontent.com/a9d1e8693f82a83a3201c94369fc420305947aae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30343964653861342d313564312d366563662d613634632d6336303536633639376434392e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a9d1e8693f82a83a3201c94369fc420305947aae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30343964653861342d313564312d366563662d613634632d6336303536633639376434392e6a706567" alt="screenshot-01.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/049de8a4-15d1-6ecf-a64c-c6056c697d49.jpeg"></a> <a href="https://camo.qiitausercontent.com/e00886a494abc73c995e8c03bfff01b64f0c06c3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31376636306138352d613436382d376632322d306661302d6462636538396434666165312e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e00886a494abc73c995e8c03bfff01b64f0c06c3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31376636306138352d613436382d376632322d306661302d6462636538396434666165312e6a706567" alt="screenshot-02.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/17f60a85-a468-7f22-0fa0-dbce89d4fae1.jpeg"></a> <a href="https://camo.qiitausercontent.com/bfc5ca0843df1bff700d752569236ed1087289d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f37373438306636652d636565652d346233642d616638372d3434393763343135613063652e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/bfc5ca0843df1bff700d752569236ed1087289d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f37373438306636652d636565652d346233642d616638372d3434393763343135613063652e6a706567" alt="screenshot-03.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/77480f6e-ceee-4b3d-af87-4497c415a0ce.jpeg"></a></p>

<h2>
<span id="レポジトリ学習済みモデル" class="fragment"></span><a href="#%E3%83%AC%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E5%AD%A6%E7%BF%92%E6%B8%88%E3%81%BF%E3%83%A2%E3%83%87%E3%83%AB"><i class="fa fa-link"></i></a>レポジトリ・学習済みモデル</h2>

<ul>
<li>
<a href="https://github.com/akimach/GestureAI" rel="nofollow noopener" target="_blank">akimach/GestureAI</a>

<ul>
<li>Python2.7 + Jupyter Notebook + KerasによるRecurrent Neural Network(RNN)の実装</li>
</ul>
</li>
<li>
<a href="https://github.com/akimach/GestureAI-iOS" rel="nofollow noopener" target="_blank">akimach/GestureAI-iOS</a>

<ul>
<li>学習済みのRNNモデルをCoreMLを使ってiOS上で動かすサンプルアプリ</li>
</ul>
</li>
<li><a href="https://goo.gl/avdMjD" rel="nofollow noopener" target="_blank">GestureAI.mlmodel</a></li>
<li>GestureAI-Collector

<ul>
<li>ジェスチャーのセンサーデータを収集するiOSアプリ</li>
</ul>
</li>
</ul>

<h2>
<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h2>

<p>現段階（2017年9月）ではCoreMLを使う場合、ライブラリのバージョンを合わせることが重要で、基本的に<code>coremltools 0.6.3</code>の依存パッケージのバージョンに倣いました。</p>

<ul>
<li>macOS Sierra 10.12.6</li>
<li>Xcode 9.0</li>
<li>
<strong>Python (2.7.10)</strong>

<ul>
<li>Python3.xには対応していません</li>
</ul>
</li>
<li>numpy (1.13.1)</li>
<li>protobuf (3.1.0)</li>
<li>
<strong>Keras (1.2.2)</strong>

<ul>
<li>バックエンド : TensorFlow (1.2.1)</li>
</ul>
</li>
<li>Scikit-learn (0.18.0)</li>
<li>coremltools (0.6.3)</li>
</ul>

<h2>
<span id="ios11をターゲットとして機械学習モデルの学習と活用の流れ" class="fragment"></span><a href="#ios11%E3%82%92%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88%E3%81%A8%E3%81%97%E3%81%A6%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%AD%A6%E7%BF%92%E3%81%A8%E6%B4%BB%E7%94%A8%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>iOS11をターゲットとして機械学習モデルの学習と活用の流れ</h2>

<p>それぞれのパートに該当するコードのリンクを添付しています。</p>

<p>機械学習モデルの学習と保存 : </p>

<ol>
<li>データセットの準備・整形・前処理 [<a href="https://github.com/akimach/GestureAI/blob/master/notebooks/feature-engineering.ipynb" rel="nofollow noopener" target="_blank">link</a>]</li>
<li>機械学習モデルの学習・性能評価 [<a href="https://github.com/akimach/GestureAI/blob/master/notebooks/grid-search.ipynb" rel="nofollow noopener" target="_blank">Link</a>]</li>
<li>機械学習モデルの保存 [<a href="https://github.com/akimach/GestureAI/blob/master/notebooks/rnn-early-stopping.ipynb" rel="nofollow noopener" target="_blank">Link</a>]</li>
<li>
<strong>coremltools</strong>を使い保存したモデルを<strong>Core ML model形式</strong>(<code>.mlmodel</code>)に変換する [<a href="https://github.com/akimach/GestureAI/blob/master/notebooks/rnn-early-stopping.ipynb" rel="nofollow noopener" target="_blank">Link</a>]</li>
</ol>

<p>機械学習モデルのCoreMLによる利用 : </p>

<ol>
<li>
<code>.mlmodel</code>形式のファイルを自分のプロジェクトに読み込む</li>
<li>機械学習モデルの仕様に応じて推論させるデータの整形を行う [<a href="https://github.com/akimach/GestureAI-iOS/blob/master/GestureAI/GestureViewController.swift#L136-L153" rel="nofollow noopener" target="_blank">Link</a>]</li>
<li>機械学習モデルの推論結果を得る [<a href="https://github.com/akimach/GestureAI-iOS/blob/master/GestureAI/GestureViewController.swift#L98-L114" rel="nofollow noopener" target="_blank">Link</a>]</li>
</ol>

<h2>
<span id="データセット" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>データセット</h2>

<p>データセットは○・□・△・✕・その他を描くジェスチャーの3軸の加速度をPhoneの加速度センサーにより取得してCSV形式のテキストとして保存したものを使いました。5クラス各200件で総件数は1,000件です。サンプリングレートは10Hz、最大取得秒数は4秒なので最大の系列長は40となります。なおジェスチャーには筆順を考慮しませんでした。</p>

<table>
<thead>
<tr>
<th style="text-align: center">ラベル</th>
<th style="text-align: center">説明</th>
<th style="text-align: center">件数</th>
<th style="text-align: center">形</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">0</td>
<td style="text-align: center">Circle</td>
<td style="text-align: center">200</td>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/56f47c64874566dfcf82d2b4f0782f9f1464f655/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f37323633623339312d356335612d336366372d616163342d3134323861613638616266632e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/56f47c64874566dfcf82d2b4f0782f9f1464f655/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f37323633623339312d356335612d336366372d616163342d3134323861613638616266632e6a706567" alt="circle.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/7263b391-5c5a-3cf7-aac4-1428aa68abfc.jpeg"></a></td>
</tr>
<tr>
<td style="text-align: center">1</td>
<td style="text-align: center">Rectangle</td>
<td style="text-align: center">200</td>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/8e6e2a0967bf700ed0ddea30198daa3de05b5caa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31613763363434632d346562352d396337662d316461382d6161366339636465346436392e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8e6e2a0967bf700ed0ddea30198daa3de05b5caa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31613763363434632d346562352d396337662d316461382d6161366339636465346436392e6a706567" alt="rectangle.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/1a7c644c-4eb5-9c7f-1da8-aa6c9cde4d69.jpeg"></a></td>
</tr>
<tr>
<td style="text-align: center">2</td>
<td style="text-align: center">Triangle</td>
<td style="text-align: center">200</td>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/af3887f2f725f41385c6b8b202dcc14b0ef2494a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f32356635636265642d626164322d626265372d373831332d6665333534656239653334322e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/af3887f2f725f41385c6b8b202dcc14b0ef2494a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f32356635636265642d626164322d626265372d373831332d6665333534656239653334322e6a706567" alt="triangle.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/25f5cbed-bad2-bbe7-7813-fe354eb9e342.jpeg"></a></td>
</tr>
<tr>
<td style="text-align: center">3</td>
<td style="text-align: center">Cross</td>
<td style="text-align: center">200</td>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/a227867a36ce79ed356a47e71bcacf79455ac471/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f61393633616165352d353635612d316236622d643035382d3562616233316333626633332e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a227867a36ce79ed356a47e71bcacf79455ac471/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f61393633616165352d353635612d316236622d643035382d3562616233316333626633332e6a706567" alt="cross.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/a963aae5-565a-1b6b-d058-5bab31c3bf33.jpeg"></a></td>
</tr>
<tr>
<td style="text-align: center">4</td>
<td style="text-align: center">Other</td>
<td style="text-align: center">200</td>
<td style="text-align: center"></td>
</tr>
</tbody>
</table>

<h2>
<span id="データの前処理" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%89%8D%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>データの前処理</h2>

<p>最大長が40の時系列データなので、長さが40未満のデータは0埋めを行いました。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="n">timesteps</span> <span class="o">=</span> <span class="mi">40</span> <span class="c1"># 最大系列長</span>
<span class="n">input_dim</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># 入力次元</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'example.csv'</span><span class="p">)</span>
<span class="n">seq</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
<span class="n">seq_length</span> <span class="o">=</span> <span class="n">seq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 対象となるデータの系列長</span>
<span class="n">seq_0padding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">seq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">timesteps</span><span class="o">-</span><span class="n">seq_length</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">))]</span>
</pre></div></div>

<h2>
<span id="機械学習モデルの学習" class="fragment"></span><a href="#%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%AD%A6%E7%BF%92"><i class="fa fa-link"></i></a>機械学習モデルの学習</h2>

<p>グリッドサーチを使ってハイパーパラメータの剪定と性能評価を行いました。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="c1"># ハイパーパラメータの候補</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"rnn_cell"</span><span class="p">:</span> <span class="p">[</span><span class="s1">'LSTM'</span><span class="p">,</span> <span class="s1">'GRU'</span><span class="p">],</span>
    <span class="s2">"n_hidden"</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,],</span>
<span class="p">}</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">KerasClassifier</span><span class="p">(</span><span class="n">build_fn</span><span class="o">=</span><span class="n">rnn</span><span class="p">,</span> <span class="n">nb_epoch</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">n_cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">'accuracy'</span><span class="p">)</span>
<span class="c1"># グリッドサーチの実行</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="c1"># 結果の表示</span>
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="c1"># ベストなパラメータととその正答率</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Hyper Parameters:"</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="s2">"Accuracy:"</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
</pre></div></div>

<p>グリッドサーチの結果、エポック数が50かつ4分割交差検証で、RNNセルがGRUセル、ノード数が512がベストとなり正答率は90.8%でした。</p>

<h2>
<span id="機械学習モデルの保存" class="fragment"></span><a href="#%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E4%BF%9D%E5%AD%98"><i class="fa fa-link"></i></a>機械学習モデルの保存</h2>

<p>学習済みのモデルをCoreML Model形式のファイルに変換する方法は2つあって、(1)モデルのオブジェクトか(2)ファイルパスのどちらかを渡して変換することができます。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">coremltools</span>
<span class="c1"># 保存先のパス</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># 学習済みのモデル</span>

<span class="c1"># (1) モデルのオブジェクトを渡す場合</span>
<span class="n">coreml_model</span> <span class="o">=</span><span class="n">coremltools</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">coreml_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'models/GestureAI.mlmodel'</span><span class="p">)</span>

<span class="c1"># (2) ファイルパスを渡す場合</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">'models/GestureAI.h5'</span>
<span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">coreml_model</span> <span class="o">=</span><span class="n">coremltools</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">coreml_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'models/GestureAI.mlmodel'</span><span class="p">)</span>
</pre></div></div>

<p>CoreML Modelに情報を付加することもできます。他にも引数があるのでドキュメントを参照してみてください。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="n">coreml_model</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="s1">'Hoge'</span>
<span class="n">coreml_model</span><span class="o">.</span><span class="n">license</span> <span class="o">=</span> <span class="s1">'MIT'</span>
<span class="n">coreml_model</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">'My neural network'</span>
</pre></div></div>

<h2>
<span id="coremlを使うためのxcodeの設定" class="fragment"></span><a href="#coreml%E3%82%92%E4%BD%BF%E3%81%86%E3%81%9F%E3%82%81%E3%81%AExcode%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>CoreMLを使うためのXCodeの設定</h2>

<p>学習済みモデルをまずXCodeのプロジェクトに読み込ませます。そのあと図1と図2のように<code>Build Phases</code>内にある<code>Compiles Sources</code>の<code>+</code>ボタンを押して<code>xxx.mlmodel</code>を追加します。そうすると、</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/6558f8a0334eb7e8d3a2710607f1057bd078718d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f62353838353762332d396565342d626566632d623064352d3864653130336562653634652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6558f8a0334eb7e8d3a2710607f1057bd078718d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f62353838353762332d396565342d626566632d623064352d3864653130336562653634652e706e67" alt="001_1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/b58857b3-9ee4-befc-b0d5-8de103ebe64e.png"></a><br>
図1 : Compiles Sourcesの追加1</p>

<p><a href="https://camo.qiitausercontent.com/cc0c6a98b8dade7c8aaf4bbb09cd7c2bc2c6f1ac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f39636433393264392d353439332d333763612d373733642d6266313536373732326434662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/cc0c6a98b8dade7c8aaf4bbb09cd7c2bc2c6f1ac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f39636433393264392d353439332d333763612d373733642d6266313536373732326434662e706e67" alt="002.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/9cd392d9-5493-37ca-773d-bf1567722d4f.png"></a><br>
図2 : Compiles Sourcesの追加2</p>
</blockquote>

<p>そうすると、Swiftのモデルコードが自動で生成されるようになります（図3,4）。</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/a5f5a646515c08204c9ff5357601c570a4c84cf2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f66616135336665332d616137322d666332642d633835622d6133363934376336643664622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a5f5a646515c08204c9ff5357601c570a4c84cf2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f66616135336665332d616137322d666332642d633835622d6133363934376336643664622e706e67" alt="003.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/faa53fe3-aa72-fc2d-c85b-a36947c6d6db.png"></a><br>
図3 : モデルの情報<br>
<a href="https://camo.qiitausercontent.com/d65e4c647fb45b2471a684acbffdb014c27015b9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f62386366613733302d626433362d356662392d316539322d3633656636663732383634322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d65e4c647fb45b2471a684acbffdb014c27015b9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f62386366613733302d626433362d356662392d316539322d3633656636663732383634322e706e67" alt="004.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/b8cfa730-bd36-5fb9-1e92-63ef6f728642.png"></a><br>
図4 : CoreML Modelから生成されたSwiftのコードの一部</p>
</blockquote>

<p>あとは非常にシンプルです。CoreML Model形式のファイル名と同じクラス名のオブジェクトを生成して、<code>prediction(...)</code>に推論させるデータを渡してその結果を受け取ります。</p>

<div class="code-frame" data-lang="swift"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nv">targetData</span> <span class="p">=</span> <span class="p">...</span> <span class="c1">// 推論させるデータ</span>
<span class="kd">let</span> <span class="nv">gestureAI</span> <span class="p">=</span> <span class="n">GestureAI</span><span class="p">()</span>
<span class="k">guard</span> <span class="kd">let</span> <span class="nv">output</span> <span class="p">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">gestureAI</span><span class="p">.</span><span class="n">prediction</span><span class="p">(</span><span class="n">input</span><span class="p">:</span>
     <span class="n">GestureAIInput</span><span class="p">(</span><span class="n">input1</span><span class="p">:</span> <span class="n">targetData</span><span class="p">))</span> <span class="k">else</span> <span class="p">{</span>
         <span class="bp">fatalError</span><span class="p">(</span><span class="s">"Unexpected runtime error."</span><span class="p">)</span>
<span class="p">}</span>
<span class="bp">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div></div>

<p>私が用意したサンプルコードと<a href="https://goo.gl/avdMjD" rel="nofollow noopener" target="_blank">学習済みモデル</a>を使って実際に試してみてください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone https://github.com/akimach/GestureAI-CoreML-iOS
</pre></div></div>

<h2>
<span id="躓いた点--入力データのshapeと次元に気をつける" class="fragment"></span><a href="#%E8%BA%93%E3%81%84%E3%81%9F%E7%82%B9--%E5%85%A5%E5%8A%9B%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AEshape%E3%81%A8%E6%AC%A1%E5%85%83%E3%81%AB%E6%B0%97%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>躓いた点 : 入力データのShapeと次元に気をつける</h2>

<p>今回はじめてCoreMLを使ってみて、<strong>入力データのShapeに気をつけなければいけない</strong>ということに気づきました。</p>

<p>KerasでもTensorFlowでもいいのですが、一般的な機械学習ライブラリではモデルへの入力は、例えば画像だったら<code>(バッチサイズ, 画像の高さ, 画像の幅, 画像のチャンネル数)</code>のようになります。なので、1件だけのデータを推論させる場合でも1件のデータのみを持つ配列として入力させます。CoreMLの場合は1回の推論につき1件のデータを入力するようになっています。入力のShapeはXcodeからみれるモデルの情報にも記述されていますし、<a href="https://apple.github.io/coremltools/coremlspecification/sections/NeuralNetwork.html" rel="nofollow noopener" target="_blank">公式ドキュメント</a>にも記述されています(引用 : <em>For the purposes of this specification, batch dimension is ignored.</em>)。</p>

<p>また、RNNに入力する系列データの場合、入力のShapeは<code>バッチサイズ, 系列長, 入力次元</code>のようになります。GestureAIだったら<code>バッチサイズ, 40, 3</code>です。最初、このShapeのままで学習させたらCoreMLでの入力Shapeは3だったので躓きました。入力の次元をフラットにしてあげる必要があるため、<code>バッチサイズ, 40*3</code>で入力されるデータをKerasの<a href="https://keras.io/ja/layers/core/#reshape" rel="nofollow noopener" target="_blank">Reshape</a>を使い<code>バッチサイズ, 40, 3</code>に変換してフィードフォワードさせるようにしました（以下、図5）。</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/5a52db70f8730acfec61cd54dc8e4202bcd7d071/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31643430653862662d633333312d306138322d613939332d3331626633333534373435392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5a52db70f8730acfec61cd54dc8e4202bcd7d071/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31643430653862662d633333312d306138322d613939332d3331626633333534373435392e706e67" alt="shape.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/1d40e8bf-c331-0a82-a993-31bf33547459.png"></a><br>
図5 : GestureAIのShape</p>
</blockquote>

<h2>
<span id="発展" class="fragment"></span><a href="#%E7%99%BA%E5%B1%95"><i class="fa fa-link"></i></a>発展</h2>

<ul>
<li>ちょっと複雑な剣技や魔法のアクションを認識させてゲームに使ってみたい（昔、ドラクエでロトの剣のゲームがあった）</li>
<li>iPhoneで取れるフィジカルデータを有効活用</li>
<li>アルファベットやひらがなの手書き文字ジェスチャーに挑戦</li>
</ul>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>Kerasで学習させた機械学習モデルをCoreMLで活用した例を紹介してみました。次回はCoreML+Visionにトライしてみたいと思います。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<ul>
<li><a href="https://developer.apple.com/machine-learning/" rel="nofollow noopener" target="_blank">Machine Learning - Apple Developer</a></li>
<li><a href="https://developer.apple.com/documentation/coreml" rel="nofollow noopener" target="_blank">Core ML | Apple Developer Documentation</a></li>
<li><a href="https://apple.github.io/coremltools/" rel="nofollow noopener" target="_blank">coremltools</a></li>
<li><a href="https://keras.io/ja/" rel="nofollow noopener" target="_blank">Keras: Pythonの深層学習ライブラリ</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />4位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/f572310b01079515eaf5">怠け者のためのディープラーニング入門 - 性能指標・検証手法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-23 13:48:54</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[MachineLearning]</b> <b>[DeepLearning]</b> <b>[Keras]</b> <b>[TensorFlow]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>モデルの評価に使われる性能指標と検証手法を紹介します。</p>

<ul>
<li><a href="https://qiita.com/akimach/items/522834b42e3be7d3a326" id="reference-2973a11c85f362fce1f9">イントロ</a></li>
<li><a href="https://qiita.com/akimach/items/e9088ab1b98a06ae9454" id="reference-41c6594525a2f43ebd59">Scikit-learn・Keras</a></li>
<li>モデルの性能指標・評価方法 ← 今ココ！</li>
<li>データの前処理・データ拡張</li>
<li>早期終了(early stopping)・正則化</li>
<li>転移学習</li>
<li>ハイパーパラメータのチューニング</li>
<li>モデル圧縮</li>
<li>応用</li>
</ul>

<h1>
<span id="性能指標" class="fragment"></span><a href="#%E6%80%A7%E8%83%BD%E6%8C%87%E6%A8%99"><i class="fa fa-link"></i></a>性能指標</h1>

<p>TensorFlowやKerasなどの入門記事を読むと、サンプルコードの中で示されるニューラルネットの評価指標としてAccuracy（正解率、ややこしいが精度とも）だけが使われているケースが多いです。MNISTのようなベンチマークやKaggleでも、性能指標は統一されています。</p>

<p>今ここであるインプットに対してすべてAクラスと返すAIを考えてみます。</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/6868dbf99c3926f6c11c8469144a0843693707c4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31633636356361652d633062332d393436662d343266342d6137626132393531376262612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6868dbf99c3926f6c11c8469144a0843693707c4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31633636356361652d633062332d393436662d343266342d6137626132393531376262612e706e67" alt="ai5.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/1c665cae-c0b3-946f-42f4-a7ba29517bba.png"></a><br>
図1 : すべて負クラスと答えるAI</p>
</blockquote>

<p>入力には負クラスに該当するものが9個、正クラスに該当するものが1個あります。このAIはすべて負クラスと返すので正解率は90%となります。はたして彼は優秀なAIと呼べるのでしょうか？正解率だけではAIの優秀さは測れません。他の指標からも考える必要があります。</p>

<h2>
<span id="陽性と陰性" class="fragment"></span><a href="#%E9%99%BD%E6%80%A7%E3%81%A8%E9%99%B0%E6%80%A7"><i class="fa fa-link"></i></a>陽性と陰性</h2>

<p>正解率や適合率、再現率といった指標は真陽性(TP)や偽陰性(TN)といった値から求めることができます。それぞれを説明するのは手間なので、以下の図で理解していただけたら幸いです。</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/e53a63277d1708865f35ac905b0733b91309acbf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f65373334333438642d333136662d376434372d623134312d6664616164616435636564392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e53a63277d1708865f35ac905b0733b91309acbf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f65373334333438642d333136662d376434372d623134312d6664616164616435636564392e706e67" alt="ai.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/e734348d-316f-7d47-b141-fdaadad5ced9.png"></a><br>
図2 : 陽性と陰性</p>
</blockquote>

<p>具体例（図3)を見てみましょう。</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/3a1b22f148bddf03bd21e49f0c2d33e1f27f58cf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31323464393037642d653131622d653330322d313738622d3832373538666666356564612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3a1b22f148bddf03bd21e49f0c2d33e1f27f58cf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31323464393037642d653131622d653330322d313738622d3832373538666666356564612e706e67" alt="ai4.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/124d907d-e11b-e302-178b-82758fff5eda.png"></a><br>
図3 : とあるAIの予測とその答え</p>
</blockquote>

<ul>
<li>$TP=3$</li>
<li>$FP=2$</li>
<li>$FN=2$</li>
<li>$TN=1$</li>
</ul>

<h2>
<span id="正解率accuracy" class="fragment"></span><a href="#%E6%AD%A3%E8%A7%A3%E7%8E%87accuracy"><i class="fa fa-link"></i></a>正解率(Accuracy)</h2>

<p>正しい予測を予測の合計で割った値。先に見たとおりデータのクラスに偏りがあるとあてにならない。</p>

<p>$$Accuracy=\frac{TP+TN}{TP+FP+FN+TN}$$</p>

<p>例 ：</p>

<p>$$Accuracy=\frac{TP+TN}{TP+FP+FN+TN}=\frac{3+1}{3+2+2+1}=0.5$$</p>

<h2>
<span id="誤分類率error-rate" class="fragment"></span><a href="#%E8%AA%A4%E5%88%86%E9%A1%9E%E7%8E%87error-rate"><i class="fa fa-link"></i></a>誤分類率(Error rate)</h2>

<p><a href="http://yann.lecun.com/exdb/mnist/" rel="nofollow noopener" target="_blank">LeCun先生のMNISTのページ</a>とかに使われていたりする。</p>

<p>$$Error=1-Accuracy$$</p>

<h2>
<span id="適合率precision" class="fragment"></span><a href="#%E9%81%A9%E5%90%88%E7%8E%87precision"><i class="fa fa-link"></i></a>適合率(Precision)</h2>

<p>偽陽性をチェックします。病気なのに病気ではないと誤診してしまう可能性を表す（陽性：病気、陰性：非病気）。低いほど誤診しやすい。</p>

<p>$$Precision=\frac{TP}{TP+FP}$$</p>

<p>例 : </p>

<p>$$Precision=\frac{3}{3+2}=0.6$$</p>

<h2>
<span id="再現率recall" class="fragment"></span><a href="#%E5%86%8D%E7%8F%BE%E7%8E%87recall"><i class="fa fa-link"></i></a>再現率(Recall)</h2>

<p>偽陰性をチェックします。病気でないのに病気であると診断してしまう可能性を表す（陽性：病気、陰性：非病気）。低いほど誤診しやすい。</p>

<p>$$Recall=\frac{TP}{TP+FN}$$</p>

<p>例 : </p>

<p>$$Recall=\frac{TP}{TP+FN}=\frac{3}{3+2}=0.6$$</p>

<h2>
<span id="f1値f1-scoref1スコア" class="fragment"></span><a href="#f1%E5%80%A4f1-scoref1%E3%82%B9%E3%82%B3%E3%82%A2"><i class="fa fa-link"></i></a>F1値(F1 score、F1スコア)</h2>

<p>適合率と再現率を要約する。この値が大きいほどよいとされる。（E値から1を引いたものでもある）</p>

<p>$${F1}=\frac{2\cdot Recall\cdot Precision}{Recall+Precision}$$</p>

<p>例 : </p>

<p>$$F1=\frac{2 \cdot Recall \cdot Precision}{Recall+Precision}=\frac{2 \cdot 0.6 \cdot 0.6}{0.6+0.6}=0.6$$</p>

<h2>
<span id="おまけすべて負と答えるaiは賢いといえるのか" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E3%81%99%E3%81%B9%E3%81%A6%E8%B2%A0%E3%81%A8%E7%AD%94%E3%81%88%E3%82%8Bai%E3%81%AF%E8%B3%A2%E3%81%84%E3%81%A8%E3%81%84%E3%81%88%E3%82%8B%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>おまけ：すべて負と答えるAIは賢いといえるのか</h2>

<p>図1をもとにまとめると</p>

<ul>
<li>$TP=0$</li>
<li>$FP=0$</li>
<li>$FN=1$</li>
<li>$TN=9$</li>
</ul>

<p>となるので以下のようになる。</p>

<ul>
<li>$Accuracy=0.9$</li>
<li>$Precision=0.0$</li>
<li>$Recall=0.0$</li>
<li>$F1=0.0$</li>
</ul>

<p>したがって、F1値が低いため賢くないと判断できますが、データが負クラスに偏っているため決断を急がないでデータ収集をしたほうがいいように思われます。</p>

<h2>
<span id="scikit-learnのサンプルコード" class="fragment"></span><a href="#scikit-learn%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>Scikit-learnのサンプルコード</h2>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">recall_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">n_data</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">n_class</span> <span class="o">=</span> <span class="n">n_data</span><span class="o">//</span><span class="mi">2</span>
<span class="n">X_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X_positive</span><span class="p">,</span> <span class="n">X_negative</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">]</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span>\
        <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">LinearSVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Accuracy:"</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Precision:"</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Recall:"</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"F1-score:"</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">))</span>
</pre></div></div>

<p>実行結果 :</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Accuracy: 0.9
Precision: 0.9
Recall: 0.9
F1-score: 0.9
</pre></div></div>

<h2>
<span id="kerasのサンプルコード" class="fragment"></span><a href="#keras%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>Kerasのサンプルコード</h2>

<p>Keras2.xでは再現率や精度は自分で実装する必要があります。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">import</span> <span class="nn">keras</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">optimizers</span>
<span class="kn">import</span> <span class="nn">keras.backend</span> <span class="kn">as</span> <span class="nn">K</span>
<span class="n">n_data</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">n_class</span> <span class="o">=</span> <span class="n">n_data</span><span class="o">//</span><span class="mi">2</span>
<span class="n">X_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X_positive</span><span class="p">,</span> <span class="n">X_negative</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">]</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span>\
        <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'sigmoid'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">recall_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">true_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_true</span> <span class="o">*</span> <span class="n">y_pred</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">possible_positives</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">true_positives</span> <span class="o">/</span> <span class="p">(</span><span class="n">possible_positives</span> <span class="o">+</span> <span class="n">K</span><span class="o">.</span><span class="n">epsilon</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">recall</span>
<span class="k">def</span> <span class="nf">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">pre</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pre</span> <span class="o">*</span> <span class="n">rec</span> <span class="o">/</span> <span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="n">rec</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'binary_crossentropy'</span><span class="p">,</span>
              <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizers</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">'accuracy'</span><span class="p">,</span><span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Loss:"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"Accuracy:"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">"Precision"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">"Recall:"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">"F1-Score:"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">)</span>
</pre></div></div>

<p>実行結果 : </p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Epoch 1/5
160/160 [==============================] - 0s - loss: 0.4435 - acc: 0.9125 - precision_score: 0.9127 - recall_score: 0.9182 - f1_score: 0.9143     
Epoch 2/5
160/160 [==============================] - 0s - loss: 0.4283 - acc: 0.9125 - precision_score: 0.9108 - recall_score: 0.9190 - f1_score: 0.9082     
Epoch 3/5
160/160 [==============================] - 0s - loss: 0.4137 - acc: 0.9187 - precision_score: 0.9146 - recall_score: 0.9119 - f1_score: 0.9104     
Epoch 4/5
160/160 [==============================] - 0s - loss: 0.4001 - acc: 0.9250 - precision_score: 0.9144 - recall_score: 0.9374 - f1_score: 0.9249     
Epoch 5/5
160/160 [==============================] - 0s - loss: 0.3873 - acc: 0.9250 - precision_score: 0.9083 - recall_score: 0.9406 - f1_score: 0.9197Accuracy: 0.9
Precision: 0.9
Recall: 0.9
F1-score: 0.9
</pre></div></div>

<h3>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h3>

<ul>
<li><a href="">情報検索と言語処理</a></li>
<li><a href="">Python機械学習プログラミング</a></li>
<li><a href="https://en.wikipedia.org/wiki/Precision_and_recall" rel="nofollow noopener" target="_blank">Precision and recall - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/F1_score" rel="nofollow noopener" target="_blank">F1 score - Wikipedia</a></li>
<li><a href="http://ibisforest.org/index.php?F%E5%80%A4" rel="nofollow noopener" target="_blank">F値 (F-measure) - 朱鷺の杜Wiki</a></li>
<li><a href="http://ibisforest.org/index.php?ROC%E6%9B%B2%E7%B7%9A" rel="nofollow noopener" target="_blank">ROC曲線 (receiver operating characteristic curve)  - 朱鷺の杜Wiki</a></li>
</ul>

<hr>

<h1>
<span id="検証手法" class="fragment"></span><a href="#%E6%A4%9C%E8%A8%BC%E6%89%8B%E6%B3%95"><i class="fa fa-link"></i></a>検証手法</h1>

<h2>
<span id="ホールドアウト法" class="fragment"></span><a href="#%E3%83%9B%E3%83%BC%E3%83%AB%E3%83%89%E3%82%A2%E3%82%A6%E3%83%88%E6%B3%95"><i class="fa fa-link"></i></a>ホールド・アウト法</h2>

<p>ホールド・アウト法とは、機械学習モデルの性能を検証するために使われるシンプルな手法で、1つのデータセットを任意の割合で学習用とテスト用のデータセットに分割して評価を行います。この手法の問題点として、あるクラスのデータに偏ってデータセットを分割してしまう場合である。以下の図のようにクルマ・馬・犬の画像を学習し画像を分類を行うモデルを考えた場合、クルマの画像ばかりを学習したものをテストデータで評価することになってしまいます。</p>

<p><a href="https://camo.qiitausercontent.com/ceae6d7e625a262ea05c21ed91cf33b8a6b78b5b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31316139343537372d346262612d323435632d613931372d6231306264393436643434612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ceae6d7e625a262ea05c21ed91cf33b8a6b78b5b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31316139343537372d346262612d323435632d613931372d6231306264393436643434612e706e67" alt="0002.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/11a94577-4bba-245c-a917-b10bd946d44a.png"></a></p>

<p>しかし、ベンチマークとして使われるMNISTやCFIAR-10などでは、十分にデータの件数が大きいためホールド・アウト法にしたがい予め学習データとテストデータが用意されているケースもあるようです。</p>

<h3>
<span id="サンプルコード" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>サンプルコード</h3>

<p>以下のサンプルコードでは、データセットを学習用データセットを80%、テストデータを20%として分割します。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span>\
        <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div></div>

<h2>
<span id="k-分割交差検証" class="fragment"></span><a href="#k-%E5%88%86%E5%89%B2%E4%BA%A4%E5%B7%AE%E6%A4%9C%E8%A8%BC"><i class="fa fa-link"></i></a>K-分割交差検証</h2>

<p>ホールド・アウト法の解決策として考えられる手法がK-分割交差検証です。K-分割とあるようにデータセットをK個に分割します。それぞれの分割されたデータセットをテストデータ、それ以外を学習データセットとして活用します。</p>

<p>以下の図では、10個のデータを5組になるように分割し、5通りの学習データとテストデータに対して機械学習アルゴリズムを適用し、それぞれのテストデータを使って性能指標を算出します。そして各性能指標の平均値がモデルの性能となります。ホールド・アウト法よりもバラエティに富んだデータを用いることで、モデルの性能を多角的に調べてることができます。</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/39defd795b4a2f99417dfbff55768044fc8f09ec/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30613864363063392d663733342d646431652d303435352d6136643431366333636463392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/39defd795b4a2f99417dfbff55768044fc8f09ec/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30613864363063392d663733342d646431652d303435352d6136643431366333636463392e706e67" alt="0004.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/0a8d60c9-f734-dd1e-0455-a6d416c3cdc9.png"></a><br>
図 : クルマ・馬・犬の3クラス分類を行うモデルに対するK-分割交差検証</p>
</blockquote>

<h3>
<span id="サンプルコード-1" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89-1"><i class="fa fa-link"></i></a>サンプルコード</h3>

<p>Scikit-learnでは交差検証法は<code>sklearn.model_selection.StratifiedKFold</code>から使うことができます。</p>

<p>前回紹介した2層のニューラルネットを交差検証法により評価する。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">optimizers</span>
<span class="c1"># Setup Dataset</span>
<span class="n">n_data</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">n_class</span> <span class="o">=</span> <span class="n">n_data</span><span class="o">//</span><span class="mi">2</span>
<span class="n">X_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X_positive</span><span class="p">,</span> <span class="n">X_negative</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">]</span>
<span class="c1"># Build Model</span>
<span class="k">def</span> <span class="nf">mlp</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'sigmoid'</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'binary_crossentropy'</span><span class="p">,</span>
                  <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizers</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
                  <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">'accuracy'</span><span class="p">,])</span>
    <span class="k">return</span> <span class="n">model</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Divided into 10 groups</span>
<span class="n">kfold</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="c1"># Cross Validation</span>
<span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train</span><span class="p">]</span>
    <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">test</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">mlp</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Mean:"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span> <span class="s2">"Std:"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</pre></div></div>

<p>実行結果 : </p>

<p>前回の結果よりも正解率(Accuracy)が低くなっていることが分かります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Mean of accuracy: 0.698384742439 Std: 0.226718946138
</pre></div></div>

<h3>
<span id="参考-1" class="fragment"></span><a href="#%E5%8F%82%E8%80%83-1"><i class="fa fa-link"></i></a>参考</h3>

<ul>
<li><a href="http://ibisforest.org/index.php?%E4%BA%A4%E5%B7%AE%E7%A2%BA%E8%AA%8D" rel="nofollow noopener" target="_blank">交差確認 - 朱鷺の杜Wiki</a></li>
<li><a href="http://tjo.hatenablog.com/entry/2016/04/14/190000" rel="nofollow noopener" target="_blank">「そのモデルの精度、高過ぎませんか？」過学習・汎化性能・交差検証のはなし</a></li>
</ul>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>性能指標と検証手法を紹介しました。この2つはディープラーニングに限らず機械学習全般で使われていますし、今後も共通言語とし使われていくように思われます。単一の指標で満足せず、できる限り多角的にモデルの性能を評価することで、いざ現実世界で動かしてみるとうまくいかないケースを減らすことができます。</p>

<p>性能評価はできる限り厳しくしてみましょう。自分のAIにがっかりすることはあっても、自信過剰になることはなくなります。「かわいい子には旅をさせよ」と言いますが、自分のかわいいAIにはできるかぎり多様なデータを学習させて厳しい旅をさせるといいのではないでしょうか。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />5位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/11728ba1c9bb3d1f176b">Pelican &amp; Github PagesでJupyter Notebooksを公開する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-06 17:45:15</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[R]</b> <b>[機械学習]</b> <b>[Jupyter]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>PythonとRのJupyter NotebooksをGithub Pagesに公開したかったのでその方法をまとめました。だいぶ前にやって忘れてしまったのでログをとっておきます。</p>

<p>レポジトリと作ったページは以下のリンクです。</p>

<ul>
<li><a href="https://github.com/akimach/note" rel="nofollow noopener" target="_blank">akimach/note - Github</a></li>
<li><a href="https://akimach.github.io/note/" rel="nofollow noopener" target="_blank">akimach.note</a></li>
</ul>

<h2>
<span id="github-pages" class="fragment"></span><a href="#github-pages"><i class="fa fa-link"></i></a>Github Pages</h2>

<p>まずはレポジトリを作ります。GitHub Pagesの設定は後でいじります。</p>

<p><a href="https://camo.qiitausercontent.com/6d7c7633113b0f6234803056be95fb4bd3cb737b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f37363339303531322d623631322d343037332d373030612d3938356538636365353533382e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6d7c7633113b0f6234803056be95fb4bd3cb737b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f37363339303531322d623631322d343037332d373030612d3938356538636365353533382e6a706567" alt="a01.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/76390512-b612-4073-700a-985e8cce5538.jpeg"></a></p>

<p>作ったらcloneします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone git@github.com:akimach/note.git
</pre></div></div>

<ul>
<li><a href="https://pages.github.com/" class="autolink" rel="nofollow noopener" target="_blank">https://pages.github.com/</a></li>
</ul>

<h2>
<span id="pelican" class="fragment"></span><a href="#pelican"><i class="fa fa-link"></i></a>Pelican</h2>

<p>Pelicanのインストールを行います。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pip install pelican Markdown pytz ghp-import
</pre></div></div>

<p><code>pelican-quickstart</code>でプロジェクトの雛形を作ります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd note
$ pelican-quickstart
Welcome to pelican-quickstart v3.7.1.

This script will help you create a new Pelican-based website.

Please answer the following questions so this script can generate the files
needed by Pelican.


&gt; Where do you want to create your new web site? [.] .
&gt; What will be the title of this web site? akimach.note
&gt; Who will be the author of this web site? akimach
&gt; What will be the default language of this web site? [en] ja
&gt; Do you want to specify a URL prefix? e.g., http://example.com   (Y/n) n
&gt; Do you want to enable article pagination? (Y/n) Y
&gt; How many articles per page do you want? [10] 5
&gt; What is your time zone? [Europe/Paris] Asia/Tokyo
&gt; Do you want to generate a Fabfile/Makefile to automate generation and publishing? (Y/n) Y
&gt; Do you want an auto-reload &amp; simpleHTTP script to assist with theme and site development? (Y/n) n
&gt; Do you want to upload your website using FTP? (y/N) N
&gt; Do you want to upload your website using SSH? (y/N) N
&gt; Do you want to upload your website using Dropbox? (y/N) N
&gt; Do you want to upload your website using S3? (y/N) N
&gt; Do you want to upload your website using Rackspace Cloud Files? (y/N) N
&gt; Do you want to upload your website using GitHub Pages? (y/N) y
&gt; Is this your personal page (username.github.io)? (y/N) N
Done. Your new project is available at /Users/akimach/note
</pre></div></div>

<p>設定ファイル<code>publishconf.py</code>の<code>RELATIVE_URLS</code>を<code>True</code>にしてください。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">publishconf.py</span></div>
<div class="highlight"><pre><span></span>- RELATIVE_URLS = False
+ RELATIVE_URLS = True
</pre></div>
</div>

<p>変更できたら、Githubに公開します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ make github
</pre></div></div>

<p>今回の例ですと、こちらのURLから確認できます → <a href="https://akimach.github.io/note/" class="autolink" rel="nofollow noopener" target="_blank">https://akimach.github.io/note/</a></p>

<p>現段階では何もファイルを入れてないので、以下の画像のようなページになっています。</p>

<p><a href="https://camo.qiitausercontent.com/27e18ded4d49a4effecb2e3c547bc0ae9adb463d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30336235373962302d356564332d343830342d643863372d3034653236323962373531352e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/27e18ded4d49a4effecb2e3c547bc0ae9adb463d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30336235373962302d356564332d343830342d643863372d3034653236323962373531352e6a706567" alt="a02.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/03b579b0-5ed3-4804-d8c7-04e2629b7515.jpeg"></a></p>

<p>参考：</p>

<ul>
<li><a href="http://docs.getpelican.com/en/stable/" class="autolink" rel="nofollow noopener" target="_blank">http://docs.getpelican.com/en/stable/</a></li>
</ul>

<h2>
<span id="jupyter-notebook" class="fragment"></span><a href="#jupyter-notebook"><i class="fa fa-link"></i></a>Jupyter Notebook</h2>

<p>あとでPyDataを使ってデータ解析の結果を貼りたいので色々インストールしておきます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pip install ipython jupyter numpy matplotlib scipy pandas scikit-learn seaborn
</pre></div></div>

<p>今回は、デモ用に作った、回帰分析を行うノートブックを使います（以下リンク）。</p>

<p><a href="https://gist.github.com/akimach/b9a102137aa53e75c01ca763e70a0594" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/akimach/b9a102137aa53e75c01ca763e70a0594</a></p>

<p>参考:</p>

<ul>
<li><a href="http://jupyter.org/" class="autolink" rel="nofollow noopener" target="_blank">http://jupyter.org/</a></li>
</ul>

<h2>
<span id="pelican-plugin-for-jupyter-notebooks" class="fragment"></span><a href="#pelican-plugin-for-jupyter-notebooks"><i class="fa fa-link"></i></a>Pelican plugin for Jupyter Notebooks</h2>

<p>Jupyter Notebookのためのプラグインを追加します。先ほどの<code>note</code>ディレクトリ内で以下のコマンドを実行してください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone https://github.com/danielfrg/pelican-ipynb.git plugins/ipynb
</pre></div></div>

<p>cloneできたら設定ファイル<code>pelicanconf.py</code>に以下の3行を追加します。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">pelicanconf.py</span></div>
<div class="highlight"><pre><span></span>MARKUP = ('md', 'ipynb')
PLUGIN_PATHS = ['./plugins']
PLUGINS = ['ipynb.markup']
</pre></div>
</div>

<p>次に<code>content</code>ディレクトリ直下に自分が作成したNotebookとその<code>pynb-meta</code>ファイルを作ります。今回の例ですと、<code>linear-regression-with-python.ipynb</code>と<code>linear-regression-with-python.ipynb-meta</code>を作ることになります。</p>

<p><code>pynb-meta</code>ファイルではタイトルや日付を入れることになっていますが、今回は以下のようにしました。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">linear-regression-with-python.ipynb-meta</span></div>
<div class="highlight"><pre><span></span>Title: Linear regression of Boston Housing Dataset using PyData
Slug: linear-regression-with-python
Date: 2017-11-06 0:00
Category: Notebook
Tags: Python, PyData
</pre></div>
</div>

<p>参考ですが、現段階ではディレクトリ構造は以下のようになっています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ tree
.
├── Makefile
├── README.md
├── content
│   ├── linear-regression-with-python.ipynb
│   └── linear-regression-with-python.ipynb-meta
├── fabfile.py
├── output
│   ├── archives.html
│   ├── authors.html
│   ├── categories.html
│   ├── feeds
│   │   └── all.atom.xml
│   ├── index.html
│   ├── tags.html
（略）
</pre></div></div>

<p>では、Githubにパブリッシュします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ make github
</pre></div></div>

<p>確認してみましょう。</p>

<p><a href="https://akimach.github.io/note/linear-regression-with-python.html" class="autolink" rel="nofollow noopener" target="_blank">https://akimach.github.io/note/linear-regression-with-python.html</a></p>

<p>以下の画像のようなページが公開されました。</p>

<p><a href="https://camo.qiitausercontent.com/3fab65434c16d73687097adf0c737314eacbd746/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f63333465303232662d636630652d373534362d313531332d6133313534393233373764662e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3fab65434c16d73687097adf0c737314eacbd746/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f63333465303232662d636630652d373534362d313531332d6133313534393233373764662e6a706567" alt="a03.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/c34e022f-cf0e-7546-1513-a315492377df.jpeg"></a></p>

<p><a href="https://camo.qiitausercontent.com/5915f7a1acf357a811003905f0443f31ff236636/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f38343236323131352d326537622d323732612d643561622d3532643062393036376265622e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5915f7a1acf357a811003905f0443f31ff236636/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f38343236323131352d326537622d323732612d643561622d3532643062393036376265622e6a706567" alt="a05.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/84262115-2e7b-272a-d5ab-52d0b9067beb.jpeg"></a></p>

<p>数式も書けることが確認できますね。</p>

<p>参考 :</p>

<ul>
<li><a href="https://github.com/danielfrg/pelican-ipynb" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/danielfrg/pelican-ipynb</a></li>
</ul>

<h2>
<span id="オプション-pelican-themes" class="fragment"></span><a href="#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-pelican-themes"><i class="fa fa-link"></i></a>(オプション) Pelican Themes</h2>

<p>Pelicanにはたくさんのテーマが公開されていて、以下のページから確認できます。</p>

<ul>
<li><a href="http://pelicanthemes.com/" class="autolink" rel="nofollow noopener" target="_blank">http://pelicanthemes.com/</a></li>
</ul>

<p>今回は上のページにあった<strong>blueidea</strong>にテーマを買えてみます。</p>

<p>まずPelicanのThemesをダウンロードします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$  git clone --recursive https://github.com/getpelican/pelican-themes ~/pelican-themes
</pre></div></div>

<p>次に<code>pelicanconf.py</code>に以下の一行を追加します。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">pelicanconf.py</span></div>
<div class="highlight"><pre><span></span>THEME = '/Users/akimach/pelican-themes/blueidea'
</pre></div>
</div>

<p>コミットして、その後にGibhubにパブリッシュします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ make github
</pre></div></div>

<p>青くなりましたー。</p>

<p><a href="https://camo.qiitausercontent.com/6d74977ccd9fa5adba5b577c267e4384c832017d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30393038366131322d366663342d633766322d313738642d3932396462343136646662302e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6d74977ccd9fa5adba5b577c267e4384c832017d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30393038366131322d366663342d633766322d313738642d3932396462343136646662302e6a706567" alt="a06.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/09086a12-6fc4-c7f2-178d-929db416dfb0.jpeg"></a></p>

<p>ぜひ自分好みのテーマを使ってみてください。</p>

<p>参考：</p>

<ul>
<li><a href="https://github.com/getpelican/pelican-themes" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/getpelican/pelican-themes</a></li>
</ul>

<h2>
<span id="オプション-r" class="fragment"></span><a href="#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-r"><i class="fa fa-link"></i></a>(オプション) R</h2>

<p>ターミナルで<code>R</code>のインタプリタを立ち上げて以下のコマンドを実行します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ R
&gt; devtools::install_github('IRkernel/IRkernel')
&gt; IRkernel::installspec(name = 'ir33', displayname = 'R 3.3')
</pre></div></div>

<p>Rを選択してノートブックを作成することができます。</p>

<p><a href="https://camo.qiitausercontent.com/1d33db3945dc201e0c52ffc4c9c982053e57d216/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f63636632386162652d666333392d346262312d376236342d6535333934326663353165622e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1d33db3945dc201e0c52ffc4c9c982053e57d216/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f63636632386162652d666333392d346262312d376236342d6535333934326663353165622e6a706567" alt="a07.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/ccf28abe-fc39-4bb1-7b64-e53942fc51eb.jpeg"></a></p>

<p>サンプルにPythonと同じように回帰分析を行うRのノートブックを作成しました（以下リンク）。</p>

<p>（雑談：ステップワイズ変数選択法による重回帰分析の際は、Pythonだとライブラリが見つからないので、Rを使っています）</p>

<ul>
<li><a href="https://gist.github.com/akimach/c149c6bd039815f40728ba8e0ca74b51" rel="nofollow noopener" target="_blank">akimach/linear-regression-with-r.ipynb</a></li>
<li><a href="https://gist.github.com/akimach/cbfff748cac1358c2231c3ef28c23d19" rel="nofollow noopener" target="_blank">akimach/linear-regression-with-r.ipynb-meta</a></li>
</ul>

<p>では、公開してみます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ make github
</pre></div></div>

<ul>
<li><a href="https://akimach.github.io/note/linear-regression-with-r.html" class="autolink" rel="nofollow noopener" target="_blank">https://akimach.github.io/note/linear-regression-with-r.html</a></li>
</ul>

<p><a href="https://camo.qiitausercontent.com/afa1446132cc221091a9b50b58e8b86d261e4012/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f65343162306234642d623764642d313230302d353364342d3137363434396330353030662e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/afa1446132cc221091a9b50b58e8b86d261e4012/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f65343162306234642d623764642d313230302d353364342d3137363434396330353030662e6a706567" alt="a08.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/e41b0b4d-b7dd-1200-53d4-176449c0500f.jpeg"></a></p>

<p>Rでもノートブックを公開することができましたー。めでたし。</p>

<p>参考：</p>

<ul>
<li><a href="https://github.com/IRkernel/IRkernel" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/IRkernel/IRkernel</a></li>
</ul>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>貯まったノートブックはできるだけアウトプットしていきたいです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />6位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/46fc21431876b191972a">Esoteric TensorFlow</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-20 20:18:47</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[DeepLearning]</b> <b>[Brainf*ck]</b> <b>[TensorFlow]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p><a href="https://camo.qiitausercontent.com/c05d9767d8261dabdb582867a7e9d9cbd36d5ae1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f66386263383466352d313233642d303733362d343866392d6461366134623962366630342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c05d9767d8261dabdb582867a7e9d9cbd36d5ae1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f66386263383466352d313233642d303733362d343866392d6461366134623962366630342e706e67" alt="tf.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/f8bc84f5-123d-0736-48f9-da6a4b9b6f04.png"></a></p>

<p>TensorFlowはニューラルネットやディープラーニングのためのライブラリということばかりが取り上げられがちですが、グラフを構築することで一連の計算処理を実現するというデータフロープログラミング(DFP)の側面も持ち合わせています。</p>

<p>TensorFlowのグラフはif文やwhile文と同じようなAPIを持ち合わせているので、一般的なプログラミング言語と同等の表現力を持っています。つまり、C言語やPythonで書けるソートや探索といったアルゴリズムは、TensorFlowのグラフでも書けるわけです。</p>

<p>今回、TensorFlowによるデータフロープログラミングで、FizzBuzz・バブルソート・クイックソート・2分探索・Brainf*ckなどのアルゴリズムやEso Langを実装してみたので、ちょっとしたTIPSともにTensorFlowの普段と違った面白さを紹介してみたいと思います。</p>

<p>実装したコードは以下のレポジトリに公開しています。他アルゴリズムのコードもあるので興味がある方はぜひご覧ください。なお、TensorFlowのバージョンは、1.2.0以降に対応しています。1.0と1.1では動かないです。</p>

<ul>
<li><a href="https://github.com/akimach/EsotericTensorFlow" rel="nofollow noopener" target="_blank">akimach/EsotericTensorFlow</a></li>
</ul>

<h2>
<span id="fizzbuzz" class="fragment"></span><a href="#fizzbuzz"><i class="fa fa-link"></i></a>FizzBuzz</h2>

<p>まずは、TensorFlowのグラフだけでFizz Buzzを書いてみましょう。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="k">class</span> <span class="nc">FizzBuzz</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cond</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">],</span>
                            <span class="n">shape_invariants</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)],</span>
                            <span class="n">back_prop</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span> <span class="c1"># tf.equal(tf.mod(i, 15), 0)</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">)),</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">'FizzBuzz'</span><span class="p">),</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                        <span class="k">lambda</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">'Fizz'</span><span class="p">),</span>
                        <span class="k">lambda</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                                <span class="k">lambda</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">'Buzz'</span><span class="p">),</span>
                                <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">fizzbuzz</span> <span class="o">=</span> <span class="n">FizzBuzz</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">ix</span><span class="p">,</span> <span class="n">array</span> <span class="o">=</span> <span class="n">fizzbuzz</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</pre></div></div>

<p>実行結果は以下のとおりです。ちゃんとFizzBuzzできていますね。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>['1' '2' 'Fizz' '4' 'Buzz' 'Fizz' '7' '8' 'Fizz' 'Buzz' '11' 'Fizz' '13'
 '14' 'FizzBuzz' '16' '17' 'Fizz' '19' 'Buzz' 'Fizz' '22' '23' 'Fizz'
 'Buzz' '26' 'Fizz' '28' '29' 'FizzBuzz' '31' '32' 'Fizz' '34' 'Buzz'
 'Fizz' '37' '38' 'Fizz' 'Buzz' '41' 'Fizz' '43' '44' 'FizzBuzz' '46' '47'
 'Fizz' '49' 'Buzz']
</pre></div></div>

<h2>
<span id="バブルソート" class="fragment"></span><a href="#%E3%83%90%E3%83%96%E3%83%AB%E3%82%BD%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>バブルソート</h2>

<p>定番のバブルソートもTensorFlowのグラフで実装できます。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BubbleSort</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

        <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer_loop</span><span class="p">,</span> <span class="n">loop_vars</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">],</span>
                <span class="n">shape_invariants</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(),</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)],</span>
                <span class="n">parallel_iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">back_prop</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">outer_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inner_loop</span><span class="p">,</span> <span class="n">loop_vars</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">],</span>
                    <span class="n">shape_invariants</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(),</span> <span class="n">j</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(),</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)],</span>
                    <span class="n">parallel_iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">back_prop</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loop</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">loop</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">inner_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
                    <span class="k">lambda</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">scatter_nd_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="p">[[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="n">j</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span>
                    <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">body</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mf">7.</span><span class="p">,</span><span class="mf">3.</span><span class="p">,</span><span class="mf">8.</span><span class="p">])</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sorted_array</span> <span class="o">=</span> <span class="n">BubbleSort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sorted_array</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sorted_array</span> <span class="o">=</span> <span class="n">BubbleSort</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sorted_array</span><span class="p">)</span>
</pre></div></div>

<p>実行結果は以下のとおりです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>[ 1.  7.  3.  8.]
[ 1.  3.  7.  8.]
[ 0.69646919  0.28613933  0.22685145  0.55131477  0.71946897  0.42310646
  0.9807642   0.68482974  0.4809319   0.39211752  0.34317802  0.72904971
  0.43857224  0.0596779   0.39804426  0.73799541  0.18249173  0.17545176
  0.53155137  0.53182759]
[ 0.0596779   0.17545176  0.18249173  0.22685145  0.28613933  0.34317802
  0.39211752  0.39804426  0.42310646  0.43857224  0.4809319   0.53155137
  0.53182759  0.55131477  0.68482974  0.69646919  0.71946897  0.72904971
  0.73799541  0.9807642 ]
</pre></div></div>

<h2>
<span id="brainfck" class="fragment"></span><a href="#brainfck"><i class="fa fa-link"></i></a>BrainF*ck</h2>

<p>もちろんプログラミング言語もデータフローグラフで作ることができます。<a href="https://ja.wikipedia.org/wiki/Brainfuck" rel="nofollow noopener" target="_blank">BrainF*ck</a>を実装してみましょう。長くなってしまうので、実行結果だけ示します。BrainF*ckのコードはGithubに公開してあります。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="c1"># Code abridged</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">src_A</span> <span class="o">=</span> <span class="s1">'++++++[&gt; ++++++++++ &lt; -]&gt; +++++.'</span>
    <span class="n">pc</span><span class="p">,</span> <span class="n">tape</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">jumps</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">BrainFuck</span><span class="p">(</span><span class="n">src_A</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="c1">#=&gt; A</span>

    <span class="n">src_helloworld</span> <span class="o">=</span><span class="s1">'''</span>
<span class="s1">+++++++++[&gt;++++++++&gt;+++++++++++&gt;+++++&lt;&lt;&lt;-]&gt;.&gt;++.+++++++..+++.&gt;-.</span>
<span class="s1">------------.&lt;++++++++.--------.+++.------.--------.&gt;+.</span>
<span class="s1">'''</span>
    <span class="n">pc</span><span class="p">,</span> <span class="n">tape</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">jumps</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">BrainFuck</span><span class="p">(</span><span class="n">src_helloworld</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="c1">#=&gt; Hello, world!</span>
</pre></div></div>

<h2>
<span id="クイックソートや2分探索は" class="fragment"></span><a href="#%E3%82%AF%E3%82%A4%E3%83%83%E3%82%AF%E3%82%BD%E3%83%BC%E3%83%88%E3%82%842%E5%88%86%E6%8E%A2%E7%B4%A2%E3%81%AF"><i class="fa fa-link"></i></a>クイックソートや2分探索は？</h2>

<p>他にも以下のようなアルゴリズムを実装してみたので、興味がある方は<a href="https://github.com/akimach/EsotericTensorFlow" rel="nofollow noopener" target="_blank">Githubのレポジトリ</a>を覗いてみてください。</p>

<ul>
<li><a href="https://github.com/akimach/EsotericTensorFlow/blob/master/euclidean_algorithm.py" rel="nofollow noopener" target="_blank">ユークリッドの互除法</a></li>
<li><a href="https://github.com/akimach/EsotericTensorFlow/blob/master/insertion_sort.py" rel="nofollow noopener" target="_blank">挿入ソート</a></li>
<li><a href="https://github.com/akimach/EsotericTensorFlow/blob/master/quick_sort.py" rel="nofollow noopener" target="_blank">クイックソート</a></li>
<li><a href="https://github.com/akimach/EsotericTensorFlow/blob/master/linear_search.py" rel="nofollow noopener" target="_blank">線形探索</a></li>
<li><a href="https://github.com/akimach/EsotericTensorFlow/blob/master/binary_search.py" rel="nofollow noopener" target="_blank">2分探索</a></li>
<li><a href="https://github.com/akimach/EsotericTensorFlow/blob/master/hq9plus.py" rel="nofollow noopener" target="_blank">HQ9+</a></li>
<li>etc</li>
</ul>

<hr>

<h1>
<span id="tips" class="fragment"></span><a href="#tips"><i class="fa fa-link"></i></a>TIPS</h1>

<h2>
<span id="データフロープログラミング" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%95%E3%83%AD%E3%83%BC%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>データフロープログラミング</h2>

<p>データフロープログラミングとは聞き慣れない言葉ですが、手続き型プログラミングやオブジェクト指向プログラミング、関数型プログラミングと肩並べるプログラミングパラダイムの１つでで、データに着目してデータに対する操作の流れを記述していきます。TensorFlowにデータフロープログラミングを採用している背景には並行処理と親和性の高さがあり、マルチコアやマルチプロセッサだけではなく、Googleのような企業が有する何千何万台ものマシンをうまく協調的かつ分散的に計算処理を行いたいという動機があると思われます。</p>

<p>次のサンプルコードで考えてみます。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tfgraphviz</span> <span class="kn">as</span> <span class="nn">tfg</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"x"</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"y"</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"a"</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"b"</span><span class="p">)</span>

<span class="n">mul_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"mul_op"</span><span class="p">)</span>
<span class="n">assign_x_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mul_op</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"assign_x"</span><span class="p">)</span>
<span class="n">assign_y_1_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"assign_add_y_1"</span><span class="p">)</span>
<span class="n">assign_y_2_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="n">assign_y_1_op</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"assign_add_y_2"</span><span class="p">)</span>
<span class="n">assign_y_3_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="n">assign_y_2_op</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"assign_add_y_3"</span><span class="p">)</span>
<span class="n">assign_y_4_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="n">assign_y_3_op</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"assign_add_y_4"</span><span class="p">)</span>
<span class="n">sum_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">assign_x_op</span><span class="p">,</span> <span class="n">assign_y_2_op</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"sum_op"</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">tfg</span><span class="o">.</span><span class="n">board</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre></div></div>

<p>上のサンプルコードでは、以下の図のようなデータフローグラフが構築されています。あるノードに対する関連する処理が明確になるので、例の変数xに対する処理、変数yに対する処理といったように役割分担が可能になり、並列的に処理を行うことができるようになります。</p>

<p><a href="https://camo.qiitausercontent.com/7d72eb311a4bb9c9af9778a466e0128f595e1a45/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30396565313837312d396461332d653339622d323331362d3234313738613836333935612e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7d72eb311a4bb9c9af9778a466e0128f595e1a45/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f30396565313837312d396461332d653339622d323331362d3234313738613836333935612e6a706567" alt="data-flow-graph.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/09ee1871-9da3-e39b-2316-24178a86395a.jpeg"></a></p>

<p>C言語で同等の処理を書いてみると、以下のようになるかと思います。言語自体の制約としてあるデータとそれに対する処理が入り混じって書けてしまうため、並列に処理するのは難しくなっているようです。</p>

<div class="code-frame" data-lang="c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">mul</span><span class="p">,</span> <span class="n">sum</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">mul</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">mul</span><span class="p">;</span>
    <span class="n">y</span><span class="o">++</span><span class="p">;</span>
    <span class="n">y</span><span class="o">++</span><span class="p">;</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">y</span><span class="o">++</span><span class="p">;</span>
    <span class="n">y</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="制御構文" class="fragment"></span><a href="#%E5%88%B6%E5%BE%A1%E6%A7%8B%E6%96%87"><i class="fa fa-link"></i></a>制御構文</h2>

<p>TensorFlowのグラフでは、以下のAPIを使うことで制御構文を記述することができます。</p>

<ul>
<li><code>tf.cond(...)</code></li>
<li><code>tf.while_loop(...)</code></li>
<li>(Optional) <code>tf.case(...)</code>
</li>
</ul>

<h3>
<span id="tfcond" class="fragment"></span><a href="#tfcond"><i class="fa fa-link"></i></a>tf.cond(...)</h3>

<p><code>tf.cond(...)</code>はif文に相当するノードです。Bool値を返すノードpredの値に応じて、関数を呼び出します。<code>true_fn</code>と<code>flase_fn</code>には、lambdaまたは関数を指定する必要があります。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
    <span class="n">pred</span><span class="p">,</span><span class="c1"># 条件判定</span>
    <span class="n">true_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c1"># Trueの場合に呼び出される関数</span>
    <span class="n">false_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c1"># Falseの場合に呼び出される関数</span>
<span class="p">)</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/2ce418523da44d4c9895f4a3e21ee172abda8b0b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31363364393836332d336338652d303766612d353537312d6131653462343431333836622e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2ce418523da44d4c9895f4a3e21ee172abda8b0b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f31363364393836332d336338652d303766612d353537312d6131653462343431333836622e6a706567" alt="tf-cond.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/163d9863-3c8e-07fa-5571-a1e4b441386b.jpeg"></a></p>

<h4>
<span id="サンプルコード" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>サンプルコード</h4>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">InteractiveSession</span><span class="p">()</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">b</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span> <span class="c1">#=&gt; 7</span>
</pre></div></div>

<ul>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/cond" rel="nofollow noopener" target="_blank">tf.cond - TensorFlow API r1.3</a></li>
</ul>

<h3>
<span id="tfwhile_loop" class="fragment"></span><a href="#tfwhile_loop"><i class="fa fa-link"></i></a>tf.while_loop(...)</h3>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span>
    <span class="n">cond</span><span class="p">,</span> <span class="c1"># 条件判定</span>
    <span class="n">body</span><span class="p">,</span> <span class="c1"># condがTrueの場合に実行される処理</span>
    <span class="n">loop_vars</span><span class="p">,</span> <span class="c1"># condとbodyに渡されるノード</span>
    <span class="n">shape_invariants</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c1"># tf.while_loop(...)の返り値のshape</span>
<span class="p">)</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/626ebc42a8998e8040a6965aca3cf88bdc445a15/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f35326232343364612d383636392d396263302d643764662d6165313036653466633833642e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/626ebc42a8998e8040a6965aca3cf88bdc445a15/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f35326232343364612d383636392d396263302d643764662d6165313036653466633833642e6a706567" alt="tf-while-loop.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/52b243da-8669-9bc0-d7df-ae106e4fc83d.jpeg"></a></p>

<h4>
<span id="サンプルコード-1" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89-1"><i class="fa fa-link"></i></a>サンプルコード</h4>

<p>以下は公式ドキュメントにあるサンプルコードです。<code>cond</code>と<code>body</code>に渡されるノード<code>i</code>の値が10より小さい時に繰り返して<code>body</code>を処理します。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">InteractiveSession</span><span class="p">()</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">less</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">r</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span> <span class="c1">#=&gt; 10</span>
</pre></div></div>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="n">tf</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
    <span class="n">pred</span><span class="p">,</span><span class="c1"># Condition</span>
    <span class="n">true_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c1"># Process to be executed when cond is True</span>
    <span class="n">false_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c1"># Process to be executed when cond is False</span>
<span class="p">)</span>
</pre></div></div>

<ul>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/while_loop" rel="nofollow noopener" target="_blank">tf.while_loop - TensorFlow API r1.3</a></li>
</ul>

<h2>
<span id="値の交換" class="fragment"></span><a href="#%E5%80%A4%E3%81%AE%E4%BA%A4%E6%8F%9B"><i class="fa fa-link"></i></a>値の交換</h2>

<p>ソートアルゴリズムを実装する際には、値の交換（スワップ）が必要になります。整列対象となる配列をtf.Variable</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="c1">#=&gt; [0, 1, 2, 3, 4]</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># インデックス1と4の要素を交換する</span>
<span class="n">swap</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">scatter_update</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
<span class="n">tf</span><span class="o">.</span><span class="n">InteractiveSession</span><span class="p">()</span>
<span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">swap</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span> <span class="c1">#=&gt; [0, 4, 2, 3, 1]</span>
</pre></div></div>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>普段見慣れないプログラミングパラダイムですが、パズル感覚でロジックを書けるので面白かったです。データフロープログラミングあたりの部分は、あまり自身がないのでツッコミを入れていただければうれしいです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />7位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/a10154e0f0e6dcaafdd0">怠け者のためのディープラーニング入門 - ハイパーパラメータのチューニング</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-23 13:50:16</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[MachineLearning]</b> <b>[DeepLearning]</b> <b>[Keras]</b> <b>[TensorFlow]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>学習率やドロップアウト率、活性化関数を選定するハイパーパラメータのチューニングについて紹介します。</p>

<ul>
<li><a href="https://qiita.com/akimach/items/522834b42e3be7d3a326" id="reference-953a85f5ba299196f70a">イントロ</a></li>
<li><a href="https://qiita.com/akimach/items/e9088ab1b98a06ae9454" id="reference-a27bae8f34205194966c">Scikit-learn・Keras</a></li>
<li><a href="https://qiita.com/akimach/items/f572310b01079515eaf5" id="reference-1183acf08ed5efd9d248">モデルの性能指標・評価方法</a></li>
<li>データの前処理・データ拡張</li>
<li>早期終了(early stopping)・正則化</li>
<li>転移学習</li>
<li>ハイパーパラメータのチューニング ← 今ココ！</li>
<li>モデル圧縮</li>
<li>応用</li>
</ul>

<h1>
<span id="ハイパーパラメータのチューニング" class="fragment"></span><a href="#%E3%83%8F%E3%82%A4%E3%83%91%E3%83%BC%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>ハイパーパラメータのチューニング</h1>

<p>ハイパーパラメータ(Hypter Parameter)は、機械学習アルゴリズムに対して設計者が決めないといけない値です。ハイパーパラメータはモデルの性能を左右する値なので頭を悩ませる問題です。取り分け、より幅広く深く層を持つニューラルネットでは多くのパラメータを設定する必要があります。ニューラルネットにおいて次のようなハイパーパラメータが具体的に挙げられます。</p>

<blockquote>
<ul>
<li>学習係数：一回のイテレーションで進む学習の度合い</li>
<li>イテレーション数：学習を繰り返す最大の回数</li>
<li>モーメンタム：最適な重みを導き出すための勾配法の高速化パラメーター</li>
<li>隠れ層のユニット数：隠れ層の数。基本的に大きければ大きいほどよいが、過学習には注意</li>
<li>活性化関数の数・種類：Sigmoid、Tanh、ReLUなどの関数の種類と、「層をいくつ、どのタイミングで組み入れるか」などの調整</li>
<li>Dropoutの数：学習時のパラメーターのいくつかを任意の確立で使わないようにし、汎化性能を上げる仕組み</li>
</ul>

<p><a href="http://www.atmarkit.co.jp/ait/articles/1512/16/news020.html" rel="nofollow noopener" target="_blank">深層学習の判別精度を向上させるコツとActive Learning (1/2)</a></p>
</blockquote>

<p>試行錯誤でエイヤとハイパーパラメータを決めてしまうこともあるのですが、以下のような自動でパラメータを探索してくれる手法が提案されています。本記事では簡単で分かりやすいグリッドサーチを紹介します。</p>

<ul>
<li>グリッドサーチ（Grid Search）</li>
<li>ランダムサーチ（Random Search）</li>
<li>ベイズ最適化（Bayesian Optimization）</li>
</ul>

<h1>
<span id="グリッドサーチ" class="fragment"></span><a href="#%E3%82%B0%E3%83%AA%E3%83%83%E3%83%89%E3%82%B5%E3%83%BC%E3%83%81"><i class="fa fa-link"></i></a>グリッドサーチ</h1>

<p>グリッドサーチは設計者によって指定された複数のハイパーパラメータの組合せを網羅的に探索する手法です。しらみつぶしに調べていくためパラメータの数に応じて計算量が大きくなってしまうのが難点です。ランダムサーチのほうが良いパラメータを見つけてくれるという報告もありますが、分かりやすさをとってこちらを紹介しました。</p>

<p>また適当に決めてしまうよりも、学習率はとりあえず「0.0001, 0.001, 0.01」、ノード数は「64, 128, 256, 512」のなかからグリッドサーチを実行して決定するほうが説明する際に説得力があると思います。</p>

<p>斎藤康毅『ゼロから作るDeep Learning』にも書いてあるのですが、経験的に近い値よりも大胆に数値を変えたほうがいいように思います。したがって、数値のハイパーパラメータは2のべき乗や10のべき乗のような指数スケールで候補を挙げていくとよいでしょう。例えば、64,128,256,512,1024,...のような感じです。</p>

<h2>
<span id="サンプルコード" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>サンプルコード</h2>

<p>グリッドサーチを実行するには、<code>sklearn.model_selection.GridSearchCV</code>を使います。内部的では交差検証を使って性能指標を算出してハイパーパラメータの組合せの甲乙を決めています。</p>

<p>次のような流れでプログラムを組みます。</p>

<ul>
<li>ハイパーパラメータの候補を列挙する</li>
<li>
<code>keras.wrappers.scikit_learn.KerasClassifier</code>によりKerasのモデルをScikit-Learn APIに適した形に変換する</li>
<li>
<code>sklearn.model_selection.GridSearchCV</code>により、ハイパーパラメータの候補、交差検証のためのデータセットの分割数、性能指標を設定します</li>
<li>
<code>model.fit(データセット, ラベル)</code>によりグリッドサーチの実行を行う</li>
</ul>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">optimizers</span>
<span class="kn">from</span> <span class="nn">keras.wrappers.scikit_learn</span> <span class="kn">import</span> <span class="n">KerasClassifier</span>

<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"activation"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"relu"</span><span class="p">,</span> <span class="s2">"tanh"</span><span class="p">,</span> <span class="s2">"sigmoid"</span><span class="p">,</span> <span class="p">],</span>
    <span class="s2">"learning_rate"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>
    <span class="s2">"units"</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">mlp</span><span class="p">(</span><span class="n">activation</span><span class="o">=</span><span class="s2">"relu"</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="n">activation</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="n">activation</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'sigmoid'</span><span class="p">))</span>
    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'binary_crossentropy'</span><span class="p">,</span>
              <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizers</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">),</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">'accuracy'</span><span class="p">,])</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="n">n_data</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">n_class</span> <span class="o">=</span> <span class="n">n_data</span><span class="o">//</span><span class="mi">2</span>
<span class="n">X_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X_positive</span><span class="p">,</span> <span class="n">X_negative</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">]</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">KerasClassifier</span><span class="p">(</span><span class="n">build_fn</span><span class="o">=</span><span class="n">mlp</span><span class="p">,</span> <span class="n">nb_epoch</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">'accuracy'</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s2">"Accuracy:"</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s2">"Hyper Parameters:"</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div></div>

<p>実行結果 :</p>

<p>候補に上げたハイパーパラメータの中では、活性化関数はReLu、学習率は0.01、中間層のノード数は64が最適であることが分かりました。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Accuracy: 0.915
Hyper Parameters: {'activation': 'relu', 'learning_rate': 0.01, 'units': 64}
</pre></div></div>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>今回はグリッドサーチを紹介しました。今までは手作業でもうちょっと学習率を上げてみて…のような感じでヒューリスティックにハイパーパラメータを決めていたのですが、今回グリッドサーチを使ってみて気楽に値が求められたので非常に便利でした。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />8位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/e9088ab1b98a06ae9454">怠け者のためのディープラーニング入門 - Scikit-learn・Keras</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-23 13:47:51</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[MachineLearning]</b> <b>[DeepLearning]</b> <b>[Keras]</b> <b>[TensorFlow]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>本記事ではKerasとScikit-learnの簡単な使い方を紹介します。</p>

<ul>
<li><a href="https://qiita.com/akimach/items/522834b42e3be7d3a326" id="reference-85efbffde3b4e3ee8673">イントロ</a></li>
<li>Scikit-learn・Keras ← 今ココ！</li>
<li>モデルの性能指標・評価方法</li>
<li>データの前処理・データ拡張</li>
<li>早期終了(early stopping)・正則化</li>
<li>転移学習</li>
<li>ハイパーパラメータのチューニング</li>
<li>モデル圧縮</li>
<li>応用</li>
</ul>

<h1>
<span id="scikit-learn" class="fragment"></span><a href="#scikit-learn"><i class="fa fa-link"></i></a>Scikit-learn</h1>

<p><a href="https://camo.qiitausercontent.com/e9816512474699a7b5903712f35d9e97aa093c13/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f32646430643163612d393362312d393733362d323731612d3039393364613130333038382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e9816512474699a7b5903712f35d9e97aa093c13/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f32646430643163612d393362312d393733362d323731612d3039393364613130333038382e706e67" alt="365630.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/2dd0d1ca-93b1-9736-271a-0993da103088.png"></a></p>

<p><a href="http://scikit-learn.org/stable/" rel="nofollow noopener" target="_blank">Scikit-learn</a>はPythonによる機械学習ではよく使われるライブラリで、サポートベクターマシンや決定木、ランダムフォレストなど有名な機械学習アルゴリズムをサポートしています。他のライブラリもScikit-learnを似せてインタフェースを作っていることが多いので、覚えておくとあとでつぶしが効くと思います。</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pip3 install scikit-learn
</pre></div></div>

<h2>
<span id="基本的な使い方" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>基本的な使い方</h2>

<ol>
<li>機械学習アルゴリズムのオブジェクト（例：<code>model</code>）を生成する

<ul>
<li>この段階で各種アルゴリズムのハイパーパラメータを設定する</li>
</ul>
</li>
<li>
<code>model.fit(学習データ, 学習データの正解ラベル)</code>で、学習や計算させる</li>
<li>
<code>model.score(テストデータ, テストデータの正解ラベル)</code>で、学習させたモデルを評価する</li>
<li>
<code>model.predict(データ)</code>でデータのクラス分類を予測する</li>
</ol>

<h2>
<span id="サンプルコード" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>サンプルコード</h2>

<p>以下のコードは、サポートベクトルマシンによる簡単な2クラス分類の例です。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Accuracy:"</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="n">X_new</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
</pre></div></div>

<p>実行結果 :</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Accuracy: 0.5
Prediction result: [0 1]
</pre></div></div>

<h2>
<span id="おまけ--データのシャッフルと分割" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91--%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%B7%E3%83%A3%E3%83%83%E3%83%95%E3%83%AB%E3%81%A8%E5%88%86%E5%89%B2"><i class="fa fa-link"></i></a>おまけ : データのシャッフルと分割</h2>

<p>機械学習だけではなくデータのシャッフルや分割などの機能も提供しています。これらの機能はNumpyを使って書けなくはないのですが、以下の関数は便利なので以降の記事でも使っていきます。</p>

<ul>
<li>
<code>sklearn.utils.shuffle(...)</code> : 

<ul>
<li>データセットをシャッフルする</li>
</ul>
</li>
<li>
<code>sklearn.model_selection.train_test_split(...)</code> : 

<ul>
<li>データセットを分割する</li>
<li>
<code>test_size=</code>に全体のデータセットに占めるテストデータの割合を設定する。デフォルトは<code>0.25</code>。int型でテストデータ数を指定も可能</li>
</ul>
</li>
</ul>

<p><code>sklearn.model_selection.train_test_split(...)</code>を使うことで、<a href="https://ja.wikipedia.org/wiki/%E4%BA%A4%E5%B7%AE%E6%A4%9C%E8%A8%BC" rel="nofollow noopener" target="_blank">ホールド・アウト法</a>と呼ばれるシンプルな検証手法を用いることができます。検証手法に関しては次の記事で紹介します。</p>

<p>サンプルコード : </p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># Randomly permute</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="c1"># Split dataset</span>
<span class="c1"># Train : Test = 8 : 2</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span>\
    <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Train:"</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Test:"</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div></div>

<p>実行結果 : </p>

<p>10個のデータが学習用に8個、テスト用に2個となるように分割されました。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="n">Train</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="mi">8</span><span class="p">,)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="mi">2</span><span class="p">,)</span>
</pre></div></div>

<h1>
<span id="keras" class="fragment"></span><a href="#keras"><i class="fa fa-link"></i></a>Keras</h1>

<p><a href="https://camo.qiitausercontent.com/f19f9bfd7b8c6fa82e8434cca3b76c3cc6f4ae66/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f38306334333764372d376436362d643435332d346136322d3262313736666466303533322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f19f9bfd7b8c6fa82e8434cca3b76c3cc6f4ae66/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f38306334333764372d376436362d643435332d346136322d3262313736666466303533322e706e67" alt="68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6b657261732e696f2f696d672f6b657261732d6c6f676f2d6d656469756d2e706e67.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/80c437d7-7d66-d453-4a62-2b176fdf0532.png"></a></p>

<p><a href="https://keras.io/" rel="nofollow noopener" target="_blank">Keras</a>はTensorFlowやTheano、CNTK上で動かくすることができる高水準なニューラルネットワークライブラリです。適度の抽象化されているため、TensorFlowでベタに書くよりも直観的に分かりやすくなっています。Googleで働いているエンジニアがもともとはTheanoを対象にして作り、のちにTensorFlowとCNTKをサポートするようになりました。また、<a href="https://keras.io/ja/" rel="nofollow noopener" target="_blank">公式ドキュメント</a>が日本語にも翻訳されているため、日本人にも馴染みやすいものとなっています。</p>

<h2>
<span id="インストール-1" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB-1"><i class="fa fa-link"></i></a>インストール</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pip3 install keras
</pre></div></div>

<h2>
<span id="基本的な使い方-1" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9-1"><i class="fa fa-link"></i></a>基本的な使い方</h2>

<ol>
<li>
<code>Sequential()</code>でSequentialモデルを生成します</li>
<li>
<code>model.add(...)</code>でレイヤーや機能を追加していきます</li>
<li>
<code>model.complile(...)</code>で学習アルゴリズムや損失（誤差）関数、評価関数を決定します</li>
<li>
<code>model.fit(学習データ, 学習データの正解ラベル)</code>で、学習を行います</li>
<li>
<code>model.evaluate(テストデータ, テストデータの正解ラベル)</code>で、学習済みモデルの性能を評価する</li>
<li>
<code>model.predict(データ)</code>でデータのクラス分類を予測する</li>
</ol>

<h2>
<span id="サンプルコード-1" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89-1"><i class="fa fa-link"></i></a>サンプルコード</h2>

<p>ちょっと長くなりますが、2つの異なる正規分布にもとづく乱数のデータ群（青とオレンジ。図1）に対して、2クラス分類（ロジスティック回帰）を行います。</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/76dc954b2283d8f5a61ecb8f3f16e02e810f638e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f65663236336435662d623137612d643137632d613333352d3865666135653437646432322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/76dc954b2283d8f5a61ecb8f3f16e02e810f638e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f65663236336435662d623137612d643137632d613333352d3865666135653437646432322e706e67" alt="ダウンロード.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/ef263d5f-b17a-d17c-a335-8efa5e47dd22.png"></a><br>
図1 : 2つの異なる正規分布に基づく乱数</p>
</blockquote>

<p>プログラムの流れは以下のようになります。</p>

<ol>
<li>データの生成して学習データとテストデータを8:2で分割する</li>
<li>モデル（2層のパーセプトロン）を構築する</li>
<li>学習アルゴリズムをSGD、性能指標に精度(Accuracy)を使用する</li>
<li>ミニバッチサイズを20、エポック数を10としてモデルを学習させる</li>
<li>テストデータを用いて学習済みモデルの精度を評価する</li>
<li>未知データを生成して学習済みモデルにより予測を行う</li>
</ol>

<p>今回用いるニューラルネットは以下に示すような中間層（隠れ層）が2つあるネットワークになります。</p>

<blockquote>
<p><a href="https://camo.qiitausercontent.com/306dc49faac5b9471a49e638bf92d0dfb26a3385/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f64306434653637342d666337632d386563652d653964302d3261373430303065663730662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/306dc49faac5b9471a49e638bf92d0dfb26a3385/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f64306434653637342d666337632d386563652d653964302d3261373430303065663730662e706e67" alt="material.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/d0d4e674-fc7c-8ece-e9d0-2a74000ef70f.png"></a><br>
図2 : 2層パーセプトロン</p>
</blockquote>

<ul>
<li>入力層 : 200 x 2</li>
<li>中間層1

<ul>
<li>ノード数 : 128</li>
<li>活性化関数 : ReLu</li>
</ul>
</li>
<li>中間層2

<ul>
<li>ノード数 : 128</li>
<li>活性化関数 : ReLu</li>
</ul>
</li>
<li>出力層 : 200 x 1

<ul>
<li>シグモイド関数</li>
</ul>
</li>
<li>損失関数

<ul>
<li>binary_crossentropy</li>
</ul>
</li>
<li>性能指標

<ul>
<li>精度(accuracy)</li>
</ul>
</li>
<li>評価手法

<ul>
<li>ホールド・アウト法</li>
</ul>
</li>
<li>学習アルゴリズム

<ul>
<li>SGD</li>
<li>学習率 : 0.01
*　バッチサイズ : 20
*　エポック数 : 10</li>
</ul>
</li>
</ul>

<p>サンプルコード : </p>

<div class="code-frame" data-lang="py">
<div class="code-lang"><span class="bold">mlp.py</span></div>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">optimizers</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Setup dataset</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">n_data</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">n_class</span> <span class="o">=</span> <span class="n">n_data</span><span class="o">//</span><span class="mi">2</span>
<span class="n">X_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X_positive</span><span class="p">,</span> <span class="n">X_negative</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">]</span>
<span class="c1"># Split dataset</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span>\
        <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># Build a model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'sigmoid'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'binary_crossentropy'</span><span class="p">,</span>
              <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizers</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">'accuracy'</span><span class="p">,])</span>
<span class="c1"># Training</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Evaluation</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Loss:"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"Accuracy:"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Prediction</span>
<span class="n">X_positive_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X_negative_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_positive_new</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_negative_new</span><span class="p">))</span>
</pre></div>
</div>

<p>実行結果 : （TensorFlowによる出力は一部省略）</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Using TensorFlow backend.
Epoch 1/10
160/160 [==============================] - 0s - loss: 0.6587 - acc: 0.7938
Epoch 2/10
160/160 [==============================] - 0s - loss: 0.6303 - acc: 0.8625
Epoch 3/10
160/160 [==============================] - 0s - loss: 0.6040 - acc: 0.8625
Epoch 4/10
160/160 [==============================] - 0s - loss: 0.5795 - acc: 0.8812
Epoch 5/10
160/160 [==============================] - 0s - loss: 0.5562 - acc: 0.8875
Epoch 6/10
160/160 [==============================] - 0s - loss: 0.5345 - acc: 0.8875
Epoch 7/10
160/160 [==============================] - 0s - loss: 0.5143 - acc: 0.8937
Epoch 8/10
160/160 [==============================] - 0s - loss: 0.4950 - acc: 0.9000
Epoch 9/10
160/160 [==============================] - 0s - loss: 0.4770 - acc: 0.9125
Epoch 10/10
160/160 [==============================] - 0s - loss: 0.4599 - acc: 0.9125
32/40 [=======================&gt;......] - ETA: 0s
Loss: 0.464164888859 Accuracy: 0.9
[[ 0.57916182]
 [ 0.50237983]
 [ 0.70500255]
 [ 0.63764608]
 [ 0.33048654]]
[[ 0.42043626]
 [ 0.32738858]
 [ 0.27511841]
 [ 0.32091939]
 [ 0.32354838]]
</pre></div></div>

<h2>
<span id="おまけ--モデルの可視化" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91--%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%8F%AF%E8%A6%96%E5%8C%96"><i class="fa fa-link"></i></a>おまけ : モデルの可視化</h2>

<p><code>keras.utils.vis_util</code>の関数を用いることで、モデルの可視化を行うことができます。見返したり他人に説明する際に便利なので紹介します。依存しているパッケージとして<code>graphviz</code>と<code>pydot</code>があるのでインストールしてください。</p>

<div class="code-frame" data-lang="py">
<div class="code-lang"><span class="bold">plot_mlp.py</span></div>
<div class="highlight"><pre><span></span><span class="c1"># mlp.pyに追加してください</span>
<span class="c1"># ... 略 ...</span>
<span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">plot_model</span>
<span class="c1"># ... 略 ...</span>
<span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">plot_model</span>
<span class="n">plot_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="s1">'model.png'</span><span class="p">)</span>
<span class="sd">"""</span>
<span class="sd">Jupyter Notebook上で可視化する場合は以下のようにする : </span>
<span class="sd">from IPython.display import SVG</span>
<span class="sd">g = model_to_dot(model=m)</span>
<span class="sd">SVG(g.create(prog='dot', format='svg'))</span>
<span class="sd">"""</span>
</pre></div>
</div>

<p>実行結果 : </p>

<p>以下のようなファイルが出力されます。</p>

<p><a href="https://camo.qiitausercontent.com/295d10169ae8e3b180072e08d356a0e9f330adef/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f61643163616132622d343432332d323533662d313636632d3737646638353839653232612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/295d10169ae8e3b180072e08d356a0e9f330adef/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f61643163616132622d343432332d323533662d313636632d3737646638353839653232612e706e67" alt="model.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/ad1caa2b-4423-253f-166c-77df8589e22a.png"></a></p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>KerasとScikit-learnの基本的な使い方について述べました。他にもKerasとScikit-learnには便利な機能があるので、その都度紹介したいと思います。またNumpyやPandas、Matplotlibなどのライブラリの使い方を知っているとより便利ですが、Web上に紹介記事がたくさんあるのでそちらをご参照ください</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akimachさんの<br />9位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/akimach/items/d9341df56e3bb63b33d5">怠け者のためのディープラーニング入門 - Early Stopping(早期終了)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-23 13:51:36</center>
	</td>
	<td style="width:200px;">
		@akimach<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/119738/profile-images/1487782554">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[MachineLearning]</b> <b>[DeepLearning]</b> <b>[Keras]</b> <b>[TensorFlow]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<ul>
<li><a href="https://qiita.com/akimach/items/522834b42e3be7d3a326" id="reference-1b3bc5e1acc5e37474dc">イントロ</a></li>
<li><a href="https://qiita.com/akimach/items/e9088ab1b98a06ae9454" id="reference-d7e57bfbd0611ebcc2b2">Scikit-learn・Keras</a></li>
<li><a href="https://qiita.com/akimach/items/f572310b01079515eaf5" id="reference-d22d4ddfb81f42f5c9d5">モデルの性能指標・評価方法</a></li>
<li>データの前処理・データ拡張</li>
<li>早期終了(early stopping)・正則化 ← 今ココ！</li>
<li>転移学習</li>
<li><a href="https://qiita.com/akimach/items/a10154e0f0e6dcaafdd0" id="reference-da0f52464731ef7abed8">ハイパーパラメータのチューニング</a></li>
<li>モデル圧縮</li>
<li>応用</li>
</ul>

<h1>
<span id="early-stopping早期終了早期打ち切り" class="fragment"></span><a href="#early-stopping%E6%97%A9%E6%9C%9F%E7%B5%82%E4%BA%86%E6%97%A9%E6%9C%9F%E6%89%93%E3%81%A1%E5%88%87%E3%82%8A"><i class="fa fa-link"></i></a>Early Stopping(早期終了・早期打ち切り)</h1>

<p>エポック数は、データセットを何回学習するか表す数値で、前回紹介したハイパーパラメータの仲間でもあります。今までは決め打ちで設定していたのですが、ニューラルネットの学習がうまく行っていない場合にそれを打ち切る手法として早期終了（Early Stopping）があります。この方法では、学習データセットおよびテストデータセットとは別に検証用データセットを元いて誤差のような値を監視し前回のエポックに比べて増えた場合学習を終了します。</p>

<p><a href="https://camo.qiitausercontent.com/a3f42881a7d985c9440f95a8b487f78ff0cb8764/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f39396135643762632d653134332d353132372d386538622d6239363738313661303963652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a3f42881a7d985c9440f95a8b487f78ff0cb8764/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131393733382f39396135643762632d653134332d353132372d386538622d6239363738313661303963652e706e67" alt="005.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/119738/99a5d7bc-e143-5127-8e8b-b967816a09ce.png"></a></p>

<p>Early Stoppingを使うことで、過学習(Over fitting)に陥ることを避けつつ、簡単にエポック数を考える手間を減らすことができます。</p>

<h2>
<span id="サンプルコード" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>サンプルコード</h2>

<div class="code-frame" data-lang="py"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">optimizers</span>
<span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Setup dataset</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="n">n_data</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">n_class</span> <span class="o">=</span> <span class="n">n_data</span><span class="o">//</span><span class="mi">2</span>
<span class="n">X_positive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X_negative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_class</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X_positive</span><span class="p">,</span> <span class="n">X_negative</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n_class</span><span class="p">]</span>
<span class="c1"># Split dataset</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span>\
        <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_validation</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_validation</span> <span class="o">=</span>\
        <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># Build a model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">'sigmoid'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'binary_crossentropy'</span><span class="p">,</span>
              <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizers</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">'accuracy'</span><span class="p">,])</span>
<span class="c1"># Training</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_validation</span><span class="p">,</span> <span class="n">y_validation</span><span class="p">),</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">EarlyStopping</span><span class="p">()])</span>

<span class="c1"># Evaluation</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Loss:"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"Accuracy:"</span><span class="p">,</span> <span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div></div>

<p>実行結果 :</p>

<p>エポック数が77のところで学習が打ち切られていることが分かります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Epoch 1/1000
128/128 [==============================] - 0s - loss: 0.6646 - acc: 0.8125 - val_loss: 0.6481 - val_acc: 0.7500
Epoch 2/1000
128/128 [==============================] - 0s - loss: 0.6425 - acc: 0.8750 - val_loss: 0.6291 - val_acc: 0.8125
...略...
Epoch 75/1000
128/128 [==============================] - 0s - loss: 0.1816 - acc: 0.9609 - val_loss: 0.2505 - val_acc: 0.8438
Epoch 76/1000
128/128 [==============================] - 0s - loss: 0.1808 - acc: 0.9609 - val_loss: 0.2504 - val_acc: 0.8438
Epoch 77/1000
128/128 [==============================] - 0s - loss: 0.1800 - acc: 0.9609 - val_loss: 0.2509 - val_acc: 0.8438
32/40 [=======================&gt;......] - ETA: 0s
Loss: 0.242067420483 Accuracy: 0.925
</pre></div></div>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>エポック数の試行錯誤と過学習を避ける方法として、Early Stoppingを紹介しました。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
