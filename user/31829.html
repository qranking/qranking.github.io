<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (KeithYokoma)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (KeithYokoma さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1299</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/fb6872a72a75e9b6f2e6">イマドキなイカした Android のオープンソースライブラリ集</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-23 17:54:09</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Android]</b> <b>[gradle]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>今から Android やるならチェックしておきたい、厳選イカしたオープンソースライブラリ一覧。</p>

<p>support-v4 や support-v7-appcompat などは公式のものなので割愛。</p>

<h1>
<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h1>

<h2>
<span id="android-sdk" class="fragment"></span><a href="#android-sdk"><i class="fa fa-link"></i></a>Android SDK</h2>

<ul>
<li><a href="https://github.com/embarkmobile/android-sdk-installer" rel="nofollow noopener" target="_blank">Android SDK Installer</a></li>
</ul>

<p>公式からダウンロードしてポチポチとチェックを入れてはダウンロードして…が面倒くさいならコレ。<br>
シェルからコマンド一発でダウンロード出来るので、CI で使うのにも便利。</p>

<ul>
<li><a href="https://github.com/pbreault/adb-idea" rel="nofollow noopener" target="_blank">ADB Idea</a></li>
</ul>

<p>AndroidStudio および IntelliJ 用のプラグインで、IDE から ADB コマンドを簡単に利用できるようにするためのもの。メニューから選択してコマンドを実行できるようにしてくれる。</p>

<h1>
<span id="コード最適化" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E6%9C%80%E9%81%A9%E5%8C%96"><i class="fa fa-link"></i></a>コード最適化</h1>

<h2>
<span id="di-コンテナ" class="fragment"></span><a href="#di-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A"><i class="fa fa-link"></i></a>DI コンテナ</h2>

<ul>
<li><a href="https://github.com/square/dagger" rel="nofollow noopener" target="_blank">Dagger</a></li>
</ul>

<p>square 社の Android および Java 向け DI コンテナ。<br>
<code>javax.inject.Inject</code> アノテーションを使う。<br>
コンパイル時にコードを生成する。</p>

<ul>
<li><a href="https://github.com/hnakagawa/proton" rel="nofollow noopener" target="_blank">Proton</a></li>
</ul>

<p>Android 向け DI コンテナ。<br>
<code>javax.inject.Inject</code> アノテーションを使う。<br>
実行時にインスタンスを注入する。</p>

<ul>
<li><a href="https://github.com/JakeWharton/butterknife" rel="nofollow noopener" target="_blank">ButterKnife</a></li>
</ul>

<p>View のインジェクションに特化している。</p>

<ul>
<li><a href="https://github.com/roboguice/roboguice" rel="nofollow noopener" target="_blank">RoboGuice</a></li>
</ul>

<p>Google が提供する Guice の Android 向けラッパー。<br>
<code>javax.inject.Inject</code> アノテーションを使う他、独自にインジェクション用のアノテーションも提供している。</p>

<h2>
<span id="view-の生成" class="fragment"></span><a href="#view-%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>View の生成</h2>

<ul>
<li><a href="https://github.com/RomainPiel/Michelangelo" rel="nofollow noopener" target="_blank">Michelangelo</a></li>
</ul>

<p>アノテーションを用いてカスタムビューのコードを整理できる。<br>
ビューがインフレートされた後に実行したい処理をアノテーションで示すことも出来る。</p>

<h2>
<span id="リソース" class="fragment"></span><a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>リソース</h2>

<ul>
<li><a href="https://github.com/JakeWharton/paraphrase" rel="nofollow noopener" target="_blank">Paraphrase</a></li>
</ul>

<p>文字列リソースのフォーマットをよりリーダブルに、かつデバッガブルにするためのライブラリ。<br>
文字列リソースのフォーマットに関するプログラミングのエラーが、ランタイムではなくコンパイル時に判明するようになる。</p>

<h2>
<span id="ユーティリティ" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3"><i class="fa fa-link"></i></a>ユーティリティ</h2>

<ul>
<li><a href="https://github.com/excilys/androidannotations" rel="nofollow noopener" target="_blank">AndroidAnnotations</a></li>
</ul>

<p>アノテーションを使って、コンパイル時にコードを自動生成させることで、プログラマの書くコード量を減らすライブラリ。<br>
DI コンテナとして、View やシステムサービス、リソース、Intent に含まれる Extra を注入することが出来る他、メソッドがメインスレッドで実行されるかバックグラウンドスレッドで実行されるかも制御できる。</p>

<ul>
<li><a href="https://github.com/nohana/Amalgam/" rel="nofollow noopener" target="_blank">Amalgam</a></li>
</ul>

<p>Apache Commons のような Commons ライブラリで、Android 用。<br>
<code>Context#getSystemService(String)</code> のラッパーや、各種 Manager 類のラッパーがある。</p>

<ul>
<li><a href="https://github.com/google/guava" rel="nofollow noopener" target="_blank">Guava</a></li>
</ul>

<p>Apache Commons のような Commons ライブラリ。<br>
Java 向けに各種のユーティリティが取り揃えられている。</p>

<h2>
<span id="機種依存解決" class="fragment"></span><a href="#%E6%A9%9F%E7%A8%AE%E4%BE%9D%E5%AD%98%E8%A7%A3%E6%B1%BA"><i class="fa fa-link"></i></a>機種依存解決</h2>

<ul>
<li><a href="https://github.com/mixi-inc/Android-Device-Compatibility" rel="nofollow noopener" target="_blank">AndroidDeviceCompatibility</a></li>
</ul>

<p>機種ごとの依存を吸収する為のライブラリ。</p>

<h2>
<span id="モジュール化" class="fragment"></span><a href="#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E5%8C%96"><i class="fa fa-link"></i></a>モジュール化</h2>

<ul>
<li><a href="https://github.com/hnakagawa/android-promise" rel="nofollow noopener" target="_blank">android-promise</a></li>
</ul>

<p>非同期な処理をモジュール化する為のライブラリ。</p>

<h1>
<span id="ui-コンポーネント" class="fragment"></span><a href="#ui-%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>UI コンポーネント</h1>

<h2>
<span id="pull-to-refresh" class="fragment"></span><a href="#pull-to-refresh"><i class="fa fa-link"></i></a>Pull to refresh</h2>

<ul>
<li><a href="https://github.com/chrisbanes/ActionBar-PullToRefresh" rel="nofollow noopener" target="_blank">ActionBar PullToRefresh</a></li>
</ul>

<p>引っ張ると ActionBar に更新の表示が出る UI コンポーネント。</p>

<ul>
<li><a href="https://github.com/chrisbanes/Android-PullToRefresh/" rel="nofollow noopener" target="_blank">Android PullToRefresh</a></li>
</ul>

<p>Twitter スタイルの引っ張り更新の UI コンポーネント。<br>
現在メンテは終了しており、使うのであれば、上記の ActionBar PullToRefresh を使うほうが良い。</p>

<h2>
<span id="actionbar" class="fragment"></span><a href="#actionbar"><i class="fa fa-link"></i></a>ActionBar</h2>

<ul>
<li><a href="https://github.com/ManuelPeinado/FadingActionBar" rel="nofollow noopener" target="_blank">FadingActionBar</a></li>
</ul>

<p>ActionBar にフェードアウト効果を適用するためのライブラリ。</p>

<ul>
<li><a href="https://github.com/ManuelPeinado/GlassActionBar" rel="nofollow noopener" target="_blank">GlassActionBar</a></li>
</ul>

<p>ActionBar に透かし窓のような効果を適用するためのライブラリ。</p>

<h2>
<span id="webview" class="fragment"></span><a href="#webview"><i class="fa fa-link"></i></a>WebView</h2>

<ul>
<li><a href="https://github.com/mogoweb/chromium_webview" rel="nofollow noopener" target="_blank">Chromium WebView</a></li>
</ul>

<p>KitKat で導入された、Chromium エンジンの WebView のバックポートライブラリ。<br>
これを使えば、OS バージョンや機種ごとの WebKit の実装依存問題が解決できるかもしれない。</p>

<h2>
<span id="textfont" class="fragment"></span><a href="#textfont"><i class="fa fa-link"></i></a>Text・Font</h2>

<ul>
<li><a href="https://github.com/rockerhieu/emojicon" rel="nofollow noopener" target="_blank">emojicon</a></li>
</ul>

<p>TextView 上に絵文字を表示するためのライブラリ。</p>

<ul>
<li><a href="https://github.com/MarsVard/IonIconView" rel="nofollow noopener" target="_blank">IonIconView</a></li>
</ul>

<p>ionicons.com で提供されているアイコンを View に表示可能にするライブラリ。</p>

<ul>
<li><a href="https://github.com/JoanZapata/android-iconify" rel="nofollow noopener" target="_blank">Android Iconify</a></li>
</ul>

<p>FontAwesome の各種フォントをアプリ内で使えるようにするライブラリ。</p>

<ul>
<li><a href="https://github.com/chrisjenx/Calligraphy" rel="nofollow noopener" target="_blank">Calligraphy</a></li>
</ul>

<p>カスタムフォントを容易に扱えるようにしてくれるライブラリ。</p>

<h2>
<span id="calendar" class="fragment"></span><a href="#calendar"><i class="fa fa-link"></i></a>Calendar</h2>

<ul>
<li><a href="https://github.com/tyczj/ExtendedCalendarView" rel="nofollow noopener" target="_blank">ExtendedCalendarView</a></li>
</ul>

<p>カレンダーのコンテンツを保持する DB とセットで、イベントを表示できるカレンダー View を提供してくれるライブラリ。</p>

<ul>
<li><a href="https://github.com/tyczj/GoogleCalendarView" rel="nofollow noopener" target="_blank">GoogleCalendarView</a></li>
</ul>

<p>Google 公式のカレンダーアプリからのバックポート。</p>

<h2>
<span id="エフェクト" class="fragment"></span><a href="#%E3%82%A8%E3%83%95%E3%82%A7%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a>エフェクト</h2>

<ul>
<li><a href="https://github.com/kikoso/android-stackblur" rel="nofollow noopener" target="_blank">Android StackBlur</a></li>
</ul>

<p>Bitmap にブラーのエフェクトをかける。</p>

<ul>
<li><a href="https://github.com/CyberAgent/android-gpuimage" rel="nofollow noopener" target="_blank">GPUImage Android</a></li>
</ul>

<p>iOS 向けに作られていた GPU Image の Android 移植版。</p>

<h2>
<span id="通知" class="fragment"></span><a href="#%E9%80%9A%E7%9F%A5"><i class="fa fa-link"></i></a>通知</h2>

<ul>
<li><a href="https://github.com/JohnPersano/SuperToasts" rel="nofollow noopener" target="_blank">SuperToasts</a></li>
</ul>

<p>Toast を拡張して、ボタンを置いたり見た目を少し変えたりすることが出来るようになるライブラリ。</p>

<ul>
<li><a href="https://github.com/keyboardsurfer/Crouton" rel="nofollow noopener" target="_blank">Crouton</a></li>
</ul>

<p>標準の Toast の代替として、Context に依存してカスタム可能な Toast を提供する。</p>

<h2>
<span id="レイアウト" class="fragment"></span><a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88"><i class="fa fa-link"></i></a>レイアウト</h2>

<ul>
<li><a href="https://github.com/ManuelPeinado/ImageLayout" rel="nofollow noopener" target="_blank">ImageLayout</a></li>
</ul>

<p>画像の上に View を配置するための特別なレイアウトコンポーネント。<br>
独自の座標系を持って管理している。</p>

<h2>
<span id="listviewgridview" class="fragment"></span><a href="#listviewgridview"><i class="fa fa-link"></i></a>ListView・GridView</h2>

<ul>
<li><a href="https://github.com/emilsjolander/StickyListHeaders" rel="nofollow noopener" target="_blank">StickyListHeaders</a></li>
</ul>

<p>Instagram のような、ListView のスクロールに追従してくるヘッダを提供する。</p>

<ul>
<li><a href="https://github.com/TonicArtos/StickyGridHeaders" rel="nofollow noopener" target="_blank">StickyGridHeaders</a></li>
</ul>

<p>上記ライブラリの GridView 版。</p>

<ul>
<li><a href="https://github.com/etsy/AndroidStaggeredGrid" rel="nofollow noopener" target="_blank">Android StaggeredGrid</a></li>
</ul>

<p>高さの異なるグリッドを扱える。</p>

<ul>
<li><a href="https://github.com/SimonVT/adapterviewanimator" rel="nofollow noopener" target="_blank">AdapterView Animator</a></li>
</ul>

<p>AdapterView の行を追加したときのアニメーションを実現するヘルパライブラリ。</p>

<ul>
<li><a href="https://github.com/commonsguy/cwac-touchlist" rel="nofollow noopener" target="_blank">cwac-touchlist</a></li>
</ul>

<p>List のドラッグ・アンド・ドロップを実現するライブラリ。</p>

<h2>
<span id="viewpager" class="fragment"></span><a href="#viewpager"><i class="fa fa-link"></i></a>ViewPager</h2>

<ul>
<li><a href="https://github.com/jfeinstein10/JazzyViewPager" rel="nofollow noopener" target="_blank">JazzyViewPager</a></li>
</ul>

<p>スワイプ時のアニメーションをカスタマイズできる。</p>

<ul>
<li><a href="https://github.com/JakeWharton/Android-ViewPagerIndicator" rel="nofollow noopener" target="_blank">Android ViewPagerIndicator</a></li>
</ul>

<p>ViewPager に追随して位置表示する View。</p>

<h2>
<span id="dialog" class="fragment"></span><a href="#dialog"><i class="fa fa-link"></i></a>Dialog</h2>

<ul>
<li><a href="https://github.com/inmite/android-styled-dialogs" rel="nofollow noopener" target="_blank">Android Styled Dialogs</a></li>
</ul>

<p>ダイアログにテーマでスタイルを適用出来るようにするためのライブラリ。</p>

<h2>
<span id="imageview" class="fragment"></span><a href="#imageview"><i class="fa fa-link"></i></a>ImageView</h2>

<ul>
<li><a href="https://github.com/MostafaGazar/CustomShapeImageView" rel="nofollow noopener" target="_blank">CustomShape ImageView</a></li>
</ul>

<p>画像をくり抜いて、様々な形に出来る ImageView。</p>

<ul>
<li><a href="https://github.com/vinc3m1/RoundedImageView" rel="nofollow noopener" target="_blank">Rounded ImageView</a></li>
</ul>

<p>角丸の ImageView を作れるライブラリ。</p>

<ul>
<li><a href="https://github.com/chrisbanes/PhotoView" rel="nofollow noopener" target="_blank">PhotoView</a></li>
<li><a href="https://github.com/sephiroth74/ImageViewZoom" rel="nofollow noopener" target="_blank">ImageViewZoom</a></li>
</ul>

<p>画像の拡大縮小機能を持つ ImageView。</p>

<h2>
<span id="チャート" class="fragment"></span><a href="#%E3%83%81%E3%83%A3%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>チャート</h2>

<ul>
<li><a href="https://bitbucket.org/danielnadeau/holographlibrary" rel="nofollow noopener" target="_blank">Holo Graph Library</a></li>
</ul>

<p>Holo スタイルのグラフ・チャートを作るライブラリ。</p>

<ul>
<li><a href="https://code.google.com/p/achartengine/" rel="nofollow noopener" target="_blank">AChartEngine</a></li>
</ul>

<p>こちらも、グラフ・チャートを作るライブラリ。</p>

<h2>
<span id="interaction" class="fragment"></span><a href="#interaction"><i class="fa fa-link"></i></a>Interaction</h2>

<ul>
<li><a href="https://github.com/romannurik/Android-SwipeToDismiss" rel="nofollow noopener" target="_blank">Android Swipe To Dismiss</a></li>
</ul>

<p>View をスワイプして消す操作を実現するライブラリ。</p>

<ul>
<li><a href="https://github.com/timroes/EnhancedListView" rel="nofollow noopener" target="_blank">EnhancedListView</a></li>
</ul>

<p>Gmail のように、行をスワイプすることで削除を実行するインタラクションを実現でき、かつ、Undo の機能も有する ListView の拡張。</p>

<h2>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h2>

<ul>
<li><a href="https://github.com/umano/AndroidSlidingUpPanel" rel="nofollow noopener" target="_blank">Android Sliding Up Panel</a></li>
</ul>

<p>Google Play Music のように、下からせり出してくるパネルを表示するライブラリ。</p>

<ul>
<li><a href="https://github.com/gabrielemariotti/cardslib" rel="nofollow noopener" target="_blank">CardsLib</a></li>
</ul>

<p>カード UI を構築するためのライブラリセット。</p>

<ul>
<li><a href="https://github.com/Todd-Davies/ProgressWheel" rel="nofollow noopener" target="_blank">ProgressWheel</a></li>
</ul>

<p>ぐるぐる回るプログレスバーをカスタマイズするライブラリ。</p>

<ul>
<li><a href="https://github.com/Bearded-Hen/Android-Bootstrap" rel="nofollow noopener" target="_blank">Android Bootstrap</a></li>
</ul>

<p>FontAwesome と共に Bootstrap スタイルのボタン類を使えるようにするライブラリ。</p>

<ul>
<li><a href="https://github.com/siyamed/android-satellite-menu" rel="nofollow noopener" target="_blank">Android Satellite Menu</a></li>
</ul>

<p>Path みたいなメニューを構築するライブラリ。</p>

<ul>
<li><a href="https://github.com/JakeWharton/NineOldAndroids" rel="nofollow noopener" target="_blank">NineOldAndroids</a></li>
</ul>

<p>API 11 から登場したアニメーションフレームワークをバックポートするライブラリ。</p>

<ul>
<li><a href="https://github.com/Prototik/HoloEverywhere" rel="nofollow noopener" target="_blank">Holo Everywhere</a></li>
</ul>

<p>Holo テーマのバックポートライブラリ。</p>

<ul>
<li><a href="https://github.com/LarsWerkman/HoloColorPicker" rel="nofollow noopener" target="_blank">Holo ColorPicker</a></li>
</ul>

<p>色を選択する View のライブラリ。</p>

<ul>
<li><a href="https://github.com/throrin19/Android-Validator" rel="nofollow noopener" target="_blank">Android Validator</a></li>
</ul>

<p>入力のバリデーションのためのライブラリ。</p>

<ul>
<li><a href="https://code.google.com/p/android-gifview/" rel="nofollow noopener" target="_blank">android-gifview</a></li>
</ul>

<p>Gif アニメーションを再生可能な View のライブラリ。</p>

<h1>
<span id="シリアライズ" class="fragment"></span><a href="#%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>シリアライズ</h1>

<h2>
<span id="json" class="fragment"></span><a href="#json"><i class="fa fa-link"></i></a>Json</h2>

<ul>
<li><a href="https://code.google.com/p/google-gson/" rel="nofollow noopener" target="_blank">Google Gson</a></li>
</ul>

<p>リフレクションによってマッピングするライブラリ。</p>

<ul>
<li><a href="http://jackson.codehaus.org/" rel="nofollow noopener" target="_blank">Jackson</a></li>
</ul>

<p>超高速にシリアライズ・デシリアライズできるライブラリ。</p>

<h1>
<span id="データベース" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>データベース</h1>

<h2>
<span id="orm" class="fragment"></span><a href="#orm"><i class="fa fa-link"></i></a>ORM</h2>

<ul>
<li><a href="https://github.com/greenrobot/greenDAO" rel="nofollow noopener" target="_blank">GreenDAO</a></li>
</ul>

<p>グリーンだよ！いいんだよ！</p>

<p>スキーマ、エンティティをそれぞれ定義するクラスを使ってマッピングする。</p>

<ul>
<li><a href="https://github.com/pardom/ActiveAndroid" rel="nofollow noopener" target="_blank">Active Android</a></li>
</ul>

<p>エンティティクラスの宣言にアノテーションを付けてマッピングする。</p>

<h1>
<span id="イベントバス" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%90%E3%82%B9"><i class="fa fa-link"></i></a>イベントバス</h1>

<p>使い方は<a href="http://qiita.com/KeithYokoma/items/793aaac6994c9242808f" id="reference-1124897c9979dd48aabf">こちら</a>。</p>

<ul>
<li><a href="https://github.com/square/otto" rel="nofollow noopener" target="_blank">otto</a></li>
</ul>

<p>Guava ベースの Android 向け軽量イベントバス。</p>

<ul>
<li><a href="https://github.com/greenrobot/EventBus" rel="nofollow noopener" target="_blank">EventBus</a></li>
</ul>

<p>otto より機能的に拡張のあるイベントバス。</p>

<h1>
<span id="デバッグ支援" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E6%94%AF%E6%8F%B4"><i class="fa fa-link"></i></a>デバッグ支援</h1>

<h2>
<span id="view" class="fragment"></span><a href="#view"><i class="fa fa-link"></i></a>View</h2>

<ul>
<li><a href="https://github.com/JakeWharton/scalpel" rel="nofollow noopener" target="_blank">scalpel</a></li>
</ul>

<p>View の階層構造を 3D 表示するためのツール。</p>

<h2>
<span id="リソース-1" class="fragment"></span><a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9-1"><i class="fa fa-link"></i></a>リソース</h2>

<ul>
<li><a href="https://github.com/JakeWharton/madge" rel="nofollow noopener" target="_blank">Madge</a></li>
</ul>

<p>Bitmap がオリジナルのサイズで表示されているかどうかを一目見て分かるようにする。</p>

<h2>
<span id="クラッシュログ" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%83%AD%E3%82%B0"><i class="fa fa-link"></i></a>クラッシュログ</h2>

<ul>
<li><a href="https://github.com/SalomonBrys/Native-Crash-Handler" rel="nofollow noopener" target="_blank">Native Crash Handler</a></li>
</ul>

<p>Native コードのエラーハンドリングとして、SIGSEGV などを検出して Java の例外を生成してくれる。<br>
これによって、Google Play などで拾いきれなかったクラッシュのログを収集できるようになる。</p>

<h2>
<span id="ログ出力" class="fragment"></span><a href="#%E3%83%AD%E3%82%B0%E5%87%BA%E5%8A%9B"><i class="fa fa-link"></i></a>ログ出力</h2>

<ul>
<li><a href="https://github.com/JakeWharton/hugo" rel="nofollow noopener" target="_blank">hugo</a></li>
</ul>

<p>アノテーションによるメソッドコールのロギングライブラリ。</p>

<ul>
<li><a href="http://deploygate.com/" rel="nofollow noopener" target="_blank">deploygate</a></li>
</ul>

<p>ログ収集だけでなく、apk の配布までも楽ちんにしてくれるサービス。<br>
sdk を組み込めばかなりのことが Web コンソール上で出来る。</p>

<h1>
<span id="画像" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F"><i class="fa fa-link"></i></a>画像</h1>

<h2>
<span id="画像読み込みキャッシュ" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5"><i class="fa fa-link"></i></a>画像読み込み・キャッシュ</h2>

<ul>
<li><a href="https://github.com/nostra13/Android-Universal-Image-Loader" rel="nofollow noopener" target="_blank">Android Universal Image Loader</a></li>
</ul>

<p>各種設定に基いて画像の読み込み・キャッシュ・表示をしてくれるライブラリ。</p>

<ul>
<li><a href="https://github.com/square/picasso" rel="nofollow noopener" target="_blank">picasso</a></li>
</ul>

<p>メソッドチェーンによる画像読み込み・キャッシュ・表示の為のライブラリ。</p>

<h2>
<span id="加工" class="fragment"></span><a href="#%E5%8A%A0%E5%B7%A5"><i class="fa fa-link"></i></a>加工</h2>

<ul>
<li><a href="https://github.com/biokys/cropimage" rel="nofollow noopener" target="_blank">CropImage</a></li>
</ul>

<p>画像の切り抜きをサポートするライブラリ。</p>

<h1>
<span id="ハイブリッドアプリケーション開発" class="fragment"></span><a href="#%E3%83%8F%E3%82%A4%E3%83%96%E3%83%AA%E3%83%83%E3%83%89%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA"><i class="fa fa-link"></i></a>ハイブリッドアプリケーション開発</h1>

<p>ネイティブ実装をベースに、JavaScriptInterface と連携してハイブリッドアプリケーションを開発するフレームワーク。</p>

<ul>
<li><a href="https://github.com/rejasupotaro/Hybridge" rel="nofollow noopener" target="_blank">Hybridge</a></li>
<li><a href="https://github.com/mixi-inc/triaina" rel="nofollow noopener" target="_blank">triaina</a></li>
</ul>

<h1>
<span id="テスト" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>テスト</h1>

<h2>
<span id="テストユーティリティ" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3"><i class="fa fa-link"></i></a>テストユーティリティ</h2>

<ul>
<li><a href="https://github.com/square/fest-android" rel="nofollow noopener" target="_blank">fest-android</a></li>
</ul>

<p>Android のテストに FEST を導入できる。</p>

<ul>
<li><a href="https://github.com/robolectric/robolectric" rel="nofollow noopener" target="_blank">robolectric</a></li>
</ul>

<p>Android のテストの高速化</p>

<ul>
<li><a href="https://code.google.com/p/robotium/" rel="nofollow noopener" target="_blank">Robotium</a></li>
</ul>

<p>UI のテストを Selenium のようにかける、かつ Android フレームワークが持つ UI テストフレームワークを拡張している。</p>

<h2>
<span id="モック" class="fragment"></span><a href="#%E3%83%A2%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>モック</h2>

<ul>
<li><a href="https://code.google.com/p/mockito/" rel="nofollow noopener" target="_blank">Mockito</a></li>
</ul>

<p>いろんなものをモックするためのライブラリ。</p>

<ul>
<li><a href="https://github.com/rejasupotaro/RobotGirl" rel="nofollow noopener" target="_blank">RobotGirl</a></li>
</ul>

<p>ActiveAndroid 向けのフィクスチャライブラリ。</p>

<h1>
<span id="通信" class="fragment"></span><a href="#%E9%80%9A%E4%BF%A1"><i class="fa fa-link"></i></a>通信</h1>

<h2>
<span id="rest" class="fragment"></span><a href="#rest"><i class="fa fa-link"></i></a>REST</h2>

<ul>
<li><a href="https://github.com/square/retrofit" rel="nofollow noopener" target="_blank">Retrofit</a></li>
<li><a href="https://github.com/sahan/RoboZombie" rel="nofollow noopener" target="_blank">RoboZombie</a></li>
</ul>

<p>REST クライアントを簡単に生成するためのライブラリ。</p>

<h2>
<span id="http通信spdy" class="fragment"></span><a href="#http%E9%80%9A%E4%BF%A1spdy"><i class="fa fa-link"></i></a>Http通信・SPDY</h2>

<ul>
<li><a href="https://github.com/square/okhttp" rel="nofollow noopener" target="_blank">okhttp</a></li>
</ul>

<p>http(s) 通信 と SPDY に対応したクライアント。</p>

<ul>
<li><a href="https://android.googlesource.com/platform/frameworks/volley/" rel="nofollow noopener" target="_blank">volley</a></li>
</ul>

<p>通信処理をいろいろ便利にしてくれるユーティリティ。</p>

<h1>
<span id="ビルドスクリプト" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88"><i class="fa fa-link"></i></a>ビルドスクリプト</h1>

<h2>
<span id="gradle" class="fragment"></span><a href="#gradle"><i class="fa fa-link"></i></a>Gradle</h2>

<ul>
<li><a href="https://github.com/gfx/gradle-android-utils" rel="nofollow noopener" target="_blank">Gradle Android Utils</a></li>
</ul>

<p>ビルドスクリプトのユーティリティ集。</p>

<ul>
<li><a href="https://github.com/chrisbanes/gradle-mvn-push" rel="nofollow noopener" target="_blank">Gradle MVN Push</a></li>
</ul>

<p>Maven Repository に aar な成果物を push するヘルパ。</p>

<ul>
<li><a href="https://github.com/JakeWharton/gradle-android-test-plugin" rel="nofollow noopener" target="_blank">Gradle Android Test Plugin</a></li>
</ul>

<p>Gradle で Android のテストを実行するためのヘルパプラグイン。</p>

<h1>
<span id="その他便利系" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E4%BE%BF%E5%88%A9%E7%B3%BB"><i class="fa fa-link"></i></a>その他便利系</h1>

<h2>
<span id="アップデートチェック" class="fragment"></span><a href="#%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>アップデートチェック</h2>

<ul>
<li><a href="https://github.com/rampo/UpdateChecker" rel="nofollow noopener" target="_blank">UpdateChecker</a></li>
</ul>

<p>アップデートがあった時にダイアログを出す。</p>

<h2>
<span id="レビュー" class="fragment"></span><a href="#%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC"><i class="fa fa-link"></i></a>レビュー</h2>

<ul>
<li><a href="https://github.com/kskkbys/Android-RateThisApp" rel="nofollow noopener" target="_blank">RateThisApp</a></li>
</ul>

<p>レビューを促すダイアログを出す。</p>

<h2>
<span id="job-queue" class="fragment"></span><a href="#job-queue"><i class="fa fa-link"></i></a>Job Queue</h2>

<ul>
<li><a href="https://github.com/path/android-priority-jobqueue" rel="nofollow noopener" target="_blank">Priority JobQueue</a></li>
</ul>

<p>優先度付きのジョブキュー</p>

<ul>
<li><a href="https://github.com/jfsso/nirai" rel="nofollow noopener" target="_blank">nirai</a></li>
</ul>

<p>IntentService によるジョブキューの仕組み。<br>
詳しくは<a href="http://qiita.com/jfsso/items/106f48de7ec0612038bb" id="reference-5dcfa1a222a5afeba80a">こちら</a></p>

<h2>
<span id="sharedpreferences" class="fragment"></span><a href="#sharedpreferences"><i class="fa fa-link"></i></a>SharedPreferences</h2>

<ul>
<li><a href="https://github.com/dkunzler/esperandro" rel="nofollow noopener" target="_blank">esperandro</a></li>
</ul>

<p>SharedPreferences のラッパー。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>560</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/c41b22bda8c8d924d8cd">今さら聞けない Activity と Fragment の使い分け</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-16 20:52:45</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Honeycomb から登場した Fragment によって、すべてのコントローラロジックが Activity に集約されてしまう呪縛から解き放たれ、人類は平和を取り戻しました。Fragment はまた、Support Library のメンバとして、Gingerbread 以前の過去世に積み上げた罪業をも消し去ろうとしています。</p>

<p>そんな Fragment ですが、いまいち使い方が分からない、という声も時折耳にします。本稿では、Android アプリケーションの開発を始めて Activity と Fragment について学び、その両者の住み分けに悩んでいる方向けに、効果的な Fragment の作り方を紹介しようと思います。</p>

<h2>
<span id="fragment-がなかった暗黒の時代" class="fragment"></span><a href="#fragment-%E3%81%8C%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E6%9A%97%E9%BB%92%E3%81%AE%E6%99%82%E4%BB%A3"><i class="fa fa-link"></i></a>Fragment がなかった暗黒の時代</h2>

<p>Fragment がなかった時代、人類はどのようにして Android アプリケーションを作っていたのでしょうか。</p>

<h3>
<span id="タブを使った画面の切替" class="fragment"></span><a href="#%E3%82%BF%E3%83%96%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E7%94%BB%E9%9D%A2%E3%81%AE%E5%88%87%E6%9B%BF"><i class="fa fa-link"></i></a>タブを使った画面の切替</h3>

<p>複数のタブを持ち、タブごとに異なるコンテンツを表示するようなアプリケーションを作ると仮定します。</p>

<p>このようなアプリケーションを作るには、以下の手順でタブの機能とコンテンツの表示を実現します。</p>

<ol>
<li>タブ切り替えをハンドリングするホストとなる Activity を作る</li>
<li>タブの数だけ、コンテンツを表示する Activity を作る</li>
</ol>

<p>ざっくりとした手順では数こそ多くないものの、この方法にはいくつかの問題が潜んでいます。</p>

<ol>
<li>Activity という割と大きなオブジェクトを、タブのホストとタブのコンテンツの数だけメモリに乗せないといけない</li>
<li>いくつかの専用のコンポーネントとガッツリ連携しなければ実現できないため、柔軟性に乏しい</li>
</ol>

<h3>
<span id="レイアウトの使い回し" class="fragment"></span><a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%81%AE%E4%BD%BF%E3%81%84%E5%9B%9E%E3%81%97"><i class="fa fa-link"></i></a>レイアウトの使い回し</h3>

<p>Android のレイアウトの仕組み上、xml に以下のようなコードを仕込んでおくと、レイアウトリソースの使い回しが実現できます。</p>

<p><code>&lt;include layout="@layout/hogehoge" android:id="@+id/included_layout"&gt;</code></p>

<p>これは非常に便利な反面、View のレイヤでしか使い回しが効かないので、それを統括するコントローラのロジックまでは使い回しが出来ません。</p>

<h3>
<span id="ダイアログの生成とライフサイクル" class="fragment"></span><a href="#%E3%83%80%E3%82%A4%E3%82%A2%E3%83%AD%E3%82%B0%E3%81%AE%E7%94%9F%E6%88%90%E3%81%A8%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB"><i class="fa fa-link"></i></a>ダイアログの生成とライフサイクル</h3>

<p>ダイアログは、Activity が管理します。Activity にはライフサイクルが有り、ライフサイクルが終わるとその役目も終えなければならず、例えば、画面回転をすると、表示していたダイアログも消えてしまいました。</p>

<p>そのため、ダイアログの表示に関するフラグを持ち越すコードを記述し、そのフラグを見て、新しい Activity がダイアログの表示を継続するかどうか判断しなければなりませんでした。</p>

<h2>
<span id="fragment-の登場による文明開花" class="fragment"></span><a href="#fragment-%E3%81%AE%E7%99%BB%E5%A0%B4%E3%81%AB%E3%82%88%E3%82%8B%E6%96%87%E6%98%8E%E9%96%8B%E8%8A%B1"><i class="fa fa-link"></i></a>Fragment の登場による文明開花</h2>

<p>Honeycomb になり、Fragment は ActionBar と共に颯爽と現れました。<br>
そして、タブ機能を実現するための既存のコンポーネント群は <a href="/Deprecated" class="user-mention js-hovercard" title="Deprecated" data-hovercard-target-type="user" data-hovercard-target-name="Deprecated">@Deprecated</a> となり、代わりに、Fragment の使用を促されるようになりました。</p>

<p>ActionBar により、アプリ内のナビゲーションに関する振る舞いが統一され、それにともなって、ActionBar との組み合わせとして手軽に扱うことの出来る Fragment の使用が推奨されるようになったのです。</p>

<h3>
<span id="fragment-とは" class="fragment"></span><a href="#fragment-%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Fragment とは</h3>

<p>Android Developers の Fragment の Javadoc には、以下のようにあります。</p>

<blockquote>
<p>A Fragment is a piece of an application's user interface or behavior that can be placed in an Activity.</p>
</blockquote>

<p>UI を持ち、その UI の振る舞いを管理する、Activity の中に組み込むことが出来るコンポーネントが Fragment です。つまり、これによって、<code>&lt;include&gt;</code>タグだけでは実現できなかった、コントローラのロジックを使いまわす事ができるようになったのです。</p>

<p>また、ActionBar にかぎらず、ViewPager のような View コンポーネントからも Fragment が取り扱えます。以前のタブと異なり、実装に用いるインタフェースも単純化されたため、タブほどの実装コストも掛けずに同等の機能を実装することが出来るようになりました。</p>

<p>Dialog に関しては、専用の DialogFragment が提供され、Fragment の管理ポリシーに基いて DialogFragment も管理されるようになったため、以前のように、表示に関するフラグを持ったり、そのフラグを持ち越したりと言ったコードを自分で実装する必要がなくなりました。</p>

<h2>
<span id="マルチデバイス時代の到来" class="fragment"></span><a href="#%E3%83%9E%E3%83%AB%E3%83%81%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E6%99%82%E4%BB%A3%E3%81%AE%E5%88%B0%E6%9D%A5"><i class="fa fa-link"></i></a>マルチデバイス時代の到来</h2>

<p>今や Android は、スマートフォンのようなハンドセット端末にとどまらず、タブレット端末でも使われます。そして、iOS のユニバーサルアプリケーションに見られるように、ハンドセット端末とタブレット端末で共通のアプリを配信する仕組みが整備され、1 つのアプリケーションが様々な端末へと配信できるようになりました。</p>

<h3>
<span id="画面の大きさの違いに対応する" class="fragment"></span><a href="#%E7%94%BB%E9%9D%A2%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%95%E3%81%AE%E9%81%95%E3%81%84%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>画面の大きさの違いに対応する</h3>

<p>ハンドセット端末とタブレット端末の違いで最も大きな違いは、画面の大きさです。タブレット端末の方が、より広い場所を使うことが出来るようになります。<br>
この時、ハンドセット端末向けに作られたレイアウトをそのまま表示してしまうと、妙に伽藍とした画面になってしまうことでしょう。これでは、折角の大きく広い画面が無駄になってしまいます。</p>

<p>例えば、あるコンテンツの一覧画面と、各項目の詳細画面があるとします。</p>

<p>ハンドセット端末では、画面が小さいので、それぞれの画面は別の Activity として作るほうがよいでしょう。しかし、タブレット端末では、一覧表示だけ、詳細表示だけでは、かなりのスペースを無駄遣いしてしまいます。そこで、タブレット端末では、一覧表示を左端に寄せ、一覧から項目を選択すると、その左側に詳細表示を行うようにすします。そうすることで、広い画面を有効に活用できます。</p>

<p>このようなとき、一覧表示や詳細表示が、Fragment によってハンドリングされていたら、ハンドセット端末とタブレット端末への対応が、ぐっと楽になります。</p>

<p>なぜなら、ハンドセット端末向けには、一覧用と詳細表示用のそれぞれの Activity を作り、その Activity は Fragment を配置するロジックさえ持っておけば良く、また、タブレット端末向けには、1 つの Activity が、一覧用と詳細用の Fragment を配置するロジックを持っておけば済むようになるからです。</p>

<h2>
<span id="こうして世界は-fragment-に包まれた" class="fragment"></span><a href="#%E3%81%93%E3%81%86%E3%81%97%E3%81%A6%E4%B8%96%E7%95%8C%E3%81%AF-fragment-%E3%81%AB%E5%8C%85%E3%81%BE%E3%82%8C%E3%81%9F"><i class="fa fa-link"></i></a>…こうして世界は Fragment に包まれた…</h2>

<p>この他にも、ViewPager と Fragment はとても相性良く連携します。ActionBar にも、簡単なインタフェースで実装できるタブの機能があり、ViewPager と ActionBar のタブの機能は、単純なインタフェースで連携することが出来ます。</p>

<p>実は、Fragment は UI を持たない実装をすることもできます。このようにすることのメリットは、Fragment にライフサイクルがあり、それが Activity のものと緊密に連動することから、Activity のためのデータを、ライフサイクルに合わせて管理するホルダーのような役割を持つことができることに有ります。</p>

<p>Activity のライフサイクルに合うようにクラスを設計するのは、面倒がつきまといます。それを、Fragment が肩代わりしてくれるのです。<br>
また、役割の多い Activity ほど、より多くのデータを取り扱います。メンバ変数としてデータを保持するのではなく、データの保持を Fragment に任せることで、Activity の見通しが良くなります。</p>

<p>（若干の誇張表現がある気がするけどまあいいや…）</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>526</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/f19a732aad3beff9387c">やさしい設計 〜 Android 編</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-05 19:22:05</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="アプリを作っていてありがちなこと" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%84%E3%81%A6%E3%81%82%E3%82%8A%E3%81%8C%E3%81%A1%E3%81%AA%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>アプリを作っていてありがちなこと</h2>

<p>Android には、画面を構成するための Activity というコンポーネントがあり、概ね MVC フレームワークの Controller に相当する機能を持っています。<br>
MVC といえば、肥大化する Controller というのがよくある問題として挙げられますが、Activity も例に漏れず、往々にして肥大化しがちです。<br>
また、Model も、その責務を詰め込んでいくと肥大化しやすいレイヤと言えます。</p>

<p>この投稿では、Controller や Model の肥大化を極力防ぐためのレイヤわけを、Android アプリ向けに書いていきます。</p>

<h2>
<span id="activity-を綺麗に保つ" class="fragment"></span><a href="#activity-%E3%82%92%E7%B6%BA%E9%BA%97%E3%81%AB%E4%BF%9D%E3%81%A4"><i class="fa fa-link"></i></a>Activity を綺麗に保つ</h2>

<p>Activity は、Controller として、様々な UI から受けるイベントを受けて、適切にハンドリングする役割を持っています。<br>
OptionsMenu や ContextMenu のハンドリングを始め、ボタンが押された時や、テキストが入力された時のイベント処理もハンドリングします。</p>

<h3>
<span id="イベントハンドリングにおける条件分岐を整理する" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%82%92%E6%95%B4%E7%90%86%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>イベントハンドリングにおける条件分岐を整理する</h3>

<p>例えば、OptionsMenu や ContextMenu、あるいは、onActivityResult のハンドリング処理は、switch 文等で Activity にベタ書きしていくと、項目が増えるに従って分岐も増えていきます。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="c1">// メニューの項目が増えるほどに条件分岐が複雑化する例</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menu_hoge</span><span class="o">:</span>
        <span class="n">doHoge</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="k">case</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menu_fuga</span><span class="o">:</span>
        <span class="n">doFuga</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">doHoge</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">message_menu_hoge</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">doFuga</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">message_menu_fuga</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
<span class="o">}</span>
</pre></div></div>

<p>Activity にすべてが詰まっているため、テストもしづらくなりますね。<br>
以下のように整理すると、Activity に記述する内容が最小限になります。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="c1">// =========== Activity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="c1">// ... {snip} ...</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MyActivityOptionsItemAction</span> <span class="n">action</span> <span class="o">=</span> <span class="n">MyActivityOptionsMenuAction</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="na">getHandler</span><span class="o">().</span><span class="na">handle</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span> <span class="o">||</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// =========== Options Menu Event enum</span>
<span class="c1">// この enum に、MenuItem の id とイベントハンドラとの対応付けをもたせ、Activity から id をもとに引いてきてイベントハンドリングをデリゲートする</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="n">MyActivityOptionsItemAction</span> <span class="o">{</span>
    <span class="n">HOGE</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menu_hoge</span><span class="o">,</span> <span class="k">new</span> <span class="n">HogeActionHandler</span><span class="o">()),</span>
    <span class="n">FUGA</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menu_fuga</span><span class="o">,</span> <span class="k">new</span> <span class="n">FugaActionHandler</span><span class="o">()),</span>
    <span class="n">UNKNOWN</span><span class="o">(-</span><span class="mi">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">UnknownActionHandler</span><span class="o">());</span> <span class="c1">// MyActivity では取り扱っていないはずの id が来た時に使う、NullObject</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">mMenuId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OptionsItemActionHandler</span> <span class="n">mHandler</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyActivityOptionsItemAction</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">menuId</span><span class="o">,</span> <span class="kd">final</span> <span class="n">OptionsItemActionHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mMenuId</span> <span class="o">=</span> <span class="n">menuId</span><span class="o">;</span>
        <span class="n">mHandler</span> <span class="o">=</span> <span class="n">handler</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">MyActivityOptionsItemAction</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">MyActivityOptionsItemAction</span> <span class="n">action</span> <span class="o">:</span> <span class="n">values</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">getMenuId</span><span class="o">()</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">action</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">UNKNOWN</span><span class="o">;</span> <span class="c1">// 知らない id が来るのは実装上の不具合なので、IllegalArgumentException を投げるでも良い</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMenuId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mMenuId</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">OptionsItemActionHandler</span> <span class="nf">getHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mHandler</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// =========== Interface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OptionsItemActionHandler</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">E</span> <span class="n">entity</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// =========== impl</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HogeActionHandler</span> <span class="kd">implements</span> <span class="n">OptionsItemActionHandler</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Void</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// menu_hoge を選択された時の処理</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">message_menu_hoge</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FugaActionHandler</span> <span class="kd">implements</span> <span class="n">OptionsItemActionHandler</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Void</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// menu_fuga を選択された時の処理</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">message_menu_fuga</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnknownActionHandler</span> <span class="kd">implements</span> <span class="n">OptionsItemActionHandler</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Void</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="コールバックインタフェースを減らす" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99"><i class="fa fa-link"></i></a>コールバックインタフェースを減らす</h2>

<p>特に Model の実装時に多いのが、非同期処理後のコールバックインタフェースの乱立です。<br>
以下のように、Loader を用いた非同期処理を含む Model クラスの実装をあちこちでしていくと、モデルのコールバックが大量に出来上がります。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyModel</span> <span class="kd">implements</span> <span class="n">LoaderCallbacks</span><span class="o">&lt;</span><span class="n">Something</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">LOADER_ID</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Context</span> <span class="n">mContext</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">MyModelCallback</span> <span class="n">mCallback</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Loader</span><span class="o">&lt;</span><span class="n">Something</span><span class="o">&gt;</span> <span class="nf">onCreateLoader</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AsyncSomethingLoader</span><span class="o">(</span><span class="n">mContext</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoadFinished</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Something</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">,</span> <span class="n">Something</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mCallback</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mCallback</span><span class="o">.</span><span class="na">onFailure</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">mCallback</span><span class="o">.</span><span class="na">onSuccess</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoaderReset</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Something</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">)</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">MyModelCallback</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mContext</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
        <span class="n">mCallback</span> <span class="o">=</span> <span class="n">callback</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">LoaderManager</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">manager</span><span class="o">.</span><span class="na">initLoader</span><span class="o">(</span><span class="n">LOADER_ID</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">(</span><span class="n">LoaderManager</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mCallback</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">manager</span><span class="o">.</span><span class="na">destroyLoader</span><span class="o">(</span><span class="n">LOADER_ID</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MyModelCallback</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="n">Something</span> <span class="n">something</span><span class="o">);</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>コールバックはまた、実装する Context のライフサイクルを考慮した管理をしなければなりません。</p>

<p>これらの面倒事を解消する策として、EventBus を使います。<br>
以下、<a href="https://github.com/greenrobot/EventBus/" rel="nofollow noopener" target="_blank">このライブラリ</a>を用いた実装を例にあげてみます。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyModel</span> <span class="kd">implements</span> <span class="n">LoaderCallbacks</span><span class="o">&lt;</span><span class="n">Something</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">LOADER_ID</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Context</span> <span class="n">mContext</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">EventBus</span> <span class="n">mEventBus</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Loader</span><span class="o">&lt;</span><span class="n">Something</span><span class="o">&gt;</span> <span class="nf">onCreateLoader</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AsyncSomethingLoader</span><span class="o">(</span><span class="n">mContext</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoadFinished</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Something</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">,</span> <span class="n">Something</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mEventBus</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">SomethingLoadFailureEvent</span><span class="o">())</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">mEventBus</span><span class="o">.</span><span class="na">onSuccess</span><span class="o">(</span><span class="k">new</span> <span class="n">SomethingLoadSuccessEvent</span><span class="o">(</span><span class="n">result</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoaderReset</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Something</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">)</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mContext</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
        <span class="n">mEventBus</span> <span class="o">=</span> <span class="n">EventBus</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">LoaderManager</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">manager</span><span class="o">.</span><span class="na">initLoader</span><span class="o">(</span><span class="n">LOADER_ID</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">(</span><span class="n">LoaderManager</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">manager</span><span class="o">.</span><span class="na">destroyLoader</span><span class="o">(</span><span class="n">LOADER_ID</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>コールバックのインスタンスを管理する部分がごっそりなくなりました。かわりに、イベントを受け取る実装を Activity ですることになります。</p>

<p>より詳しく EventBus の使い方を見るには、<a href="http://qiita.com/KeithYokoma/items/793aaac6994c9242808f" id="reference-aa0970e2c61dde253747">こちら</a>を御覧ください。</p>

<h2>
<span id="model-のなかの棲み分け" class="fragment"></span><a href="#model-%E3%81%AE%E3%81%AA%E3%81%8B%E3%81%AE%E6%A3%B2%E3%81%BF%E5%88%86%E3%81%91"><i class="fa fa-link"></i></a>Model のなかの棲み分け</h2>

<p>Model と一言で言っても、その役割はたくさんあります。<br>
ネットワークや DB 、キャッシュなどからデータを非同期で取ってきて、それをデシリアライズ、加工し、View に反映させるまでの間にも、いくらかのビジネスロジックを挟んだりします。</p>

<p>大まかに分類すると、それぞれ、データにアクセスするレイヤ、データへのアクセスを非同期にするためのレイヤ、データを加工したりメモリにのせたりするレイヤ、に分けるとすると、以下のような名前空間に分離することができます。</p>

<ul>
<li>client: データにアクセスするレイヤ</li>
<li>loader: Android における Loader を用いた非同期処理のレイヤ</li>
<li>model: データを加工したりメモリにのせたりする、所謂ビジネスロジックを含むモデルのレイヤ</li>
</ul>

<p>さらに、データそのものを表現するためのオブジェクトとして、Entity を定義することによって、Model や Controller、View などのコンポーネントを Entity が行き来するようなアーキテクチャが構成できます。</p>

<p>モデルも細かく分離することで、テストが容易になります。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>277</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/793aaac6994c9242808f">Android でイベントバスを使う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-19 19:22:48</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="イベントバス" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%83%90%E3%82%B9"><i class="fa fa-link"></i></a>イベントバス</h2>

<p>Android では、非同期処理の返り値はコールバックインタフェースを介してやり取りされる。<br>
これ以外にも、Observer パターンに基いて設計されているクラス（<code>SharedPreferences</code>など）や、Activity と Fragment とのやりとりなどでも、コールバックインタフェースを定義して、その実装とライフサイクル管理をする。</p>

<p>一方で、機能が増えるとその分コールバックインタフェースの定義も増え、Activity が幾つものインタフェースを実装することがある。コールバックインタフェースの定義が増えてくると、その分だけ依存関係が複雑になりやすくなったり、コールバックを受けて更に非同期処理を呼び出して…としていくと、どんどんネストが深くなったりしていく(コールバック地獄)。</p>

<p>そこで、コールバックメソッドを呼ぶタイミングでイベントを発火し、コールバックインタフェースの実装ではなく、イベントを常時監視するメソッドを用意しておいて、発火したタイミングで呼び出されるようにする仕組みとして、EventBus を使うことで、インタフェースによる依存関係を整理したり、コールバック地獄を解消したりすることができる。</p>

<h2>
<span id="squareotto" class="fragment"></span><a href="#squareotto"><i class="fa fa-link"></i></a>square/otto</h2>

<p><a href="https://github.com/square/otto" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/square/otto</a></p>

<p>square 社が提供する EventBus の仕組み。</p>

<p>使い方は以下のようにする。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">EventBusHolder</span> <span class="o">{</span>
    <span class="c1">// EventBus のインスタンス自体はどの Activity からでも同じものを使うようにする</span>
    <span class="c1">// DI フレームワークで Producer を使うと便利</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Bus</span> <span class="n">EVENT_BUS</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bus</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// ===========</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="c1">// ...</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="c1">// EventBus の登録</span>
        <span class="n">EventBusHolder</span><span class="o">.</span><span class="na">EVENT_BUS</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 登録の解除</span>
        <span class="n">EventBusHolder</span><span class="o">.</span><span class="na">EVENT_BUS</span><span class="o">.</span><span class="na">unregister</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// イベントハンドラの宣言</span>
    <span class="nd">@Subscribe</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClickButton</span><span class="o">(</span><span class="n">ButtonClickEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"Button clicked "</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">getClickCount</span><span class="o">()</span> <span class="o">+</span> <span class="s">" times."</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// ===========</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="kd">implements</span> <span class="n">LoaderManager</span><span class="o">.</span><span class="na">LoaderCallbacks</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mClickCount</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_sample</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Button</span> <span class="n">button</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>
        <span class="n">button</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// イベントの発火</span>
                <span class="n">EventBusHolder</span><span class="o">.</span><span class="na">EVENT_BUS</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">ButtonClickEvent</span><span class="o">(</span><span class="n">mClickCount</span><span class="o">++));</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="nf">onCreateLoader</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">CursorLoader</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">EXTERNAL_CONTENT_URI</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoadFinished</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">,</span> <span class="n">Cursor</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 以下は上手くイベントがハンドラにわたらない(FragmentTransaction をこのコールバックで取り扱えないのと同じ理由)</span>
        <span class="n">EventBusHolder</span><span class="o">.</span><span class="na">EVENT_BUS</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">CursorLoadedEvent</span><span class="o">(</span><span class="n">result</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoaderReset</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="c1">// ===========</span>
<span class="c1">// イベントオブジェクト</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ButtonClickEvent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">mClickCount</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ButtonClickEvent</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">clickCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mClickCount</span> <span class="o">=</span> <span class="n">clickCount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getClickCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mClickCount</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// ===========</span>
<span class="c1">// イベントオブジェクト</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CursorLoadedEvent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Cursor</span> <span class="n">mCursor</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CursorLoadedEvent</span><span class="o">(</span><span class="kd">final</span> <span class="n">Cursor</span> <span class="n">cursor</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mCursor</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Cursor</span> <span class="nf">getCursor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mCursor</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>Google Guava をベースとしているが、いくつかの点で Guava とは異なる実装をしている。また、Android 向けに最適化されていたり、挙動に制限を加えていたりする。</p>

<ol>
<li>クラスの継承階層を辿らず、otto に登録したオブジェクトの型で宣言されている<code>@Subscribe</code>なメソッドのみをイベントハンドラとして登録する。</li>
<li>
<code>@Producer</code>なメソッドを宣言することで、予め定義したデータを、非同期処理後のイベントを待つこと無く配信できる。</li>
<li>基本的には、メインスレッド上でイベントを発火し、メインスレッド上でイベントを受信する設計になっている。設定次第で、メインスレッド以外からもイベントを発火可能だが、イベントを受信するハンドラ側は常にメインスレッドでなければならない。</li>
</ol>

<h2>
<span id="greenroboteventbus" class="fragment"></span><a href="#greenroboteventbus"><i class="fa fa-link"></i></a>greenrobot/EventBus</h2>

<p><a href="https://github.com/greenrobot/EventBus" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/greenrobot/EventBus</a></p>

<p>Android に最適化された EventBus の仕組み。<br>
考え方や使い方は otto と同じで、使用するメソッドもほぼ同じものが提供されている。<br>
一方で、イベントハンドラの宣言やスレッドに関するところで otto と異なる点がある。</p>

<ol>
<li>クラスの継承階層を辿り、親クラスのイベントハンドラ宣言にもイベントが通知される。</li>
<li>アノテーションではなく、メソッドの命名によってイベントハンドラの宣言をする。</li>
<li>異なるスレッド間どうしでイベントを通知しあうことが出来る。ただし、イベントの通知を受ける側は、その処理を実行するスレッドをブロックしないように設計する必要がある。</li>
<li>
<code>@Producer</code>によるイベントキャッシュの仕組みを自分で実装する必要はなく、StickyEvent として EventBus が管理してくれる。</li>
</ol>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="c1">// ===========</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
    <span class="c1">// ...</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onResume</span><span class="o">();</span>
        <span class="c1">// EventBus の登録</span>
        <span class="n">EventBus</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 登録の解除</span>
        <span class="n">EventBus</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">unregister</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onPause</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// イベントハンドラの宣言</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onEvent</span><span class="o">(</span><span class="n">ButtonClickEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">"Button clicked "</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">getClickCount</span><span class="o">()</span> <span class="o">+</span> <span class="s">" times."</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// イベントハンドラの宣言。メインスレッド上で実行することを強制する場合</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onEventMainThread</span><span class="o">(</span><span class="n">CursorLoadedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// ===========</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="kd">implements</span> <span class="n">LoaderManager</span><span class="o">.</span><span class="na">LoaderCallbacks</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">mClickCount</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="nf">onCreateView</span><span class="o">(</span><span class="n">LayoutInflater</span> <span class="n">inflater</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">container</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="n">inflater</span><span class="o">.</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">fragment_sample</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">Button</span> <span class="n">button</span> <span class="o">=</span> <span class="o">(</span><span class="n">Button</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>
        <span class="n">button</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// イベントの発火</span>
                <span class="n">EventBus</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">ButtonClickEvent</span><span class="o">(</span><span class="n">mClickCount</span><span class="o">++));</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="nf">onCreateLoader</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">CursorLoader</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">EXTERNAL_CONTENT_URI</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoadFinished</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">,</span> <span class="n">Cursor</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// イベントの通知</span>
        <span class="n">EventBus</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">CursorLoadedEvent</span><span class="o">(</span><span class="n">result</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoaderReset</span><span class="o">(</span><span class="n">Loader</span><span class="o">&lt;</span><span class="n">Cursor</span><span class="o">&gt;</span> <span class="n">loader</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>

<span class="c1">// ===========</span>
<span class="c1">// イベントオブジェクト</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ButtonClickEvent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">mClickCount</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ButtonClickEvent</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">clickCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mClickCount</span> <span class="o">=</span> <span class="n">clickCount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getClickCount</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mClickCount</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// ===========</span>
<span class="c1">// イベントオブジェクト</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CursorLoadedEvent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Cursor</span> <span class="n">mCursor</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CursorLoadedEvent</span><span class="o">(</span><span class="kd">final</span> <span class="n">Cursor</span> <span class="n">cursor</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mCursor</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Cursor</span> <span class="nf">getCursor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mCursor</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="broadcastreceiver-との違い" class="fragment"></span><a href="#broadcastreceiver-%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a>BroadcastReceiver との違い</h2>

<p>otto, EventBus ともに、単純な Java オブジェクトを用いてイベントを通知できる。</p>

<p>BroadcastReceiver の場合、Intent の仕組みに準じる実装をしなければならないため、イベントオブジェクトは Parcelable である必要があったり、Extra として Intent にオブジェクトを詰め込んだり、イベントを受け取る側も、IntentFilter を宣言したり、受け取った Intent から Extra を取り出したりと、実装コストが高くなりがちだが、otto や EventBus であれば、イベントオブジェクトを単純なクラスとして宣言すれば、あとはメソッド宣言を規約に沿った形で実装するだけで済む。</p>

<p>また、BroadcastReceiver を使う場合、セキュリティに気を使わないと、インストールされているアプリすべてで Intent が受け取れてしまう問題がある。LocalBroadcastReceiver やパーミッションを使えば解決できるが、イベントの通知の実装に掛かるコストは同じか、パーミッションの分だけ増えることになるので、特に理由がなければ otto や EventBus を使うのが良さそう。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>237</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/9681b130ea132cfad64d">Enum で振る舞う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-22 16:04:34</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="java-の列挙型" class="fragment"></span><a href="#java-%E3%81%AE%E5%88%97%E6%8C%99%E5%9E%8B"><i class="fa fa-link"></i></a>Java の列挙型</h2>

<p>Java の列挙型は、C 言語の enum と異なり、単なる int の定数列挙ではなく、オブジェクトの列挙になるので、メソッドを宣言したり、メンバ変数を宣言したりと、振る舞いを持たせることが出来る。</p>

<p>内部的には、列挙したオブジェクトは定数として扱われるので、列挙の数だけオブジェクトが予め生成されることになる。</p>

<p>詳細は Effective Java を読もう！</p>

<h2>
<span id="振る舞う-enum" class="fragment"></span><a href="#%E6%8C%AF%E3%82%8B%E8%88%9E%E3%81%86-enum"><i class="fa fa-link"></i></a>振る舞う enum</h2>

<p>通常の enum の宣言は以下のようになる。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">MyEnum</span> <span class="o">{</span>
    <span class="n">HOGE</span><span class="o">,</span>
    <span class="n">FUGA</span><span class="o">;</span>
<span class="o">}</span>
</pre></div></div>

<p>これにメンバ変数を追加すると、</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">MyEnum</span> <span class="o">{</span>
    <span class="n">HOGE</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
    <span class="n">FUGA</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyEnum</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>コンストラクタは必ず private でなければならず、それ以外のアクセス修飾子とするとコンパイルエラーとなる。<br>
コンストラクタの呼び出しは列挙の宣言のところで行う。</p>

<p>さらにメソッドを追加して、</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">MyEnum</span> <span class="o">{</span>
    <span class="n">HOGE</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
    <span class="n">FUGA</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyEnum</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>これで、以下のようにメソッド呼び出しが行えるようになる。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">hogeId</span> <span class="o">=</span> <span class="n">MyEnum</span><span class="o">.</span><span class="na">HOGE</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
<span class="kt">int</span> <span class="n">fugaId</span> <span class="o">=</span> <span class="n">MyEnum</span><span class="o">.</span><span class="na">FUGA</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
</pre></div></div>

<p>メソッドの引数に列挙型オブジェクトを受けるようにしておけば</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(</span><span class="n">MyEnum</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">num</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
<span class="o">}</span>
</pre></div></div>

<p>とか出来るので、switch 文で分岐して振る舞いを変えるようなコードがスッキリする。</p>

<p>enum もクラスの一種なので、インタフェースを実装したり、抽象メソッドを宣言したりできる（別のクラスの継承と、宣言した enum を別のクラスで継承することはできない）。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">MyEnum</span> <span class="kd">implements</span> <span class="n">SomeInterface</span> <span class="o">{</span>
    <span class="n">HOGE</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
    <span class="n">FUGA</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyEnum</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>抽象メソッドを宣言した場合、定数オブジェクトの宣言のところで実装を書く。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">MyEnum</span> <span class="o">{</span>
    <span class="n">HOGE</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span>

        <span class="o">}</span>
    <span class="o">},</span>
    <span class="n">FUGA</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">()</span> <span class="o">{</span>

        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyEnum</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">foo</span><span class="o">();</span>
<span class="o">}</span>
</pre></div></div>

<p>enum はもともと Comparable インタフェースと Serializable インタフェースを実装している。</p>

<h2>
<span id="列挙型のメソッド" class="fragment"></span><a href="#%E5%88%97%E6%8C%99%E5%9E%8B%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>列挙型のメソッド</h2>

<p>enum 型には特別なメソッドが幾つか用意されている。</p>

<p>列挙した定数オブジェクトをすべて得るには、<code>Enum#values()</code>メソッドを使う。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">MyEnum</span> <span class="o">{</span>
    <span class="n">HOGE</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
    <span class="n">FUGA</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">MyEnum</span><span class="o">(</span><span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// id から、定数オブジェクトを逆引きするメソッド</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">MyEnum</span> <span class="nf">valueOf</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// values() で、列挙したオブジェクトをすべて持つ配列が得られる</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">MyEnum</span> <span class="n">num</span> <span class="o">:</span> <span class="n">values</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// id が一致するものを探す</span>
                <span class="k">return</span> <span class="n">num</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">"no such enum object for the id: "</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>

        <span class="c1">// Null-Object パターンにしたがって、列挙に UNKNOWN みたいなのを入れておくのも良い</span>
        <span class="c1">// return UNKNOWN;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>String から enum への変換は予め用意されている。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">MyEnum</span> <span class="n">hoge</span> <span class="o">=</span> <span class="n">MyEnum</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="s">"HOGE"</span><span class="o">);</span>
</pre></div></div>

<p>enum から String への変換もある。<br>
<code>Enum#toString()</code>はオーバライドが可能で、自分の好きな文字列にすることが出来る。<br>
<code>Enum#name()</code>はオーバライドができないようになっている。宣言した通りの名前が得られる。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">hoge1</span> <span class="o">=</span> <span class="n">MyEnum</span><span class="o">.</span><span class="na">HOGE</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="n">String</span> <span class="n">hoge2</span> <span class="o">=</span> <span class="n">MyEnum</span><span class="o">.</span><span class="na">HOGE</span><span class="o">.</span><span class="na">name</span><span class="o">();</span>
</pre></div></div>

<p><code>Enum#ordinal()</code>で、宣言された順番も得ることが出来る。<br>
宣言された順番をコンパイラが勝手に検出してコードにしてくれるので、当然のことながら、順番を入れ替えるとかえってくる数字も変わってしまうので、かえってくる数字そのものを何処か別のところで比較したり使ったりすると、せっかくの型安全性も台無しになるので、あんまり使わないでね。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">order</span> <span class="o">=</span> <span class="n">MyEnum</span><span class="o">.</span><span class="na">HOGE</span><span class="o">.</span><span class="na">ordinal</span><span class="o">();</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>84</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/740d06bc14d741c0c9f6">EventBus はどこでつかうべきか</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-17 16:01:49</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>EventBus の使い方は<a href="http://qiita.com/KeithYokoma/items/793aaac6994c9242808f" id="reference-d907caeff8ac28cd162e">こちら</a>に任せるとして、この投稿では、EventBus の効果的な使い方について考察します。</p>

<h2>
<span id="どのレイヤの結合を分離するか" class="fragment"></span><a href="#%E3%81%A9%E3%81%AE%E3%83%AC%E3%82%A4%E3%83%A4%E3%81%AE%E7%B5%90%E5%90%88%E3%82%92%E5%88%86%E9%9B%A2%E3%81%99%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>どのレイヤの結合を分離するか</h2>

<p>特に、View の仕組みがフレームワークとして作りこまれているものであれば、View のイベントはリスナーインタフェースを用いれば十分にイベントハンドリングが可能です。Android の場合、View のシステムは Activity のライフサイクルとよく連動して動作するため、ここに EventBus による中間層の挿入をする理由はあまりありません。</p>

<p>多くの場合、アプリ開発者が設計し実装する部分は Controller と Model の相互作用です。そして、Controller と Model の境界面で使われる設計パターンとして、コールバックインタフェースが用いられてきました。</p>

<p>コールバックインタフェースを用いることで、Model から Controller への戻しの処理が共通化され、Controller は実装を強制されます。</p>

<p>しかし、Controller にはライフサイクルがあり、特に Android のような、大きくかつライフサイクルの短い Controller を取り扱う場合には、コールバックインタフェースの参照の持ち方を適切に管理しなければなりません。また、インタフェースによって Model と Controller が密に連動するため、インタフェースの変更のコストはどうしても高くなりがちです。</p>

<p>この問題点を解消するために、EventBus という中間層を介したコミュニケーションを用いることが有用となるのです。</p>

<p>なぜなら、Model と Controller は直接結合することがなくなることで、Controller が実装したコールバックインタフェースの管理をしなくても良くなるからです。</p>

<h2>
<span id="命名規則" class="fragment"></span><a href="#%E5%91%BD%E5%90%8D%E8%A6%8F%E5%89%87"><i class="fa fa-link"></i></a>命名規則</h2>

<p>もし、すべてのレイヤのすべてのイベントを EventBus を介してやりとりするとどうなるでしょうか。</p>

<p>あらゆるイベントがオブジェクト化され、あらゆるレイヤに多種多様なイベントオブジェクトが溢れかえります。</p>

<p>Otto はアノテーションとイベントオブジェクト名によって、EventBus はイベントオブジェクト名によって適切なハンドラを選択します。いずれにしても、イベントオブジェクトの命名によってハンドラが選択されるため、イベントオブジェクトの命名を間違えると、どのイベントがどのレイヤからやってくるのかが分からなくなってしまいます。これはインタフェースの乱立よりも厄介な問題です。</p>

<h2>
<span id="controller-は-model-を直接参照しmodel-の状態変化にリアクティブになる" class="fragment"></span><a href="#controller-%E3%81%AF-model-%E3%82%92%E7%9B%B4%E6%8E%A5%E5%8F%82%E7%85%A7%E3%81%97model-%E3%81%AE%E7%8A%B6%E6%85%8B%E5%A4%89%E5%8C%96%E3%81%AB%E3%83%AA%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%81%AB%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>Controller は Model を直接参照し、Model の状態変化にリアクティブになる</h2>

<p>Controller は、View でおこるイベントに応じて適切に Model の操作を行います。この点で、Controller が Model を直接参照することはごく自然な振る舞いです。<br>
問題は、Model の操作のコールバックの管理にあったはずですから、この部分を EventBus に任せ、Model は操作の結果としてイベントを発し続け、Controller はそのイベントにリアクティブに振る舞うようにします。</p>

<p>Controller と Model との境界面を柔軟にする、という点で、このポリシーは有効なのではないでしょうか。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>73</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/c046dcb54607262c041a">AndroidStudio で設定しておきたいコードテンプレート集</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-02 20:11:10</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> <b>[AndroidStudio]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="fragment" class="fragment"></span><a href="#fragment"><i class="fa fa-link"></i></a>Fragment</h1>

<p>API Level 11 以降ならこちら。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="err">#</span><span class="k">if</span> <span class="o">(</span><span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">!=</span> <span class="s">""</span><span class="o">)</span> <span class="kn">package</span> <span class="err">${</span><span class="nn">PACKAGE_NAME</span><span class="o">};</span><span class="err">#</span><span class="n">end</span>

<span class="kn">import</span> <span class="nn">android.app.Fragment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>

<span class="err">#</span><span class="n">parse</span><span class="o">(</span><span class="s">"File Header.java"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>

    <span class="c1">// Note: only the system can call this constructor by reflection. </span>
    <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="n">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="n">fragment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}();</span>
        <span class="n">Bundle</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="o">();</span>
        <span class="n">fragment</span><span class="o">.</span><span class="na">setArguments</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">fragment</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>サポートパッケージを使う場合は</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="err">#</span><span class="k">if</span> <span class="o">(</span><span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">!=</span> <span class="s">""</span><span class="o">)</span> <span class="kn">package</span> <span class="err">${</span><span class="nn">PACKAGE_NAME</span><span class="o">};</span><span class="err">#</span><span class="n">end</span>

<span class="kn">import</span> <span class="nn">android.support.v4.app.Fragment</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>

<span class="err">#</span><span class="n">parse</span><span class="o">(</span><span class="s">"File Header.java"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>

    <span class="c1">// Note: only the system can call this constructor by reflection. </span>
    <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="n">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="n">fragment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}();</span>
        <span class="n">Bundle</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bundle</span><span class="o">();</span>
        <span class="n">fragment</span><span class="o">.</span><span class="na">setArguments</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">fragment</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h1>
<span id="データ構造を表す型" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0%E3%82%92%E8%A1%A8%E3%81%99%E5%9E%8B"><i class="fa fa-link"></i></a>データ構造を表す型</h1>

<p>Parcelable を実装して Entity を作るとき。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="err">#</span><span class="k">if</span> <span class="o">(</span><span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">!=</span> <span class="s">""</span><span class="o">)</span> <span class="kn">package</span> <span class="err">${</span><span class="nn">PACKAGE_NAME</span><span class="o">};</span><span class="err">#</span><span class="n">end</span>

<span class="kn">import</span> <span class="nn">android.os.Parcel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Parcelable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Parcelable.Creator</span><span class="o">;</span>

<span class="err">#</span><span class="n">parse</span><span class="o">(</span><span class="s">"File Header.java"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="kd">implements</span> <span class="n">Parcelable</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Creator</span><span class="o">&lt;</span><span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}&gt;</span> <span class="n">CREATOR</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Creator</span><span class="o">&lt;</span><span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}&gt;()</span> <span class="o">{</span>
        <span class="nd">@Nullable</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="n">createFromParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}(</span><span class="n">source</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}[]</span> <span class="n">newArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}[</span><span class="n">size</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}(</span><span class="n">Parcel</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">describeContents</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeToParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">dest</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>Builder を使いたい場合は以下。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="err">#</span><span class="k">if</span> <span class="o">(</span><span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">!=</span> <span class="s">""</span><span class="o">)</span> <span class="kn">package</span> <span class="err">${</span><span class="nn">PACKAGE_NAME</span><span class="o">};</span><span class="err">#</span><span class="n">end</span>

<span class="kn">import</span> <span class="nn">android.os.Parcel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Parcelable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Parcelable.Creator</span><span class="o">;</span>

<span class="err">#</span><span class="n">parse</span><span class="o">(</span><span class="s">"File Header.java"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="kd">implements</span> <span class="n">Parcelable</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Creator</span><span class="o">&lt;</span><span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}&gt;</span> <span class="n">CREATOR</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Creator</span><span class="o">&lt;</span><span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}&gt;()</span> <span class="o">{</span>
        <span class="nd">@Nullable</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="n">createFromParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}(</span><span class="n">source</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}[]</span> <span class="n">newArray</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}[</span><span class="n">size</span><span class="o">];</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// Note: only the builder of this type can call this constructor.</span>
    <span class="kd">private</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}(</span><span class="n">Parcel</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">describeContents</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeToParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">dest</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="n">mTarget</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Builder</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">mTarget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}();</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="n">create</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">mTarget</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h1>
<span id="utility" class="fragment"></span><a href="#utility"><i class="fa fa-link"></i></a>Utility</h1>

<p>継承を禁止し、コンストラクタを封印、リフレクションで呼ばれたら例外にするなど。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="err">#</span><span class="k">if</span> <span class="o">(</span><span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">!=</span> <span class="s">""</span><span class="o">)</span> <span class="kn">package</span> <span class="err">${</span><span class="nn">PACKAGE_NAME</span><span class="o">};</span><span class="err">#</span><span class="n">end</span>
<span class="err">#</span><span class="n">parse</span><span class="o">(</span><span class="s">"File Header.java"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}()</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">AssertionError</span><span class="o">(</span><span class="s">"constructor of the utility class should not be called"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h1>
<span id="loader" class="fragment"></span><a href="#loader"><i class="fa fa-link"></i></a>Loader</h1>

<p>ベーシックなローダ</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="err">#</span><span class="k">if</span> <span class="o">(</span><span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">!=</span> <span class="s">""</span><span class="o">)</span><span class="kn">package</span> <span class="err">${</span><span class="nn">PACKAGE_NAME</span><span class="o">};</span><span class="err">#</span><span class="n">end</span>

<span class="kn">import</span> <span class="nn">android.support.v4.content.AsyncTaskLoader</span><span class="o">;</span>

<span class="err">#</span><span class="n">parse</span><span class="o">(</span><span class="s">"File Header.java"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="kd">extends</span> <span class="n">AsyncTaskLoader</span><span class="o">&lt;</span><span class="n">$</span><span class="o">{</span><span class="n">RESULT</span><span class="o">}&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>

    <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">RESULT</span><span class="o">}</span> <span class="n">loadInBackground</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStartLoading</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStartLoading</span><span class="o">();</span>
        <span class="n">forceLoad</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>ローカルキャッシュを効かせるなら</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="err">#</span><span class="k">if</span> <span class="o">(</span><span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="o">{</span><span class="n">PACKAGE_NAME</span><span class="o">}</span> <span class="o">!=</span> <span class="s">""</span><span class="o">)</span><span class="kn">package</span> <span class="err">${</span><span class="nn">PACKAGE_NAME</span><span class="o">};</span><span class="err">#</span><span class="n">end</span>

<span class="kn">import</span> <span class="nn">android.support.v4.content.AsyncTaskLoader</span><span class="o">;</span>

<span class="err">#</span><span class="n">parse</span><span class="o">(</span><span class="s">"File Header.java"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}</span> <span class="kd">extends</span> <span class="n">AsyncTaskLoader</span><span class="o">&lt;</span><span class="n">$</span><span class="o">{</span><span class="n">RESULT</span><span class="o">}&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
    <span class="kd">private</span> <span class="n">$</span><span class="o">{</span><span class="n">CACHE_TYPE</span><span class="o">}</span> <span class="n">mCache</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">NAME</span><span class="o">}(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">$</span><span class="o">{</span><span class="n">RESULT</span><span class="o">}</span> <span class="n">loadInBackground</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deliverResult</span><span class="o">(</span><span class="n">$</span><span class="o">{</span><span class="n">RESULT</span><span class="o">}</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isReset</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">mCache</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">mCache</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">mCache</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">isStarted</span><span class="o">())</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">deliverResult</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStartLoading</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">result</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">deliverResult</span><span class="o">(</span><span class="n">mCache</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">takeContentChanged</span><span class="o">()</span> <span class="o">||</span> <span class="n">mCache</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">forceLoad</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStopLoading</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onStopLoading</span><span class="o">();</span>
        <span class="n">cancelLoad</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onReset</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onReset</span><span class="o">();</span>
        <span class="n">onStopLoading</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>72</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/0c8448c900066171ae72">超ラクチンに端末の画像を複数選択するためのライブラリを作った話</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-28 19:32:37</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Android の端末に保存されている画像を、アルバム（ディレクトリ）を跨って複数枚選択するためのライブラリを作りました。</p>

<p><a href="https://github.com/nohana/Laevatein" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nohana/Laevatein</a></p>

<h2>
<span id="intent-の-action-による画像選択の問題" class="fragment"></span><a href="#intent-%E3%81%AE-action-%E3%81%AB%E3%82%88%E3%82%8B%E7%94%BB%E5%83%8F%E9%81%B8%E6%8A%9E%E3%81%AE%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>Intent の Action による画像選択の問題</h2>

<p><code>Intent.ACTION_PICK</code> や <code>Intent.ACTION_GET_CONTENT</code> を用いれば、ギャラリーアプリや KitKat のファイルセレクタが立ち上がって、使いたい画像を選択することができます。</p>

<p>ただし、この方法では、画像を 1 枚しか選択できないため、複数枚を同時に取り扱おうとすると、ユーザに何度も選択画面との往来をさせてしまいます。</p>

<p>一方で、<code>Intent.ACTION_SEND_MULTIPLE</code> という Action も宣言されており、ギャラリーアプリなどで複数選択して共有ボタンを押すと、この Action で Intent が発火され、選択した複数の画像 Uri が取得できます。</p>

<p>しかし、ギャラリーアプリからの共有 Intent では、複数のアルバム（ディレクトリ）から一部の写真だけをピックアップしてくる、という使い方ができません。</p>

<p>また、アプリを使用するコンテキストで、ギャラリーアプリから選択して目的のアプリを立ち上げるという動作を説明するのは難易度が高かったりします。</p>

<h2>
<span id="このライブラリが目指したもの" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%8C%E7%9B%AE%E6%8C%87%E3%81%97%E3%81%9F%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>このライブラリが目指したもの</h2>

<p>まず、アプリに組み込んで使えること、そして、複数のアルバムから一部をピックアップして、複数の写真を選択することを達成できることが、このライブラリの目指したところです。</p>

<p>そしてなにより、単純な API で使用できることも重要でした。</p>

<h2>
<span id="動作する様子" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E6%A7%98%E5%AD%90"><i class="fa fa-link"></i></a>動作する様子</h2>

<p>リポジトリには、サンプルアプリも同封されています。</p>

<p>ライブラリの機能を呼び出すと、以下の様な、すべての写真一覧が表示されます。</p>

<p><a href="https://camo.qiitausercontent.com/3aaa11194ee97c7706929ccf85d3a2d9bac87967/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33313832392f38343032316663632d353161342d383032372d646666342d3036646362663530613864362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3aaa11194ee97c7706929ccf85d3a2d9bac87967/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33313832392f38343032316663632d353161342d383032372d646666342d3036646362663530613864362e706e67" alt="device-2014-03-28-162335.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/31829/84021fcc-51a4-8027-dff4-06dcbf50a8d6.png"></a></p>

<p>画像と、画像にオーバレイする形でチェックボックスが表示され、チェックマークをつけると選択したことになります。</p>

<p>アルバムの絞込は、NavigationDrawer で行います。</p>

<p><a href="https://camo.qiitausercontent.com/a921150a037c2339745a1e6c3cb26a7d0f7eb310/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33313832392f39396162643637342d633032362d326239382d306232332d6162613761393161343633632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a921150a037c2339745a1e6c3cb26a7d0f7eb310/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33313832392f39396162643637342d633032362d326239382d306232332d6162613761393161343633632e706e67" alt="device-2014-03-28-162413.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/31829/99abd674-c026-2b98-0b23-aba7a91a463c.png"></a></p>

<p>端末内で MediaStore が知っている Bucket 毎にアルバムがわかれています。</p>

<p>画像の選択状態は、アルバムを切り替えても保存されています。<br>
そこで、全体でどの写真を選んだかを見るためのビューも用意してあります。</p>

<p><a href="https://camo.qiitausercontent.com/46186d107077708e5caed5e8ba5f251530645c59/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33313832392f66636466626136622d303932322d613161632d353832332d3566366563386333393135632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/46186d107077708e5caed5e8ba5f251530645c59/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33313832392f66636466626136622d303932322d613161632d353832332d3566366563386333393135632e706e67" alt="device-2014-03-28-162626.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/31829/fcdfba6b-0922-a1ac-5823-5f6ec8c3915c.png"></a></p>

<p>これで、アクションバーの完了ボタンを押すと、選択した画像の Uri が、呼び出した Activity の onActivityResult に渡されます。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>API の呼び出しは、Picasso とよく似た手順で行います。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">REQUEST_CODE_CHOOSE</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClickButton</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// call chooser on click button like this</span>
    <span class="n">Laevatein</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">choose</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">JPEG</span><span class="o">)).</span><span class="na">forResult</span><span class="o">(</span><span class="n">REQUEST_CODE_CHOOSE</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>これで選択画面が立ち上がります。</p>

<p>選択が終わったら、以下のようにして結果を取り出します。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">REQUEST_CODE_CHOOSE</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultcode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">requestCode</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">REQUEST_CODE_CHOOSE</span><span class="o">:</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">resultCode</span> <span class="o">==</span> <span class="n">RESULT_OK</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Get result and proceed your work from here...</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Uri</span><span class="o">&gt;</span> <span class="n">selected</span> <span class="o">=</span> <span class="n">Laevatein</span><span class="o">.</span><span class="na">obtainResult</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="カスタマイズ" class="fragment"></span><a href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>カスタマイズ</h2>

<p>基本的に、テーマは全てアプリの持つテーマに合わせられます。ですので、ActionBar の装飾だったり、チェックボックスのスタイルだったりは、ライブラリ用に特別な実装を必要としません。</p>

<p>画像一覧のセルの見た目を変更したい場合は、以下のようにします。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>
<span class="n">Laevatein</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">choose</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">JPEG</span><span class="o">))</span>
        <span class="o">.</span><span class="na">bindEachImageWith</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">hoge</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">image_view_id</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">checkbox_id</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forResult</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</pre></div></div>

<p>選択できる画像について、制限のある仕様を設定したい場合、以下の様な API が提供されています。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>
<span class="n">Laevatein</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">choose</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">JPEG</span><span class="o">))</span>
        <span class="o">.</span><span class="na">count</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="c1">// 選べる数を 0 ~ 100 枚に制限</span>
        <span class="o">.</span><span class="na">quality</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">10000</span><span class="o">)</span> <span class="c1">// 選べる画像の画質を、ピクセルサイズで 10px から 10000px に制限</span>
        <span class="o">.</span><span class="na">forResult</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</pre></div></div>

<p>選択している最中に写真をとって、それを選択状態にしておきたい場合は以下のようにします。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>
<span class="n">Laevatein</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">choose</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">JPEG</span><span class="o">))</span>
        <span class="o">.</span><span class="na">capture</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forResult</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</pre></div></div>

<p>選び終わった後に、選択をやり直したい場合は、以下のようにします。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Uri</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span> <span class="c1">// 選択したものを保持するリスト</span>

<span class="n">Laevatein</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">choose</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">MimeType</span><span class="o">.</span><span class="na">JPEG</span><span class="o">))</span>
        <span class="o">.</span><span class="na">resume</span><span class="o">(</span><span class="n">list</span><span class="o">)</span>
        <span class="o">.</span><span class="na">forResult</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</pre></div></div>

<p>Picasso のようにメソッドをつなげることで、様々な組み合わせで API を呼び出し、仕様を設定することができます。</p>

<h2>
<span id="今後の展望" class="fragment"></span><a href="#%E4%BB%8A%E5%BE%8C%E3%81%AE%E5%B1%95%E6%9C%9B"><i class="fa fa-link"></i></a>今後の展望</h2>

<p>KitKat で登場したファイルセレクタの利点は、ドキュメントプロバイダを持っているアプリからのデータのインポートが出来る点にあります。これをこのライブラリでも取り扱うことが出来るようになれば、Dropbox などからも画像を選択できるようになり、より便利に使える様になると思います。</p>

<h2>
<span id="コントリビュート" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>コントリビュート</h2>

<p>Issue を立てて修正を依頼していただくか、Pull Request で差分を投げていただくかで、コントリビュートしていただけます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>63</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/79ab2d1d37e70f149fcb">Robolectric に対応したプロジェクトを作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-12 16:04:46</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> <b>[Groovy]</b> <b>[テスト]</b> <b>[gradle]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>今更ながら、<a href="http://www.peterfriese.de/android-testing-with-robolectric/" rel="nofollow noopener" target="_blank">この記事</a>の通りに、Robolectric に対応したプロジェクトを作る手順をまとめておきます。</p>

<h2>
<span id="robolectric-の役割" class="fragment"></span><a href="#robolectric-%E3%81%AE%E5%BD%B9%E5%89%B2"><i class="fa fa-link"></i></a>Robolectric の役割</h2>

<p>Android は、標準のフレームワークにテストフレームワークも含んでいます。<br>
JUnit3 をベースとして、モジュールのテストや画面のテストの為のフレームワークが提供されています。</p>

<p>一方、実行環境の制約から、Android エミュレータや端末上での実行が要求されます。テストの実行のためにエミュレータを立ち上げたり、テストの apk をインストールしたりする必要が有るため、テストそのものの実行に手間と時間がかかってしまいます。</p>

<p>Robolectric では、Android のフレームワークにある各種の API を JVM 上でエミュレートすることにより、テストの実行時間を短くスピーディにすることができます。</p>

<h2>
<span id="手順の概要" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>手順の概要</h2>

<ol>
<li>build.gradle の設定でテストの準備をする</li>
<li><del>TestRunner を拡張して、AndroidManifest を見えるようにする</del></li>
<li>テストを書く</li>
</ol>

<h2>
<span id="buildgradle-の準備" class="fragment"></span><a href="#buildgradle-%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>build.gradle の準備</h2>

<p>ビルドスクリプトに記述する内容は以下の通りです。</p>

<ol>
<li><del>android-test プラグインの導入</del></li>
<li>robolectric プラグインの導入</li>
<li>JUnit4, Robolectric, Android-FEST への依存の宣言</li>
<li><del>テスト用のディレクトリの変更</del></li>
</ol>

<p><del>現在、Robolectric は KitKat に対応していないため、TargetSDK と CompileWith の API Level を 18 にしておきます。</del><br>
この設定は<code>@Config</code>アノテーションを用いてテストコード中で設定できます。</p>

<p><strong>2015/03/10 追記：以下のスクリプトはすでに古く、動作する保証がありません。現時点で最新の記述はこの下にあります。</strong></p>

<div class="code-frame" data-lang="groovy"><div class="highlight"><pre><span></span><span class="n">buildscript</span> <span class="o">{</span>
    <span class="c1">// ビルドスクリプトの依存</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">mavenCentral</span><span class="o">()</span>
        <span class="n">maven</span> <span class="o">{</span> <span class="n">url</span> <span class="s1">'https://oss.sonatype.org/content/repositories/snapshots/'</span> <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">dependencies</span> <span class="o">{</span>
        <span class="n">classpath</span> <span class="s1">'com.android.tools.build:gradle:0.8.+'</span>
        <span class="n">classpath</span> <span class="s1">'com.squareup.gradle:gradle-android-test-plugin:0.9.1-SNAPSHOT'</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
    <span class="n">maven</span> <span class="o">{</span> <span class="n">url</span> <span class="s1">'https://oss.sonatype.org/content/repositories/snapshots/'</span> <span class="o">}</span>
<span class="o">}</span>

<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'android'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'android-test'</span>

<span class="n">android</span> <span class="o">{</span>
    <span class="n">compileSdkVersion</span> <span class="mi">18</span>
    <span class="n">buildToolsVersion</span> <span class="s2">"19.0.1"</span>

    <span class="n">defaultConfig</span> <span class="o">{</span>
        <span class="n">minSdkVersion</span> <span class="mi">7</span>
        <span class="n">targetSdkVersion</span> <span class="mi">18</span>
        <span class="n">versionCode</span> <span class="mi">1</span>
        <span class="n">versionName</span> <span class="s2">"1.0"</span>
    <span class="o">}</span>

    <span class="n">sourceSets</span> <span class="o">{</span>
        <span class="n">instrumentTest</span><span class="o">.</span><span class="na">setRoot</span><span class="o">(</span><span class="s1">'src/test'</span><span class="o">)</span>  <span class="c1">// テストディレクトリを test に変更する</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s1">'com.android.support:gridlayout-v7:19.0.1'</span>
    <span class="n">compile</span> <span class="s1">'com.android.support:support-v4:19.0.1'</span>
    <span class="n">compile</span> <span class="s1">'com.android.support:appcompat-v7:19.0.1'</span>
    <span class="n">testCompile</span> <span class="s1">'junit:junit:4.11'</span> <span class="c1">// JUnit 4</span>
    <span class="n">testCompile</span> <span class="s1">'org.robolectric:robolectric:2.3-SNAPSHOT'</span>  <span class="c1">// Robolectric 本体</span>
    <span class="n">testCompile</span> <span class="s1">'com.squareup:fest-android:1.0.+'</span> <span class="c1">// FEST(Fixtures for Easy Software Testing) を Android で利用するためのライブラリ</span>
    <span class="n">instrumentTestCompile</span> <span class="s1">'junit:junit:4.11'</span>
    <span class="n">instrumentTestCompile</span> <span class="s1">'org.robolectric:robolectric:2.3-SNAPSHOT'</span>
    <span class="n">instrumentTestCompile</span> <span class="s1">'com.squareup:fest-android:1.0.+'</span>
<span class="o">}</span>
</pre></div></div>

<p><strong>2015/03/10 追記：こちらが最新</strong></p>

<div class="code-frame" data-lang="groovy"><div class="highlight"><pre><span></span><span class="n">buildscript</span> <span class="o">{</span>
    <span class="c1">// ビルドスクリプトの依存</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">jcenter</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="n">dependencies</span> <span class="o">{</span>
        <span class="n">classpath</span> <span class="s1">'com.android.tools.build:gradle:1.1.0'</span>
        <span class="n">classpath</span> <span class="s1">'org.robolectric:robolectric-gradle-plugin:1.0.1'</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">repositories</span> <span class="o">{</span>
    <span class="n">jcenter</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'com.android.application'</span>
<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'org.robolectric'</span> <span class="c1">// 少し前まで robolectric でしたが、正式リリース以後 org.robolectric となります</span>

<span class="n">android</span> <span class="o">{</span>
    <span class="n">compileSdkVersion</span> <span class="mi">21</span>
    <span class="n">buildToolsVersion</span> <span class="s2">"21.1.2"</span>

    <span class="n">defaultConfig</span> <span class="o">{</span>
        <span class="n">minSdkVersion</span> <span class="mi">7</span>
        <span class="n">targetSdkVersion</span> <span class="mi">21</span>
        <span class="n">versionCode</span> <span class="mi">1</span>
        <span class="n">versionName</span> <span class="s2">"1.0"</span>
    <span class="o">}</span>
    <span class="c1">// robolectric のテストは androidTest ディレクトリに放り込むので sourceSet について特に記述なし</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s1">'com.android.support:gridlayout-v7:19.0.1'</span>
    <span class="n">compile</span> <span class="s1">'com.android.support:support-v4:19.0.1'</span>
    <span class="n">compile</span> <span class="s1">'com.android.support:appcompat-v7:19.0.1'</span>
    <span class="c1">// 以下、様々な transitive dependencies を exclude します</span>
    <span class="n">androidTestCompile</span><span class="o">(</span><span class="s1">'junit:junit:4.11'</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// JUnit4</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'hamcrest-core'</span>
    <span class="o">}</span>
    <span class="n">androidTestCompile</span><span class="o">(</span><span class="s1">'org.robolectric:robolectric:2.4'</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// Robolectric 本体</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'classworlds'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'commons-logging'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'httpclient'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'maven-artifact'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'maven-artifact-manager'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'maven-error-diagnostics'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'maven-model'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'maven-plugin-registry'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'maven-profile'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'maven-project'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'maven-settings'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'nekohtml'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'plexus-container-default'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'plexus-interpolation'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'plexus-utils'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'wagon-file'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'wagon-http-lightweight'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'wagon-http-shared'</span>
        <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">'wagon-provider-api'</span>
        <span class="n">exclude</span> <span class="nl">group:</span> <span class="s1">'com.android.support'</span><span class="o">,</span> <span class="nl">module:</span> <span class="s1">'support-v4'</span>
    <span class="o">}</span>
    <span class="n">androidTestCompile</span> <span class="s1">'org.mockito:mockito-all:1.9.5'</span>
    <span class="n">androidTestCompile</span> <span class="s1">'com.squareup:fest-android:1.0.+'</span> <span class="c1">// FEST(Fixtures for Easy Software Testing) を Android で利用するためのライブラリ</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="testrunner-の準備" class="fragment"></span><a href="#testrunner-%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a><del>TestRunner の準備</del>
</h2>

<p><del><code>src/test/java</code>にテストを配置する関係で、Robolectric が AndroidManifest を見つけられなくなるため、TestRunner を拡張して場所を指定します。</del></p>

<p><strong>2015/03/10 追記：以下の TestRunner は必要無くなりました。org.robolectric.RobolectricTestRunner を使用します。AndroidManifest については、<code>@Config</code>アノテーションを用います。</strong></p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.runners.model.InitializationError</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.robolectric.AndroidManifest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.robolectric.RobolectricTestRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.robolectric.annotation.Config</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.robolectric.res.Fs</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RobolectricGradleTestRunner</span> <span class="kd">extends</span> <span class="n">RobolectricTestRunner</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">RobolectricGradleTestRunner</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">testClass</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InitializationError</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">testClass</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">AndroidManifest</span> <span class="nf">getAppManifest</span><span class="o">(</span><span class="n">Config</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">manifestProperty</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"android.manifest"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">manifest</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">Config</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">manifestProperty</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">resProperty</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"android.resources"</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">assetsProperty</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"android.assets"</span><span class="o">);</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">AndroidManifest</span><span class="o">(</span><span class="n">Fs</span><span class="o">.</span><span class="na">fileFromPath</span><span class="o">(</span><span class="n">manifestProperty</span><span class="o">),</span> <span class="n">Fs</span><span class="o">.</span><span class="na">fileFromPath</span><span class="o">(</span><span class="n">resProperty</span><span class="o">),</span>
                    <span class="n">Fs</span><span class="o">.</span><span class="na">fileFromPath</span><span class="o">(</span><span class="n">assetsProperty</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">AndroidManifest</span> <span class="n">appManifest</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getAppManifest</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">appManifest</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div></div>

<p>以上で、プロジェクトの準備は完了です。</p>

<h2>
<span id="テストの記述" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E8%A8%98%E8%BF%B0"><i class="fa fa-link"></i></a>テストの記述</h2>

<p>Android フレームワークが提供するテストスートと違い、JUnit4 が使えるので、以下のようにテストが記述できます。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.robolectric.RobolectricTestRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.robolectric.annotation.Config</span><span class="o">;</span>

<span class="kn">import static</span> <span class="nn">org.junit.Assert.assertTrue</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">RobolectricTestRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">// TestRunner の指定</span>
<span class="nd">@Config</span><span class="o">(</span><span class="n">manifest</span> <span class="o">=</span> <span class="s">"src/main/AndroidManifest.xml"</span><span class="o">,</span> <span class="n">emulateSdk</span> <span class="o">=</span> <span class="mi">18</span><span class="o">)</span> <span class="c1">// sdk の api level を指定する</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyModuleTest</span> <span class="o">{</span>
    <span class="nd">@Test</span> <span class="c1">// テストケースの表明</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldPass</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">assertTrue</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>テストの実行は以下のようにします。</p>

<p><code>$ ./gradlew test</code></p>

<p>これで、エミュレータ無しにテストが実行できるようになりました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>59</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/78b048cf35fd03b8c689">Gradle で複数種類の apk をビルドする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-19 00:22:23</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Android]</b> <b>[Groovy]</b> <b>[gradle]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>複数種類の apk（ステージング用、リリース用など）をビルドするスクリプト。<br>
プロジェクトの<code>root</code>以下に、<code>conf</code>ディレクトリを掘って、その中に<code>keystore</code>ファイルを置くスタイル。debug 用のはリポジトリに入れておくと良さそう。release 用のは入れるとまずいので、そこだけ頑張らないといけない。</p>

<div class="code-frame" data-lang="groovy"><div class="highlight"><pre><span></span><span class="n">android</span> <span class="o">{</span>
    <span class="c1">// ...</span>

    <span class="c1">// デバッグ用 apk とリリース用 apk の署名の設定</span>
    <span class="n">signingConfigs</span> <span class="o">{</span>
        <span class="n">debug</span> <span class="o">{</span>
            <span class="n">storeFile</span> <span class="nf">file</span><span class="o">(</span><span class="s2">"conf/debug.keystore"</span><span class="o">)</span>
            <span class="n">storePassword</span> <span class="s2">"android"</span>
            <span class="n">keyAlias</span> <span class="s2">"androiddebugkey"</span>
            <span class="n">keyPassword</span> <span class="s2">"android"</span>
        <span class="o">}</span>
        <span class="n">release</span> <span class="o">{</span>
            <span class="n">storeFile</span> <span class="nf">file</span><span class="o">(</span><span class="s2">"conf/release.keystore"</span><span class="o">)</span>
            <span class="n">storePassword</span> <span class="s2">"fugafugahogehoge"</span>
            <span class="n">keyAlias</span> <span class="s2">"yokomark"</span>
            <span class="n">keyPassword</span> <span class="s2">"foobarbaz"</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// ビルドの種類に応じて、ビルド時に実行するステップを設定</span>
    <span class="n">buildTypes</span> <span class="o">{</span>
        <span class="n">release</span> <span class="o">{</span>
            <span class="n">debuggable</span> <span class="kc">false</span>
            <span class="n">zipAlign</span> <span class="kc">true</span>
            <span class="n">runProguard</span> <span class="kc">true</span>
            <span class="n">proguardFile</span> <span class="nf">getDefaultProguardFile</span><span class="o">(</span><span class="s1">'proguard-android-optimize.txt'</span><span class="o">)</span>
            <span class="n">signingConfig</span> <span class="n">signingConfigs</span><span class="o">.</span><span class="na">release</span>
        <span class="o">}</span>
        <span class="n">debug</span> <span class="o">{</span>
            <span class="n">debuggable</span> <span class="kc">true</span>
            <span class="n">zipAlign</span> <span class="kc">true</span>
            <span class="n">runProguard</span> <span class="kc">false</span>
            <span class="n">signingConfig</span> <span class="n">signingConfigs</span><span class="o">.</span><span class="na">debug</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">productFlavors</span> <span class="o">{</span>
        <span class="n">staging</span> <span class="o">{</span>
            <span class="n">proguardFile</span> <span class="s1">'proguard-rules.txt'</span>
            <span class="n">packageName</span> <span class="s2">"jp.yokomark.foo.staging"</span>
        <span class="o">}</span>

        <span class="n">production</span> <span class="o">{</span>
            <span class="n">proguardFile</span> <span class="s1">'proguard-rules.txt'</span>
            <span class="n">packageName</span> <span class="s2">"jp.yokomark.foo.product"</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>55</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/3aed43474f63300eab21">Fragment のテンプレート</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-18 23:49:31</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>自分の<code>Fragment</code>を作る時にテンプレとして書く必要のあるものを以下にまとめておく。</p>

<p>内容は<code>Fragment</code>初期化用の<code>static</code>メソッド。<br>
<code>Fragment</code>はデフォルトコンストラクタ以外のコンストラクタを持っていると、フレームワークがライフサイクル管理しきれなくなる。その理由は、<a href="http://developer.android.com/reference/android/app/Fragment.html" rel="nofollow noopener" target="_blank">Fragment | Android Developers</a> にある通り。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>All subclasses of Fragment must include a public empty constructor. The framework will often re-instantiate a fragment class when needed, in particular during state restore, and needs to be able to find this constructor to instantiate it. If the empty constructor is not available, a runtime exception will occur in some cases during state restore.
</pre></div></div>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">sample.fragment</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.support.v4.app.Fragment</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFragment</span> <span class="kd">extends</span> <span class="n">Fragment</span> <span class="o">{</span>
    <span class="c1">// メモリ不足による破棄後からの復帰時にフレームワークがリフレクションで呼びだすコンストラクタ</span>
    <span class="kd">public</span> <span class="nf">MyFragment</span><span class="o">()</span> <span class="o">{}</span>

    <span class="c1">// 自分のコードから Fragment の初期化に使うメソッド</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">MyFragment</span> <span class="nf">newInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">MyFragment</span> <span class="n">fragment</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyFragment</span><span class="o">();</span>
        <span class="c1">// 以下二行は、Fragment に初期化用の変数を渡したいときに使う</span>
        <span class="c1">// Bundle arguments = new Bundle();</span>
        <span class="c1">// fragment.setArguments(arguments);</span>
        <span class="k">return</span> <span class="n">fragment</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>IDE でテンプレを設定しておくと便利。</p>

<h3>
<span id="androidstudiointellij-でのテンプレート" class="fragment"></span><a href="#androidstudiointellij-%E3%81%A7%E3%81%AE%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>AndroidStudio(IntelliJ) でのテンプレート</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#if (${PACKAGE_NAME} &amp;&amp; ${PACKAGE_NAME} != "")package ${PACKAGE_NAME};#end

import android.support.v4.app.Fragment;
import android.os.Bundle;

#parse("File Header.java")
public class ${NAME} extends Fragment {
    public static final String TAG = ${NAME}.class.getSimpleName();

    public static ${NAME} newInstance() {
        ${NAME} fragment = new ${NAME}();
        Bundle args = new Bundle();
        fragment.setArguments(args);
        return fragment;
    }
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>42</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/a479ee529c520e829e7f">セクションヘッダー付きの GridView で、かつ「もっと読む」とか「PullToRefresh」もしたい</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-20 18:16:18</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ListView を用いて、ListView の中に GridView をねじ込んで実装する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>+--------------------+
|   Header content   |
+------+------+------+
| Cell | Cell | Cell |
+------+------+------+
| Cell | Cell | Cell |
+------+------+------+
| Cell | Cell | Cell |
+------+------+------+
|   Header content   |
+------+------+------+
| Cell | Cell | Cell |
+------+------+------+
| Cell | Cell | Cell |
+------+------+------+
| Cell | Cell | Cell |
+------+------+------+
...
</pre></div></div>

<h2>
<span id="データ構造" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0"><i class="fa fa-link"></i></a>データ構造</h2>

<p>一行分のデータを表すデータ構造は、</p>

<ul>
<li>セクションヘッダーとして取り扱う為のデータ</li>
<li>GridView に表示するリストのデータ</li>
</ul>

<p>このデータ構造を保持するコレクションを作って、ListView のアダプターに渡していくスタイル。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SectionData</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">mSectionName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">mImages</span><span class="o">;</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="レイアウト" class="fragment"></span><a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88"><i class="fa fa-link"></i></a>レイアウト</h2>

<p>リストの一行ごとに、GridView をねじ込んでいくスタイル。こうすれば、一行ごとのレイアウトに、GridView のセクションヘッダーの役割を果たすレイアウトを含めることが出来る。</p>

<p>このとき、スクロールのハンドリングが ListView と GridView で二重化してしまうので、GridView のスクロールをしないよう、高さを中身の数に合わせて固定化する（<a href="http://stackoverflow.com/questions/3862281/add-a-gridview-to-a-listview-in-android" rel="nofollow noopener" target="_blank">参考リンク</a>）。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="c1">// StackOverFlow の回答の実装</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NonScrollableGridView</span> <span class="kd">extends</span> <span class="n">GridView</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">NonScrollableGridView</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onMeasure</span><span class="o">(</span><span class="kt">int</span> <span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="kt">int</span> <span class="n">heightMeasureSpec</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Do not use the highest two bits of Integer.MAX_VALUE because they are</span>
        <span class="c1">// reserved for the MeasureSpec mode</span>
        <span class="kt">int</span> <span class="n">heightSpec</span> <span class="o">=</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">makeMeasureSpec</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="o">,</span> <span class="n">MeasureSpec</span><span class="o">.</span><span class="na">AT_MOST</span><span class="o">);</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onMeasure</span><span class="o">(</span><span class="n">widthMeasureSpec</span><span class="o">,</span> <span class="n">heightSpec</span><span class="o">);</span>
        <span class="n">getLayoutParams</span><span class="o">().</span><span class="na">height</span> <span class="o">=</span> <span class="n">getMeasuredHeight</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="アダプター" class="fragment"></span><a href="#%E3%82%A2%E3%83%80%E3%83%97%E3%82%BF%E3%83%BC"><i class="fa fa-link"></i></a>アダプター</h2>

<p>ListView 用のアダプターと、GridView 用のアダプターを用意する。</p>

<p>ListView 用のアダプターの <code>ListAdapter#getView(int, View, ViewGroup)</code>では、GridView の初期化と GridView 用のアダプターの初期化および設定をする。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SectionListAdapter</span> <span class="kd">extends</span> <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">SectionData</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">SectionListAdapter</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">SectionData</span><span class="o">&gt;</span> <span class="n">objects</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">list_item_layout</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">label_section_title</span><span class="o">,</span> <span class="n">objects</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Nullable</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">group</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">row</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getView</span><span class="o">(</span><span class="n">position</span><span class="o">,</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">group</span><span class="o">);</span>

        <span class="n">SectionData</span> <span class="n">data</span> <span class="o">=</span> <span class="n">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>

        <span class="n">TextView</span> <span class="n">sectionName</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">row</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">label_section_name</span><span class="o">);</span>
        <span class="n">sectionName</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getSectionName</span><span class="o">());</span>

        <span class="n">GridView</span> <span class="n">grid</span> <span class="o">=</span> <span class="o">(</span><span class="n">GridView</span><span class="o">)</span> <span class="n">row</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">grid</span><span class="o">);</span>
        <span class="n">SectionGridAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SectionGridAdapter</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="n">data</span><span class="o">.</span><span class="na">getImageUrls</span><span class="o">());</span>
        <span class="n">grid</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">row</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>GridView 用のアダプターは、いつもどおりセルのレイアウトを生成するコードを書く。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SectionGridAdapter</span> <span class="kd">extends</span> <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">SectionGridAdapter</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">objects</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">grid_item</span><span class="o">,</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">label_grid</span><span class="o">,</span> <span class="n">objects</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Nullable</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">group</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">View</span> <span class="n">cell</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getView</span><span class="o">(</span><span class="n">position</span><span class="o">,</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">group</span><span class="o">);</span>

        <span class="n">ImageView</span> <span class="n">image</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">cell</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">image_cell</span><span class="o">);</span>
        <span class="c1">// Picasso 使うなら</span>
        <span class="n">Picasso</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getContext</span><span class="o">()).</span><span class="na">load</span><span class="o">(</span><span class="n">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">)).</span><span class="na">into</span><span class="o">(</span><span class="n">image</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">cell</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="もっと読むとか-pulltorefresh-とか" class="fragment"></span><a href="#%E3%82%82%E3%81%A3%E3%81%A8%E8%AA%AD%E3%82%80%E3%81%A8%E3%81%8B-pulltorefresh-%E3%81%A8%E3%81%8B"><i class="fa fa-link"></i></a>もっと読むとか PullToRefresh とか</h2>

<p>ListView なので、もっと読むは FooterView が使える。</p>

<p>PullToRefresh も、<a href="https://github.com/chrisbanes/Android-PullToRefresh" rel="nofollow noopener" target="_blank">このライブラリ</a>であれば、ListView を PullToRefreshListView に置き換えて使うことができる。</p>

<p>簡単！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>29</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/f90575b9477b24fb1976">Amalgam でコードを整理する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-21 17:14:41</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="amalgam" class="fragment"></span><a href="#amalgam"><i class="fa fa-link"></i></a>Amalgam</h2>

<p><a href="https://github.com/nohana/Amalgam" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nohana/Amalgam</a></p>

<p>Android で頻出するコードをまとめた Utility ライブラリを使って、コードの整理をする。</p>

<h2>
<span id="リソース管理" class="fragment"></span><a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E7%AE%A1%E7%90%86"><i class="fa fa-link"></i></a>リソース管理</h2>

<p>Stream I/O なら以下のように。<br>
try-finally ブロックでストリームを閉じるときの null チェックと例外のキャッチをしてくれる。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">ContentResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getContentResolver</span><span class="o">();</span>
<span class="n">InputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="na">openInputStream</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"content://something/to/read/1"</span><span class="o">));</span>
    <span class="c1">// read stream</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">CloseableUtils</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
<span class="o">}</span>
</pre></div></div>

<p>Cursor は Closeable であるが、CloseableUtils を使うと具合が悪い（Closeable#close() では例外となる）ため、以下のようにする。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">ContentResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getContentResolver</span><span class="o">();</span>
<span class="n">Cursor</span> <span class="n">c</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">CursorUtils</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="parcel" class="fragment"></span><a href="#parcel"><i class="fa fa-link"></i></a>Parcel</h2>

<p>boolean に関するシリアライズとデシリアライズのメソッドが Parcel にないので、以下のようにする。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyParcelable</span> <span class="kd">implements</span> <span class="n">Parcelable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mHoge</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MyParcelable</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mHoge</span> <span class="o">=</span> <span class="n">ParcelUtils</span><span class="o">.</span><span class="na">readBoolean</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeToParcel</span><span class="o">(</span><span class="n">Parcel</span> <span class="n">dest</span><span class="o">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ParcelUtils</span><span class="o">.</span><span class="na">writeBoolean</span><span class="o">(</span><span class="n">dest</span><span class="o">,</span> <span class="n">mHoge</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="thread" class="fragment"></span><a href="#thread"><i class="fa fa-link"></i></a>Thread</h2>

<p>メソッドの呼び出しがどのスレッドで実行されているかをチェックする。<br>
ブロックするメソッドはメインスレッドで呼ばれてほしくないので、もしメインスレッドで呼んでいたら例外を投げたいし、UI を操作するメソッドはメインスレッドで呼ばれてほしいので、それ以外のスレッドで呼んでいたら例外を投げたい、という時に使う。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">blockingGet</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ThreadUtils</span><span class="o">.</span><span class="na">checkNotMainThread</span><span class="o">();</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="dialogfragment" class="fragment"></span><a href="#dialogfragment"><i class="fa fa-link"></i></a>DialogFragment</h2>

<p>LoaderCallbacks のメソッド内での FragmentTransaction は許可されていないので、Handler 経由で表示や非表示の切り替えをする。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">DialogFragmentUtils</span><span class="o">.</span><span class="na">dismissOnLoaderCallback</span><span class="o">(</span><span class="n">fragmentManager</span><span class="o">,</span> <span class="s">"MY_DIALOG_TAG"</span><span class="o">);</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>26</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/0778d568c5814bfa0bf4">ProductFlavor を宣言した時の、手軽な ContentProvider の Authority の扱い方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-07 18:53:39</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> <b>[Groovy]</b> <b>[gradle]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="productflavor-による用途別の-apk-の生成" class="fragment"></span><a href="#productflavor-%E3%81%AB%E3%82%88%E3%82%8B%E7%94%A8%E9%80%94%E5%88%A5%E3%81%AE-apk-%E3%81%AE%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>ProductFlavor による用途別の apk の生成</h2>

<h3>
<span id="productflavor-とは" class="fragment"></span><a href="#productflavor-%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>ProductFlavor とは</h3>

<p>Gradle で ProductFlavor を使うと、用途別に apk を作り分けることができます。<br>
例えば、バックエンドを開発用のものと本番用のものとを用意して適宜切り替えたり、課金版と無料版とを切り替えたり、といった具合に、apk を作り分けることができます。</p>

<p>apk を作り分けるにあたって、パッケージ名を ProductFlavor 毎に定義することもでき、これによって、用途別に作り分けた apk を一つの端末上に共存させることが出来るようになります。</p>

<h3>
<span id="contentprovider-を持つアプリでの-productflavor" class="fragment"></span><a href="#contentprovider-%E3%82%92%E6%8C%81%E3%81%A4%E3%82%A2%E3%83%97%E3%83%AA%E3%81%A7%E3%81%AE-productflavor"><i class="fa fa-link"></i></a>ContentProvider を持つアプリでの ProductFlavor</h3>

<p>さて、この時、ContentProvider を持つアプリを作ることを考えると、同じ端末上に同じ Authority を持つ ContentProvider を共存させることはできない為、通常とは別の手順を踏んで、ContentProvider の Authority を ProductFlavor 毎に変える作業が必要になります。</p>

<p>この記事では、その手順をまとめます。</p>

<h2>
<span id="作業全体の概要" class="fragment"></span><a href="#%E4%BD%9C%E6%A5%AD%E5%85%A8%E4%BD%93%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>作業全体の概要</h2>

<p>やることは以下のとおりです。</p>

<ol>
<li>build.gradle の中の productFlavors の宣言で、BuildConfig に宣言するフィールドを追記する</li>
<li>AndroidManifest.xml を、productFlavors 毎に用意し、<code>&lt;provider&gt;</code> の <code>android:authorities</code> を、productFlavors 毎 BuildConfig に宣言したものにする</li>
<li>ContentProvider の実装で AUTHORITY を BuildConfig に宣言したものを参照するようにする</li>
<li>通常通り ContentProvider の中身を実装する</li>
</ol>

<p>また、前提として、AndroidStudio を最新版（0.4.3）にしておくこと、Gradle Plugin のバージョンを最新（0.8.+）にしておくこと、Gradle 自体のバージョンを（1.10）にしておくことをご確認下さい。</p>

<h2>
<span id="buildgradle-の準備" class="fragment"></span><a href="#buildgradle-%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>build.gradle の準備</h2>

<p>ビルドスクリプトには、ProductFlavor ごとに BuildConfig に宣言するフィールドの値を変えるようにしておきます。</p>

<p>最新の Gradle Plugin（0.8.+） では、BuildConfig にフィールドを宣言するための専用のメソッドが用意されているので、これを使います。</p>

<p><code>buildConfigField "String", "FIELD_NAME", "\\"field_value\\""</code></p>

<p><code>buildConfigField</code> メソッドに、3 つの引数を渡します。<br><br>
最初の引数は、フィールドの型です。<br><br>
次の引数は、フィールドの名前です。<br>
最後の引数は、フィールドに代入する値です。型が <code>String</code> の場合、文字列リテラルのためのダブルクオートを含める必要が有るため、エスケープシーケンスを使う必要がある点に注意します。</p>

<div class="code-frame" data-lang="groovy"><div class="highlight"><pre><span></span><span class="n">android</span> <span class="o">{</span>
    <span class="c1">// ... {snip} ...</span>

    <span class="n">productFlavors</span> <span class="o">{</span>
        <span class="n">staging</span> <span class="o">{</span>
            <span class="n">proguardFile</span> <span class="s1">'proguard-rules.txt'</span>
            <span class="n">packageName</span> <span class="s2">"jp.yokomark.sample.gradle.provider.stg"</span>
            <span class="n">buildConfigField</span> <span class="s2">"String"</span><span class="o">,</span> <span class="s2">"PROVIDER_SAMPLE_AUTHORITY"</span><span class="o">,</span> <span class="s2">"\"jp.yokomark.sample.gradle.provider.stg.SampleProvider\""</span>
        <span class="o">}</span>

        <span class="n">production</span> <span class="o">{</span>
            <span class="n">proguardFile</span> <span class="s1">'proguard-rules.txt'</span>
            <span class="n">packageName</span> <span class="s2">"jp.yokomark.sample.gradle.provider"</span>
            <span class="n">buildConfigField</span> <span class="s2">"String"</span><span class="o">,</span> <span class="s2">"PROVIDER_SAMPLE_AUTHORITY"</span><span class="o">,</span> <span class="s2">"\"jp.yokomark.sample.gradle.provider.SampleProvider\""</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="productflavor-毎のディレクトリに-androidmanifestxml-を格納する" class="fragment"></span><a href="#productflavor-%E6%AF%8E%E3%81%AE%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB-androidmanifestxml-%E3%82%92%E6%A0%BC%E7%B4%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ProductFlavor 毎のディレクトリに AndroidManifest.xml を格納する</h2>

<p>以下に、それぞれのディレクトリに含める AndroidManifest.xml のサンプルを示します。<br>
注意する点として、<code>main/AndroidManifest.xml</code>には、ContentProvider の宣言を入れないようにしておく必要があります。</p>

<p><code>production/AndroidManifest.xml</code></p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span>
    <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">package=</span><span class="s">"jp.yokomark.sample.gradle.provider"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">"true"</span>
        <span class="na">android:icon=</span><span class="s">"@drawable/ic_launcher"</span>
        <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
        <span class="na">android:theme=</span><span class="s">"@style/AppTheme"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;provider</span>
            <span class="na">android:authorities=</span><span class="s">"jp.yokomark.sample.gradle.provider.SampleProvider"</span>
            <span class="na">android:name=</span><span class="s">".SampleProvider"</span>
            <span class="na">android:exported=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</pre></div></div>

<p><code>staging/AndroidManifest.xml</code></p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span>
    <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">package=</span><span class="s">"jp.yokomark.sample.gradle.provider"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;application</span>
        <span class="na">android:allowBackup=</span><span class="s">"true"</span>
        <span class="na">android:icon=</span><span class="s">"@drawable/ic_launcher"</span>
        <span class="na">android:label=</span><span class="s">"@string/app_name"</span>
        <span class="na">android:theme=</span><span class="s">"@style/AppTheme"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;provider</span>
            <span class="na">android:authorities=</span><span class="s">"jp.yokomark.sample.gradle.provider.stg.SampleProvider"</span>
            <span class="na">android:name=</span><span class="s">".SampleProvider"</span>
            <span class="na">android:exported=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></div></div>

<h2>
<span id="contentprovider-の実装で見る-authority-の参照先を-buildconfig-に向ける" class="fragment"></span><a href="#contentprovider-%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%A7%E8%A6%8B%E3%82%8B-authority-%E3%81%AE%E5%8F%82%E7%85%A7%E5%85%88%E3%82%92-buildconfig-%E3%81%AB%E5%90%91%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>ContentProvider の実装で見る AUTHORITY の参照先を BuildConfig に向ける</h2>

<p>以上の手順を実行し、一度 Sync Project with Gradle Files を実行しておくと、BuildConfig に build.gradle で宣言したフィールドが注入されているはずです。<br>
その後、以下のように AUHORITY の宣言を BuildConfig のものに切り替えることで、自動で ProductFlavor 毎のものに設定することが出来るようになります。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleProvider</span> <span class="kd">extends</span> <span class="n">ContentProvider</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">AUTHORITY</span> <span class="o">=</span> <span class="n">BuildConfig</span><span class="o">.</span><span class="na">PROVIDER_SAMPLE_AUTHORITY</span><span class="o">;</span>
    <span class="c1">// ... {snip} ...</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="問題点" class="fragment"></span><a href="#%E5%95%8F%E9%A1%8C%E7%82%B9"><i class="fa fa-link"></i></a>問題点</h2>

<p>AndroidManifest.xml と build.gradle の双方に、Authority の文字列を宣言しなければならないため、間違うととても悲しいことになりますので注意して下さい。</p>

<h2>
<span id="サンプル" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB"><i class="fa fa-link"></i></a>サンプル</h2>

<p><a href="https://github.com/KeithYokoma/GradleSandbox" rel="nofollow noopener" target="_blank">GitHub</a> にサンプルのプロジェクト全体のコードを挙げましたので、御覧ください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>23</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/8e5533bb88d141f1c2fd">AndroidStudio 0.5.0 にアップデートしたらやるべきこと</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-07 11:55:14</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[gradle]</b> <b>[AndroidStudio]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>リリースノートの和訳的なものですが、見落としがちなのでメモ。</p>

<h2>
<span id="gradle-plugin-のアップデート" class="fragment"></span><a href="#gradle-plugin-%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>Gradle Plugin のアップデート</h2>

<p>AndroidStudio 0.5.0 になり、Gradle Plugin もバージョンアップする必要があります。</p>

<div class="code-frame" data-lang="groovy"><div class="highlight"><pre><span></span><span class="n">buildscript</span> <span class="o">{</span>
  <span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">classpath</span> <span class="s1">'com.android.tools.build:gradle:0.9.+'</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="テスト用ライブラリの依存関係を解決する-dsl-の変更" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E7%94%A8%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%82%92%E8%A7%A3%E6%B1%BA%E3%81%99%E3%82%8B-dsl-%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>テスト用ライブラリの依存関係を解決する DSL の変更</h2>

<p><code>instrumentTestCompile</code>および<code>testCompile</code>が存在しなくなります。かわりに、<code>androidTestCompile</code>を使用します。</p>

<div class="code-frame" data-lang="groovy"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">androidTestCompile</span> <span class="s1">'com.squareup:fest-android:1.0.+'</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="ライブラリプロジェクトの-build-valiant-dsl" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE-build-valiant-dsl"><i class="fa fa-link"></i></a>ライブラリプロジェクトの Build Valiant DSL</h2>

<p>android 直下においていた<code>debug</code>や<code>release</code>、<code>debugSigningConfig</code>は以下のように変更します。</p>

<div class="code-frame" data-lang="groovy"><div class="highlight"><pre><span></span><span class="n">android</span> <span class="o">{</span>
  <span class="n">buildTypes</span> <span class="o">{</span>
    <span class="n">debug</span> <span class="o">{</span>
    <span class="o">}</span>
    <span class="n">release</span> <span class="o">{</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">signingConfigs</span> <span class="o">{</span>
    <span class="n">debug</span> <span class="o">{</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<h2>
<span id="gradle-sync-failed-する場合" class="fragment"></span><a href="#gradle-sync-failed-%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Gradle sync failed する場合</h2>

<p><a href="https://camo.qiitausercontent.com/1a5a3dcfc5fd5eca808a65d03208d8ca615dd93b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33313832392f30393136343966312d643130372d303138622d363135332d3366316366353832633065372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1a5a3dcfc5fd5eca808a65d03208d8ca615dd93b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33313832392f30393136343966312d643130372d303138622d363135332d3366316366353832633065372e706e67" alt="スクリーンショット 2014-03-07 11.46.36.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/31829/091649f1-d107-018b-6153-3f1cf582c0e7.png"></a></p>

<p>こんな感じで、キャッシュのロック待ちでタイムアウトする場合は、File &gt; Invalidate caches / Restart を使ってキャッシュをクリアしてください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>21</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/e7c7b960a0fb1d983355">support-v7-appcompat を使うときの menu リソースの showAsAction</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-18 23:33:20</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>特に、ActionBar の ActionItem として使うときの<code>showAsAction</code>属性の指定の仕方にクセがあるので注意する。</p>

<p>通常では、<code>showAsAction</code>属性の名前空間は<code>android</code>なので、<code>android:showAsAction</code>と記述するが、support-v7-appcompat を使うときは、support-v7-appcompat 用の名前空間を使用しなければならない為、以下のようにする。</p>

<p>support-v7-appcompat を使いつつ<code>android:showAsAction</code>とした場合は、その属性は無視され OverFlow にまとめられてしまう。</p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;menu</span>
    <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:compat=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;item</span>
        <span class="na">android:id=</span><span class="s">"@+id/action_ok"</span>
        <span class="na">compat:showAsAction=</span><span class="s">"always"</span>
        <span class="na">android:title=</span><span class="s">"@string/action_ok"</span><span class="nt">/&gt;</span> 
    <span class="nt">&lt;item</span>
        <span class="na">android:id=</span><span class="s">"@+id/action_cancel"</span>
        <span class="na">compat:showAsAction=</span><span class="s">"always"</span>
        <span class="na">android:title=</span><span class="s">"@string/action_cancel"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/menu&gt;</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/93d1fc5c05a5350bce80">DialogFragment の中で使う DialogInterface.OnClickListener の取り扱い</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-19 20:01:40</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>DialogFragment で AlertDialog などを作った時、OK や Cancel 等のボタンをおした時のイベントハンドラ(<code>DialogInterface.OnClickListener</code>)の実装をどうするかという話。</p>

<ol>
<li>
<code>DialogFragment</code> はシステムによって破棄・復帰される可能性がある為、コンストラクタや setter を用いて <code>DialogInterface.OnClickListener</code> は渡せない</li>
<li>
<code>DialogInterface.OnClickListener</code> は <code>Parcelable</code> でも <code>Serializable</code> でも無いので、<code>Bundle</code> に詰めることが出来ない</li>
</ol>

<p>以上の事から、<code>DialogInterface.OnClickListener</code> の実装方法は以下のようになる。</p>

<ul>
<li>
<code>Activity</code> で <code>DialogInterface.OnClickListener</code> を <code>implements</code> し、<code>DialogFragment#onAttach(Activity)</code> をオーバライドして、引数の <code>Activity</code> をキャストしてメンバ変数に保持しておく</li>
</ul>

<p>または</p>

<ul>
<li>
<code>Activity</code> で <code>DialogInterface.OnClickListener</code> を <code>implements</code> し、<code>DialogFragment#onCreateDialog(Bundle)</code> の実装の中で、<code>DialogFragment#getActivity()</code> で得られる <code>Activity</code> をキャストして使う</li>
</ul>

<p>のいずれかになる。</p>

<p>もし <code>Activity</code> が <code>DialogInterface.OnClickListener</code> を <code>implements</code> したく無い場合は、別のフレームワークを使って対処する。</p>

<ul>
<li>DI コンテナ（RoboGuice や Proton など）を用い、イベントを受けた時の処理内容を持つクラスのインスタンスが <code>Activity</code> と <code>DialogFragment</code> で同じものをインジェクトされるようにすれば、<code>Activity</code> がダイアログのボタンのクリックハンドラを実装する必要がなくなり、<code>DialogFragment</code> でイベント処理を完結できる</li>
</ul>

<p>あるいは</p>

<ul>
<li>イベントバスを用いることで、クリックイベントのハンドリング自体は <code>DialogFragment</code> で行い、<code>DialogInterface.OnClickListener</code> の実装で発火したイベントを <code>Activity</code> で受け取ることで、インタフェースの実装をしなくて済む</li>
</ul>

<p>もしくは</p>

<ul>
<li>イベントを受けた時の処理内容を持つクラスが <code>Parcelable</code> を <code>implements</code> するようにし、<code>DialogFragment</code> の初期化時に <code>Activity</code> から <code>Bundle</code> を介して渡す</li>
</ul>

<p><code>Parcelable</code> を <code>implements</code> するよりは、DI コンテナやイベントバスを使うほうが何かと便利ではある。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>12</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/1a446f6123e7f1ddbfd5">attrs.xml に同じ名前・型の属性名を定義したい</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-21 01:05:26</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Android]</b> <b>[XML]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>CustomView を作っていると、独自の xml の属性を定義するために<code>attrs.xml</code>を作って、<code>&lt;declare-styleable&gt;</code>でアトリビュートを定義する場面があります。</p>

<p>この時、同じ型で同じ名前の属性を、複数の CustomView にまたがって使い回したい場面で、以下のようにすると、エラーでビルドできません。</p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre><span></span>
<span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"CompoundRelativeLayout"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span> <span class="na">format=</span><span class="s">"boolean|reference"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"CompoundFrameLayout"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span> <span class="na">format=</span><span class="s">"boolean|reference"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"CompoundGridLayout"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span> <span class="na">format=</span><span class="s">"boolean|reference"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"CompoundLinearLayout"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span> <span class="na">format=</span><span class="s">"boolean|reference"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</pre></div></div>

<p>同じ名前・型の属性を複数宣言していることになるため、コンパイルに失敗します。</p>

<p><code>&lt;attr&gt;</code>タグは、<code>&lt;declare-styleable&gt;</code>タグの子要素としてだけでなく、<code>&lt;resources&gt;</code>タグの子要素としても配置することが出来、<code>&lt;resources&gt;</code>タグの子要素としておくことで、複数の CustomView で共通な名前・型の属性を宣言することになります。</p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre><span></span>
<span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span> <span class="na">format=</span><span class="s">"boolean|reference"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"CompoundRelativeLayout"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"CompoundFrameLayout"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"CompoundGridLayout"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
    <span class="nt">&lt;declare-styleable</span> <span class="na">name=</span><span class="s">"CompoundLinearLayout"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">"checked"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/declare-styleable&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</pre></div></div>

<p>これで無事コンパイルできるようになりました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/9f11cdfd0c4e4379ae7b">EditText を継承するときに気をつけること</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-07 20:41:52</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>EditText を拡張し、独自のアトリビュートを宣言し、それを読み取って使うときに注意する点。</p>

<h2>
<span id="ontextchanged-コールバックはコンストラクタから呼ばれる" class="fragment"></span><a href="#ontextchanged-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%AF%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E3%81%8B%E3%82%89%E5%91%BC%E3%81%B0%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>onTextChanged コールバックはコンストラクタから呼ばれる</h2>

<p>EditText の親の TextView には、<code>TextView#onTextChanged(CharSequence, int, int, int)</code>というコールバックがあり、これを継承することで、<code>TextWatcher</code>を使わなくても、セットしている文字列の変更をモニタできます。</p>

<p>このコールバックは、通常<code>TextView#setText()</code>のような文字列の変更を行うメソッドの中で呼ばれますが、もう一つ、TextView を初期化するコンストラクタでも呼び出されています(Android 4.4.2 のコードベースではL3817あたり)。</p>

<p>オーバライドすることを許されたメソッドをコンストラクタで呼び出す危険性は EffectiveJava が説明している通りですが、もし継承によって拡張した独自の EditText が、<code>TextView#onTextChanged(CharSequence, int, int, int)</code>をオーバライドして、コンストラクタで初期化している(と思っている)はずのオブジェクトを使用していた場合、容易に NullPointerException なり何かしらの実行時例外が起こってしまいます。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="c1">// super のコンストラクタで onTextChanged が呼ばれてしまう</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyEditText</span> <span class="kd">extends</span> <span class="n">EditText</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Something</span> <span class="n">mSomething</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MyEditText</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

        <span class="n">init</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">MyEditText</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>

        <span class="n">init</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">MyEditText</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyle</span><span class="o">);</span>

        <span class="n">init</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyle</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">defStyle</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mSomething</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Something</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onTextChanged</span><span class="o">(</span><span class="n">CharSequence</span> <span class="n">text</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">lengthBefore</span><span class="o">,</span> <span class="kt">int</span> <span class="n">lengthAfter</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onTextChanged</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="n">start</span><span class="o">,</span> <span class="n">lengthBefore</span><span class="o">,</span> <span class="n">lengthAfter</span><span class="o">);</span>

        <span class="n">mSomething</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span> <span class="c1">// コンストラクタで呼ばれてしまうので、mSomething が null のまま</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/7092dd258bad64f85859">TextView にまつわる機種依存の話</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-21 19:57:07</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Android]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="長文の省略の話" class="fragment"></span><a href="#%E9%95%B7%E6%96%87%E3%81%AE%E7%9C%81%E7%95%A5%E3%81%AE%E8%A9%B1"><i class="fa fa-link"></i></a>長文の省略の話</h2>

<p>有名どころ過ぎて、既にいくつかの回避策が講じられている。</p>

<p><a href="http://qiita.com/hackugyo/items/e23ecfda14bdfc672e7c" class="autolink" id="reference-04a7231edb5aee1677a0">http://qiita.com/hackugyo/items/e23ecfda14bdfc672e7c</a></p>

<p>ここでは、API リファレンスを見た上で考えられる実装を元に、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>hoge fuga piyo
foo bar ...
</pre></div></div>

<p>こんな感じになることを期待して、以下のように書いてみる。</p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre><span></span><span class="nt">&lt;TextView</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
    <span class="na">android:text=</span><span class="s">"hoge fuga piyo foo bar baz qux quux corge grault garply waldo fred plugh xyzzy thud"</span>
    <span class="na">android:maxLines=</span><span class="s">"2"</span>
    <span class="na">android:ellipsize=</span><span class="s">"end"</span> <span class="nt">/&gt;</span>
</pre></div></div>

<p>これを、ScrollView の子要素に持ってくると、人気上位の特定機種（Galaxy S2）で問題（スクロールのレンダリング中に ellipsize 処理が必要以上に呼ばれパフォーマンスを損ない、ANR にならないものの実質スクロールが反応しないように見える）が発生する。</p>

<p>省略する対象の文章が長ければ長いほどパフォーマンスが目に見えて劣化する。</p>

<h2>
<span id="回避策" class="fragment"></span><a href="#%E5%9B%9E%E9%81%BF%E7%AD%96"><i class="fa fa-link"></i></a>回避策</h2>

<p>素直に、<a href="http://qiita.com/hackugyo/items/e23ecfda14bdfc672e7c">この記事</a>で提示されている回避策を取るのが良さそう。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>KeithYokomaさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/KeithYokoma/items/cab14fa175a679902f52">AndroidStudio で gradle.build に記述した依存関係が完全に解決できなくなった時に見るページ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-23 15:05:53</center>
	</td>
	<td style="width:200px;">
		@KeithYokoma<br />(Drivemode, inc. / DroidKaigi 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/31829/profile-images/1499656297">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Android]</b> <b>[gradle]</b> <b>[AndroidStudio]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>AndroidStudio 0.4.2 で、build.gradle の dependencies に依存関係を記述して Sync Project with Gradle Files した時、aar ファイル自体は解決できているものの、その中にある jar にパスが通らず、ライブラリのパッケージが解決できない時がある。</p>

<p>そうなった時には、以下の手順でこの不具合を解消する事ができる。</p>

<ol>
<li>AndroidStudio を終了する</li>
<li>プロジェクト内の iml ファイルを rm する</li>
<li>再度 AndroidStudio を立ち上げ、プロジェクトの読み込みを待つ</li>
</ol>

<p>追記</p>

<p>AndroidStudio 0.4.3 でこの問題は修正されました！めでたしめでたし</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
