<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (yusabana)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (yusabana さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1033</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/8ce54577d959bb085b37">Rails4 今のところ最強なデバッグツール達</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-24 03:17:55</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> <b>[pry]</b> <b>[debug]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><strong>Gemfile</strong> の 「group :test, :development do」ブロックに書いている <strong>個人的に最強な設定</strong> を晒したいと思います。(2013/10/24 現在)</p>

<h2>
<span id="作業環境" class="fragment"></span><a href="#%E4%BD%9C%E6%A5%AD%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>作業環境</h2>

<ul>
<li>Ruby 2.0.0p247</li>
<li>Rails 4.0.0</li>
</ul>

<h2>
<span id="gemfileに設定している内容" class="fragment"></span><a href="#gemfile%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E5%86%85%E5%AE%B9"><i class="fa fa-link"></i></a>Gemfileに設定している内容</h2>

<p><strong><em>※ コメントに随時変更したものを追記しますー</em></strong></p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">group</span> <span class="ss">:test</span><span class="p">,</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">'pry-rails'</span>
  <span class="n">gem</span> <span class="s1">'pry-doc'</span>
  <span class="n">gem</span> <span class="s1">'pry-stack_explorer'</span>

  <span class="k">if</span> <span class="no">RUBY_VERSION</span> <span class="o">&gt;=</span> <span class="s1">'2.0.0'</span>
    <span class="n">gem</span> <span class="s1">'pry-byebug'</span>
  <span class="k">else</span>
    <span class="c1"># 以下はRuby1.9の時のみ使う(pry-byebugの代わりに)</span>
    <span class="c1"># debuggerは1.9以下でしか動作しない, remote は byebug で使えないようになった</span>
    <span class="n">gem</span> <span class="s1">'pry-debugger'</span>
    <span class="n">gem</span> <span class="s1">'pry-remote'</span>
  <span class="k">end</span>

  <span class="n">gem</span> <span class="s1">'better_errors'</span>
  <span class="n">gem</span> <span class="s1">'binding_of_caller'</span>

  <span class="n">gem</span> <span class="s1">'hirb'</span>
  <span class="n">gem</span> <span class="s1">'hirb-unicode'</span>

  <span class="n">gem</span> <span class="s1">'tapp'</span>
  <span class="n">gem</span> <span class="s1">'awesome_print'</span>
  <span class="n">gem</span> <span class="s1">'quiet_assets'</span>
  <span class="n">gem</span> <span class="s1">'annotate'</span><span class="p">,</span> <span class="ss">git</span><span class="p">:</span> <span class="s1">'git://github.com/ctran/annotate_models.git'</span>
  <span class="n">gem</span> <span class="s1">'timecop'</span>
  <span class="n">gem</span> <span class="s1">'rspec-rails'</span>
  <span class="n">gem</span> <span class="s1">'guard-rspec'</span>
  <span class="n">gem</span> <span class="s1">'factory_girl_rails'</span>
  <span class="n">gem</span> <span class="s1">'database_rewinder'</span>
<span class="k">end</span>
</pre></div>
</div>

<h3>
<span id="1pry-rails-について" class="fragment"></span><a href="#1pry-rails-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>1.pry-rails について</h3>

<p><code>rails console</code>をirbではなくpryにしてくれる<br>
<a href="https://github.com/rweng/pry-rails" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/rweng/pry-rails</a></p>

<h3>
<span id="2pry-doc-について" class="fragment"></span><a href="#2pry-doc-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>2.pry-doc について</h3>

<p>pry上でクラスやメソッドなどのドキュメントや定義元のソースコードを確認できる</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">pry-doc</span></div>
<div class="highlight"><pre><span></span><span class="err">■ドキュメントを見る</span>
<span class="n">show</span><span class="o">-</span><span class="n">doc</span> <span class="nb">String</span><span class="o">.</span><span class="n">nil?</span>
<span class="no">OR</span>
<span class="p">?</span> <span class="nb">String</span><span class="o">.</span><span class="n">nil?</span>

<span class="err">■ソースを見る</span>
<span class="n">show</span><span class="o">-</span><span class="n">source</span> <span class="nb">String</span><span class="o">.</span><span class="n">nil?</span>
<span class="no">OR</span>
<span class="err">$</span> <span class="nb">String</span><span class="o">.</span><span class="n">nil?</span>
</pre></div>
</div>

<p><a href="https://github.com/pry/pry-doc" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/pry/pry-doc</a></p>

<h3>
<span id="3-デバッガーの各種gem" class="fragment"></span><a href="#3-%E3%83%87%E3%83%90%E3%83%83%E3%82%AC%E3%83%BC%E3%81%AE%E5%90%84%E7%A8%AEgem"><i class="fa fa-link"></i></a>3 デバッガーの各種Gem</h3>

<h4>
<span id="3-ⅰ-pry-byebugruby20以上専用-について" class="fragment"></span><a href="#3-%E2%85%B0-pry-byebugruby20%E4%BB%A5%E4%B8%8A%E5%B0%82%E7%94%A8-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>3-Ⅰ. pry-byebug(ruby2.0以上専用) について</h4>

<p><code>ブレークポイント</code>を仕込みたいソースコード上に<code>binding.pry</code> という文字列を仕込むことで、<code>rails server</code>で起動したコンソール上でブレークポイントを通るときにpryによるデバッガが立ち上がる。</p>

<p><em>注) pry-byebug は <code>Ruby2.0 以上</code> でしか使えない</em><br>
<a href="http://qiita.com/joker1007/items/f132db1b4a5e3f9278e9" id="reference-8f9cf2b86ca702fcc3c5">Ruby 2.0 向けのデバッガー byebugについて</a><br>
<a href="http://qiita.com/awakia/items/b79188f1cc710bae4b8d" id="reference-602d42a4ca4d04e349b0">pryでのデバッグ中にnextがstepの様な挙動をしてしまう問題の解決法</a><br>
<a href="http://philippos2.github.io/blog/2013/07/28/about-byebug-for-debug-with-pry/" rel="nofollow noopener" target="_blank">About-byebug-for-debug-with-pry</a></p>

<h4>
<span id="3-ⅱ-pry-stack_explorer-について" class="fragment"></span><a href="#3-%E2%85%B1-pry-stack_explorer-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>3-Ⅱ. pry-stack_explorer について</h4>

<p>pry-stack_explorerはデバッガ起動時に<code>show-stack</code>と入力することでその時のスタックの情報が見られる。</p>

<p>■pry-stack_explorerで使えるコマンド</p>

<table>
<thead>
<tr>
<th style="text-align: center">コマンド</th>
<th style="text-align: center">機能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">show-stack</td>
<td style="text-align: center">スタック表示</td>
</tr>
<tr>
<td style="text-align: center">up</td>
<td style="text-align: center">親のフレームに移動</td>
</tr>
<tr>
<td style="text-align: center">down</td>
<td style="text-align: center">参照されているフレームに移動</td>
</tr>
<tr>
<td style="text-align: center">frame</td>
<td style="text-align: center">詳細フレームに移動</td>
</tr>
</tbody>
</table>

<h4>
<span id="3-ⅲ-pry-debuggerruby19以下専用-について" class="fragment"></span><a href="#3-%E2%85%B2-pry-debuggerruby19%E4%BB%A5%E4%B8%8B%E5%B0%82%E7%94%A8-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>3-Ⅲ. pry-debugger(ruby1.9以下専用) について</h4>

<p>pry-byebugと使う用途は同じ。</p>

<p><em>注) pry-debugger は <code>Ruby1.9 以下</code> でしか使えない。</em><br>
<a href="https://github.com/nixme/pry-debugger" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nixme/pry-debugger</a><br>
<a href="https://github.com/pry/pry/wiki/Available-plugins#pry-debugger" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/pry/pry/wiki/Available-plugins#pry-debugger</a></p>

<h4>
<span id="3-ⅳ-pry-remote-について" class="fragment"></span><a href="#3-%E2%85%B3-pry-remote-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>3-Ⅳ. pry-remote について</h4>

<p>アプリサーバを<code>バックグランド</code>で動かしている時 (<a href="http://pow.cx/" rel="nofollow noopener" target="_blank">Pow!!</a> または <a href="http://unicorn.bogomips.org/" rel="nofollow noopener" target="_blank">Unicorn</a>をデーモンモードで動かしている時など) に<code>pry-remote</code>というコマンドでデバッグコンソールを立ち上げることができる。<br>
<a href="https://github.com/pry/pry/wiki/Available-plugins#wiki-pry-remote" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/pry/pry/wiki/Available-plugins#wiki-pry-remote</a></p>

<p>アプリサーバを<code>フォアグランド</code>で動かしている時 (<code>rails server</code> で立ち上げている時など) は<code>pry-byebug</code> や <code>pry-debugger</code> のみ入れておけば起動したコンソールから確認できるので<code>pry-remote</code>は必要ない。</p>

<p><em>注）pry-byebugではpry-remoteをサポートしていないので使えない</em><br>
<a href="https://github.com/deivid-rodriguez/pry-byebug/blob/master/CHANGELOG.md#100-101-2013-05-07" rel="nofollow noopener" target="_blank">Dropped pry-remote support というリリースログ</a></p>

<h3>
<span id="4better_errors-binding_of_caller-について" class="fragment"></span><a href="#4better_errors-binding_of_caller-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>4.better_errors, binding_of_caller について</h3>

<p>エラー時にブラウザに表示するエラー画面をいい感じにしてくれる。<code>binding_of_caller</code>を入れることで、エラー画面でREPLを操作できるようになる。<br>
<a href="http://blog.livedoor.jp/sasata299/archives/51937655.html" rel="nofollow noopener" target="_blank">Railsならbetter_errorsを入れるとデバッグがはかどるなぁ </a></p>

<h3>
<span id="5hirb-hirb-unicode-について" class="fragment"></span><a href="#5hirb-hirb-unicode-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>5.hirb, hirb-unicode について</h3>

<p>ActiveRecordのデータをテーブル形式で表示してくれる。<br>
<a href="http://rochefort.hatenablog.com/entry/20120104/p1" class="autolink" rel="nofollow noopener" target="_blank">http://rochefort.hatenablog.com/entry/20120104/p1</a><br>
<a href="https://github.com/pry/pry/wiki/FAQ#wiki-hirb" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/pry/pry/wiki/FAQ#wiki-hirb</a><br>
<a href="http://morizyun.github.io/blog/pry-tips-rails-ruby/" rel="nofollow noopener" target="_blank">Pryの秘めた力を最大限引き出す4つの拡張機能[Rails] 「モデルの中身を綺麗に表示」を参照</a></p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">pryを開いている時に一時的にhirbを無効/有効にする</span></div>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="no">Hirb</span><span class="o">.</span><span class="n">disable</span>

<span class="o">&gt;</span> <span class="no">Hirb</span><span class="o">.</span><span class="n">enable</span>
</pre></div>
</div>

<h3>
<span id="6tapp-について" class="fragment"></span><a href="#6tapp-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>6.tapp について</h3>

<p>任意のオブジェクトやメソッドに<code>.tapp</code>としてメソッドチェインを形成することで、その時のオブジェクトの状態を出力させる。<br>
メソッドチェインの途中のオブジェクトの状態を確認したいときに、処理を止めることなくデバッグプリントさせる。<br>
<a href="http://namakesugi.blog42.fc2.com/blog-entry-108.html" class="autolink" rel="nofollow noopener" target="_blank">http://namakesugi.blog42.fc2.com/blog-entry-108.html</a></p>

<h3>
<span id="7awesome_print-について" class="fragment"></span><a href="#7awesome_print-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>7.awesome_print について</h3>

<p><code>p</code> や <code>puts</code>　などのようにプリントデバッグにとても有用な <code>ap</code> メソッドを定義してくれる。pryコンソールの出力のフォーマットもawesom_printを利用している。(.pryrcで定義）<br>
<a href="http://qiita.com/Linda_pp/items/d75d7c3953faa34a1f0e" class="autolink" id="reference-53484701aada9c6caa8d">http://qiita.com/Linda_pp/items/d75d7c3953faa34a1f0e</a><br>
<a href="https://github.com/pry/pry/wiki/FAQ#wiki-awesome_print" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/pry/pry/wiki/FAQ#wiki-awesome_print</a></p>

<h3>
<span id="8quiet_assets-について" class="fragment"></span><a href="#8quiet_assets-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>8.quiet_assets について</h3>

<p>assets関連のファイルへのアクセスログを出力させないようにする<br>
<a href="https://github.com/evrone/quiet_assets" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/evrone/quiet_assets</a></p>

<h3>
<span id="9annotate-について" class="fragment"></span><a href="#9annotate-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>9.annotate について</h3>

<p>DBの定義情報を読み取り、ModelのクラスファイルにコメントでDBの情報を書き込む<br>
<a href="http://yoshifumisato.jeez.jp/wordpress/post/rails/693" class="autolink" rel="nofollow noopener" target="_blank">http://yoshifumisato.jeez.jp/wordpress/post/rails/693</a><br>
<a href="https://github.com/ctran/annotate_models" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ctran/annotate_models</a></p>

<h3>
<span id="10timecop-について" class="fragment"></span><a href="#10timecop-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>10.timecop について</h3>

<p>一時的に日時を任意に、設定する<br>
<a href="https://github.com/travisjeffery/timecop" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/travisjeffery/timecop</a></p>

<h3>
<span id="11guard-rspec-について" class="fragment"></span><a href="#11guard-rspec-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>11.guard-rspec について</h3>

<p><a href="https://github.com/johnbintz/guard-rails" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/johnbintz/guard-rails</a><br>
Guardfileの定義情報をもとに、ファイル更新の都度テストを実行させる。Guardfileは基本的に<code>guard init</code>コマンドで自動生成したもの。<code>cmd: 'spring rspec -f doc'</code> となっているところだけ変更している状態。</p>

<p>そのためこのファイルでguardを動かすためには以下の2つの条件が必要です。</p>

<ol>
<li>rspecを入れている</li>
<li>springを入れている</li>
</ol>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Guardfile</span></div>
<div class="highlight"><pre><span></span><span class="c1"># A sample Guardfile</span>
<span class="c1"># More info at https://github.com/guard/guard#readme</span>

<span class="n">guard</span> <span class="ss">:rspec</span><span class="p">,</span> <span class="ss">cmd</span><span class="p">:</span> <span class="s1">'spring rspec -f doc'</span> <span class="k">do</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^spec/.+_spec\.rb$}</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^lib/(.+)\.rb$}</span><span class="p">)</span>     <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="s2">"spec/lib/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb"</span> <span class="p">}</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">'spec/spec_helper.rb'</span><span class="p">)</span>  <span class="p">{</span> <span class="s2">"spec"</span> <span class="p">}</span>

  <span class="c1"># Rails example</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^app/(.+)\.rb$}</span><span class="p">)</span>                           <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="s2">"spec/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb"</span> <span class="p">}</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^app/(.*)(\.erb|\.haml|\.slim)$}</span><span class="p">)</span>          <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="s2">"spec/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}#{</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb"</span> <span class="p">}</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^app/controllers/(.+)_(controller)\.rb$}</span><span class="p">)</span>  <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="o">[</span><span class="s2">"spec/routing/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_routing_spec.rb"</span><span class="p">,</span> <span class="s2">"spec/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">s/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb"</span><span class="p">,</span> <span class="s2">"spec/acceptance/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb"</span><span class="o">]</span> <span class="p">}</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^spec/support/(.+)\.rb$}</span><span class="p">)</span>                  <span class="p">{</span> <span class="s2">"spec"</span> <span class="p">}</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">'config/routes.rb'</span><span class="p">)</span>                           <span class="p">{</span> <span class="s2">"spec/routing"</span> <span class="p">}</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">'app/controllers/application_controller.rb'</span><span class="p">)</span>  <span class="p">{</span> <span class="s2">"spec/controllers"</span> <span class="p">}</span>

  <span class="c1"># Capybara features specs</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^app/views/(.+)/.*\.(erb|haml|slim)$}</span><span class="p">)</span>     <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="s2">"spec/features/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb"</span> <span class="p">}</span>

  <span class="c1"># Turnip features and steps</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^spec/acceptance/(.+)\.feature$}</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^spec/acceptance/steps/(.+)_steps\.rb$}</span><span class="p">)</span>   <span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="no">Dir</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"**/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">.feature"</span><span class="p">)</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span> <span class="o">||</span> <span class="s1">'spec/acceptance'</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>

<h3>
<span id="12factory_girl_rails-について" class="fragment"></span><a href="#12factory_girl_rails-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>12.factory_girl_rails について</h3>

<p>データの生成をフィクスチャからファクトリーに変更する。<br>
<a href="https://github.com/thoughtbot/factory_girl" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/thoughtbot/factory_girl</a></p>

<h3>
<span id="13database_rewinder-について" class="fragment"></span><a href="#13database_rewinder-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>13.database_rewinder について</h3>

<p><code>database_rewinder</code> はテスト毎にデータをクリアすることに対応するためのGem<br>
<a href="https://github.com/amatsuda/database_rewinder" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/amatsuda/database_rewinder</a></p>

<hr>

<h3>
<span id="ぼくのpryrc" class="fragment"></span><a href="#%E3%81%BC%E3%81%8F%E3%81%AEpryrc"><i class="fa fa-link"></i></a>ぼくの「.pryrc」</h3>

<p>参考のページを見つつ取り入れられるところは取り入れて「.pryrc」を作っている。<br>
「.pryrc」にはpryの設定と、関連するライブラリの連携設定などを記述。<br>
【参考】<br>
<a href="https://github.com/JuanitoFatas/dotpryrc/" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/JuanitoFatas/dotpryrc/</a><br>
<a href="https://github.com/pry/pry/wiki/Pry-rc" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/pry/pry/wiki/Pry-rc</a></p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">.pryrc</span></div>
<div class="highlight"><pre><span></span><span class="c1">## Settings</span>
<span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="kp">true</span>
<span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="s2">"vim"</span>

<span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span> <span class="o">|</span><span class="n">obj</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">_</span><span class="o">|</span>
  <span class="n">prompt</span> <span class="o">=</span> <span class="s2">""</span>
  <span class="n">prompt</span> <span class="o">&lt;&lt;</span> <span class="s2">"</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">@"</span> <span class="k">if</span> <span class="n">defined?</span><span class="p">(</span><span class="no">Rails</span><span class="p">)</span>
  <span class="n">prompt</span> <span class="o">&lt;&lt;</span> <span class="s2">"</span><span class="si">#{</span><span class="no">RUBY_VERSION</span><span class="si">}</span><span class="s2">"</span>
  <span class="s2">"</span><span class="si">#{</span><span class="n">prompt</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="n">obj</span><span class="si">}</span><span class="s2">)&gt; "</span>
<span class="k">end</span>


<span class="c1">## Alias</span>
<span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">alias_command</span> <span class="s2">"lM"</span><span class="p">,</span> <span class="s2">"ls -M"</span>
<span class="c1"># Ever get lost in pryland? try w!</span>
<span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">alias_command</span> <span class="s1">'w'</span><span class="p">,</span> <span class="s1">'whereami'</span>
<span class="c1"># Clear Screen</span>
<span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">alias_command</span> <span class="s1">'.clr'</span><span class="p">,</span> <span class="s1">'.clear'</span>


<span class="c1">## Below others cooperation</span>

<span class="c1"># refs: https://github.com/pry/pry/wiki/FAQ#wiki-awesome_print</span>
<span class="k">if</span> <span class="n">defined?</span> <span class="no">AwesomePrint</span>
  <span class="k">begin</span>
    <span class="nb">require</span> <span class="s1">'awesome_print'</span>
    <span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">print</span> <span class="o">=</span> <span class="nb">proc</span> <span class="p">{</span> <span class="o">|</span><span class="n">output</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span> <span class="no">Pry</span><span class="o">::</span><span class="no">Helpers</span><span class="o">::</span><span class="no">BaseHelpers</span><span class="o">.</span><span class="n">stagger_output</span><span class="p">(</span><span class="s2">"=&gt; </span><span class="si">#{</span><span class="n">value</span><span class="o">.</span><span class="n">ai</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span> <span class="p">}</span>
    <span class="c1"># Pry.config.print = proc { |output, value| output.puts value.ai } #ページングなし</span>
  <span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">err</span>
    <span class="nb">puts</span> <span class="s2">"no awesome_print :("</span>
    <span class="nb">puts</span> <span class="n">err</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># refs: https://github.com/pry/pry/wiki/FAQ#wiki-hirb</span>
<span class="k">if</span> <span class="n">defined?</span> <span class="no">Hirb</span>
 <span class="no">Hirb</span><span class="o">::</span><span class="no">View</span><span class="o">.</span><span class="n">instance_eval</span> <span class="k">do</span>
   <span class="k">def</span> <span class="nf">enable_output_method</span>
     <span class="vi">@output_method</span> <span class="o">=</span> <span class="kp">true</span>
     <span class="vi">@old_print</span> <span class="o">=</span> <span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">print</span>
     <span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">print</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span> <span class="o">|</span><span class="n">output</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
       <span class="no">Hirb</span><span class="o">::</span><span class="no">View</span><span class="o">.</span><span class="n">view_or_page_output</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">||</span> <span class="vi">@old_print</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
     <span class="k">end</span>
   <span class="k">end</span>

   <span class="k">def</span> <span class="nf">disable_output_method</span>
     <span class="no">Pry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">print</span> <span class="o">=</span> <span class="vi">@old_print</span>
     <span class="vi">@output_method</span> <span class="o">=</span> <span class="kp">nil</span>
   <span class="k">end</span>
 <span class="k">end</span>

 <span class="no">Hirb</span><span class="o">.</span><span class="n">enable</span>
<span class="k">end</span>

<span class="c1"># refs: https://github.com/deivid-rodriguez/pry-byebug#matching-byebug-behaviour</span>
<span class="k">if</span> <span class="n">defined?</span><span class="p">(</span><span class="no">PryByebug</span><span class="p">)</span>
  <span class="no">Pry</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">alias_command</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'continue'</span>
  <span class="no">Pry</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">alias_command</span> <span class="s1">'s'</span><span class="p">,</span> <span class="s1">'step'</span>
  <span class="no">Pry</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">alias_command</span> <span class="s1">'n'</span><span class="p">,</span> <span class="s1">'next'</span>
  <span class="no">Pry</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">alias_command</span> <span class="s1">'f'</span><span class="p">,</span> <span class="s1">'finish'</span>
<span class="k">end</span>
</pre></div>
</div>

<p>以上。<br>
ところどころ参考サイトへのリンクを貼らせていただきました！ありがとうございます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>296</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/fd03ee4c90a0d1e0a8c6">開いているファイルのプロセスを特定（lsofコマンド）</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-26 21:20:23</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[コマンド]</b> <b>[lsof]</b> <b>[プロセス]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="lsofコマンドの使い方です" class="fragment"></span><a href="#lsof%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>lsofコマンドの使い方です。</h2>

<p>lsofコマンドは、、、<br>
PortやPID、プロセス名からファイルがオープンしている情報を表示するコマンド。</p>

<h2>
<span id="よく利用する場面" class="fragment"></span><a href="#%E3%82%88%E3%81%8F%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E5%A0%B4%E9%9D%A2"><i class="fa fa-link"></i></a>よく利用する場面</h2>

<p>「netstat -an |grep LISTEN 」とかでListenしているPortを調べてそのPortが何のプロセスとかで動いているのかとかを確認するのに使っています！</p>

<h2>
<span id="使い方サンプル" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB"><i class="fa fa-link"></i></a>使い方サンプル</h2>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">ファイルを指定</span></div>
<div class="highlight"><pre><span></span>% lsof /var/log/system.log
COMMAND   PID      USER   FD   TYPE DEVICE SIZE/OFF     NODE NAME
tail    <span class="m">97529</span> USERNAME    3r   REG    <span class="m">1</span>,2   <span class="m">498299</span> <span class="m">12085861</span> /private/var/log/system.log
</pre></div>
</div>

<p>/var/log/system.logはtailコマンドで開いていることがわかりますねー</p>

<hr>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">ポート指定</span></div>
<div class="highlight"><pre><span></span>% lsof  -i:80,443
COMMAND PID      USER   FD   TYPE            DEVICE SIZE/OFF NODE NAME
Dropbox <span class="m">376</span> USERNAME   14u  IPv4 0x2b3f22aae05f3e3      0t0  TCP <span class="m">192</span>.168.100.102:58140-&gt;108.160.162.100:http <span class="o">(</span>ESTABLISHED<span class="o">)</span>
Dropbox <span class="m">376</span> USERNAME   19u  IPv4 0x2b3f22ab4456703      0t0  TCP <span class="m">192</span>.168.100.102:54071-&gt;108.160.160.177:https <span class="o">(</span>CLOSED<span class="o">)</span>
</pre></div>
</div>

<p>portが80, 443で開いているプロセスを表示指定ます。<br>
LISTENしているプロセスも表示されます。(DROPBOX って HTTPポート(80) を使って同期しているんですねー)</p>

<h4>
<span id="明示的にlistenされているプロセスを調べたい場合" class="fragment"></span><a href="#%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%ABlisten%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E8%AA%BF%E3%81%B9%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>明示的にLISTENされているプロセスを調べたい場合</h4>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">redisのポート</span></div>
<div class="highlight"><pre><span></span>lsof -i:6379 <span class="p">|</span>grep LISTEN

<span class="c1"># TCPとして指定する</span>
lsof -iTCP:6379 <span class="p">|</span>grep LISTEN
</pre></div>
</div>

<hr>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">プロセス名指定</span></div>
<div class="highlight"><pre><span></span>% lsof -c ruby
COMMAND   PID      USER   FD    TYPE             DEVICE  SIZE/OFF     NODE NAME
ruby    <span class="m">18910</span> USERNAME  cwd     DIR                <span class="m">1</span>,2      <span class="m">1190</span>        <span class="m">2</span> /
ruby    <span class="m">18910</span> USERNAME  txt     REG                <span class="m">1</span>,2   <span class="m">2805460</span>  <span class="m">1903306</span> /Users/USERNAME/.rbenv/versions/1.9.3-p385/bin/ruby
ruby    <span class="m">18910</span> USERNAME  txt     REG                <span class="m">1</span>,2     <span class="m">13384</span>  <span class="m">1903333</span> /Users/USERNAME/.rbenv/versions/1.9.3-p385/lib/ruby/1.9.1/x86_64-darwin12.2.1/enc/encdb.bundle
ruby    <span class="m">18910</span> USERNAME  txt     REG                <span class="m">1</span>,2     <span class="m">13168</span>  <span class="m">1903375</span> /Users/USERNAME/.rbenv/versions/1.9.3-p385/lib/ruby/1.9.1/x86_64-darwin
</pre></div>
</div>

<p>rubyプロセスが開いているファイルを表示していますねー</p>

<hr>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">PIDを指定</span></div>
<div class="highlight"><pre><span></span>% lsof  -p <span class="m">376</span>
COMMAND PID      USER   FD     TYPE             DEVICE  SIZE/OFF     NODE NAME
Dropbox <span class="m">376</span> USERNAME  cwd      DIR                <span class="m">1</span>,2      <span class="m">2550</span>  <span class="m">7815603</span> /Applications/Dropbox.app/Contents/Resources
Dropbox <span class="m">376</span> USERNAME  txt      REG                <span class="m">1</span>,2     <span class="m">89808</span>  <span class="m">7815600</span> /Applications/Dropbox.app/Contents/MacOS/Dropbox
</pre></div>
</div>

<p>PIDが376のプロセスが開いているファイルを表示</p>

<hr>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">ユーザ名を指定</span></div>
<div class="highlight"><pre><span></span>% lsof  -u ユーザ名
</pre></div>
</div>

<p>指定したユーザが開いているプロセスを表示</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>89</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/78e8d1ed64ead5fe9e29">Strong Parameters について調べてみた（ActiveAdminの対応も含む）</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-20 15:27:22</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Rails]</b> <b>[strong_parameters]</b> <b>[activeadmin]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Rails4系からデフォルトで組み込まれたStrongParametersについていろいろ調べてみたのでまとめてみました。</p>

<h2>
<span id="strongparametersについて概要" class="fragment"></span><a href="#strongparameters%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>StrongParametersについて概要</h2>

<p>StrongParameters とは Mass Assignment 脆弱性対策のための機能です。おおまかに言うと、Rails3系ではModelで<code>attr_accessible</code>を使って制御していたものとは違い、Controller側で受け取ったパラメータを制御するものです。<br>
Mass Assignemt対策やStrong Parametersについての詳細は以下がとても参考になります。ありがとうございます。</p>

<ul>
<li><a href="http://wada811.blogspot.com/2013/08/strong-parameters-mass-assignment-vulnerability-countermeasure-in-rails4.html" rel="nofollow noopener" target="_blank">Rails4のMass Assignment脆弱性対策のStrong Parametersについて</a></li>
<li><a href="http://qiita.com/kmats@github/items/1deb95ca12fa8520671f" id="reference-0215ccdeb530de79004c">strong_parametersについて</a></li>
<li><a href="http://www.techscore.com/tech/Ruby/rails-4.0/strong-parameters/" rel="nofollow noopener" target="_blank">7. StrongParameters -TECHSCORE</a></li>
</ul>

<h3>
<span id="strongparametersで例外時の挙動" class="fragment"></span><a href="#strongparameters%E3%81%A7%E4%BE%8B%E5%A4%96%E6%99%82%E3%81%AE%E6%8C%99%E5%8B%95"><i class="fa fa-link"></i></a>StrongParametersで例外時の挙動</h3>

<ul>
<li>controller側に渡された<code>params</code>にpermitの設定がないところで params["user"]とかでモデルに <code>new</code>, <code>update</code>すると <code>ActiveModel::ForbiddenAttributesError</code> の例外が発生する。</li>
<li>
<code>params</code>にpermit の 設定を一つでも入れた上で、permitしていない paramsを<code>new</code>, <code>update</code>「Unpermitted parameters: name」の例外が発生する。</li>
</ul>

<h2>
<span id="今回strongparametersについて調べるきっかけは" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9Estrongparameters%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%AA%BF%E3%81%B9%E3%82%8B%E3%81%8D%E3%81%A3%E3%81%8B%E3%81%91%E3%81%AF"><i class="fa fa-link"></i></a>今回StrongParametersについて調べるきっかけは</h2>

<p>Rails4のアプリケーションを作ろうとしている時に、管理機能ツールとして <a href="http://www.activeadmin.info/" rel="nofollow noopener" target="_blank">ActiveAdmin</a> の初期化したあとに 「admin_user」というModelを更新するテストしていた時にStrongParameterで以下のエラーが出ていたことです。</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span></span><span class="no">Unpermitted</span> <span class="ss">parameters</span><span class="p">:</span> <span class="n">utf8</span><span class="p">,</span> <span class="n">authenticity_token</span><span class="p">,</span> <span class="n">commit</span>
</pre></div></div>

<p>ActiveAdminを初期化したときは<code>app/admi/admin_user.rb</code>が生成され、その中に以下のStrongParameterに対応したコードができます。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">app/admi/admin_user.rb</span></div>
<div class="highlight"><pre><span></span><span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">register</span> <span class="no">AdminUser</span> <span class="k">do</span>
  <span class="n">index</span> <span class="k">do</span>
    <span class="n">column</span> <span class="ss">:email</span>
    <span class="n">column</span> <span class="ss">:current_sign_in_at</span>
    <span class="n">column</span> <span class="ss">:last_sign_in_at</span>
    <span class="n">column</span> <span class="ss">:sign_in_count</span>
    <span class="n">default_actions</span>
  <span class="k">end</span>

  <span class="n">filter</span> <span class="ss">:email</span>

  <span class="n">form</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
    <span class="n">f</span><span class="o">.</span><span class="n">inputs</span> <span class="s2">"Admin Details"</span> <span class="k">do</span>
      <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:email</span>
      <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:password</span>
      <span class="n">f</span><span class="o">.</span><span class="n">input</span> <span class="ss">:password_confirmation</span>
    <span class="k">end</span>
    <span class="n">f</span><span class="o">.</span><span class="n">actions</span>
  <span class="k">end</span>
  <span class="n">controller</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">permitted_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">permit</span> <span class="ss">admin_user</span><span class="p">:</span> <span class="o">[</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:password_confirmation</span><span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p><code>permitted_params</code>メソッドがStrongParametersに対応したコードです。 <br>
<strong>ActiveAdmin</strong>は <strong><em><a href="https://github.com/josevalim/inherited_resources" rel="nofollow noopener" target="_blank">Inherited_resources</a></em></strong> というCRUDの処理に特化したコントローラを簡単に実装できるGemに依存しているので、 <strong>permitted_params</strong> というメソッドの中身をコントローラで定義することでStrongParametersに対応させることができるようです。active_adminでは 「 <strong>controller do</strong> 」 ブロックに定義することで対応させます。</p>

<p><a href="https://github.com/gregbell/active_admin/commit/b5cff823ee39756d2fb543244c056f03689ca319" rel="nofollow noopener" target="_blank">【参考】 active_admin本家 permitted_paramsメソッドを生成するGeneratorのコード</a><br>
<a href="https://github.com/josevalim/inherited_resources/blob/1538e195a2b68be67763aa5509404b2efc42789b/lib/inherited_resources/base_helpers.rb#L319-L330" rel="nofollow noopener" target="_blank">【参考】inherited_resources の permitted_params を定義しているコードinherited_resources/base_helpers.rb</a></p>

<p>しかし、ActiveAdmin初期化時に生成された <strong>permitted_params</strong> メソッドの中身では、上述したように <strong>Unpermitted parameters</strong> が発生してしまいます。</p>

<p>ここからはその部分を確認してみます。<br>
<strong>Unpermitted parameters</strong> がなぜ発生するのか、<code>ActionController::Parameters</code> クラスの挙動を色々見て行きます。</p>

<h2>
<span id="actioncontrollerparameters-をreplirb-や-pryを使って確認" class="fragment"></span><a href="#actioncontrollerparameters-%E3%82%92replirb-%E3%82%84-pry%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>ActionController::Parameters をREPL(irb や pry)を使って確認</h2>

<p>まずはparamsとして <code>ActionController::Parameters</code> のクラスを作る<br>
<code>:form</code>以下のハッシュデータ(:email, :admin) が実際のformからPostされたデータと仮定して、<code>Mass Assignment</code> したい(permitする対象にしたい)という状況を作る。<br>
<code>:name</code> と <code>:admin</code> は 付加情報としてparamsに入っているだけ。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">全体で使うparamsの初期化</span></div>
<div class="highlight"><pre><span></span><span class="n">hash_params</span> <span class="o">=</span>  <span class="p">{</span>
    <span class="ss">:name</span><span class="o">=&gt;</span><span class="s2">"John"</span><span class="p">,</span>
    <span class="ss">:admin</span><span class="o">=&gt;</span><span class="kp">true</span><span class="p">,</span>
    <span class="ss">:form</span><span class="o">=&gt;</span><span class="p">{</span><span class="ss">:email</span><span class="o">=&gt;</span><span class="s2">"hoge@hoge.com"</span><span class="p">,</span> <span class="ss">:pass</span><span class="o">=&gt;</span><span class="s2">"hogehoge"</span><span class="p">}</span>
<span class="p">}</span>
<span class="c1"># ActionController::Parametersクラスを作る</span>
<span class="n">params</span> <span class="o">=</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">hash_params</span><span class="p">)</span>  
</pre></div>
</div>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">①params.permit()を使って、form以下をpermitさせる</span></div>
<div class="highlight"><pre><span></span><span class="n">permit1</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">form</span><span class="p">:</span> <span class="o">[</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:pass</span><span class="o">]</span><span class="p">)</span> <span class="c1">#「Unpermitted parameters: name, admin」が発生</span>
<span class="n">permit1</span><span class="o">.</span><span class="n">permitted?</span> <span class="c1">#=&gt; true</span>
<span class="nb">puts</span> <span class="n">permit1</span> <span class="c1">#=&gt; {"form"=&gt;{"email"=&gt;"hoge@hoge.com", "pass"=&gt;"hogehoge"}}</span>

<span class="c1"># これだとparamsの「:form=&gt;{:email, :pass}」がpermit1に入り、permitted?もtrueになるが、、「permit()」メソッドを実行したタイミングでparamsで「:form」と同階層にある「:name」「:admin」がUnpermitted parametersとなる。</span>
</pre></div>
</div>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">②params.permit()を使って、paramsのすべてをpermitさせる</span></div>
<div class="highlight"><pre><span></span><span class="c1"># ①でpermitした:formに加えて:name, :adminもpermitさせると</span>
<span class="n">permit2</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:admin</span><span class="p">,</span> <span class="ss">form</span><span class="p">:</span> <span class="o">[</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:pass</span><span class="o">]</span><span class="p">)</span>  <span class="c1"># 「Unpermitted parameters」は発生しない</span>
<span class="n">permit2</span><span class="o">.</span><span class="n">permitted?</span> <span class="c1">#=&gt; true</span>
<span class="nb">puts</span> <span class="n">permit2</span> <span class="c1">#=&gt; {"name"=&gt;"John", "admin"=&gt;true, "form"=&gt;{"email"=&gt;"hoge@hoge.com", "pass"=&gt;"hogehoge"}}</span>

<span class="c1"># 当然ながらpermit2にはparams全てのデータが入り、permitted?もtrueになる。「Unpermitted parameter」は発生しない。:form以下のみpermitしたいのにこれだと、なんか違う気もする。</span>
</pre></div>
</div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">③requireで対象を指定してpermitする。「params.require().permit()」</span></div>
<div class="highlight"><pre><span></span><span class="c1"># requireメソッドでparams内のハッシュキーを特定して、それ以下のみをpemitさせる方法</span>
<span class="n">permit3</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:form</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span><span class="ss">:pass</span><span class="p">)</span> <span class="c1"># 「Unpermitted parameters」は発生しない</span>
<span class="n">permit3</span><span class="o">.</span><span class="n">permitted?</span> <span class="c1">#=&gt; true</span>
<span class="nb">puts</span> <span class="n">permit3</span> <span class="c1">#=&gt; {"email"=&gt;"hoge@hoge.com", "pass"=&gt;"hogehoge"}</span>

<span class="c1"># Unpermitted parametersは発生せず目的の「:form」のみがpermit3に入り、permitted?もtrueになる。</span>
<span class="c1"># また、以下のようにすると「Unpermitted parameters」は発生する</span>
<span class="n">permit4</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:form</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:email</span><span class="p">)</span> <span class="c1">#=&gt; Unpermitted parameters: pass</span>
<span class="c1"># :form=&gt; :emailと同階層の:passを指定していないパターン。:passについてUnpermitted parametersが発生</span>
</pre></div>
</div>

<p>以上から、strong_parametersでpermitする場合は、requireしてpermiitするという方法が一番使い回しがきくなーという感じですねー。ま～適宜用途にあった使いかたをしていくのがいいとは思いますが、、</p>

<hr>

<h2>
<span id="実際の実装例" class="fragment"></span><a href="#%E5%AE%9F%E9%9A%9B%E3%81%AE%E5%AE%9F%E8%A3%85%E4%BE%8B"><i class="fa fa-link"></i></a>実際の実装例</h2>

<p>実際の実装例というか自分の設定している定義方法を示します。</p>

<h3>
<span id="１activeadmin-controllerの場合" class="fragment"></span><a href="#%EF%BC%91activeadmin-controller%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>１．ActiveAdmin Controllerの場合</h3>

<p>冒頭にactive_admin:installで自動生成されたadmin_user.rbの <code>controller do</code> ブロックの中を書き換えます。 </p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">app/admin/admin_user.rb</span></div>
<div class="highlight"><pre><span></span><span class="no">ActiveAdmin</span><span class="o">.</span><span class="n">register</span> <span class="no">AdminUser</span> <span class="k">do</span>
<span class="err">…省略</span>
  <span class="n">controller</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">permitted_params</span>
       <span class="p">{</span><span class="ss">admin_user</span><span class="p">:</span> <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:admin_user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">:password_confirmation</span><span class="p">)}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="err">…省略</span>
<span class="k">end</span>
</pre></div>
</div>

<h3>
<span id="２通常のrailsのコントローラの場合" class="fragment"></span><a href="#%EF%BC%92%E9%80%9A%E5%B8%B8%E3%81%AErails%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>２．通常のRailsのコントローラの場合</h3>

<p>Modelが<code>User</code>で <code>email</code> と <code>password</code> を持っている場合を想定して書きます。</p>

<h4>
<span id="２-１-inheritedresourcesbase-を継承している時" class="fragment"></span><a href="#%EF%BC%92-%EF%BC%91-inheritedresourcesbase-%E3%82%92%E7%B6%99%E6%89%BF%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E6%99%82"><i class="fa fa-link"></i></a>２-１． <code>InheritedResources::Base</code> を継承している時</h4>

<p><code>rails generate scaffold</code>コマンドで生成した時は<code>inherited_resources</code>を継承したコントローラクラスになるので、以下のように<code>permitted_params</code>メソッドを定義します。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">app/controllers/users_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">permitted_params</span>
      <span class="p">{</span><span class="ss">:user</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">)}</span>
      <span class="c1"># params.permit!  #&lt;=すべてのparamを許可するとき</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p><code>inherited_resources</code> を使っているときは特に CRUDに関するメソッド(create, updateメソッドなど)は内部で実装されているため特に定義しなくても動作する。</p>

<h4>
<span id="２２-applicationcontroller-を継承している時" class="fragment"></span><a href="#%EF%BC%92%EF%BC%92-applicationcontroller-%E3%82%92%E7%B6%99%E6%89%BF%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E6%99%82"><i class="fa fa-link"></i></a>２−２． <code>ApplicationController</code> を継承している時</h4>

<p><code>rails generate controller</code> や <code>rails generate scaffold_controller</code> コマンドで生成した時は<code>ApplicationController</code>を継承したコントローラクラスになるので以下のように指定します。<br>
privateな<code>user_params</code>メソッドで独自にpermitするカラムを指定する</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">app/controllers/users_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="err">…省略</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>

    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@user</span><span class="p">,</span> <span class="ss">notice</span><span class="p">:</span> <span class="s1">'User was successfully created.'</span> <span class="p">}</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">action</span><span class="p">:</span> <span class="s1">'show'</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:created</span><span class="p">,</span> <span class="ss">location</span><span class="p">:</span> <span class="vi">@user</span> <span class="p">}</span>
      <span class="k">else</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">action</span><span class="p">:</span> <span class="s1">'new'</span> <span class="p">}</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:unprocessable_entity</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user_params</span><span class="p">)</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@user</span><span class="p">,</span> <span class="ss">notice</span><span class="p">:</span> <span class="s1">'User was successfully updated.'</span> <span class="p">}</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="p">{</span> <span class="n">head</span> <span class="ss">:no_content</span> <span class="p">}</span>
      <span class="k">else</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">action</span><span class="p">:</span> <span class="s1">'edit'</span> <span class="p">}</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:unprocessable_entity</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="err">…省略</span>
  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">user_params</span>
      <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:password</span><span class="p">)</span>
    <span class="k">end</span>
<span class="err">…省略</span>
<span class="k">end</span>
</pre></div>
</div>

<p><code>２．通常のRailsのコントローラの場合</code> の時は個人的には <code>ApplicationController</code> を継承した ２−２ の方法が使いやすいかな〜と思っています。<code>InheritedResources::Base</code> を継承した ２−１ の方法はコード量は少ないけどコントローラの処理が隠蔽されすぎていてわかりにくくなるので。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p><code>InheritedResources</code>を使ったStrongParametersの定義方法は正規のドキュメントに書かれていました。<br>
３つの方法があるようです。私は２番めのrequireを使ったHashで返す方法を利用しています。<br>
<a href="https://github.com/josevalim/inherited_resources#strong-parameters" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/josevalim/inherited_resources#strong-parameters</a></p>

<h2>
<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h2>

<h4>
<span id="おまけ１unpermitted-parametersの時の振る舞いを設定する" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%91unpermitted-parameters%E3%81%AE%E6%99%82%E3%81%AE%E6%8C%AF%E3%82%8B%E8%88%9E%E3%81%84%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>おまけ１　Unpermitted parametersの時の振る舞いを設定する</h4>

<p>StrongParametersの <code>Unpermitted Parameters</code> が発生した時はデフォルトではLogに書きだされる設定になっているが例外を吐くようにすることもできる。<code>application.rb</code> に設定する。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">config/application.rb</span></div>
<div class="highlight"><pre><span></span><span class="err">…省略</span>
    <span class="c1"># StrongParameters unpermitted parameters behavior </span>
    <span class="n">config</span><span class="o">.</span><span class="n">action_controller</span><span class="o">.</span><span class="n">action_on_unpermitted_parameters</span> <span class="o">=</span> <span class="ss">:raise</span> <span class="c1"># :raise か :log で設定する</span>
<span class="err">…省略</span>
</pre></div>
</div>

<h4>
<span id="おまけ２-unpermitted-parametersのログを色付けする" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%EF%BC%92-unpermitted-parameters%E3%81%AE%E3%83%AD%E3%82%B0%E3%82%92%E8%89%B2%E4%BB%98%E3%81%91%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>おまけ２ Unpermitted parametersのログを色付けする</h4>

<p><code>colorize_unpermitted_parameters</code> というGemをインストールするだけ。Gemfileに以下を定義して<code>bundle install</code></p>

<div class="code-frame" data-lang="Gemfile"><div class="highlight"><pre><span></span>gem 'colorize_unpermitted_parameters'
</pre></div></div>

<p>以上、長くなったけど、自分の備忘録として。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>52</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/1e61f46094b965a66599">Apach, NginxをプロキシにしたRailsアプリでhttpsがリダイレクト時にhttpになる問題</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-13 22:44:25</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Rails]</b> <b>[nginx]</b> <b>[Apache]</b> <b>[Redmine]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>HTTPSオンリーのRailsのアプリ（Redminなど）でApacheをリバースプロキシにした場合、リダイレクトがHTTPになってしまう。。。</p>

<p>これを対処するにはRequestHeaderディレクティブでApacheからバックエンドのアプリケーションサーバへのX_FORWARDED_PROTOヘッダを付与させるようにする。</p>

<h2>
<span id="apacheの場合" class="fragment"></span><a href="#apache%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Apacheの場合</h2>

<p><strong>RequestHeader set X_FORWARDED_PROTO 'https'</strong></p>

<p>設定例）</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">ApacheでRedminのリバースプロキシHTTPSオンリーにする</span></div>
<div class="highlight"><pre><span></span>&lt;VirtualHost *:443&gt;
    # SSL の細かい設定（＾＾；
    RequestHeader set X_FORWARDED_PROTO 'https'
    ProxyPass /rails http://localhost:3000/rails
    ProxyPassReverse /rails http://localhost:3000/rails
&lt;/VirtualHost&gt;
</pre></div>
</div>

<p>参考<br>
<a href="http://webos-goodies.jp/archives/51261261.html" rel="nofollow noopener" target="_blank">http://webos-goodies.jp/archives/51261261.html</a></p>

<h2>
<span id="nginxの場合" class="fragment"></span><a href="#nginx%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Nginxの場合</h2>

<p><strong>proxy_set_header X-Forwarded-Proto https;</strong></p>

<p>設定例)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>upstream backend {
  server unix:/data/apps/current/tmp/sockets/unicorn.sock max_fails=3 fail_timeout=10s;
}
 location / {
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
    if (!-f $request_filename) { proxy_pass http://backend; }
  }
</pre></div></div>

<p>参考<br>
<a href="http://qiita.com/ywatai@github/items/a179186a458a42b3c7f0" id="reference-67aa076fb5a0d1aff252">nginx で SSL解きリバースプロキシな設定のお作法 - Qiita</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>46</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/521d2a18df3e071d1062">Basic認証時でのFacebook,Twitterなどシェアに使うOGPの確認方法（ソースIPを利用）</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-26 20:14:16</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[nginx]</b> <b>[Apache]</b> <b>[OGP]</b> <b>[Basic認証]</b> <b>[SNS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h2>

<p>FacebookシェアやTwitterCardを利用するOGP関連のタグを公開前サイトで確認したいという状況は往々にしてあると思います。<br>
そんな中で、公開前のサイトは Basic認証をかけていることが多いと思います。その場合、OGPのクローラが巡回できず解析ができません。</p>

<p>Facebookの場合は以下のデバッガサイトがあるのでそこにOGPタグを設置したURLを入れて「デバッグ」してみるとBasic認証に通らず401エラーになります。<br>
<a href="https://developers.facebook.com/tools/debug" rel="nofollow noopener" target="_blank">Facebookのデバッガサイト</a></p>

<h2>
<span id="回避方法" class="fragment"></span><a href="#%E5%9B%9E%E9%81%BF%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>回避方法</h2>

<p>今のところ２つの回避方法があるかなーと考えています。</p>

<ul>
<li>HTTPヘッダのUserエージェントで判定する方法</li>
<li>OGPクローラのソースIPから判定する方法</li>
</ul>

<p>「 <strong><em>HTTPヘッダのUserAgentで判定する方法</em></strong> 」は色んな所で解説されているのでご確認下さい。<br>
<a href="http://qiita.com/inamaru4400/items/774feb3bea9676b2f6d0" id="reference-f96368c2b38e1f5dadaf">Basic認証下でFacebook等のOGP確認方法</a><br>
<a href="http://d.hatena.ne.jp/modified/20111115/1321328171" rel="nofollow noopener" target="_blank">Basic 認証中のページで OGP のテストをする</a><br>
※ <strong>UserAgentは頑張れば書き換えも可能なので、偽装された場合、意図せず公開前のサイトが見られてしまう恐れが・・・あるかも</strong></p>

<p>ということでOGPクローラのソースIPから判定する方法について書きます。</p>

<h2>
<span id="ogpクローラのソースipから判定する方法" class="fragment"></span><a href="#ogp%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9ip%E3%81%8B%E3%82%89%E5%88%A4%E5%AE%9A%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>OGPクローラのソースIPから判定する方法</h2>

<p>手順は以下の２点です。<br>
基本的には <a href="http://blog.hello-world.jp.net/?p=648" rel="nofollow noopener" target="_blank">[Nginx]Basic認証中のページでOGPのテストをする</a> を参考にさせていただきました。</p>

<ol>
<li>FacebookやTwitterのソースIPを調べる</li>
<li>Nginx または Apache の設定を変更して特定のIPはBasic認証なしで許可させる</li>
</ol>

<hr>

<h3>
<span id="1facebookやtwitterのソースipを調べる" class="fragment"></span><a href="#1facebook%E3%82%84twitter%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9ip%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>1.FacebookやTwitterのソースIPを調べる</h3>

<ol>
<li><p>まずは、ドメインのAS番号を調べます。<br>
<a href="http://bgp.he.net/" class="autolink" rel="nofollow noopener" target="_blank">http://bgp.he.net/</a> にアクセスして、検索ボックスに 「twitter.com」など入れて、「Search」検索します。</p></li>
<li><p>検索結果から 「IP Info」タブよりAS番号（AS**<strong><em>）を調べます。<br>
*</em>Facebook : AS32934</strong><br>
<strong>Twitter : AS13414</strong><br><br>
<a href="https://camo.qiitausercontent.com/c0413ef12ba5706f708d4e3f78039ec6504e2fe1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f363033382f38353533393865632d653939362d356235662d613962652d3462313666353862653561312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c0413ef12ba5706f708d4e3f78039ec6504e2fe1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f363033382f38353533393865632d653939362d356235662d613962652d3462313666353862653561312e706e67" alt="2f21cec2eaac30a57f34954f6b0b14ef.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/6038/855398ec-e996-5b5f-a9be-4b16f58be5a1.png"></a>  </p></li>
<li><p>AS番号からソースIPを調べる<br>
以下のコマンドを実行するとCIDR区切りのIPが出力されます。それをNginxやApacheのAllowに加える事でOGPクローラのIPを許可させます。</p></li>
</ol>

<div class="code-frame" data-lang="whoisコマンドを使う"><div class="highlight"><pre><span></span>Facebookの場合
$ whois -h whois.radb.net -- '-i origin AS32934' | awk '/^route:/{print $2 }'

Twitterの場合
$ whois -h whois.radb.net -- '-i origin AS13414' | awk '/^route:/{print $2 }'
</pre></div></div>

<hr>

<h3>
<span id="2nginx-または-apache-の設定を変更して特定のipはbasic認証なしで許可させる" class="fragment"></span><a href="#2nginx-%E3%81%BE%E3%81%9F%E3%81%AF-apache-%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%97%E3%81%A6%E7%89%B9%E5%AE%9A%E3%81%AEip%E3%81%AFbasic%E8%AA%8D%E8%A8%BC%E3%81%AA%E3%81%97%E3%81%A7%E8%A8%B1%E5%8F%AF%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>2.Nginx または Apache の設定を変更して特定のIPはBasic認証なしで許可させる</h3>

<h4>
<span id="nginx-の場合" class="fragment"></span><a href="#nginx-%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Nginx の場合</h4>

<p>/etc/nginx/conf.d/ogp_allow_ips.confというファイルを作成する</p>

<div class="code-frame" data-lang="ogpの許可設定ファイルを作成"><div class="highlight"><pre><span></span># cd /etc/nginx/conf.d/
# echo '# Facebook IPs' &gt;&gt; ogp_allow_ips.conf
# whois -h whois.radb.net -- '-i origin AS32934' | awk '/^route:/{print "allow " $2 ";" }' &gt;&gt; ogp_allow_ips.conf
# echo '# Twitter IPs' &gt;&gt; ogp_allow_ips.conf
# whois -h whois.radb.net -- '-i origin AS13414' | awk '/^route:/{print "allow " $2 ";" }' &gt;&gt; ogp_allow_ips.conf
</pre></div></div>

<p>/etc/nginx/conf.d/vhosts.conf にVirtualHostのserversのディレクティブの設定があり、その中でogp_allow_ips.confを読み込む</p>

<div class="code-frame" data-lang="nginx">
<div class="code-lang"><span class="bold">virtualhostにBasic認証の設定を追加する</span></div>
<div class="highlight"><pre><span></span><span class="c1"># vi /etc/nginx/conf.d/vhosts.conf</span>
<span class="k">…省略</span>
<span class="s">server</span> <span class="p">{</span>
<span class="kn">…省略</span>
    <span class="c1"># Basic認証</span>
    <span class="s">satisfy</span> <span class="s">any</span><span class="p">;</span>
    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/ogp_allow_ips.conf</span><span class="p">;</span>
    <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
    <span class="kn">auth_basic</span>           <span class="s">"Secret</span> <span class="s">Area"</span><span class="p">;</span>
    <span class="kn">auth_basic_user_file</span> <span class="s">"/etc/nginx/.htpasswd"</span><span class="p">;</span>
<span class="kn">…省略</span>
<span class="err">}</span>

</pre></div>
</div>

<h4>
<span id="apacheの場合" class="fragment"></span><a href="#apache%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Apacheの場合</h4>

<p>/etc/httpd/conf.d/ogp_allow_ips.confというファイルを作成する<br>
<strong>Apache2.2系とApache2.4系で許可するディレクティブが違っているようなので注意してください</strong></p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">Apache2.2系の場合のogpの許可設定ファイルを作成</span></div>
<div class="highlight"><pre><span></span># cd /etc/httpd/conf.d/
# echo '# Facebook IPs' &gt;&gt; ogp_allow_ips.conf
# whois -h whois.radb.net -- '-i origin AS32934' | awk '/^route:/{print "Allow from " $2 ";" }' &gt;&gt; ogp_allow_ips.conf
# echo '# Twitter IPs' &gt;&gt; ogp_allow_ips.conf
# whois -h whois.radb.net -- '-i origin AS13414' | awk '/^route:/{print "Allow from " $2 ";" }' &gt;&gt; ogp_allow_ips.conf
</pre></div>
</div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">Apache2.4系の場合のogpの許可設定ファイルを作成</span></div>
<div class="highlight"><pre><span></span># cd /etc/httpd/conf.d/
# echo '# Facebook IPs' &gt;&gt; ogp_allow_ips.conf
# whois -h whois.radb.net -- '-i origin AS32934' | awk '/^route:/{print "Require ip " $2 ";" }' &gt;&gt; ogp_allow_ips.conf
# echo '# Twitter IPs' &gt;&gt; ogp_allow_ips.conf
# whois -h whois.radb.net -- '-i origin AS13414' | awk '/^route:/{print "Require ip " $2 ";" }' &gt;&gt; ogp_allow_ips.conf
</pre></div>
</div>

<p>/etc/httpd/conf.d/vhosts.conf にVirtualHostのディレクティブの設定があり、その中でogp_allow_ips.confを読み込む</p>

<div class="code-frame" data-lang="apache">
<div class="code-lang"><span class="bold">virtualhostにBasic認証の設定を追加する</span></div>
<div class="highlight"><pre><span></span><span class="c"># vi /etc/httpd/conf.d/vhosts.conf</span>
<span class="err">…省略</span>
<span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
    <span class="err">…省略</span>
    <span class="nt">&lt;Directory</span> <span class="s">"/var/www/html/public"</span><span class="nt">&gt;</span>
        <span class="err">…省略</span>
        <span class="nb">AuthType</span>      Basic
        <span class="nb">AuthName</span>      <span class="s2">"Secret Area"</span>
        <span class="nb">AuthGroupFile</span> <span class="sx">/dev/null</span>
        <span class="nb">AuthUserFile</span>  <span class="sx">/etc/httpd/.htpasswd</span>
        <span class="nb">Satisfy</span> <span class="k">any</span>
        <span class="nb">Order</span> deny,allow
        <span class="nb">Deny</span> from <span class="k">all</span>
        <span class="nb">Include</span> <span class="sx">/etc/httpd/conf.d/ogp_allow_ips.conf</span>
        <span class="nb">Require</span>       valid-user
        <span class="err">…省略</span>
    <span class="nt">&lt;/Directory&gt;</span>
    <span class="err">…省略</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>

<h3>
<span id="設定完了後" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E5%AE%8C%E4%BA%86%E5%BE%8C"><i class="fa fa-link"></i></a>設定完了後</h3>

<p>NginxやApacheを再起動させ、設定を反映する。<br>
その後に <a href="https://developers.facebook.com/tools/debug" rel="nofollow noopener" target="_blank">Facebookのデバッガサイト</a> などで<br>
再度、デバッグしてみると401エラーがなくなっていると思います。</p>

<p>以上、Basic認証下のソースIPを判定してOGPクローラを許可する設定です！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>44</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/9dac70b7bbba49f3cdb7">Berkshelfベースにvagrant, chef(knife-solo)環境を簡単に構築する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-15 13:17:31</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[chef]</b> <b>[vagrant]</b> <b>[VirtualBox]</b> <b>[Berkshelf]</b> <b>[knife-solo]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h2>

<h3>
<span id="必要なファイルをインストール" class="fragment"></span><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>必要なファイルをインストール</h3>

<p>今回の環境は以下のとおりです。（MacOSX）<br>
VirtualBox 4.2.18 r88780<br>
Vagrant 1.3.4<br>
Ruby 2.0.0p247<br>
Bundler 1.3.5 (Ruby Gems)</p>

<ul>
<li>VirtualBox =&gt; <a href="https://www.virtualbox.org/wiki/Downloads" class="autolink" rel="nofollow noopener" target="_blank">https://www.virtualbox.org/wiki/Downloads</a>
</li>
<li>Vagrant =&gt; <a href="http://downloads.vagrantup.com/" class="autolink" rel="nofollow noopener" target="_blank">http://downloads.vagrantup.com/</a>
</li>
<li>Ruby =&gt;  rbenvやrvmなんでもいいので1.9以上を入れるといいと思います</li>
<li>bundler(Ruby Gems) =&gt; 「gem install bundler」としてbundlerを入れる</li>
</ul>

<h3>
<span id="初期ディレクトリ" class="fragment"></span><a href="#%E5%88%9D%E6%9C%9F%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA"><i class="fa fa-link"></i></a>初期ディレクトリ</h3>

<p>/tmp以下を今回の作業環境とする。以下のディレクトリ構成を作る。</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span></span><span class="go">/tmp</span>
<span class="go">└── vagrant-test</span>
<span class="go">    └── chef-repo</span>
</pre></div></div>

<hr>

<h2>
<span id="bundlerによるberkshelfを使ってvagrantのセットアップ" class="fragment"></span><a href="#bundler%E3%81%AB%E3%82%88%E3%82%8Bberkshelf%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6vagrant%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>BundlerによるBerkshelfを使ってVagrantのセットアップ</h2>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">bundleのinitまで</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> <span class="nb">cd</span> /tmp/vagrant-test/chef-repo
<span class="gp">%</span> bundle init
</pre></div>
</div>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">bundle_initで生成されたGemfileを編集</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> vi Gemfile
<span class="go">source "https://rubygems.org"</span>
<span class="go">gem "knife-solo", "~&gt; 0.3.0"</span>
<span class="go">gem "foodcritic"</span>
<span class="go">gem "berkshelf"</span>
<span class="go">gem "serverspec"</span>
<span class="go">gem "awesome_print"</span>
</pre></div>
</div>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">bundleを実行</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> bundle install --path vendor/bundle --binstubs vendor/bin
</pre></div>
</div>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">berkshelfのイニシャライズ(途中でGemfileのコンフリクトでどうするか求められるが、「n」でスキップして進める)</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> bundle <span class="nb">exec</span> berks init
<span class="go">      create  Berksfile</span>
<span class="go">      create  Thorfile</span>
<span class="go">      create  .gitignore</span>
<span class="go">         run  git init from "."</span>
<span class="go">    conflict  Gemfile</span>
<span class="go">Overwrite /private/tmp/vagrant-test/chef-repo/Gemfile? (enter "h" for help) [Ynaqdh] n</span>
<span class="go">          skip  Gemfile</span>
<span class="go">      create  Vagrantfile</span>
<span class="go">Successfully initialized</span>
</pre></div>
</div>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">berk_initで生成された不要なファイルを削除</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> rm Thorfile  &lt;<span class="o">=</span> とりあえずthorは使うことがないので削除
</pre></div>
</div>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">「Vagrantfile」は以下のとおりにする。（Centosのバージョンなどは適宜合わせて下さい）</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> vi Vagrantfile
<span class="gp">#</span> -*- mode: ruby -*-
<span class="gp">#</span> vi: <span class="nb">set</span> <span class="nv">ft</span><span class="o">=</span>ruby :

<span class="go">Vagrant.configure("2") do |config|</span>
<span class="go">  config.vm.hostname = "chef-repo-berkshelf"</span>
<span class="go">  config.vm.box = "centos6.5-x86_64-minimal_20131205"</span>
<span class="go">  config.vm.box_url = "https://github.com/2creatives/vagrant-centos/releases/download/v6.5.1/centos65-x86_64-20131205.box"</span>
<span class="go">  config.vm.network :private_network, ip: "192.168.33.100"</span>
<span class="go">  config.vm.boot_timeout = 120</span>
<span class="go">end</span>
</pre></div>
</div>

<p>その他、Vagrantfileの設定でデフォルトで有効になっている箇所はvagrant-berkshelfプラグインの設定やvagrantのprovisioningの設定なので、ここでは使用しないため無効化している。適宜必要があれば有効化して下さい。</p>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">vagrant起動</span></div>
<div class="highlight"><pre><span></span><span class="go">vagrant upすると「config.vm.box」に指定したBoxをダウンロードしてVMを起動してくれる</span>
<span class="gp">%</span> vagrant up
<span class="go">…</span>
<span class="go">simply run `vagrant up`.   &lt;= 起動完了</span>
</pre></div>
</div>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">vagrant接続確認</span></div>
<div class="highlight"><pre><span></span><span class="go">vagrantのボックスが追加されていることを確認</span>
<span class="gp">%</span> vagrant box list
<span class="go">Berkshelf-CentOS-6.4-x86_64-minimal (virtualbox)</span>

<span class="go">VMのステータスを確認</span>
<span class="gp">%</span> vagrant status
<span class="go">Current machine states:</span>

<span class="go">default                   running (virtualbox)</span>

<span class="go">vagrantコマンドでSSH接続</span>
<span class="gp">%</span> vagrant ssh

<span class="go">ssh接続用のコンフィグファイルを作成して、sshコマンドでログインしてみる</span>
<span class="gp">%</span> vagrant ssh-config --host myapp-test  &gt;&gt; ./myapp_sshconfig
<span class="gp">%</span> ssh -F ./myapp_sshconfig myapp-test
</pre></div>
</div>

<p>以上、SSHコマンドでの接続確認ができれば、Berkshelf init から Vagrantの設定まで完了です。</p>

<hr>

<h2>
<span id="chefknife-soloのセットアップ" class="fragment"></span><a href="#chefknife-solo%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>Chef(knife-solo)のセットアップ</h2>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">先ほど立ち上げたvagrantのVMをホストにknife-soloのセットアップ</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> <span class="nb">cd</span> /tmp/vagrant-test/chef-repo/

<span class="go">必要があれば実行する( knife-soloの共通設定「~/.chef/knife.rb」 を作るためのコマンド。すでにファイルがある場合はこの手順はスキップする)</span>
<span class="gp">%</span> bundle <span class="nb">exec</span> knife solo conifigure

<span class="go">ディレクトリ構成を初期化</span>
<span class="gp">%</span> bundle <span class="nb">exec</span> knife solo init .

<span class="go">VMホストにchefの設定を初期化する</span>
<span class="gp">%</span> bundle <span class="nb">exec</span> knife solo prepare -F ./myapp_sshconfig myapp-test
</pre></div>
</div>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">berkshelfでサードパーティのyumクックブックを定義する</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> vi Berksfile
<span class="go">site :opscode</span>
<span class="go">cookbook "yum"</span>

<span class="go">サードパーティのクックブックをインストール</span>
<span class="gp">%</span> bundle <span class="nb">exec</span> berks install --path cookbooks

<span class="go">yum クックブックがダウンロードできていることを確認</span>
<span class="gp">%</span> ls -ls ./cookbooks/
</pre></div>
</div>

<p>以上でknife-soloのセットアップ完了</p>

<hr>

<h2>
<span id="knife-soloでクックブックを実行する" class="fragment"></span><a href="#knife-solo%E3%81%A7%E3%82%AF%E3%83%83%E3%82%AF%E3%83%96%E3%83%83%E3%82%AF%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>knife-soloでクックブックを実行する</h2>

<p>ここでは先ほどberkshelfでインストールしたyumのサードパーティクックブックの中のepelを入れようと思います。</p>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">jsonファイルにyum</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> <span class="nb">cd</span> /tmp/vagrant-test/chef-repo/
<span class="gp">%</span> vi ./node/myapp-test.json
<span class="go">{"run_list":[</span>
<span class="go">    "recipe[yum::epel]"</span>
<span class="go">  ]</span>
<span class="go">}</span>
</pre></div>
</div>

<div class="code-frame" data-lang="shell-session">
<div class="code-lang"><span class="bold">knife_soloを実行する</span></div>
<div class="highlight"><pre><span></span><span class="gp">%</span> bundle <span class="nb">exec</span> knife solo cook -F ./myapp_sshconfig myapp-test 
</pre></div>
</div>

<p>以上でepelのyumリポジトリがVMのホストにインストールされていると思います。<br>
残りはberkshelfでその他サードパーティのクックブックを入れたり、site-cookbooks以下に独自のクックブックを作ったりしてよしなにvagrantのVMを使い倒せます！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>10</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/6d2c30a1ea6d3c788946">assets:precompileする環境のActiveAdminで開発環境と本番環境で見た目を変えるの場合の注意</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-23 12:15:02</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Rails]</b> <b>[activeadmin]</b> <b>[assetspipline]</b> <b>[アセットパイプライン]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://shakezoomer.com/?p=466" rel="nofollow noopener" target="_blank">【Rails】ActiveAdminで、開発環境と本番環境で見た目を変える</a> の記事を見て、ずっとやりたいと思っていたことだったので試してみた。  </p>

<p>設定したらサクッと動いた。最高！！簡単な概要は以下の2点だけ  </p>

<ol>
<li>app/assets/stylesheets/ 配下にスキンを変えた独自のCSSを配置する。</li>
<li>config/initializers/active_admin.rb でスキンを変えた独自のCSSを読み込む指定をする。</li>
</ol>

<p>本番にも反映しようとenvironmentをproductionなどに変えてみて確認していたら、アセットパイプラインをprecompileする環境では、デフォルトだとapplication.cssしかprecompileされないので、独自に定義したCSSがprecompileされない状態でCSSの404エラーが出る状態だった。<br>
developmentなど、アセットパイプラインを動的にコンパイルする環境では動きました。</p>

<p>要するに、、<br><br>
<a href="http://shakezoomer.com/?p=466" rel="nofollow noopener" target="_blank">【Rails】ActiveAdminで、開発環境と本番環境で見た目を変える</a> の記事の設定に加えて、assets:precompileする環境のために、独自のCSSを明示的にprecompileする対象に加えてあげる必要があります。</p>

<h2>
<span id="対応方法は以下の2パターン" class="fragment"></span><a href="#%E5%AF%BE%E5%BF%9C%E6%96%B9%E6%B3%95%E3%81%AF%E4%BB%A5%E4%B8%8B%E3%81%AE2%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>対応方法は以下の2パターン！</h2>

<p>まずやりたいことをおさらいしておくと、、、</p>

<h3>
<span id="目的" class="fragment"></span><a href="#%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>目的</h3>

<p>development, production, stagingでそれぞれ違う見た目にする。（assets:precompileが必要な環境でも動作するように）</p>

<h3>
<span id="前提条件" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><i class="fa fa-link"></i></a>前提条件</h3>

<ul>
<li>関連するファイルのディレクトリ構成は以下のとおり（<a href="http://shakezoomer.com/?p=466" rel="nofollow noopener" target="_blank">【Rails】ActiveAdminで、開発環境と本番環境で見た目を変える</a>）とは少し構成を変えています。</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>RAILS_ROOT
├── app
│   └── assets
│       └── stylesheets
│            └── admin
│                ├── development.css.scss
│                ├── production.css.scss
│                └── staging.css.scss
└── config
    ├── initializer
    │   └── active_admin.rb
    └── environments
         ├── development.rb
         ├── production.rb
         ├── staging.rb
         └── test.rb
</pre></div></div>

<ul>
<li>config/initializer/active_admin.rb に環境に応じてカスタムした独自CSSの読込を変更する設定を入れておく</li>
</ul>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">config/initializer/active_admin.rb</span></div>
<div class="highlight"><pre><span></span><span class="err">…省略</span>
  <span class="k">if</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span> <span class="o">||</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">development?</span> <span class="o">||</span> <span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">staging?</span>
    <span class="n">config</span><span class="o">.</span><span class="n">register_stylesheet</span> <span class="s2">"admin/</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">to_s</span><span class="si">}</span><span class="s2">.css"</span>
  <span class="k">end</span>
<span class="err">…省略</span>
</pre></div>
</div>

<ul>
<li>カスタムした独自CSS(production用)は以下のとおり。上記参考サイトの内容をそのまま使わせていただきました。 （development, stagingもほぼ同じでカラーなどを変えているだけ）</li>
</ul>

<div class="code-frame" data-lang="css">
<div class="code-lang"><span class="bold">app/assets/stylesheets/admin/production.css.scss</span></div>
<div class="highlight"><pre><span></span><span class="nt">body</span><span class="p">.</span><span class="nc">active_admin</span> <span class="p">{</span>
    <span class="err">#header{</span>
      <span class="k">background</span><span class="p">:</span> <span class="bp">-webkit-</span><span class="nb">linear-gradient</span><span class="p">(</span><span class="mi">-90</span><span class="kt">deg</span><span class="p">,</span> <span class="mh">#6a7176</span><span class="p">,</span> <span class="mh">#4d5256</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">page_title</span> <span class="p">{</span>
        <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">page_title</span><span class="p">:</span><span class="nd">before</span> <span class="p">{</span>
        <span class="k">content</span><span class="p">:</span> <span class="s2">"Production - "</span><span class="p">;</span>
        <span class="k">padding-left</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">color</span><span class="p">:</span> <span class="mh">#ff6600</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">#</span><span class="nn">page_title</span><span class="p">:</span><span class="nd">after</span> <span class="p">{</span>
        <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
        <span class="k">top</span><span class="p">:</span> <span class="mi">-8</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">width</span><span class="p">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">height</span><span class="p">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kp">-webkit-</span><span class="k">border-radius</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
        <span class="kp">-moz-</span><span class="k">border-radius</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
        <span class="k">border-radius</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
        <span class="k">background</span><span class="p">:</span> <span class="mh">#ff6600</span><span class="p">;</span>
        <span class="k">content</span><span class="p">:</span> <span class="s2">"!"</span><span class="p">;</span>
        <span class="k">color</span><span class="p">:</span> <span class="mh">#ffffff</span><span class="p">;</span>
        <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
        <span class="k">line-height</span><span class="p">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">font-weight</span><span class="p">:</span> <span class="kc">normal</span><span class="p">;</span>
        <span class="k">font-size</span><span class="p">:</span> <span class="mi">24</span><span class="kt">px</span>
    <span class="p">}</span>
<span class="err">}</span>
</pre></div>
</div>

<h2>
<span id="1パターン目-configenvironments-配下の各環境の設定ファイルで独自cssをprecompileする対象に追加する" class="fragment"></span><a href="#1%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E7%9B%AE-configenvironments-%E9%85%8D%E4%B8%8B%E3%81%AE%E5%90%84%E7%92%B0%E5%A2%83%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E7%8B%AC%E8%87%AAcss%E3%82%92precompile%E3%81%99%E3%82%8B%E5%AF%BE%E8%B1%A1%E3%81%AB%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>【1パターン目】 config/environments/ 配下の各環境の設定ファイルで、独自CSSをprecompileする対象に追加する</h2>

<p>このやり方が単純で見た目を変えたい環境がProductionのみなど少なければすぐ出来る。</p>

<p>app/assets/stylesheets/admin 配下に環境ごとのスキンを変えた独自CSSを配置している状態で、<br><br>
config/environments 配下にある各環境の設定ファイルで「 <strong>config.assets.precompile</strong> 」の項目にprecompileする対象の独自CSSを指定する</p>

<p>例としてproduction環境の設定を変更する箇所は以下のようになります。（同様にstaging, development　も同様に設定する）</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">config/environments/production.rb</span></div>
<div class="highlight"><pre><span></span><span class="c1"># Precompile additional assets (application.js, application.css, and all non-JS/CSS are already added)</span>
<span class="c1"># config.assets.precompile += %w( search.js )</span>
<span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="sx">%w( admin/production.css )</span>
</pre></div>
</div>

<p>これで「rake assets:precompile」を行うと、public/assets/admin/production.cssというファイルがコンパイルされて生成される。</p>

<h2>
<span id="2パターン目-configinitializeractive_adminrb-の中でプリコンパイルする独自cssを一括指定する" class="fragment"></span><a href="#2%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E7%9B%AE-configinitializeractive_adminrb-%E3%81%AE%E4%B8%AD%E3%81%A7%E3%83%97%E3%83%AA%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%99%E3%82%8B%E7%8B%AC%E8%87%AAcss%E3%82%92%E4%B8%80%E6%8B%AC%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>【2パターン目】 config/initializer/active_admin.rb の中でプリコンパイルする独自CSSを一括指定する</h2>

<p>上記の場合だと、environments/staging.rb, environments/development.rbにもそれぞれ設定を書かなきゃならず、環境が増えてもその都度設定しないといけないのが面倒なので、<br><br>
Rubyのオープンクラスの特徴を活かすのと正規表現を使い、一括で指定します。</p>

<p><strong>config/initializer/active_admin.rb</strong>ファイルの末尾などに以下の内容を記載することで<br><br>
app/assets/stylesheets/admin/*.css のファイルを一括で指定できます。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">config/initializer/active_admin.rb</span></div>
<div class="highlight"><pre><span></span><span class="err">…省略</span>
<span class="no">APP_NAME</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span>
  <span class="n">config</span><span class="o">.</span><span class="n">assets</span><span class="o">.</span><span class="n">precompile</span> <span class="o">+=</span> <span class="o">[</span> <span class="sr">/^admin\/.*\.css$/</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>

<p>※APP_NAMEには対象のRailsアプリの識別子を入れます。</p>

<p>以上で、precompileする対象に独自CSSを加えられるので、無事各環境に応じた管理画面が見た目が変わって、色々とはかどります。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/5cb1d570ac0bbfcf2b36">git-svnでディレクトリ削除時に空のディレクトリが残る場合の対処</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-11 11:19:26</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[Subversion]</b> <b>[svn]</b> <b>[ディレクトリ削除]</b> <b>[git-svn]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="dcommit-時に---rmdirオプションをつける" class="fragment"></span><a href="#dcommit-%E6%99%82%E3%81%AB---rmdir%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>dcommit 時に --rmdirオプションをつける</h2>

<p>ディレクトリを削除したリビジョンが含まれるものをdcommitするときに--rmdirオプションを使う</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% git svn dcommit --rmdir
</pre></div></div>

<h2>
<span id="すでにdcommitしている状態の時" class="fragment"></span><a href="#%E3%81%99%E3%81%A7%E3%81%ABdcommit%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E7%8A%B6%E6%85%8B%E3%81%AE%E6%99%82"><i class="fa fa-link"></i></a>すでにdcommitしている状態の時</h2>

<p>すでにコミットしている場合は、、git-svnじゃどうにもいかないようなので、素直にSVNのコマンドで削除する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% svn delete -m "delete empty dir" https://URL/hoge/EMPTY_DIR
</pre></div></div>

<p>他に方法があれば教えて下さいー！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/dd674199e22315a54ea3">Unity ネイティブコードに橋渡しするスクリプトで必要なimport</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-05-10 16:02:46</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[C#]</b> <b>[Unity3D]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>・JSの場合<br>
import System.Runtime.InteropServices;</p>

<p>・C#の場合<br>
using System.Runtime.InteropServices;</p>

<p>参考：<a href="http://blog.valeur3.com/?p=380" class="autolink" rel="nofollow noopener" target="_blank">http://blog.valeur3.com/?p=380</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yusabanaさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/yusabana/items/8e2aeb8e3ca0b6a3260a">SVNコマンドの便利な使い方メモ（オプション・サブコマンドなど）</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-24 18:46:59</center>
	</td>
	<td style="width:200px;">
		@yusabana<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6038/profile-images/1473682512">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Subversion]</b> <b>[svn]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h3>
<span id="誤ってsvn-add-してしまったディレクトリを取り消す" class="fragment"></span><a href="#%E8%AA%A4%E3%81%A3%E3%81%A6svn-add-%E3%81%97%E3%81%A6%E3%81%97%E3%81%BE%E3%81%A3%E3%81%9F%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E5%8F%96%E3%82%8A%E6%B6%88%E3%81%99"><i class="fa fa-link"></i></a>誤ってsvn add してしまったディレクトリを取り消す</h3>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>% svn revert --depth infinity <span class="o">[</span>ディレクトリ名<span class="o">]</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
