<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (wadako111)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (wadako111 さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>862</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/5eb8e30aca1737ba6ba5">一日18時間VimでRailsを開発している僕が選ぶVim Tips 10選</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-08 21:37:25</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Vim]</b> <b>[Rails]</b> <b>[Rails4]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h3>
<span id="寝ている時間以外はvimとrailsを触っている僕が選ぶvim-tips10選を紹介します" class="fragment"></span><a href="#%E5%AF%9D%E3%81%A6%E3%81%84%E3%82%8B%E6%99%82%E9%96%93%E4%BB%A5%E5%A4%96%E3%81%AFvim%E3%81%A8rails%E3%82%92%E8%A7%A6%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E5%83%95%E3%81%8C%E9%81%B8%E3%81%B6vim-tips10%E9%81%B8%E3%82%92%E7%B4%B9%E4%BB%8B%E3%81%97%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>寝ている時間以外はVimとRailsを触っている僕が選ぶVim Tips10選を紹介します。</h3>

<p>Vimを使い始めて3ヶ月ぐらいの人にオススメです。<br>
※ あんまりRailsは関係ありません。</p>

<h1>
<span id="diw-ノーマルモード" class="fragment"></span><a href="#diw-%E3%83%8E%E3%83%BC%E3%83%9E%E3%83%AB%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>diw （ノーマルモード）</h1>

<h4>
<span id="カーソル上の単語を消す" class="fragment"></span><a href="#%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E4%B8%8A%E3%81%AE%E5%8D%98%E8%AA%9E%E3%82%92%E6%B6%88%E3%81%99"><i class="fa fa-link"></i></a>カーソル上の単語を消す</h4>

<p>こいつがなくてはVimを使う意味が無いというほどよく使うコマンド。<br>
ノーマルモードで <code>hoge</code> という文字列上の、どこかにカーソルがある状態で<code>diw</code>とタイプすると<code>hoge</code>という単語が消えます。</p>

<p>この何を単語とするのか、その判定が非常に秀逸で、直感にマッチしていて便利です。<br>
たとえば、<code>|</code>をカーソル位置だとして、<br>
<code>ho|ge bar</code> -&gt; <code>bar</code><br>
<code>ho|ge.bar</code> -&gt; <code>.bar</code><br>
<code>"ho|ge"</code> -&gt; <code>""</code><br>
<code>&lt;di|v&gt;</code> -&gt; <code>&lt;&gt;</code></p>

<p>このように、うまい感じに特殊記号等を避けて、単語を削除してくれます。</p>

<p><code>ciw</code>とタイプすることで、<code>hoge</code>を削除後、挿入モードになることも可能。</p>

<h1>
<span id="di-ノーマルモード" class="fragment"></span><a href="#di-%E3%83%8E%E3%83%BC%E3%83%9E%E3%83%AB%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>di" （ノーマルモード）</h1>

<h4>
<span id="ダブルコーテーションで囲まれた文字列を消す" class="fragment"></span><a href="#%E3%83%80%E3%83%96%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%86%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E5%9B%B2%E3%81%BE%E3%82%8C%E3%81%9F%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E6%B6%88%E3%81%99"><i class="fa fa-link"></i></a>""（ダブルコーテーション）で囲まれた文字列を消す</h4>

<p><code>diw</code> と似たようなコマンドで、<code>""</code>で囲まれた文字列を消してくれます。<br>
このコマンドの便利なところは、カーソル位置が<code>""</code>内に無くても良いところ。</p>

<p>例えば、カーソル位置を<code>|</code>だとして、<br>
<code>hoge = "f|oo bar"</code>という状態で、<code>di"</code>とタイプすると、当然<code>hoge = "|"</code>になります。<br>
しかし、なんと、<br>
<code>ho|ge = "foo bar"</code> という状態で、<code>di"</code>とタイプしても<code>hoge = "|"</code>となります</p>

<p>つまり現在位置が<code>""</code>内に含まれて無くても、その行内で今あるカーソル位置よりも後ろに<code>""</code>で囲まれた文字列があれば、そこまで移動して消去してくれるのです。</p>

<h1>
<span id="-ノーマルモード" class="fragment"></span><a href="#-%E3%83%8E%E3%83%BC%E3%83%9E%E3%83%AB%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>* （ノーマルモード）</h1>

<h4>
<span id="カーソル位置にある単語を検索する" class="fragment"></span><a href="#%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E4%BD%8D%E7%BD%AE%E3%81%AB%E3%81%82%E3%82%8B%E5%8D%98%E8%AA%9E%E3%82%92%E6%A4%9C%E7%B4%A2%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>カーソル位置にある単語を検索する</h4>

<p><code>*</code> のお陰で自分で検索する文字列を打つことが半分以下に減りました。<br>
<code>*</code>は今あるカーソル位置の単語を検索してくれます。 <code>diw</code> と同じように、単語の判定が秀逸。</p>

<p><code>hoge fo|o bar</code> -&gt; <code>foo</code>を検索<br>
<code>fo|o.bar</code> -&gt; <code>foo</code>を検索</p>

<p>ControllerやModelで、変数がどこで使われているのかを素早く検索するときに便利です。</p>

<h1>
<span id="c-a-c-x-ノーマルモード" class="fragment"></span><a href="#c-a-c-x-%E3%83%8E%E3%83%BC%E3%83%9E%E3%83%AB%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>C-a, C-x （ノーマルモード）</h1>

<h4>
<span id="数値をインクリメントデクリメントする" class="fragment"></span><a href="#%E6%95%B0%E5%80%A4%E3%82%92%E3%82%A4%E3%83%B3%E3%82%AF%E3%83%AA%E3%83%A1%E3%83%B3%E3%83%88%E3%83%87%E3%82%AF%E3%83%AA%E3%83%A1%E3%83%B3%E3%83%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>数値をインクリメント、デクリメントする</h4>

<p>ノーマルモードで <code>3</code> にカーソルがあったとして、<code>C-a</code>（Ctrl+a） とタイプすると <code>4</code>になります。<br>
また、<code>C-x</code>（Ctrl+x）とタイプすると、逆に<code>2</code>になります。</p>

<p>これだけ見ると全く使いどころの無いコマンドに見えますが、ある２つのテクニックを知っているだけで、<br>
CSSを書くのに非常に便利なコマンドになります。</p>

<h5>
<span id="数値と組み合わせる" class="fragment"></span><a href="#%E6%95%B0%E5%80%A4%E3%81%A8%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>数値と組み合わせる</h5>

<p>ただ<code>C-a</code>とタイプするのではなく、<code>3C-a</code>, <code>10C-a</code>のようにコマンドの前に数値を入力します。<br>
Vimでは基本的に、先に数値を入力しておくことで、その数値回数だけそのあとのコマンドを繰り返します。<br>
つまり、<code>3C-a</code> は <code>C-a</code> を3回繰り返す、 <code>10C-a</code> は <code>C-a</code> を10回繰り返すという意味です。</p>

<p>これによって、例えばCSSで <code>margin: 8px</code>という記述があり、<code>15px</code>に直したいというときも <code>7C-a</code> で修正できます。</p>

<h5>
<span id="数値にカーソルを置かないで使う" class="fragment"></span><a href="#%E6%95%B0%E5%80%A4%E3%81%AB%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%82%92%E7%BD%AE%E3%81%8B%E3%81%AA%E3%81%84%E3%81%A7%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>数値にカーソルを置かないで使う</h5>

<p>この <code>C-a</code>, <code>C-x</code> について、実はなんと数値上にカーソルがなくても使えます。<br>
先に紹介した <code>di"</code> のように、その行において、カーソルのある位置から後ろに数値があれば、それをインクリメントしてくれます。</p>

<p>したがって、 <code>ma|rgin: 8px</code> こんな状態だとしても、<code>5C-a</code> とタイプすることで <code>margin: |13px</code> と、インクリメントすることができ、更にカーソル位置も数値の場所に移動します。</p>

<p>CSSを書くときはこの<code>C-a</code>（Ctrl+a)と<code>C-x</code>（Ctrl+x）がないとやってられません。</p>

<h1>
<span id="unite" class="fragment"></span><a href="#unite"><i class="fa fa-link"></i></a>Unite</h1>

<h4>
<span id="ファイラ-httpsgithubcomshougounitevim-" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%A9-httpsgithubcomshougounitevim-"><i class="fa fa-link"></i></a>ファイラ（ <a href="https://github.com/Shougo/unite.vim" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/Shougo/unite.vim</a> ）</h4>

<p>唯一Railsに関係するTipsな気がします。Uniteの説明は「vim unite」でググれば色々と出てくることでしょう。<br>
※ :help unite でも簡単なexampleや説明があります。<br>
今回はuniteはファイラとして利用する場合について説明します。</p>

<p>とりあえずキーバインドとして僕は以下のように <code>.vimrc</code> に書いています。</p>

<div class="code-frame" data-lang="vim"><div class="highlight"><pre><span></span>NeoBundle <span class="s1">'Shougo/unite.vim'</span>
<span class="k">let</span> <span class="k">g</span>:unite_enable_start_insert <span class="p">=</span> <span class="m">1</span>
<span class="k">let</span> <span class="k">g</span>:unite_enable_split_vertically <span class="p">=</span> <span class="m">0</span>
<span class="k">let</span> <span class="k">g</span>:unite_winwidth <span class="p">=</span> <span class="m">40</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>uf :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>UniteWithBufferDir <span class="p">-</span>buffer<span class="p">-</span>name<span class="p">=</span><span class="k">files</span> <span class="k">file</span> <span class="k">file</span>/<span class="k">new</span><span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>um :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite  file_mru <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urc :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_rec<span class="sr">/async:app/</span>controllers/ <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urfc :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite <span class="k">file</span> <span class="k">file</span><span class="sr">/new -input=app/</span>controllers/ <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urm :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_rec<span class="sr">/async:app/</span>models/ <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urfm :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite <span class="k">file</span> <span class="k">file</span><span class="sr">/new -input=app/</span>models/ <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urv :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_rec<span class="sr">/async:app/</span>views/ <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urfv :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite <span class="k">file</span> <span class="k">file</span><span class="sr">/new -input=app/</span>views/ <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urs :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_rec<span class="sr">/async:app/</span>assets<span class="sr">/stylesheets/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urfs :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite <span class="k">file</span> <span class="k">file</span><span class="sr">/new -input=app/</span>assets<span class="sr">/stylesheets/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urj :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_rec<span class="sr">/async:app/</span>assets<span class="sr">/javascripts/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urfj :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite <span class="k">file</span> <span class="k">file</span><span class="sr">/new -input=app/</span>assets<span class="sr">/javascripts/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>uro :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_rec<span class="sr">/async:config/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urfo :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite <span class="k">file</span> <span class="k">file</span><span class="sr">/new -input=config/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>url :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_rec<span class="sr">/async:lib/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urfl :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite <span class="k">file</span> <span class="k">file</span><span class="sr">/new -input=lib/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urr :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_rec<span class="sr">/async:spec/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">,</span>urfr :<span class="p">&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite <span class="k">file</span> <span class="k">file</span><span class="sr">/new -input=spec/</span> <span class="p">&lt;</span>CR<span class="p">&gt;</span>
</pre></div></div>

<p>実際に <code>,urc</code> 等をノーマルモードでタイプしてみると、どんな動きをするのか理解できると思います。<br>
以前は <code>rails.vim</code> をファイラとしては利用していたのですが、ファイル数の増加に伴い、 <code>:RView hoge.rb</code> のような指定方法は、補完を使ったとしても難しくなってしまい、Uniteに移行しました。<br>
この設定によって、rails.vim以上のファイル移動速度を発揮しています。</p>

<p>また、これは実行しているVimのカレントディレクトリを、Railsプロジェクト直下にしておく必要があります。</p>

<h1>
<span id="g-ノーマルモード" class="fragment"></span><a href="#g-%E3%83%8E%E3%83%BC%E3%83%9E%E3%83%AB%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>g; （ノーマルモード）</h1>

<h4>
<span id="前に変更した場所へカーソルを移動する" class="fragment"></span><a href="#%E5%89%8D%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%97%E3%81%9F%E5%A0%B4%E6%89%80%E3%81%B8%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%82%92%E7%A7%BB%E5%8B%95%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>前に変更した場所へカーソルを移動する</h4>

<p>Vimは他のエディタとは違い、いつどこで変更を行ったのかを記録しています。<br>
それをさかのぼって、前に変更したところにカーソルを持って行ってくれるのが、この <code>g;</code> です。</p>

<p>このコマンドの存在によって、例えば、大変な行数があるファイルを編集しているときに、そのファイルの先頭を参照し、またさきほど変更していたところから編集し直す、といったことが非常に容易になります。</p>

<p>あんまり知られてないけど、一度使い始めたら、無いと困っちゃうコマンドです。</p>

<h1>
<span id="c-h-いつでも" class="fragment"></span><a href="#c-h-%E3%81%84%E3%81%A4%E3%81%A7%E3%82%82"><i class="fa fa-link"></i></a>C-h （いつでも）</h1>

<h4>
<span id="backspacedeleteキー" class="fragment"></span><a href="#backspacedelete%E3%82%AD%E3%83%BC"><i class="fa fa-link"></i></a>backspace（delete）キー</h4>

<p>Vimはまるで関係ありませんが、 基本的に<code>C-h</code> はBackSpaceキー（OSXならばdelete）に相当します。<br>
backspaceはキーボードの右上にあり、これを使っていると右小指が痛くなってしまうので、手にやさしい <code>C-h</code> を使うことにしています。</p>

<h1>
<span id="c-m-いつでも" class="fragment"></span><a href="#c-m-%E3%81%84%E3%81%A4%E3%81%A7%E3%82%82"><i class="fa fa-link"></i></a>C-m （いつでも）</h1>

<h4>
<span id="enterキー" class="fragment"></span><a href="#enter%E3%82%AD%E3%83%BC"><i class="fa fa-link"></i></a>Enterキー</h4>

<p>こいつもVimに全く関係ありませんが、基本的に <code>C-m</code>はEnterキーに相当します。<br>
私は普段、日本語キーボードを利用しておりEnterキーは非常に遠く、また右小指が痛くなってしまうので、これからは一生 <code>C-m</code> を使うことに決めました。</p>

<h1>
<span id="dap-ノーマルモード" class="fragment"></span><a href="#dap-%E3%83%8E%E3%83%BC%E3%83%9E%E3%83%AB%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>dap （ノーマルモード）</h1>

<h4>
<span id="パラグラフを消去" class="fragment"></span><a href="#%E3%83%91%E3%83%A9%E3%82%B0%E3%83%A9%E3%83%95%E3%82%92%E6%B6%88%E5%8E%BB"><i class="fa fa-link"></i></a>パラグラフを消去</h4>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span></span>  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">hoge</span>
    <span class="n">foo</span> <span class="n">hoge</span> <span class="n">bar</span>
    <span class="n">bar</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="o">...</span>
</pre></div></div>

<p>この状態で <code>def hoge ... end</code> の中にカーソルがあるとき、 <code>dap</code> とタイプすることで</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span></span>  <span class="k">end</span>

  <span class="k">def</span> <span class="o">...</span>
</pre></div></div>

<p><code>def hoge ... end</code> のパラグラフが消去されます。</p>

<p>どんな要素を持ってパラグラフなのかは、詳しくは調べてはいませんが、「改行のない連続した行」な気がします。<br>
つまり、</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span></span><span class="n">hoge</span> <span class="n">hoge</span>

<span class="n">foo</span> <span class="n">foo</span>
<span class="n">foo</span> <span class="n">foo</span>

<span class="n">bar</span> <span class="n">bar</span>
<span class="n">bar</span> <span class="n">bar</span>
<span class="n">bar</span> <span class="n">bar</span>
</pre></div></div>

<p>このような状態ならば、 <code>hoge</code> のパラグラフ、 <code>foo</code> のパラグラフ、 <code>bar</code> のパラグラフの3つのパラグラフが存在します。</p>

<p>例に上げたとおり、メソッドをまるまる削除するのに便利です。</p>

<h1>
<span id="c--ノーマルモード" class="fragment"></span><a href="#c--%E3%83%8E%E3%83%BC%E3%83%9E%E3%83%AB%E3%83%A2%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>C-^ （ノーマルモード）</h1>

<h4>
<span id="前に開いたファイルを開く" class="fragment"></span><a href="#%E5%89%8D%E3%81%AB%E9%96%8B%E3%81%84%E3%81%9F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E9%96%8B%E3%81%8F"><i class="fa fa-link"></i></a>前に開いたファイルを開く</h4>

<p>そのウィンドウで以前開いていたファイルを開きます。<br>
<code>A.rb</code>を開いた後、<code>B.rb</code> を開いたところで <code>C-^</code> とタイプすると <code>A.rb</code> が開きます。</p>

<p>このコマンドの良い点は、 <code>C-^</code> によって <code>A.rb</code> が開かれた状態で、また <code>C-^</code> とタイプすると、<code>B.rb</code> に戻ってくる点です。<br>
往々にして、他のエディタはこのようなコマンドは、どんどん前のファイルを開いていってしまい、結局元のファイルを開くことが難しくなってしまうことが多いのですが、このコマンドならば、ちょっと参照するために <code>A.rb</code> を開き、またすぐ <code>B.rb</code> に戻ってくる、みたいなことが簡単にできるのです。流石。</p>

<h1>
<span id="タブ機能" class="fragment"></span><a href="#%E3%82%BF%E3%83%96%E6%A9%9F%E8%83%BD"><i class="fa fa-link"></i></a>タブ機能</h1>

<h4>
<span id="vimにもタブ機能があったんです" class="fragment"></span><a href="#vim%E3%81%AB%E3%82%82%E3%82%BF%E3%83%96%E6%A9%9F%E8%83%BD%E3%81%8C%E3%81%82%E3%81%A3%E3%81%9F%E3%82%93%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>Vimにもタブ機能があったんです。</h4>

<p>僕はVimを使い出して、1年ぐらいしてから知ったのですが、VimにもChromeのようなタブ機能があったんです。<br>
<a href="http://qiita.com/wadako111/items/755e753677dd72d8036d" id="reference-58011b2049e551e5fa6c">vimのすごい便利なのにあまり使われていない「タブページ」機能</a><br>
以前僕が書いた記事を参照してみると良いでしょう。</p>

<p><a href="https://camo.qiitausercontent.com/7c8142ae2f0a87f6b490c5647b8f10b63561df49/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f393337332f33316665646163342d356639342d666462342d623062302d3566613236636630643866612e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7c8142ae2f0a87f6b490c5647b8f10b63561df49/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f393337332f33316665646163342d356639342d666462342d623062302d3566613236636630643866612e6a706567" alt="5e38065d-2b82-248c-e9fd-e5a62c270b61.jpeg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/9373/31fedac4-5f94-fdb4-b0b0-5fa26cf0d8fa.jpeg"></a></p>

<p>　<br>
　<br>
以上です。知っていた事項もあるかもしれませんが、少なくとも僕が上記の事項に気づくのには、Vimを使い出してから1年ぐらいかかりました。<br>
皆様のVimライフがより良いものになれば幸いです。</p>

<p>P.S.<br>
<a href="http://storys.jp" rel="nofollow noopener" target="_blank">STORYS.JP</a>、 <a href="https://coincheck.jp" rel="nofollow noopener" target="_blank">coincheck</a> などのサービスを運営、開発しています。興味のある方はぜひ <a href="http://qiita.com/wadako111">和田</a>まで連絡を！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>599</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/755e753677dd72d8036d">vimのすごい便利なのにあまり使われていない「タブページ」機能</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-16 16:19:23</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Vim]</b> <b>[vimrc]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="vim-タブページ" class="fragment"></span><a href="#vim-%E3%82%BF%E3%83%96%E3%83%9A%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>vim タブページ</h1>

<p>みなさんvimのタブページ機能を使っていますか？</p>

<p>この一番上のバーに出ている、ブラウザなどでよくある「タブ」のことです。↓</p>

<p><a href="https://camo.qiitausercontent.com/b15463170dfbcd35f046769ec411f40972fb0c51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f393337332f35653338303635642d326238322d323438632d653966642d6535613632633237306236312e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b15463170dfbcd35f046769ec411f40972fb0c51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f393337332f35653338303635642d326238322d323438632d653966642d6535613632633237306236312e6a706567" alt="vim-tabpage2.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/9373/5e38065d-2b82-248c-e9fd-e5a62c270b61.jpeg"></a></p>

<p>これはvim 7.3から導入された機能なのですが、なぜかあまり使われていません。<br>
<a href="https://www.google.co.jp/search?q=vim+%E3%82%BF%E3%83%96%E3%83%9A%E3%83%BC%E3%82%B8&amp;oq=vim+%E3%82%BF%E3%83%96%E3%83%9A%E3%83%BC%E3%82%B8" rel="nofollow noopener" target="_blank">Google検索 vim タブページ</a></p>

<p>　</p>

<h5>
<span id="しかしこれはめちゃめちゃ便利です" class="fragment"></span><a href="#%E3%81%97%E3%81%8B%E3%81%97%E3%81%93%E3%82%8C%E3%81%AF%E3%82%81%E3%81%A1%E3%82%83%E3%82%81%E3%81%A1%E3%82%83%E4%BE%BF%E5%88%A9%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>しかし、これはめちゃめちゃ便利です！</h5>

<h5>
<span id="今までtmuxでvimを複数個立ち上げておりちょっと別の作業をするときは別のvimを起動していたのですがタブページを利用することによって1つのvimで作業することができ更にヤンクももちろんタブ間で共有されるので開発効率がかなり上がりました" class="fragment"></span><a href="#%E4%BB%8A%E3%81%BE%E3%81%A7tmux%E3%81%A7vim%E3%82%92%E8%A4%87%E6%95%B0%E5%80%8B%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92%E3%81%A6%E3%81%8A%E3%82%8A%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E5%88%A5%E3%81%AE%E4%BD%9C%E6%A5%AD%E3%82%92%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AF%E5%88%A5%E3%81%AEvim%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E3%81%AE%E3%81%A7%E3%81%99%E3%81%8C%E3%82%BF%E3%83%96%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A61%E3%81%A4%E3%81%AEvim%E3%81%A7%E4%BD%9C%E6%A5%AD%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%A7%E3%81%8D%E6%9B%B4%E3%81%AB%E3%83%A4%E3%83%B3%E3%82%AF%E3%82%82%E3%82%82%E3%81%A1%E3%82%8D%E3%82%93%E3%82%BF%E3%83%96%E9%96%93%E3%81%A7%E5%85%B1%E6%9C%89%E3%81%95%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%A7%E9%96%8B%E7%99%BA%E5%8A%B9%E7%8E%87%E3%81%8C%E3%81%8B%E3%81%AA%E3%82%8A%E4%B8%8A%E3%81%8C%E3%82%8A%E3%81%BE%E3%81%97%E3%81%9F"><i class="fa fa-link"></i></a>今までtmuxでvimを複数個立ち上げており、ちょっと別の作業をするときは別のvimを起動していたのですが、タブページを利用することによって1つのvimで作業することができ、更にヤンクももちろんタブ間で共有されるので開発効率がかなり上がりました。</h5>

<p>あまり使われていない原因はおそらく、デフォルトの状態だと、タブ間の移動がかなりめんどくさいからだと思います。</p>

<p>デフォルトはこんな感じ<br>
<a href="https://camo.qiitausercontent.com/6ae40dea00d3035f19bd1381e2b1078cffe3eafa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f393337332f33356166313331622d393735302d623063632d333035352d6366663535653234383663662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6ae40dea00d3035f19bd1381e2b1078cffe3eafa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f393337332f33356166313331622d393735302d623063632d333035352d6366663535653234383663662e706e67" alt="Screen Shot 2013-07-16 at 16.15.16.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/9373/35af131b-9750-b0cc-3055-cff55e2486cf.png"></a></p>

<p>右側のタブに移動するたびに <code>:tabnext</code><br>
ラストのタブに移動するには <code>:tablast</code> など打っていられません。</p>

<p>また、<code>:tabnext3</code> などのコマンドで、左から3番目のタブに移動できるのですが、<br>
デフォルトのタブライン（タブのステータスバー）は番号も書いてないので、簡単には移動出来ません。</p>

<p>　</p>

<p>そこで暗黒美夢王（ダークビムマスター）ことShougoさんの.vimrcを参考に<br>
快適にタブページ機能を使えるよう.vimrcを作りました。</p>

<p><a href="https://github.com/Shougo/shougo-s-github/blob/master/vim/.vimrc" rel="nofollow noopener" target="_blank">参考 Shougo/shougo-s-github</a></p>

<div class="code-frame" data-lang="vim">
<div class="code-lang"><span class="bold">.vimrc</span></div>
<div class="highlight"><pre><span></span><span class="c">" Anywhere SID.</span>
<span class="k">function</span><span class="p">!</span> s:SID_PREFIX<span class="p">()</span>
  <span class="k">return</span> matchstr<span class="p">(</span>expand<span class="p">(</span><span class="s1">'&lt;sfile&gt;'</span><span class="p">),</span> <span class="s1">'&lt;SNR&gt;\d\+_\zeSID_PREFIX$'</span><span class="p">)</span>
<span class="k">endfunction</span>

<span class="c">" Set tabline.</span>
<span class="k">function</span><span class="p">!</span> s:my_tabline<span class="p">()</span>  <span class="c">"{{{</span>
  <span class="k">let</span> s <span class="p">=</span> <span class="s1">''</span>
  <span class="k">for</span> <span class="k">i</span> <span class="k">in</span> range<span class="p">(</span><span class="m">1</span><span class="p">,</span> tabpagenr<span class="p">(</span><span class="s1">'$'</span><span class="p">))</span>
    <span class="k">let</span> bufnrs <span class="p">=</span> tabpagebuflist<span class="p">(</span><span class="k">i</span><span class="p">)</span>
    <span class="k">let</span> bufnr <span class="p">=</span> bufnrs[tabpagewinnr<span class="p">(</span><span class="k">i</span><span class="p">)</span> <span class="p">-</span> <span class="m">1</span>]  <span class="c">" first window, first appears</span>
    <span class="k">let</span> no <span class="p">=</span> <span class="k">i</span>  <span class="c">" display 0-origin tabpagenr.</span>
    <span class="k">let</span> <span class="k">mod</span> <span class="p">=</span> getbufvar<span class="p">(</span>bufnr<span class="p">,</span> <span class="s1">'&amp;modified'</span><span class="p">)</span> ? <span class="s1">'!'</span> : <span class="s1">' '</span>
    <span class="k">let</span> <span class="nb">title</span> <span class="p">=</span> fnamemodify<span class="p">(</span>bufname<span class="p">(</span>bufnr<span class="p">),</span> <span class="s1">':t'</span><span class="p">)</span>
    <span class="k">let</span> <span class="nb">title</span> <span class="p">=</span> <span class="s1">'['</span> . <span class="nb">title</span> . <span class="s1">']'</span>
    <span class="k">let</span> s .<span class="p">=</span> <span class="s1">'%'</span>.<span class="k">i</span>.<span class="s1">'T'</span>
    <span class="k">let</span> s .<span class="p">=</span> <span class="s1">'%#'</span> . <span class="p">(</span><span class="k">i</span> <span class="p">==</span> tabpagenr<span class="p">()</span> ? <span class="s1">'TabLineSel'</span> : <span class="s1">'TabLine'</span><span class="p">)</span> . <span class="s1">'#'</span>
    <span class="k">let</span> s .<span class="p">=</span> no . <span class="s1">':'</span> . <span class="nb">title</span>
    <span class="k">let</span> s .<span class="p">=</span> <span class="k">mod</span>
    <span class="k">let</span> s .<span class="p">=</span> <span class="s1">'%#TabLineFill# '</span>
  <span class="k">endfor</span>
  <span class="k">let</span> s .<span class="p">=</span> <span class="s1">'%#TabLineFill#%T%=%#TabLine#'</span>
  <span class="k">return</span> s
<span class="k">endfunction</span> <span class="c">"}}}</span>
<span class="k">let</span> &amp;<span class="nb">tabline</span> <span class="p">=</span> <span class="s1">'%!'</span>. s:SID_PREFIX<span class="p">()</span> . <span class="s1">'my_tabline()'</span>
<span class="k">set</span> <span class="nb">showtabline</span><span class="p">=</span><span class="m">2</span> <span class="c">" 常にタブラインを表示</span>

<span class="c">" The prefix key.</span>
<span class="nb">nnoremap</span>    [Tag]   <span class="p">&lt;</span>Nop<span class="p">&gt;</span>
nmap    <span class="k">t</span> [Tag]
<span class="c">" Tab jump</span>
<span class="k">for</span> <span class="k">n</span> <span class="k">in</span> range<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">9</span><span class="p">)</span>
  execute <span class="s1">'nnoremap &lt;silent&gt; [Tag]'</span>.<span class="k">n</span>  <span class="s1">':&lt;C-u&gt;tabnext'</span>.<span class="k">n</span>.<span class="s1">'&lt;CR&gt;'</span>
<span class="k">endfor</span>
<span class="c">" t1 で1番左のタブ、t2 で1番左から2番目のタブにジャンプ</span>

map <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> [Tag]<span class="k">c</span> :<span class="k">tablast</span> <span class="p">&lt;</span>bar<span class="p">&gt;</span> <span class="k">tabnew</span><span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="c">" tc 新しいタブを一番右に作る</span>
map <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> [Tag]<span class="k">x</span> :<span class="k">tabclose</span><span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="c">" tx タブを閉じる</span>
map <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> [Tag]<span class="k">n</span> :tabnext<span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="c">" tn 次のタブ</span>
map <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> [Tag]<span class="k">p</span> :<span class="k">tabprevious</span><span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="c">" tp 前のタブ</span>
</pre></div>
</div>

<p>これを.vimrcに書き込むことにより、下のような写真の状態になり、</p>

<p><a href="https://camo.qiitausercontent.com/b15463170dfbcd35f046769ec411f40972fb0c51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f393337332f35653338303635642d326238322d323438632d653966642d6535613632633237306236312e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b15463170dfbcd35f046769ec411f40972fb0c51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f393337332f35653338303635642d326238322d323438632d653966642d6535613632633237306236312e6a706567" alt="vim-tabpage2.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/9373/5e38065d-2b82-248c-e9fd-e5a62c270b61.jpeg"></a></p>

<ul>
<li>
<code>t1</code>, <code>t2</code>,,,<code>t9</code> で左からn番目のタブにジャンプ</li>
<li>
<code>tc</code> で新しいタブ, <code>tx</code>でタブを閉じる</li>
</ul>

<p>でタブページを効率的に使えます。</p>

<p>tに既にコマンドを割り当てている場合は、[Tag]を別にキーに当てはめれば問題なく使えると思います。</p>

<p>P.S.<br>
<a href="http://storys.jp" rel="nofollow noopener" target="_blank">STORYS.JP</a>、 <a href="https://coincheck.jp" rel="nofollow noopener" target="_blank">coincheck</a> などのサービスを運営、開発しています。興味のある方はぜひ <a href="http://qiita.com/wadako111">和田</a>まで連絡を！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>477</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/03bc00d914e62243a511">Rails4ではbackground:url(&quot;assets/hoge.png&quot;)の書き方は動かない話</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-09 01:49:49</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Rails]</b> <b>[capistrano]</b> <b>[rails3]</b> <b>[Rails4]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="rails4のproduction環境でのみ画像が表示されない問題" class="fragment"></span><a href="#rails4%E3%81%AEproduction%E7%92%B0%E5%A2%83%E3%81%A7%E3%81%AE%E3%81%BF%E7%94%BB%E5%83%8F%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>Rails4のproduction環境でのみ、画像が表示されない問題</h1>

<h2>
<span id="問題の概要" class="fragment"></span><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>問題の概要</h2>

<p>先日、弊社サービス <strong><a href="http://storys.jp" rel="nofollow noopener" target="_blank">STORYS.JP</a></strong> をRails3からRails4.0.2にアップデートしました。</p>

<p><strong>Rails4はRails3に比べて、development環境でのページロードにかかる時間が1/10ぐらいになりました。</strong></p>

<p>読み込みに <strong>1500ms</strong> ほどかかっていたのが、Rails4にするだけで本番並みの <strong>150ms</strong> で返ってくるようになり、本当に非常に快適に開発ができるようになりました。</p>

<p>しかし、便利なものには弊害も多く、様々な問題がおきます。</p>

<p>その中でも、解決に苦しんだ問題が、 <strong>これまでは正常に表示されていた画像が、Rails4のproduction環境でのみ表示されない問題</strong> です。</p>

<h2>
<span id="問題の原因" class="fragment"></span><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E5%8E%9F%E5%9B%A0"><i class="fa fa-link"></i></a>問題の原因</h2>

<p>問題の原因は、 <code>app/assets/images</code> 以下に置いてある画像を直接パスを指定して読み込んでいることでした。</p>

<p><a href="http://storys.jp" rel="nofollow noopener" target="_blank">STORYS.JP</a> では基本的に、HTML, SCSSで画像 <code>app/assets/images/hoge.png</code> を参照したいときは次のように書いていました。</p>

<div class="code-frame" data-lang="html+erb">
<div class="code-lang"><span class="bold">hoge.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"/assets/hoge.png"</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-image:url(/assets/hoge.png)"</span> <span class="p">/&gt;</span>
</pre></div>
</div>

<p>SCSSではこんな感じです。</p>

<div class="code-frame" data-lang="scss">
<div class="code-lang"><span class="bold">hoge.css.scss</span></div>
<div class="highlight"><pre><span></span><span class="nc">.hoge</span> <span class="p">{</span>
  <span class="nt">background-image</span><span class="nd">:</span> <span class="nt">url</span><span class="o">(/</span><span class="nt">assets</span><span class="o">/</span><span class="nt">hoge</span><span class="nc">.png</span><span class="o">);</span>
<span class="p">}</span>
</pre></div>
</div>

<p>しかしこの <code>/assets/hoge.png</code> という書き方では、Rails4からは表示されなくなりました。</p>

<h3>
<span id="rails4での-assetsprecompile" class="fragment"></span><a href="#rails4%E3%81%A7%E3%81%AE-assetsprecompile"><i class="fa fa-link"></i></a>Rails4での assets:precompile</h3>

<p>productionにdeployするときに実行する <code>assets:precompile</code> ですが、<br>
Rails4からは <strong>digest無しのjs, css, image は作成しない仕様になりました</strong></p>

<p>digestとはjs, css, 画像等を <code>assets:precompile</code> するとファイル名の後ろにつく文字列のことです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/assets/application-d34a3eba396a045b8c71d1605256e1a2.css
</pre></div></div>

<p>つまり、今までは <code>app/assets/images/hoge.png</code> を <code>assets:precompile</code> したときに得られる成果物は、</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">rails3</span></div>
<div class="highlight"><pre><span></span>public/assets/hoge.png
public/assets/hoge-○○○○.png
</pre></div>
</div>

<p>であったのに対し</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">rails4</span></div>
<div class="highlight"><pre><span></span>public/assets/hoge-○○○○.png
</pre></div>
</div>

<p>となるようになりました。</p>

<p>したがってproduction環境では <code>/assets/hoge.png</code> と指定したファイルを参照することはできません。</p>

<h2>
<span id="解決法1-asset_path関数-image-url関数を使う" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%951-asset_path%E9%96%A2%E6%95%B0-image-url%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>解決法1 asset_path関数, image-url関数を使う</h2>

<p>一番順当な解決法です。画像のパスの指定をそのまま書くのではなく、Railsが提供している関数を呼ぶことで、productionのときにはdigestを勝手に付与してくれます。</p>

<div class="code-frame" data-lang="html+erb">
<div class="code-lang"><span class="bold">hoge.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">asset_path</span> <span class="s2">"hoge.png"</span> <span class="cp">%&gt;</span><span class="s">"</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-image:url(</span><span class="cp">&lt;%=</span> <span class="n">asset_path</span> <span class="s2">"hoge.png"</span> <span class="cp">%&gt;</span><span class="s">)"</span> <span class="p">/&gt;</span>
</pre></div>
</div>

<p>SCSSではこんな感じです。</p>

<div class="code-frame" data-lang="scss">
<div class="code-lang"><span class="bold">hoge.css.scss</span></div>
<div class="highlight"><pre><span></span><span class="nc">.hoge</span> <span class="p">{</span>
  <span class="nt">background-image</span><span class="nd">:</span> <span class="nt">image-url</span><span class="o">(</span><span class="s2">"hoge.png"</span><span class="o">);</span>
<span class="p">}</span>
</pre></div>
</div>

<p><a href="http://guides.rubyonrails.org/asset_pipeline.html#coding-links-to-assets" rel="nofollow noopener" target="_blank">Rails GuideのAsset Pipelineの項</a>にもう少し詳しく載っています。</p>

<h2>
<span id="解決法2-publicassets-以下に画像を直接置く" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%952-publicassets-%E4%BB%A5%E4%B8%8B%E3%81%AB%E7%94%BB%E5%83%8F%E3%82%92%E7%9B%B4%E6%8E%A5%E7%BD%AE%E3%81%8F"><i class="fa fa-link"></i></a>解決法2 public/assets 以下に画像を直接置く</h2>

<p>HTML，SCSSをわざわざRailsの関数を使って書きなおすのはめんどくさい・・・そう考えていた時にあることを思いつきました。</p>

<p>そもそもdigestを付与するのは、あるファイルを更新したときに、ブラウザ側で持っているキャッシュとの相違が無いようにするためのものです。</p>

<p>それはjavascriptやstylesheetならば話はよくわかります。application.jsは良く更新されるので。</p>

<p>しかし、画像ファイルで名前を変更せずに中身を変更することはほとんどありません。そうするならば名前も変更するか、新しいファイルを作るからです。</p>

<p>ならばそもそも <code>app/assets/images</code> 以下はdigestを付与しないオプションは無いのかと思い、調べてみたところ、 <code>assets:precompile</code> を管理している <strong><a href="https://github.com/rails/sprockets-rails#changes-from-rails-3x" rel="nofollow noopener" target="_blank">sprockets-rails</a></strong> に次のような記述がありました。</p>

<blockquote>
<p>Only compiles digest filenames. Static non-digest assets should simply live in public/.</p>
</blockquote>

<p>つまり、コンパイルする必要のないものは、そのままpublic以下に置けと言っています。</p>

<p>確かに、 <code>assets:precompile</code> のそもそもを考えればその通りだと思い、今まで <code>app/assets/images</code> 以下にあったものを <code>public/assets</code> 以下に移動しました。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>cp -r app/assets/images public/assets/
</pre></div></div>

<p>これならば、既存のHTMLやSCSSを書き換える必要すらなく完璧である・・・と思ったのですが、1つ特定の環境において問題が起こりました。</p>

<p>それは <strong>capistranoでのdeploy</strong> です。</p>

<p>ここについては詳しくは調べていませんが、gitの管理下に <code>public/assets</code> を含めていても、deploy時には <code>public/assets</code> 以下は削除されてしまうようです。</p>

<p>したがって、git管理下に <code>public/assets/hoge.png</code> が存在したとしても、deployされた先には <code>public/assets/hoge.png</code> は存在しないので画像は表示されません。</p>

<p>もしかしたらcapistranoは public/assets 以下がgit管理下になることを想定されていないのかもしれません。</p>

<h2>
<span id="解決法3-publicimages-以下に画像を置く" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%953-publicimages-%E4%BB%A5%E4%B8%8B%E3%81%AB%E7%94%BB%E5%83%8F%E3%82%92%E7%BD%AE%E3%81%8F"><i class="fa fa-link"></i></a>解決法3 public/images 以下に画像を置く</h2>

<p>そこで <a href="http://storys.jp" rel="nofollow noopener" target="_blank">STORYS.JP</a> ではこの解決法3を採用しました。</p>

<p>画像は基本的に <code>public/images</code> 以下に置くようにしました。</p>

<div class="code-frame" data-lang="html+erb">
<div class="code-lang"><span class="bold">hoge.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"/images/icons/hoge.png"</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-image:url(/images/icons/hoge.png)"</span> <span class="p">/&gt;</span>
</pre></div>
</div>

<div class="code-frame" data-lang="scss">
<div class="code-lang"><span class="bold">hoge.css.scss</span></div>
<div class="highlight"><pre><span></span><span class="nc">.hoge</span> <span class="p">{</span>
  <span class="nt">background-image</span><span class="nd">:</span> <span class="nt">url</span><span class="o">(/</span><span class="nt">images</span><span class="o">/</span><span class="nt">icons</span><span class="o">/</span><span class="nt">hoge</span><span class="nc">.png</span><span class="o">);</span>
<span class="p">}</span>
</pre></div>
</div>

<p>これの欠点は、既存のファイルを <code>/assets/icons/hoge.png</code> -&gt; <code>/images/icons/hoge.png</code> に書きなおす必要があること、またproduction環境の nginx, apache 等に記述されているであろう /assets/ へのキャッシュのポリシーを /images にも設定しなくてはいけないことです。</p>

<p>しかし、こうすることでproduction環境でも、無事画像が表示でき、capistranoでのdeployも問題ありませんでした。</p>

<p>この解決法3の良い所はもう一つあります。<br>
それは、完全に <code>app/assets/images</code> を使わないことで、間違って <code>/assets/hoge.png</code> の記述をしにくいところです。</p>

<p>解決法1では、development環境で <code>/assets/hoge.png</code> のような記述をしても問題なく表示されます。<br>
<strong>しかし、production環境では動きません</strong></p>

<p>これは結構やっかいで、コードレビュー等をしていたとしても、軽微な違いなだけに気づきにくく、deployしてから表示されないことに気が付きます。</p>

<div class="code-frame" data-lang="html+erb">
<div class="code-lang"><span class="bold">hoge.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"/assets/icons/hoge.png"</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">asset_path</span> <span class="s2">"icons/hoge.png"</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="p">/&gt;</span>
<span class="c">&lt;!-- この違いを見分けるのは結構難しい !&gt;</span>
</pre></div>
</div>

<p>しかし、常に <code>app/assets/images</code> を使わないようにすることで、 <code>&lt;%= asset_path "icons/hoge.png" %&gt;</code> のような記述はできなくなり、問題発見が容易になります。</p>

<p>　</p>

<hr>

<p>　</p>

<p><strong>Rails4のproduction環境でのみ画像が表示されない問題の解決策</strong> は以上になります。</p>

<p>もしこの問題が起きた場合は、自分たちの状況、必要な物に応じて好きな選択肢を選んでください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>390</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/7100c02337f14df07205">&lt;html&gt;,&lt;body&gt;は要らない？Googleが推奨するHTMLファイルの記法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-20 15:57:17</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[HTML]</b> <b>[HTML5]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Googleが公開していた<a href="http://google-styleguide.googlecode.com/svn/trunk/htmlcssguide.xml?showone=Optional_Tags#Optional_Tags" rel="nofollow noopener" target="_blank">Google HTML/CSS Style Guide</a>によると、よく使われる下のようなHTMLのお決まりの記法は非推奨らしい。</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">not_recommended.html</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Spending money, spending bytes<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Sic.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>

<p>これはファイル容量のために下のように書くべき。</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">recommended.html</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Saving money, saving bytes<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Qed.
</pre></div>
</div>

<p>つまり<code>html, head, body</code>などの使い慣れたお決まりのタグは今更書くまでもないということ。</p>

<p>参考: どのようなタグが省略可能か<br>
<a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/syntax.html#syntax-tag-omission" class="autolink" rel="nofollow noopener" target="_blank">http://www.whatwg.org/specs/web-apps/current-work/multipage/syntax.html#syntax-tag-omission</a></p>

<p>P.S.<br>
<a href="http://storys.jp" rel="nofollow noopener" target="_blank">STORYS.JP</a>、 <a href="https://coincheck.jp" rel="nofollow noopener" target="_blank">coincheck</a> などのサービスを運営、開発しています。興味のある方はぜひ <a href="http://qiita.com/wadako111">和田</a>まで連絡を！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>73</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/2a3a78a96384aa2c87a8">gitで打ち間違えた時にも自動で正しいコマンドを予測し実行する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-27 16:41:33</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[GitHub]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>gitで早くコマンドを打っていると、<code>git status</code>と間違えて</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>$ git statsu
git: <span class="s1">'statsu'</span> is not a git command. See <span class="s1">'git --help'</span>.
Did you mean this?
    status
</pre></div></div>

<p>のように <code>git statsu</code>と入力してしまい、打ち直さなければいけなく、めんどくさいなあと皆さん思っていませんか？</p>

<p>そんなときには<code>help.autocorrect</code>をonにするだけで<code>statsu</code>や<code>sttaus</code>のような微妙に間違ったコマンドを、<code>status</code>とちゃんと解釈してくれます。<br>
これのおかげで僕のgit力は1.5倍ぐらいになったので、みなさんも是非使って開発速度を少しでも高めましょう。</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>$ git config --global help.autocorrect <span class="m">1</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>67</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/958dded40a840c35c5ec">Railsで2つ以上の値の組み合わせに対するユニーク制約をかける</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-21 01:28:20</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>例えばLikeの実装で例えば1つの記事に対しては1ユーザー当たり1回しかLikeできないとします。<br>
つまり、(article_id, user_id)の組み合わせはユニークでなくてはなりません。<br>
そういったときのvalidationの書き方は以下のようにかなりシンプルに書くことができます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">like.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Like</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>

  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:uniqueness</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:scope</span> <span class="o">=&gt;</span> <span class="ss">:article_id</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>53</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/54c3dcf6c5fc03b04678">かっこよくredirectかつreturn in rails</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-08 14:31:17</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Railsのコントローラーで、redirectして更にその後の処理をしたくないときはかなりあると思います。<br>
そんなとき僕は今まで</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">users_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
  <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">nil?</span>
    <span class="n">redirect_to</span> <span class="ss">:root</span>
    <span class="k">return</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>と書いていて、ただのチェックの処理に4行も使っているのがすごく不満だったのですが</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">users_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span>
  <span class="k">return</span> <span class="n">redirect_to</span> <span class="ss">:root</span> <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">nil?</span>
<span class="k">end</span>
</pre></div>
</div>

<p>このように<code>return redirect_to ... if ...</code>と書けば一行で、更にかっこ良く書けることに今更ながら気づきました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/81ecf5420a03e681526d">Rails4だとviewのcacheに直接アクセスできない</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-09 21:41:54</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Rails]</b> <b>[rails3]</b> <b>[Rails4]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Rails4ではviewのキャッシュ機構が変わり、何もしなければFragment Cacheに必ずdigestがつくようになりました。</p>

<div class="code-frame" data-lang="html+erb">
<div class="code-lang"><span class="bold">hoge.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;%=</span> <span class="n">cache</span> <span class="s2">"hoge"</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div>
</div>

<p>このような記述をした場合、Rails4より前では</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">hoge.rb</span></div>
<div class="highlight"><pre><span></span><span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"views/hoge"</span><span class="p">)</span>
<span class="c1"># =&gt; "&lt;div&gt;&lt;/div&gt;"</span>
</pre></div>
</div>

<p>このようにキャッシュのキー名に <code>views/</code> をprefixとしてつけることで、Rails.cacheの内容に直接アクセスすることができました。</p>

<p>しかし、Rails4からはerb内で <code>&lt;%= cache "hoge" %&gt;</code> のようにcacheヘルパーを使い、cacheの呼び出し・書き込みをするとdigestが付与されます。</p>

<p>つまり、Rails3までは</p>

<p><code>views/hoge</code></p>

<p>というkeyで保存されていたcacheが</p>

<p><code>views/hoge-○○○○</code></p>

<p>と言った形で、キーのsuffixとして、一見ランダムな文字列が付け足されるようになりました。</p>

<h2>
<span id="何が問題か" class="fragment"></span><a href="#%E4%BD%95%E3%81%8C%E5%95%8F%E9%A1%8C%E3%81%8B"><i class="fa fa-link"></i></a>何が問題か</h2>

<p>これがどう困るのかというと、controller等で</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span></span><span class="n">cached_html</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"views/hoge"</span><span class="p">)</span>
</pre></div></div>

<p>のようなことができなることです。</p>

<h2>
<span id="解決法" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%95"><i class="fa fa-link"></i></a>解決法</h2>

<p>根本的な解決にはなっていませんが、viewで <code>:skip_digest =&gt; true</code> を利用することで、digestを付与しないことができます。</p>

<div class="code-frame" data-lang="html+erb">
<div class="code-lang"><span class="bold">hoge.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;%=</span> <span class="n">cache</span> <span class="s2">"hoge"</span><span class="p">,</span> <span class="ss">:skip_digest</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></div>
</div>

<p>これによって</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span></span><span class="n">cached_html</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"views/hoge"</span><span class="p">)</span>
</pre></div></div>

<p>のように、 <code>Rails.cache</code> を利用して、cacheの中身を取得できます。</p>

<p>　</p>

<hr>

<p>　</p>

<p>また、余談ですが、cacheのkeyにつくsuffixは完全にランダムな文字列ではなく、</p>

<div class="code-frame" data-lang="html+erb"><div class="highlight"><pre><span></span><span class="cp">&lt;%=</span> <span class="n">cache</span> <span class="s2">"hoge"</span> <span class="k">do</span> <span class="cp">%&gt;</span>
  <span class="c">&lt;!-- この部分にsuffixはよって生成される -&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="c"></span>
</pre></div></div>

<p><code>cache</code> ブロックの中身によって生成されています。</p>

<p>なぜならこのdigest機能の目的は、deployやコードの更新によって、 <code>cache</code> ブロック中身が変わった際に、昔のcacheを参照しないためにあるからです。</p>

<p>しかし、ブロックの中身からdigestを取得する方法は、残念ですが分かりませんでした。</p>

<p>また、もしかしたら、cacheのキー名からdigestを取得するRailsのAPIがあるかもしれません。誰か教えてください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/023813c343a3b924b155">Railsの存在演算子で、undefined local variable エラーを簡単に回避する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-29 22:28:18</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[CoffeeScript]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="railsの存在演算子" class="fragment"></span><a href="#rails%E3%81%AE%E5%AD%98%E5%9C%A8%E6%BC%94%E7%AE%97%E5%AD%90"><i class="fa fa-link"></i></a>Railsの存在演算子</h1>

<p>CoffeeScriptでは存在演算子 ? を使うことによって、<br>
null参照した時のエラーを簡単に回避することができます。</p>

<div class="code-frame" data-lang="coffeescript">
<div class="code-lang"><span class="bold">CoffeeScript</span></div>
<div class="highlight"><pre><span></span><span class="nx">hoge</span><span class="p">.</span><span class="nx">foo</span>
<span class="c1"># hoge = undefinedのときエラーが発生</span>
<span class="nx">hoge</span><span class="o">?</span><span class="p">.</span><span class="nx">foo</span> 
<span class="c1"># hoge = {foo: "bar"} のとき "bar"</span>
<span class="c1"># hoge = undefinedのときエラーが起きずに undefined </span>
</pre></div>
</div>

<p>Rails+Coffeescriptで開発していると、なぜRubyにこのような演算子がないのかと思いますが、<br>
実はRailsのActiveSupportの try というメソッドで同じ事ができます。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Ruby</span></div>
<div class="highlight"><pre><span></span>
<span class="n">hoge</span><span class="o">.</span><span class="n">foo</span>
<span class="c1"># hoge = nilのときエラーが発生</span>
<span class="n">hoge</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span>
<span class="c1"># hoge.fooというメソッドが定義されているとき hoge.foo</span>
<span class="c1"># hoge = nilのときエラーが起きずに nil</span>


<span class="n">hoge</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># hoge.foo(3, 4)と同値</span>
<span class="c1"># 2引数目以降に代入された引数はfooメソッドに代入される</span>


<span class="n">hoge</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:[]</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">)</span>
<span class="c1"># hoge["bar"]と同値</span>
<span class="c1"># 結構使うことが多い</span>
</pre></div>
</div>

<p>Railsにおいては実際こんなかんじに使うことが多いです</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Rails</span></div>
<div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">picture</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:url</span><span class="p">)</span> <span class="o">||</span> <span class="s2">"http://デフォルトの画像"</span>
<span class="c1"># ユーザーが画像を持ってるときはそのURL、もしない場合はデフォルトの画像のURL</span>
</pre></div>
</div>

<p>　　</p>

<hr>

<p>tryの実装</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">try</span></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">try</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">empty?</span> <span class="o">&amp;&amp;</span> <span class="nb">block_given?</span>
    <span class="k">yield</span> <span class="nb">self</span>
  <span class="k">else</span>
    <span class="nb">__send__</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>（タイトルで存在演算子と言っていますが、tryはメソッドなので演算子ではありません）</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/c88eeeae13ec25463601">nginx+passenger+spdyをインストールする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-03 09:43:57</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[nginx]</b> <b>[Ubuntu]</b> <b>[passenger]</b> <b>[SPDY]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="ubuntu-1204でnginxpassengerspdyをインストール" class="fragment"></span><a href="#ubuntu-1204%E3%81%A7nginxpassengerspdy%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Ubuntu 12.04でnginx+passenger+spdyをインストール</h1>

<p>既存のnginxが入っている場合は、先にaptitude purgeなどで削除しましょう。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">passenger-nginx-spdy.sh</span></div>
<div class="highlight"><pre><span></span>#!/bin/sh

NGINX_VERSION=1.3.11
TMP_PATH=/tmp

# Fetch and extract Nginx
cd $TMP_PATH
wget http://nginx.org/download/nginx-$NGINX_VERSION.tar.gz
tar xvfz nginx-$NGINX_VERSION.tar.gz
cd nginx-$NGINX_VERSION

# Fetch and apply the Nginx SPDY patch
wget http://nginx.org/patches/spdy/patch.spdy.txt
patch -p1 &lt; patch.spdy.txt

# Install the latest passenger gem
# 必要に応じてrvmsudoをつけましょう
gem install passenger

# Configure passenger (with ubuntu-style paths)
# ここもrvmsudoを必要に応じてつけて下さい
passenger-install-nginx-module \
  --auto \
  --nginx-source-dir=$TMP_PATH/nginx-$NGINX_VERSION \
  --prefix=/usr \
  --extra-configure-flags=" \
    --conf-path=/etc/nginx/nginx.conf \
    --pid-path=/var/run/nginx.pid \
    --sbin-path=/usr/sbin \
    --error-log-path=/var/log/nginx/error.log \
    --http-log-path=/var/log/nginx/access.log \
    --with-http_spdy_module"

# Cleanup
sudo rm -r $TMP_PATH/nginx-$NGINX_VERSION
rm $TMP_PATH/nginx-$NGINX_VERSION.tar.gz
</pre></div>
</div>

<p>これでnginxをインストールし、<br>
<a href="http://nginx.org/patches/spdy/README.txt" class="autolink" rel="nofollow noopener" target="_blank">http://nginx.org/patches/spdy/README.txt</a><br>
にあるようにnginx.confで</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/nginx/nginx.conf</span></div>
<div class="highlight"><pre><span></span>  server {
      listen 443 ssl spdy default_server;
      ssl_certificate      server.crt;
      ssl_certificate_key  server.key;
  }
</pre></div>
</div>

<p>のような記述を書き足せば利用できます。<br>
SPDYはSSL必須なので、適当にSSL証明書を作り/etc/nginx/sslとかにでも入れておきましょう。</p>

<p>ちゃんとSPDYで通信できているか確認するには、chromeで<br>
<a href="https://chrome.google.com/webstore/detail/spdy-indicator/mpbpobfflnpcgagjijhmgnchggcjblin" rel="nofollow noopener" target="_blank">SPDY Indicator</a><br>
をインストールし、httpsでアクセスし、緑色のアイコンになることをチェックしましょう。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>wadako111さんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/wadako111/items/c318b80fe2e0d5dfb47a">Rails4のexception_notificationでsessionの情報が表示されない</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-10 13:22:10</center>
	</td>
	<td style="width:200px;">
		@wadako111<br />(レジュプレス株式会社 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/9373/profile-images/1473757082">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Rails]</b> <b>[Rails4]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="rails4では-exceptionnotification-が-session-情報を表示しない" class="fragment"></span><a href="#rails4%E3%81%A7%E3%81%AF-exceptionnotification-%E3%81%8C-session-%E6%83%85%E5%A0%B1%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%97%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>Rails4では ExceptionNotification が session 情報を表示しない</h1>

<p>エラーが起きた時にメールを飛ばしてくれる <a href="https://github.com/smartinez87/exception_notification" rel="nofollow noopener" target="_blank">ExceptionNotification</a> ですが、Rails4ではsessionの情報をちゃんと表示してくれません。（2014/01/09時点、version 4.0.1）</p>

<p>エラーメールのSessionの欄は下のようになっており、dataがうまく表示されていません。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>-------------------------------
Session:
-------------------------------

 * session id: "abcdef123456789..."
 * data: #&lt;ActionDispatch::Request::Session:0x007fc38b0f5fe0 ...&gt;
　
</pre></div></div>

<h1>
<span id="解決法" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%95"><i class="fa fa-link"></i></a>解決法</h1>

<p>これは <a href="https://github.com/smartinez87/exception_notification/pull/192" rel="nofollow noopener" target="_blank">2013/12/9 の Pull Request</a> で修正されていますが、versionは変わらず、4.0.1 のままなので、 <code>Gemfile</code> ではgithubのレポジトリを指定する必要があります。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s1">'exception_notification'</span><span class="p">,</span> <span class="s2">"~&gt; 4.0.1"</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s2">"https://github.com/smartinez87/exception_notification"</span><span class="p">,</span> <span class="ss">:branch</span> <span class="o">=&gt;</span> <span class="s2">"master"</span>
</pre></div>
</div>

<p>これで表示されるはずです。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
