<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (y_uuki)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (y_uuki さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>y_uukiさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>677</kbd>
		<a target="_blank" href="https://qiita.com/y_uuki/items/dd4fce78b1bc32b64600">パフォーマンス監視サービスのNew Relicが超便利な件</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-09-01 14:04:49</center>
	</td>
	<td style="width:200px;">
		@y_uuki<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/80/profile-images/1473683854">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Rails]</b> <b>[Heroku]</b> <b>[AdventCalendar]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote>
<p>12/09/05 監視対象のWebサービスのURLを間違えていたため修正しました</p>
</blockquote>

<p>RailsのAdvent Calendarを待ちわびていました．<br>
今回は，<a href="http://gihyo.jp/magazine/wdpress/archive/2012/vol70" rel="nofollow noopener" target="_blank">WEB+DBの最新号</a>のRails高速化記事で紹介されていたパフォーマンス監視サービスのNew Relicを使ってみた話です．</p>

<p><a href="http://newrelic.com/" rel="nofollow noopener" target="_blank">New Relic</a>は．newrelic_rpmというgemをインストールすることにより，レスポンスタイムやスロークエリなど，パフォーマンスに関するさまざまな統計情報をNew Relicのサイトでみることができます．</p>

<p>Railsに限らずPythonやJavaなどいろいろな言語に対応しているようです．<br>
さらに，HerokuやDotCloudなどのPaaSにも対応していてやばい．</p>

<h2>
<span id="herokuのnew-relicプラグイン" class="fragment"></span><a href="#heroku%E3%81%AEnew-relic%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>HerokuのNew Relicプラグイン</h2>

<p>Herokuにホストしたアプリケーションを監視するためには<a href="https://addons.heroku.com/newrelic" rel="nofollow noopener" target="_blank">New Relicプラグイン</a>を導入する必要があります．<br>
導入の手順はこちら(<a href="https://devcenter.heroku.com/articles/newrelic" class="autolink" rel="nofollow noopener" target="_blank">https://devcenter.heroku.com/articles/newrelic</a>)</p>

<p>New Relicプラグインには無料版と有料版があり，有料版のほうがデータの保存期間が長かったり，発行されたSQL文やEXPLAINの出力が見れたりするようです．<br>
個人的には無料版で十分でした．</p>

<p>以下では7月に公開した<a href="http://daily-coding.herokuapp.com" rel="nofollow noopener" target="_blank">DailyCoding</a>というサービスを監視対象としています．</p>

<h3>
<span id="dailycodingの環境" class="fragment"></span><a href="#dailycoding%E3%81%AE%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>DailyCodingの環境</h3>

<ul>
<li>Rails 3.2.8</li>
<li>Unicorn</li>
<li>Heroku（無料）</li>
<li>100PV/日（弱小）</li>
<li>1テーブルのエントリ数はせいぜい数百個（弱小）</li>
</ul>

<p>では，New Relicの主要なグラフを順番にみていきます．</p>

<h2>
<span id="ブラウザのページロード時間の内訳" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%83%AD%E3%83%BC%E3%83%89%E6%99%82%E9%96%93%E3%81%AE%E5%86%85%E8%A8%B3"><i class="fa fa-link"></i></a>ブラウザのページロード時間の内訳</h2>

<p><a href="https://camo.qiitausercontent.com/d19a1b0f9ece9ae95fdf86bcb000ef4c3dacdbcf/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f795f75756b692f32303132303833312f32303132303833313138313531345f6f726967696e616c2e706e673f31333436343035303031" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d19a1b0f9ece9ae95fdf86bcb000ef4c3dacdbcf/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f795f75756b692f32303132303833312f32303132303833313138313531345f6f726967696e616c2e706e673f31333436343035303031" alt="ブラウザ" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/y_uuki/20120831/20120831181514_original.png?1346405001"></a></p>

<p>ブラウザのページロード時間 = Webアプリケーション処理時間 + ブラウザ-Webアプリケーションサーバ間のネットワーク時間<br>
   + ブラウザのDOMの構築時間 + ブラウザのページレンダリング時間<br>
となります．<br>
明らかに通信時間がボトルネックであることがわかります．(DOM構築時間もそこそこ時間かかってる)<br>
Herokuの東京リージョンまだー</p>

<h2>
<span id="webアプリケーションのレスポンスタイム内訳" class="fragment"></span><a href="#web%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%A0%E5%86%85%E8%A8%B3"><i class="fa fa-link"></i></a>Webアプリケーションのレスポンスタイム内訳</h2>

<p><a href="https://camo.qiitausercontent.com/b784f84587febd710ffb6444f48d3b823d9e9055/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f795f75756b692f32303132303833312f32303132303833313138313531325f6f726967696e616c2e706e673f31333436343034373435" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b784f84587febd710ffb6444f48d3b823d9e9055/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f795f75756b692f32303132303833312f32303132303833313138313531325f6f726967696e616c2e706e673f31333436343034373435" alt="APサーバ" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/y_uuki/20120831/20120831181512_original.png?1346404745"></a></p>

<p>Ruby(Railsによるルーティング処理とかコントローラの処理とか)，DBおよびWeb External（外部サイトへのリクエスト時間）などの処理時間の合計がWebアプリケーションとしてのレスポンスタイムとなります．<br>
DBの処理時間が支配的なことがわかります．</p>

<h2>
<span id="dbのレスポンスタイム内訳" class="fragment"></span><a href="#db%E3%81%AE%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%A0%E5%86%85%E8%A8%B3"><i class="fa fa-link"></i></a>DBのレスポンスタイム内訳</h2>

<p>下の図はActiveRecordのクエリごとのレスポンスタイムを示しています．(正確には縦軸はレスポンスタイムではなく，トータルのDB時間のうちの当該クエリのレスポンスタイムの割合．多分，グラフをカスタムすれば縦軸をレスポンスタイムにできる？）</p>

<p><a href="https://camo.qiitausercontent.com/9a32beabc16b36361f6970a35fa03851747603bf/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f795f75756b692f32303132303833312f32303132303833313138333134335f6f726967696e616c2e706e673f31333436343035353136" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9a32beabc16b36361f6970a35fa03851747603bf/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f795f75756b692f32303132303833312f32303132303833313138333134335f6f726967696e616c2e706e673f31333436343035353136" alt="DB" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/y_uuki/20120831/20120831183143_original.png?1346405516"></a></p>

<h2>
<span id="railsのコントローラのレスポンスタイム内訳" class="fragment"></span><a href="#rails%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AE%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%A0%E5%86%85%E8%A8%B3"><i class="fa fa-link"></i></a>Railsのコントローラのレスポンスタイム内訳</h2>

<p><a href="https://camo.qiitausercontent.com/5f64bca24d65272704142825bae2ca1fb853b6e8/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f795f75756b692f32303132303833312f32303132303833313138313531335f6f726967696e616c2e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5f64bca24d65272704142825bae2ca1fb853b6e8/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f795f75756b692f32303132303833312f32303132303833313138313531335f6f726967696e616c2e706e67" alt="コントローラ" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/y_uuki/20120831/20120831181513_original.png"></a></p>

<h2>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h2>

<ul>
<li>他にもいろいろなデータ</li>
<li>各グラフのうち，自分に必要なものだけを選んで一覧できる機能</li>
<li>パフォーマンスだけでなくサーバエラーの監視</li>
<li>週ごとのサマリーやアラートのメールによる通知</li>
<li>データを日単位もしくは週単位で比較</li>
<li>把握できていない機能が他にもいろいろありそう．</li>
</ul>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>New Relicのおかげでボトルネックがネットワーク時間であることがわかりました．<br>
このボトルネックを排除するためには，転送するファイルの数およびサイズを減らす必要がありそうです，<br>
なるべくブラウザ側でコンテンツをキャッシュさせたり，ファイルを圧縮したり...<br>
アプリケーション側でキャッシュするとかSQLクエリの発行回数を減らすとかしてもあんまり意味なかったんや．</p>

<p>というわけでNew Relic便利！</p>

<p>明日の担当は<a href="http://qiita.com/users/puriketu99">@puriketu99</a>さんです．<br>
よろしくおねがいします．</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
