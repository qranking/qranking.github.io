<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (ryurock)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (ryurock さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>814</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/1432578d364985f6cb06">みんなhomebrew-caskって知ってるか？</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-29 10:57:00</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[OSX]</b> <b>[homebrew]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>複数人数で開発を行っている場合、新しい人が参加した時にこのアプリだけは入れておいてね！！ってことはありますよね？<br>
大体の場合はwikiとかにさらっと</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#事前にインストールするもの
hoge
</pre></div></div>

<p>みたいなこと書かれてると思いますが<br>
これがいっぱいあると</p>

<h1>
<span id="ダルいしメンテナンスかったるい" class="fragment"></span><a href="#%E3%83%80%E3%83%AB%E3%81%84%E3%81%97%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%8B%E3%81%A3%E3%81%9F%E3%82%8B%E3%81%84"><i class="fa fa-link"></i></a>ダルいしメンテナンスかったるい。。。</h1>

<p>のでosxで一般的になってる<a href="http://brew.sh/" rel="nofollow noopener" target="_blank">homebrew</a>の拡張<a href="https://github.com/phinze/homebrew-cask" rel="nofollow noopener" target="_blank">homebrew-cask</a>を使用して<br>
コマンド一発で開発に必要なアプリインストールできるよ！！ってできることがわかったのでメモ</p>

<p><a href="http://qiita.com/futoase/items/9a52ddd8bb19863372d0" id="reference-3449b4621f1f5f1761a8">homebrewのパッケージをGemfileみたく管理したい -&gt; brewdlerがあった…</a>で存在を知ったので感謝感謝</p>

<p>※brewdlerは今<a href="https://github.com/Homebrew/homebrew-bundle" rel="nofollow noopener" target="_blank">Homebrew/homebrew-bundle</a>になっています</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://qiita.com/futoase/items/9a52ddd8bb19863372d0">homebrewのパッケージをGemfileみたく管理したい -&gt; brewdlerがあった…</a></li>
<li><a href="https://github.com/phinze/homebrew-cask" rel="nofollow noopener" target="_blank">homebrew-cask</a></li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>
<a href="http://brew.sh/" rel="nofollow noopener" target="_blank">homebrew</a> ※入れていない方は何も考えずに<code>/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</code>と打とう</li>
</ul>

<h2>
<span id="インストール手順" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>インストール手順</h2>

<p>本家のままですぐ使えます(ターミナル開いて打ってね)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install caskroom/cask/brew-cask
</pre></div></div>

<h3>
<span id="使いたいアプリを探す" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E6%8E%A2%E3%81%99"><i class="fa fa-link"></i></a>使いたいアプリを探す</h3>

<p>下記のコマンドで探せます</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew cask search

caffeine   wireshark   google-chrome    mysql-workbench    virtualbox
….
….
</pre></div></div>

<h3>
<span id="homebrew-caskでインストールしたアプリ一覧を見る" class="fragment"></span><a href="#homebrew-cask%E3%81%A7%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E4%B8%80%E8%A6%A7%E3%82%92%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>homebrew-caskでインストールしたアプリ一覧を見る</h3>

<p>パッケージ名を引数で指定するとパッケージの詳細な情報が出ます</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew list
ansible     chrome-cli  libyaml     openssl     wget
autoconf    curl        nkf     pkg-config
brew-cask   git     nmap        pyenv
</pre></div></div>

<h3>
<span id="caskでインストールする" class="fragment"></span><a href="#cask%E3%81%A7%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Caskでインストールする</h3>

<p>コマンド一発です</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew cask install google-chrome
</pre></div></div>

<p>簡単ですね！！！</p>

<h3>
<span id="brew-caskのインストールディレクトリについて" class="fragment"></span><a href="#brew-cask%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>brew-caskのインストールディレクトリについて</h3>

<p>brew-caskでインストールしたアプリはデフォルトだと</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>~/Applications
</pre></div></div>

<p>にはいります。<br>
これだとLaunchpadでインストールしたアプリがでてきません。<br>
そんなときは <code>.zshrc</code> もしくは <code>.bashrc</code> に下記を記載するとインストール先ディレクトリを変更できます。</p>

<div class="code-frame" data-lang="zshrc"><div class="highlight"><pre><span></span>export HOMEBREW_CASK_OPTS="--appdir=/Applications"
</pre></div></div>

<h3>
<span id="brew-caskのアプリの管理方法について" class="fragment"></span><a href="#brew-cask%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>brew-caskのアプリの管理方法について</h3>

<p><a href="https://github.com/Homebrew/homebrew-bundle" rel="nofollow noopener" target="_blank">homebrew/homebrew-bundle</a>を使ってGemfileみたいに管理することができます。</p>

<p>以下homebrew-bundleのインストール方法<br>
(公式ほぼ引用です)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># brewにbundleコマンドが使えるようにする
brew tap Homebrew/bundle
# homebrewのGemfileみたいなファイルを作る
touch Brewfile
</pre></div></div>

<p>以下Brewfileサンプル</p>

<div class="code-frame" data-lang="Brewfile"><div class="highlight"><pre><span></span>cask_args appdir: '/Applications'
tap 'caskroom/cask'
tap 'telemachus/brew', 'https://telemachus@bitbucket.org/telemachus/brew.git'
brew 'emacs', args: ['with-cocoa', 'with-gnutls']
brew 'redis', restart_service: true
brew 'mongodb'
brew 'sphinx'
brew 'imagemagick'
brew 'mysql'
cask 'google-chrome'
cask 'java' unless system '/usr/libexec/java_home --failfast'
cask 'firefox', args: { appdir: '/Applications' }
</pre></div></div>

<h3>
<span id="補足使いたいアプリがない場合" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%82%A2%E3%83%97%E3%83%AA%E3%81%8C%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>【補足】使いたいアプリがない場合</h3>

<p>公式の<a href="https://github.com/caskroom/homebrew-cask/blob/master/CONTRIBUTING.md#adding-a-cask" rel="nofollow noopener" target="_blank">ココ</a>にcaskの追加方法が記載されています。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>441</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/9c6de36b9d6a716e7992">なんかかっこいいプレゼンテーションテンプレートを探しているならreveal.js使ってみろって</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-24 08:26:08</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[HTML5]</b> <b>[CSS3]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ちょうどいくつかプレゼン用の資料を作らなきゃと思っていてなんかいいテンプレートないかな〜って探していたらので<a href="https://github.com/hakimel/reveal.js" rel="nofollow noopener" target="_blank">reveal.js</a>が超絶に良かったのでメモ</p>

<p><a href="https://github.com/hakimel/reveal.js" rel="nofollow noopener" target="_blank">reveal.js</a></p>

<p>htmlで綺麗でカッコいいプレゼンテーションを作れるフレームワークです。</p>

<h2>
<span id="3dでグィングィン動きます" class="fragment"></span><a href="#3d%E3%81%A7%E3%82%B0%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%A3%E3%83%B3%E5%8B%95%E3%81%8D%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>3Dでグィングィン動きます</h2>

<p><a href="http://lab.hakim.se/reveal-js/#/" rel="nofollow noopener" target="_blank">デモ画面</a>見ればどんな風にグィングィン動くかわかります（開いたら右スクロールボタンを押してみてください）</p>

<h2>
<span id="escキー押すとプレゼンテーションのドキュメント一覧が見れます" class="fragment"></span><a href="#esc%E3%82%AD%E3%83%BC%E6%8A%BC%E3%81%99%E3%81%A8%E3%83%97%E3%83%AC%E3%82%BC%E3%83%B3%E3%83%86%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E4%B8%80%E8%A6%A7%E3%81%8C%E8%A6%8B%E3%82%8C%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>Escキー押すとプレゼンテーションのドキュメント一覧が見れます</h2>

<p>それがまたカッコよく3Dでみれます。</p>

<h2>
<span id="pdfへのエキスポートが楽チンです" class="fragment"></span><a href="#pdf%E3%81%B8%E3%81%AE%E3%82%A8%E3%82%AD%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E3%81%8C%E6%A5%BD%E3%83%81%E3%83%B3%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>PDFへのエキスポートが楽チンです</h2>

<p>書いたドキュメントをプリントしてメンバーに配布とかってシーンがあるとおもいますが<br>
reveal.jsなら綺麗にできます。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<h3>
<span id="zipパッケージで落としてくる" class="fragment"></span><a href="#zip%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%A7%E8%90%BD%E3%81%A8%E3%81%97%E3%81%A6%E3%81%8F%E3%82%8B"><i class="fa fa-link"></i></a>zipパッケージで落としてくる</h3>

<p><a href="https://github.com/hakimel/reveal.js" rel="nofollow noopener" target="_blank">hakimel/reveal.js</a>にいって<br>
「Download ZIP」をポチッと押します。</p>

<h3>
<span id="書きたい内容をindexhtmlで編集" class="fragment"></span><a href="#%E6%9B%B8%E3%81%8D%E3%81%9F%E3%81%84%E5%86%85%E5%AE%B9%E3%82%92indexhtml%E3%81%A7%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>書きたい内容をindex.htmlで編集</h3>

<p>コレだけです。</p>

<h2>
<span id="プレゼン内容の書き方" class="fragment"></span><a href="#%E3%83%97%E3%83%AC%E3%82%BC%E3%83%B3%E5%86%85%E5%AE%B9%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-link"></i></a>プレゼン内容の書き方</h2>

<h3>
<span id="htmlでゴリゴリ書きたい場合" class="fragment"></span><a href="#html%E3%81%A7%E3%82%B4%E3%83%AA%E3%82%B4%E3%83%AA%E6%9B%B8%E3%81%8D%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>HTMLでゴリゴリ書きたい場合</h3>

<p>プレゼン内容は <code>&lt;div class="slides"&gt;</code> 以下に <code>&lt;section&gt;</code>区切りで一枚のページになります。(右スクロールを押すたびに次のページに移動する)</p>

<h3>
<span id="markdowon形式でゴリゴリ書きたい場合" class="fragment"></span><a href="#markdowon%E5%BD%A2%E5%BC%8F%E3%81%A7%E3%82%B4%E3%83%AA%E3%82%B4%E3%83%AA%E6%9B%B8%E3%81%8D%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>markdowon形式でゴリゴリ書きたい場合</h3>

<p>公式にも説明がありますがこんな感じで</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">index.html</span></div>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">section</span> <span class="na">data-markdown</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/template"</span><span class="p">&gt;</span>
        <span class="err">##</span> <span class="nx">Page</span> <span class="nx">title</span>

        <span class="nx">A</span> <span class="nx">paragraph</span> <span class="kd">with</span> <span class="nx">some</span> <span class="nx">text</span> <span class="nx">and</span> <span class="nx">a</span> <span class="p">[</span><span class="nx">link</span><span class="p">](</span><span class="nx">http</span><span class="o">:</span><span class="c1">//hakim.se).</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</pre></div>
</div>

<h3>
<span id="下スクロールでのページを作成したい場合" class="fragment"></span><a href="#%E4%B8%8B%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB%E3%81%A7%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>下スクロールでのページを作成したい場合</h3>

<p><code>&lt;section&gt;</code>をネストさせましょう</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">index.html</span></div>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">section</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">section</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span> 題名
    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</pre></div>
</div>

<p>コレで下スクロールのページが作れます</p>

<h2>
<span id="pdfに変換する方法" class="fragment"></span><a href="#pdf%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>PDFに変換する方法</h2>

<p>以下がやり方(MAC)</p>

<ul>
<li>1. chromeで開きます</li>
<li>2. URLにindex.html?print-pdfを付与します</li>
<li>3. comannd + p　で印刷画面を表示させます</li>
<li>4. 「レイアウト」を横にして「pdfにして保存」を選びます</li>
</ul>

<p>他にも色々オプションがあるのでgithubのドキュメントを読んでみてください</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>317</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/28690f2b1553601d684d">PackerでVagrant用のBoxを作成したときのメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-28 02:04:36</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[CentOS]</b> <b>[OSX]</b> <b>[chef]</b> <b>[VirtualBox]</b> <b>[packer]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>気がついたら<a href="http://tsuchikazu.net/chef_solo_start/" rel="nofollow noopener" target="_blank">Chef</a>やら<a href="http://gihyo.jp/admin/serial/01/puppet" rel="nofollow noopener" target="_blank">Puppet</a>やら<a href="http://apatheia.info/blog/2013/04/06/about-ansible/" rel="nofollow noopener" target="_blank">Ansible</a>は<a href="http://www.atmarkit.co.jp/ait/articles/1307/02/news002.html" rel="nofollow noopener" target="_blank">DevOps</a>と呼ばれるようになったんですね。<br>
時代のちょっと先端に行ったと思ったらまた取り残されてる感じがなんともこの業界ならではかと。</p>

<p>で、話は変わって前から<a href="http://www.vagrantup.com/" rel="nofollow noopener" target="_blank">Vagrant</a>のbaseBoxをゼロから作りたいぞ！！このヤロー！！って思っていたら<br>
<a href="http://www.packer.io/" rel="nofollow noopener" target="_blank">Packer</a>というVagrantの作者が仮想イメージを作るツールを出していたので作って見た時のメモ</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="作る仮想インスタンスのos" class="fragment"></span><a href="#%E4%BD%9C%E3%82%8B%E4%BB%AE%E6%83%B3%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AEos"><i class="fa fa-link"></i></a>作る仮想インスタンスのOS</h2>

<ul>
<li>CentOS6.4-x86_64_minimal</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>
<a href="http://brew.sh/index_ja.html" rel="nofollow noopener" target="_blank">homebrew</a> ※入れていない方は何も考えずに<code>ruby -e "$(curl -fsSL https://raw.github.com/mxcl/homebrew/go)"</code>と打とう</li>
<li>
<a href="https://www.virtualbox.org/" rel="nofollow noopener" target="_blank">virtualbox</a> ※入れていない方は<a href="http://qiita.com/ryurock/items/31029ea9ac3fcb34abdc" id="reference-1717557e756393195ac0">そうだvirtualboxを使ってみよう</a>からvirtualboxの入手だけを試してください</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://www.ryuzee.com/contents/blog/6706" rel="nofollow noopener" target="_blank">[続報]PackerでVagrant用のBoxを作成する</a></li>
<li><a href="http://qiita.com/hnakamur/items/da0ed14192a18405f704" id="reference-601e803099db02237334">OSXでpackerでCentOS6.4のVirtualBox VMを作成する</a></li>
</ul>

<h2>
<span id="とりあえずpackerを試したい方はこちら" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9Apacker%E3%82%92%E8%A9%A6%E3%81%97%E3%81%9F%E3%81%84%E6%96%B9%E3%81%AF%E3%81%93%E3%81%A1%E3%82%89"><i class="fa fa-link"></i></a>とりあえずPackerを試したい方はこちら</h2>

<ul>
<li><a href="http://qiita.com/ryurock/items/e3635221e4717f2addfe" id="reference-86fd7456dc0a7a3f92ce">Packerをつかって3ステップでVagrantのBoxを作る</a></li>
</ul>

<h2>
<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h2>

<p><a href="https://github.com/ryurock/versicolor/tree/a2f83daedf9d30b6faa2c83c7536700b9dc6be29" rel="nofollow noopener" target="_blank">ryurock/versicolor</a></p>

<h2>
<span id="packerのインストール" class="fragment"></span><a href="#packer%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Packerのインストール</h2>

<p>OSXで試したので他のOSは本家の説明に譲ります<br>
<a href="http://www.packer.io/intro/getting-started/setup.html" rel="nofollow noopener" target="_blank">INSTALL PACKER</a></p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>brew tap homebrew/binary
brew install packer
</pre></div></div>

<h2>
<span id="packerの実行ファイルを作成する" class="fragment"></span><a href="#packer%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Packerの実行ファイルを作成する</h2>

<h3>
<span id="注意-packer14以前と以降で設定方法が変わりました" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F-packer14%E4%BB%A5%E5%89%8D%E3%81%A8%E4%BB%A5%E9%99%8D%E3%81%A7%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95%E3%81%8C%E5%A4%89%E3%82%8F%E3%82%8A%E3%81%BE%E3%81%97%E3%81%9F"><i class="fa fa-link"></i></a>【注意】 packer1.4以前と以降で設定方法が変わりました。</h3>

<p>各項目のtypeは</p>

<ul>
<li>Packer1.4以前は<code>virtualbox</code>
</li>
<li>Packer1.4以降は<code>virtualbox-iso</code>
</li>
</ul>

<p>になります。</p>

<p>適当なファイル名.jsonでもいいみたいです</p>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">packer.json</span></div>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"builders"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"virtualbox-iso"</span><span class="p">,</span>
      <span class="nt">"vm_name"</span><span class="p">:</span> <span class="s2">"box"</span><span class="p">,</span>
      <span class="nt">"boot_wait"</span><span class="p">:</span> <span class="s2">"10s"</span><span class="p">,</span>
      <span class="nt">"disk_size"</span><span class="p">:</span> <span class="mi">512000</span><span class="p">,</span>
      <span class="nt">"guest_os_type"</span><span class="p">:</span> <span class="s2">"RedHat_64"</span><span class="p">,</span>
      <span class="nt">"iso_checksum"</span><span class="p">:</span> <span class="s2">"4a5fa01c81cc300f4729136e28ebe600"</span><span class="p">,</span>
      <span class="nt">"iso_checksum_type"</span><span class="p">:</span> <span class="s2">"md5"</span><span class="p">,</span>
      <span class="nt">"iso_url"</span><span class="p">:</span> <span class="s2">"http://ftp.iij.ad.jp/pub/linux/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-minimal.iso"</span><span class="p">,</span>
      <span class="nt">"ssh_username"</span><span class="p">:</span> <span class="s2">"vagrant"</span><span class="p">,</span>
      <span class="nt">"ssh_password"</span><span class="p">:</span> <span class="s2">"vagrant"</span><span class="p">,</span>
      <span class="nt">"ssh_port"</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
      <span class="nt">"ssh_wait_timeout"</span><span class="p">:</span> <span class="s2">"10000s"</span><span class="p">,</span>
      <span class="nt">"shutdown_command"</span><span class="p">:</span> <span class="s2">"echo '/sbin/halt -h -p' &gt; shutdown.sh; echo 'vagrant'|sudo -S sh 'shutdown.sh'"</span><span class="p">,</span>
      <span class="nt">"guest_additions_path"</span><span class="p">:</span> <span class="s2">"VBoxGuestAdditions_{{.Version}}.iso"</span><span class="p">,</span>
      <span class="nt">"virtualbox_version_file"</span><span class="p">:</span> <span class="s2">".vbox_version"</span><span class="p">,</span>
      <span class="nt">"vboxmanage"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="s2">"modifyvm"</span><span class="p">,</span>
          <span class="s2">"{{.Name}}"</span><span class="p">,</span>
          <span class="s2">"--memory"</span><span class="p">,</span>
          <span class="s2">"2048"</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s2">"modifyvm"</span><span class="p">,</span>
          <span class="s2">"{{.Name}}"</span><span class="p">,</span>
          <span class="s2">"--cpus"</span><span class="p">,</span>
          <span class="s2">"2"</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="nt">"http_directory"</span><span class="p">:</span> <span class="s2">"./packer/builders/"</span><span class="p">,</span>
      <span class="nt">"boot_command"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"&lt;tab&gt; text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks.cfg&lt;enter&gt;&lt;wait&gt;"</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"provisioners"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"shell"</span><span class="p">,</span>
      <span class="nt">"scripts"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"packer/provisioners/base.sh"</span><span class="p">,</span>
        <span class="s2">"packer/provisioners/vagrant.sh"</span><span class="p">,</span>
        <span class="s2">"packer/provisioners/virtualbox.sh"</span><span class="p">,</span>
        <span class="s2">"packer/provisioners/cleanup.sh"</span>
      <span class="p">],</span>
      <span class="nt">"override"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"virtualbox-iso"</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">"execute_command"</span><span class="p">:</span> <span class="s2">"echo 'vagrant'|sudo -S sh '{{.Path}}'"</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">"post-processors"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"vagrant"</span><span class="p">,</span>
      <span class="nt">"output"</span><span class="p">:</span> <span class="s2">"./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>

<p>何が書いてあるのかわからないとおもうので説明していきます</p>

<h3>
<span id="builders" class="fragment"></span><a href="#builders"><i class="fa fa-link"></i></a>builders</h3>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">packer.json（一部抜粋）</span></div>
<div class="highlight"><pre><span></span>  "builders": [
    {
      "type": "virtualbox-iso",
      "vm_name": "CentOS6.4-x86_minimal",
             .
             .
             .
    }
  ]
</pre></div>
</div>

<p>これは作る仮想インスタンスの設定を記載します。</p>

<table>
<thead>
<tr>
<th style="text-align: left">項目名</th>
<th style="text-align: right">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">type</td>
<td style="text-align: right">何の仮想インスタンスを作成するかを指定する項目ですAWSのインスタンスとかも指定可能。今回はvirtualboxなので 「virtualbox-iso」を記載</td>
</tr>
<tr>
<td style="text-align: left">vm_name</td>
<td style="text-align: right">デフォルトのvm名になりますVagrantでもオーバーライドできるの記載しなくても問題ない</td>
</tr>
<tr>
<td style="text-align: left">boot_wait</td>
<td style="text-align: right">最初にVirtualboxが起動bootするまでの待ち時間</td>
</tr>
<tr>
<td style="text-align: left">disk_size</td>
<td style="text-align: right">Virtualboxのディスク容量の指定適当に多めで</td>
</tr>
<tr>
<td style="text-align: left">guest_os_type</td>
<td style="text-align: right">CentOSx86系なら「RedHat_64」を指定。typeの一覧は<code>VBoxManage list ostypes</code> でわかる</td>
</tr>
<tr>
<td style="text-align: left">iso_checksum</td>
<td style="text-align: right">isoのchecksum。わからない場合は<code>md5 作るOS.iso</code>と叩けばわかる</td>
</tr>
<tr>
<td style="text-align: left">iso_url</td>
<td style="text-align: right">isoのDL先のURL。何故かHTTPしかサポートしていなかった</td>
</tr>
<tr>
<td style="text-align: left">ssh_username</td>
<td style="text-align: right">sshユーザー名。vagrantと連携したいならユーザー名はvagrantにしといたほうが楽かも</td>
</tr>
<tr>
<td style="text-align: left">ssh_password</td>
<td style="text-align: right">sshユーザーのパスワード</td>
</tr>
<tr>
<td style="text-align: left">ssh_port</td>
<td style="text-align: right">何も考えずに22でいいでしょう</td>
</tr>
<tr>
<td style="text-align: left">ssh_wait_timeout</td>
<td style="text-align: right">SSHの接続時間</td>
</tr>
<tr>
<td style="text-align: left">shutdown_command</td>
<td style="text-align: right">シャットダウンコマンド</td>
</tr>
<tr>
<td style="text-align: left">guest_additions_path</td>
<td style="text-align: right">Virtualboxのguest_additionsのパス</td>
</tr>
<tr>
<td style="text-align: left">virtualbox_version_file</td>
<td style="text-align: right">VirtualBoxのバージョン番号なんでしょう</td>
</tr>
<tr>
<td style="text-align: left">vboxmanage</td>
<td style="text-align: right">Virtualboxのインスタンスの設定。今回はメモリを2G、CPUCore数を2としている</td>
</tr>
<tr>
<td style="text-align: left">http_directory</td>
<td style="text-align: right">インストール時にローカルにWebサーバをたててkickstartなどの設定情報を持っていくための設定です。kickstartって何？って方は<a href="http://wg.drive.ne.jp/miura/archives/2208" rel="nofollow noopener" target="_blank">kickstartでCentOS6の自動インストール</a>をみてください</td>
</tr>
<tr>
<td style="text-align: left">boot_command</td>
<td style="text-align: right">boot時のkickstartを実行するときのks.cfgの場所を指定する</td>
</tr>
</tbody>
</table>

<h3>
<span id="post-processors" class="fragment"></span><a href="#post-processors"><i class="fa fa-link"></i></a>post-processors</h3>

<p>OSを作成した後に実行することを記載する項目です</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">packer.json（一部抜粋）</span></div>
<div class="highlight"><pre><span></span> "post-processors": [
    {
      "type": "vagrant",
      "output": "./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box"
    }
  ]
</pre></div>
</div>

<table>
<thead>
<tr>
<th style="text-align: left">項目名</th>
<th style="text-align: right">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">type</td>
<td style="text-align: right">vagrantのボックス作る場合はvagrantで</td>
</tr>
<tr>
<td style="text-align: left">output</td>
<td style="text-align: right">vagrantのボックス作った後の.boxの吐き出し場所の指定です</td>
</tr>
</tbody>
</table>

<h2>
<span id="kickstartファイルを書く" class="fragment"></span><a href="#kickstart%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>KickStartファイルを書く</h2>

<p><a href="http://qiita.com/hnakamur/items/da0ed14192a18405f704">OSXでpackerでCentOS6.4のVirtualBox VMを作成する</a>のまんまです。</p>

<p>まずはディレクトリを作ろう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir -r packer/vagrant-boxes packer/builders
vim packer/builders/ks.cfg
</pre></div></div>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">packer/builders/ks.cfg</span></div>
<div class="highlight"><pre><span></span>install
cdrom
lang en_US.UTF-8
keyboard us
network --bootproto=dhcp
rootpw vagrant
firewall --enabled --service=ssh
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone Asia/Tokyo
bootloader --location=mbr

text
skipx
zerombr

clearpart --all --initlabel
autopart

auth  --useshadow  --enablemd5
firstboot --disabled
reboot

%packages --ignoremissing
@core
bzip2
kernel-devel
kernel-headers
-ipw2100-firmware
-ipw2200-firmware
-ivtv-firmware
%end

%post
/usr/bin/yum -y install sudo
/usr/sbin/groupadd -g 501 vagrant
/usr/sbin/useradd vagrant -u 501 -g vagrant -G wheel
echo "vagrant"|passwd --stdin vagrant
echo "vagrant        ALL=(ALL)       NOPASSWD: ALL" &gt;&gt; /etc/sudoers.d/vagrant
chmod 0440 /etc/sudoers.d/vagrant
%end
</pre></div>
</div>

<h3>
<span id="provisioners" class="fragment"></span><a href="#provisioners"><i class="fa fa-link"></i></a>provisioners</h3>

<p>インスタンスが作成された後に実行するものです。KickStartで仮想インスタンスにプラスアルファの機能を追加する場合はprovisioners側で管理したほうがいいかと思います。provisionersのハッシュの値を入れれば任意のファイルを実行できます</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">packer.json（一部抜粋）</span></div>
<div class="highlight"><pre><span></span>  "provisioners": [
    {
      "type": "shell",
      "scripts": [
        "packer/provisioners/base.sh",
        "packer/provisioners/vagrant.sh",
        "packer/provisioners/virtualbox.sh",
        "packer/provisioners/cleanup.sh"
      ],
      "override": {
        "virtualbox-iso": {
          "execute_command": "echo 'vagrant'|sudo -S sh '{{.Path}}'"
        }
      }
    }
  ],
</pre></div>
</div>

<h2>
<span id="ビルドの実行" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>ビルドの実行</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd packer.jsonが置いてあるカレントディレクトリ
packer build --only=virtualbox-iso packer.json
# 古いpackerのバージョンの方は下記のコマンドで
# packer build -only=virtualbox packer.json


virtualbox output will be in this color.

==&gt; virtualbox: Downloading or copying Guest additions checksums
    virtualbox: Downloading or copying: http://download.virtualbox.org/virtualbox/4.2.10/SHA256SUMS
==&gt; virtualbox: Downloading or copying Guest additions
    virtualbox: Downloading or copying: http://download.virtualbox.org/virtualbox/4.2.10/VBoxGuestAdditions_4.2.10.iso
==&gt; virtualbox: Downloading or copying ISO
    virtualbox: Downloading or copying: http://ftp.iij.ad.jp/pub/linux/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-minimal.iso
==&gt; virtualbox: Starting HTTP server on port 8081
==&gt; virtualbox: Creating virtual machine...
==&gt; virtualbox: Creating hard drive...
==&gt; virtualbox: Creating forwarded port mapping for SSH (host port 3213)
==&gt; virtualbox: Executing custom VBoxManage commands...
    virtualbox: Executing: modifyvm CentOS6.4-x86_minimal --memory 2048
    virtualbox: Executing: modifyvm CentOS6.4-x86_minimal --cpus 2
==&gt; virtualbox: Starting the virtual machine...
==&gt; virtualbox: Waiting 10s for boot...
==&gt; virtualbox: Typing the boot command...
==&gt; virtualbox: Waiting for SSH to become available...
==&gt; virtualbox: Connected to SSH!
==&gt; virtualbox: Uploading VirtualBox version info (4.2.10)
==&gt; virtualbox: Uploading VirtualBox guest additions ISO...
==&gt; virtualbox: Gracefully halting virtual machine...
    virtualbox: 
    virtualbox:
    virtualbox: Broadcast message from vagrant@localhost.localdomain
    virtualbox: (unknown) at 0:22 ...
    virtualbox:
    virtualbox: The system is going down for power off NOW!
==&gt; virtualbox: Preparing to export machine...
    virtualbox: Deleting forwarded port mapping for SSH (host port 3213)
==&gt; virtualbox: Exporting virtual machine...
==&gt; virtualbox: Unregistering and deleting virtual machine...
==&gt; virtualbox: Running post-processor: vagrant
==&gt; virtualbox (vagrant): Creating Vagrant box for 'virtualbox' provider
    virtualbox (vagrant): Copying: output-virtualbox/packer-disk1.vmdk
    virtualbox (vagrant): Copying: output-virtualbox/packer.ovf
    virtualbox (vagrant): Renaming the OVF to box.ovf...
    virtualbox (vagrant): Compressing box...
    virtualbox (vagrant): Compressing: Vagrantfile
    virtualbox (vagrant): Compressing: box.ovf
    virtualbox (vagrant): Compressing: metadata.json
    virtualbox (vagrant): Compressing: packer-disk1.vmdk
Build 'virtualbox' finished.

==&gt; Builds finished. The artifacts of successful builds are:
--&gt; virtualbox: 'virtualbox' provider box: ./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box
</pre></div></div>

<h2>
<span id="vagrantfileに追加" class="fragment"></span><a href="#vagrantfile%E3%81%AB%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>VagrantFileに追加</h2>

<p>VagrantFileがない場合は作る</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd packer.jsonが置いてあるカレントディレクトリ
vagrat init
</pre></div></div>

<p>VagrantFileに書きましょ</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagrantfile</span></div>
<div class="highlight"><pre><span></span><span class="c1"># -*- mode: ruby -*-</span>
<span class="c1"># vi: set ft=ruby :</span>

<span class="no">BOX_NAME</span> <span class="o">=</span> <span class="s2">"CentOS6.4-x86-minimal"</span>

<span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="no">BOX_NAME</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_url</span> <span class="o">=</span> <span class="s2">"./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box"</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">"192.168.56.101"</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
     <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="no">BOX_NAME</span>
     <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">"modifyvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"--memory"</span><span class="p">,</span> <span class="s2">"2048"</span><span class="o">]</span>
     <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">"modifyvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"--cpus"</span><span class="p">,</span> <span class="s2">"2"</span><span class="o">]</span>

   <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="vagrantで起動確認" class="fragment"></span><a href="#vagrant%E3%81%A7%E8%B5%B7%E5%8B%95%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>Vagrantで起動確認</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vagrant up

Bringing machine 'default' up with 'virtualbox' provider...
[default] Box 'CentOS6.4-x86-minimal' was not found. Fetching box from specified URL for
the provider 'virtualbox'. Note that if the URL does not have
a box for this provider, you should interrupt Vagrant now and add
the box yourself. Otherwise Vagrant will attempt to download the
full box prior to discovering this error.
Downloading or copying the box...
Extracting box...e: 285M/s, Estimated time remaining: --:--:--)
Successfully added box 'CentOS6.4-x86-minimal' with provider 'virtualbox'!
[default] Importing base box 'CentOS6.4-x86-minimal'...
[default] Matching MAC address for NAT networking...
[default] Setting the name of the VM...
[default] Clearing any previously set forwarded ports...
[default] Creating shared folders metadata...
[default] Clearing any previously set network interfaces...
[default] Preparing network interfaces based on configuration...
[default] Forwarding ports...
[default] -- 22 =&gt; 2222 (adapter 1)
[default] Running any VM customizations...
[default] Booting VM...
[default] Waiting for VM to boot. This can take a few minutes.
</pre></div></div>

<p>これでオレオレ.boxの出来上がりです！！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>207</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/91df14537512c03488ac">vagrantの設定を色々調べて（試してみた）</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-19 01:27:57</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[chef]</b> <b>[vagrant]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://tatsu-zine.com/books/chef-solo" rel="nofollow noopener" target="_blank">入門ChefSolo-InfrastructureasCode-1.0.0</a>を買ってvagrantにハマっています。<br>
vagrantの設定について色々調べてみました。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>mac-osx</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>virtualbox</li>
<li>ruby 1.9.3p327 (rbenv) ※入っていないかたは<a href="http://d.hatena.ne.jp/itog/20120223/1329995531" rel="nofollow noopener" target="_blank">rbenvで複数バージョンのRubyを管理するmac os lion</a>を読んでいれてみてください</li>
<li>vagrant(試したバージョンは1.1.5) ※入っていないかたは<a href="http://www.vagrantup.com/" rel="nofollow noopener" target="_blank">vagrant</a>からDownloadポチっと押してインストールしてきてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://www.ryuzee.com/contents/blog/4310" rel="nofollow noopener" target="_blank">VagrantをPluginで拡張する</a></li>
<li><a href="http://docs.vagrantup.com/v2/getting-started/index.html" rel="nofollow noopener" target="_blank">vagrant公式</a></li>
</ul>

<h2>
<span id="vagrantとは" class="fragment"></span><a href="#vagrant%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a><a href="http://www.ryuzee.com/contents/blog/4292" rel="nofollow noopener" target="_blank">vagrant</a>とは？</h2>

<p>vm(virtualbox,vmware)をコマンドラインで作成、起動などができるもの<br>
chef-soloやるだけなら特に必要はないが、chef-soloをやる場合に何回も壊しては作るを繰り返すことになるので合ったほうが便利<br>
ちなみにvagrantでもなくてもvirtualboxのコマンドでも頑張れば同様なことはできる。<br>
chef-soloを使う為の箱の自動化処理部分を担ってくれる</p>

<h2>
<span id="vagrantfileとは" class="fragment"></span><a href="#vagrantfile%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Vagrantfileとは</h2>

<p>Vagrantfileはvagrantの設定ファイルです<br>
以下Vagrantfileの設定についての説明です。<br>
またこれ以下の設定内容は全て下記のブロック内で設定してください。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagtanrfile</span></div>
<div class="highlight"><pre><span></span><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="c1">#このブロック内で定義してください。</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="configvmbox" class="fragment"></span><a href="#configvmbox"><i class="fa fa-link"></i></a>config.vm.box</h2>

<p><a href="http://docs.vagrantup.com/v2/cli/box.html" rel="nofollow noopener" target="_blank">Command-Line Interface Box</a></p>

<p>vagrant内部で持つvmの名前です。<br>
これは</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vagrant box add {任意のvm名称}
</pre></div></div>

<p>の{任意のvm名称}の部分にあたります。<br>
設定は下記にような形になります</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagrantfile</span></div>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">"{任意のvm名称}"</span>
</pre></div>
</div>

<p><a href="http://docs.vagrantup.com/v2/cli/box.html" rel="nofollow noopener" target="_blank">公式</a>より</p>

<blockquote>
<p>The name argument of this command is a logical name, meaning you can effectively choose whatever you want. This is the name that Vagrant searches for to match with the config.vm.box setting in Vagrantfiles.</p>
</blockquote>

<p>ちょっと英語が読めませんがvagrant box add したものと同一でなければいけません（多分合ってる）。</p>

<p>また勘違いしやすいのですがこれとGUIの管理ツールから見えるbox名前は一致しません。<br>
これは後で説明します。</p>

<h2>
<span id="configvmprovider" class="fragment"></span><a href="#configvmprovider"><i class="fa fa-link"></i></a>config.vm.provider</h2>

<p><a href="http://docs.vagrantup.com/v2/providers/configuration.html" rel="nofollow noopener" target="_blank">Providers Configuration</a></p>

<p>provider (virtualbox,vmware等)の基本設定を変更することができます。</p>

<h3>
<span id="boxの名称の変更" class="fragment"></span><a href="#box%E3%81%AE%E5%90%8D%E7%A7%B0%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>boxの名称の変更</h3>

<p>virtualboxのGUI上で見える名前を設定したい場合は</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagrantfile</span></div>
<div class="highlight"><pre><span></span>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
    <span class="n">vb</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"{任意の名前}"</span>
  <span class="k">end</span>
</pre></div>
</div>

<p>とすれば名前を変更できます。<br>
vb.nameとvagrantで操作するbox名は一致しません。<br>
あくまでvirtualbox上のGUIの名前になります。</p>

<h3>
<span id="メモリの設定" class="fragment"></span><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>メモリの設定</h3>

<p>仮想boxのメモリの割り当てを変更したい場合は</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagrantfile</span></div>
<div class="highlight"><pre><span></span>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:virtualbox</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
    <span class="n">vb</span><span class="o">.</span><span class="n">customize</span> <span class="o">[</span><span class="s2">"modifyvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"--memory"</span><span class="p">,</span> <span class="s2">"変更したいメモリ(Mbyte単位)"</span><span class="o">]</span>
  <span class="k">end</span>
</pre></div>
</div>

<p>とすればメモリの割り当てを変更できます。</p>

<h2>
<span id="configvmnetwork" class="fragment"></span><a href="#configvmnetwork"><i class="fa fa-link"></i></a>config.vm.network</h2>

<p><a href="http://docs.vagrantup.com/v2/networking/basic_usage.html" rel="nofollow noopener" target="_blank">Networking Basic Usage</a></p>

<p>vmのネットワーク設定です。<br>
<a href="http://www.vagrantbox.es/" rel="nofollow noopener" target="_blank">vagrantbox.es</a>のcentos6.4だとデフォルトはNATのポートフォワーディングのみの設定なので<br>
自分はHostOnlyAdapterの設定を追加しています。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagrantfile</span></div>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">"ゲストOS側の割り当てたい任意のIPアドレス"</span>
</pre></div>
</div>

<p>他にもportフォワーディングとかbrigeとか設定できるみたいですが試していないので割愛します。</p>

<h2>
<span id="configvmprovision" class="fragment"></span><a href="#configvmprovision"><i class="fa fa-link"></i></a>config.vm.provision</h2>

<p><a href="http://docs.vagrantup.com/v2/provisioning/basic_usage.html" rel="nofollow noopener" target="_blank">Provisioning Basic Usage</a></p>

<p>vmの起動後に実行してくれる設定を持たすことができます。<br>
起動後に前処理をしてくれるイメージで問題有りません。</p>

<h4>
<span id="shell" class="fragment"></span><a href="#shell"><i class="fa fa-link"></i></a>:shell</h4>

<p>前処理をshellで実行出来ます。<br>
設定は下記のようになります。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagrantfile</span></div>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">"{任意の名前}.sh"</span>
</pre></div>
</div>

<p>この例ですとvmの起動後カレントの{任意の名前}.shを実行するという処理になります。(起動時毎回)</p>

<p>ちなみに自分は<a href="http://www.vagrantbox.es/" rel="nofollow noopener" target="_blank">vagrantbox.es</a>から取ってきたCentOS 6.4 x86_64 Minimal (VirtualBox Guest Additions 4.2.8, Chef 11.4.0, Puppet 3.1.0)のboxが最初rsyncが入ってなくて初回chef-soloを実行するとエラーになったので<br>
{任意の名前}.shを下記にように書きました。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">provisioning.sh</span></div>
<div class="highlight"><pre><span></span>#!/usr/bin/env bash
#
# provisioning shell
# @see http://docs.vagrantup.com/v2/provisioning/shell.html
#

set -e

# rsyncパッケージがデフォルトで入っていない場合はインストールする
if ! yum list installed | grep rsync &gt;/dev/null 2&gt;&amp;1; then
    yum -y install rsync
fi
</pre></div>
</div>

<p>また:inlineというものもあって.shでなく直接Vagrantfileに書いて実行できるようです。試していないので説明は公式に譲ります。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagrantfile</span></div>
<div class="highlight"><pre><span></span><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># ... other configuration</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">:inline</span> <span class="o">=&gt;</span> <span class="s2">"echo hello"</span>
<span class="k">end</span>
</pre></div>
</div>

<p>他にも</p>

<ul>
<li>chef-soloの設定</li>
<li>puppetの設定</li>
<li>chef-cliantの設定</li>
</ul>

<p>ができるみたいですが試していなので割愛します。</p>

<h2>
<span id="configvmsynced_folder" class="fragment"></span><a href="#configvmsynced_folder"><i class="fa fa-link"></i></a>config.vm.synced_folder</h2>

<p>共有フォルダの設定です。<br>
デフォルトは</p>

<ul>
<li>ホスト側はVagrantfileがおいてあるカレントディレクトリ</li>
<li>ゲスト側は/Vagrant</li>
</ul>

<p>が共有フォルダとして設定されていますが上記内容を変更出来ます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Vagrantfile</span></div>
<div class="highlight"><pre><span></span>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">"ホスト側のディレクトリ"</span><span class="p">,</span> <span class="s2">"ゲスト側のディレクトリ"</span>
</pre></div>
</div>

<h2>
<span id="おまけvagrant-pluginコマンドについて" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91vagrant-plugin%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>[おまけ]vagrant pluginコマンドについて</h2>

<p>vagrantはいろんなプラグインがgemで出まわってます。</p>

<p><a href="http://rubygems.org/search?utf8=%E2%9C%93&amp;query=vagrant" class="autolink" rel="nofollow noopener" target="_blank">http://rubygems.org/search?utf8=%E2%9C%93&amp;query=vagrant</a></p>

<p>このpluginをvagrantに食わせる場合は</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vagrant plugin install {gemの名称}
</pre></div></div>

<p>で入れられます。<br>
有名どころだと<a href="http://www.ryuzee.com/contents/blog/6555" rel="nofollow noopener" target="_blank">sahara</a>とかもこれでinstallできます。</p>

<p>ちなみに<a href="http://rubygems.org/gems/vagrantboxes" rel="nofollow noopener" target="_blank">vagrantboxes</a>のpluginは自分の環境では上手く動作しませんでした。</p>

<h3>
<span id="vagrant-vbguest-plugin" class="fragment"></span><a href="#vagrant-vbguest-plugin"><i class="fa fa-link"></i></a>vagrant-vbguest plugin</h3>

<p>Guest Additionsの自動更新をしてくれるもの</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant plugin install vagrant-vbguest
</pre></div></div>

<h2>
<span id="余談作ったvagrantのvmについて" class="fragment"></span><a href="#%E4%BD%99%E8%AB%87%E4%BD%9C%E3%81%A3%E3%81%9Fvagrant%E3%81%AEvm%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>[余談]作ったvagrantのVMについて</h2>

<p>vagrantで作ったvmはGUI上で除去などすると<br>
設定ファイルが残ったままになるので再度同じ名前のboxを作ろうするとエラーになります。<br>
そんな時は~/.vagrant.dの削除をしてみてください。</p>

<p>今日はここまで調べたのでまた調べたらこの記事に追記していこうかと思ってます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>162</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/fe915a8b24b7c7f5c4a3">WEB開発をするにあたって私的「これだけは入れとけ!」っていう開発環境構築手順(virtualbox編)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-04 13:00:48</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[PHP]</b> <b>[Linux]</b> <b>[Node.js]</b> <b>[MySQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>自分は根っからのPHPerですが最近はPHPerといえども色々な言語のツールなども駆使しないと現代社会では生けていけない状態になって参りました。</p>

<p>そこで最近ホットなものも開発できる環境を一から作りなおした時のメモです。</p>

<h2>
<span id="あるあるこんなこと" class="fragment"></span><a href="#%E3%81%82%E3%82%8B%E3%81%82%E3%82%8B%E3%81%93%E3%82%93%E3%81%AA%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>あるあるこんなこと</h2>

<ul>
<li>開発を複数受け持っている場合に言語のバージョンが違う</li>
<li>webサーバーもnginxとapacheの組み合わせが多くなってきた</li>
<li>DBもRDBMSとnoSQLと選択多くなってきた</li>
<li>MYSQLの複数インスタンス欲しい</li>
<li>kvsとかもたまに使うよね？(memcacheもね)</li>
<li>継続的インテグレーションをやるためにはjenkinsも入れなきゃいけない</li>
</ul>

<p>上記を踏まえた上での開発環境構築手順を紹介させて頂きます。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>macosx10.8(ホストOS)</li>
<li>centos6.3（ゲストOS）</li>
</ul>

<p>尚、構築手順はMACOSXでの構築手順になります。<br>
※windowsも適時コマンドを読み替えれば特に問題ないと思います。</p>

<h2>
<span id="入れるもの" class="fragment"></span><a href="#%E5%85%A5%E3%82%8C%E3%82%8B%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>入れるもの</h2>

<h3>
<span id="virtualbox" class="fragment"></span><a href="#virtualbox"><i class="fa fa-link"></i></a><a href="https://www.virtualbox.org/" rel="nofollow noopener" target="_blank">VirtualBox</a>
</h3>

<p>CentOSを動かすための仮想開発環境</p>

<h3>
<span id="開発言語" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E8%A8%80%E8%AA%9E"><i class="fa fa-link"></i></a>開発言語</h3>

<h4>
<span id="php" class="fragment"></span><a href="#php"><i class="fa fa-link"></i></a>PHP</h4>

<p>PHPerなんで</p>

<ul>
<li><a href="https://github.com/CHH/phpenv" rel="nofollow noopener" target="_blank">phpenv</a></li>
</ul>

<p>PHPのバージョン変更がコマンド一発でできるもの</p>

<ul>
<li><a href="http://php-fpm.org/" rel="nofollow noopener" target="_blank">php-fpm</a></li>
</ul>

<p>nginxでPHPを使うために必要なプロセスマネージャー</p>

<ul>
<li>memcache</li>
<li>mongo etc… (適当に必要そうなもの全部)</li>
</ul>

<h4>
<span id="ruby" class="fragment"></span><a href="#ruby"><i class="fa fa-link"></i></a>ruby</h4>

<p>ビルドツールとかshell以外で構築するにあたって便利なものが色々あります。(Capistranoとか)言語切替とかのスクリプトは大体rubyで書かれていることが多いです。</p>

<ul>
<li><a href="https://github.com/sstephenson/rbenv/" rel="nofollow noopener" target="_blank">rbenv</a></li>
</ul>

<p>rubyのバージョン変更がコマンド一発でできるもの</p>

<ul>
<li><a href="http://higelog.brassworks.jp/?p=654" rel="nofollow noopener" target="_blank">chef</a></li>
</ul>

<p>環境構築を自動化できるツール。当初はこれでやろうと思ったが理解力が乏しく断念しました。</p>

<ul>
<li><a href="http://fluentd.org/" rel="nofollow noopener" target="_blank">fluentd</a></li>
</ul>

<p>ログを何でもかんでもjsonにできるツール。jsonって便利ですよね</p>

<h4>
<span id="nodejs" class="fragment"></span><a href="#nodejs"><i class="fa fa-link"></i></a>node.js</h4>

<p>scoket.ioとか聞いてるとワクワクしますよね！！</p>

<ul>
<li><a href="https://github.com/hokaccha/nodebrew" rel="nofollow noopener" target="_blank">nodebrew</a></li>
</ul>

<p>node.jsのバージョン変更がコマンド一発でできるもの<br>
node.jsは頻繁にアップデートするのでバージョン切り替えがないと死ねるかもしれません。</p>

<h4>
<span id="java" class="fragment"></span><a href="#java"><i class="fa fa-link"></i></a>JAVA</h4>

<p>自分はJAVA知らないがjenkinsは使いたかったので</p>

<ul>
<li><a href="http://jenkins-ci.org/" rel="nofollow noopener" target="_blank">jenkins</a></li>
</ul>

<p>自動ビルドとかに使うツール</p>

<h3>
<span id="webサーバー" class="fragment"></span><a href="#web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC"><i class="fa fa-link"></i></a>WEBサーバー</h3>

<h4>
<span id="apache" class="fragment"></span><a href="#apache"><i class="fa fa-link"></i></a>apache</h4>

<p>いつもどおり</p>

<h4>
<span id="nginx" class="fragment"></span><a href="#nginx"><i class="fa fa-link"></i></a>nginx</h4>

<p>最近はこれ多い</p>

<h3>
<span id="db" class="fragment"></span><a href="#db"><i class="fa fa-link"></i></a>DB</h3>

<h4>
<span id="mysql" class="fragment"></span><a href="#mysql"><i class="fa fa-link"></i></a>MYSQL</h4>

<p>いつもどおり</p>

<ul>
<li>phpMyAdmin</li>
</ul>

<p>最近は使いやすくなりました</p>

<h4>
<span id="mongodb" class="fragment"></span><a href="#mongodb"><i class="fa fa-link"></i></a>mongodb</h4>

<p>最近話題のnoSQL</p>

<ul>
<li>rockmongo</li>
</ul>

<p>mongodb版phpmyadminのようなもの</p>

<h2>
<span id="目次" class="fragment"></span><a href="#%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>目次</h2>

<ul>
<li>
<a href="http://qiita.com/items/31029ea9ac3fcb34abdc">virtualbox導入</a> (OSインストールからSSHでホストOSの接続確認まで)</li>
<li>
<a href="http://qiita.com/items/662e41376efa97251575">yum外部レポジトリの追加</a> </li>
<li><a href="http://qiita.com/items/1cb882b48b1a827a420d">rubyインストール</a></li>
<li><a href="http://qiita.com/items/5ef125b0384a9c23ba6a">virtualbox(centos)でのhttpdインストールメモ</a></li>
<li><a href="http://qiita.com/items/ae25133156aeddd7c24b">fluentdインストール</a></li>
<li><a href="http://qiita.com/items/40b527c390f068985f75">nginxインストール</a></li>
<li><a href="http://qiita.com/items/73df4ab45c96092b63b8">MYSQLインストール</a></li>
<li><a href="http://qiita.com/items/7d031440bb174a55a6a1">PHPインストール</a></li>
<li><a href="http://qiita.com/items/b51b7ec9d7c378f60237">php-fpm設定</a></li>
<li><a href="http://qiita.com/items/dae3649e412c323015c0">phpMyAdminインストール</a></li>
<li><a href="http://qiita.com/items/3ed551c440cf7b48bbfe">mongodbインストール</a></li>
<li><a href="http://qiita.com/items/ed7c86d3a7c183c76081">PECL::mongo追加</a></li>
<li><a href="http://qiita.com/items/b2ce06e8f2ee0237d723">PECL::memcached追加</a></li>
<li><a href="http://qiita.com/items/43beef25d26966fff8cc">PHP composerインストールメモ</a></li>
<li><a href="http://qiita.com/items/c85fcca393492a12ec38">node.jsインストール</a></li>
<li><a href="http://qiita.com/items/e41a821a8287091d7510">jenkinsインストール</a></li>
</ul>

<p>本当はデプロイツールの<a href="https://github.com/capistrano/capistrano" rel="nofollow noopener" target="_blank">capistrano</a>とかも書きたかったのですが断念しました。また時間があれば書きます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>81</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/f0ef33639c188a5965c7">今日作りたくなる簡単cookbook [Kim&apos;sキッチン] rbenv</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-18 12:16:46</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[chef]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下全ても●みち風に書いたメモ</p>

<p>皆さんおはようございます。<br>
<a href="http://qiita.com/users/ryurock@github">ryurock@github</a>です。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">ペケポン(38歳)</span></div>
<div class="highlight"><pre><span></span>rbenvをセットアップしたいっす。
方法を教えてください。
</pre></div>
</div>

<p>今日はそんなrbenvが大好きな方に簡単なcookbookをknife-soloでご紹介したいと思います。</p>

<h2>
<span id="レシピ作成時間" class="fragment"></span><a href="#%E3%83%AC%E3%82%B7%E3%83%94%E4%BD%9C%E6%88%90%E6%99%82%E9%96%93"><i class="fa fa-link"></i></a>レシピ作成時間</h2>

<p>約5分</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>mac-osx（ホストOS）</li>
<li>centos6.4-x86-minimal (ゲストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>virtualbox</li>
<li>ruby 1.9.3p327 (rbenv) ※1.9.3-p286でもいけた</li>
<li>chef ※入れていない方は<code>gem install chef</code>とshellから打ってください</li>
<li>vagrant ※入れていない方は<a href="http://qiita.com/items/3cb756a9c951371a4089">chef-soloで使用するvirtualbox(vagrant)をveeweeを使用して作る</a>を参考に入れておいてください</li>
<li>git</li>
<li>knife-soloのセットアップ ※やっていない方は<a href="http://qiita.com/items/c99215e25bd2ff846207">今日作りたくなる簡単cookbook [Kim'sキッチン] yumsetup(yum-fastestmirrorにyum update添え)</a>の前準備を参考にしてやっておいてください。</li>
</ul>

<h2>
<span id="参考にしたサイト書籍" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88%E6%9B%B8%E7%B1%8D"><i class="fa fa-link"></i></a>参考にしたサイト（書籍）</h2>

<ul>
<li>
<a href="http://tatsu-zine.com/books/chef-solo" rel="nofollow noopener" target="_blank">入門ChefSolo-InfrastructureasCode-1.0.0</a>(達人出版)</li>
<li><a href="http://qiita.com/items/8e973a544b592376a07e">rbenvを使ってシステムワイドにrubyをインストールする方法</a></li>
</ul>

<h2>
<span id="その１-レシピ名を決める" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%91-%E3%83%AC%E3%82%B7%E3%83%94%E5%90%8D%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>[その１] レシピ名を決める</h2>

<p>今回のレシピ名はrubyで行きましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife cookbook create ruby -o site-cookbooks
</pre></div></div>

<h2>
<span id="その2-chef-reporubyrecipesdefaultrbをコピーする" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE2-chef-reporubyrecipesdefaultrb%E3%82%92%E3%82%B3%E3%83%94%E3%83%BC%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>[その2] chef-repo/ruby/recipes/default.rbをコピーする</h2>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>cp chef-repo/ruby/recipes/default.rb chef-repo/ruby/recipes/rbenv.rb
</pre></div></div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/ruby/recipes/rbenv.rb</span></div>
<div class="highlight"><pre><span></span><span class="c1"># rbenvグループを作成して/usr/local/rbenvを実行権限のユーザーを追加する(今回はvagrantユーザーとveeweeユーザーを追加していますお好みによって変更してください)</span>
<span class="n">group</span> <span class="s2">"rbenv"</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:create</span>
  <span class="n">members</span> <span class="s2">"vagrant"</span>
  <span class="n">append</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># gitからrbenvを落としてくる(#{node.user}はrootです)</span>
<span class="n">git</span> <span class="s2">"/usr/local/rbenv"</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s2">"git://github.com/sstephenson/rbenv.git"</span>
  <span class="n">reference</span> <span class="s2">"master"</span>
  <span class="n">action</span> <span class="ss">:checkout</span>
  <span class="n">user</span> <span class="s2">"</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">group</span> <span class="s2">"rbenv"</span>
<span class="k">end</span>

<span class="c1"># ruby-build用のpluginフォルダを作成する</span>
<span class="n">directory</span> <span class="s2">"/usr/local/rbenv/plugins"</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s2">"</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">group</span> <span class="s2">"rbenv"</span>
  <span class="n">mode</span> <span class="s2">"0755"</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>


<span class="c1"># rbenvのbash設定を追加</span>
<span class="n">template</span> <span class="s2">"/etc/profile.d/rbenv.sh"</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s2">"</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">group</span> <span class="s2">"</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">mode</span> <span class="mo">0644</span>
<span class="k">end</span>

<span class="c1"># ruby-buildを落としてくる</span>
<span class="n">git</span> <span class="s2">"/usr/local/rbenv/plugins/ruby-build"</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s2">"git://github.com/sstephenson/ruby-build.git"</span>
  <span class="n">reference</span> <span class="s2">"master"</span>
  <span class="n">action</span> <span class="ss">:checkout</span>
  <span class="n">user</span> <span class="s2">"</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">group</span> <span class="s2">"rbenv"</span>
<span class="k">end</span>
</pre></div>
</div>

<p>やっていることは</p>

<ul>
<li>rbenvグループを作る</li>
<li>rbenvをgithubから落としてくる</li>
<li>rbenvのプラグインフォルダを作成する</li>
<li>rbenvのbinのPATHを反映させるprofileファイルを作成する</li>
<li>ruby-buildをpluginフォルダにgitで落としてくる</li>
</ul>

<p>です。</p>

<p>レシピとしては<br>
rbenv入れるところとruby-buildを入れるところで分離してもいいかもしれません。</p>

<p><a href="http://docs.opscode.com/resource.html" rel="nofollow noopener" target="_blank">Chef Resources</a>を使用した</p>

<ul>
<li><a href="http://docs.opscode.com/resource_group.html" rel="nofollow noopener" target="_blank">group</a></li>
<li><a href="http://docs.opscode.com/resource_git.html" rel="nofollow noopener" target="_blank">git</a></li>
<li><a href="http://docs.opscode.com/resource_directory.html" rel="nofollow noopener" target="_blank">directory</a></li>
<li><a href="http://docs.opscode.com/resource_template.html" rel="nofollow noopener" target="_blank">template</a></li>
</ul>

<p>で実行します。</p>

<h2>
<span id="その3attributesの追加" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE3attributes%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>[その3]attributesの追加</h2>

<p>recipeで使用している#{node.user}の部分の定義です。<br>
ついでにデフォルトで使用したいrubyのバージョンも書いてます。（これは後で使う）</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/ruby/attributes/default.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s2">"user"</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"root"</span>
<span class="n">default</span><span class="o">[</span><span class="s2">"build"</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"1.9.3-p392"</span>
</pre></div>
</div>

<h2>
<span id="その4profileファイルのテンプレートファイルの作成" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE4profile%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>[その4]profileファイルのテンプレートファイルの作成</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>template "/etc/profile.d/rbenv.sh" do
.
.
</pre></div></div>

<p>のテンプレートの中身です</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/rbenv/templates/default/rbenv.sh.erb</span></div>
<div class="highlight"><pre><span></span><span class="n">export</span> <span class="no">RBENV_ROOT</span><span class="o">=</span><span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">rbenv</span>
<span class="n">export</span> <span class="no">PATH</span><span class="o">=</span><span class="s2">"$RBENV_ROOT/bin:$PATH"</span>
<span class="nb">eval</span> <span class="s2">"$(rbenv init -)"</span>
</pre></div>
</div>

<p>いつものrbenvインストールのPATHのprofile設定ですね。</p>

<h2>
<span id="その5installレシピの追加" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE5install%E3%83%AC%E3%82%B7%E3%83%94%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>[その5]installレシピの追加</h2>

<p>recipes/default.rbはrbenvのインストールで<br>
recipes/install.rbはrubyのダウンロード&amp;コンパイルです</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/rbenv/recipes/install.rb</span></div>
<div class="highlight"><pre><span></span><span class="c1"># ruby 1.9.3-p392をインストール</span>
<span class="n">execute</span> <span class="s2">"ruby install"</span> <span class="k">do</span>
  <span class="n">not_if</span> <span class="s2">"source /etc/profile.d/rbenv.sh; rbenv versions | grep </span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">build</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">command</span> <span class="s2">"source /etc/profile.d/rbenv.sh; rbenv install </span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">build</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>

<span class="c1">#globalの切り替え</span>
<span class="n">execute</span> <span class="s2">"ruby change"</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">"source /etc/profile.d/rbenv.sh; rbenv global </span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">build</span><span class="si">}</span><span class="s2">;rbenv rehash"</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>

<p>先ほど定義したchef-repo/rbenv/attributes/default.rbのbuildを使用しています。これで設定かえるだけですきなrubyバージョンを変更できます。</p>

<h3>
<span id="ポイント" class="fragment"></span><a href="#%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>ポイント</h3>

<p>はじめ下記のように書いていたがrbenv install command not foundでエラーになりました。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/rbenv/recipes/install.rb</span></div>
<div class="highlight"><pre><span></span><span class="c1"># binのPATHを反映</span>
<span class="n">execute</span> <span class="s2">"source export"</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">"source /etc/profile.d/rbenv.sh;"</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>

<span class="c1"># ruby 1.9.3-p392をインストール</span>
<span class="n">execute</span> <span class="s2">"ruby install"</span> <span class="k">do</span>
  <span class="n">not_if</span> <span class="s2">"rbenv versions | grep </span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">build</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">command</span> <span class="s2">"rbenv install </span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">build</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>

<p>一つのブロック空間でそれぞれ独立しているんですね。（きっと）<br>
なのでこれでruby installの項目をやると<br>
<code>rbenv init</code>が実行されていない状態になります。</p>

<h2>
<span id="その6rbenv-cookbookをリモート側で実行する設定を追加" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE6rbenv-cookbook%E3%82%92%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E8%A8%AD%E5%AE%9A%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>[その6]rbenv cookbookをリモート側で実行する設定を追加</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim chef-repo/nodes/{接続名称（任意）}.json

{"run_list":[
        "rbenv::default",
        "rbenv::install"
]}
</pre></div></div>

<p>run_listをすでに記載している場合は追記でお願いします。<br>
またrbenvのインストールのみで問題ないならrbenvだけでも問題ないです。</p>

<h2>
<span id="その7-リモート側に実行依頼をする" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE7-%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%AB%E5%AE%9F%E8%A1%8C%E4%BE%9D%E9%A0%BC%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>[その7] リモート側に実行依頼をする</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife solo cook {接続名称（任意）}


Starting Chef Client, version 11.4.0
Compiling Cookbooks...
Converging 3 resources
Recipe: rbenv::default
</pre></div></div>

<h2>
<span id="今日はこれで決まりrbenvの完成です" class="fragment"></span><a href="#%E4%BB%8A%E6%97%A5%E3%81%AF%E3%81%93%E3%82%8C%E3%81%A7%E6%B1%BA%E3%81%BE%E3%82%8Arbenv%E3%81%AE%E5%AE%8C%E6%88%90%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>今日はこれで決まり「rbenv」の完成です</h2>

<p>template,attributesなどちょっと使ってますが内容はさほど難しくありませんので、是非使ってみてください。</p>

<p>使った<a href="http://docs.opscode.com/resource.html" rel="nofollow noopener" target="_blank">Chef Resources</a></p>

<hr>

<ul>
<li><a href="http://docs.opscode.com/resource_group.html" rel="nofollow noopener" target="_blank">group</a></li>
<li><a href="http://docs.opscode.com/resource_git.html" rel="nofollow noopener" target="_blank">git</a></li>
<li><a href="http://docs.opscode.com/resource_directory.html" rel="nofollow noopener" target="_blank">directory</a></li>
<li><a href="http://docs.opscode.com/resource_template.html" rel="nofollow noopener" target="_blank">template</a></li>
<li><a href="http://docs.opscode.com/resource_execute.html" rel="nofollow noopener" target="_blank">execute</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>60</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/cf7e6e251add75578d3d">pandocでmarkdownからredmineのwiki文法に変換する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-17 10:15:13</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Haskell]</b> <b>[Pandoc]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>kobitoさんを使い始めてからmarkdownが使いやすくredmineのwiki文法に嫌気が刺したので変換できないか探してたらpandocに出会った</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>macosx10.8</li>
<li>yosemite</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://sky-y.github.io/site-pandoc-jp/users-guide/" rel="nofollow noopener" target="_blank">Pandoc ユーザーズガイド 日本語版</a></li>
<li><a href="http://d.hatena.ne.jp/ts_asano/20121202/1354408701" rel="nofollow noopener" target="_blank">Pandocインストール</a></li>
<li><a href="http://d.hatena.ne.jp/sandai/20120604/p1#" rel="nofollow noopener" target="_blank">Haskell製のMarkdownをHTMLやLaTeXに変換できるPandocのインストールとサンプル</a></li>
</ul>

<h2>
<span id="pandocとは" class="fragment"></span><a href="#pandoc%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>pandocとは？</h2>

<p><a href="http://d.hatena.ne.jp/sandai/20120604/p1#" rel="nofollow noopener" target="_blank">Haskell製のMarkdownをHTMLやLaTeXに変換できるPandocのインストールとサンプル</a>から引用</p>

<blockquote>
<p>Haskell製のドキュメントコンバータ。markdownをhtmlにしたりLaTeXにしたりっていうことができるやつ。変換できる形式が多い。便利だ。</p>
</blockquote>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>brew install ghc cabal-install
cabal update
cabal install pandoc
</pre></div></div>

<h3>
<span id="pathを通す" class="fragment"></span><a href="#path%E3%82%92%E9%80%9A%E3%81%99"><i class="fa fa-link"></i></a>PATHを通す</h3>

<p>pandocをインストールすると<br>
$HOME/.cabal/binにpandocがあるので.zshrcにPATHを通す</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">~/.zshrc</span></div>
<div class="highlight"><pre><span></span>PATH=${HOME}/.cabal/bin:$PATH
</pre></div>
</div>

<p>反映</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>source ~/.zshrc
#又は
source ~/.bashrc
</pre></div></div>

<h2>
<span id="変換" class="fragment"></span><a href="#%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>変換</h2>

<p>これでいける</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>pandoc -s -S markdown.md -t textile -o markdown.textile
</pre></div></div>

<p>なんでhaskellのインストールってあんなにかかるんだろう。。。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>53</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/d785336cf6554576fa77">FuelPHP【チュートリアル】-- コントローラーのテストの方法 --</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-25 22:23:45</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[FuelPHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>FuelPHPのコントローラーのテストの書き方がなかったので試して見た</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3</li>
<li>fuelPHP1.5.3</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
<li>mysql</li>
<li>fuelPHPがインストール済みであること インストールをしていない場合は<a href="http://qiita.com/items/ae107a96699745a02560">FuelPHP【入門】-- CRUDを作った時のメモ(インストールからCRUD作成まで) --</a>を参考にインストールしてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://fuelphp.jp/docs/1.5/" rel="nofollow noopener" target="_blank">日本語版ドキュメント(1.5ドキュメント)</a></li>
<li><a href="http://takl.org/categories/fuelphp/fuelphpphpunitcontrollerunit-test" rel="nofollow noopener" target="_blank">FuelPHPでControllerのUnitTest</a></li>
</ul>

<h2>
<span id="testコントローラーの配置場所" class="fragment"></span><a href="#test%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E3%81%AE%E9%85%8D%E7%BD%AE%E5%A0%B4%E6%89%80"><i class="fa fa-link"></i></a>testコントローラーの配置場所</h2>

<p>デフォルトでfuel/app/tests/controllerのディレクトリが作成済みですのでそこにコントローラーのテストクラスを作成していきます。</p>

<div class="code-frame" data-lang="tree"><div class="highlight"><pre><span></span>fuel/app/tests
      ├── controller
      │   └── auth.php
      ├── model
      └── view
</pre></div></div>

<h2>
<span id="コントローラー側" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E5%81%B4"><i class="fa fa-link"></i></a>コントローラー側</h2>

<p>コントローラー側でテストをする際はView側にアサインした値の検証が出来れば大体のことはテストできると思います。そこでこんなサンプルを作ります。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/classes/controller/hoge.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Controller_Hoge</span> <span class="k">extends</span> <span class="nx">Controller_Hybrid</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">before</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">before</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">action_fuga</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">template</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">'htmlでのtitileタグ'</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">template</span><span class="o">-&gt;</span><span class="na">content</span> <span class="o">=</span> <span class="nx">View</span><span class="o">::</span><span class="na">forge</span><span class="p">(</span><span class="s1">'hoge/fuga'</span><span class="p">);</span>
        <span class="c1">//CSSを追加する</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">template</span><span class="o">-&gt;</span><span class="na">add_css</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'hoge.css'</span><span class="p">);</span>
    <span class="p">}</span>   
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="コントローラーテストクラスの作成" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E3%83%86%E3%82%B9%E3%83%88%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>コントローラーテストクラスの作成</h2>

<p>コントローラーの雛形です。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/tests/controller/hoge.php</span></div>
<div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * Tests for hoge</span>
<span class="sd"> *</span>
<span class="sd"> * @group App</span>
<span class="sd"> * @group Controller</span>
<span class="sd"> * @group Hoge</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Test_Controller_Hoge</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setup</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="値を検証する方法" class="fragment"></span><a href="#%E5%80%A4%E3%82%92%E6%A4%9C%E8%A8%BC%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>値を検証する方法</h2>

<p>先ほど作ったController_Hogeのadd_cssの値を検証する場合</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/tests/controller/hoge.php</span></div>
<div class="highlight"><pre><span></span>    <span class="sd">/**</span>
<span class="sd">     * @test</span>
<span class="sd">     * @group hogecontroller</span>
<span class="sd">     **/</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_add_cssの値が入っているか確認する</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'hoge.css'</span><span class="p">);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">forge</span><span class="p">(</span><span class="s1">'hoge/fuga'</span><span class="p">)</span>
                             <span class="o">-&gt;</span><span class="na">execute</span><span class="p">()</span>
                             <span class="o">-&gt;</span><span class="na">response</span><span class="p">();</span>

        <span class="nv">$assertValue</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">body</span><span class="o">-&gt;</span><span class="na">add_css</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$assertValue</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>

<p>上記でoilコマンドを実行すればOKが返ってきます</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil t --group=hogecontroller

Tests Running...This may take a few moments.
PHPUnit 3.7.18 by Sebastian Bergmann.

Configuration read from /home/web/lo.fuel.base.org/fuel/app/phpunit.xml

.

Time: 0 seconds, Memory: 5.25Mb

OK (1 test, 1 assertion)
</pre></div></div>

<h2>
<span id="controller内でのredirectを実行の場合" class="fragment"></span><a href="#controller%E5%86%85%E3%81%A7%E3%81%AEredirect%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>controller内でのRedirect()を実行の場合</h2>

<p>FuelPHPではRedirect()を実行するとexitが入っていてテスト自体も止まってしまいます</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/classes/controller/hoge.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Controller_Hoge</span> <span class="k">extends</span> <span class="nx">Controller_Hybrid</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">action_fugaredirect</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">template</span><span class="o">-&gt;</span><span class="na">is_error</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="c1">//Response::redirectの中身でexitを実行しているので止まってしまう</span>
        <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">redirect</span><span class="p">(</span><span class="s1">'error/404'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>fuel/core/response.php</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/core/classes/response.php</span></div>
<div class="highlight"><pre><span></span>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">redirect</span><span class="p">(</span><span class="nv">$url</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$method</span> <span class="o">=</span> <span class="s1">'location'</span><span class="p">,</span> <span class="nv">$code</span> <span class="o">=</span> <span class="mi">302</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="k">static</span><span class="p">;</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">set_status</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="s1">'://'</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$url</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nx">\Uri</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span> <span class="o">:</span> <span class="nx">\Uri</span><span class="o">::</span><span class="na">base</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nb">strpos</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="k">and</span> <span class="nv">$url</span> <span class="o">=</span> <span class="nx">\Uri</span><span class="o">::</span><span class="na">segment_replace</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$method</span> <span class="o">==</span> <span class="s1">'location'</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">set_header</span><span class="p">(</span><span class="s1">'Location'</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">elseif</span> <span class="p">(</span><span class="nv">$method</span> <span class="o">==</span> <span class="s1">'refresh'</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">set_header</span><span class="p">(</span><span class="s1">'Refresh'</span><span class="p">,</span> <span class="s1">'0;url='</span><span class="o">.</span><span class="nv">$url</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="k">exit</span><span class="p">;</span> <span class="c1">##&lt;= テストを止めてしまう</span>
    <span class="p">}</span>
</pre></div>
</div>

<p>そこでresponse.phpを独自のpackageで作成してテストのときは止めないようにしてみましょう。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/packages/my/classes/response.php</span></div>
<div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">My</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Response</span> <span class="k">extends</span> <span class="nx">\Fuel\Core\Response</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Override Fuel\Core\Response redirect method</span>
<span class="sd">     *</span>
<span class="sd">     * @param   string  $url     The url</span>
<span class="sd">     * @param   string  $method  The redirect method</span>
<span class="sd">     * @param   int     $code    The redirect status code</span>
<span class="sd">     *</span>
<span class="sd">     * @return  void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">redirect</span><span class="p">(</span><span class="nv">$url</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$method</span> <span class="o">=</span> <span class="s1">'location'</span><span class="p">,</span> <span class="nv">$code</span> <span class="o">=</span> <span class="mi">302</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="k">static</span><span class="p">;</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">set_status</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="s1">'://'</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$url</span> <span class="o">!==</span> <span class="s1">''</span> <span class="o">?</span> <span class="nx">\Uri</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span> <span class="o">:</span> <span class="nx">\Uri</span><span class="o">::</span><span class="na">base</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nb">strpos</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="k">and</span> <span class="nv">$url</span> <span class="o">=</span> <span class="nx">\Uri</span><span class="o">::</span><span class="na">segment_replace</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$method</span> <span class="o">==</span> <span class="s1">'location'</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">set_header</span><span class="p">(</span><span class="s1">'Location'</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">elseif</span> <span class="p">(</span><span class="nv">$method</span> <span class="o">==</span> <span class="s1">'refresh'</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">set_header</span><span class="p">(</span><span class="s1">'Refresh'</span><span class="p">,</span> <span class="s1">'0;url='</span><span class="o">.</span><span class="nv">$url</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//テストではない場合はexitを実行</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">\Fuel\Core\Fuel</span><span class="o">::</span><span class="nv">$env</span> <span class="o">!=</span> <span class="s1">'test'</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="k">exit</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>そしてこのクラスをロードするようにfuel/app/config/config.phpに追加します</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/config/config.php</span></div>
<div class="highlight"><pre><span></span>        <span class="s1">'packages'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'my'</span><span class="p">,</span> <span class="c1">//追加する</span>
        <span class="p">),</span>
</pre></div>
</div>

<h2>
<span id="redirectを実行したコントローラーのテストを実行してみる" class="fragment"></span><a href="#redirect%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%9F%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>redirectを実行したコントローラーのテストを実行してみる</h2>

<p>先ほどのコントローラーでアサインしたis_errorでアサートできるかテストを書いてみましょう</p>

<h3>
<span id="コントローラー側-1" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E5%81%B4-1"><i class="fa fa-link"></i></a>コントローラー側</h3>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/classes/controller/hoge.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Controller_Hoge</span> <span class="k">extends</span> <span class="nx">Controller_Hybrid</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">action_fugaredirect</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">template</span><span class="o">-&gt;</span><span class="na">is_error</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">redirect</span><span class="p">(</span><span class="s1">'error/404'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<h3>
<span id="テスト側" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E5%81%B4"><i class="fa fa-link"></i></a>テスト側</h3>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/tests/controller/hoge.php</span></div>
<div class="highlight"><pre><span></span>    <span class="sd">/**</span>
<span class="sd">     * @test</span>
<span class="sd">     * @group hogeredirect</span>
<span class="sd">     **/</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_is_errorがtrueか？</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="nv">$_GET</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'hoge'</span><span class="p">,</span> <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'huga'</span><span class="p">);</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">forge</span><span class="p">(</span><span class="s1">'auth/account'</span><span class="p">)</span>
                           <span class="o">-&gt;</span><span class="na">execute</span><span class="p">()</span>
                           <span class="o">-&gt;</span><span class="na">response</span><span class="p">();</span>

        <span class="nv">$assertValue</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">body</span><span class="o">-&gt;</span><span class="na">is_error</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$assertValue</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>

<h3>
<span id="テスト実行" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>テスト実行</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil t --group=hogeredirect

Tests Running...This may take a few moments.
PHPUnit 3.7.18 by Sebastian Bergmann.

Configuration read from /home/web/lo.fuel.base.org/fuel/app/phpunit.xml

.

Time: 0 seconds, Memory: 5.25Mb

OK (1 test, 1 assertion)
</pre></div></div>

<p>テストが動きました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>52</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/2b8eb451f12761c18b9c">phpenvをシステムワイドにインストールする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-01 17:32:50</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://qiita.com/items/8e973a544b592376a07e">rbenvを使ってシステムワイドにrubyをインストールする方法</a>を読んでphpenvでもいけるんじゃね？と思ってやってみたらできた時のメモ</p>

<p>環境 virtualbox </p>

<ul>
<li>centos6.3（ゲストOS）macosx10.8(ホストOS)</li>
<li>要gitインストール済の環境</li>
<li>rbenv ※入れていない方は<a href="http://qiita.com/items/1cb882b48b1a827a420d">virtualbox(centos)でrbenvインストールメモ</a>を参照してください</li>
</ul>

<h2>
<span id="phpenvとは" class="fragment"></span><a href="#phpenv%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>phpenvとは</h2>

<p><a href="http://qiita.com/items/7d031440bb174a55a6a1">ここ</a>参照してください。</p>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://qiita.com/items/8e973a544b592376a07e">rbenvを使ってシステムワイドにrubyをインストールする方法</a></li>
<li><a href="https://github.com/garamon/phpenv-apache-version" rel="nofollow noopener" target="_blank">garamon / phpenv-apache-version</a></li>
</ul>

<p>※以降は全てroot権限で実行しています</p>

<h2>
<span id="phpenvのインストール" class="fragment"></span><a href="#phpenv%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>phpenvのインストール</h2>

<p>サクッと一発ワンライナー</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>curl https://raw.github.com/CHH/phpenv/master/bin/phpenv-install.sh | sh


installing phpenv in /root/.phpenv
remote: Counting objects: 1456, done.
remote: Compressing objects: 100% (556/556), done.
remote: Total 1456 (delta 938), reused 1367 (delta 871)
Receiving objects: 100% (1456/1456), 209.95 KiB | 142 KiB/s, done.
Resolving deltas: 100% (938/938), done.
Success.

export PATH="/root/.phpenv/bin:$PATH"
eval "$(phpenv init -)"

Add above line at the end of your ~/.bashrc and restart your shell to use phpenv.
</pre></div></div>

<p>.bashrcにPATHとinit処理書けよ！！って言われるがシステムワイドに入れたいので今回はスルーする</p>

<h2>
<span id="phpenvの移動" class="fragment"></span><a href="#phpenv%E3%81%AE%E7%A7%BB%E5%8B%95"><i class="fa fa-link"></i></a>~/.phpenvの移動</h2>

<p>デフォルトで~/.phpenvにソースが配置されるので移動する</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/profile.d/rbenv.sh</span></div>
<div class="highlight"><pre><span></span>mv ~/.phpenv /usr/local/phpenv
chmod 775 -R /usr/local/phpenv
</pre></div>
</div>

<h2>
<span id="etcprofiledrbenvshに追記する" class="fragment"></span><a href="#etcprofiledrbenvsh%E3%81%AB%E8%BF%BD%E8%A8%98%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>/etc/profile.d/rbenv.shに追記する</h2>

<p>rbenv initより後に実行されないとphpenvがエラーになりますので<br>
今回は/etc/profile.d/rbenv.shに追記します<br>
(rbenv.shがない方は<a href="http://qiita.com/items/1cb882b48b1a827a420d">virtualbox(centos)でrbenvインストールメモ</a>を参考してください)</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/profile.d/rbenv.sh</span></div>
<div class="highlight"><pre><span></span>export RBENV_ROOT=/usr/local/rbenv
export PATH="$RBENV_ROOT/bin:$PATH"
eval "$(rbenv init -)"

#下記を最後に追加
export PATH="/usr/local/phpenv/bin:$PATH"
eval "$(phpenv init -)"
</pre></div>
</div>

<h2>
<span id="usrlocalphpenvbinphpenvのrbenv_rootを変更する" class="fragment"></span><a href="#usrlocalphpenvbinphpenv%E3%81%AErbenv_root%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>/usr/local/phpenv/bin/phpenvのRBENV_ROOTを変更する</h2>

<p>デフォルトだと~/.phpenvになってるので変更する</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/phpenv/bin/phpenv</span></div>
<div class="highlight"><pre><span></span>#変更
export RBENV_ROOT='/usr/local/phpenv'
</pre></div>
</div>

<p>その後にsourceコマンドで反映させる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>source /etc/profile.d/rbenv.sh
</pre></div></div>

<p>でコマンド叩いて確認しましょ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv

rbenv 0.4.0-13-ge3f72eb
Usage: rbenv &lt;command&gt; [&lt;args&gt;]

Some useful rbenv commands are:
   commands    List all available rbenv commands
   local       Set or show the local application-specific Ruby version
   global      Set or show the global Ruby version
   shell       Set or show the shell-specific Ruby version
   install     Install a Ruby version using the ruby-build plugin
   uninstall   Uninstall a specific Ruby version
   rehash      Rehash rbenv shims (run this after installing executables)
   version     Show the current Ruby version and its origin
   versions    List all Ruby versions available to rbenv
   which       Display the full path to an executable
   whence      List all Ruby versions that contain the given executable

See `rbenv help &lt;command&gt;' for information on a specific command.
For full documentation, see: https://github.com/sstephenson/rbenv#readme

#こんな感じのコマンドが表示されていればOK
</pre></div></div>

<h2>
<span id="php-buildのインストール" class="fragment"></span><a href="#php-build%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>php-buildのインストール</h2>

<p>最近の流行りはphpenvのpluginとして使うのがナウなやり方らしいのでそちらの方法にしてみる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir -p /usr/local/phpenv/plugins
cd /usr/local/phpenv/plugins
git clone git://github.com/CHH/php-build.git
curl https://raw.github.com/CHH/php-build/plugin-to-chh-phpenv/bin/rbenv-install &gt; php-build/bin/rbenv-install
chmod 755 php-build/bin/rbenv-install

</pre></div></div>

<p>入っているかの確認</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv install 
usage: phpenv install VERSION

Available versions:
 5.2.17
 5.3.10
 5.3.11
 5.3.11RC1
 5.3.11RC2
 5.3.12
 5.3.13
 5.3.14
 5.3.15
 5.3.16
 5.3.17
 5.3.18
 5.3.19
 5.3.19RC1
 5.3.2
 5.3.20
 5.3.20RC1
 5.3.21
 5.3.3
 .
 .
 .
#上記のような表示がされればOK
</pre></div></div>

<h2>
<span id="phpenv-apache-versionpluginの追加" class="fragment"></span><a href="#phpenv-apache-versionplugin%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>phpenv-apache-version　Pluginの追加</h2>

<p>apacheのphp変更とphpのバージョンの切り替えができる優れもののpluginがあるので使用しましょう。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd /usr/local/phpenv/plugins
git clone git://github.com/garamon/phpenv-apache-version
</pre></div></div>

<h2>
<span id="phpをビルド今回は5411" class="fragment"></span><a href="#php%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E4%BB%8A%E5%9B%9E%E3%81%AF5411"><i class="fa fa-link"></i></a>PHPをビルド（今回は5.4.11）</h2>

<p>全部入りを下記のブログを参照してやった<br>
<a href="http://d.hatena.ne.jp/sotarok/20120522/php_fpm_with_phpenv_and_php_build" rel="nofollow noopener" target="_blank">phpenv + php-build を使って 5.3 と 5.4 を共存させつつ php-fpm を使う</a><br>
自分はfpm入れてnginxも使用したいと思ったのでこれを参考にした<br>
オプション色々入れないなら依存パッケージがもっと減って下記のyumがもっとやりやすい</p>

<p>またphp-fpmは一回目のインストールした後に他のバージョンでも入れようとすると</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>You've configured multiple SAPIs to be build. You can build only
one SAPI module and CLI binary at the same time.
</pre></div></div>

<p>と怒られる。<br>
調べたがよくわからず<br>
<a href="http://ringogirl.hatenablog.jp/entry/2013/02/08/111329" rel="nofollow noopener" target="_blank">ココ</a>できっとphp-fpmは「複数入れられないんだなきっと」と納得して<br>
諦めてphp-fpmはバージョンが切り替えは諦めました。<br>
ていうかきっと誰かすごい人が作ってくれるでしょう。</p>

<h2>
<span id="依存モジュールのinstallcentos" class="fragment"></span><a href="#%E4%BE%9D%E5%AD%98%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AEinstallcentos"><i class="fa fa-link"></i></a>依存モジュールのinstall(centos)</h2>

<p>ここで結構ハマった。依存モジュール(centos内)が結構あったので<br>
クリーンな環境だと下記のモジュールのインストールが必要<br>
というかエラーが出た場合は基本「モジュール足らないよバカヤロー!!」が多いので<br>
エラーを見てググって yum install をひたすら繰り返す</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#epelのリポジトリがない場合はhttp://qiita.com/items/662e41376efa97251575を参照して追加してください
yum --enablerepo=epel install re2c libmcrypt libmcrypt-devel
yum install libxml2-devel bison bison-devel openssl-devel curl-devel libjpeg-devel libpng-devel libmcrypt-devel readline-devel libtidy-devel libxslt-devel httpd-devel enchant-devel libXpm libXpm-devel freetype-devel t1lib t1lib-devel gmp-devel libc-client-devel libicu-devel oniguruma-devel net-snmp net-snmp-devel bzip2-devel
</pre></div></div>

<p>PHP入れるのにこんなに依存関係あるのね。。。驚き。。。。</p>

<h2>
<span id="defaultのconfigureオプションの追加" class="fragment"></span><a href="#default%E3%81%AEconfigure%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>defaultのconfigureオプションの追加</h2>

<p>configureオプションを追加しましょう（今回は全部入りなので）</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/phpenv/plugins/php-build/share/php-build/default_configure_options</span></div>
<div class="highlight"><pre><span></span>--without-pear
--with-gd
--enable-sockets
--with-jpeg-dir=/usr
--with-png-dir=/usr
--enable-exif
--enable-zip
--with-zlib
--with-zlib-dir=/usr
--with-kerberos
--with-openssl
--with-mcrypt=/usr
--enable-soap
--enable-xmlreader
--with-xsl
--enable-ftp
--enable-cgi
--with-curl=/usr
--with-tidy
--with-xmlrpc
--enable-sysvsem
--enable-sysvshm
--enable-shmop
--with-mysql=mysqlnd
--with-mysqli=mysqlnd
--with-pdo-mysql=mysqlnd
--with-pdo-sqlite
--enable-pcntl
--with-readline
--enable-mbstring
--disable-debug
--with-apxs2=/usr/sbin/apxs
--enable-fileinfo
--enable-hash
--enable-json
--enable-sysvmsg
--enable-bcmath
--with-bz2
--enable-ctype
--with-iconv
--enable-ftp
--with-gettext
--enable-mbstring
--with-onig=/usr
--with-pcre-regex
--with-mysql-sock=/tmp/mysql.sock
--enable-phar
--enable-shmop
--enable-sockets
--enable-simplexml
--enable-dom
--with-libxml-dir=/usr
--enable-tokenizer
--with-kerberos=/usr
--with-openssl=/usr
--enable-zip
--with-mhash=yes
--without-mm
--with-enchant=/usr
--enable-gd-native-ttf
--with-gmp=/usr
--with-xpm-dir=/usr/X11R6
--with-freetype-dir=/usr
--with-imap=/usr
--with-imap-ssl
--enable-intl
--with-t1lib=/usr
--with-snmp=/usr
</pre></div>
</div>

<p>※mysqlはmysqld_multiなどでmysql.sockを変更していたら適時mysql.sockのパスに変更してください</p>

<h3>
<span id="php-buildの設定php-fpm込" class="fragment"></span><a href="#php-build%E3%81%AE%E8%A8%AD%E5%AE%9Aphp-fpm%E8%BE%BC"><i class="fa fa-link"></i></a>php-buildの設定(php-fpm込)</h3>

<p>上記の問題があるので最新版のphp-fpmを持ってくる予定なので<br>
最初に最新版の5.4.11をインストールする</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/root/.phpenv/pluginsshare/php-build/definitions/5.4.11</span></div>
<div class="highlight"><pre><span></span>vim /usr/local/share/php-build/definitions/5.4.11

#下記を先頭に追加
configure_option "--enable-fpm"
</pre></div>
</div>

<p>そして実行</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv install 5.4.11


[Info]: Loaded apc Plugin.
[Info]: Loaded pyrus Plugin.
[Info]: Loaded xdebug Plugin.
[Info]: Loaded xhprof Plugin.
[Info]: php.ini-production gets used as php.ini
[Info]: Building 5.4.11 into /root/.phpenv/versions/5.4.11



[Pyrus]: Downloading from http://pear2.php.net/pyrus.phar
[Pyrus]: Installing executable in /root/.phpenv/versions/5.4.11/bin/pyrus
[XDebug]: Downloading http://xdebug.org/files/xdebug-2.2.1.tgz
[XDebug]: Compiling in /var/tmp/php-build/source/xdebug-2.2.1
[XDebug]: Installing XDebug configuration in /root/.phpenv/versions/5.4.11/etc/conf.d/xdebug.ini
[XDebug]: Cleaning up.
[Info]: The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the log in /tmp/php-build.5.4.11.20130219025032.log
[Success]: Built 5.4.11 successfully.
#入った 
</pre></div></div>

<h3>
<span id="liphp5soの退避" class="fragment"></span><a href="#liphp5so%E3%81%AE%E9%80%80%E9%81%BF"><i class="fa fa-link"></i></a>liphp5.soの退避</h3>

<p>退避しないと他のバージョン入れた時に上書きしてしまうので移動する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mv /etc/httpd/modules/libphp5.so /root/.phpenv/versions/5.4.11/
</pre></div></div>

<h2>
<span id="phpをビルド5321" class="fragment"></span><a href="#php%E3%82%92%E3%83%93%E3%83%AB%E3%83%895321"><i class="fa fa-link"></i></a>PHPをビルド（5.3.21）</h2>

<p>先程も説明した通りphp-fpmを入れようとするとエラーになるので今度は<br>
/usr/local/share/php-build/definitions/5.3.21のconfigure_optionのfpmを--disable-fpmに変更する<br>
（php-fpmを入れないようにする）</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/usr/local/phpenv/plugins/php-build/share/php-build/definitions/5.3.21</span></div>
<div class="highlight"><pre><span></span>#下記を先頭に追加
configure_option "--disable-fpm"
</pre></div>
</div>

<p>インストールする</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv install 5.3.21


Info]: Loaded apc Plugin.
[Info]: Loaded pyrus Plugin.
[Info]: Loaded xdebug Plugin.
[Info]: Loaded xhprof Plugin.
[Info]: php.ini-production gets used as php.ini
[Info]: Building 5.3.21 into /root/.phpenv/versions/5.3.21



[Pyrus]: Downloading from http://pear2.php.net/pyrus.phar
[Pyrus]: Installing executable in /root/.phpenv/versions/5.3.21/bin/pyrus
[XDebug]: Downloading http://xdebug.org/files/xdebug-2.2.1.tgz
[XDebug]: Compiling in /var/tmp/php-build/source/xdebug-2.2.1
[XDebug]: Installing XDebug configuration in /root/.phpenv/versions/5.3.21/etc/conf.d/xdebug.ini
[XDebug]: Cleaning up.
[Info]: The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the log in /tmp/php-build.5.3.21.20130219030118.log
[Success]: Built 5.3.21 successfully.
#入った 
</pre></div></div>

<h3>
<span id="liphp5soの退避-1" class="fragment"></span><a href="#liphp5so%E3%81%AE%E9%80%80%E9%81%BF-1"><i class="fa fa-link"></i></a>liphp5.soの退避</h3>

<p>退避しないと他のバージョン入れた時に上書きしてしまうので移動する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mv /etc/httpd/modules/libphp5.so /root/.phpenv/versions/5.3.21/
</pre></div></div>

<h2>
<span id="httpconfの設定変更" class="fragment"></span><a href="#httpconf%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>http.confの設定変更</h2>

<p>ここらへんは<a href="http://creator-life.net/modern-php-env/" rel="nofollow noopener" target="_blank">モダンなPHP開発環境を構築する<br>
phpenv + php-build で 複数のPHPバージョンを管理する<br>
</a>の内容をそのまま持ってきてます<br>
(設定項目があれば変更する)</p>

<div class="code-frame" data-lang="apacheconf">
<div class="code-lang"><span class="bold">/etc/httpd/conf/httpd.conf</span></div>
<div class="highlight"><pre><span></span><span class="c">#LoadModule php5_module        /usr/lib/httpd/modules/libphp5.so  ← コメントアウト</span>
</pre></div>
</div>

<p>でphp用の設定を/etc/httpd/conf.d/php.confに書き出す</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/httpd/conf.d/php.conf</span></div>
<div class="highlight"><pre><span></span>
#
# PHP is an HTML-embedded scripting language which attempts to make it
# easy for developers to write dynamically generated webpages.
#

LoadModule php5_module modules/libphp5.so

#
# Cause the PHP interpreter to handle files with a .php extension.
#
AddHandler php5-script .php
AddType text/html .php

#
# Add index.php to the list of files that will be served as directory
# indexes.
#
DirectoryIndex index.php

#
# Uncomment the following line to allow PHP to pretty-print .phps
# files as PHP source code:
#
#AddType application/x-httpd-php-source .phps

</pre></div>
</div>

<h2>
<span id="phpcliのバージョンが切り替わるか確認" class="fragment"></span><a href="#phpcli%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C%E5%88%87%E3%82%8A%E6%9B%BF%E3%82%8F%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>PHP(cli)のバージョンが切り替わるか確認</h2>

<p>コマンドラインのphpが切り替われるか確認する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv rehash
php -v


rbenv: php: command not found

The `php' command exists in these Ruby versions:
  5.3.21
  5.4.11

#phpを複数入れてるのでどのバージョン使用するか決めてね！！ってエラーなんで

phpenv global 5.4.11
php -v


PHP 5.4.11 (cli) (built: Feb 19 2013 02:55:49) 
Copyright (c) 1997-2013 The PHP Group
Zend Engine v2.4.0, Copyright (c) 1998-2013 Zend Technologies
    with Xdebug v2.2.1, Copyright (c) 2002-2012, by Derick Rethans

#5.4.11になった


phpenv global 5.3.21
php -v


PHP 5.3.21 (cli) (built: Feb 19 2013 03:06:35) 
Copyright (c) 1997-2013 The PHP Group
Zend Engine v2.3.0, Copyright (c) 1998-2013 Zend Technologies
    with Xdebug v2.2.1, Copyright (c) 2002-2012, by Derick Rethans

#5.3.21になった
</pre></div></div>

<h2>
<span id="apacheモジュールが切り替えられるか確認する" class="fragment"></span><a href="#apache%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8C%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>apacheモジュールが切り替えられるか確認する</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv apache-version 5.4.11
copy /root/.phpenv/versions/5.4.11/libphp5.so to /etc/httpd/modules
Restarting apache...
Stopping httpd:                                            [  OK  ]
Starting httpd:                                            [  OK  ]

#apacheの再起動と退避したlibphp5.soの切り替えを行う
</pre></div></div>

<h2>
<span id="ブラウザで確認してphpが切り替わっているか確認する" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6php%E3%81%8C%E5%88%87%E3%82%8A%E6%9B%BF%E3%82%8F%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ブラウザで確認してPHPが切り替わっているか確認する</h2>

<p><a href="">http://localhost/phpinfo.php</a>とか作って</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>&lt;?php
phpinfo();
</pre></div></div>

<p>と書いてアクセスしてPHPのバージョンが変わって入ればOK!!</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>49</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/c4065da9f16c1f6248b7">OSXでpyenvインストールメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-20 19:06:51</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ansible]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>環境 macosx10.8(ホストOS)</p>

<p><a href="http://apatheia.info/blog/2013/04/06/about-ansible/" rel="nofollow noopener" target="_blank">ansible</a>を使う雰囲気になってきたのでちょっとローカルに入れるか!!と思ったので<br>
その前にpythonのバージョン管理ができる<a href="https://github.com/yyuu/pyenv#homebrew-on-mac-os-x" rel="nofollow noopener" target="_blank">pyenv</a>を入れようと思った時のメモ<br>
<a href="https://github.com/sstephenson/rbenv" rel="nofollow noopener" target="_blank">rbenv</a>とかと一緒でenv系のpython版ですね<br>
※<a href="https://github.com/sstephenson/rbenv" rel="nofollow noopener" target="_blank">rbenv</a>がわからない方は<a href="http://qiita.com/ryurock/items/1cb882b48b1a827a420d" id="reference-d61ced6dddc80c977a52">コチラ</a>を参考にしてみてください。</p>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="https://github.com/yyuu/pyenv#homebrew-on-mac-os-x" rel="nofollow noopener" target="_blank">yyuu/pyenv</a></li>
<li><a href="http://d.hatena.ne.jp/pasela/20130219/llenv" rel="nofollow noopener" target="_blank">plenvとpyenvに乗り換えた</a></li>
</ul>

<h2>
<span id="事前準備が必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備が必要なもの</h2>

<ul>
<li><a href="http://ja.wikipedia.org/wiki/Homebrew_(%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0)" rel="nofollow noopener" target="_blank">Homebrew (パッケージ管理システム)</a></li>
</ul>

<h2>
<span id="homebrewのアップデート" class="fragment"></span><a href="#homebrew%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>homebrewのアップデート</h2>

<p>サクッと</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>brew update
brew install pyenv
</pre></div></div>

<h2>
<span id="bashrcもしくはbash_profileの追加" class="fragment"></span><a href="#bashrc%E3%82%82%E3%81%97%E3%81%8F%E3%81%AFbash_profile%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>.bashrcもしくは.bash_profileの追加</h2>

<p><a href="https://github.com/sstephenson/rbenv" rel="nofollow noopener" target="_blank">rbenv</a>と同じですね</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>echo 'export PATH="$HOME/.pyenv/bin:$PATH"' &gt;&gt; ~/.bash_profile
</pre></div></div>

<h2>
<span id="bash_profileの反映" class="fragment"></span><a href="#bash_profile%E3%81%AE%E5%8F%8D%E6%98%A0"><i class="fa fa-link"></i></a>.bash_profileの反映</h2>

<p>これだけ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>source .bash_profile
</pre></div></div>

<h2>
<span id="確認" class="fragment"></span><a href="#%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>　確認</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>pyenv --help

yenv 0.4.0-20130726
Usage: pyenv &lt;command&gt; [&lt;args&gt;]

Some useful pyenv commands are:
   commands    List all available pyenv commands
   local       Set or show the local application-specific Python version
   global      Set or show the global Python version
   shell       Set or show the shell-specific Python version
   install     Install a Python version using the python-build plugin
   uninstall   Uninstall a specific Python version
   rehash      Rehash pyenv shims (run this after installing executables)
   version     Show the current Python version and its origin
   versions    List all Python versions available to pyenv
   which       Display the full path to an executable
   whence      List all Python versions that contain the given executable

See `pyenv help &lt;command&gt;' for information on a specific command.
For full documentation, see: https://github.com/yyuu/pyenv#readme
</pre></div></div>

<h2>
<span id="インストールしてみる" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>インストールしてみる</h2>

<p>下記のコマンドでインストールできるバージョン一覧が見れます</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>pyenv install -l
</pre></div></div>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>pyenv install 3.3.2

Downloading readline-6.2.tar.gz...
-&gt; http://yyuu.github.io/pythons/67948acb2ca081f23359d0256e9a271c
Installing readline-6.2...
Installed readline-6.2 to /Users/ユーザー名/.pyenv/versions/3.3.2

Downloading Python-3.3.2.tgz...
-&gt; http://yyuu.github.io/pythons/0a2ea57f6184baf45b150aee53c0c8da
Installing Python-3.3.2...
Installed Python-3.3.2 to /Users/ユーザー名/.pyenv/versions/3.3.2

Downloading setuptools-0.9.7.tar.gz...
-&gt; https://pypi.python.org/packages/source/s/setuptools/setuptools-0.9.7.tar.gz
Installing setuptools-0.9.7...
Installed setuptools-0.9.7 to /Users/ユーザー名/.pyenv/versions/3.3.2

Downloading pip-1.4.tar.gz...
-&gt; https://pypi.python.org/packages/source/p/pip/pip-1.4.tar.gz
Installing pip-1.4...
Installed pip-1.4 to /Users/ユーザー名/.pyenv/versions/3.3.2
</pre></div></div>

<h2>
<span id="pythonのグローバル設定をする" class="fragment"></span><a href="#python%E3%81%AE%E3%82%B0%E3%83%AD%E3%83%BC%E3%83%90%E3%83%AB%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>pythonのグローバル設定をする</h2>

<p>デフォルトで使用するpythonのバージョンを指定しないと<br>
macのデフォルトのpythonをみてしまうので設定しましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>pyenv global 3.3.2
python --version
Python 3.3.2
</pre></div></div>

<p>まあ、基本rbenvと一緒なので<br>
rbenv入れた人なら問題なく入れられるかと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>45</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/7d031440bb174a55a6a1">virtualbox(centos)でphpenv+php-buildインストールメモ(5.3,5.4変更確認まで)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-19 03:58:26</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[Apache]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="phpenvとは" class="fragment"></span><a href="#phpenv%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>phpenvとは</h2>

<p>PHPのバージョンを簡単に切り替えられる仕組みです。<br>
rbenvと一緒ですね。</p>

<p>rbenvと一緒なのでPHPのビルドは<br>
php-buildというものを使用してビルドしますが<br>
インストールからバージョンの切り替えまでは一緒に通常はやるものなので両方とも説明します。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3（ゲストOS</li>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="事前準備が必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備が必要なもの</h2>

<ul>
<li>git</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://creator-life.net/modern-php-env/" rel="nofollow noopener" target="_blank">モダンなPHP開発環境を構築する
phpenv + php-build で 複数のPHPバージョンを管理する
</a></li>
<li><a href="http://blog.yuyat.jp/archives/1446" rel="nofollow noopener" target="_blank">phpenv で複数の PHP 環境を管理する</a></li>
<li><a href="http://d.hatena.ne.jp/sotarok/20120522/php_fpm_with_phpenv_and_php_build" rel="nofollow noopener" target="_blank">phpenv + php-build を使って 5.3 と 5.4 を共存させつつ php-fpm を使う</a></li>
<li><a href="http://ksauzz.github.com/blog/2012/11/16/setup-php/" rel="nofollow noopener" target="_blank">PHP環境メモ</a></li>
</ul>

<p>※以降は全てroot権限で実行しています</p>

<h2>
<span id="phpenvのインストール" class="fragment"></span><a href="#phpenv%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>phpenvのインストール</h2>

<p>サクッと一発ワンライナーで実行すると<br>
.bashrcにPATHとinit処理書けよ！！って言われるのでその通りにする</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd /root
curl https://raw.github.com/CHH/phpenv/master/bin/phpenv-install.sh | sh


installing phpenv in /root/.phpenv
remote: Counting objects: 1456, done.
remote: Compressing objects: 100% (556/556), done.
remote: Total 1456 (delta 938), reused 1367 (delta 871)
Receiving objects: 100% (1456/1456), 209.95 KiB | 142 KiB/s, done.
Resolving deltas: 100% (938/938), done.
Success.

export PATH="/root/.phpenv/bin:$PATH"
eval "$(phpenv init -)"

Add above line at the end of your ~/.bashrc and restart your shell to use phpenv.
</pre></div></div>

<p>rootの.bashrcに記載する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim /root/.bashrc


#下記を最後に追加
export PATH="/root/.phpenv/bin:$PATH"
eval "$(phpenv init -)"
</pre></div></div>

<p>その後にsourceコマンドで反映させる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>source /root/.bashrc
</pre></div></div>

<p>でコマンド叩いて確認しましょ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv

rbenv 0.4.0-13-ge3f72eb
Usage: rbenv &lt;command&gt; [&lt;args&gt;]

Some useful rbenv commands are:
   commands    List all available rbenv commands
   local       Set or show the local application-specific Ruby version
   global      Set or show the global Ruby version
   shell       Set or show the shell-specific Ruby version
   install     Install a Ruby version using the ruby-build plugin
   uninstall   Uninstall a specific Ruby version
   rehash      Rehash rbenv shims (run this after installing executables)
   version     Show the current Ruby version and its origin
   versions    List all Ruby versions available to rbenv
   which       Display the full path to an executable
   whence      List all Ruby versions that contain the given executable

See `rbenv help &lt;command&gt;' for information on a specific command.
For full documentation, see: https://github.com/sstephenson/rbenv#readme

#こんな感じのコマンドが表示されていればOK
</pre></div></div>

<h2>
<span id="php-buildのインストール" class="fragment"></span><a href="#php-build%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>php-buildのインストール</h2>

<p>最近の流行りはphpenvのpluginとして使うのがナウなやり方らしいのでそちらの方法にしてみる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir -p /root/.phpenv/plugins
cd /root/.phpenv/plugins
git clone git://github.com/CHH/php-build.git
curl https://raw.github.com/hnw/php-build/plugin-to-chh-phpenv/bin/rbenv-install &gt; php-build/bin/rbenv-install
chmod 755 php-build/bin/rbenv-install

</pre></div></div>

<p>入っているかの確認</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv install 
usage: phpenv install VERSION

Available versions:
 5.2.17
 5.3.10
 5.3.11
 5.3.11RC1
 5.3.11RC2
 5.3.12
 5.3.13
 5.3.14
 5.3.15
 5.3.16
 5.3.17
 5.3.18
 5.3.19
 5.3.19RC1
 5.3.2
 5.3.20
 5.3.20RC1
 5.3.21
 5.3.3
 .
 .
 .
#上記のような表示がされればOK
</pre></div></div>

<h2>
<span id="依存モジュールのinstallcentos" class="fragment"></span><a href="#%E4%BE%9D%E5%AD%98%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AEinstallcentos"><i class="fa fa-link"></i></a>依存モジュールのinstall(centos)</h2>

<p>ここで結構ハマった。依存モジュール(centos内)が結構あったので<br>
クリーンな環境だと下記のモジュールのインストールが必要<br>
というかエラーが出た場合は基本「モジュール足らないよバカヤロー!!」が多いので<br>
エラーを見てググって yum install をひたすら繰り返す</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#epelのリポジトリがない場合はhttp://qiita.com/items/662e41376efa97251575を参照して追加してください
yum --enablerepo=epel install re2c libmcrypt libmcrypt-devel
yum install libxml2-devel bison bison-devel openssl-devel curl-devel libjpeg-devel libpng-devel libmcrypt-devel readline-devel libtidy-devel libxslt-devel httpd-devel enchant-devel libXpm libXpm-devel freetype-devel t1lib t1lib-devel gmp-devel libc-client-devel libicu-devel oniguruma-devel net-snmp net-snmp-devel bzip2-devel
</pre></div></div>

<p>PHP入れるのにこんなに依存関係あるのね。。。驚き。。。。</p>

<h2>
<span id="phpをビルド今回は5411" class="fragment"></span><a href="#php%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E4%BB%8A%E5%9B%9E%E3%81%AF5411"><i class="fa fa-link"></i></a>PHPをビルド（今回は5.4.11）</h2>

<p>全部入りを下記のブログを参照してやった<br>
<a href="http://d.hatena.ne.jp/sotarok/20120522/php_fpm_with_phpenv_and_php_build" rel="nofollow noopener" target="_blank">phpenv + php-build を使って 5.3 と 5.4 を共存させつつ php-fpm を使う</a><br>
自分はfpm入れてnginxも使用したいと思ったのでこれを参考にした<br>
オプション色々入れないなら依存パッケージがもっと減って上記のyumがもっとやりやすい</p>

<p>またphp-fpmは一回目のインストールした後に他のバージョンでも入れようとすると</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>You've configured multiple SAPIs to be build. You can build only
one SAPI module and CLI binary at the same time.
</pre></div></div>

<p>と怒られる。<br>
調べたがよくわからず<br>
<a href="http://ringogirl.hatenablog.jp/entry/2013/02/08/111329" rel="nofollow noopener" target="_blank">ココ</a>できっとphp-fpmは「複数入れられないんだなきっと」と納得して<br>
諦めてphp-fpmはバージョンが切り替えは諦めました。<br>
ていうかきっと誰かすごい人が作ってくれるでしょう。</p>

<h3>
<span id="前置きが長くなったが戻ってphp-buildの設定へphp-fpm込" class="fragment"></span><a href="#%E5%89%8D%E7%BD%AE%E3%81%8D%E3%81%8C%E9%95%B7%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%8C%E6%88%BB%E3%81%A3%E3%81%A6php-build%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%B8php-fpm%E8%BE%BC"><i class="fa fa-link"></i></a>前置きが長くなったが戻ってphp-buildの設定へ(php-fpm込)</h3>

<p>上記の問題があるので最新版のphp-fpmを持ってくる予定なので<br>
最初に最新版の5.4.11をインストールする</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/root/.phpenv/pluginsshare/php-build/definitions/5.4.11</span></div>
<div class="highlight"><pre><span></span>vim /usr/local/share/php-build/definitions/5.4.11

#下記を先頭に追加
configure_option "--with-apxs2=/usr/sbin/apxs --enable-fpm --enable-fileinfo --enable-hash --enable-json --enable-sysvsem --enable-sysvshm --enable-sysvmsg --enable-bcmath --with-bz2 --enable-ctype --with-iconv --enable-ftp --with-gettext --enable-mbstring --with-onig=/usr --with-pcre-regex --with-mysql=mysqlnd --with-mysql-sock=/tmp/mysql.sock --enable-phar --enable-shmop --enable-sockets --enable-simplexml --enable-dom --with-libxml-dir=/usr --enable-tokenizer --with-zlib --with-kerberos=/usr --with-openssl=/usr --enable-soap --enable-zip --with-mhash=yes --without-mm --with-enchant=/usr --with-zlib-dir=/usr --with-gd --enable-gd-native-ttf --with-gmp=/usr --with-jpeg-dir=/usr --with-xpm-dir=/usr/X11R6 --with-png-dir=/usr --with-freetype-dir=/usr --with-imap=/usr --with-imap-ssl --enable-intl --with-t1lib=/usr --with-mcrypt=/usr --with-snmp=/usr"
</pre></div>
</div>

<p>※mysqlはmysqld_multiなどでmysql.sockを変更していたら適時mysql.sockのパスに変更してください</p>

<p>そして実行</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv install 5.4.11


[Info]: Loaded apc Plugin.
[Info]: Loaded pyrus Plugin.
[Info]: Loaded xdebug Plugin.
[Info]: Loaded xhprof Plugin.
[Info]: php.ini-production gets used as php.ini
[Info]: Building 5.4.11 into /root/.phpenv/versions/5.4.11



[Pyrus]: Downloading from http://pear2.php.net/pyrus.phar
[Pyrus]: Installing executable in /root/.phpenv/versions/5.4.11/bin/pyrus
[XDebug]: Downloading http://xdebug.org/files/xdebug-2.2.1.tgz
[XDebug]: Compiling in /var/tmp/php-build/source/xdebug-2.2.1
[XDebug]: Installing XDebug configuration in /root/.phpenv/versions/5.4.11/etc/conf.d/xdebug.ini
[XDebug]: Cleaning up.
[Info]: The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the log in /tmp/php-build.5.4.11.20130219025032.log
[Success]: Built 5.4.11 successfully.
#入った 
</pre></div></div>

<h3>
<span id="liphp5soの退避" class="fragment"></span><a href="#liphp5so%E3%81%AE%E9%80%80%E9%81%BF"><i class="fa fa-link"></i></a>liphp5.soの退避</h3>

<p>退避しないと他のバージョン入れた時に上書きしてしまうので移動する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mv /etc/httpd/modules/libphp5.so /root/.phpenv/versions/5.4.11/
</pre></div></div>

<h2>
<span id="phpをビルド5321" class="fragment"></span><a href="#php%E3%82%92%E3%83%93%E3%83%AB%E3%83%895321"><i class="fa fa-link"></i></a>PHPをビルド（5.3.21）</h2>

<p>先程も説明した通りphp-fpmを入れようとするとエラーになるので今度は<br>
/usr/local/share/php-build/definitions/5.3.21のconfigure_optionのfpmを--disable-fpmに変更する<br>
（php-fpmを入れないようにする）</p>

<p>※mysqlはmysqld_multiなどでmysql.sockを変更していたら適時mysql.sockのパスに変更してください</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/root/.phpenv/pluginsshare/php-build/definitions/5.4.11</span></div>
<div class="highlight"><pre><span></span>vim /root/.phpenv/pluginsshare/php-build/definitions/5.4.11

#下記を先頭に追加
configure_option "--with-apxs2=/usr/sbin/apxs --disable-fpm --enable-fileinfo --enable-hash --enable-json --enable-sysvsem --enable-sysvshm --enable-sysvmsg --enable-bcmath --with-bz2 --enable-ctype --with-iconv --enable-ftp --with-gettext --enable-mbstring --with-onig=/usr --with-pcre-regex --with-mysql=mysqlnd --with-mysql-sock=/tmp/mysql.sock --enable-phar --enable-shmop --enable-sockets --enable-simplexml --enable-dom --with-libxml-dir=/usr --enable-tokenizer --with-zlib --with-kerberos=/usr --with-openssl=/usr --enable-soap --enable-zip --with-mhash=yes --without-mm --with-enchant=/usr --with-zlib-dir=/usr --with-gd --enable-gd-native-ttf --with-gmp=/usr --with-jpeg-dir=/usr --with-xpm-dir=/usr/X11R6 --with-png-dir=/usr --with-freetype-dir=/usr --with-imap=/usr --with-imap-ssl --enable-intl --with-t1lib=/usr --with-mcrypt=/usr --with-snmp=/usr"
</pre></div>
</div>

<p>インストールする</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv install 5.3.21


Info]: Loaded apc Plugin.
[Info]: Loaded pyrus Plugin.
[Info]: Loaded xdebug Plugin.
[Info]: Loaded xhprof Plugin.
[Info]: php.ini-production gets used as php.ini
[Info]: Building 5.3.21 into /root/.phpenv/versions/5.3.21



[Pyrus]: Downloading from http://pear2.php.net/pyrus.phar
[Pyrus]: Installing executable in /root/.phpenv/versions/5.3.21/bin/pyrus
[XDebug]: Downloading http://xdebug.org/files/xdebug-2.2.1.tgz
[XDebug]: Compiling in /var/tmp/php-build/source/xdebug-2.2.1
[XDebug]: Installing XDebug configuration in /root/.phpenv/versions/5.3.21/etc/conf.d/xdebug.ini
[XDebug]: Cleaning up.
[Info]: The Log File is not empty, but the Build did not fail. Maybe just warnings got logged. You can review the log in /tmp/php-build.5.3.21.20130219030118.log
[Success]: Built 5.3.21 successfully.
#入った 
</pre></div></div>

<h3>
<span id="liphp5soの退避-1" class="fragment"></span><a href="#liphp5so%E3%81%AE%E9%80%80%E9%81%BF-1"><i class="fa fa-link"></i></a>liphp5.soの退避</h3>

<p>退避しないと他のバージョン入れた時に上書きしてしまうので移動する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mv /etc/httpd/modules/libphp5.so /root/.phpenv/versions/5.3.21/
</pre></div></div>

<h2>
<span id="httpconfの設定変更" class="fragment"></span><a href="#httpconf%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>http.confの設定変更</h2>

<p>ここらへんは<a href="http://creator-life.net/modern-php-env/" rel="nofollow noopener" target="_blank">モダンなPHP開発環境を構築する<br>
phpenv + php-build で 複数のPHPバージョンを管理する<br>
</a>の内容をそのまま持ってきてます</p>

<div class="code-frame" data-lang="apacheconf">
<div class="code-lang"><span class="bold">/etc/httpd/conf/httpd.conf</span></div>
<div class="highlight"><pre><span></span><span class="c">#LoadModule php5_module        /usr/lib/httpd/modules/libphp5.so  ← コメントアウト</span>
</pre></div>
</div>

<p>でphp用の設定を/etc/httpd/conf.d/php.confに書き出す</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/httpd/conf.d/php.conf</span></div>
<div class="highlight"><pre><span></span>
#
# PHP is an HTML-embedded scripting language which attempts to make it
# easy for developers to write dynamically generated webpages.
#

LoadModule php5_module modules/libphp5.so

#
# Cause the PHP interpreter to handle files with a .php extension.
#
AddHandler php5-script .php
AddType text/html .php

#
# Add index.php to the list of files that will be served as directory
# indexes.
#
DirectoryIndex index.php

#
# Uncomment the following line to allow PHP to pretty-print .phps
# files as PHP source code:
#
#AddType application/x-httpd-php-source .phps

</pre></div>
</div>

<h2>
<span id="phpcliのバージョンが切り替わるか確認" class="fragment"></span><a href="#phpcli%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C%E5%88%87%E3%82%8A%E6%9B%BF%E3%82%8F%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>PHP(cli)のバージョンが切り替わるか確認</h2>

<p>コマンドラインのphpが切り替われるか確認する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#おまじない(クリーンアップみたいなもの？？)
phpenv rehash
php -v


rbenv: php: command not found

The `php' command exists in these Ruby versions:
  5.3.21
  5.4.11

#phpを複数入れてるのでどのバージョン使用するか決めてね！！ってエラーなんで

phpenv global 5.4.11
php -v


PHP 5.4.11 (cli) (built: Feb 19 2013 02:55:49) 
Copyright (c) 1997-2013 The PHP Group
Zend Engine v2.4.0, Copyright (c) 1998-2013 Zend Technologies
    with Xdebug v2.2.1, Copyright (c) 2002-2012, by Derick Rethans

#5.4.11になった


phpenv global 5.3.21
php -v


PHP 5.3.21 (cli) (built: Feb 19 2013 03:06:35) 
Copyright (c) 1997-2013 The PHP Group
Zend Engine v2.3.0, Copyright (c) 1998-2013 Zend Technologies
    with Xdebug v2.2.1, Copyright (c) 2002-2012, by Derick Rethans

#5.3.21になった
</pre></div></div>

<h2>
<span id="apache側のモジュールも切り替えられるようにする" class="fragment"></span><a href="#apache%E5%81%B4%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%82%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>apache側のモジュールも切り替えられるようにする</h2>

<p>garamonさんが作成した<a href="https://github.com/garamon/phpenv-apache-version" rel="nofollow noopener" target="_blank">phpenv-apache-version</a>を使用させてもらう</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/tmp</span></div>
<div class="highlight"><pre><span></span>git clone https://github.com/garamon/phpenv-apache-version
cd phpenv-apache-version
./install.sh
</pre></div>
</div>

<h2>
<span id="apacheモジュールが切り替えられるか確認する" class="fragment"></span><a href="#apache%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%8C%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>apacheモジュールが切り替えられるか確認する</h2>

<p>作ったスクリプトを叩く</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>phpenv apache-version 5.4.11
copy /root/.phpenv/versions/5.4.11/libphp5.so to /etc/httpd/modules
Restarting apache...
Stopping httpd:                                            [  OK  ]
Starting httpd:                                            [  OK  ]

#apacheの再起動と退避したlibphp5.soの切り替えを行う
</pre></div></div>

<h2>
<span id="ブラウザで確認してphpが切り替わっているか確認する" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6php%E3%81%8C%E5%88%87%E3%82%8A%E6%9B%BF%E3%82%8F%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ブラウザで確認してPHPが切り替わっているか確認する</h2>

<p><a href="">http://localhost/phpinfo.php</a>とか作って</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>&lt;?php
phpinfo();
</pre></div></div>

<p>と書いてアクセスしてPHPのバージョンが変わって入ればOK!!</p>

<p>本当はMYSQLとかのオプションの確認とかしたいけどとりあえずここまで<br>
結構エラーとか悩んたんで間違ってたら指摘とかお願いします！！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>41</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/4678b81221509810e811">virtualbox(centos)でnginx+php-fpm設定メモ(virturalhostの設定まで)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-25 00:20:02</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[nginx]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>環境 centos6.3（ゲストOS）macosx10.8(ホストOS)</p>

<p><a href="http://qiita.com/items/f4d32b90d74a3c7a60f4">nginxを以前入れた</a>のだが肝心のphpの設定をまだ指定なかったので設定のメモ。<br>
※上記エントリーと関連性がありません。単独でphp-fpmをインストールした場合の設定メモです。<br>
ついでに普段複数のサイトを開発する場合に必要なvirtualhostの設定まで</p>

<h2>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h2>

<ul>
<li>nginxがインストール済みの状態であること。インストールをしていない場合は<a href="http://qiita.com/items/f4d32b90d74a3c7a60f4">virtualbox(centos)でnginxインストールメモ</a>を参照してください。</li>
<li>ここから先は全てroo(権限)ユーザーで実行しています</li>
<li>開発環境構築の話です。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://www.nullpop.net/?p=215" rel="nofollow noopener" target="_blank">nginx+php-fpmでPHPを動かす。その3</a></li>
<li>[CentOS NginxとPHPの連携)](<a href="http://www.happytrap.jp/blogs/2012/02/25/8299/%5D(http://d.hatena.ne.jp/yoshi-ken/20120205)" class="autolink" rel="nofollow noopener" target="_blank">http://www.happytrap.jp/blogs/2012/02/25/8299/](http://d.hatena.ne.jp/yoshi-ken/20120205)</a>
</li>
<li><a href="http://shiken.infrabu.info/nginx/nginx%E3%83%90%E3%83%BC%E3%83%81%E3%83%A3%E3%83%AB%E3%83%9B%E3%82%B9%E3%83%88%E8%A8%AD%E5%AE%9A/" rel="nofollow noopener" target="_blank">nginxバーチャルホスト設定（http、server、locationブロック）</a></li>
</ul>

<h2>
<span id="php-fpmのインストール" class="fragment"></span><a href="#php-fpm%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>php-fpmのインストール</h2>

<p>centos標準のリポジトリにはないのでremiリポジトリから取得する<br>
remiのリポジトリの設定がない場合は<a href="http://qiita.com/items/662e41376efa97251575">外部リポジトリの追加（remi,epel）</a>を参照してください。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum --enablerepo=remi install php-fpm


Loaded plugins: fastestmirror, priorities, security
Loading mirror speeds from cached hostfile
 * base: ftp.riken.jp
 * extras: ftp.riken.jp
 * updates: ftp.riken.jp
135 packages excluded due to repository priority protections
Setting up Install Process
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package php-fpm.x86_64 0:5.4.12-1.el5.remi will be installed
--&gt; Processing Dependency: php-common = 5.4.12-1.el5.remi for package: php-fpm-5.4.12-1.el5.remi.x86_64
--&gt; Running transaction check
---&gt; Package php-common.x86_64 0:5.4.12-1.el5.remi will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

=====================================================================================================
 Package                 Arch                Version                         Repository         Size
=====================================================================================================
Installing:
 php-fpm                 x86_64              5.4.12-1.el5.remi               remi              1.5 M
Installing for dependencies:
 php-common              x86_64              5.4.12-1.el5.remi               remi              1.0 M

Transaction Summary
=====================================================================================================
Install       2 Package(s)

Total download size: 2.5 M
Installed size: 10 M
Is this ok [y/N]: y
Downloading Packages:
(1/2): php-common-5.4.12-1.el5.remi.x86_64.rpm                                | 1.0 MB     00:04     
(2/2): php-fpm-5.4.12-1.el5.remi.x86_64.rpm                                   | 1.5 MB     00:04     
-----------------------------------------------------------------------------------------------------
Total                                                                259 kB/s | 2.5 MB     00:09     
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : php-common-5.4.12-1.el5.remi.x86_64                                               1/2 

WARNING : These php-* RPM are not official Fedora/Redhat build and
overrides the official ones. Don't file bugs on Fedora Project nor Redhat.

Use dedicated forums http://forums.famillecollet.com/

  Installing : php-fpm-5.4.12-1.el5.remi.x86_64                                                  2/2 
  Verifying  : php-common-5.4.12-1.el5.remi.x86_64                                               1/2 
  Verifying  : php-fpm-5.4.12-1.el5.remi.x86_64                                                  2/2 

Installed:
  php-fpm.x86_64 0:5.4.12-1.el5.remi                                                                 

Dependency Installed:
  php-common.x86_64 0:5.4.12-1.el5.remi                                                              

Complete!

</pre></div></div>

<p>入った。</p>

<h2>
<span id="php-fpmの確認" class="fragment"></span><a href="#php-fpm%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>php-fpmの確認</h2>

<h3>
<span id="バージョン確認" class="fragment"></span><a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>バージョン確認</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php-fpm -v
PHP 5.4.12 (fpm-fcgi) (built: Feb 20 2013 14:06:12)
Copyright (c) 1997-2013 The PHP Group
Zend Engine v2.4.0, Copyright (c) 1998-2013 Zend Technologies
</pre></div></div>

<h3>
<span id="php-fpmの起動" class="fragment"></span><a href="#php-fpm%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>php-fpmの起動</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/php-fpm start
php-fpm を起動中: 
</pre></div></div>

<h2>
<span id="nginxの設定" class="fragment"></span><a href="#nginx%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>nginxの設定</h2>

<p>nginxにPHPの設定を追加しましょう</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/nginx/conf.d/default.conf</span></div>
<div class="highlight"><pre><span></span>vim /etc/nginx/conf.d/default.conf



server {
    listen       80;
    server_name  lo.test.org;
    location ~ \.php$ {
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /home/web/lo.test.org/www$fastcgi_script_name;
        include        fastcgi_params;
    }
}

server {
    listen       80;
    server_name  lo.sample.org;
    root   /home/web/lo.sample.org/www;
    index  index.php index.html index.htm;
    location ~ \.php$ {
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /home/web/lo.sample.org/www$fastcgi_script_name;
        include        fastcgi_params;
    }
}

</pre></div>
</div>

<p>serverディレクティブにそれぞれ server_nameを追加してserverディレクティブのlocationの項目にroot(apacheで言うドキュメントルート)を追加する。<br>
fastcgi_paramにはドキュメントルート+$fastcgi_script_nameを追加する</p>

<h2>
<span id="nginxの起動" class="fragment"></span><a href="#nginx%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginxの起動</h2>

<p>apacheと一緒</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/nginx restart


httpd を停止中:                                            [  OK  ]
nginx を起動中:                                            [  OK  ]
</pre></div></div>

<h2>
<span id="動作確認用のphpファイルを設置" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E7%94%A8%E3%81%AEphp%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%A8%AD%E7%BD%AE"><i class="fa fa-link"></i></a>動作確認用のphpファイルを設置</h2>

<p>いつもどおりで</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">ドキュメントルート/phpinfo.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">phpinfo</span><span class="p">();</span>
</pre></div>
</div>

<p>上記の設定の場合は<br>
/home/web/lo.sample.org/www/phpinfo.php<br>
/home/web/lo.test.org/www/phpinfo.php<br>
の２つに設定してください。</p>

<h2>
<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h2>

<p>上記の設定の場合は<br>
<a href="http://lo.sample.org/phpinfo.php" class="autolink" rel="nofollow noopener" target="_blank">http://lo.sample.org/phpinfo.php</a><br>
<a href="http://lo.test.org/phpinfo.php" class="autolink" rel="nofollow noopener" target="_blank">http://lo.test.org/phpinfo.php</a><br>
でphpinfoの中身が見えればOK!!</p>

<p>一番php-fpmがイマイチピンとこなくてnginxの設定に億劫でしたがやってみたら意外と簡単でしたのでお試しあれ</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>39</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/e41a821a8287091d7510">virtualbox(centos)にjenkins+nginxでインストールする方法メモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-28 22:49:29</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[nginx]</b> <b>[Jenkins]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>自動タスクはjenkinsですよね！！ってとある人に言われた。<br>
存在は知っているが入れた事はない<br>
では「いつやるか？」<br>
「今でしょう！！」<br>
またcentosがCUIなのでnginxのリバースプロキシ経由でホストOS側から参照できるようにする</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3（ゲストOS）</li>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>ここから先は全てroo(権限)ユーザーで実行しています</li>
<li>nginx ※入れてない方は<a href="http://qiita.com/items/40b527c390f068985f75">virtualbox(centos)でnginxをwebsocketを使用出来る状態でインストールする方法メモ</a>を参照してください</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+RedHat+distributions" rel="nofollow noopener" target="_blank">jenkins本家</a></li>
<li><a href="http://d.hatena.ne.jp/FGtatsuro/20120603/1338653541" rel="nofollow noopener" target="_blank">さくらのVPSにJenkins/Nginxをインストールする</a></li>
</ul>

<h2>
<span id="javaのインストール古いバージョンの場合はアンインストール" class="fragment"></span><a href="#java%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E5%8F%A4%E3%81%84%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AF%E3%82%A2%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>javaのインストール（古いバージョンの場合はアンインストール）</h2>

<p>jenkinsはjavaが1.6.0 &lt; しか動かないらしいです。（本当か？）<br>
centosのデフォルトのバージョンだとjavaが1.5系なのでもしjavaが既に入ってる場合はアンインストールしましょう。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>java -version


java version "1.5.0_24"
OpenJDK Runtime Environment (IcedTea6 1.11.8) (rhel-1.56.1.11.8.el6_3-x86_64)
OpenJDK 64-Bit Server VM (build 20.0-b12, mixed mode)
</pre></div></div>

<h3>
<span id="入ってた場合" class="fragment"></span><a href="#%E5%85%A5%E3%81%A3%E3%81%A6%E3%81%9F%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>入ってた場合</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum remove java
</pre></div></div>

<h2>
<span id="javaのインストール" class="fragment"></span><a href="#java%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>javaのインストール</h2>

<p>本家どおりで問題なし</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum install java-1.6.0-openjdk java-1.6.0-openjdk-devel
</pre></div></div>

<h2>
<span id="jenkinsのリポジトリの追加とjenkins本体のインストール" class="fragment"></span><a href="#jenkins%E3%81%AE%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%AE%E8%BF%BD%E5%8A%A0%E3%81%A8jenkins%E6%9C%AC%E4%BD%93%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>jenkinsのリポジトリの追加とjenkins本体のインストール</h2>

<p>これも本家通りでOK</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo
rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key
yum install jenkins
</pre></div></div>

<h2>
<span id="jenkinsの設定の追加" class="fragment"></span><a href="#jenkins%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>jenkinsの設定の追加</h2>

<p>nginxにリバースプロキシの設定をかけるためには以下のファイルを編集する必要がある</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/sysconfig/jenkins</span></div>
<div class="highlight"><pre><span></span>vim /etc/sysconfig/jenkins

#修正前
JENKINS_ARGS=""
#修正後
JENKINS_ARGS="--prefix=/jenkins --httpPort=${JENKINS_PORT} --ajp13Port=${JENKINS_AJP_PORT}"
</pre></div>
</div>

<h2>
<span id="nginxのjenkinsの設定" class="fragment"></span><a href="#nginx%E3%81%AEjenkins%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>nginxのjenkinsの設定</h2>

<p>ソースからコンパイルしている場合は/usr/local/nginx/conf/nginx.confとか<br>
yumでインストールしている場合は<br>
/etc/nginx/conf/conf.d/default.confとかにあります。<br>
httpディレクティブの項目に追加するだけです。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/nginx/conf/nginx.conf</span></div>
<div class="highlight"><pre><span></span>http {
#下記の項目を追加
    #jekins 
    server {
        listen 80;
        server_name lo.jenkins.org; #host名
        location /jenkins {
            proxy_pass http://localhost:8080;
        }
    }
}
</pre></div>
</div>

<h2>
<span id="jenkinsの起動" class="fragment"></span><a href="#jenkins%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>jenkinsの起動</h2>

<p>いつもどおり</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/jenkins start
Starting Jenkins                                           [  OK  ]
</pre></div></div>

<h3>
<span id="jenkinsの自動起動設定" class="fragment"></span><a href="#jenkins%E3%81%AE%E8%87%AA%E5%8B%95%E8%B5%B7%E5%8B%95%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>jenkinsの自動起動設定</h3>

<p>これもいつもどおり</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chkconfig jenkins on
</pre></div></div>

<h2>
<span id="nginxの再起動" class="fragment"></span><a href="#nginx%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginxの再起動</h2>

<p>動いていなければstartだけOKです。ちなみにrestartだと動かなかったです。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/nginx stop
nginx を停止中:                                            [  OK  ]


/etc/init.d/nginx start
nginx を起動中:                                            [  OK  ]
</pre></div></div>

<h2>
<span id="hostos側のhostsを追加" class="fragment"></span><a href="#hostos%E5%81%B4%E3%81%AEhosts%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>hostOS側のhostsを追加</h2>

<p>ローカル環境だと思うので</p>

<h3>
<span id="ifconfigで自分のipを調べる" class="fragment"></span><a href="#ifconfig%E3%81%A7%E8%87%AA%E5%88%86%E3%81%AEip%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>ifconfigで自分のipを調べる</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ifconfig

#下記の項目(inet)がどこかにあるのでメモしておく（デフォルトだと192.168.xx.xxx）なはず
inet addr:192.168.56.101
</pre></div></div>

<h3>
<span id="hostsファイルの編集" class="fragment"></span><a href="#hosts%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>hostsファイルの編集</h3>

<p>※windowsの場合は「windows host」とかでググってください。<br>
今回はmacの場合で説明します</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/hosts</span></div>
<div class="highlight"><pre><span></span>sudo vim /etc/hosts

192.168.56.101  lo.jenkins.org #ifconfigで調べたipとホストOSから見る場合のvirtualhostを指定する
</pre></div>
</div>

<h2>
<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h2>

<p>hostsで書いたアドレスにアクセス<br>
今回は<a href="http://lo.jenkins.org/jenkins" rel="nofollow noopener" target="_blank">http://lo.jenkins.org/jenkins</a>にアクセスしてjenkinsが見えればOK!!</p>

<p>大体２０分くらいでできました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/31029ea9ac3fcb34abdc">そうだvirtualboxを使ってみよう</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-20 19:21:36</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[VirtualBox]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>まあ<a href="http://www.mamp.info/en/index.html" rel="nofollow noopener" target="_blank">MAMP</a>とか<a href="http://www.apachefriends.org/jp/xampp-windows.html" rel="nofollow noopener" target="_blank">XAMPP</a>とかでもいいんですがlinux側(centos)もっと触りたーいとか<br>
MACの環境はクリーンなほうがいい〜とかあるわけで自分は後者でMACにはxcodeとvim拡張ぐらいしかいれないクリーンな環境を保持したいので<br>
書いてみました。<br>
homebrewでもいいんですがそれを見つけるためにまたググるのが億劫で。。。</p>

<p>環境 macosx10.8(ホストOS) centos6.3 x86(ゲストOS)</p>

<ul>
<li>多分windowsでもほぼ同様にいけると思います。</li>
<li>ホストOSが32bitのバージョンの場合は落とすisoは32bit版を落としてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://blog.asial.co.jp/634" rel="nofollow noopener" target="_blank">仮想環境VirtualBoxでのネットワークの設定</a></li>
<li><a href="http://d.hatena.ne.jp/Yudoufu/20100117/1263677767" rel="nofollow noopener" target="_blank">[virtualbox][network][tips] VirtualBox を利用する際のネットワーク設定の話</a></li>
<li><a href="http://arpanet617.blog.fc2.com/blog-entry-33.html" rel="nofollow noopener" target="_blank">VirtualBox for OSX に Linux(CentOS6.3)をインストール </a></li>
</ul>

<h2>
<span id="利便性について" class="fragment"></span><a href="#%E5%88%A9%E4%BE%BF%E6%80%A7%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>利便性について</h2>

<p>virtualboxは仮想環境のエキスポートで他のメンバーに自分の環境を渡すことができます。<br>
設定といえば共有フォルダの設定変更くらいです。<br>
ネットワークの再設定とかも必要なしです。</p>

<h2>
<span id="用語の説明" class="fragment"></span><a href="#%E7%94%A8%E8%AA%9E%E3%81%AE%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>用語の説明</h2>

<p>自分は正直linux詳しくないのでまず用語がわからないので苦労した<br>
よくググると出てくるキーワード</p>

<h4>
<span id="ホストos" class="fragment"></span><a href="#%E3%83%9B%E3%82%B9%E3%83%88os"><i class="fa fa-link"></i></a>ホストOS</h4>

<hr>

<p>これは自分の使っているマシンのことを指します</p>

<h4>
<span id="ゲストos" class="fragment"></span><a href="#%E3%82%B2%E3%82%B9%E3%83%88os"><i class="fa fa-link"></i></a>ゲストOS</h4>

<hr>

<p>入れたいOSのことです。今回はcentOSを入れる予定なのでcentOSを指します。</p>

<h2>
<span id="virtualboxの入手" class="fragment"></span><a href="#virtualbox%E3%81%AE%E5%85%A5%E6%89%8B"><i class="fa fa-link"></i></a>virtualboxの入手</h2>

<p>まずはここから<br>
<a href="https://www.virtualbox.org/wiki/Downloads" rel="nofollow noopener" target="_blank">Download VirtualBox</a></p>

<p>MACの場合はforOSX、winの場合はforwindows hostsを落としてきてください。</p>

<h2>
<span id="osディスクの入手" class="fragment"></span><a href="#os%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%81%AE%E5%85%A5%E6%89%8B"><i class="fa fa-link"></i></a>OSディスクの入手</h2>

<p>ここから入手しましょ</p>

<ul>
<li>(centos6.3 64bit版)<a href="http://ftp.iij.ad.jp/pub/linux/centos/6.3/isos/x86_64/CentOS-6.3-x86_64-bin-DVD1.iso" rel="nofollow noopener" target="_blank">ミラーサイト</a>
</li>
<li>(centos6.3 32bit版)<a href="http://ftp.iij.ad.jp/pub/linux/centos/6.3/isos/i386/CentOS-6.3-i386-bin-DVD1.iso" rel="nofollow noopener" target="_blank">ミラーサイト</a>
</li>
</ul>

<p>※今回は64bit版で話しを進めます</p>

<h2>
<span id="virtualboxネットワーク設定について" class="fragment"></span><a href="#virtualbox%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>virtualboxネットワーク設定について</h2>

<p><a href="http://d.hatena.ne.jp/Yudoufu/20100117/1263677767" rel="nofollow noopener" target="_blank">[virtualbox][network][tips] VirtualBox を利用する際のネットワーク設定の話</a>で詳しいお話が載っています。</p>

<p>以下引用 <a href="http://d.hatena.ne.jp/Yudoufu/20100117/1263677767" rel="nofollow noopener" target="_blank">[virtualbox][network][tips] VirtualBox を利用する際のネットワーク設定の話</a></p>

<blockquote>
<p>仮想マシンをローカルマシン上で使用する場合、大体の人が実現したいネットワークの構成としては、<br>
GuestOSは外部ネットワークに対してアクセスできてほしい。<br>
GuestOSは基本的に外部ネットワークからは遮断しておきたい。<br>
でも、HostOSに限り、外部からアクセスできてほしい。<br>
という構成かな、と勝手に思っていたりする。</p>
</blockquote>

<p>という構成にしたので<br>
NAT + Host-Onlyの設定にします。</p>

<p>ネットワークの設定については<a href="http://blog.asial.co.jp/634" rel="nofollow noopener" target="_blank">仮想環境VirtualBoxでのネットワークの設定</a>を参考にして済ましてください。<br>
またMACの場合は標準でホストオンリーアダプタを設定するとエラーになりますのでvirtualboxの環境設定からネットワークを開きホストオンリーネットワークを作成しておいてください。</p>

<p>くわしいのは<a href="http://sora2hs.blog70.fc2.com/blog-entry-538.html" rel="nofollow noopener" target="_blank">[virtualbox] virtualbox のネットワーク設定（ホストオンリーアダプタ）</a>をみてください。</p>

<h2>
<span id="ゲストoscentosの起動まで" class="fragment"></span><a href="#%E3%82%B2%E3%82%B9%E3%83%88oscentos%E3%81%AE%E8%B5%B7%E5%8B%95%E3%81%BE%E3%81%A7"><i class="fa fa-link"></i></a>ゲストOS(centos)の起動まで</h2>

<p><a href="http://arpanet617.blog.fc2.com/blog-entry-33.html" rel="nofollow noopener" target="_blank">VirtualBox for OSX に Linux(CentOS6.3)をインストール </a>のVirtualBox for OSX に Linux(CentOS6.3)をインストールを参考にしてcentOSのインストール画面までやってみてください。</p>

<p>※注意 virtualboxのストレージの容量についてですがはじめの設定値が途中で変更する場合結構大変（いろんなツール入れてゴニョゴニョしなくては行けない）なのでそれなりの容量を初期に確保することをおすすめします（自分は60GBくらいに設定しました）</p>

<h2>
<span id="ゲストoscentosのインストール" class="fragment"></span><a href="#%E3%82%B2%E3%82%B9%E3%83%88oscentos%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ゲストOS(centos)のインストール</h2>

<p>非常によくまとまっているインストールまで流れが下記に紹介されていますのでやってみてください。</p>

<p><a href="http://d.hatena.ne.jp/sotarok/20070807/1186502582" rel="nofollow noopener" target="_blank">#04 CentOS5のインストール::VMWare×CentOS5　Windowsでカンタン開発環境</a></p>

<p>VMwareでのお話をしていますが起動したらVMもvirtualboxも一緒です。</p>

<p>自分は言語選択を「英語」<br>
インストールパッケージ選択を「ベース」のみで構成しました。<br>
インストール後必要なものを随時yun install する感じですね</p>

<h2>
<span id="インストール完了後にやること" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E5%AE%8C%E4%BA%86%E5%BE%8C%E3%81%AB%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>インストール完了後にやること</h2>

<p>ここまでで慣れればだいたい１時間くらいでできると思います。<br>
続いて最低限の開発環境を設定をしましょう。</p>

<h2>
<span id="ネットワークの設定" class="fragment"></span><a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ネットワークの設定</h2>

<p>最初の状態だとネットワークアダプタの設定が有効になっていない為通信ができない状態ですのでネットワークの設定をしましょう</p>

<p>ネットワーク設定をNAT + hostOnlyアダプタで設定している場合ですと</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/sysconfig/network-scripts/ifcfg-eth0
</pre></div></div>

<p>がNATの設定で</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/sysconfig/network-scripts/ifcfg-eth1
</pre></div></div>

<p>がHostOnlyアダプタの設定になります<br>
まあどっちも有効するだけです。</p>

<h3>
<span id="natの自動boot" class="fragment"></span><a href="#nat%E3%81%AE%E8%87%AA%E5%8B%95boot"><i class="fa fa-link"></i></a>NATの自動boot</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim /etc/sysconfig/network-scripts/ifcfg-eth0

#修正前
ONBOOT="no"
#修正後
ONBOOT="yes"
</pre></div></div>

<h3>
<span id="hostonlyアダプタの自動boot" class="fragment"></span><a href="#hostonly%E3%82%A2%E3%83%80%E3%83%97%E3%82%BF%E3%81%AE%E8%87%AA%E5%8B%95boot"><i class="fa fa-link"></i></a>hostOnlyアダプタの自動boot</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim /etc/sysconfig/network-scripts/ifcfg-eth1

#修正前
ONBOOT="no"
#修正後
ONBOOT="yes"
</pre></div></div>

<h3>
<span id="ネットワーク再起動" class="fragment"></span><a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>ネットワーク再起動</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>service network restart
</pre></div></div>

<h3>
<span id="外部接続確認" class="fragment"></span><a href="#%E5%A4%96%E9%83%A8%E6%8E%A5%E7%B6%9A%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>外部接続確認</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd /tmp
wget http://google.co.jp
#htmlが保存されれば外部通信ができている
</pre></div></div>

<h2>
<span id="一般ユーザーの作成" class="fragment"></span><a href="#%E4%B8%80%E8%88%AC%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>一般ユーザーの作成</h2>

<p>ザクっと</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>useradd ユーザー名
passwd ユーザー名
#パスワードを入力する
</pre></div></div>

<h2>
<span id="yum-update" class="fragment"></span><a href="#yum-update"><i class="fa fa-link"></i></a>yum update</h2>

<p>これもサクッと</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum -y install yum-fastestmirror
 yum -y update
</pre></div></div>

<h2>
<span id="selinuxを止める" class="fragment"></span><a href="#selinux%E3%82%92%E6%AD%A2%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>selinuxを止める</h2>

<p>こいつが色々悪さをするのでまず止めましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#SELinux状態確認
getenforce
Enforcing #有効になってる
#SELinux無効化
setenforce 0
#SELinux状態確認
getenforce
#SELinux無効
Permissive

#SELinuxの無効化
vim /etc/sysconfig/selinux
#編集前
SELINUX=enforcing
#編集後
SELINUX=disabled
</pre></div></div>

<h2>
<span id="sshの設定" class="fragment"></span><a href="#ssh%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>sshの設定</h2>

<p>これさえ入れればホストOSからターミナルで入れるので入れましょう。</p>

<h3>
<span id="参考にしたサイト-1" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88-1"><i class="fa fa-link"></i></a>参考にしたサイト</h3>

<ul>
<li><a href="http://d.hatena.ne.jp/sotarok/20080108/vmware_centos5_ssh" rel="nofollow noopener" target="_blank">#6.5 sshの設定・scpの使い方</a></li>
</ul>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>rpm -qa | grep ssh


openssh-4.3p2-16.el5
openssh-clients-4.3p2-16.el5
openssh-server-4.3p2-16.el5
#既に入ってる
</pre></div></div>

<h3>
<span id="sshの設定-1" class="fragment"></span><a href="#ssh%E3%81%AE%E8%A8%AD%E5%AE%9A-1"><i class="fa fa-link"></i></a>SSHの設定</h3>

<p><a href="http://d.hatena.ne.jp/sotarok/20080108/vmware_centos5_ssh" rel="nofollow noopener" target="_blank">#6.5 sshの設定・scpの使い方</a>でも言われていますが</p>

<blockquote>
<p>公開サーバではパスワードログインは許可せず、必ず鍵認証をすること&gt;をオススメします。というか、してください。</p>
</blockquote>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim /etc/ssh/sshd_config


Protocol 2
PermitRootLogin no
PermitEmptyPasswords no
PasswordAuthentication yes
</pre></div></div>

<h3>
<span id="sshの起動" class="fragment"></span><a href="#ssh%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>SSHの起動</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#sshdの起動
/etc/init.d/sshd start

#OS起動時に自動で起動する設定
chkconfig sshd on
</pre></div></div>

<h3>
<span id="接続確認" class="fragment"></span><a href="#%E6%8E%A5%E7%B6%9A%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>接続確認</h3>

<p>ゲストOS側(CentOS)のIPを調べる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$ifconfig

#下記の項目(inet)がどこかにあるのでメモしておく（デフォルトだと192.168.xx.xxx）なはず
inet addr:192.168.56.101
</pre></div></div>

<p>調べたIPで接続する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ssh ユーザー名@調べたIPアドレス
</pre></div></div>

<h2>
<span id="これで最低限の開発環境は揃いました" class="fragment"></span><a href="#%E3%81%93%E3%82%8C%E3%81%A7%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%81%AF%E6%8F%83%E3%81%84%E3%81%BE%E3%81%97%E3%81%9F"><i class="fa fa-link"></i></a>これで最低限の開発環境は揃いました。</h2>

<p>元々は<a href="http://d.hatena.ne.jp/sotarok/20070728/1185563920" rel="nofollow noopener" target="_blank">#00 VMWare×CentOS5　Windowsでカンタン開発環境</a>を見てvirtualboxでも同じ風なセットアップ方法を書きたいなーと思って書きました。（引用が多くてごめんなさい）</p>

<p>またこの状態で一旦virtulaboxのスナップショットの保存しておくことおすすめします。</p>

<p>ちょっとqiitaだと画像アップとかないので自前でうまく説明することができませんでした。。<br>
中の人kobitoとかに機能つけてくれれば嬉しいな。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>31</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/c99215e25bd2ff846207">今日作りたくなる簡単cookbook [Kim&apos;sキッチン] yumsetup(yum-fastestmirrorにyum update添え)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-15 01:05:40</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[chef]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下全ても●みち風に書いたメモ</p>

<p>皆さんおはようございます。<br>
<a href="http://qiita.com/users/ryurock@github">ryurock@github</a>です。</p>

<div class="code-frame" data-lang="メザポン(32歳)"><div class="highlight"><pre><span></span>
私は毎回サーバーを立ち上げた後に行うyum-fastestmirrorと
時間がかかるyum -y updateが大好きです。
そこでyum-fastestmirrorとyum -y update の簡単なcookbookを教えてください。

</pre></div></div>

<p>今日はそんなyumが大好きな方に簡単なcookbookをknife-soloでご紹介したいと思います。</p>

<h2>
<span id="レシピ作成時間" class="fragment"></span><a href="#%E3%83%AC%E3%82%B7%E3%83%94%E4%BD%9C%E6%88%90%E6%99%82%E9%96%93"><i class="fa fa-link"></i></a>レシピ作成時間</h2>

<p>約3分</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>mac-osx（ホストOS）</li>
<li>centos6.4-x86-minimal (ゲストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>virtualbox</li>
<li>ruby 1.9.3p327 (rbenv) ※1.9.3-p286でもいけた</li>
<li>chef ※入れていない方は<code>gem install chef</code>とshellから打ってください</li>
<li>vagrant ※入れていない方は<a href="http://qiita.com/items/3cb756a9c951371a4089">chef-soloで使用するvirtualbox(vagrant)をveeweeを使用して作る</a>を参考に入れておいてください</li>
<li>git</li>
</ul>

<h2>
<span id="参考にしたサイト書籍" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88%E6%9B%B8%E7%B1%8D"><i class="fa fa-link"></i></a>参考にしたサイト（書籍）</h2>

<ul>
<li>
<a href="http://tatsu-zine.com/books/chef-solo" rel="nofollow noopener" target="_blank">入門ChefSolo-InfrastructureasCode-1.0.0</a>(達人出版)</li>
<li><a href="http://tsuchikazu.net/chef_solo_start/" rel="nofollow noopener" target="_blank">Chef Soloの正しい始め方</a></li>
</ul>

<h2>
<span id="前準備---chef-solo-init-----knife-solo-prepare--" class="fragment"></span><a href="#%E5%89%8D%E6%BA%96%E5%82%99---chef-solo-init-----knife-solo-prepare--"><i class="fa fa-link"></i></a>前準備 - chef solo init - - knife solo prepare -</h2>

<p>この２つは最初の一回のみ。すでに実行済みの場合は「その1」の項目へ</p>

<h3>
<span id="リポジトリを作成する" class="fragment"></span><a href="#%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>リポジトリを作成する</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>knife solo init chef-repo
</pre></div></div>

<p>概念的にはgit initと一緒です。<br>
「ここにchefする場所を作るよ！！」と宣言します。</p>

<h3>
<span id="リモートでの-chef-solo-実行環境を整える" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%81%A7%E3%81%AE-chef-solo-%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83%E3%82%92%E6%95%B4%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>リモートでの chef-solo 実行環境を整える</h3>

<p>要はsshの設定です。<br>
vagrantで設定している場合はホストOS(mac)で下記のように</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd VagrantFileがおいてあるディレクトリ
vagrant ssh-config --host {接続名称（任意）} &gt;&gt; ~/.ssh/config
</pre></div></div>

<p>vagrantのssh設定を登録する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife solo prepare {接続名称（任意）}
</pre></div></div>

<h2>
<span id="その１-レシピ名を決める" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%91-%E3%83%AC%E3%82%B7%E3%83%94%E5%90%8D%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>[その１] レシピ名を決める</h2>

<p>今回のレシピ名はyumsetupで行きましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife cookbook create yumsetup -o site-cookbooks
</pre></div></div>

<h2>
<span id="その2-chef-repoyumsetuprecipesdefaultrbを編集" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE2-chef-repoyumsetuprecipesdefaultrb%E3%82%92%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>[その2] chef-repo/yumsetup/recipes/default.rbを編集</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/yumsetup/recipes/default.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s2">"yum-fastestmirror"</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s2">"yum-update"</span> <span class="k">do</span>
  <span class="n">user</span> <span class="s2">"root"</span>
  <span class="n">command</span> <span class="s2">"yum -y update"</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>

<p>ruby知らなくてもわかる内容ですね。</p>

<p><a href="http://docs.opscode.com/resource.html" rel="nofollow noopener" target="_blank">Chef Resources</a>を使用した</p>

<ul>
<li><a href="http://docs.opscode.com/resource_yum.html" rel="nofollow noopener" target="_blank">yum_package</a></li>
<li><a href="http://docs.opscode.com/resource_execute.html" rel="nofollow noopener" target="_blank">execute</a></li>
</ul>

<p>上記２つで実行しています。</p>

<h2>
<span id="その3yumsetup-cookbookをリモート側で実行する設定を追加" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE3yumsetup-cookbook%E3%82%92%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E8%A8%AD%E5%AE%9A%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>[その3]yumsetup cookbookをリモート側で実行する設定を追加</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim chef-repo/nodes/{接続名称（任意）}.json

{"run_list":[
    "yumsetup"
]}
</pre></div></div>

<p>これだけ</p>

<h2>
<span id="その4-リモート側に実行依頼をする" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE4-%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%AB%E5%AE%9F%E8%A1%8C%E4%BE%9D%E9%A0%BC%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>[その4] リモート側に実行依頼をする</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife solo cook {接続名称（任意）}


Starting Chef Client, version 11.4.0
Compiling Cookbooks...
Converging 2 resources
Recipe: yumsetup::default
  * yum_package[yum-fastestmirror] action install (up to date)
  * execute[yum-update] action run
    - execute yum -y update

Chef Client finished, 1 resources updated
</pre></div></div>

<p>2つ命令を書いているが１つしか実行されないのはyum-fastestmirrorがすでにインストール済みであるからです。（chefは冪等性を保証さするものって<a href="http://tatsu-zine.com/books/chef-solo" rel="nofollow noopener" target="_blank">入門ChefSolo-InfrastructureasCode-1.0.0</a>に書いてありました）</p>

<h2>
<span id="今日はこれで決まりyum-fastestmirrorにyum-update添えの完成です" class="fragment"></span><a href="#%E4%BB%8A%E6%97%A5%E3%81%AF%E3%81%93%E3%82%8C%E3%81%A7%E6%B1%BA%E3%81%BE%E3%82%8Ayum-fastestmirror%E3%81%AByum-update%E6%B7%BB%E3%81%88%E3%81%AE%E5%AE%8C%E6%88%90%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>今日はこれで決まり「yum-fastestmirrorにyum update添え」の完成です</h2>

<p>たった４ステップ、書いた行数は１５行未満で出来上がりです。<br>
chef-soloはそんなに敷居が高く無いので是非ご参考に</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>30</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/f5e25699961824376454">CentOSでFuelPHPをnginxで動かしてみたときのメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-07 01:03:36</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>FuelPHPを触ることになったのでnginxで動作させてみた時のメモ</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3（ゲストOS）</li>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
<li>php-fpm</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://press.nekoget.com/fuelphp_doc/installation/instructions.html#manual" rel="nofollow noopener" target="_blank">日本語版ドキュメント</a></li>
</ul>

<h2>
<span id="公式サイトからfuelphpを取得する" class="fragment"></span><a href="#%E5%85%AC%E5%BC%8F%E3%82%B5%E3%82%A4%E3%83%88%E3%81%8B%E3%82%89fuelphp%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>公式サイトからFuelPHPを取得する</h2>

<p><a href="http://fuelphp.com/" rel="nofollow noopener" target="_blank">公式サイト</a>にいってDownloadボタンをポチッと押して自分のドキュメントルートに持っていく</p>

<p>構成はこんな感じ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>unzip fuelphp-1.5.2.zip
</pre></div></div>

<h2>
<span id="oilでインストールする" class="fragment"></span><a href="#oil%E3%81%A7%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>oilでインストールする</h2>

<p>展開したディレクトリにoilというファイルがあるのでそこで下記のコマンドを実行する。<br>
日本語版公式どおりです</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>sudo php oil refine install
</pre></div></div>

<h2>
<span id="nginxの設定" class="fragment"></span><a href="#nginx%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>nginxの設定</h2>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/nginx/conf/nginx.conf</span></div>
<div class="highlight"><pre><span></span>http {
    .
    .
    .
    server {
        listen       80; #ポート番号
        server_name  lo.fuel.master.org; #バーチャルホスト名
        root   /home/web/lo.fuel.master.org/public; #FuelPHPのデフォルトのpublicディレクトリ
        index  index.php index.html index.htm;
        access_log  /usr/local/nginx/logs/access.log;

        # Rewrite FuelPHP
        location / {
            if (-f $request_filename) {
                expires 30d;
                break;
            }
            if (!-e $request_filename) {
                rewrite ^(.*)$ /index.php?q=$1 last;
            }
        }

        location ~ \.php$ {
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include        fastcgi_params;
        }
    }
}

</pre></div>
</div>

<h2>
<span id="nginxの再起動" class="fragment"></span><a href="#nginx%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginxの再起動</h2>

<p>いつもどおり</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/nginx stop
/etc/init.d/nginx start
</pre></div></div>

<h2>
<span id="ブラウザで確認する" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ブラウザで確認する</h2>

<p>今回なら<a href="http://lo.fuel.master.org" rel="nofollow noopener" target="_blank">http://lo.fuel.master.org</a>にアクセスしてFuelのwelcomeページが表示されればOK</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>27</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/ae107a96699745a02560">FuelPHP【入門】-- CRUDを作った時のメモ(インストールからCRUD作成まで) --</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-18 20:47:52</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[FuelPHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>FuelPHPを触ることになったのでまずは練習に<a href="http://ja.wikipedia.org/wiki/CRUD" rel="nofollow noopener" target="_blank">CRUD(create,read,update,insert)</a>環境を作ることにした時のメモです。<br>
フレームワーク自体はfuelのgitで管理することを目的とします。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3</li>
<li>fuelPHP1.5.3</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
<li>mysql</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://fuelphp.jp/docs/1.5/" rel="nofollow noopener" target="_blank">日本語版ドキュメント(1.5ドキュメント)</a></li>
<li><a href="http://fuelphp.jp/docs/1.5/packages/oil/generate.html" rel="nofollow noopener" target="_blank">日本語版ドキュメント(genarate)</a></li>
<li><a href="http://ma2k8.hateblo.jp/entry/2012/11/25/043042" rel="nofollow noopener" target="_blank">FuelPHP + Gitで幸せになれた。</a></li>
</ul>

<h2>
<span id="公式サイトからfuelphpを取得する" class="fragment"></span><a href="#%E5%85%AC%E5%BC%8F%E3%82%B5%E3%82%A4%E3%83%88%E3%81%8B%E3%82%89fuelphp%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>公式サイトからFuelPHPを取得する</h2>

<p><a href="http://fuelphp.com/" rel="nofollow noopener" target="_blank">公式サイト</a>にいってDownloadボタンをポチッと押して展開したいディレクトリでunzipする。<br>
(今回はlo.fuel.master.orgってディレクトリにDLしたfuelPHPを展開する)<br>
公式では</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span># oil を Web からクイックインストールします
$ curl get.fuelphp.com/oil | sh
# oil が、たった今、インストールされました。Sites ディレクトリで blog プロジェクトを作ります
$ cd Sites/
$ oil create blog
</pre></div></div>

<p>上記のような形で記載されていますが、これをすると/usr/local/binに<a href="http://fuelphp.jp/docs/1.5/packages/oil/generate.html" rel="nofollow noopener" target="_blank">oilコマンド</a>（genarateコマンド）がインストールされてしまうので複数のfuelPHPをローカル運用するときに困りそうなのでDLしてくることにしました。</p>

<p>構成はこんな感じ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>lo.fuel.master.org/ #fuelPHP本体の落とし先（適時自分の環境に読み替えてください）
| docs/
| fuel/
| public/
| | assets/
| | index.php #ドキュメントルート
| CHANGELOG.md
| CONTRIBUTING.md
| README.md
| TESTING.md
| build.xml
| oil
</pre></div></div>

<h2>
<span id="corepackageをgitでサブモジュール化する" class="fragment"></span><a href="#corepackage%E3%82%92git%E3%81%A7%E3%82%B5%E3%83%96%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E5%8C%96%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>core,packageをgitでサブモジュール化する</h2>

<p>FuelPHP自体のアップデート時に対応できるように一旦落としたcore,packageを削除します。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd lo.fuel.master.org
rm -rf fuel/core fuel/packages
mkdir fuel/packages
</pre></div></div>

<p>git(submodule)を実行する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd lo.fuel.master.org

git submodule add git://github.com/fuel/core.git fuel/core
git submodule add git://github.com/fuel/oil.git fuel/packages/oil
git submodule add git://github.com/fuel/auth.git fuel/packages/auth
git submodule add git://github.com/fuel/parser.git fuel/packages/parser
git submodule add git://github.com/fuel/orm.git fuel/packages/orm
git submodule add git://github.com/fuel/email.git fuel/packages/email
git submodule add git://github.com/fuel/log.git fuel/packages/log
git submodule add git://github.com/fuel/docs.git docs
</pre></div></div>

<p>チェックアウト</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd lo.fuel.master.org

git submodule foreach 'git checkout 1.5/master'
</pre></div></div>

<h2>
<span id="設定ファイルfuelappconfigdevelopmentdbphpの編集" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%ABfuelappconfigdevelopmentdbphp%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>設定ファイル(fuel/app/config/development/db.php)の編集</h2>

<p>色々なフレームワーク同様にenvirment(環境設定)毎に設定ができます。デフォルトの環境設定はdevelopmentなのでfuel/app/config/development/db.phpでdbの設定を行います。<br>
ちなみに環境変数を指定しているところはfuel/app/bootstrap.phpにあります。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>Fuel::$env = (isset($_SERVER['FUEL_ENV']) ? $_SERVER['FUEL_ENV'] : Fuel::DEVELOPMENT);
</pre></div></div>

<h3>
<span id="fuelappconfigdevelopmentdbphp" class="fragment"></span><a href="#fuelappconfigdevelopmentdbphp"><i class="fa fa-link"></i></a>fuel/app/config/development/db.php</h3>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/config/development/db.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * The development database settings. These get merged with the global settings.</span>
<span class="sd"> */</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'default'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'mysqli'</span><span class="p">,</span>
        <span class="s1">'connection'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'hostname'</span> <span class="o">=&gt;</span> <span class="s1">'hostname'</span><span class="p">,</span>
            <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
            <span class="s1">'database'</span> <span class="o">=&gt;</span> <span class="s1">'database名'</span><span class="p">,</span>
            <span class="s1">'username'</span>   <span class="o">=&gt;</span> <span class="s1">'ユーザー名'</span><span class="p">,</span>
            <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'パスワード'</span><span class="p">,</span>
            <span class="s1">'presistent'</span> <span class="o">=&gt;</span> <span class="k">false</span>
        <span class="p">),</span>
        <span class="s1">'enable_cache'</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="s1">'profiling'</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>

<h2>
<span id="ormの設定" class="fragment"></span><a href="#orm%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ormの設定</h2>

<p>ORMの設定を有効にします</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/config/config.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
    <span class="c1">//ここの項目のコメントを外してください</span>
    <span class="s1">'always_load'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'packages'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'orm'</span><span class="p">,</span>
        <span class="p">),</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="c1">//デフォルトのコメントが記載されていますが割愛します</span>
    <span class="p">),</span>

</pre></div>
</div>

<h2>
<span id="scaffold機能でcrud環境を作る" class="fragment"></span><a href="#scaffold%E6%A9%9F%E8%83%BD%E3%81%A7crud%E7%92%B0%E5%A2%83%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>scaffold機能でCRUD環境を作る</h2>

<p><a href="http://www.techscore.com/tech/Ruby/Rails/quick-start/Rails4/4-1/" rel="nofollow noopener" target="_blank">scaffold概要(Ruby on Railの説明)</a>から参照で</p>

<blockquote>
<p>4.1 scaffold概要<br>
Railsには、コードを自動生成するジェネレータが複数用意されています。ここでは、「scaffold」というジェネレータを紹介します。<br>
scaffold（「足場」という意味）は、データベースのテーブルへの登録（CREATE）、参照（READ）、更新（UPDATE）、削除（DELETE）（英語の頭文字をとって、「CRUD」といいます）を行うWebアプリケーションのひな形となるソースコードを自動生成します。scaffoldを実行させれば、「足場」という名の通り、最低限のCRUDを行うWebアプリケーションを作成することができます。<br>
実際の開発においては、使用する機会が少ないかと思いますが、ここではRailsの基本構造を知るために利用します。</p>
</blockquote>

<p>公式でもrailの概念を借用しましたと書いてあります</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd lo.fuel.master.org
php oil g scaffold monkey name:string description:text
    Created model: APPPATH/classes/model/monkey.php
    Created migration: APPPATH/migrations/001_create_monkeys.php
    Created controller: APPPATH/classes/controller/monkeys.php
    Created view: APPPATH/views/monkeys/index.php
    Created view: APPPATH/views/monkeys/view.php
    Created view: APPPATH/views/monkeys/create.php
    Created view: APPPATH/views/monkeys/edit.php
    Created view: APPPATH/views/monkeys/_form.php
</pre></div></div>

<p>指定したmonkeyがcontrollerとmodel名でname:string description:textがテーブルmonkeysの内容を示しています</p>

<h2>
<span id="マイグレーションmigrateの実行" class="fragment"></span><a href="#%E3%83%9E%E3%82%A4%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3migrate%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>マイグレーション(migrate)の実行</h2>

<p>マイグレーションとはDBの設定反映を行うためのコマンドです。<br>
oilのscaffoldで作成したmodelの設定反映をDBにも行うためのものです。<br>
APPPATH/migrations/003_create_monkeys.phpを見るとわかりやすいです。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/migration/001_create_monkeys.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Fuel\Migrations</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Create_monkeys</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">\DBUtil</span><span class="o">::</span><span class="na">create_table</span><span class="p">(</span><span class="s1">'monkeys'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'constraint'</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span> <span class="s1">'auto_increment'</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">),</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'constraint'</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'varchar'</span><span class="p">),</span>
            <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'text'</span><span class="p">),</span>
            <span class="s1">'created_at'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'constraint'</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span> <span class="s1">'null'</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">),</span>
            <span class="s1">'updated_at'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'constraint'</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'int'</span><span class="p">,</span> <span class="s1">'null'</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">),</span>

        <span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="s1">'id'</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">\DBUtil</span><span class="o">::</span><span class="na">drop_table</span><span class="p">(</span><span class="s1">'monkeys'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>最初にテーブルを作成したいのでup()を実行することになります。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd lo.fuel.master.org
php oil refine migrate
</pre></div></div>

<h2>
<span id="httplocalhostmonkeyにアクセスする" class="fragment"></span><a href="#httplocalhostmonkey%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><a href="http://localhost/monkey%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B" class="autolink" rel="nofollow noopener" target="_blank">http://localhost/monkeyにアクセスする</a>
</h2>

<p>これでCRUD環境ができていますので<a href="http://localhost/monkey%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84%E3%80%82" class="autolink" rel="nofollow noopener" target="_blank">http://localhost/monkeyにアクセスしてください。</a></p>

<p>実際の開発ではあまり使う機会は少ないと思いますが、最初の一歩にはソースの理解と流れを知るにはちょうどいいかと。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>27</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/662e41376efa97251575">外部リポジトリの追加（remi,epel）</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-07 10:29:50</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>最新のPHPを入れたい場合は大体この２つはyumのレポジトリが必要なのでメモ</p>

<p>環境<br>
virtualbox centOS6.3(x86)</p>

<p>epel</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#先にepelから入れないとremiの依存性でエラーになるので注意
rpm --import wget http://ftp.riken.jp/Linux/fedora/epel/RPM-GPG-KEY-EPEL-6 
vim /etc/yum.repos.d/epel.repo
</pre></div></div>

<p>epelの設定を新規で追加する</p>

<div class="code-frame" data-lang="sh">
<div class="code-lang"><span class="bold">/etc/yum.repos.d/epel.repo</span></div>
<div class="highlight"><pre><span></span><span class="o">[</span>epel<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>EPEL RPM Repository <span class="k">for</span> Red Hat Enterprise Linux
<span class="nv">baseurl</span><span class="o">=</span>http://ftp.riken.jp/Linux/fedora/epel/6/<span class="nv">$basearch</span>/
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
<span class="nv">enabled</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>

<p>epelを使ってインストールできるか確認する</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yum --enablerepo=epel install php
#インストールする必要がない場合はNで抜ける
</pre></div></div>

<p>remi</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>rpm --import http://rpms.famillecollet.com/RPM-GPG-KEY-remi
vim /etc/yum.repos.d/remi.repo
</pre></div></div>

<p>remiの設定を新規で追加する</p>

<div class="code-frame" data-lang="sh">
<div class="code-lang"><span class="bold">/etc/yum.repos.d/remi.repo</span></div>
<div class="highlight"><pre><span></span><span class="o">[</span>remi<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>Les RPM de remi pour Enterprise Linux <span class="m">5</span> - <span class="nv">$basearch</span>
<span class="nv">baseurl</span><span class="o">=</span>http://rpms.famillecollet.com/el5.<span class="nv">$basearch</span>/
http://iut-info.univ-reims.fr/remirpms/el5.<span class="nv">$basearch</span>/
<span class="nv">enabled</span><span class="o">=</span><span class="m">0</span>
<span class="nv">priority</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>

<p>yumでインストールできる確認する</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yum --enablerepo=remi install php
#インストールする必要がない場合はNで抜ける
</pre></div></div>

<p>以上</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>26</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/3cb756a9c951371a4089">chef-soloで使用するvirtualbox(vagrant)をveeweeを使用して作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-13 04:01:30</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[chef]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://tatsu-zine.com/books/chef-solo" rel="nofollow noopener" target="_blank">入門ChefSolo-InfrastructureasCode-1.0.0</a>を買ってchefにハマっています。<br>
<a href="http://www.vagrantbox.es/" rel="nofollow noopener" target="_blank">Vagrantbox.es</a>のvirtualboxですが外部にあるのでいつ変更されるかわからないとなるとせっかく作ったchefが思わぬところでエラーになるかもしれないのでveeweeを使ってカスタマイズして作ろうと思った時のメモ</p>

<h2>
<span id="ゴール" class="fragment"></span><a href="#%E3%82%B4%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ゴール</h2>

<p>centos6.4-x86-minimalをカスタマイズして自分用のcentos6.4のvboxを作成すること</p>

<h2>
<span id="写経時間" class="fragment"></span><a href="#%E5%86%99%E7%B5%8C%E6%99%82%E9%96%93"><i class="fa fa-link"></i></a>写経時間</h2>

<p>約30分</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>mac-osx</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>virtualbox</li>
<li>ruby 1.9.3p327 (rbenv) ※1.9.3-p286でもいけた</li>
<li><p>xcode <br>
※ commandLineToolが必要です。入れていない方は<a href="http://d.hatena.ne.jp/agw/20120730/1343711730" rel="nofollow noopener" target="_blank">Installing Command Line Tools on OS X Mountain Lion</a>を参考にインストールしておいてください。</p></li>
<li><p>XQuartz ※入れていない方は<a href="http://xquartz.macosforge.org/landing/" rel="nofollow noopener" target="_blank">XQuartz</a>いってXQuartz-2.7.4.dmgをポチっと押してインスコしておいてください</p></li>
<li><p>git</p></li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://qiita.com/items/a2464c27008decbfb9dc">Vagrantで再現可能な仮想マシン開発環境をMacに構築する</a></li>
<li><a href="http://www.ryuzee.com/contents/blog/4292" rel="nofollow noopener" target="_blank">Vagrantで簡単仮想マシン構築</a></li>
<li><a href="http://docs.vagrantup.com/v2/getting-started/index.html" rel="nofollow noopener" target="_blank">vagrant公式</a></li>
</ul>

<h2>
<span id="vagrantとは" class="fragment"></span><a href="#vagrant%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a><a href="http://www.ryuzee.com/contents/blog/4292" rel="nofollow noopener" target="_blank">vagrant</a>とは？</h2>

<p>vm(virtualbox,vmware)をコマンドラインで作成、起動などができるもの<br>
chef-soloやるだけなら特に必要はないが、chef-soloをやる場合に何回も壊しては作るを繰り返すことになるので合ったほうが便利<br>
ちなみにvagrantでもなくてもvirtualboxのコマンドでも頑張れば同様なことはできる。<br>
chef-soloを使う為の箱の自動化処理部分を担ってくれる</p>

<h2>
<span id="veeweeとは" class="fragment"></span><a href="#veewee%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a><a href="https://github.com/jedi4ever/veewee" rel="nofollow noopener" target="_blank">veewee</a>とは？</h2>

<p>vagrantで使用するvboxを作成するために補助してくれるツール<br>
veeweeのテンプレートを使用していろんなOSのvagrantを作成することができます。<br>
chef-soloを使う為の箱の設定を細かく簡単に指定できるツール。</p>

<h2>
<span id="vagrant公式サイトからのインストール" class="fragment"></span><a href="#vagrant%E5%85%AC%E5%BC%8F%E3%82%B5%E3%82%A4%E3%83%88%E3%81%8B%E3%82%89%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>vagrant(公式サイト)からのインストール</h2>

<p><a href="http://www.vagrantup.com/" rel="nofollow noopener" target="_blank">vagrant</a>からDownloadとこいってインストールしてきてください。<br>
公式はinstallerを各OSに提供しています。<br>
コマンドラインがお好きな方はマウントまでこれで</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>curl -o Vagrant.dmg http://files.vagrantup.com/packages/64e360814c3ad960d810456add977fd4c7d47ce6/Vagrant.dmg
hdiutil mount Vagrant.dmg
</pre></div></div>

<h2>
<span id="bundlerを入れる" class="fragment"></span><a href="#bundler%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>bundlerを入れる</h2>

<p><a href="http://qiita.com/items/a2464c27008decbfb9dc">Vagrantで再現可能な仮想マシン開発環境をMacに構築する</a>と一緒です</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>gem install bundler
</pre></div></div>

<h2>
<span id="veeweeをgitでcloneする" class="fragment"></span><a href="#veewee%E3%82%92git%E3%81%A7clone%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>veeweeをgitでcloneする</h2>

<p><a href="http://qiita.com/items/a2464c27008decbfb9dc">Vagrantで再現可能な仮想マシン開発環境をMacに構築する</a>と一緒です</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>git clone git://github.com/jedi4ever/veewee.git
cd veewee
bundle install
</pre></div></div>

<h2>
<span id="veewee用のvagrantを入れる" class="fragment"></span><a href="#veewee%E7%94%A8%E3%81%AEvagrant%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>veewee用のvagrantを入れる</h2>

<h3>
<span id="veeweeのgemfileを修正してbundleのvagrantを入れる" class="fragment"></span><a href="#veewee%E3%81%AEgemfile%E3%82%92%E4%BF%AE%E6%AD%A3%E3%81%97%E3%81%A6bundle%E3%81%AEvagrant%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>veeweeのGemfileを修正してbundleのvagrantを入れる</h3>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">veewee/Gemfile</span></div>
<div class="highlight"><pre><span></span>#修正前
group :test do
  gem "rake"
  #gem "vagrant" , "1.0.7" #コメントアウトになってるので
  #gem "chef"
  #gem "knife-windows"
end



#修正後
group :test do
  gem "rake"
  gem "vagrant" , "1.0.7" #コメントアウトを外す
  #gem "chef"
  #gem "knife-windows"
end
</pre></div>
</div>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd veewee
bundle update
bundle install
</pre></div></div>

<p>veewee用といってるのは<a href="http://www.vagrantup.com/" rel="nofollow noopener" target="_blank">公式vagrant</a>installerのvagrantではbasebox defineコマンドがないので入れられない為veewee用のvagrant (1.0.7)を入れる必要があるのです。</p>

<p>※ココらへんはruby知らないのでよくわからん。</p>

<h2>
<span id="veeweeのテンプレートからcentos64-x86-minimalを自分用にコピーする" class="fragment"></span><a href="#veewee%E3%81%AE%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%8B%E3%82%89centos64-x86-minimal%E3%82%92%E8%87%AA%E5%88%86%E7%94%A8%E3%81%AB%E3%82%B3%E3%83%94%E3%83%BC%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>veeweeのテンプレートからcentos6.4-x86-minimalを自分用にコピーする</h2>

<p>説明合ってるのかな？</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>bundle exec vagrant basebox define {任意の名前} CentOS-6.4-x86_64-minimal
</pre></div></div>

<p>このコマンドで<code>veewee/defintions</code>に{任意の名前}という名前のディレクトリが作成され設定ファイル郡ができます</p>

<p>defineの後の引数はvbox名にもなるのでお好きな名前でどうぞ</p>

<h2>
<span id="自分用に設定をカスタマイズする" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E7%94%A8%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>自分用に設定をカスタマイズする</h2>

<p>自分が編集した部分は下記です</p>

<h3>
<span id="veeweedefinitionscentos64-x86definitionrb" class="fragment"></span><a href="#veeweedefinitionscentos64-x86definitionrb"><i class="fa fa-link"></i></a>veewee/definitions/centos6.4-x86/definition.rb</h3>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">veewee/definitions/centos6.4-x86/definition.rb</span></div>
<div class="highlight"><pre><span></span>  :disk_size =&gt; '25600', #Mバイト単位で指定してください。今回は25GBで設定しました
  :iso_src =&gt; "ftp://ftp.riken.jp/Linux/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-minimal.iso", #これ変更しないと時間かかる
</pre></div>
</div>

<p>veewee/definitions/centos6.4-x86/definition.rbでユーザーとかも変更出来ます。</p>

<h3>
<span id="veeweedefinitionscentos64-x86kscfg" class="fragment"></span><a href="#veeweedefinitionscentos64-x86kscfg"><i class="fa fa-link"></i></a>veewee/definitions/centos6.4-x86/ks.cfg</h3>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">veewee/definitions/centos6.4-x86/ks.cfg</span></div>
<div class="highlight"><pre><span></span>lang ja_JP.UTF-8 #日本語
timezone Asia/Tokyo #timezone
</pre></div>
</div>

<h3>
<span id="veeweedefinitionscentos64-x86basesh" class="fragment"></span><a href="#veeweedefinitionscentos64-x86basesh"><i class="fa fa-link"></i></a>veewee/definitions/centos6.4-x86/base.sh</h3>

<p>vmを作成後に実行するものっぽい</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">veewee/definitions/centos6.4-x86/base.sh</span></div>
<div class="highlight"><pre><span></span>yum -y install gcc make gcc-c++ kernel-devel-`uname -r` zlib-devel openssl-devel readline-devel sqlite-devel perl wget dkms nfs-utils rsync
#最後にrsync追加した
</pre></div>
</div>

<p>最後にrsyncを追加したのは<a href="http://www.vagrantbox.es/" rel="nofollow noopener" target="_blank">Vagrantbox.es</a>のcentos6.4-x86には最初rsyncが入ってなくchef soloを実行しようとするとエラーになったので最初に入れます。<br>
（そもそもこれが原因でvboxをインストール後ワンライナーでchefでインストール出来ないじゃんって思ってイラッと来てveeweeに手を出した）<br>
きっとchef solo自体がリモートのosにchefコマンドを実行するのにrsyncを使ってる為だと思います。（きっとそう）</p>

<h2>
<span id="vboxをビルド作成する" class="fragment"></span><a href="#vbox%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>vboxをビルド（作成する）</h2>

<p>iso落とす？って質問されますので「Yes」って答えた後はコーヒーでも飲んでじっくり待ちましょう（約10分くらい）</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">veewee/definitions/centos6.4-x86/base.sh</span></div>
<div class="highlight"><pre><span></span>bundle exec vagrant basebox build centos6.4-x86
</pre></div>
</div>

<p>また最後に</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -p 7222 -l veewee 127.0.0.1
</pre></div></div>

<p>とコンソールで出力されるのでコピーして作成されたvboxにssh越しにログインできるか確認してください(パスワードはveewee/definitions/centos6.4-x86/definition.rbで設定したもの今回ならveewee)</p>

<h2>
<span id="vboxファイルのエキスポート" class="fragment"></span><a href="#vbox%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%82%A8%E3%82%AD%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>vboxファイルのエキスポート</h2>

<p><a href="http://qiita.com/items/a2464c27008decbfb9dc">Vagrantで再現可能な仮想マシン開発環境をMacに構築する</a>と一緒です(助かりました)<br>
これでインポート用のベースとなるvboxは作成完了です。<br>
(veeweeの役目もここまで)</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>bundle exec vagrant basebox export {任意の名前}
#{任意の名前}.boxというvboxができます
</pre></div></div>

<h2>
<span id="veeweeで作った任意の名前boxを使用する" class="fragment"></span><a href="#veewee%E3%81%A7%E4%BD%9C%E3%81%A3%E3%81%9F%E4%BB%BB%E6%84%8F%E3%81%AE%E5%90%8D%E5%89%8Dbox%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>veeweeで作った{任意の名前}.boxを使用する</h2>

<p>veeweeはあくまでosの雛形を作成するのが目的なのでveewee以外のディレクトリで作業したほうがいいと思います（別にそのままやっても問題無いです）</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir chef-soloでchefりたいディレクトリ
cd chef-soloでchefりたいディレクトリ
vagrant box add {任意の名前} veeweeで作成した.vboxのパス #vagrantにboxを追加
vagrant init {任意の名前} #設定ファイルVagrantfileを作成する
vagrant up #vboxを立ち上げる
</pre></div></div>

<p>以上でchef-soloまでの前準備は以上です。</p>

<p><a href="http://qiita.com/items/a2464c27008decbfb9dc">Vagrantで再現可能な仮想マシン開発環境をMacに構築する</a>には大変お世話になりました。</p>

<h2>
<span id="vagrantでよく使うコマンド" class="fragment"></span><a href="#vagrant%E3%81%A7%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>vagrantでよく使うコマンド</h2>

<table>
<thead>
<tr>
<th style="text-align: left">コマンド</th>
<th style="text-align: right">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">vagrant init</td>
<td style="text-align: right">vboxの管理用設定ファイルを作成する(基本初回のみ)</td>
</tr>
<tr>
<td style="text-align: left">vagrant up</td>
<td style="text-align: right">作ったvboxの起動</td>
</tr>
<tr>
<td style="text-align: left">vagrant ssh</td>
<td style="text-align: right">sshでvboxにログイン</td>
</tr>
<tr>
<td style="text-align: left">vagrant ssh-config</td>
<td style="text-align: right">vboxのssh設定を教えてくれる。（defaultのみ）</td>
</tr>
<tr>
<td style="text-align: left">vagrant ssh-config --host host名</td>
<td style="text-align: right">vboxのssh設定をHost名を変更して出力する。出力内容をホストOSの~/.ssh/configに貼り付ければssh 任意名前とかでssh接続ができる</td>
</tr>
<tr>
<td style="text-align: left">vagrant halt</td>
<td style="text-align: right">vboxの停止（電源ポチ）</td>
</tr>
<tr>
<td style="text-align: left">vagrant reload</td>
<td style="text-align: right">vboxの再起動</td>
</tr>
<tr>
<td style="text-align: left">vagrant resume</td>
<td style="text-align: right">vboxのレジューム</td>
</tr>
<tr>
<td style="text-align: left">vagrant package</td>
<td style="text-align: right">vboxのパッケージを作るコマンド詳細は割愛</td>
</tr>
</tbody>
</table>

<h2>
<span id="ハマリどころまとめ" class="fragment"></span><a href="#%E3%83%8F%E3%83%9E%E3%83%AA%E3%81%A9%E3%81%93%E3%82%8D%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>ハマリどころまとめ</h2>

<h3>
<span id="何回も同じもの作ってるとエラーになる" class="fragment"></span><a href="#%E4%BD%95%E5%9B%9E%E3%82%82%E5%90%8C%E3%81%98%E3%82%82%E3%81%AE%E4%BD%9C%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>何回も同じもの作ってるとエラーになる</h3>

<p>そんな時はカレントユーザーにある<br>
~/.vagrant.dをmvしましょう。<br>
（正直中身は知りません）<br>
大体のエラーの時に一回これをmvすると上手く行く<br>
要は設定を新規にするのです。</p>

<h3>
<span id="vagrantfileがすでにあるよって怒られる" class="fragment"></span><a href="#vagrantfile%E3%81%8C%E3%81%99%E3%81%A7%E3%81%AB%E3%81%82%E3%82%8B%E3%82%88%E3%81%A3%E3%81%A6%E6%80%92%E3%82%89%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>Vagrantfileがすでにあるよって怒られる</h3>

<p>そんな時はカレントディレクトリにある<br>
Vagrantfileをmvしましょう。<br>
(vboxの設定項目です。)</p>

<h3>
<span id="a-virtualbox-machine-with-the-name-centos64-x86-already-existsって怒られる" class="fragment"></span><a href="#a-virtualbox-machine-with-the-name-centos64-x86-already-exists%E3%81%A3%E3%81%A6%E6%80%92%E3%82%89%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>A VirtualBox machine with the name 'centos6.4-x86' already exists.って怒られる</h3>

<p>vboxを削除するか</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vagrant box add {任意の名前} --force veeweeで作成した.vboxのパス
</pre></div></div>

<p>--forceをつけましょう。(強制的に作り直します)</p>

<h2>
<span id="所感" class="fragment"></span><a href="#%E6%89%80%E6%84%9F"><i class="fa fa-link"></i></a>所感</h2>

<p>ちなみにrubyは全く知りません。<br>
classってどうやって作るの？レベルです。<br>
でも少しやればできるレベルでした。（基本は設定いじるだけなのでrubyを書くことはない）<br>
昔と現在で設定ファイルの書き方が若干変わってるみたいなのでそんな時は<a href="http://docs.vagrantup.com/v2/getting-started/index.html" rel="nofollow noopener" target="_blank">vagrant公式のドキュメント</a>を見てみましょう。<a href="http://docs.opscode.com/" rel="nofollow noopener" target="_blank">opscode(chefの開発元)</a>みたいに膨大なドキュメントとかないので英語でも見やすいです。</p>

<p>chefをやってみたい！！って方の手助けになればと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>25</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/9cd0aee66003eba482e4">Ansibleを導入したい人の為のくどきポイント</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-20 11:28:47</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[Ansible]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Advent Calendar初参加です。<br>
ガクガクプルプルしています。(((( ；ﾟДﾟ))))ｶﾞｸｶﾞｸﾌﾞﾙﾌﾞﾙ</p>

<p>プロビジョニングフレームワークの中でも比較的ユルっとフワッと始められる<a href="http://yteraoka.github.io/ansible-tutorial/" rel="nofollow noopener" target="_blank">Ansible</a><br>
でもあなたがもしDevなら導入にあたりOpsの説得が必要です。<br>
そんなときにAnsibleの導入で謙る、ごねるネタをいくつかご紹介します。</p>

<h2>
<span id="対象者" class="fragment"></span><a href="#%E5%AF%BE%E8%B1%A1%E8%80%85"><i class="fa fa-link"></i></a>対象者</h2>

<p>最近流行のプロビジョニングフレームワークを導入したい！！って方。</p>

<h2>
<span id="でもそれって結構インフラ担当者から嫌がられる事が多いんですよね" class="fragment"></span><a href="#%E3%81%A7%E3%82%82%E3%81%9D%E3%82%8C%E3%81%A3%E3%81%A6%E7%B5%90%E6%A7%8B%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%8B%85%E5%BD%93%E8%80%85%E3%81%8B%E3%82%89%E5%AB%8C%E3%81%8C%E3%82%89%E3%82%8C%E3%82%8B%E4%BA%8B%E3%81%8C%E5%A4%9A%E3%81%84%E3%82%93%E3%81%A7%E3%81%99%E3%82%88%E3%81%AD"><i class="fa fa-link"></i></a>でも、それって結構インフラ担当者から嫌がられる事が多いんですよね。</h2>

<p>そりゃあ、普段あまりプログラムを書かない人達に</p>

<h4>
<span id="プログラムを書いて自動化できるんですよ" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%93%E3%81%A7%E3%81%99%E3%82%88"><i class="fa fa-link"></i></a>「プログラムを書いて自動化できるんですよ！！」</h4>

<p>って口説いても</p>

<h4>
<span id="εﾌｰﾝ" class="fragment"></span><a href="#%CE%B5%EF%BE%8C%EF%BD%B0%EF%BE%9D"><i class="fa fa-link"></i></a>(＇ε＇)ﾌｰﾝ</h4>

<p>って感じになるわけで</p>

<p>「kickstartですでに管理しているし」<br>
「インストール手順とかすでにshell化してるし」</p>

<p>とかそりゃまあ、新しい事に対する反発ってのは常にでますよね。<br>
分かります。普段業務で忙しいのに新しい事覚えろってのは最初は苦痛なはずです。</p>

<p>そんな方々にAnsibleを導入する為の口説きポイントをいくつかご紹介します。</p>

<h2>
<span id="その１インストールはhost側だけでいいんですよ" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%91%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%AFhost%E5%81%B4%E3%81%A0%E3%81%91%E3%81%A7%E3%81%84%E3%81%84%E3%82%93%E3%81%A7%E3%81%99%E3%82%88"><i class="fa fa-link"></i></a>【その１】インストールはHost側だけでいいんですよ！！！</h2>

<p>ここはChefとの違いですね。</p>

<p>Chefは対象とする</p>

<ul>
<li>Host側</li>
<li>ゲスト側</li>
</ul>

<p>両方にChefのインストール(RubyとGem)が必要ですが<br>
Ansibleは必要ありません。</p>

<p>働いてる場所によってはミドルウェアインストール一つだけでもインフラの方に</p>

<h3>
<span id="ﾟдﾟｺﾞﾙｧ本番環境に必要ないもんいれて何すんじゃぁぁぁぁ" class="fragment"></span><a href="#%EF%BE%9F%D0%B4%EF%BE%9F%EF%BD%BA%EF%BE%9E%EF%BE%99%EF%BD%A7%E6%9C%AC%E7%95%AA%E7%92%B0%E5%A2%83%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%81%84%E3%82%82%E3%82%93%E3%81%84%E3%82%8C%E3%81%A6%E4%BD%95%E3%81%99%E3%82%93%E3%81%98%E3%82%83%E3%81%81%E3%81%81%E3%81%81%E3%81%81"><i class="fa fa-link"></i></a>(　ﾟДﾟ)ｺﾞﾙｧ!!本番環境に必要ないもんいれて何すんじゃぁぁぁぁ！！！</h3>

<p>と怒られる場所があります。 </p>

<p>でもAnsibleの基本概念は</p>

<h3>
<span id="sshで頑張る" class="fragment"></span><a href="#ssh%E3%81%A7%E9%A0%91%E5%BC%B5%E3%82%8B"><i class="fa fa-link"></i></a>SSHで頑張る！！</h3>

<p>です。</p>

<p>なんで怒られそうな場所でしたら</p>

<h3>
<span id="本番環境に何もミドルウェア入れずに使える便利なツールがあるんですけどもぉぉぉぉぉ" class="fragment"></span><a href="#%E6%9C%AC%E7%95%AA%E7%92%B0%E5%A2%83%E3%81%AB%E4%BD%95%E3%82%82%E3%83%9F%E3%83%89%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2%E5%85%A5%E3%82%8C%E3%81%9A%E3%81%AB%E4%BD%BF%E3%81%88%E3%82%8B%E4%BE%BF%E5%88%A9%E3%81%AA%E3%83%84%E3%83%BC%E3%83%AB%E3%81%8C%E3%81%82%E3%82%8B%E3%82%93%E3%81%A7%E3%81%99%E3%81%91%E3%81%A9%E3%82%82%E3%81%89%E3%81%89%E3%81%89%E3%81%89%E3%81%89"><i class="fa fa-link"></i></a>「本番環境に何もミドルウェア入れずに使える便利なツールがあるんですけどもぉぉぉぉぉ」</h3>

<p>って(((( ；ﾟДﾟ))))ｶﾞｸｶﾞｸﾌﾞﾙﾌﾞﾙしながら言ってみましょう。</p>

<h2>
<span id="その２ドキュメントがシンプルっす" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%92%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%8C%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%A3%E3%81%99"><i class="fa fa-link"></i></a>【その２】ドキュメントがシンプルっす</h2>

<h3>
<span id="chefに比べてドキュメントがシンプル" class="fragment"></span><a href="#chef%E3%81%AB%E6%AF%94%E3%81%B9%E3%81%A6%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%8C%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB"><i class="fa fa-link"></i></a>Chefに比べてドキュメントがシンプル!!</h3>

<p>Chefはドキュメント探すのに苦労するって方は自分だけでもないはず！！</p>

<p>でもAnsibleは</p>

<h3>
<span id="ドキュメントがシンプルです" class="fragment"></span><a href="#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%8C%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a><a href="http://www.ansibleworks.com/docs/" rel="nofollow noopener" target="_blank">ドキュメント</a>がシンプルです</h3>

<p>これは布教活動をしていくにあたって</p>

<h3>
<span id="覚える事がそんなにないんですよぉぉぉぉぉ" class="fragment"></span><a href="#%E8%A6%9A%E3%81%88%E3%82%8B%E4%BA%8B%E3%81%8C%E3%81%9D%E3%82%93%E3%81%AA%E3%81%AB%E3%81%AA%E3%81%84%E3%82%93%E3%81%A7%E3%81%99%E3%82%88%E3%81%89%E3%81%89%E3%81%89%E3%81%89%E3%81%89"><i class="fa fa-link"></i></a>「覚える事がそんなにないんですよぉぉぉぉぉ」</h3>

<p>って(((( ；ﾟДﾟ))))ｶﾞｸｶﾞｸﾌﾞﾙﾌﾞﾙしながら言ってみましょう。</p>

<h2>
<span id="その３とりあえず始められますっす" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%93%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E5%A7%8B%E3%82%81%E3%82%89%E3%82%8C%E3%81%BE%E3%81%99%E3%81%A3%E3%81%99"><i class="fa fa-link"></i></a>【その３】とりあえず始められますっす</h2>

<p>Chefの最近の流行は<a href="https://github.com/opscode-cookbooks" rel="nofollow noopener" target="_blank">opscode-cookbooks</a>のリポジトリのソースを利用してゴニョゴニョしましょう。とかが流行らしいですが、(自分は挑戦して途中で挫折しました)<br>
ソースを見てもらえればわかりますが</p>

<ul>
<li>結構ガチな感じがする。。。(お、俺だけか。。。)</li>
<li>attibuteの定義をいっぱい追わなくてはならない。。。。</li>
</ul>

<p>と最初に挫折しやすい、cookbookの中身を理解、習得するのにそれなりに時間がかかります。<br>
※ opscodeのソース使わなければ該当はしません。が、Ansibleの導入が目的なのであえて(･д･)シラッと伏せておきましょう。</p>

<p>Ansibleはそんな流行とかはあんまりないんで、自由に気軽に書ける感じです。</p>

<p>なので</p>

<h3>
<span id="とりあえず簡単にかけるんですよぉぉぉ" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E7%B0%A1%E5%8D%98%E3%81%AB%E3%81%8B%E3%81%91%E3%82%8B%E3%82%93%E3%81%A7%E3%81%99%E3%82%88%E3%81%89%E3%81%89%E3%81%89"><i class="fa fa-link"></i></a>「とりあえず簡単にかけるんですよぉぉぉ」</h3>

<p>って(((( ；ﾟДﾟ))))ｶﾞｸｶﾞｸﾌﾞﾙﾌﾞﾙしながら言ってみましょう。</p>

<p>(だんだん何を言いたいんだが分からなくなってきた。。。)</p>

<h2>
<span id="その４5000台くらいは接続できますっす" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%945000%E5%8F%B0%E3%81%8F%E3%82%89%E3%81%84%E3%81%AF%E6%8E%A5%E7%B6%9A%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%A3%E3%81%99"><i class="fa fa-link"></i></a>【その４】5000台くらいは接続できますっす</h2>

<p><a href="http://www.slideshare.net/r_rudi/ansible-28755803" rel="nofollow noopener" target="_blank">Ansible入門…?</a>の35ページあたりに5000台くらいいけるって書いてありました。(自分ではさすがに検証はしておりません）</p>

<p>この規模の台数を扱うのは限られてる場所だと思いますので、</p>

<h3>
<span id="5000台くらいは同時に管理できなんですよぉぉぉぉぉ" class="fragment"></span><a href="#5000%E5%8F%B0%E3%81%8F%E3%82%89%E3%81%84%E3%81%AF%E5%90%8C%E6%99%82%E3%81%AB%E7%AE%A1%E7%90%86%E3%81%A7%E3%81%8D%E3%81%AA%E3%82%93%E3%81%A7%E3%81%99%E3%82%88%E3%81%89%E3%81%89%E3%81%89%E3%81%89%E3%81%89"><i class="fa fa-link"></i></a>「5000台くらいは同時に管理できなんですよぉぉぉぉぉ」</h3>

<p>って(((( ；ﾟДﾟ))))ｶﾞｸｶﾞｸﾌﾞﾙﾌﾞﾙしながら言ってみましょう。</p>

<h2>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h2>

<p>ゆるっとフワッとしている感じが自分は好きですし、python使えなくても(自分は使えない)人でも導入は比較的簡単にできるAnsible<br>
。<br>
さあ、</p>

<h3>
<span id="いつ口説くか" class="fragment"></span><a href="#%E3%81%84%E3%81%A4%E5%8F%A3%E8%AA%AC%E3%81%8F%E3%81%8B"><i class="fa fa-link"></i></a>いつ口説くか？</h3>

<h3>
<span id="今でしょ古い" class="fragment"></span><a href="#%E4%BB%8A%E3%81%A7%E3%81%97%E3%82%87%E5%8F%A4%E3%81%84"><i class="fa fa-link"></i></a>「今でしょ！！」(古い。。。。）</h3>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/5ef125b0384a9c23ba6a">virtualbox(centos)でのhttpdインストールメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-15 00:05:03</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>環境 centos6.3（ゲストOS）macosx10.8(ホストOS)<br>
※virtualboxのguest addisionalが入ってるものとする</p>

<p>httpのインストールからvirtualhostの設定までを記載する<br>
※あくまで開発環境化においてのインストール手順で本番用とかは別途探してきてください。</p>

<p>全てrootユーザー権限で実行しています。</p>

<h2>
<span id="install編" class="fragment"></span><a href="#install%E7%B7%A8"><i class="fa fa-link"></i></a>install編</h2>

<p>yumでサクッと入れる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yum -y install httpd
</pre></div></div>

<h2>
<span id="httpdconfの設定" class="fragment"></span><a href="#httpdconf%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>httpd.confの設定</h2>

<p>まずは設定ファイルのバックアップ</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cp /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.default
</pre></div></div>

<p>続いて設定ファイルを編集</p>

<div class="code-frame" data-lang="apacheconf">
<div class="code-lang"><span class="bold">/etc/httpd/conf/httpd.conf</span></div>
<div class="highlight"><pre><span></span><span class="nb">vim</span> <span class="sx">/etc/httpd/conf/httpd.conf</span>

<span class="nb">ServerTokens</span> Prod　#　エラーページ等でOS名を表示しないようにする
.
.
.
<span class="nt">&lt;Directory</span> <span class="s">/</span><span class="nt">&gt;</span>
    <span class="nb">Options</span> FollowSymLinks
    <span class="nb">AllowOverride</span> <span class="k">All</span> #.htaccessの許可
<span class="nt">&lt;/Directory&gt;</span>

<span class="c">#AddDefaultCharset UTF-8　#コメントアウト(文字化け対応)</span>
</pre></div>
</div>

<h2>
<span id="virtualhostの設定" class="fragment"></span><a href="#virtualhost%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>virtualhostの設定</h2>

<p>virtualhostの設定を新規で作成する</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/httpd/conf.d/virtualhost.conf</span></div>
<div class="highlight"><pre><span></span>vim /etc/httpd/conf.d/virtualhost.conf

&lt;VirtualHost *:80&gt;
    DocumentRoot "/home/ユーザーディレクトリ/バーチャルホスト名/www"
    ServerName バーチャルホスト名
    &lt;Directory "/home/ユーザーディレクトリ/バーチャルホスト名/www"&gt;
        order deny,allow
        allow from All
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;

#編集用にユーザーを作成しておくと何かと便利です自分の場合は
# ユーザーディレクトリ = web
#ユーザーの作り方
#
#useradd web
#passwd web
#パスワードを入力する
#ドメインでディレクトリを切っておくとわかりやすいです。自分の場合は
# バーチャルホスト名 = lo.test.org
</pre></div>
</div>

<h2>
<span id="port80番の開放" class="fragment"></span><a href="#port80%E7%95%AA%E3%81%AE%E9%96%8B%E6%94%BE"><i class="fa fa-link"></i></a>port(80番)の開放</h2>

<p>apacheのデフォルトのポート８０番が開いていないはずなのでポートを開放する</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/sysconfig/iptables</span></div>
<div class="highlight"><pre><span></span>-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
#追加
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT

</pre></div>
</div>

<h2>
<span id="ドキュメントルートのディレクトリを作成" class="fragment"></span><a href="#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%83%AB%E3%83%BC%E3%83%88%E3%81%AE%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>ドキュメントルートのディレクトリを作成</h2>

<p>virtualhostの設定内容のディレクトリを作成する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir /home/ユーザーディレクトリ/www
#apacheがアクセスできるようにパーミッションを変更する
chmod -R 775 /home/ユーザーディレクトリ/
#テストファイルを作成
vim index.html

&lt;html&gt;
&lt;body&gt;
hello.world
&lt;/body&gt;
&lt;/html&gt;
</pre></div></div>

<h2>
<span id="apacheの起動" class="fragment"></span><a href="#apache%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>apacheの起動</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/etc/init.d/httpd start
chkconfig httpd on
</pre></div></div>

<h2>
<span id="ipアドレスの確認" class="fragment"></span><a href="#ip%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>ipアドレスの確認</h2>

<p>ホストOSの設定に必要なのでメモしておく</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ifconfig

#下記の項目(inet)がどこかにあるのでメモしておく（デフォルトだと192.168.xx.xxx）なはず
inet addr:192.168.56.101

</pre></div></div>

<p>ここまでcentos(ゲストOS)側の設定</p>

<h2>
<span id="ホストos側macの設定" class="fragment"></span><a href="#%E3%83%9B%E3%82%B9%E3%83%88os%E5%81%B4mac%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ホストOS側（MAC）の設定</h2>

<div class="code-frame" data-lang="/etc/hosts"><div class="highlight"><pre><span></span>sudo vim /etc/hosts
#追加(ifconfigのinetの値)
192.168.56.101  lo.test.org
</pre></div></div>

<h2>
<span id="ホストosのブラウザで確認" class="fragment"></span><a href="#%E3%83%9B%E3%82%B9%E3%83%88os%E3%81%AE%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%A7%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>ホストOSのブラウザで確認</h2>

<p>ブラウザで<a href="http://lo.test.org%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%A7hello" class="autolink" rel="nofollow noopener" target="_blank">http://lo.test.orgにアクセスでhello</a> worldが表示されたら完了</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />22位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>22</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/572169174e16bc669a7b">CentOSでndenvをシステムワイドにインストールした時のメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-07 12:35:22</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[nodejs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://hubot.github.com/" rel="nofollow noopener" target="_blank">hubot</a>を触ってみたーい。<br>
という衝動にかられてNodeJsが必要になった。<br>
ずっと<a href="https://github.com/hokaccha/nodebrew" rel="nofollow noopener" target="_blank">nodebrew</a>を使っていたけどrubyは<a href="https://github.com/sstephenson/rbenv" rel="nofollow noopener" target="_blank">rbenv</a>だし<br>
pythonは<a href="https://github.com/yyuu/pyenv" rel="nofollow noopener" target="_blank">pyenv</a>だし<br>
どうせだったら同じ概念で言語管理ツール入れたいと思っていたら<br>
<a href="http://blog.riywo.com/2013/06/21/152736" rel="nofollow noopener" target="_blank">riywo</a>さんがrbenv真似して作成してくれたので導入した見たときのメモ。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.4（ゲストOS）macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h2>

<ul>
<li>ここから先は全てroo(権限)ユーザーで実行しています</li>
<li>開発環境構築の話です。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://blog.riywo.com/2013/06/21/152736" rel="nofollow noopener" target="_blank">node.jsのバージョン管理のためにndenv &amp; node-buildを作ったのとanyenvの宣伝</a></li>
</ul>

<h2>
<span id="ndenvをgitからクローンする" class="fragment"></span><a href="#ndenv%E3%82%92git%E3%81%8B%E3%82%89%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%B3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ndenvをgitからクローンする</h2>

<p>ズバッと</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd /usr/local/
git clone https://github.com/riywo/ndenv.git
</pre></div></div>

<h2>
<span id="ndenv用のグループを作成する" class="fragment"></span><a href="#ndenv%E7%94%A8%E3%81%AE%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ndenv用のグループを作成する</h2>

<p>作っておけばグループでビルド権限とかをコントロールできます<br>
vagrantはユーザー名です</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>groupadd ndenv
usermod -G ndenv vagrant
</pre></div></div>

<h2>
<span id="ndenvのパーミッションの設定" class="fragment"></span><a href="#ndenv%E3%81%AE%E3%83%91%E3%83%BC%E3%83%9F%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ndenvのパーミッションの設定</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chmod -R g+rwxXs /usr/local/ndenv/
</pre></div></div>

<h2>
<span id="node-buildプラグインをインストール" class="fragment"></span><a href="#node-build%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>node-buildプラグインをインストール</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir /usr/local/ndenv/plugins
git clone https://github.com/riywo/node-build.git
</pre></div></div>

<h2>
<span id="ndenvのpathを通す" class="fragment"></span><a href="#ndenv%E3%81%AEpath%E3%82%92%E9%80%9A%E3%81%99"><i class="fa fa-link"></i></a>ndenvのPATHを通す</h2>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/profile.d/ndenv.sh</span></div>
<div class="highlight"><pre><span></span>vim /etc/profile.d/ndenv.sh

export NDENV_ROOT=/usr/local/ndenv
export PATH="$NDENV_ROOT/bin:$PATH"
eval "$(ndenv init -)" 
</pre></div>
</div>

<h2>
<span id="nodejsのインストール" class="fragment"></span><a href="#nodejs%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>NodeJSのインストール</h2>

<p>一旦profileを反映してから行う事</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>source /etc/profile.d/ndenv.sh

which ndenv
/usr/local/ndenv/bin/ndenv
</pre></div></div>

<p>ndenvにPATHが通ったのでインストール</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ndenv install v0.10.20
</pre></div></div>

<p>結構長いです。辛抱しましょう。</p>

<h2>
<span id="nodejsのデフォルトのバージョン設定" class="fragment"></span><a href="#nodejs%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>NodeJSのデフォルトのバージョン設定</h2>

<p>コマンド一発</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ndenv global v0.10.20
ndenv rehash
</pre></div></div>

<h2>
<span id="nodejsのバージョン確認" class="fragment"></span><a href="#nodejs%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>NodeJSのバージョン確認</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>node --version
</pre></div></div>

<p>NodeJSのインストールができました。<br>
ずっとNodeJS版rbenvあったらいいなぁと思っていたので<br>
<a href="http://blog.riywo.com/2013/06/21/152736" rel="nofollow noopener" target="_blank">riywo</a>さん<br>
ありがとうございます！！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />23位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/43beef25d26966fff8cc">composerを使ってみた時のメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-01 18:44:01</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>pearの後継版のパッケージ管理の機能とかなんとかどっかに書いてあった。</p>

<p>使ってみた感想は便利!!</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3（ゲストOS）</li>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://ksauzz.github.com/blog/2012/11/16/setup-php/" rel="nofollow noopener" target="_blank">PHP環境メモ</a></li>
<li><a href="http://www.ryuzee.com/contents/blog/5681" rel="nofollow noopener" target="_blank">PHPの外部ライブラリの管理にComposerを使う</a></li>
<li><a href="http://qiita.com/items/81085381c4281e498cde">ComposerでPHPUnit一式+Mockeryをインストール</a></li>
</ul>

<h2>
<span id="composerをインストールする" class="fragment"></span><a href="#composer%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>composerをインストールする</h2>

<p>サクッとワンライナー</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>curl -s https://getcomposer.org/installer | php &amp;&amp; mv -v composer.phar /usr/local/bin/composer
</pre></div></div>

<p>自分は/usr/local/binに置きました</p>

<h3>
<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$composer -help


   ______
  / ____/___  ____ ___  ____  ____  ________  _____
 / /   / __ \/ __ `__ \/ __ \/ __ \/ ___/ _ \/ ___/
/ /___/ /_/ / / / / / / /_/ / /_/ (__  )  __/ /
\____/\____/_/ /_/ /_/ .___/\____/____/\___/_/
                    /_/
Composer version 98ada572ec52875dfa70e0cb9851dd5f8a34f006

Usage:
  [options] command [arguments]

Options:
  --help           -h Display this help message.
  --quiet          -q Do not output any message.
  --verbose        -v Increase verbosity of messages.
  --version        -V Display this application version.
  --ansi              Force ANSI output.
  --no-ansi           Disable ANSI output.
  --no-interaction -n Do not ask any interactive question.
  --profile           Display timing and memory usage information
  --working-dir    -d If specified, use the given directory as working directory.

Available commands:
  about            Short information about Composer
  config           Set config options
  create-project   Create new project from a package into given directory.
  depends          Shows which packages depend on the given package
  dump-autoload    Dumps the autoloader
  dumpautoload     Dumps the autoloader
  help             Displays help for a command
  init             Creates a basic composer.json file in current directory.
  install          Installs the project dependencies from the composer.lock file if present, or falls back on the composer.json.
  list             Lists commands
  require          Adds required packages to your composer.json and installs them
  search           Search for packages
  self-update      Updates composer.phar to the latest version.
  selfupdate       Updates composer.phar to the latest version.
  show             Show information about packages
  status           Show a list of locally modified packages
  update           Updates your dependencies to the latest version according to composer.json, and updates the composer.lock file.
  validate         Validates a composer.json

</pre></div></div>

<h2>
<span id="composerの設定ファイルを書く" class="fragment"></span><a href="#composer%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>composerの設定ファイルを書く</h2>

<h3>
<span id="ディレクトリ構成について" class="fragment"></span><a href="#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E6%88%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>ディレクトリ構成について</h3>

<p>composerコマンドはcomposerコマンド実行時のカレントの設定ファイルを読みに行くのがデフォルトです。<br>
設定ファイルもバージョン管理化に置きたいのでファイル構成はこんな感じで</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>├── composer.json
├── composer.lock
├── phpunit.bootstrap.php
├── phpunit.xml.dist
├── tests #テスト本体
│   └── ExampleTest.php
├── vendor #composerのインストールしたパッケージの置き場
└── www #ドキュメントルート
    ├── index.html
    └── phpinfo.php
</pre></div></div>

<h3>
<span id="設定ファイルを新規で追加" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%96%B0%E8%A6%8F%E3%81%A7%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>設定ファイルを新規で追加</h3>

<p><a href="http://www.phpunit.de/manual/3.7/ja/installation.html#installing.upgrading" rel="nofollow noopener" target="_blank">phpunit本家</a>からcomposerを対応しているモジュール郡をグバっと入れてます。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">composer.json</span></div>
<div class="highlight"><pre><span></span>{
    "require": {
        "phpunit/phpunit": "3.7.*",
        "mockery/mockery": "0.7.*",
        "phpunit/dbunit": "&gt;=1.2",
        "phpunit/phpunit-selenium": "&gt;=1.2",
        "phpunit/phpunit-story": "*"
    },
    "config": {
        "bin-dir": "/usr/local/bin/"
    }
}

</pre></div>
</div>

<h2>
<span id="composer-install" class="fragment"></span><a href="#composer-install"><i class="fa fa-link"></i></a>composer install</h2>

<p>シンプル</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>composer install
</pre></div></div>

<h2>
<span id="phpunitの設定を書く" class="fragment"></span><a href="#phpunit%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>phpunitの設定を書く</h2>

<p><a href="http://qiita.com/items/81085381c4281e498cde">ComposerでPHPUnit一式+Mockeryをインストール</a>を真似ました。</p>

<h3>
<span id="phpunitxmldist" class="fragment"></span><a href="#phpunitxmldist"><i class="fa fa-link"></i></a>phpunit.xml.dist</h3>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">phpunit.xml.dist</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;phpunit</span>
    <span class="na">bootstrap=</span><span class="s">"phpunit.bootstrap.php"</span>
    <span class="na">processIsolation=</span><span class="s">"false"</span>
    <span class="na">verbose=</span><span class="s">"true"</span>
    <span class="na">strict=</span><span class="s">"false"</span>
    <span class="na">colors=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;testsuites&gt;</span>
        <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">"PHPUnit"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- テストケースがあるディレクトリを列挙する --&gt;</span>
            <span class="nt">&lt;directory&gt;</span>tests<span class="nt">&lt;/directory&gt;</span>
            <span class="c">&lt;!-- &lt;directory&gt;MyProject2&lt;/directory&gt; --&gt;</span>
            <span class="c">&lt;!-- &lt;directory&gt;MyProject3&lt;/directory&gt; --&gt;</span>
            <span class="c">&lt;!-- &lt;directory&gt;MyProject4&lt;/directory&gt; --&gt;</span>
        <span class="nt">&lt;/testsuite&gt;</span>
    <span class="nt">&lt;/testsuites&gt;</span>

    <span class="nt">&lt;logging&gt;</span>
        <span class="c">&lt;!-- コードカバレッジ率 --&gt;</span>
        <span class="nt">&lt;log</span>
            <span class="na">type=</span><span class="s">"coverage-html"</span>
            <span class="na">target=</span><span class="s">"metrics/coverage"</span>
            <span class="na">charset=</span><span class="s">"UTF-8"</span>
            <span class="na">yui=</span><span class="s">"true"</span>
            <span class="na">highlight=</span><span class="s">"false"</span>
            <span class="na">lowUpperBound=</span><span class="s">"35"</span>
            <span class="na">highLowerBound=</span><span class="s">"70"</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- &lt;log type="coverage-text" target="php://stdout" lowUpperBound="35" highLowerBound="70" /&gt; --&gt;</span>
        <span class="c">&lt;!-- 上行をアンコメントアウトするとカバレッジ率がプロンプトにも表示される --&gt;</span>
    <span class="nt">&lt;/logging&gt;</span>

    <span class="nt">&lt;filter&gt;</span>
        <span class="c">&lt;!-- コードカバレッジ率を計測する対象の指定 --&gt;</span>
        <span class="nt">&lt;whitelist&gt;</span>
            <span class="nt">&lt;directory</span> <span class="na">suffix=</span><span class="s">".php"</span><span class="nt">&gt;</span>src<span class="nt">&lt;/directory&gt;</span>
            <span class="c">&lt;!-- &lt;file&gt;/path/to/file&lt;/file&gt; --&gt;</span>
            <span class="nt">&lt;exclude&gt;</span>
                <span class="nt">&lt;file&gt;</span>public/index.php<span class="nt">&lt;/file&gt;</span>
            <span class="nt">&lt;/exclude&gt;</span>
        <span class="nt">&lt;/whitelist&gt;</span>
        <span class="c">&lt;!-- コードカバレッジ測定対象から除外 --&gt;</span>
        <span class="nt">&lt;blacklist&gt;</span>
            <span class="nt">&lt;directory</span> <span class="na">suffix=</span><span class="s">".php"</span> <span class="na">group=</span><span class="s">"PHPUNIT"</span><span class="nt">&gt;</span>vendor<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/blacklist&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;listeners&gt;</span>
        <span class="c">&lt;!-- mockery統合のため必要 --&gt;</span>
        <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">"\Mockery\Adapter\Phpunit\TestListener"</span> <span class="na">file=</span><span class="s">"Vendor/mockery/mockery/library/Mockery/Adapter/Phpunit/TestListener.php"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/listeners&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</div>

<h3>
<span id="phpunitbootstrapphp" class="fragment"></span><a href="#phpunitbootstrapphp"><i class="fa fa-link"></i></a>phpunit.bootstrap.php</h3>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">phpunit.bootstrap.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// For composer</span>
<span class="k">require_once</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>
</pre></div>
</div>

<h3>
<span id="testsexampletestphp" class="fragment"></span><a href="#testsexampletestphp"><i class="fa fa-link"></i></a>tests/ExampleTest.php</h3>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">tests/ExampleTest.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
        <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="phpunit実行" class="fragment"></span><a href="#phpunit%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>phpunit実行</h2>

<p>実行</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$phpunit


PHPUnit 3.7.14 by Sebastian Bergmann.

Configuration read from /home/web/lo.test.org/phpunit.xml.dist

.

Time: 9 seconds, Memory: 5.25Mb

OK (1 test, 1 assertion)
</pre></div></div>

<p>以上。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />24位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/3ed551c440cf7b48bbfe">virtualbox(centos)でmongodbインストールメモ(ついでにrockmongoも)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-26 21:21:33</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[Linux]</b> <b>[MongoDB]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>mongo,mongoうるさいので入れることにした。<br>
ローカルとかで持っててログ解析とかにも便利そうだし</p>

<h2>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h2>

<ul>
<li>ここから先は全てroo(権限)ユーザーで実行しています</li>
<li>要git</li>
<li>開発環境構築の話です。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://studio3104.hatenablog.com/entry/2012/03/05/104039" rel="nofollow noopener" target="_blank">mongodbをyumでインストールし、rockmongoでWEBから操作する(CentOS5.7)</a></li>
<li><a href="http://d.hatena.ne.jp/fat47/20120426/1335428063" rel="nofollow noopener" target="_blank">【作業メモ】Apacheログをfluentd+MongoDBで収集しRubyで集計してみたが…</a></li>
</ul>

<h2>
<span id="10genリポジトリの追加" class="fragment"></span><a href="#10gen%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>10genリポジトリの追加</h2>

<p>10genリポジトリを追加しましょう</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/yum.repos.d/10gen.repo</span></div>
<div class="highlight"><pre><span></span>vim /etc/yum.repos.d/10gen.repo

[10gen]
name=10gen Repository
baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64
gpgcheck=0
enabled=0
</pre></div>
</div>

<h2>
<span id="mongodbのインストール" class="fragment"></span><a href="#mongodb%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>mongodbのインストール</h2>

<p>サクッとyumで</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum install mongo-10gen-server.x86_64 mongo-10gen.x86_64 --enablerepo=10gen


Loaded plugins: fastestmirror, priorities, security
Loading mirror speeds from cached hostfile
 * base: ftp.riken.jp
 * extras: ftp.riken.jp
 * updates: ftp.riken.jp
Setting up Install Process
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package mongo-10gen.x86_64 0:2.2.3-mongodb_1 will be installed
---&gt; Package mongo-10gen-server.x86_64 0:2.2.3-mongodb_1 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

=====================================================================================================
 Package                       Arch              Version                      Repository        Size
=====================================================================================================
Installing:
 mongo-10gen                   x86_64            2.2.3-mongodb_1              10gen             43 M
 mongo-10gen-server            x86_64            2.2.3-mongodb_1              10gen            6.7 M

Transaction Summary
=====================================================================================================
Install       2 Package(s)

Total download size: 49 M
Installed size: 121 M
Is this ok [y/N]: y
Downloading Packages:
(1/2): mongo-10gen-2.2.3-mongodb_1.x86_64.rpm                                 |  43 MB     00:23     
(2/2): mongo-10gen-server-2.2.3-mongodb_1.x86_64.rpm                          | 6.7 MB     00:10     
-----------------------------------------------------------------------------------------------------
Total                                                                1.4 MB/s |  49 MB     00:34     
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : mongo-10gen-2.2.3-mongodb_1.x86_64                                                1/2 
  Installing : mongo-10gen-server-2.2.3-mongodb_1.x86_64                                         2/2 
  Verifying  : mongo-10gen-2.2.3-mongodb_1.x86_64                                                1/2 
  Verifying  : mongo-10gen-server-2.2.3-mongodb_1.x86_64                                         2/2 

Installed:
  mongo-10gen.x86_64 0:2.2.3-mongodb_1          mongo-10gen-server.x86_64 0:2.2.3-mongodb_1         

Complete!

</pre></div></div>

<p>入った</p>

<h2>
<span id="mongodbの起動" class="fragment"></span><a href="#mongodb%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>mongodbの起動</h2>

<p>いつもどおり</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/mongod start


Starting mongod: forked process: 13622
all output going to: /var/log/mongo/mongod.log
child process started successfully, parent exiting             [  OK  ]
</pre></div></div>

<h2>
<span id="起動時に自動でmongodbが立ち上がってるようにする" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E6%99%82%E3%81%AB%E8%87%AA%E5%8B%95%E3%81%A7mongodb%E3%81%8C%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%8C%E3%81%A3%E3%81%A6%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>起動時に自動でmongodbが立ち上がってるようにする</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chkconfig mongod on
</pre></div></div>

<h2>
<span id="ついでにrockmongoも" class="fragment"></span><a href="#%E3%81%A4%E3%81%84%E3%81%A7%E3%81%ABrockmongo%E3%82%82"><i class="fa fa-link"></i></a>ついでにrockmongoも</h2>

<p>PHPでいうphpMyAdminのようなものです</p>

<h3>
<span id="適当にディレクトリを掘る" class="fragment"></span><a href="#%E9%81%A9%E5%BD%93%E3%81%AB%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E6%8E%98%E3%82%8B"><i class="fa fa-link"></i></a>適当にディレクトリを掘る</h3>

<p>ディレクトリ掘って解凍するだけです。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir /home/web/lo.rockmongo.org
cd /home/web/lo.rockmongo.org
wget http://rock-php.googlecode.com/files/rockmongo-v1.1.0.zip
unzip rockmongo-v1.1.0.zip 
</pre></div></div>

<p>解凍したディレクトリをnginx or apacheの設定を書いてください。</p>

<p>※デフォルトのユーザーはadminです。デフォルトのパスワードとかは危険なので入れたらすぐに変更しましょう</p>

<p>後は<a href="http://localhost%E3%81%A8%E3%81%8B%E3%81%A7%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E7%94%BB%E9%9D%A2%E3%81%8C%E3%81%A7%E3%81%A6%E3%81%84%E3%82%8C%E3%81%B0OK%E3%81%A7%E3%81%99%E3%80%82" class="autolink" rel="nofollow noopener" target="_blank">http://localhostとかでアクセスして画面がでていればOKです。</a></p>

<p>やっぱりなんとなく面倒だから入れてなかったですが、入れるだけなら１０分くらいでできた。<br>
こっから色々遊ぼーーっと</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />25位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/f4d32b90d74a3c7a60f4">virtualbox(centos)でnginxインストールメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-19 00:05:25</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[nginx]</b> <b>[Apache]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>環境 centos6.3（ゲストOS）macosx10.8(ホストOS)</p>

<p>nginxというapacheよりも高速に動くサーバーがにわか?に人気らしい<br>
名前は知っていたがapacheでいいじゃん〜という怠けから今まで入れていなかったが気が向いたので入れてみた。</p>

<ul>
<li>ここから先は全てrootユーザーで実行しています</li>
<li>開発環境構築の話です。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://wiki.nginx.org/NginxJa" rel="nofollow noopener" target="_blank">nginx wiki(日本語版)</a></li>
<li><a href="http://d.hatena.ne.jp/yoshi-ken/20120205" rel="nofollow noopener" target="_blank">CentOS-6へ最新版のnginxを3分でインストールする方法</a></li>
</ul>

<h2>
<span id="repoファイルの作成リポジトリの追加" class="fragment"></span><a href="#repo%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>repoファイルの作成（リポジトリの追加）</h2>

<p>nginxの公式方法のほうが最新のnginx入れられるのでこっちの方法をとった。<br>
/etc/yum.repos.d/に追加する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim /etc/yum.repos.d/nginx.repo



[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=0
enabled=1
</pre></div></div>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<p>yumでサクッと</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum install nginx
</pre></div></div>

<h2>
<span id="サーバーの設定" class="fragment"></span><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>サーバーの設定</h2>

<p>なんか間違えた場合に備えてバックアップ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.default
</pre></div></div>

<p>サクッと書く。apacheの設定よりシンプル<br>
listen,server_name,locationの項目のrootを変更するだけ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim /etc/nginx/conf.d/default.conf


listen       80;
server_name  lo.test.org; #自分で設定しているhostのアドレス自分はlo.test.orgというhostを設定しているのでそれで設定

    location / {
        root   /home/web/lo.test.org/www; #追加apacheでいうドキュメントルートのこと自分の開発環境のドキュメントルートになおして記載してください
        index  index.html index.htm;
    }

</pre></div></div>

<h2>
<span id="hostsの設定について" class="fragment"></span><a href="#hosts%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>hostsの設定について</h2>

<p>知ってる人は読み飛ばしてください。<br>
ゲストOS側（centos）のifconfigからゲストOS側のIPアドレス調べてホストOS(mac)側の/etc/hostsに記載する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ifconfig

#下記の項目(inet)がどこかにあるのでメモしておく（デフォルトだと192.168.xx.xxx）なはず
inet addr:192.168.56.101
</pre></div></div>

<p>ホストOS側(MAC)</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim /etc/hosts

#下記の項目を最後に記載
192.168.56.101  lo.test.org

</pre></div></div>

<h2>
<span id="apacheが動いている場合はapacheを止める" class="fragment"></span><a href="#apache%E3%81%8C%E5%8B%95%E3%81%84%E3%81%A6%E3%81%84%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AFapache%E3%82%92%E6%AD%A2%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>apacheが動いている場合はapacheを止める</h2>

<p>とりあえずはシンプルに動作確認するためにapacheは止める<br>
(/etc/nginx/conf.d/default.confの設定でport80番を使用する設定にしている為)</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/httpd stop
</pre></div></div>

<h2>
<span id="テスト用のhtmlファイルを設置" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E7%94%A8%E3%81%AEhtml%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%A8%AD%E7%BD%AE"><i class="fa fa-link"></i></a>テスト用のhtmlファイルを設置</h2>

<p>いつもどおりのhello.worldを</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim /home/web/lo.test.org/www/index.html

&lt;html&gt;
&lt;body&gt;
hello.world
&lt;/body&gt;
&lt;/html&gt;
</pre></div></div>

<h2>
<span id="nginxの起動" class="fragment"></span><a href="#nginx%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginxの起動</h2>

<p>これもapacheと似た感じでほぼ一緒</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/nginx start
</pre></div></div>

<h2>
<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h2>

<p><a href="">http://lo.test.org</a>にアクセスしてhello.worldが表示されればOK</p>

<p>nginxでググるとシンプルな設定方法がなかったので書いてみました。<br>
これだけだと今時のナウなこと(php-fpmやnodejs等)はまだまだなのですがまずはnginxのインストールから慣れてからナウなことをしようかということで</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />26位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/b51b7ec9d7c378f60237">virtualbox(centos)でphp-buildでコンパイルしたphp-fpmをnginxで使う為の設定メモ(virturalhostの設定まで)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-25 19:06:50</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[nginx]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>環境 centos6.3（ゲストOS）macosx10.8(ホストOS)</p>

<p><a href="http://qiita.com/items/f4d32b90d74a3c7a60f4">nginxを以前入れた</a>のだが肝心のphpの設定をまだ指定なかったので設定のメモ。<br>
ついでに普段複数のサイトを開発する場合に必要なvirtualhostの設定まで</p>

<h2>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h2>

<ul>
<li>nginxがインストール済みの状態であること。インストールをしていない場合は<a href="http://qiita.com/items/f4d32b90d74a3c7a60f4">virtualbox(centos)でnginxインストールメモ</a>を参照してください。</li>
<li>php-build+phpenvでPHPをインストール済みであること。インストールしていない場合は<a href="http://qiita.com/items/7d031440bb174a55a6a1">virtualbox(centos)でphpenv+php-buildインストールメモ(5.3,5.4変更確認まで)</a>を参照してください。</li>
<li>ここから先は全てroo(権限)ユーザーで実行しています</li>
<li>開発環境構築の話です。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://www.nullpop.net/?p=215" rel="nofollow noopener" target="_blank">nginx+php-fpmでPHPを動かす。その3</a></li>
<li>[CentOS NginxとPHPの連携)](<a href="http://www.happytrap.jp/blogs/2012/02/25/8299/%5D(http://d.hatena.ne.jp/yoshi-ken/20120205)" class="autolink" rel="nofollow noopener" target="_blank">http://www.happytrap.jp/blogs/2012/02/25/8299/](http://d.hatena.ne.jp/yoshi-ken/20120205)</a>
</li>
<li><a href="http://shiken.infrabu.info/nginx/nginx%E3%83%90%E3%83%BC%E3%83%81%E3%83%A3%E3%83%AB%E3%83%9B%E3%82%B9%E3%83%88%E8%A8%AD%E5%AE%9A/" rel="nofollow noopener" target="_blank">nginxバーチャルホスト設定（http、server、locationブロック）</a></li>
<li><a href="http://www.happytrap.jp/blogs/2012/02/25/8299/" rel="nofollow noopener" target="_blank">CentOS NginxとPHPの連携</a></li>
</ul>

<h2>
<span id="ゲストoscentos側のipの確認" class="fragment"></span><a href="#%E3%82%B2%E3%82%B9%E3%83%88oscentos%E5%81%B4%E3%81%AEip%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>ゲストOS(centos)側のIPの確認</h2>

<p>今回はvirtualhostを設定するのでゲストOS側のIPを調べる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$ifconfig

#下記の項目(inet)がどこかにあるのでメモしておく（デフォルトだと192.168.xx.xxx）なはず
inet addr:192.168.56.101
</pre></div></div>

<h2>
<span id="ホストos側macの設定" class="fragment"></span><a href="#%E3%83%9B%E3%82%B9%E3%83%88os%E5%81%B4mac%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ホストOS側（MAC）の設定</h2>

<h3>
<span id="virtualhostの追加" class="fragment"></span><a href="#virtualhost%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>virtualhostの追加</h3>

<p>hostsにnginx側のバーチャルホストの設定を追加しましょう</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/hosts</span></div>
<div class="highlight"><pre><span></span>
sudo vim /etc/hosts
#追加(ifconfigのinetの値)
192.168.56.101  lo.test.org
192.168.56.101  lo.sample.org
</pre></div>
</div>

<p>※windows8のhostsファイルの設定などは<a href="http://wabasyun.xxxxxxxx.jp/hosts7.html" rel="nofollow noopener" target="_blank">hostsファイルを編集</a>を参考にしてください。</p>

<h2>
<span id="pathが通っているか確認する" class="fragment"></span><a href="#path%E3%81%8C%E9%80%9A%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>PATHが通っているか確認する</h2>

<p><a href="http://qiita.com/items/f4d32b90d74a3c7a60f4">virtualbox(centos)でnginxインストールメモ</a>からの設定だとphp-fpmにPATHが通っていないので確認しましょう</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/root/.bashrc</span></div>
<div class="highlight"><pre><span></span>#修正前
export PATH="/root/.phpenv/bin:$PATH"

#修正後
export PATH="/root/.phpenv/bin:/root/.phpenv/versions/5.4.11/sbin:$PATH"
</pre></div>
</div>

<h2>
<span id="nginxの設定" class="fragment"></span><a href="#nginx%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>nginxの設定</h2>

<p>nginxにPHPの設定を追加しましょう</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/nginx/conf.d/default.conf</span></div>
<div class="highlight"><pre><span></span>vim /etc/nginx/conf.d/default.conf



server {
    listen       80;
    server_name  lo.test.org;
    location ~ \.php$ {
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /home/web/lo.test.org/www$fastcgi_script_name;
        include        fastcgi_params;
    }
}

server {
    listen       80;
    server_name  lo.sample.org;
    root   /home/web/lo.sample.org/www;
    index  index.php index.html index.htm;
    location ~ \.php$ {
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /home/web/lo.sample.org/www$fastcgi_script_name;
        include        fastcgi_params;
    }
}

</pre></div>
</div>

<p>serverディレクティブにそれぞれ server_nameを追加してserverディレクティブのlocationの項目にroot(apacheで言うドキュメントルート)を追加する。<br>
fastcgi_paramにはドキュメントルート+$fastcgi_script_nameを追加する<br>
今回の場合はlo.test.orgとlo.sample.orgというバーチャルホストを切っている</p>

<h2>
<span id="nginxの起動" class="fragment"></span><a href="#nginx%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginxの起動</h2>

<p>apacheと一緒</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/nginx restart


httpd を停止中:                                            [  OK  ]
nginx を起動中:                                            [  OK  ]
</pre></div></div>

<h2>
<span id="php-fpmの確認" class="fragment"></span><a href="#php-fpm%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>php-fpmの確認</h2>

<h3>
<span id="バージョン確認" class="fragment"></span><a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>バージョン確認</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php-fpm -v
PHP 5.4.12 (fpm-fcgi) (built: Feb 20 2013 14:06:12)
Copyright (c) 1997-2013 The PHP Group
Zend Engine v2.4.0, Copyright (c) 1998-2013 Zend Technologies
</pre></div></div>

<p>動いている</p>

<h2>
<span id="php-fpmconfの確認" class="fragment"></span><a href="#php-fpmconf%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>php-fpm.confの確認</h2>

<p>以前の記事<a href="http://qiita.com/items/7d031440bb174a55a6a1">virtualbox(centos)でphpenv+php-buildインストールメモ(5.3,5.4変更確認まで)</a>でやった場合、/root/.phpenv/versions/5.4.11/etc/php-fpm.conf.defaultというのがあるのでそれをコピーしてphp-fpmの設定ファイルを作成する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cp /root/.phpenv/versions/5.4.11/etc/php-fpm.conf.default /root/.phpenv/versions/5.4.11/etc/php-fpm.conf
</pre></div></div>

<h3>
<span id="設定を編集する" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>設定を編集する</h3>

<p>デフォルトのままで動かいたい場合はpidの項目だけ編集すればとりあえず動きます。<br>
（というか自分はどれが何のことだがよくわからなかった。。。。）</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/root/.phpenv/versions/5.4.11/etc/php-fpm.conf</span></div>
<div class="highlight"><pre><span></span>vim /root/.phpenv/versions/5.4.11/etc/php-fpm.conf

#修正前
;pid = run/php-fpm.pid

#修正後
pid = run/php-fpm.pid
#コメントアウト外す
</pre></div>
</div>

<h2>
<span id="phpのtimezoneの設定について" class="fragment"></span><a href="#php%E3%81%AEtimezone%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>PHPのtimezoneの設定について</h2>

<p>自分の環境だとphp-fpmで起動した場合にphp.iniのtimezoneを設定したのにかかわらずエラーになっていました。<br>
そこでphp-fpmの設定ファイル郡/root/.phpenv/versions/5.4.11/etc/conf.d/にdate.iniというのを作って対応しました。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/root/.phpenv/versions/5.4.11/etc/conf.d/date.ini</span></div>
<div class="highlight"><pre><span></span>vim /root/.phpenv/versions/5.4.11/etc/conf.d/date.ini


[Date]
date.timezone = Asia/Tokyo
</pre></div>
</div>

<p>これでtimezoneのエラーが消えました。<br>
phpinfo()とかでtimezoneのエラーになっている場合は試してみてください。</p>

<h2>
<span id="php-fpmの起動" class="fragment"></span><a href="#php-fpm%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>php-fpmの起動</h2>

<p>ちなみにこういうエラーが出た場合は一旦php-fpmのプロセスを切りましょう。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php-fpm
[25-Feb-2013 11:12:41] ERROR: unable to bind listening socket for address '127.0.0.1:9000': Address already in use (98)
[25-Feb-2013 11:12:41] ERROR: FPM initialization failed
</pre></div></div>

<p>php-fpmのプロセスが既に起動していて起動できないよ！！ってエラーです。(他に9000番のポートを使った場合は別ですが)</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span> ps aux | grep php
root      4485  0.0  0.6 291632  6584 ?        Ss   13:48   0:01 php-fpm: master process (/root/.phpenv/versions/5.4.11/etc/php-fpm.conf)
nobody    4486  0.0  0.9 291796  9288 ?        S    13:48   0:00 php-fpm: pool www
nobody    4487  0.0  0.9 291792  9312 ?        S    13:48   0:00 php-fpm: pool www
root      4815  0.0  0.0 107460   916 pts/1    S+   18:37   0:00 grep php



#masterプロセスを一旦落とす
kill 4485

</pre></div></div>

<h3>
<span id="起動" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>起動</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php-fpm
#何も出てこないがエラーが無ければ起動している


 ps aux | grep php
root      4817  0.0  0.6 291636  6584 ?        Ss   18:39   0:00 php-fpm: master process (/root/.phpenv/versions/5.4.11/etc/php-fpm.conf)
nobody    4818  0.0  0.9 291792  9280 ?        S    18:39   0:00 php-fpm: pool www                         
nobody    4819  0.0  0.7 291636  7184 ?        S    18:39   0:00 php-fpm: pool www                         
root      4823  0.0  0.0 107460   920 pts/1    S+   18:40   0:00 grep php
</pre></div></div>

<h2>
<span id="起動スクリプトの作成" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>起動スクリプトの作成</h2>

<p>面倒なんで起動した状態でphp-fpmが起動している状態にしちゃいましょう。<br>
下記のサイトを参照して作成しました。<br>
 <a href="http://www.happytrap.jp/blogs/2012/02/25/8299/" rel="nofollow noopener" target="_blank">CentOS NginxとPHPの連携</a></p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/init.d/php-fpm</span></div>
<div class="highlight"><pre><span></span>#! /bin/sh
#
# php-fpm - this script starts and stops the php-fpm daemon 
#
# chkconfig: - 85 15
# description: PHP-FPM (FastCGI Process Manager) is an alternative PHP FastCGI implementation
#              with some additional features useful for sites of any size, especially busier sites.
# processname: php-fpm                                                                                                                                            

PROG="/root/.phpenv/versions/5.4.11/sbin/php-fpm"
CONF="/root/.phpenv/versions/5.4.11/etc/php-fpm.conf"
LOCKFILE="/var/log/php-fpm/lock"

[ -f $CONF ] || exit 1

# Source function library.                                                                                                                                         
. /etc/init.d/functions

RETVAL=0

start() {
    echo -n $"Starting $PROG:"
    daemon $PROG -c $CONF
    RETVAL=$?
    echo
    [ $RETVAL = 0 ] &amp;&amp; touch $LOCKFILE
    return $RETVAL
}

stop() {
    echo -n $"Stopping $PROG:"
    killproc $PROG
    RETVAL=$?
    echo
    [ $RETVAL = 0 ] &amp;&amp; rm -f $LOCKFILE
    return $RETVAL
}

case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    restart)
        stop
        start
        ;;
    condrestart)
        if [ -f $LOCKFILE ]; then
            stop
            start
        fi
        ;;
    reload)
        action $"Reloading $PROG:" killall -HUP $PROG
        ;;
    *)
        echo $"Usage: $0 {start|stop|restart|reload|condrestart|status}"
        exit 1
esac

exit $RETVAL
</pre></div>
</div>

<p>PROG="/root/.phpenv/versions/5.4.11/sbin/php-fpm"<br>
CONF="/root/.phpenv/versions/5.4.11/etc/php-fpm.conf"<br>
LOCKFILE="/var/log/php-fpm/lock"<br>
上記の項目はそれぞれ各自の環境で変更してください。<br>
自分はphpenvでいれたので上記になります。<br>
phpenvについては<a href="http://qiita.com/items/7d031440bb174a55a6a1">virtualbox(centos)でphpenv+php-buildインストールメモ(5.3,5.4変更確認まで)</a>を参照してください。</p>

<h2>
<span id="起動スクリプトのパーミッションを変更" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E3%83%91%E3%83%BC%E3%83%9F%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>起動スクリプトのパーミッションを変更</h2>

<p>755で</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chmod 755 /etc/init.d/php-fpm
</pre></div></div>

<h2>
<span id="起動スクリプトの動作確認" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>起動スクリプトの動作確認</h2>

<h2>
<span id="起動する場合" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>起動する場合</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/php-fpm start
/root/.phpenv/versions/5.4.11/sbin/php-fpm を起動中:       [  OK  ]
</pre></div></div>

<h2>
<span id="停止する場合" class="fragment"></span><a href="#%E5%81%9C%E6%AD%A2%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>停止する場合</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/php-fpm stop
/root/.phpenv/versions/5.4.11/sbin/php-fpm を停止中:       [  OK  ]
</pre></div></div>

<h2>
<span id="自動起動を追加" class="fragment"></span><a href="#%E8%87%AA%E5%8B%95%E8%B5%B7%E5%8B%95%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>自動起動を追加</h2>

<p>これもいつもどおり</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chkconfig --add php-fpm
chkconfig php-fpm on
</pre></div></div>

<p>これでいちいちプロセス探してkillとかしてなくて良くなりました。</p>

<h2>
<span id="動作確認用のphpファイルを設置" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E7%94%A8%E3%81%AEphp%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%A8%AD%E7%BD%AE"><i class="fa fa-link"></i></a>動作確認用のphpファイルを設置</h2>

<p>いつもどおりで</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">ドキュメントルート/phpinfo.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">phpinfo</span><span class="p">();</span>
</pre></div>
</div>

<p>上記の設定の場合は<br>
/home/web/lo.sample.org/www/phpinfo.php<br>
/home/web/lo.test.org/www/phpinfo.php<br>
の２つに設定してください。</p>

<h2>
<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h2>

<p>上記の設定の場合は<br>
<a href="http://lo.sample.org/phpinfo.php" class="autolink" rel="nofollow noopener" target="_blank">http://lo.sample.org/phpinfo.php</a><br>
<a href="http://lo.test.org/phpinfo.php" class="autolink" rel="nofollow noopener" target="_blank">http://lo.test.org/phpinfo.php</a><br>
でphpinfoの中身が見えればOK!!</p>

<p>ちょっとはじめどこにphp-fpmがあるかわからず混乱しましたが落ち着いて考えれば以外とすんなり出来ました。<br>
これでphp-fpm+phpenvのタッグが組めると思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />27位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/6b303e3c2c44788b3ae5">chrome-extensionのChromePHPを使用してchromeからログを見る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-16 00:52:09</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[chrome-extension]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>chromePHPはPHPのログをコンソールに吐き出せるようにするツールです。</p>

<ul>
<li><a href="http://www.chromephp.com/" rel="nofollow noopener" target="_blank">Console logging extension for Google Chrome</a></li>
</ul>

<h2>
<span id="chrome-extensionをインストールする" class="fragment"></span><a href="#chrome-extension%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>chrome-extensionをインストールする</h2>

<p><a href="https://chrome.google.com/webstore/detail/chromephp/noaneddfkdjfnfdakjjmocngnfkfehhd" rel="nofollow noopener" target="_blank">ChromePHP</a></p>

<p>インストールするだけ</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>公式ドキュメントのまんまでOK<br>
include_pathをとおして置くと何かと楽</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="k">include</span> <span class="s1">'ChromePhp.php'</span><span class="p">;</span>
<span class="nx">ChromePhp</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">);</span>
<span class="nx">ChromePhp</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">);</span>

<span class="c1">// using labels</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$_SERVER</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ChromePhp</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// warnings and errors</span>
<span class="nx">ChromePhp</span><span class="o">::</span><span class="na">warn</span><span class="p">(</span><span class="s1">'this is a warning'</span><span class="p">);</span>
<span class="nx">ChromePhp</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s1">'this is an error'</span><span class="p">);</span>
</pre></div></div>

<p>でもこのままだとどこでログが出力されたかわからないのでちょっとカスタマイズする</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">My_Log.php</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">My_Log</span> <span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * クロムのコンソールログに出力するようのログ　※要chrome extension chromePHP</span>
<span class="sd">     * @link http://www.chromephp.com/</span>
<span class="sd">     * @param $message mixed 表示したいログの内容</span>
<span class="sd">     * @param $ident string ログの先頭に出力するプレフィックス文字列</span>
<span class="sd">     * @param $level int ChromePHPのログ出力フォーマットレベル</span>
<span class="sd">     * @return void</span>
<span class="sd">     **/</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">console</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$key</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$level</span> <span class="o">=</span> <span class="s1">'info'</span><span class="p">)</span> <span class="p">{</span>

        <span class="nv">$targetBackTrace</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nb">debug_backtrace</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$i</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 対象クラスと一致するので対象のバックトレース情報を付与する</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">==</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">'class'</span><span class="p">])</span> <span class="p">{</span>
                <span class="nv">$targetBackTrace</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
                <span class="nv">$filePath</span>  <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="nx">DIRECTORY_SEPARATOR</span><span class="p">,</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]);</span>
                <span class="nv">$fileShort</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">,</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">));</span>
                <span class="nv">$file</span>      <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="nx">DIRECTORY_SEPARATOR</span><span class="p">,</span> <span class="nv">$fileShort</span><span class="p">);</span>
                <span class="nv">$key</span>       <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'trace [%s:%s]'</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$val</span><span class="p">[</span><span class="s1">'line'</span><span class="p">]);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">require_once</span> <span class="s1">'ChromePhp.php'</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$level</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">'info'</span><span class="o">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$key</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">ChromePhp</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">ChromePhp</span><span class="o">::</span><span class="na">log</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'warm'</span><span class="o">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$key</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">ChromePhp</span><span class="o">::</span><span class="na">warn</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">ChromePhp</span><span class="o">::</span><span class="na">warn</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'error'</span><span class="o">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$key</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">ChromePhp</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">ChromePhp</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></div>
</div>

<p>大体今時はMVCなのでbacktraceから同一のクラスを見つけた場合の情報を取得している。<br>
使い方はシンプル</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">hoge.php</span></div>
<div class="highlight"><pre><span></span><span class="nx">My_Log</span><span class="o">::</span><span class="na">console</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">);</span>
</pre></div>
</div>

<p>以上</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />28位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/ae25133156aeddd7c24b">virtualbox(centos)でのfluentdインストールメモ(apacheのアクセスログ収集まで)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-15 17:56:19</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Apache]</b> <b>[fluentd]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>環境 centos6.3（ゲストOS）macosx10.8(ホストOS)</p>

<ul>
<li>ruby1.9.1以上gem1.8.1以上が入ってる前提とする</li>
<li>httpd(apache)がインストール済とする</li>
</ul>

<h2>
<span id="fluentdとは" class="fragment"></span><a href="#fluentd%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>fluentdとは</h2>

<p>ログなどをjson化できるもので日本人の古橋さんが開発したものです。<br>
<a href="http://d.hatena.ne.jp/viver/20110929/p1" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/viver/20110929/p1</a></p>

<p>有名企業でも導入がされています。</p>

<ul>
<li>slideshare</li>
<li>GREE 等</li>
</ul>

<p>公式ドキュメント<br>
<a href="http://docs.fluentd.org/articles/quickstart" class="autolink" rel="nofollow noopener" target="_blank">http://docs.fluentd.org/articles/quickstart</a><br>
日本語版（非公式??）<br>
<a href="http://documents.mazgi.com/fluentd/doc/index.html" class="autolink" rel="nofollow noopener" target="_blank">http://documents.mazgi.com/fluentd/doc/index.html</a></p>

<p>開発でよくある「アクセスログを解析してくれーーー」って時に<br>
jsonでオブジェクト化されたデータの精査ができるので便利そうです。<br>
（まだ使い始めなのでよくわからんが。。。。）</p>

<h2>
<span id="gemのupdateをする" class="fragment"></span><a href="#gem%E3%81%AEupdate%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>gemのupdateをする</h2>

<p>一番はじめ公式ドキュメント通りやろうと思ったらエラーになってしばし悩んだ。。。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>gem install fluentd --no-ri --no-rdoc

WARNING:  Error fetching data: SocketError: getaddrinfo: Name or service not known (http://rubygems.org/latest_specs.4.8.gz)
ERROR:  Could not find a valid gem 'fluentd' (&gt;= 0) in any repository
ERROR:  Possible alternatives: fluentd

</pre></div></div>

<p>悩むこと１時間まずはupdateかと気づく<br>
なんかの依存モジュールのパッケージで引っ掛かんだと思う。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>gem update

Updating installed gems
WARNING:  Error fetching data: SocketError: getaddrinfo: Name or service not known (http://rubygems.org/latest_specs.4.8.gz)
Updating io-console
WARNING:  Error fetching data: SocketError: getaddrinfo: Name or service not known (http://rubygems.org/specs.4.8.gz)
Fetching: io-console-0.4.1.gem (100%)
Building native extensions.  This could take a while...
Successfully installed io-console-0.4.1
Updating minitest
Fetching: minitest-4.5.0.gem (100%)
Successfully installed minitest-4.5.0
Updating rake
Fetching: rake-10.0.3.gem (100%)
Successfully installed rake-10.0.3
Updating rdoc
Fetching: rdoc-3.12.1.gem (100%)
Depending on your version of ruby, you may need to install ruby rdoc/ri data:

&lt;= 1.8.6 : unsupported
 = 1.8.7 : gem install rdoc-data; rdoc-data --install
 = 1.9.1 : gem install rdoc-data; rdoc-data --install
&gt;= 1.9.2 : nothing to do! Yay!
Successfully installed rdoc-3.12.1
Gems updated: io-console, minitest, rake, rdoc
Installing ri documentation for io-console-0.4.1...
Installing ri documentation for minitest-4.5.0...
Installing ri documentation for rake-10.0.3...
Installing ri documentation for rdoc-3.12.1...
Installing RDoc documentation for io-console-0.4.1...
Installing RDoc documentation for minitest-4.5.0...
Installing RDoc documentation for rake-10.0.3...
Installing RDoc documentation for rdoc-3.12.1...


</pre></div></div>

<p>もう一度リトライ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>gem install fluentd

Fetching: msgpack-0.4.7.gem (100%)
Building native extensions.  This could take a while...
Fetching: iobuffer-1.1.2.gem (100%)
Building native extensions.  This could take a while...
Fetching: cool.io-1.1.0.gem (100%)
Building native extensions.  This could take a while...
Fetching: http_parser.rb-0.5.3.gem (100%)
Building native extensions.  This could take a while...
Fetching: fluentd-0.10.31.gem (100%)
Successfully installed msgpack-0.4.7
Successfully installed iobuffer-1.1.2
Successfully installed cool.io-1.1.0
Successfully installed http_parser.rb-0.5.3
Successfully installed fluentd-0.10.31
5 gems installed
Installing ri documentation for msgpack-0.4.7...
Installing ri documentation for iobuffer-1.1.2...
Installing ri documentation for cool.io-1.1.0...
Installing ri documentation for http_parser.rb-0.5.3...
Installing ri documentation for fluentd-0.10.31...
Installing RDoc documentation for msgpack-0.4.7...
Installing RDoc documentation for iobuffer-1.1.2...
Installing RDoc documentation for cool.io-1.1.0...
Installing RDoc documentation for http_parser.rb-0.5.3...
Installing RDoc documentation for fluentd-0.10.31... #入った

</pre></div></div>

<p>※コマンドで最初fluentdが見つからなくて困ったが一旦virtualboxからexitで抜けて入りなおしたら入っていた。<br>
多分PATHの設定がrbenvだと一旦コンソールから抜けないとダメっぽい。。<br>
（というかinitの処理が必要だったみたい）</p>

<h2>
<span id="fluentdのセットアップ" class="fragment"></span><a href="#fluentd%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>fluentdのセットアップ</h2>

<p>まあ/etc/以下にあればいいだろうということで</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>fluentd --setup /etc/fluent

installed ./fluent/fluent.conf.
</pre></div></div>

<h2>
<span id="動作検証" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E6%A4%9C%E8%A8%BC"><i class="fa fa-link"></i></a>動作検証</h2>

<p>これもマニュアルどおりにやってみる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>fluentd -c /etc/fluent/fluent.conf -vv &amp;

[1] 4075
[root@localhost fluent]# 2013-02-15 11:45:51 +0900: fluent/supervisor.rb:153:supervise: starting fluentd-0.10.31
2013-02-15 11:45:51 +0900: fluent/supervisor.rb:235:read_config: reading config file path="fluent.conf"
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered buffer plugin 'file'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered buffer plugin 'memory'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'debug_agent'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'exec'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'forward'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'gc_stat'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'http'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'object_space'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'status'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'tcp'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'unix'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'syslog'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'tail'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'copy'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'exec'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'exec_filter'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'file'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'forward'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'null'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'roundrobin'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'stdout'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'tcp'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'unix'
2013-02-15 11:45:51 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'test'
2013-02-15 11:45:51 +0900: fluent/engine.rb:61:configure: using configuration file: &lt;ROOT&gt;
  &lt;source&gt;
    type forward
  &lt;/source&gt;
  &lt;source&gt;
    type http
    port 8888
  &lt;/source&gt;
  &lt;source&gt;
    type debug_agent
    port 24230
  &lt;/source&gt;
  &lt;match debug.**&gt;
    type stdout
  &lt;/match&gt;
&lt;/ROOT&gt;
2013-02-15 11:45:51 +0900: fluent/engine.rb:70:block in configure: adding source type="forward"
2013-02-15 11:45:51 +0900: fluent/engine.rb:70:block in configure: adding source type="http"
2013-02-15 11:45:51 +0900: fluent/engine.rb:70:block in configure: adding source type="debug_agent"
2013-02-15 11:45:51 +0900: fluent/engine.rb:86:block in configure: adding match pattern="debug.**" type="stdout"
2013-02-15 11:45:51 +0900: plugin/in_forward.rb:63:listen: listening fluent socket on 0.0.0.0:24224
2013-02-15 11:45:51 +0900: plugin/in_http.rb:74:start: listening http on 0.0.0.0:8888
2013-02-15 11:45:51 +0900: plugin/in_debug_agent.rb:46:start: listening dRuby uri="druby://0.0.0.0:24230" object="Engine"

</pre></div></div>

<p>実際やってみる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>echo '{"json":"message"}' | fluent-cat debug.test

2013-02-15 11:46:08 +0900: plugin/in_forward.rb:147:initialize: accepted fluent socket object_id=14395860
2013-02-15 11:46:08 +0900 debug.test: {"json":"message"}
2013-02-15 11:46:08 +0900: plugin/in_forward.rb:188:on_close: closed fluent socket object_id=14395860

</pre></div></div>

<p>動いてる</p>

<h2>
<span id="fluentdの起動と停止方法" class="fragment"></span><a href="#fluentd%E3%81%AE%E8%B5%B7%E5%8B%95%E3%81%A8%E5%81%9C%E6%AD%A2%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>fluentdの起動と停止方法</h2>

<h3>
<span id="起動" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>起動</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>fluentd -c fluent.confのパス -vv &amp;
</pre></div></div>

<h3>
<span id="停止" class="fragment"></span><a href="#%E5%81%9C%E6%AD%A2"><i class="fa fa-link"></i></a>停止</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#デフォルトは24224っぽい
/usr/sbin/lsof | grep 24224

fluentd   6428      root    6u     IPv4              44926      0t0        TCP *:24224 (LISTEN)
fluentd   6428      root    7u     IPv4              44928      0t0        UDP *:24224 
</pre></div></div>

<p>プロセスが生きてることを確認して</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>pkill fluentd

</pre></div></div>

<p>殺す！！</p>

<p>※一部のブログで下記の方法で停止をしていますが、たまにプロセスが重複起動してプロセスが殺しきれない場合があるので注意してください。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#まずはjobの確認
jobs -l
[1]+  4075 Running                 fluentd -c fluent.conf -vv &amp;


#そしてkill
kill 4075
# 2013-02-15 12:09:17 +0900: fluent/engine.rb:167:stop: shutting down fluentd
2013-02-15 12:09:18 +0900: fluent/supervisor.rb:170:supervise: process finished code=0

[1]+  Done                    fluentd -c fluent.conf -vv

</pre></div></div>

<h2>
<span id="apacheのアクセスログをjsonで出力する" class="fragment"></span><a href="#apache%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%AD%E3%82%B0%E3%82%92json%E3%81%A7%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>apacheのアクセスログをjsonで出力する</h2>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/fluent/fluent.conf</span></div>
<div class="highlight"><pre><span></span>vim /etc/fluent/fluent.conf

#修正前
#&lt;source&gt;
#  type tail
#  format apache
#  path /var/log/httpd/access_log
#  tag apache.access
#&lt;/source&gt;


#コメントアウトを外してpathの部分を変更する
#修正後
&lt;source&gt;
  type tail
  format apache
  path /var/log/httpd/access_log
  tag apache.access
&lt;/source&gt;

# 修正前
#&lt;match apache.access&gt;
#  type file
#  path /var/log/fluent/access
#&lt;/match&gt;

#修正後
&lt;match apache.access&gt;
  type file
  path /var/log/fluent/access
&lt;/match&gt;
</pre></div>
</div>

<h2>
<span id="fluentdの再起動" class="fragment"></span><a href="#fluentd%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>fluentdの再起動</h2>

<p>再起動しないと読み込まなかったので</p>

<h3>
<span id="停止-1" class="fragment"></span><a href="#%E5%81%9C%E6%AD%A2-1"><i class="fa fa-link"></i></a>停止</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>pkill fluentd
</pre></div></div>

<h3>
<span id="再起動" class="fragment"></span><a href="#%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>再起動</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>fluentd -c /etc/fluent/fluent.conf -vv &amp;


[1] 4171
[root@localhost fluent]# 2013-02-15 12:21:53 +0900: fluent/supervisor.rb:153:supervise: starting fluentd-0.10.31
2013-02-15 12:21:53 +0900: fluent/supervisor.rb:235:read_config: reading config file path="/etc/fluent/fluent.conf"
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered buffer plugin 'file'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered buffer plugin 'memory'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'debug_agent'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'exec'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'forward'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'gc_stat'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'http'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'object_space'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'status'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'tcp'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'unix'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'syslog'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered input plugin 'tail'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'copy'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'exec'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'exec_filter'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'file'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'forward'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'null'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'roundrobin'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'stdout'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'tcp'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'unix'
2013-02-15 12:21:53 +0900: fluent/plugin.rb:89:register_impl: registered output plugin 'test'
2013-02-15 12:21:53 +0900: fluent/engine.rb:61:configure: using configuration file: &lt;ROOT&gt;
  &lt;source&gt;
    type forward
  &lt;/source&gt;
  &lt;source&gt;
    type http
    port 8888
  &lt;/source&gt;
  &lt;source&gt;
    type tail
    format apache
    path /var/log/httpd/access_log
    tag apache.access
  &lt;/source&gt;
  &lt;source&gt;
    type debug_agent
    port 24230
  &lt;/source&gt;
  &lt;match apache.access&gt;
    type file
    path /var/log/fluent/access
  &lt;/match&gt;
  &lt;match debug.**&gt;
    type stdout
  &lt;/match&gt;
&lt;/ROOT&gt;
2013-02-15 12:21:53 +0900: fluent/engine.rb:70:block in configure: adding source type="forward"
2013-02-15 12:21:53 +0900: fluent/engine.rb:70:block in configure: adding source type="http"
2013-02-15 12:21:53 +0900: fluent/engine.rb:70:block in configure: adding source type="tail"
2013-02-15 12:21:53 +0900: plugin/in_tail.rb:49:configure: 'pos_file PATH' parameter is not set to a 'tail' source.
2013-02-15 12:21:53 +0900: plugin/in_tail.rb:50:configure: this parameter is highly recommended to save the position to resume tailing.
2013-02-15 12:21:53 +0900: fluent/engine.rb:70:block in configure: adding source type="debug_agent"
2013-02-15 12:21:53 +0900: fluent/engine.rb:86:block in configure: adding match pattern="apache.access" type="file"
2013-02-15 12:21:53 +0900: fluent/engine.rb:86:block in configure: adding match pattern="debug.**" type="stdout"
2013-02-15 12:21:53 +0900: plugin/in_forward.rb:63:listen: listening fluent socket on 0.0.0.0:24224
2013-02-15 12:21:53 +0900: plugin/in_http.rb:74:start: listening http on 0.0.0.0:8888
2013-02-15 12:21:53 +0900: plugin/in_tail.rb:289:initialize: following tail of /var/log/httpd/access_log
2013-02-15 12:21:53 +0900: plugin/in_debug_agent.rb:46:start: listening dRuby uri="druby://0.0.0.0:24230" object="Engine"


</pre></div></div>

<p>エラーとかがでていないことを確認する</p>

<h2>
<span id="出力内容の確認" class="fragment"></span><a href="#%E5%87%BA%E5%8A%9B%E5%86%85%E5%AE%B9%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>出力内容の確認</h2>

<p>場所は/var/log/fluent/httpd/access.日付.トークン</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>tail -f /var/log/fluent/httpd/access.20130215.b4d5bdcc431c4eeec

</pre></div></div>

<p>開発環境等にアクセスして監視してみる</p>

<p>例） <a href="http://localhost%E3%81%AA%E3%81%A9%E3%81%AB%E8%A4%87%E6%95%B0%E5%9B%9E%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B" class="autolink" rel="nofollow noopener" target="_blank">http://localhostなどに複数回アクセスしてみる</a></p>

<p>出力されていればOK!!</p>

<p>後は起動スクリプトとかあったら便利だけど、心が折れたのでここまで！！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />29位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/ed7c86d3a7c183c76081">.phpenvで入れた場合のpeclモジュールの追加方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-26 20:48:28</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以前<a href="http://qiita.com/items/7d031440bb174a55a6a1">virtualbox(centos)でphpenv+php-buildインストールメモ(5.3,5.4変更確認まで)</a>でphpenvを入れたのだが、peclのコマンドがなかった。<br>
はてそこら辺ってどうやるんだろう？？ということでpeclモジュールの<a href="http://pecl.php.net/package/mongo" rel="nofollow noopener" target="_blank">mongo</a>を入れた時のメモ</p>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://blog.yymomomomoyy.com/?p=192" rel="nofollow noopener" target="_blank">複数のphpをインストールしている環境でphpize</a></li>
</ul>

<p>※以降は全てroot権限で実行しています</p>

<h2>
<span id="peclコマンドがない" class="fragment"></span><a href="#pecl%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>peclコマンドがない</h2>

<p>peclモジュールを入れるときに便利なpeclコマンドがなかった</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>which pecl
</pre></div></div>

<p>なかったので<a href="http://php.net/manual/ja/install.pecl.phpize.php" rel="nofollow noopener" target="_blank">phpize</a>で入れることにした</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>which phpize
/root/.phpenv/shims/phpize
</pre></div></div>

<h2>
<span id="peclmongoの取得" class="fragment"></span><a href="#peclmongo%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>pecl/mongoの取得</h2>

<p>peclのサイトで欲しいextensionのダウンロードURLを取得する</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/tmp</span></div>
<div class="highlight"><pre><span></span>cd /tmp
wget http://pecl.php.net/get/mongo-1.3.4.tgz


--2013-02-26 19:44:13--  http://pecl.php.net/get/mongo-1.3.4.tgz
pecl.php.net をDNSに問いあわせています... 76.75.200.106
pecl.php.net|76.75.200.106|:80 に接続しています... 接続しました。
HTTP による接続要求を送信しました、応答を待っています... 200 OK
長さ: 124844 (122K) [application/octet-stream]
`mongo-1.3.4.tgz' に保存中

100%[===========================================================&gt;] 124,844      102K/s 時間 1.2s    

2013-02-26 19:44:15 (102 KB/s) - `mongo-1.3.4.tgz' へ保存完了 [124844/124844]


#tgzを解凍する
tar zxvf mongo-1.3.4.tgz 
</pre></div>
</div>

<h2>
<span id="phpizeを使ってコンパイルする" class="fragment"></span><a href="#phpize%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>phpizeを使ってコンパイルする</h2>

<h3>
<span id="configureファイルを作成する" class="fragment"></span><a href="#configure%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>configureファイルを作成する</h3>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/tmp/mongo-1.3.4</span></div>
<div class="highlight"><pre><span></span>cd /tmp/mongo-1.3.4
phpize 


Configuring for:
PHP Api Version:         20100412
Zend Module Api No:      20100525
Zend Extension Api No:   220100525
</pre></div>
</div>

<h2>
<span id="configure" class="fragment"></span><a href="#configure"><i class="fa fa-link"></i></a>configure</h2>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/tmp/mongo-1.3.4</span></div>
<div class="highlight"><pre><span></span>./configure
make
#インストールする内容を確認
make test


Build complete.
Don't forget to run 'make test'.


=====================================================================
PHP         : /root/.phpenv/versions/5.4.11/bin/php 
PHP_SAPI    : cli
PHP_VERSION : 5.4.11
ZEND_VERSION: 2.4.0
PHP_OS      : Linux - Linux localhost.localdomain 2.6.32-279.19.1.el6.x86_64 #1 SMP Wed Dec 19 07:05:20 UTC 2012 x86_64
INI actual  : /tmp/mongo-1.3.4/tmp-php.ini
More .INIs  :  
CWD         : /tmp/mongo-1.3.4
Extra dirs  : 
VALGRIND    : Not used
=====================================================================
TIME START 2013-02-26 10:48:37
=====================================================================
No tests were run.

#インストール
make install


Installing shared extensions:     /root/.phpenv/versions/5.4.11/lib/php/extensions/no-debug-non-zts-20100525/
#入った
</pre></div>
</div>

<h2>
<span id="mongoiniの追加" class="fragment"></span><a href="#mongoini%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>mongo.iniの追加</h2>

<p>上記のコンパイルでextensionが/root/.phpenv/versions/5.4.11/lib/php/extensions/no-debug-non-zts-20100525/に入ってうのがわかったのでiniファイルを追加する</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/root/.phpenv/versions/5.4.11/etc/conf.d/mongo.ini</span></div>
<div class="highlight"><pre><span></span>#新規で作成
vim /root/.phpenv/versions/5.4.11/etc/conf.d/mongo.ini


extension=/root/.phpenv/versions/5.4.11/lib/php/extensions/no-debug-non-zts-20100525/mongo.so
</pre></div>
</div>

<h2>
<span id="apacheの場合は再起動" class="fragment"></span><a href="#apache%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AF%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>apacheの場合は再起動</h2>

<p>いつもどおりで</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/httpd restart
</pre></div></div>

<h2>
<span id="nginxの場合はphp-fpmをkillしてnginxの再起動" class="fragment"></span><a href="#nginx%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AFphp-fpm%E3%82%92kill%E3%81%97%E3%81%A6nginx%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginxの場合はphp-fpmをkillしてnginxの再起動</h2>

<h3>
<span id="php-fpmのプロセスを殺す" class="fragment"></span><a href="#php-fpm%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E6%AE%BA%E3%81%99"><i class="fa fa-link"></i></a>php-fpmのプロセスを殺す</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ps aux | grep php


root      2331  0.0  0.6 291632  6580 ?        Ss   19:17   0:00 php-fpm: master process (/root/.phpenv/versions/5.4.11/etc/php-fpm.conf)
nobody    2332  0.0  0.9 291788  9308 ?        S    19:17   0:00 php-fpm: pool www
nobody    2333  0.0  0.9 291788  9308 ?        S    19:17   0:00 php-fpm: pool www
root      7932  0.0  0.0 107460   916 pts/0    S+   20:06   0:00 grep php

#プロセスを殺す
kill 2331
</pre></div></div>

<h3>
<span id="nginxの再起動" class="fragment"></span><a href="#nginx%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginxの再起動</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/nginx restart
nginx を停止中:                                            [  OK  ]
nginx を起動中:                                            [  OK  ]
</pre></div></div>

<p>後はphpinfo()とかでmongoのモジュールが入っていればOK<br>
以上。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />30位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/72e74a354cfb24827ff4">ドラゴンボールマネジメント</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-11 15:03:11</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[アジャイル]</b> <b>[agile]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>プロジェクトが窮地に陥ると溜っていた不満が噴出していきます。</p>

<ul>
<li>炎上する現場</li>
<li>雰囲気の悪いプロジェクト</li>
<li>やる気がないメンバー</li>
<li>Aさんが気に食わない</li>
<li>etc…</li>
</ul>

<p>それを未然に解決できればいいのですが、現実として全てを防げる事は中々難しい事です。<br>
アジャイルでやっても炎上する時は炎上します。</p>

<p>そこで上記のような炎上し始めた場合にやるマネジメント方法として下記の事を実践したら大体のプロジェクトで上手くいったのでメモ</p>

<h2>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h2>

<ul>
<li>主にエンジニアを取りまとめるマネージャー、リーダーを対象として話しています。</li>
<li>プロジェクトあたり5人以上の人が存在するプロジェクト

<ul>
<li>それ以下の人数の場合は多分純粋なリソース不足に陥ってるケースが多いので該当しません。</li>
</ul>
</li>
</ul>

<h2>
<span id="ゴールイメージ" class="fragment"></span><a href="#%E3%82%B4%E3%83%BC%E3%83%AB%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>ゴールイメージ</h2>

<ul>
<li>メンバーがタスクを行うにあたり完了までのスピードをあげる事(タスク処理の効率化)</li>
<li>メンバーが自立的に課題を取り組めるような環境を提供すること</li>
</ul>

<h2>
<span id="ドラゴンボールマネジメントとは" class="fragment"></span><a href="#%E3%83%89%E3%83%A9%E3%82%B4%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%AB%E3%83%9E%E3%83%8D%E3%82%B8%E3%83%A1%E3%83%B3%E3%83%88%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>ドラゴンボールマネジメントとは？</h2>

<h3>
<span id="メンバーに対してどんな願いも1つだけ叶える" class="fragment"></span><a href="#%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BC%E3%81%AB%E5%AF%BE%E3%81%97%E3%81%A6%E3%81%A9%E3%82%93%E3%81%AA%E9%A1%98%E3%81%84%E3%82%821%E3%81%A4%E3%81%A0%E3%81%91%E5%8F%B6%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>メンバーに対してどんな願いも1つだけ叶える</h3>

<p>上記をメンバーに対して実践する事になります。</p>

<h2>
<span id="なぜ願いを叶えるのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9C%E9%A1%98%E3%81%84%E3%82%92%E5%8F%B6%E3%81%88%E3%82%8B%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜ願いを叶えるのか？</h2>

<p>メンバーとの信頼関係を構築する為に必要だからです。<br>
炎上しているプロジェクトの場合は大体何かしらの不満、物理的に厳しい要求等が少しづつ重なり炎上に発展していきます。</p>

<p>小さな炎(不満、要求)が少しづつ重なり燃え広がる = 炎上<br>
ですから。</p>

<h2>
<span id="なぜ信頼関係を構築しなくてはいけないのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9C%E4%BF%A1%E9%A0%BC%E9%96%A2%E4%BF%82%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%AA%E3%81%8F%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜ信頼関係を構築しなくてはいけないのか？</h2>

<p>当然の事ながら信頼関係を構築しないと、要求に対して実行までのプロセスが長くなるからです。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">onegai.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="kp">false</span>

<span class="k">while</span> <span class="n">v</span> <span class="o">==</span> <span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
 <span class="k">if</span> <span class="s2">"Aさん「Bさん、このタスクちょっとお願いしてもいいですか？」"</span>
    <span class="k">if</span> <span class="s2">" Bさん「えー、だってCさんがアレでコレだから嫌ですよ」"</span>
    <span class="n">elif</span> <span class="s2">"「でもさー、アレがコレでどうしても今お願いできるのはBさんしかいなくて。。。」"</span>
        <span class="k">if</span> <span class="s2">"Bさん「えー、でもさーーー」"</span>
            <span class="o">.</span>
            <span class="o">.</span>
            <span class="o">.</span>
        <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>プログラムで表しただけでももうカオスなコードですよね。</p>

<p>信頼関係を構築できると大体の人はこんな形な大分すっきりしたコードで表せると思います。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">onegai.rb</span></div>
<div class="highlight"><pre><span></span>
<span class="n">yokyu</span> <span class="o">=</span> <span class="s2">"タスク"</span>
<span class="n">v</span> <span class="o">=</span> <span class="s2">""</span>
<span class="n">res</span> <span class="o">=</span> <span class="kp">false</span>

<span class="k">case</span> <span class="n">v</span>
  <span class="k">when</span> <span class="s2">"「Bさん、この</span><span class="si">#{</span><span class="n">yokyu</span><span class="si">}</span><span class="s2">ちょっとお願いしてもいいですか？」"</span>
    <span class="n">say</span> <span class="o">=</span> <span class="s2">"Aさんが言うなら。。。。いいですよ"</span>
    <span class="k">if</span> <span class="sr">/いいですよ/</span> <span class="o">=~</span> <span class="n">say</span>
      <span class="n">res</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="k">end</span>
  <span class="k">when</span> <span class="s2">"「Cさん、この</span><span class="si">#{</span><span class="n">yokyu</span><span class="si">}</span><span class="s2">ちょっとお願いしてもいいですか？」"</span>
    <span class="n">say</span> <span class="o">=</span> <span class="s2">"Aさんが言うなら。。。。いいですよ"</span>
    <span class="k">if</span> <span class="sr">/いいですよ/</span> <span class="o">=~</span> <span class="n">say</span>
      <span class="n">res</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="k">end</span>
  <span class="k">when</span> <span class="s2">"「Dさん、この</span><span class="si">#{</span><span class="n">yokyu</span><span class="si">}</span><span class="s2">ちょっとお願いしてもいいですか？」"</span>
    <span class="n">say</span> <span class="o">=</span> <span class="s2">"Aさんが言うなら。。。。いいですよ"</span>
    <span class="k">if</span> <span class="sr">/いいですよ/</span> <span class="o">=~</span> <span class="n">say</span>
      <span class="n">res</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>大分コードが綺麗になりました。</p>

<h2>
<span id="マネジメントに専念する為に自分がタスクに手を出しては行けない" class="fragment"></span><a href="#%E3%83%9E%E3%83%8D%E3%82%B8%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AB%E5%B0%82%E5%BF%B5%E3%81%99%E3%82%8B%E7%82%BA%E3%81%AB%E8%87%AA%E5%88%86%E3%81%8C%E3%82%BF%E3%82%B9%E3%82%AF%E3%81%AB%E6%89%8B%E3%82%92%E5%87%BA%E3%81%97%E3%81%A6%E3%81%AF%E8%A1%8C%E3%81%91%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>マネジメントに専念する為に自分がタスクに手を出しては行けない</h2>

<p>炎上中の場合、崩れるのはまず指揮系統が破綻している場合が多いです。<br>
なのでこの時にタスクを自分でタスクを抱えてしまうと、燃え広がり方を監視できなくなるのでなるたけ手をだすのは止めましょう。(もしくは本当にすぐに完了できるタスクのみ)</p>

<h2>
<span id="願いの内容のヒアリングについて" class="fragment"></span><a href="#%E9%A1%98%E3%81%84%E3%81%AE%E5%86%85%E5%AE%B9%E3%81%AE%E3%83%92%E3%82%A2%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>願いの内容のヒアリングについて</h2>

<p>炎上中の場合は願いの要求のハードルがすごく高くなっています。(不満が爆発しているので)<br>
なので願いのハードルを下げるようにしましょう</p>

<h3>
<span id="1個室又はプロジェクトから離れたスペースに連れ出す" class="fragment"></span><a href="#1%E5%80%8B%E5%AE%A4%E5%8F%88%E3%81%AF%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%8B%E3%82%89%E9%9B%A2%E3%82%8C%E3%81%9F%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AB%E9%80%A3%E3%82%8C%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>1.個室又はプロジェクトから離れたスペースに連れ出す</h3>

<p>個室に連れ出すのは有効な手段です。<br>
個室やプロジェクトから離れたスペースに連れ出さないと本音をほとんど聞き出す事はできません。<br>
特に「人間関係のこじれ」は聞き出せません。<br>
複数人でプロジェクトを進めていると人対人なので必ずこじれは発生しています。<br>
なので少し面倒でも一人づつ個室に誘致しましょう。</p>

<h3>
<span id="2何が困っているかを聞き出す" class="fragment"></span><a href="#2%E4%BD%95%E3%81%8C%E5%9B%B0%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E3%82%92%E8%81%9E%E3%81%8D%E5%87%BA%E3%81%99"><i class="fa fa-link"></i></a>2.何が困っているか？を聞き出す</h3>

<p>最初の冒頭は大体下記の一言を言っています。</p>

<p>「私はあなたの味方(仲間)です。<br>
あなたが困っているように感じているのであなたを助けたい。<br>
でも、私はあなたではないのであなたの困ってる事を全て把握はできていません。<br>
なので困っている事を教えて欲しい」</p>

<p>これでも本音が出てきていないと感じたら</p>

<p>「例えば、Aさんが気に食わないとかでもいいですよ」</p>

<p>とか言ってます。</p>

<p>炎上している場合は、当然ながら敵(プロジェクトの進行を阻害する人)もプロジェクトに来ます。まずは味方だとアピールすることは非常に重要です。</p>

<p>困ってる事は非常に重要でそこに必ずヒントが隠されています。<br>
そのヒントを取得する為に本音を聞き出しましょう。</p>

<p>困ってる内容を話しはじめてくれたら、次のポイントを念頭に置きながらヒアリングを進めていきます。</p>

<h4>
<span id="願いの落としどころをどこでつけるか" class="fragment"></span><a href="#%E9%A1%98%E3%81%84%E3%81%AE%E8%90%BD%E3%81%A8%E3%81%97%E3%81%A9%E3%81%93%E3%82%8D%E3%82%92%E3%81%A9%E3%81%93%E3%81%A7%E3%81%A4%E3%81%91%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>願いの落としどころをどこでつけるか?</h4>

<p>ドラゴンボールマネジメントと言いながら、当然どんな願いでも叶えれる訳ではありません。<br>
でも、願いは叶えないと信頼関係は築けません。</p>

<h3>
<span id="3どういうプロセスで願いを叶えるかを提示する" class="fragment"></span><a href="#3%E3%81%A9%E3%81%86%E3%81%84%E3%81%86%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%A7%E9%A1%98%E3%81%84%E3%82%92%E5%8F%B6%E3%81%88%E3%82%8B%E3%81%8B%E3%82%92%E6%8F%90%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3.どういうプロセスで願いを叶えるかを提示する</h3>

<p>「よしわかった。叶えよう！！」とすぐに叶えられるものはほとんどないはずです。<br>
ましては内容を聞いて長期的な改善、プロセスが必要なものもあります。なので</p>

<ul>
<li>まずはコレをする</li>
<li>コレをした後アレをする</li>
<li>そしてアレの結果を見て次にソレをする</li>
</ul>

<p>と困ってる人に対してプランニングを提示しましょう。<br>
コレで大体の人は納得してくれるはずです。<br>
これで信頼関係の第一歩が取れました。</p>

<p>そして次からタスクをお願いする時に</p>

<p>「この前言った通りにまずはコレをする為にはこのタスクを消化する必要があります。申し訳ありませんがお願いできますか？」</p>

<p>とお願いします。</p>

<h3>
<span id="おまえの願いを叶えるためにドラゴンボールを集めるタスクを課す" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%88%E3%81%AE%E9%A1%98%E3%81%84%E3%82%92%E5%8F%B6%E3%81%88%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E3%83%89%E3%83%A9%E3%82%B4%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%AB%E3%82%92%E9%9B%86%E3%82%81%E3%82%8B%E3%82%BF%E3%82%B9%E3%82%AF%E3%82%92%E8%AA%B2%E3%81%99"><i class="fa fa-link"></i></a>「おまえの願いを叶えるためにドラゴンボールを集めるタスクを課す」</h3>

<p>ということです。</p>

<h2>
<span id="複数の願いが存在する場合" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%81%AE%E9%A1%98%E3%81%84%E3%81%8C%E5%AD%98%E5%9C%A8%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>複数の願いが存在する場合</h2>

<p>そこは一点だけにしましょう。<br>
シェンロンだって１つの願いでやっとなのですから<br>
ポルンガになると自分が潰れますし、一つの願いを叶えることによって、その他の願いは自然に解消する事もあります。まずは一番叶えたい願いを叶える努力をしましょう。</p>

<h2>
<span id="困っている事をメンバー全員にヒアリングできたら" class="fragment"></span><a href="#%E5%9B%B0%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E4%BA%8B%E3%82%92%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BC%E5%85%A8%E5%93%A1%E3%81%AB%E3%83%92%E3%82%A2%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%A7%E3%81%8D%E3%81%9F%E3%82%89"><i class="fa fa-link"></i></a>困っている事をメンバー全員にヒアリングできたら</h2>

<p>メンバー達の困ってる事を見比べましょう。<br>
これは一点だけからの意見だけだと偏りが発生しますので、3人以上が似た意見を言っている場合はその困ってる事がボトルネックになってると仮定してその困ってる事を解消するように動きましょう。<br>
またメンバー達に提示したプロセスの修正が必要な場合はプロセスの修正を各メンバーに伝えましょう。</p>

<h2>
<span id="ここまでのプロセスが完了したら" class="fragment"></span><a href="#%E3%81%93%E3%81%93%E3%81%BE%E3%81%A7%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8C%E5%AE%8C%E4%BA%86%E3%81%97%E3%81%9F%E3%82%89"><i class="fa fa-link"></i></a>ここまでのプロセスが完了したら</h2>

<ul>
<li>叶えられそうな願いから順にタスクを消化しましょう。</li>
<li>メンバーの前にたち障壁となっているものがある場合は率先してその壁を壊す、どかす努力を行いましょう。(これはアジャイルサムライにも書いてあった）</li>
<li>エンジニアが集中してコードをかける環境を用意できるようにしましょう。</li>
<li>エンジニア以外のセクションとも積極的に話を聞きにいきましょう(アジャイルサムライのお隣さんが探せ)。</li>
</ul>

<h3>
<span id="これを少しの期間感覚値として２週間程度実行するだけで大分信頼関係が構築できています" class="fragment"></span><a href="#%E3%81%93%E3%82%8C%E3%82%92%E5%B0%91%E3%81%97%E3%81%AE%E6%9C%9F%E9%96%93%E6%84%9F%E8%A6%9A%E5%80%A4%E3%81%A8%E3%81%97%E3%81%A6%EF%BC%92%E9%80%B1%E9%96%93%E7%A8%8B%E5%BA%A6%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91%E3%81%A7%E5%A4%A7%E5%88%86%E4%BF%A1%E9%A0%BC%E9%96%A2%E4%BF%82%E3%81%8C%E6%A7%8B%E7%AF%89%E3%81%A7%E3%81%8D%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>これを少しの期間(感覚値として２週間程度)実行するだけで大分信頼関係が構築できています</h3>

<ul>
<li>信頼関係が構築できると手元に情報が集まってきます。</li>
<li>情報が集まれば更にマネジメントは行いやすくなります。</li>
<li>情報を上手く活用する事により炎上から鎮火までする経路を作成することができます。</li>
</ul>

<p>よって上で説明したロジックが構築できるようになります。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">onegai.rb</span></div>
<div class="highlight"><pre><span></span>
<span class="n">task</span>   <span class="o">=</span> <span class="s2">"タスク"</span>
<span class="n">you</span>    <span class="o">=</span> <span class="s2">"A"</span>
<span class="n">member</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"B"</span><span class="p">,</span><span class="s2">"C"</span><span class="p">,</span><span class="s2">"D"</span><span class="o">]</span>
<span class="n">task_do</span> <span class="o">=</span> <span class="kp">false</span>

<span class="k">def</span> <span class="err">お願い</span><span class="p">(</span><span class="n">you</span><span class="p">,</span> <span class="n">member</span> <span class="o">=</span> <span class="o">[]</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
  <span class="n">member</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">さん、この</span><span class="si">#{</span><span class="n">task</span><span class="si">}</span><span class="s2">ちょっとお願いしてもいいですか？」"</span>
    <span class="n">say</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">you</span><span class="si">}</span><span class="s2">さんが言うなら。。。。いいですよ"</span>

    <span class="k">return</span> <span class="kp">true</span> <span class="k">if</span> <span class="sr">/いいですよ/</span> <span class="o">=~</span> <span class="n">say</span>  
    <span class="k">return</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">task_do</span> <span class="o">=</span> <span class="kp">true</span> <span class="k">if</span> <span class="err">お願い</span><span class="p">(</span><span class="n">you</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
</pre></div>
</div>

<p>大分コードもスッキリしてきましたね。</p>

<h2>
<span id="集約された情報を元に決断者に現実と未来プロセスをエスコートする" class="fragment"></span><a href="#%E9%9B%86%E7%B4%84%E3%81%95%E3%82%8C%E3%81%9F%E6%83%85%E5%A0%B1%E3%82%92%E5%85%83%E3%81%AB%E6%B1%BA%E6%96%AD%E8%80%85%E3%81%AB%E7%8F%BE%E5%AE%9F%E3%81%A8%E6%9C%AA%E6%9D%A5%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E3%82%A8%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>集約された情報を元に決断者に現実と未来プロセスをエスコートする</h2>

<p>決断者とはプロジェクトの進退を決めれる人に現実をまとめて報告しましょう。<br>
ここでポイントは現状の問題点を報告してそれが、色々な事が絡んでこうなっている現実を素直に報告することです。<br>
炎上している時は物理的な現実と理想な現実とはかけ離れている状態ですので</p>

<ul>
<li>炎上している現実を知ってもらう事(気付いていない場合もあるので)

<ul>
<li>情報を元になぜ炎上したかのタイムラインを作成する = 説明責任を果たす</li>
</ul>
</li>
<li>炎上鎮火プロセスを提案する

<ul>
<li>集約された情報に大体答えがあるので情報をよく見る = ボトルネックの抽出</li>
</ul>
</li>
<li>次回は同じ過ちを繰り返さないように次回のプロセスを提案する

<ul>
<li>提案内容はメンバーの願いを叶えるような内容にしてプロジェクトが円滑に進めるようにする = 未来プロセスのエスコート</li>
</ul>
</li>
</ul>

<p>上記を実行します。</p>

<p>上記を実行して決断者が渋った場合は更に決断者に困っている事をヒアリングを行い、メンバーの困りごとと決断者の困り事の間で</p>

<h4>
<span id="願いの落としどころ" class="fragment"></span><a href="#%E9%A1%98%E3%81%84%E3%81%AE%E8%90%BD%E3%81%A8%E3%81%97%E3%81%A9%E3%81%93%E3%82%8D"><i class="fa fa-link"></i></a>願いの落としどころ</h4>

<p>を計ります。</p>

<h2>
<span id="すぐに鎮火できていないじゃん" class="fragment"></span><a href="#%E3%81%99%E3%81%90%E3%81%AB%E9%8E%AE%E7%81%AB%E3%81%A7%E3%81%8D%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%81%98%E3%82%83%E3%82%93"><i class="fa fa-link"></i></a>すぐに鎮火できていないじゃん！！</h2>

<p>燃えた火は大体の場合はすぐに鎮火できませんので火を消す事に目をむけるのではなく更に火が出ないようにします。<br>
火の延焼を防ぐように障害を破壊消防しましょう。</p>

<h2>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h2>

<p>やっている人はやっているし、別の手法で実践して成功している方も沢山いらっしゃります。<br>
ただマネジメントってプログラムと違い、こうやれば、こうできる！！って答えがない無形な形なものです。<br>
参考程度に見てもらえればと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />31位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/dcc73c39b8174eb389b5">railsでめげたruby初心者によるpadrinoメモ　[チュートリアル写経編]</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-15 13:54:30</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Padrino]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="rubyで勉強にフレームワークを探していた" class="fragment"></span><a href="#ruby%E3%81%A7%E5%8B%89%E5%BC%B7%E3%81%AB%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%92%E6%8E%A2%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F"><i class="fa fa-link"></i></a>rubyで勉強にフレームワークを探していた</h2>

<p>rubyを勉強するのにあたり一番始めは<br>
「やっぱrailsか」と思ったのですがドキュメントたくさんありすぎてめげそうになったし<br>
最近は<a href="http://ledsun.hatenablog.com/entry/2013/07/24/112644" rel="nofollow noopener" target="_blank">Ruby on Rails を勉強しない方が良い100の理由</a>とかもみたのでじゃあrubyでフレームワークどれがいいのよと思ったのですが<br>
一番始めは<br>
<a href="http://www.sinatrarb.com/intro-jp.html" rel="nofollow noopener" target="_blank">sinatra</a>で勉強してたのですがあまりにもシンプルすぎてもう少し大規模向けなフレームワークがいいなぁと思っていた</p>

<h3>
<span id="自分がやりたいこと" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E3%81%8C%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>自分がやりたいこと</h3>

<ul>
<li>API系いっぱい使いたいし</li>
<li>ある程度大規模なものも考慮したサイト構築したいし</li>
<li>ディレクトリ構成とか考えるのがダルいし</li>
</ul>

<p>と思っていたらsinatraベースのフレームワーク<a href="http://jp.padrinorb.com/" rel="nofollow noopener" target="_blank">padrino</a>を見つけたのでメモ</p>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li>
<a href="http://jp.padrinorb.com/" rel="nofollow noopener" target="_blank">padrino　日本語サイト</a>　padrinoの公式翻訳サイト</li>
<li>
<a href="http://qiita.com/kakkunpakkun/items/488f2d427fc77ba61470" id="reference-d26e3256ac18ccc5f012">Padrinoをオススメする6つの理由</a> padrinoとは何か？的な解説です。</li>
</ul>

<h2>
<span id="事前準備" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>事前準備</h2>

<ul>
<li>ruby (バージョンは特に明記されていませんが 1.9*くらいからだと思われる) </li>
<li>gem</li>
</ul>

<h2>
<span id="padrinoを選んだ理由その１-generateコマンドがある" class="fragment"></span><a href="#padrino%E3%82%92%E9%81%B8%E3%82%93%E3%81%A0%E7%90%86%E7%94%B1%E3%81%9D%E3%81%AE%EF%BC%91-generate%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%8C%E3%81%82%E3%82%8B"><i class="fa fa-link"></i></a>[padrinoを選んだ理由その１] generateコマンドがある</h2>

<p>generateコマンドとかでとにかく楽したかった</p>

<h2>
<span id="padrinoを選んだ理由その2-activerecordが使える" class="fragment"></span><a href="#padrino%E3%82%92%E9%81%B8%E3%82%93%E3%81%A0%E7%90%86%E7%94%B1%E3%81%9D%E3%81%AE2-activerecord%E3%81%8C%E4%BD%BF%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>[padrinoを選んだ理由その2] activerecordが使える</h2>

<p>activerecord信者ではないですがこれもgenerateコマンドのオプションで使えるから楽できる</p>

<h2>
<span id="padrinoを選んだ理由その3-ドキュメントがシンプル" class="fragment"></span><a href="#padrino%E3%82%92%E9%81%B8%E3%82%93%E3%81%A0%E7%90%86%E7%94%B1%E3%81%9D%E3%81%AE3-%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%8C%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB"><i class="fa fa-link"></i></a>[padrinoを選んだ理由その3] ドキュメントがシンプル</h2>

<p>これがデカい </p>

<h2>
<span id="padrinoのチュートリアル" class="fragment"></span><a href="#padrino%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB"><i class="fa fa-link"></i></a>padrinoのチュートリアル</h2>

<p>本家をそのまま写経しただけ<br>
<a href="http://jp.padrinorb.com/guides/blog-tutorial" rel="nofollow noopener" target="_blank">Blog Tutorial</a></p>

<h2>
<span id="インストール方法" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>インストール方法</h2>

<p>gemコマンドで</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>gem install padrino
</pre></div></div>

<p>bundler経由なら</p>

<div class="code-frame" data-lang="Gemfile"><div class="highlight"><pre><span></span>gem 'padrino'
</pre></div></div>

<p>これで完了</p>

<h2>
<span id="blog-tutorialを写経してみる" class="fragment"></span><a href="#blog-tutorial%E3%82%92%E5%86%99%E7%B5%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>Blog Tutorialを写経してみる</h2>

<p>まずはプロジェクト自体を作成する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>padrino g project プロジェクト名 -t rspec -e haml -c sass -s jquery -d activerecord -b
</pre></div></div>

<h4>
<span id="オプションの説明" class="fragment"></span><a href="#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>オプションの説明</h4>

<ul>
<li>-t テストモジュールの指定 公式はshouldaでやっているがここは歴史あるrspecでも可能</li>
<li>-e テンプレートエンジンの指定色々指定できるらしい</li>
<li>-c sassオプション？？？</li>
<li>-s javascriptライブラリの選択</li>
<li>-d dataストアのライブラリの選択 activerecordを選択している</li>
</ul>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd プロジェクト名
</pre></div></div>

<h2>
<span id="管理画面を作成する" class="fragment"></span><a href="#%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>管理画面を作成する</h2>

<p>generatorを使用して作成する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>padrino g admin
bundle install
</pre></div></div>

<h2>
<span id="db回りを設定する" class="fragment"></span><a href="#db%E5%9B%9E%E3%82%8A%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>DB回りを設定する</h2>

<p>デフォルトはsql-liteで設定されてるっぽい</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>padrino rake ar:create
padrino rake ar:migrate
padrino rake seed
</pre></div></div>

<p>seedコマンド打つと管理画面のユーザーアドレスとパスワード聞かれるので各自適当に打つ</p>

<h2>
<span id="webサーバーを起動" class="fragment"></span><a href="#web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>WEBサーバーを起動</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>padrino start
</pre></div></div>

<h2>
<span id="確認" class="fragment"></span><a href="#%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>確認</h2>

<p>ブラウザでlocalhost:3000にアクセスしましょう</p>

<p>padrinoはシンプルで良さげかもと思うruby初心者です</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />32位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/504a300709a6eba8a9dd">FuelPHP【パッケージ】-- minifyもcompressも簡単にできるパケージ fuelphp-casset --</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-05 02:26:07</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[FuelPHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>minify,compressやりたいならこのパッケージを導入すれば簡単にできます。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3</li>
<li>fuelPHP1.5.3</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
<li>git</li>
<li>fuelPHPがインストール済みであること インストールをしていない場合は<a href="http://qiita.com/items/ae107a96699745a02560">FuelPHP【入門】-- CRUDを作った時のメモ(インストールからCRUD作成まで) --</a>を参考にインストールしてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://fuelphp.jp/docs/1.5/" rel="nofollow noopener" target="_blank">日本語版ドキュメント(1.5ドキュメント)</a></li>
<li><a href="https://github.com/canton7/fuelphp-casset" rel="nofollow noopener" target="_blank">canton7 / fuelphp-casset</a></li>
</ul>

<h2>
<span id="oilでpackageを導入する" class="fragment"></span><a href="#oil%E3%81%A7package%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>oilでpackageを導入する</h2>

<p>コマンドで一発</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil package install casset
</pre></div></div>

<p>fuel/packages/fuel-cassetというディレクトリができます。</p>

<h2>
<span id="packageのロード" class="fragment"></span><a href="#package%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>packageのロード</h2>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/config/config.php</span></div>
<div class="highlight"><pre><span></span>    <span class="s1">'always_load'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'packages'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'fuel-casset'</span><span class="p">,</span>
        <span class="p">),</span>
</pre></div>
</div>

<p>※注意点：なぜか自分の環境(1.5.3)だとfuel/packages/fuel-cassetという名前だとクラスをうまく読み込んでくれませんでした。<br>
その時はfuel/packages/cassetにリネームしてください。</p>

<h2>
<span id="publicassetにcacheというディレクトリを作成する" class="fragment"></span><a href="#publicasset%E3%81%ABcache%E3%81%A8%E3%81%84%E3%81%86%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>public/assetにcacheというディレクトリを作成する</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir public/assets/cache
chmod 777 public/assets/cache
</pre></div></div>

<h2>
<span id="使い方js" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9js"><i class="fa fa-link"></i></a>使い方(js)</h2>

<p>minify,compress対象の指定</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Casset::js('jquery.js'); //jquery.jsをminify,compress対象にします。
Casset::js('bootstrap-transition.js'); //minify, compress対象にします
Casset::render_js(); //jquery.js bootstrap-transition.jsを一つにしてcompressします
//public/assets/cacheに２つをまとめたファイルが出来上がります
</pre></div></div>

<h2>
<span id="使い方css" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9css"><i class="fa fa-link"></i></a>使い方(css)</h2>

<p>minify,compress対象の指定</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Casset::css('common.css'); //jquery.jsをminify,compress対象にします。
Casset::css('bootstrap.js'); //minify, compress対象にします
Casset::render_css(); //common.css bootstrap.cssを一つにしてcompressします
//public/assets/cacheに２つをまとめたファイルが出来上がります
</pre></div></div>

<p>そのほかにもグループ化とか細かい設定もできるみたいです。<br>
詳しくは<a href="https://github.com/canton7/fuelphp-casset" rel="nofollow noopener" target="_blank">github</a>をさんこうにしてください。</p>

<p>超カンタンにできます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />33位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/4b079f89990a13baa712">今日作りたくなる簡単cookbook [Kim&apos;sキッチン] timezone</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-30 21:54:57</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[chef]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下全ても●みち風に書いたメモ</p>

<p>皆さんおはようございます。<br>
<a href="http://qiita.com/users/ryurock@github">ryurock@github</a>です。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">フガすけ(14歳)</span></div>
<div class="highlight"><pre><span></span>timezoneの設定変えたいっす
</pre></div>
</div>

<p>今日はそんなtimezoneを変更する簡単なcookbookをknife-soloでご紹介したいと思います。</p>

<h2>
<span id="レシピ作成時間" class="fragment"></span><a href="#%E3%83%AC%E3%82%B7%E3%83%94%E4%BD%9C%E6%88%90%E6%99%82%E9%96%93"><i class="fa fa-link"></i></a>レシピ作成時間</h2>

<p>約2分</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>mac-osx（ホストOS）</li>
<li>centos6.4-x86-minimal (ゲストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>virtualbox</li>
<li>ruby 1.9.3p327 (rbenv) ※1.9.3-p286でもいけた</li>
<li>chef ※入れていない方は<code>gem install chef</code>とshellから打ってください</li>
<li>vagrant ※入れていない方は<a href="http://qiita.com/items/3cb756a9c951371a4089">chef-soloで使用するvirtualbox(vagrant)をveeweeを使用して作る</a>を参考に入れておいてください</li>
<li>git</li>
<li>knife-soloのセットアップ ※やっていない方は<a href="http://qiita.com/items/c99215e25bd2ff846207">今日作りたくなる簡単cookbook [Kim'sキッチン] yumsetup(yum-fastestmirrorにyum update添え)</a>の前準備を参考にしてやっておいてください。</li>
</ul>

<h2>
<span id="参考にしたサイト書籍" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88%E6%9B%B8%E7%B1%8D"><i class="fa fa-link"></i></a>参考にしたサイト（書籍）</h2>

<ul>
<li>
<a href="http://tatsu-zine.com/books/chef-solo" rel="nofollow noopener" target="_blank">入門ChefSolo-InfrastructureasCode-1.0.0</a>(達人出版)</li>
<li><a href="http://qiita.com/items/8e973a544b592376a07e">rbenvを使ってシステムワイドにrubyをインストールする方法</a></li>
</ul>

<h2>
<span id="その１-レシピ名を決める" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%91-%E3%83%AC%E3%82%B7%E3%83%94%E5%90%8D%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>[その１] レシピ名を決める</h2>

<p>今回のレシピ名はtimezoneで行きましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife cookbook create timezone -o site-cookbooks
</pre></div></div>

<h2>
<span id="その2-chef-repotimezonerecipesdefaultrbを編集" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE2-chef-repotimezonerecipesdefaultrb%E3%82%92%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>[その2] chef-repo/timezone/recipes/default.rbを編集</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/timezone/recipes/default.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">"/etc/sysconfig/clock"</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s2">"execute[timezone_update]"</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s2">"timezone_update"</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">"cp /usr/share/zoneinfo/Japan /etc/localtime"</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="その3-timeozoneの設定をtemplateに書く" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE3-timeozone%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92template%E3%81%AB%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>[その3] timeozoneの設定をtemplateに書く</h2>

<p>シンプルです。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/timezone/templates/default/clock.erb</span></div>
<div class="highlight"><pre><span></span><span class="no">ZONE</span><span class="o">=</span><span class="s2">"Asia/Tokyo"</span>
</pre></div>
</div>

<p>やっていることは</p>

<ul>
<li>timezoneの設定をコピー</li>
<li>/etc/sysconfig/clockを日本時間に変更</li>
</ul>

<p>です。</p>

<p><a href="http://docs.opscode.com/resource.html" rel="nofollow noopener" target="_blank">Chef Resources</a>を使用した</p>

<ul>
<li><a href="http://docs.opscode.com/resource_execute.html" rel="nofollow noopener" target="_blank">execute</a></li>
<li><a href="http://docs.opscode.com/resource_template.html" rel="nofollow noopener" target="_blank">template</a></li>
</ul>

<p>で実行します。</p>

<h2>
<span id="その4rbenv-cookbookをリモート側で実行する設定を追加" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE4rbenv-cookbook%E3%82%92%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E8%A8%AD%E5%AE%9A%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>[その4]rbenv cookbookをリモート側で実行する設定を追加</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim chef-repo/nodes/{接続名称（任意）}.json

{"run_list":[
        "timezone"
]}
</pre></div></div>

<p>run_listをすでに記載している場合は追記でお願いします。<br>
またrbenvのインストールのみで問題ないならrbenvだけでも問題ないです。</p>

<h2>
<span id="その5-リモート側に実行依頼をする" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE5-%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%AB%E5%AE%9F%E8%A1%8C%E4%BE%9D%E9%A0%BC%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>[その5] リモート側に実行依頼をする</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife solo cook {接続名称（任意）}

</pre></div></div>

<h2>
<span id="今日はこれで決まりtimezoneの完成です" class="fragment"></span><a href="#%E4%BB%8A%E6%97%A5%E3%81%AF%E3%81%93%E3%82%8C%E3%81%A7%E6%B1%BA%E3%81%BE%E3%82%8Atimezone%E3%81%AE%E5%AE%8C%E6%88%90%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>今日はこれで決まり「timezone」の完成です</h2>

<p>簡単にtimezoneの設定が変更できますね。<br>
厳密にやりたい場合はattibuteなどもつかってみてください。</p>

<p>使った<a href="http://docs.opscode.com/resource.html" rel="nofollow noopener" target="_blank">Chef Resources</a></p>

<hr>

<ul>
<li><a href="http://docs.opscode.com/resource_template.html" rel="nofollow noopener" target="_blank">template</a></li>
<li><a href="http://docs.opscode.com/resource_execute.html" rel="nofollow noopener" target="_blank">execute</a></li>
</ul>

<p>ソースをgithubに置いてあります。<br>
<a href="https://github.com/ryurock/chef-timezone" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ryurock/chef-timezone</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />34位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/5e57486606b56b61b52f">今日作りたくなる簡単cookbook [Kim&apos;sキッチン] devtools(yum groupinstall )</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-15 01:40:57</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[chef]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下全ても●みち風に書いたメモ</p>

<p>皆さんおはようございます。<br>
<a href="http://qiita.com/users/ryurock@github">ryurock@github</a>です。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">フガポン(24歳)</span></div>
<div class="highlight"><pre><span></span>
opscode http://docs.opscode.com/resource_yum.html
のyum_packageの項目にgroupinsallが書いてありませんでした。
どうやったらgroupinstallできますか？

</pre></div>
</div>

<h1>
<span id="俺が知りたい" class="fragment"></span><a href="#%E4%BF%BA%E3%81%8C%E7%9F%A5%E3%82%8A%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a><strong>俺が知りたい</strong>
</h1>

<h2>
<span id="レシピ作成時間" class="fragment"></span><a href="#%E3%83%AC%E3%82%B7%E3%83%94%E4%BD%9C%E6%88%90%E6%99%82%E9%96%93"><i class="fa fa-link"></i></a>レシピ作成時間</h2>

<p>約3分</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>mac-osx（ホストOS）</li>
<li>centos6.4-x86-minimal (ゲストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>virtualbox</li>
<li>ruby 1.9.3p327 (rbenv) ※1.9.3-p286でもいけた</li>
<li>chef ※入れていない方は<code>gem install chef</code>とshellから打ってください</li>
<li>vagrant ※入れていない方は<a href="http://qiita.com/items/3cb756a9c951371a4089">chef-soloで使用するvirtualbox(vagrant)をveeweeを使用して作る</a>を参考に入れておいてください</li>
<li>git</li>
<li>knife-soloのセットアップ ※やっていない方は<a href="http://qiita.com/items/c99215e25bd2ff846207">今日作りたくなる簡単cookbook [Kim'sキッチン] yumsetup(yum-fastestmirrorにyum update添え)</a>の前準備を参考にしてやっておいてください。</li>
</ul>

<h2>
<span id="参考にしたサイト書籍" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88%E6%9B%B8%E7%B1%8D"><i class="fa fa-link"></i></a>参考にしたサイト（書籍）</h2>

<ul>
<li>
<a href="http://tatsu-zine.com/books/chef-solo" rel="nofollow noopener" target="_blank">入門ChefSolo-InfrastructureasCode-1.0.0</a>(達人出版)</li>
<li><a href="http://docs.opscode.com/resource_yum.html" rel="nofollow noopener" target="_blank">yum_package</a></li>
</ul>

<h2>
<span id="その１-レシピ名を決める" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%91-%E3%83%AC%E3%82%B7%E3%83%94%E5%90%8D%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>[その１] レシピ名を決める</h2>

<p>今回のレシピ名はdevtoolsで行きましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife cookbook create devtools -o site-cookbooks
</pre></div></div>

<h2>
<span id="その2-chef-repodevtoolsrecipesdefaultrbを編集" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE2-chef-repodevtoolsrecipesdefaultrb%E3%82%92%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>[その2] chef-repo/devtools/recipes/default.rbを編集</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/yumsetup/recipes/default.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s2">"devtools"</span> <span class="k">do</span>
  <span class="n">user</span> <span class="s2">"root"</span>
  <span class="n">command</span> <span class="s1">'yum -y groupinstall "Development Tools"'</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>

<p>ruby知らなくてもわかる内容ですね。</p>

<p><a href="http://docs.opscode.com/resource.html" rel="nofollow noopener" target="_blank">Chef Resources</a>を使用した</p>

<ul>
<li><a href="http://docs.opscode.com/resource_execute.html" rel="nofollow noopener" target="_blank">execute</a></li>
</ul>

<p>で実行します。</p>

<h2>
<span id="その3yumsetup-cookbookをリモート側で実行する設定を追加" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE3yumsetup-cookbook%E3%82%92%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E8%A8%AD%E5%AE%9A%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>[その3]yumsetup cookbookをリモート側で実行する設定を追加</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim chef-repo/nodes/{接続名称（任意）}.json

{"run_list":[
    "devtools"
]}
</pre></div></div>

<p>run_listをすでに記載している場合は追記でお願いします。</p>

<h2>
<span id="その4-リモート側に実行依頼をする" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE4-%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%AB%E5%AE%9F%E8%A1%8C%E4%BE%9D%E9%A0%BC%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>[その4] リモート側に実行依頼をする</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife solo cook {接続名称（任意）}


Starting Chef Client, version 11.4.0
Compiling Cookbooks...
Converging 3 resources
Recipe: devtools::default
  * execute[devtools] action run
    - execute yum -y groupinstall "Development Tools"
</pre></div></div>

<h2>
<span id="今日はこれで決まりdevtoolsの完成です" class="fragment"></span><a href="#%E4%BB%8A%E6%97%A5%E3%81%AF%E3%81%93%E3%82%8C%E3%81%A7%E6%B1%BA%E3%81%BE%E3%82%8Adevtools%E3%81%AE%E5%AE%8C%E6%88%90%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>今日はこれで決まり「devtools」の完成です</h2>

<p>ちなみにcommand以外でも</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/devtools/recipes/default.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s2">"devtools"</span> <span class="k">do</span>
  <span class="n">user</span> <span class="s2">"root"</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="dl">EOH</span>
<span class="sh">  yum -y groupinstall "Development Tools"</span>
<span class="dl">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>

<p>でも行けます。けどきっと<a href="http://docs.opscode.com/resource_script.html" rel="nofollow noopener" target="_blank">resource -script-</a>はもう少し複雑な処理（分岐とか、インストール以外）の場合に用いるものだと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />35位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/3cc76947b35fa3ba7345">FuelPHP -- 1.5系でcomporserを導入する --</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-20 15:55:04</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[FuelPHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>FuelPHP1.6からはcomposerが導入されるらしいですがまだdev版なので1.5系でcomposerを使用する為の方法を記載していきます</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3</li>
<li>fuelPHP1.5.3</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
<li>mysql</li>
<li>php[composer] 導入していない場合は<a href="http://qiita.com/items/43beef25d26966fff8cc">composerを使ってみた時のメモ</a>を参考に導入してください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://fuelphp.jp/docs/1.5/" rel="nofollow noopener" target="_blank">日本語版ドキュメント(1.5ドキュメント)</a></li>
<li><a href="http://tomschlick.com/2012/11/01/composer-with-fuelphp/" rel="nofollow noopener" target="_blank">Using Composer with FuelPHP 1.x</a></li>
</ul>

<h2>
<span id="composerでいれるもの" class="fragment"></span><a href="#composer%E3%81%A7%E3%81%84%E3%82%8C%E3%82%8B%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>composerでいれるもの</h2>

<p>ユニットテストを書くのでPHPUnit系のものを入れたいとおもいます。<br>
今回入れるものは下記を入れます。</p>

<ul>
<li>phpunit/phpunit</li>
<li>mockery/mockery</li>
<li>phpunit/dbunit</li>
<li>phpunit/phpunit-selenium</li>
<li>phpunit/phpunit-story</li>
<li>phing/phing</li>
<li>pdepend/pdepend</li>
<li>phpmd/phpmd</li>
<li>squizlabs/php_codesniffer</li>
<li>behat/behat</li>
</ul>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd fuelPHPのカレントディレクトリ
vim composer.json
</pre></div></div>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">composer.json</span></div>
<div class="highlight"><pre><span></span>{
    "require": {
        "phpunit/phpunit": "3.7.*",
        "mockery/mockery": "0.7.*",
        "phpunit/dbunit": "&gt;=1.2",
        "phpunit/phpunit-selenium": "&gt;=1.2",
        "phpunit/phpunit-story": "*",
        "phing/phing": "dev-master",
        "pdepend/pdepend": "dev-master",
        "phpmd/phpmd": "dev-master",
        "squizlabs/php_codesniffer": "dev-master",
        "behat/behat": "2.4.*@dev"
    },
    "config": {
        "bin-dir": "FuelPHPのカレントディレクトリのフルパス/fuel/app/vendor/bin",
        "vendor-dir": "FuelPHPのカレントディレクトリのフルパス/fuel/app/vendor"
    }
}
</pre></div>
</div>

<h2>
<span id="install" class="fragment"></span><a href="#install"><i class="fa fa-link"></i></a>install</h2>

<p>コマンド一発</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd fuelPHPのカレントディレクトリ
composer update

Loading composer repositories with package information
Updating dependencies (including require-dev)
  - Installing mockery/mockery (0.7.2)
    Loading from cache

  - Installing symfony/yaml (v2.2.0)
    Loading from cache

  - Installing phpunit/php-text-template (1.1.4)
    Loading from cache
    .
    .
    .
    .

mockery/mockery suggests installing Hamcrest (1.0.0)
phpunit/phpunit suggests installing phpunit/php-invoker (&gt;=1.1.0,&lt;1.2.0)
symfony/event-dispatcher suggests installing symfony/http-kernel (2.2.*)
behat/behat suggests installing behat/symfony2-extension (for integration with Symfony2 web framework)
behat/behat suggests installing behat/yii-extension (for integration with Yii web framework)
behat/behat suggests installing behat/mink-extension (for integration with Mink testing framework)
Writing lock file
Generating autoload files
</pre></div></div>

<h3>
<span id="確認" class="fragment"></span><a href="#%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>確認</h3>

<p>fuel/app/vendor/以下に入れたいパッケージがあればOK</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ll fuel/app/vendor/
合計 4
-rw-r--r-- 1 root root 182  3月 20 14:55 2013 autoload.php
drwxr-xr-x 1 root root 136  3月 20 14:54 2013 behat
drwxr-xr-x 1 root root 306  3月 20 14:55 2013 bin
drwxr-xr-x 1 root root 272  3月 20 14:55 2013 composer
drwxr-xr-x 1 root root 102  3月 20 14:53 2013 mockery
drwxr-xr-x 1 root root 102  3月 20 14:53 2013 pdepend
drwxr-xr-x 1 root root 102  3月 20 14:53 2013 phing
drwxr-xr-x 1 root root 102  3月 20 14:54 2013 phpmd
drwxr-xr-x 1 root root 408  3月 20 14:54 2013 phpunit
drwxr-xr-x 1 root root 102  3月 20 14:54 2013 squizlabs
drwxr-xr-x 1 root root 306  3月 20 14:54 2013 symfony
</pre></div></div>

<h2>
<span id="phpunitの設定をconfigでオーバーライドする" class="fragment"></span><a href="#phpunit%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92config%E3%81%A7%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>PHPUnitの設定をconfigでオーバーライドする</h2>

<p>このままではFuelPHPのテストをかくことができません。なぜならばFuelPHPのPHPUnitはデフォルトでフルパスで指定しないでphpunitコマンドで実行しようとするからです。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">/fuel/packages/oil/config/oil.php</span></div>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'phpunit'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>     
        <span class="s1">'autoload_path'</span> <span class="o">=&gt;</span> <span class="s1">'PHPUnit/Autoload.php'</span> <span class="p">,</span>
        <span class="s1">'binary_path'</span> <span class="o">=&gt;</span> <span class="s1">'phpunit'</span> <span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>
</pre></div>
</div>

<p>このpackageの設定ファイルをfuel/app/configにコピーして設定を変更しましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cp fuel/packages/oil/config/oil.php fuel/app/config/
</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/config/oil.php</span></div>
<div class="highlight"><pre><span></span><span class="c1">#編集前</span>
        <span class="s1">'autoload_path'</span> <span class="o">=&gt;</span> <span class="s1">'PHPUnit/Autoload.php'</span> <span class="p">,</span>
        <span class="s1">'binary_path'</span> <span class="o">=&gt;</span> <span class="s1">'phpunit'</span> <span class="p">,</span>
<span class="c1">#編集後</span>
        <span class="s1">'autoload_path'</span> <span class="o">=&gt;</span> <span class="nb">dirname</span><span class="p">(</span><span class="nx">COREPATH</span><span class="p">)</span><span class="o">.</span><span class="s1">'/app/vendor/autoload.php'</span> <span class="p">,</span>
        <span class="s1">'binary_path'</span> <span class="o">=&gt;</span> <span class="nb">dirname</span><span class="p">(</span><span class="nx">COREPATH</span><span class="p">)</span><span class="o">.</span><span class="s1">'/app/vendor/bin/phpunit'</span> <span class="p">,</span>
</pre></div>
</div>

<h2>
<span id="fuel-oil-testコマンドが動くか確認してみる" class="fragment"></span><a href="#fuel-oil-test%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%8C%E5%8B%95%E3%81%8F%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>fuel oil testコマンドが動くか確認してみる</h2>

<p>確認しましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil test
Tests Running...This may take a few moments.
PHPUnit 3.7.18 by Sebastian Bergmann.

Configuration read from /home/web/lo.fuel.base.org/fuel/core/phpunit.xml

...............................................................  63 / 330 ( 19%)
............................................................... 126 / 330 ( 38%)
............................................................... 189 / 330 ( 57%)
............................................................... 252 / 330 ( 76%)
............................................................... 315 / 330 ( 95%)
...............

Time: 4 seconds, Memory: 21.75Mb

OK (330 tests, 350 assertions)
</pre></div></div>

<p>動きましたがこれだとfuel本体のテストを毎回していてウザいですね</p>

<h2>
<span id="phpunit拡張用にphpunitxmlもpacakageから持ってくる" class="fragment"></span><a href="#phpunit%E6%8B%A1%E5%BC%B5%E7%94%A8%E3%81%ABphpunitxml%E3%82%82pacakage%E3%81%8B%E3%82%89%E6%8C%81%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8B"><i class="fa fa-link"></i></a>phpunit拡張用にphpunit.xmlもpacakageから持ってくる</h2>

<p>普段の開発ではcoreとpackage(Fuelが提供しているもの)はテストの必要がないはずなので設定を変更しましょう。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cp fuel/core/phpunit.xml fuel/app/phpunit.xml
</pre></div></div>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">fuel/app/phpunit.xml</span></div>
<div class="highlight"><pre><span></span>#修正前
        <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">"core"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;directory</span> <span class="na">suffix=</span><span class="s">".php"</span><span class="nt">&gt;</span>../core/tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/testsuite&gt;</span>
#修正後
        <span class="c">&lt;!--        &lt;testsuite name="core"&gt;</span>
<span class="c">            &lt;directory suffix=".php"&gt;../core/tests&lt;/directory&gt;</span>
<span class="c">        &lt;/testsuite&gt; --&gt;</span>
</pre></div>
</div>

<h2>
<span id="再度確認" class="fragment"></span><a href="#%E5%86%8D%E5%BA%A6%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>再度確認</h2>

<p>もう一回確認してfuel/app/phpunit.xmlに設定が向いているか確認しましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil test

Tests Running...This may take a few moments.
PHPUnit 3.7.18 by Sebastian Bergmann.

Configuration read from /home/web/lo.fuel.base.org/fuel/app/phpunit.xml



Time: 0 seconds, Memory: 3.50Mb

No tests executed!
</pre></div></div>

<p>fuel/app/phpunit.xmlの設定が反映されましたね。</p>

<h2>
<span id="phpunit以外のcomposerも動作させるためには" class="fragment"></span><a href="#phpunit%E4%BB%A5%E5%A4%96%E3%81%AEcomposer%E3%82%82%E5%8B%95%E4%BD%9C%E3%81%95%E3%81%9B%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E3%81%AF"><i class="fa fa-link"></i></a>PHPUnit以外のcomposerも動作させるためには</h2>

<p>上記はこれはあくまでPHPUnitの設定だけで他のcomporserのパッケージはこれでは動きませんので<br>
bootstrap.phpにcomposerのautoload.phpをreqiureしてあげましょう。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/bootstrap.php</span></div>
<div class="highlight"><pre><span></span><span class="c1">// Register the autoloader</span>
<span class="nx">Autoloader</span><span class="o">::</span><span class="na">register</span><span class="p">();</span>

<span class="c1">#追加</span>
<span class="c1">// Composer</span>
<span class="k">require</span> <span class="nx">APPPATH</span><span class="o">.</span><span class="s1">'/vendor/autoload.php'</span><span class="p">;</span>
</pre></div>
</div>

<p>ポイントは<a href="http://tomschlick.com/2012/11/01/composer-with-fuelphp/" rel="nofollow noopener" target="_blank">Using Composer with FuelPHP 1.x</a>でも記載されている通りにAutoloader::register();の後にcomposerのautoload.phpをrequireすることみたいです。（理由までは調べてませんが）</p>

<p>これでvendorパッケージ管理が容易になるかと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />36位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/4807f09d020ca9b828d2">FuelPHP ルーティングで管理画面とアプリの共存</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-19 02:22:13</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[FuelPHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>運用方法によって賛否両論ですが、アプリの設定ファイルを管理画面でも参照したい場合にアプリと管理画面を同一のリポジトリに同居させたい場合があるのでそういう場合の設定をルーティングとenvの切り替えで実現するためのメモ</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3</li>
<li>fuelPHP1.5.3</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
<li>mysql</li>
<li>fuelPHPがインストール済みであること　していない場合は<a href="http://qiita.com/items/ae107a96699745a02560">CRUDを作った時のメモ(インストールからCRUD作成まで)</a>を参考に作成してください</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://fuelphp.jp/docs/1.5/" rel="nofollow noopener" target="_blank">日本語版ドキュメント(1.5ドキュメント)</a></li>
</ul>

<h2>
<span id="bootstrapphpに環境変数にadmin_developmentを追加する" class="fragment"></span><a href="#bootstrapphp%E3%81%AB%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%ABadmin_development%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>bootstrap.phpに環境変数にadmin_developmentを追加する</h2>

<p>fuelPHPのデフォルトの環境変数はdevelopment,test,staging,productionの４つですがそれ以外に追加しても（今回の例ではadmin_development,admin_production）configなどは環境変数名でオーバーライドしてくれます。<br>
環境変数をbootstrap.phpに定義してみます</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/bootstrap.php</span></div>
<div class="highlight"><pre><span></span><span class="nx">Fuel</span><span class="o">::</span><span class="nv">$env</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'FUEL_ENV'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'FUEL_ENV'</span><span class="p">]</span> <span class="o">:</span><span class="s1">'admin_development'</span><span class="p">);</span>
</pre></div>
</div>

<h2>
<span id="設定ファイルfuelappconfigadmin_developmentdbphpの作成" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%ABfuelappconfigadmin_developmentdbphp%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>設定ファイル(fuel/app/config/admin_development/db.php)の作成</h2>

<p>今回はサンプルでCRUD環境を作成するのでfuel/app/config/admin_development/db.phpを作成します。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/bootstrap.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'default'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'mysqli'</span><span class="p">,</span>
        <span class="s1">'connection'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'hostname'</span> <span class="o">=&gt;</span> <span class="s1">'ホスト名'</span><span class="p">,</span>
            <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="s1">'ポート名'</span><span class="p">,</span>
            <span class="s1">'database'</span> <span class="o">=&gt;</span> <span class="s1">'データベース名'</span><span class="p">,</span>
            <span class="s1">'username'</span>   <span class="o">=&gt;</span> <span class="s1">'ユーザ名'</span><span class="p">,</span>
            <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'パスワード'</span><span class="p">,</span>
            <span class="s1">'presistent'</span> <span class="o">=&gt;</span> <span class="k">false</span>
        <span class="p">),</span>
        <span class="s1">'enable_cache'</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="s1">'profiling'</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>

</pre></div>
</div>

<h2>
<span id="ルーティング設定ファイルの編集" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>ルーティング設定ファイルの編集</h2>

<p>ルーティングの設定でenvがadmin_development又はadmin_production以外の場合は例外を出力するように設定します</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/config/routes.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'_root_'</span>  <span class="o">=&gt;</span> <span class="s1">'welcome/index'</span><span class="p">,</span>  <span class="c1">// The default route</span>
    <span class="s1">'_404_'</span>   <span class="o">=&gt;</span> <span class="s1">'welcome/404'</span><span class="p">,</span>    <span class="c1">// The main 404 route</span>
    <span class="c1">//追加する</span>
    <span class="s1">'admin'</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">\Fuel</span><span class="o">::</span><span class="nv">$env</span> <span class="o">!=</span> <span class="s1">'admin_development'</span> <span class="o">||</span> <span class="nx">\Fuel</span><span class="o">::</span><span class="nv">$env</span> <span class="o">!=</span> <span class="s1">'admin_production'</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">HttpNotFoundException</span><span class="p">(</span><span class="s1">'not found'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">\Request</span><span class="o">::</span><span class="na">forge</span><span class="p">(</span><span class="s1">'admin/$1'</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">},</span>
<span class="p">);</span>
</pre></div>
</div>

<h2>
<span id="サンプルでcrud環境を作る" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%A7crud%E7%92%B0%E5%A2%83%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>サンプルでCRUD環境を作る</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil g scaffold admin name:string description:text
    Creating migration: /home/web/lo.fuel.master.org/fuel/app/migrations/003_create_admins.php
    Creating model: /home/web/lo.fuel.master.org/fuel/app/classes/model/admin.php
    Creating controller: /home/web/lo.fuel.master.org/fuel/app/classes/controller/admin.php
    Creating view: /home/web/lo.fuel.master.org/fuel/app/views/admin/index.php
    Creating view: /home/web/lo.fuel.master.org/fuel/app/views/admin/view.php
    Creating view: /home/web/lo.fuel.master.org/fuel/app/views/admin/create.php
    Creating view: /home/web/lo.fuel.master.org/fuel/app/views/admin/edit.php
    Creating view: /home/web/lo.fuel.master.org/fuel/app/views/admin/_form.php
</pre></div></div>

<h2>
<span id="マイグレーションmigrateの実行" class="fragment"></span><a href="#%E3%83%9E%E3%82%A4%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3migrate%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>マイグレーション(migrate)の実行</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil refine migrate
</pre></div></div>

<h2>
<span id="httplocalhostadminにアクセスする" class="fragment"></span><a href="#httplocalhostadmin%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><a href="http://localhost/admin%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B" class="autolink" rel="nofollow noopener" target="_blank">http://localhost/adminにアクセスする</a>
</h2>

<p>CRUD画面が表示されてcreate,read,update,delete画面が表示されてるはずです。</p>

<h2>
<span id="bootstrapphpの値をdevelopmentに戻してアクセスしてみる" class="fragment"></span><a href="#bootstrapphp%E3%81%AE%E5%80%A4%E3%82%92development%E3%81%AB%E6%88%BB%E3%81%97%E3%81%A6%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>bootstrap.phpの値をdevelopmentに戻してアクセスしてみる</h2>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/bootstrap.php</span></div>
<div class="highlight"><pre><span></span><span class="nx">Fuel</span><span class="o">::</span><span class="nv">$env</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'FUEL_ENV'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'FUEL_ENV'</span><span class="p">]</span> <span class="o">:</span> <span class="nx">Fuel</span><span class="o">::</span><span class="na">DEVELOPMENT</span><span class="p">);</span><span class="nx">↲</span>
</pre></div>
</div>

<p><a href="http://localhost/admin%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%99%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E7%94%BB%E9%9D%A2%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E3%81%AF%E3%81%9A%E3%81%A7%E3%81%99%E3%80%82" class="autolink" rel="nofollow noopener" target="_blank">http://localhost/adminにアクセスするとエラー画面に表示されるはずです。</a></p>

<p>実際の運用レベルですとfuel/app/bootstrap.phpにenvの記載をするのではなく<br>
apache又はnginx側でenvを設定すればソースをいじらずにアプリ側と管理画面側でリポジトリを共有できます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />37位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/1cb882b48b1a827a420d">virtualbox(centos)でrbenvインストールメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-26 03:02:00</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>環境 centos6.3（ゲストOS）macosx10.8(ホストOS)</p>

<p>chef使ってみたーい。という動機で触ったこともないrubyを入れてみようと思いました。<br>
何やら色々調べるとrubyはバージョンによって色々変わるらしいので<br>
最近流行りのrbenvで入れた時のメモ。</p>

<h2>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h2>

<ul>
<li>ここから先は全てroo(権限)ユーザーで実行しています</li>
<li>epel,remiのリポジトリが必要です。入れていない場合は<a href="http://qiita.com/items/662e41376efa97251575">外部リポジトリの追加（remi,epel）</a>を参考にして入れてみてください。</li>
<li>要git,gcc</li>
<li>開発環境構築の話です。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li>
<a href="http://d.hatena.ne.jp/katsuren/20121027/1351319825" rel="nofollow noopener" target="_blank">rbenv を CentOS 6.3 にインストール</a>※ほとんどこの記事みてやりました。</li>
<li><a href="http://tnakamura.hatenablog.com/entry/20120227/rbenv_ruby_build" rel="nofollow noopener" target="_blank">rbenv と ruby-build を使って Ruby の環境を構築してみた</a></li>
</ul>

<h2>
<span id="rbenvをgitからクローンする" class="fragment"></span><a href="#rbenv%E3%82%92git%E3%81%8B%E3%82%89%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%B3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>rbenvをgitからクローンする</h2>

<p>ズバッと</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd /usr/local/
git clone https://github.com/sstephenson/rbenv.git
</pre></div></div>

<h2>
<span id="rbenvのパーミッションの設定" class="fragment"></span><a href="#rbenv%E3%81%AE%E3%83%91%E3%83%BC%E3%83%9F%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>rbenvのパーミッションの設定</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chmod -R g+rwxXs /usr/local/rbenv/
</pre></div></div>

<h2>
<span id="ruby-buildプラグインをインストール" class="fragment"></span><a href="#ruby-build%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ruby-buildプラグインをインストール</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir /usr/local/rbenv/plugins
git clone https://github.com/sstephenson/ruby-build.git
</pre></div></div>

<h2>
<span id="rbenvのpathを通す" class="fragment"></span><a href="#rbenv%E3%81%AEpath%E3%82%92%E9%80%9A%E3%81%99"><i class="fa fa-link"></i></a>rbenvのPATHを通す</h2>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/profile.d/rbenv.sh</span></div>
<div class="highlight"><pre><span></span>vim /etc/profile.d/rbenv.sh

export RBENV_ROOT="/usr/local/rbenv"
export PATH="/usr/local/rbenv/bin:$PATH"
eval "$(rbenv init -)"
</pre></div>
</div>

<h2>
<span id="rubyのインストール" class="fragment"></span><a href="#ruby%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>rubyのインストール</h2>

<p>上記設定を反映させるために一旦再起動してください。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>which rbenv
/usr/local/rbenv/bin/rbenv
</pre></div></div>

<p>rbenvにPATHが通ったのでインストール</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>rbenv install 1.9.3-p286
</pre></div></div>

<p>結構長いです。辛抱しましょう。</p>

<h2>
<span id="rubyのデフォルトのバージョン設定" class="fragment"></span><a href="#ruby%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>rubyのデフォルトのバージョン設定</h2>

<p>コマンド一発</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>rbenv global 1.9.3-p286 
rbenv rehash
</pre></div></div>

<h2>
<span id="rubyのバージョン確認" class="fragment"></span><a href="#ruby%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>rubyのバージョン確認</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ruby -v
ruby 1.9.3p385 (2013-02-06 revision 39114) [x86_64-linux]
</pre></div></div>

<p>rubyのインストールができました。<br>
以外とインストールに面倒なイメージなrubyですが以外とシンプルに出来ました。<br>
本当に<a href="http://d.hatena.ne.jp/katsuren/20121027/1351319825" rel="nofollow noopener" target="_blank">rbenv を CentOS 6.3 にインストール</a>には助かりました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />38位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>12</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/7415260096bedd841826">sedでできる設定ファイル書き換えメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-09 11:29:50</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>よくフレームワークとかでDBの設定項目とか使ってる環境に変更することがある時にワザワザ手動で書き換える面倒なのでshellで自動置換できるようにした時のメモ</p>

<h2>
<span id="php編" class="fragment"></span><a href="#php%E7%B7%A8"><i class="fa fa-link"></i></a>php編</h2>

<h3>
<span id="配列の場合" class="fragment"></span><a href="#%E9%85%8D%E5%88%97%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>配列の場合</h3>

<p>例にこんな設定項目があったとする</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sample.php</span></div>
<div class="highlight"><pre><span></span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'connection'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'hostname'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
        <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="s1">'3306'</span><span class="p">,</span>
        <span class="s1">'database'</span> <span class="o">=&gt;</span> <span class="s1">'hoge'</span><span class="p">,</span>
        <span class="s1">'username'</span>   <span class="o">=&gt;</span> <span class="s1">'username'</span><span class="p">,</span>
        <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">),</span>
</pre></div>
</div>

<p>hostnameを書き換えたい場合はこんな感じでできる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>sed -i -e "s/'hostname' =&gt; \('.*'\)/'hostname' =&gt; 'hoge'/g" test.php 
</pre></div></div>

<p>localhostがhogeに変更できる</p>

<p>同様にport,database,username,passwordも変更してみよう(sedなら-eの連続で渡せる)</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>sed -i -e "s/'hostname' =&gt; \('.*'\)/'hostname' =&gt; 'hoge'/g" -e "s/'port' =&gt; \('.*'\)/'port' =&gt; '3312'/g" -e "s/'database' =&gt; \('.*'\)/'database' =&gt; 'myproject'/g" -e "s/'username' =&gt; \('.*'\)/'username' =&gt; 'myuser'/g" -e "s/'password' =&gt; \('.*'\)/'passward' =&gt; 'mypass'/g" sample.php 
</pre></div></div>

<p>書き換えたファイル</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sample.php</span></div>
<div class="highlight"><pre><span></span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'connection'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'hostname'</span> <span class="o">=&gt;</span> <span class="s1">'hoge'</span><span class="p">,</span>
        <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="s1">'3312'</span><span class="p">,</span>
        <span class="s1">'database'</span> <span class="o">=&gt;</span> <span class="s1">'myproject'</span><span class="p">,</span>
        <span class="s1">'username'</span>   <span class="o">=&gt;</span> <span class="s1">'username'</span><span class="p">,</span>
        <span class="s1">'passward'</span> <span class="o">=&gt;</span> <span class="s1">'mypass'</span><span class="p">,</span>
        <span class="s1">'presistent'</span> <span class="o">=&gt;</span> <span class="k">false</span>
    <span class="p">),</span>
<span class="p">),</span>
</pre></div>
</div>

<p>ダブルコーテションの場合もちょっと書き換えるだけでいける</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sample.php</span></div>
<div class="highlight"><pre><span></span>        <span class="s2">"connection"</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s2">"hostname"</span> <span class="o">=&gt;</span> <span class="s2">"localhost"</span>
            <span class="s2">"port"</span> <span class="o">=&gt;</span> <span class="s2">"3307"</span><span class="p">,</span>
        <span class="p">),</span>
</pre></div>
</div>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>sed -i -e 's/"hostname" =&gt; \(".*"\)/"hostname" =&gt; "hoge"/g' sample.php 
</pre></div></div>

<p>'(シングルコーテション)をダブルコーテションに書き換えるだけ<br>
※-eのオプションは逆にシングルコーテーションで囲む</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sample.php</span></div>
<div class="highlight"><pre><span></span>        <span class="s2">"connection"</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s2">"hostname"</span> <span class="o">=&gt;</span> <span class="s2">"fuga"</span>
            <span class="s2">"port"</span> <span class="o">=&gt;</span> <span class="s2">"3307"</span><span class="p">,</span>
        <span class="p">),</span>
</pre></div>
</div>

<h3>
<span id="ini編" class="fragment"></span><a href="#ini%E7%B7%A8"><i class="fa fa-link"></i></a>ini編</h3>

<p>これはシンプルにいける</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sampleini.ini</span></div>
<div class="highlight"><pre><span></span><span class="p">;</span><span class="nx">sample</span> <span class="nx">code</span>
<span class="p">[</span><span class="nx">db</span><span class="p">]</span>
<span class="nx">hostname</span> <span class="o">=</span> <span class="nx">localhost</span>
<span class="nx">port</span> <span class="o">=</span> <span class="mi">3306</span>
<span class="nx">database</span> <span class="o">=</span> <span class="nx">hgoe</span>
<span class="nx">username</span> <span class="o">=</span> <span class="nx">username</span>
<span class="nx">password</span> <span class="o">=</span> <span class="nx">password</span>
</pre></div>
</div>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>sed -i -e "s/hostname = \(.*\)/hostname = fuga/g"  sampleini.php 
</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sampleini.ini</span></div>
<div class="highlight"><pre><span></span><span class="p">;</span><span class="nx">sample</span> <span class="nx">code</span>
<span class="p">[</span><span class="nx">db</span><span class="p">]</span>
<span class="nx">hostname</span> <span class="o">=</span> <span class="nx">fuga</span>
<span class="nx">port</span> <span class="o">=</span> <span class="mi">3306</span>
<span class="nx">database</span> <span class="o">=</span> <span class="nx">hgoe</span>
<span class="nx">username</span> <span class="o">=</span> <span class="nx">username</span>
<span class="nx">password</span> <span class="o">=</span> <span class="nx">password</span>
</pre></div>
</div>

<h2>
<span id="json編" class="fragment"></span><a href="#json%E7%B7%A8"><i class="fa fa-link"></i></a>json編</h2>

<p>例にこんな設定項目があったとする</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sample.json</span></div>
<div class="highlight"><pre><span></span>   <span class="s2">"db"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"localhost"</span>
        <span class="s2">"port"</span><span class="o">:</span> <span class="s2">"3307"</span><span class="p">,</span>
        <span class="s2">"username"</span><span class="o">:</span> <span class="s2">"username"</span><span class="p">,</span>
        <span class="s2">"password"</span><span class="o">:</span> <span class="s2">"password"</span>
    <span class="p">}</span>
</pre></div>
</div>

<p>hostnameを書き換えるならこれ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>sed -i -e 's/"hostname" : \(.*\)/"hostname" : "fuga"/g' test4.json 
</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sample.json</span></div>
<div class="highlight"><pre><span></span>   <span class="s2">"db"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"fuga"</span>
        <span class="s2">"port"</span><span class="o">:</span> <span class="s2">"3307"</span><span class="p">,</span>
        <span class="s2">"username"</span><span class="o">:</span> <span class="s2">"username"</span><span class="p">,</span>
        <span class="s2">"password"</span><span class="o">:</span> <span class="s2">"password"</span>
    <span class="p">}</span>
</pre></div>
</div>

<p>portやusernameとかも配列の例と同様に-eで繋げればか書き換えられます</p>

<h2>
<span id="応用編-同じ項目が複数ある場合は" class="fragment"></span><a href="#%E5%BF%9C%E7%94%A8%E7%B7%A8-%E5%90%8C%E3%81%98%E9%A0%85%E7%9B%AE%E3%81%8C%E8%A4%87%E6%95%B0%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AF"><i class="fa fa-link"></i></a>応用編 同じ項目が複数ある場合は？</h2>

<p>行数の範囲指定をすればいける</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sample.json</span></div>
<div class="highlight"><pre><span></span>  <span class="mi">1</span>     <span class="s2">"db"</span><span class="o">:</span> <span class="p">{</span>
  <span class="mi">2</span>         <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"localhost"</span>
  <span class="mi">3</span>         <span class="s2">"port"</span><span class="o">:</span> <span class="s2">"3307"</span><span class="p">,</span>
  <span class="mi">4</span>         <span class="s2">"username"</span><span class="o">:</span> <span class="s2">"username"</span><span class="p">,</span>
  <span class="mi">5</span>         <span class="s2">"password"</span><span class="o">:</span> <span class="s2">"password"</span>
  <span class="mi">6</span>     <span class="p">},</span>
  <span class="mi">7</span>     <span class="s2">"db2"</span><span class="o">:</span><span class="p">{</span>
  <span class="mi">8</span>         <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"localhost"</span>
  <span class="mi">9</span>         <span class="s2">"port"</span><span class="o">:</span> <span class="s2">"3307"</span><span class="p">,</span>
 <span class="mi">10</span>         <span class="s2">"username"</span><span class="o">:</span> <span class="s2">"username"</span><span class="p">,</span>
 <span class="mi">11</span>         <span class="s2">"password"</span><span class="o">:</span> <span class="s2">"password"</span>
 <span class="mi">12</span>     <span class="p">}</span>
</pre></div>
</div>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>sed -i -e '1,6s/"hostname" : \(.*\)/"hostname" : "fuga"/g' test4.json 
</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">sample.json</span></div>
<div class="highlight"><pre><span></span>  <span class="mi">1</span>     <span class="s2">"db"</span><span class="o">:</span> <span class="p">{</span>
  <span class="mi">2</span>         <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"fuga"</span>
  <span class="mi">3</span>         <span class="s2">"port"</span><span class="o">:</span> <span class="s2">"3307"</span><span class="p">,</span>
  <span class="mi">4</span>         <span class="s2">"username"</span><span class="o">:</span> <span class="s2">"username"</span><span class="p">,</span>
  <span class="mi">5</span>         <span class="s2">"password"</span><span class="o">:</span> <span class="s2">"password"</span>
  <span class="mi">6</span>     <span class="p">},</span>
  <span class="mi">7</span>     <span class="s2">"db2"</span><span class="o">:</span><span class="p">{</span>
  <span class="mi">8</span>         <span class="s2">"hostname"</span> <span class="o">:</span> <span class="s2">"localhost"</span>
  <span class="mi">9</span>         <span class="s2">"port"</span><span class="o">:</span> <span class="s2">"3307"</span><span class="p">,</span>
 <span class="mi">10</span>         <span class="s2">"username"</span><span class="o">:</span> <span class="s2">"username"</span><span class="p">,</span>
 <span class="mi">11</span>         <span class="s2">"password"</span><span class="o">:</span> <span class="s2">"password"</span>
 <span class="mi">12</span>     <span class="p">}</span>
</pre></div>
</div>

<p>設定変更shellscriptとか書くときに役に立つとおもいます</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />39位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>12</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/c85fcca393492a12ec38">virtualbox(centos)でnodebrewインストールメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-26 17:16:02</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[Node.js]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>chrome-extension触ってたらjavascriptが好きになったので<br>
node.jsに興味が湧いてきたのでインストールすることにした。<br>
そしてnode.jsのバージョンアップが鬼のようにするらしいので<br>
バージョン管理ツール<br>
<a href="https://github.com/hokaccha/nodebrew" rel="nofollow noopener" target="_blank">nodebrew</a>で入れてみました。</p>

<h2>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h2>

<ul>
<li>ここから先は全てroo(権限)ユーザーで実行しています</li>
<li>要git</li>
<li>開発環境構築の話です。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://lealog.hateblo.jp/entry/2012/12/30/000928" rel="nofollow noopener" target="_blank">これからNodeやるならnodebrew！あとforeverも。</a></li>
</ul>

<h2>
<span id="gitからクローンする" class="fragment"></span><a href="#git%E3%81%8B%E3%82%89%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%B3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>gitからクローンする</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd /root
curl https://raw.githubusercontent.com/hokaccha/nodebrew/master/nodebrew | perl - setup
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 18289  100 18289    0     0  22288      0 --:--:-- --:--:-- --:--:-- 50382
fetching nodebrew...
install nodebrew in $HOME/.nodebrew

========================================
Add path:

export PATH=$HOME/.nodebrew/current/bin:$PATH
========================================
</pre></div></div>

<p>自分はrbenvやphpenvなど全て/root直下においてるのでここに置いちゃいました。<br>
/rootに置く場合は</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chmod -R 775 /root/.nodebrew
</pre></div></div>

<p>としてください。</p>

<h2>
<span id="全てのユーザーにpathを通す" class="fragment"></span><a href="#%E5%85%A8%E3%81%A6%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%ABpath%E3%82%92%E9%80%9A%E3%81%99"><i class="fa fa-link"></i></a>全てのユーザーにPATHを通す</h2>

<p>export PATH=$HOME/.nodebrew/current/bin:$PATHと書かれているので/etc/profile.dにPATHの設定を追記する</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/profile.d/nodebrew.sh</span></div>
<div class="highlight"><pre><span></span>vim /etc/profile.d/nodebrew.sh


export PATH=/root/.nodebrew/current/bin:$PATH
</pre></div>
</div>

<p>んで一旦ターミナル切って、も一回入り直した後に</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>echo $PATH

/root/.nodebrew/current/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin
</pre></div></div>

<p>/root/.nodebrew/current/binにパスが通っていればOK</p>

<h2>
<span id="インストールできるバージョンを確認する" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A7%E3%81%8D%E3%82%8B%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>インストールできるバージョンを確認する</h2>

<p>これで</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>nodebrew ls-all


remote:
v0.0.1    v0.0.2    v0.0.3    v0.0.4    v0.0.5    v0.0.6    

v0.1.0    v0.1.1    v0.1.2    v0.1.3    v0.1.4    v0.1.5    v0.1.6    v0.1.7
v0.1.8    v0.1.9    v0.1.10   v0.1.11   v0.1.12   v0.1.13   v0.1.14   v0.1.15
v0.1.16   v0.1.17   v0.1.18   v0.1.19   v0.1.20   v0.1.21   v0.1.22   v0.1.23
v0.1.24   v0.1.25   v0.1.26   v0.1.27   v0.1.28   v0.1.29   v0.1.30   v0.1.31
v0.1.32   v0.1.33   v0.1.90   v0.1.91   v0.1.92   v0.1.93   v0.1.94   v0.1.95
v0.1.96   v0.1.97   v0.1.98   v0.1.99   v0.1.100  v0.1.101  v0.1.102  v0.1.103
v0.1.104  

v0.2.0    v0.2.1    v0.2.2    v0.2.3    v0.2.4    v0.2.5    v0.2.6    

v0.3.0    v0.3.1    v0.3.2    v0.3.3    v0.3.4    v0.3.5    v0.3.6    v0.3.7
v0.3.8    

v0.4.0    v0.4.1    v0.4.2    v0.4.3    v0.4.4    v0.4.5    v0.4.6    v0.4.7
v0.4.8    v0.4.9    v0.4.10   v0.4.11   v0.4.12   

v0.5.0    v0.5.1    v0.5.2    v0.5.3    v0.5.4    v0.5.5    v0.5.6    v0.5.7
v0.5.8    v0.5.9    v0.5.10   

v0.6.0    v0.6.1    v0.6.2    v0.6.3    v0.6.4    v0.6.5    v0.6.6    v0.6.7
v0.6.8    v0.6.9    v0.6.10   v0.6.11   v0.6.12   v0.6.13   v0.6.14   v0.6.15
v0.6.16   v0.6.17   v0.6.18   v0.6.19   v0.6.20   v0.6.21   

v0.7.0    v0.7.1    v0.7.2    v0.7.3    v0.7.4    v0.7.5    v0.7.6    v0.7.7
v0.7.8    v0.7.9    v0.7.10   v0.7.11   v0.7.12   

v0.8.0    v0.8.1    v0.8.2    v0.8.3    v0.8.4    v0.8.5    v0.8.6    v0.8.7
v0.8.8    v0.8.9    v0.8.10   v0.8.11   v0.8.12   v0.8.13   v0.8.14   v0.8.15
v0.8.16   v0.8.17   v0.8.18   v0.8.19   v0.8.20   v0.8.21   

v0.9.0    v0.9.1    v0.9.2    v0.9.3    v0.9.4    v0.9.5    v0.9.6    v0.9.7
v0.9.8    v0.9.9    v0.9.10   

local:
v0.9.10

</pre></div></div>

<p>上記のバージョンが入れられるんので最新版をインストールします<br>
（バイナリでインストールしたほうがいいらしいです。って書いてあったので何も考えずにバイナリで入れてます）</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>nodebrew install-binary v0.9.10


fetch: http://nodejs.org/dist/v0.9.10/node-v0.9.10-linux-x64.tar.gz
######################################################################## 100.0%
install success
</pre></div></div>

<p>入った。</p>

<h2>
<span id="使うバージョンを指定する" class="fragment"></span><a href="#%E4%BD%BF%E3%81%86%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>使うバージョンを指定する</h2>

<p>これでサクッと変更</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>nodebrew use v0.9.10


use v0.9.10
</pre></div></div>

<h3>
<span id="nodeの確認" class="fragment"></span><a href="#node%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>nodeの確認</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>node -v


v0.9.10
</pre></div></div>

<p>以上。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />40位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>12</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/73df4ab45c96092b63b8">virtualbox(centos)でMYSQLインストールメモ(mysqld_multiで複数インスタンス起動まで)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-15 21:01:04</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[MySQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>環境 centos6.3（ゲストOS）macosx10.8(ホストOS)</p>

<ul>
<li>yumのリポジトリにremiの設定が入ってる前提とする。入っていない場合は<a href="http://qiita.com/items/662e41376efa97251575">外部リポジトリの追加（remi,epel)</a>を参照</li>
</ul>

<p>centosのデフォルトのリポジトリでmysqlをインストールすると5.1系が入ってしまう。それだとmysqld_mutiの機能がないので最新版の5.5系をインストールする必要がある</p>

<ul>
<li>ここから先は全てrootユーザーで実行しています</li>
<li>開発環境構築の場合で記載しています。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://ryoff.hatenablog.com/entry/20100610/1276136568" rel="nofollow noopener" target="_blank">mysqld_multiを使い、MySQLを複数起動して、Master-Slave構成でReplicationを取るまで</a></li>
<li><a href="http://yaplog.jp/watarin/archive/53" rel="nofollow noopener" target="_blank">MySQL mysqld_multiを使用した自動起動Script</a></li>
<li><a href="http://d.hatena.ne.jp/sotarok/20071209/vmware_centos5_mysql" rel="nofollow noopener" target="_blank">#11 MySQLのインストール・設定::VMWare×CentOS5 Windowsでカンタン開発環境</a></li>
</ul>

<h2>
<span id="install編" class="fragment"></span><a href="#install%E7%B7%A8"><i class="fa fa-link"></i></a>install編</h2>

<p>yumでサクッと入れる(remiリポジトリで)</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum --enablerepo=remi install mysql-server
</pre></div></div>

<h2>
<span id="mycnfのバックアップ" class="fragment"></span><a href="#mycnf%E3%81%AE%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>my.cnfのバックアップ</h2>

<p>my.cnfとはMYSQLの設定ファイルです。<br>
ココでゴニョゴニョカクことによってmysqlで色々なことができます。</p>

<p>なんかやらかした場合に戻せるように</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cp /etc/my.cnf /etc/my.cnf.bk
</pre></div></div>

<h2>
<span id="mycnfの編集" class="fragment"></span><a href="#mycnf%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>my.cnfの編集</h2>

<p>デフォルトの設定を編集します</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/my.cnf</span></div>
<div class="highlight"><pre><span></span>vim /etc/my.cnf

#修正前
[mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock

#修正後
[mysqld]
#datadir=/var/lib/mysql
#socket=/var/lib/mysql/mysql.sock

#追加 ----ここから----
#mysqld項目のすぐ下に記載してください
#デフォルトMYSQL
[mysqld1]
server-id = 1
port      = 3306
datadir   = /var/lib/mysql/multi1
socket    = /var/lib/mysql/multi1/mysql.sock
pid-file  = /var/lib/mysql/multi1/mysqld.pid

#MYSQLその2
[mysqld2]
server-id = 2
port      = 3307
datadir   = /var/lib/mysql/multi2
socket    = /var/lib/mysql/multi2/mysql.sock
pid-file  = /var/lib/mysql/multi2/mysqld.pid
#追加 ----ここまで----

[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

</pre></div>
</div>

<p>datadir,socketpid-file,port,server-idが重複しなければ複数記載でOK<br>
編集後のmy.cnf</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>[mysqld_multi]
mysqld     = /usr/bin/mysqld_safe
mysqladmin = /usr/bin/mysqladmin

[mysqld]
#datadir=/var/lib/mysql
#socket=/var/lib/mysql/mysql.sock

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

# Settings user and group are ignored when systemd is used (fedora &gt;= 15).
# If you need to run mysqld under a different user or group,
# customize your systemd unit file for mysqld according to the
# instructions in http://fedoraproject.org/wiki/Systemd
user=mysql

# Semisynchronous Replication
# http://dev.mysql.com/doc/refman/5.5/en/replication-semisync.html
# uncomment next line on MASTER
;plugin-load=rpl_semi_sync_master=semisync_master.so
# uncomment next line on SLAVE
;plugin-load=rpl_semi_sync_slave=semisync_slave.so

# Others options for Semisynchronous Replication
;rpl_semi_sync_master_enabled=1
;rpl_semi_sync_master_timeout=10
;rpl_semi_sync_slave_enabled=1

# http://dev.mysql.com/doc/refman/5.5/en/performance-schema.html
;performance_schema

;default-character-set = utf8

#デフォルトMYSQL
[mysqld1]
server-id = 1
port      = 3306
datadir   = /var/lib/mysql/multi1
socket    = /var/lib/mysql/multi1/mysql.sock
pid-file  = /var/lib/mysql/multi1/mysqld.pid

#MYSQLその2
[mysqld2]
server-id = 2
port      = 3307
datadir   = /var/lib/mysql/multi2
socket    = /var/lib/mysql/multi2/mysql.sock
pid-file  = /var/lib/mysql/multi2/mysqld.pid

[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
</pre></div></div>

<h2>
<span id="パーミッションをmysqlユーザーに変更する" class="fragment"></span><a href="#%E3%83%91%E3%83%BC%E3%83%9F%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92mysql%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>パーミッションをmysqlユーザーに変更する</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chown -R mysql:mysql /var/lib/mysql/
</pre></div></div>

<h2>
<span id="mysql_install_dbでdataの初期化を行う" class="fragment"></span><a href="#mysql_install_db%E3%81%A7data%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96%E3%82%92%E8%A1%8C%E3%81%86"><i class="fa fa-link"></i></a>mysql_install_dbでdataの初期化を行う</h2>

<p>dataの初期化処理をする</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mysql_install_db --datadir=/var/lib/mysql/multi1 --user=mysql
mysql_install_db --datadir=/var/lib/mysql/multi2 --user=mysql

#両方ともこんな感じのメッセージがでればOK

#Installing MySQL system tables...
#OK
#Filling help tables...
#OK

#To start mysqld at boot time you have to copy
#support-files/mysql.server to the right place for your system

#PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !
#To do so, start the server, then issue the following commands:

#/usr/bin/mysqladmin -u root password 'new-password'
#/usr/bin/mysqladmin -u root -h localhost.localdomain password 'new-#password'

#Alternatively you can run:
#/usr/bin/mysql_secure_installation

#which will also give you the option of removing the test
#databases and anonymous user created by default.  This is
#strongly recommended for production servers.

#See the manual for more instructions.

#You can start the MySQL daemon with:
#cd /usr ; /usr/bin/mysqld_safe &amp;

#You can test the MySQL daemon with mysql-test-run.pl
#cd /usr/mysql-test ; perl mysql-test-run.pl

#Please report any problems with the /usr/bin/mysqlbug script!
</pre></div></div>

<h2>
<span id="mysqld_multi起動スクリプトを作成する" class="fragment"></span><a href="#mysqld_multi%E8%B5%B7%E5%8B%95%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>mysqld_multi起動スクリプトを作成する</h2>

<p>MYSQLは起動した瞬間に立ち上がっててほしいはずなので起動スクリプトを書く</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/init.d/mysqld_multi</span></div>
<div class="highlight"><pre><span></span>vim /etc/init.d/mysqld_multi

#!/bin/sh

# Mysql daemon start/stop script.
#

# Usually this is put in /etc/init.d (at least on machines SYSV R4
# based systems) and linked to /etc/rc3.d/S99mysql and /etc/rc0.d/S01mysql.
# When this is done the mysql server will be started when the machine is started
# and shut down when the systems goes down.

# Comments to support chkconfig on RedHat Linux
# chkconfig: 2345 90 90
# description: A very fast and reliable SQL database engine.

# The following variables are only set for letting mysql.server find things
# if you want to affect other MySQL variables, you should make your changes
# in the /etc/my.cnf or other configuration files

MYSQLDIR=/usr
PATH=/sbin:/usr/sbin:/bin:/usr/bin:/usr/local/bin:$MYSQLDIR/bin
MYSQLID=1,2,3,4,5
export PATH

# See how we were called.
case "$1" in
start)
echo -n "Starting mysqld: "
$MYSQLDIR/bin/mysqld_multi start $MYSQLID
echo
;;
stop)
echo -n "Shutting down mysqld: "
$MYSQLDIR/bin/mysqld_multi stop $MYSQLID
echo
;;
status)
$MYSQLDIR/bin/mysqld_multi report $MYSQLID
;;
restart)
$0 stop
$0 start
;;
*)
echo "Usage: $0 {start|stop|restart|status}"
exit 1
esac

exit 0
</pre></div>
</div>

<h2>
<span id="起動スクリプトの登録" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>起動スクリプトの登録</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chkconfig --add mysqld_multi
chkconfig mysqld_multi on
</pre></div></div>

<h2>
<span id="一旦virtualboxを落として自動起動しているか確認する" class="fragment"></span><a href="#%E4%B8%80%E6%97%A6virtualbox%E3%82%92%E8%90%BD%E3%81%A8%E3%81%97%E3%81%A6%E8%87%AA%E5%8B%95%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>一旦virtualboxを落として自動起動しているか確認する</h2>

<p>起動して下記のコマンドを実行してis runningと表示されていればOK</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/mysqld_multi status

#Reporting MySQL servers
#MySQL server from group: mysqld1 is running
#MySQL server from group: mysqld2 is running

</pre></div></div>

<h2>
<span id="接続確認" class="fragment"></span><a href="#%E6%8E%A5%E7%B6%9A%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>接続確認</h2>

<p>mysqld_multiを設定するとmysqlの起動時にポートの指定とhostの指定をしないとmysqlに入れなくなるので注意してください</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mysql -uroot -P3306 -h127.0.0.1

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.5.30 MySQL Community Server (GPL) by Remi

Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 

</pre></div></div>

<h2>
<span id="rootユーザーのパスワードを設定する" class="fragment"></span><a href="#root%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>rootユーザーのパスワードを設定する</h2>

<p>２つのインスタンスがあるので２つとも設定する<br>
※以下はport3306のみの内容を記載します</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mysqladmin -uroot -P3306 -h127.0.0.1 password 'パスワード'
</pre></div></div>

<p>接続エラーになるのを確認する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mysql -uroot -P3306 -h127.0.0.1
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)

#再度設定したパスワードでmysqlに入る
mysql -uroot -pパスワード -P3306 -h127.0.0.1

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.5.30 MySQL Community Server (GPL) by Remi

Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 
</pre></div></div>

<h2>
<span id="パスワードがないrootユーザーを削除する" class="fragment"></span><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%81%8C%E3%81%AA%E3%81%84root%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>パスワードがないrootユーザーを削除する</h2>

<p>MySQLには最初パスワードの存在しないユーザが用意されていますので、これを削除します。</p>

<div class="code-frame" data-lang="mysql"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">mysql</span><span class="p">.</span><span class="n">user</span> <span class="k">WHERE</span> <span class="n">Password</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">3</span> <span class="n">rows</span> <span class="nf">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div></div>

<h2>
<span id="普段使用するユーザーを作成する" class="fragment"></span><a href="#%E6%99%AE%E6%AE%B5%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>普段使用するユーザーを作成する</h2>

<div class="code-frame" data-lang="mysql"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">ALL</span> <span class="n">PRIVILEGES</span> <span class="k">ON</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'ユーザー名'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'パスワード'</span> <span class="k">WITH</span> <span class="k">GRANT</span> <span class="k">OPTION</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="nf">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div></div>

<h2>
<span id="作成したユーザーで入れるか確認する" class="fragment"></span><a href="#%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A7%E5%85%A5%E3%82%8C%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>作成したユーザーで入れるか確認する</h2>

<div class="code-frame" data-lang="mysql"><div class="highlight"><pre><span></span><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span><span class="err">ユーザー</span> <span class="o">-</span><span class="n">p</span><span class="err">パスワード</span> <span class="o">-</span><span class="n">P3306</span> <span class="o">-</span><span class="n">h127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>
<span class="n">Welcome</span> <span class="k">to</span> <span class="n">the</span> <span class="n">MySQL</span> <span class="n">monitor</span><span class="p">.</span>  <span class="n">Commands</span> <span class="n">end</span> <span class="k">with</span> <span class="p">;</span> <span class="k">or</span> <span class="err">\</span><span class="n">g</span><span class="p">.</span>
<span class="n">Your</span> <span class="n">MySQL</span> <span class="n">connection</span> <span class="n">id</span> <span class="k">is</span> <span class="mi">9</span>
<span class="n">Server</span> <span class="n">version</span><span class="p">:</span> <span class="mi">5</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">30</span> <span class="n">MySQL</span> <span class="n">Community</span> <span class="nf">Server</span> <span class="p">(</span><span class="n">GPL</span><span class="p">)</span> <span class="k">by</span> <span class="n">Remi</span>

<span class="nf">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2013</span><span class="p">,</span> <span class="n">Oracle</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="n">its</span> <span class="n">affiliates</span><span class="p">.</span> <span class="k">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>

<span class="n">Oracle</span> <span class="k">is</span> <span class="n">a</span> <span class="n">registered</span> <span class="n">trademark</span> <span class="n">of</span> <span class="n">Oracle</span> <span class="n">Corporation</span> <span class="k">and</span><span class="o">/</span><span class="k">or</span> <span class="n">its</span>
<span class="n">affiliates</span><span class="p">.</span> <span class="n">Other</span> <span class="n">names</span> <span class="n">may</span> <span class="n">be</span> <span class="n">trademarks</span> <span class="n">of</span> <span class="n">their</span> <span class="n">respective</span>
<span class="n">owners</span><span class="p">.</span>

<span class="n">Type</span> <span class="s1">'help;'</span> <span class="k">or</span> <span class="s1">'\h'</span> <span class="k">for</span> <span class="n">help</span><span class="p">.</span> <span class="n">Type</span> <span class="s1">'\c'</span> <span class="k">to</span> <span class="n">clear</span> <span class="n">the</span> <span class="n">current</span> <span class="n">input</span> <span class="n">statement</span><span class="p">.</span>

<span class="n">mysql</span><span class="o">&gt;</span> 
</pre></div></div>

<p>以上</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />41位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/2d99c022a43f471e1a43">FuelPHP【テスト】-- oil testの拡張 --</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-03 19:26:57</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[FuelPHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>FuelPHPのoil testが重い。。。。<br>
カレントディレクトリからの実行だからテストが増えれば増えるはど重くなる。。。。<br>
なんで単体でテスト書いてる時はファイル指定で実行できるタスクを作成してみました。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3</li>
<li>fuelPHP1.5.3</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
<li>fuelPHPがインストール済みであること インストールをしていない場合は<a href="http://qiita.com/items/ae107a96699745a02560">FuelPHP【入門】-- CRUDを作った時のメモ(インストールからCRUD作成まで) --</a>を参考にインストールしてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://fuelphp.jp/docs/1.5/general/tasks.html" rel="nofollow noopener" target="_blank">日本語版ドキュメント(1.5ドキュメント)</a></li>
</ul>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>下記コマンドでご使用ください。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil r test --file=fuel/core/tests/arr.php 
Tests Running...This may take a few moments.
PHPUnit 3.7.19 by Sebastian Bergmann.

Configuration read from /home/web/lo.arena.branch.org/arena/fuel/app/phpunit.xml

....................................

Time: 0 seconds, Memory: 5.25Mb

OK (36 tests, 43 assertions)

</pre></div></div>

<h2>
<span id="oil-testとの比較" class="fragment"></span><a href="#oil-test%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fa fa-link"></i></a>oil testとの比較</h2>

<h3>
<span id="標準のoil-test" class="fragment"></span><a href="#%E6%A8%99%E6%BA%96%E3%81%AEoil-test"><i class="fa fa-link"></i></a>標準のoil test</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil t --group=Arr 

Tests Running...This may take a few moments.
Notice - Undefined variable: obj in PKGPATH/rap/tests/phpcs/IncrementDecrementSpacing/object_nospacing_pass.php on line 2
Warning - Creating default object from empty value in PKGPATH/rap/tests/phpcs/IncrementDecrementSpacing/object_nospacing_pass.php on line 2
Notice - Undefined variable: obj in PKGPATH/rap/tests/phpcs/IncrementDecrementSpacing/object_spacing.php on line 2
Warning - Creating default object from empty value in PKGPATH/rap/tests/phpcs/IncrementDecrementSpacing/object_spacing.php on line 2
PHPUnit 3.7.19 by Sebastian Bergmann.

Configuration read from /home/web/lo.arena.branch.org/arena/fuel/app/phpunit.xml

....................................

Time: 1 second, Memory: 13.00Mb

OK (36 tests, 43 assertions)

</pre></div></div>

<h3>
<span id="拡張タスク" class="fragment"></span><a href="#%E6%8B%A1%E5%BC%B5%E3%82%BF%E3%82%B9%E3%82%AF"><i class="fa fa-link"></i></a>拡張タスク</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>php oil r test --group=Arr --file=fuel/core/tests/arr.php

Tests Running...This may take a few moments.
PHPUnit 3.7.19 by Sebastian Bergmann.

Configuration read from /home/web/lo.arena.branch.org/arena/fuel/app/phpunit.xml

....................................

Time: 0 seconds, Memory: 5.25Mb

OK (36 tests, 43 assertions)

</pre></div></div>

<p>メモリの少量が約3/1に減りました。</p>

<h2>
<span id="taskの拡張本体" class="fragment"></span><a href="#task%E3%81%AE%E6%8B%A1%E5%BC%B5%E6%9C%AC%E4%BD%93"><i class="fa fa-link"></i></a>taskの拡張本体</h2>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/tasks/test.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Fuel\Tasks</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Config</span> <span class="k">as</span> <span class="nx">Config</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Arr</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * oil test拡張クラス</span>
<span class="sd"> *</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Test</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_invoke</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * ヘルプの表示を行う</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">help</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">HELP</span><span class="s"></span>
<span class="s">使用法:</span>
<span class="s">    php oil refine test --file=実行したいPHPunitのtestファイル</span>
<span class="s">    php oil r test --file=実行したいPHPunitのtestファイル</span>

<span class="s">コマンド一覧:</span>
<span class="s">    help     ヘルプの表示</span>
<span class="s">    test    phpunitの実行</span>

<span class="s">説明:</span>
<span class="s">    phpunitでファイル指定で実行できるようにします。（高速）</span>

<span class="s">例:</span>
<span class="s">    php oil r test --file=実行したいPHPunitのtestファイル</span>

<span class="dl">HELP</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">_invoke</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Suppressing this because if the file does not exist... well thats a bad thing and we can't really check</span>
        <span class="c1">// I know that supressing errors is bad, but if you're going to complain: shut up. - Phil</span>
        <span class="nv">$phpunit_autoload_path</span> <span class="o">=</span> <span class="nx">\Config</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">'oil.phpunit.autoload_path'</span><span class="p">,</span> <span class="s1">'PHPUnit/Autoload.php'</span> <span class="p">);</span>
        <span class="o">@</span><span class="k">include_once</span><span class="p">(</span><span class="nv">$phpunit_autoload_path</span><span class="p">);</span>

        <span class="c1">// Attempt to load PHUnit.  If it fails, we are done.</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nb">class_exists</span><span class="p">(</span><span class="s1">'PHPUnit_Framework_TestCase'</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">'PHPUnit does not appear to be installed.'</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="o">.</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Please visit http://phpunit.de and install."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Check for a custom phpunit config, but default to the one from core</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">file_exists</span><span class="p">(</span><span class="nx">APPPATH</span><span class="o">.</span><span class="s1">'phpunit.xml'</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nv">$phpunit_config</span> <span class="o">=</span> <span class="nx">APPPATH</span><span class="o">.</span><span class="s1">'phpunit.xml'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="nv">$phpunit_config</span> <span class="o">=</span> <span class="nx">COREPATH</span><span class="o">.</span><span class="s1">'phpunit.xml'</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// CD to the root of Fuel and call up phpunit with the path to our config</span>
        <span class="nv">$phpunit_command</span> <span class="o">=</span> <span class="nx">\Config</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">'oil.phpunit.binary_path'</span><span class="p">,</span> <span class="s1">'phpunit'</span><span class="p">);</span>
        <span class="nv">$command</span> <span class="o">=</span> <span class="s1">'cd '</span><span class="o">.</span><span class="nx">DOCROOT</span><span class="o">.</span><span class="s1">'; '</span><span class="o">.</span><span class="nv">$phpunit_command</span><span class="o">.</span><span class="s1">' -c "'</span><span class="o">.</span><span class="nv">$phpunit_config</span><span class="o">.</span><span class="s1">'"'</span><span class="p">;</span>

        <span class="c1">// Respect the group options</span>
        <span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'group'</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$command</span> <span class="o">.=</span> <span class="s1">' --group '</span><span class="o">.</span><span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'group'</span><span class="p">);</span>
        <span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'exclude-group'</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$command</span> <span class="o">.=</span> <span class="s1">' --exclude-group '</span><span class="o">.</span><span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'exclude-group'</span><span class="p">);</span>

        <span class="c1">// Respect the coverage-html option</span>
        <span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'coverage-html'</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$command</span> <span class="o">.=</span> <span class="s1">' --coverage-html '</span><span class="o">.</span><span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'coverage-html'</span><span class="p">);</span>
        <span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'coverage-clover'</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$command</span> <span class="o">.=</span> <span class="s1">' --coverage-clover '</span><span class="o">.</span><span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'coverage-clover'</span><span class="p">);</span>
        <span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'coverage-text'</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$command</span> <span class="o">.=</span> <span class="s1">' --coverage-text='</span><span class="o">.</span><span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'coverage-text'</span><span class="p">);</span>
        <span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'coverage-php'</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$command</span> <span class="o">.=</span> <span class="s1">' --coverage-php '</span><span class="o">.</span><span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'coverage-php'</span><span class="p">);</span>
        <span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'file'</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$command</span> <span class="o">.=</span> <span class="s1">' '</span><span class="o">.</span><span class="nx">\Cli</span><span class="o">::</span><span class="na">option</span><span class="p">(</span><span class="s1">'file'</span><span class="p">);</span>

        <span class="nx">\Cli</span><span class="o">::</span><span class="na">write</span><span class="p">(</span><span class="s1">'Tests Running...This may take a few moments.'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">);</span>

        <span class="nv">$return_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c1">// var_dump($command); exit;</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nb">explode</span><span class="p">(</span><span class="s1">';'</span><span class="p">,</span> <span class="nv">$command</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$c</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nb">passthru</span><span class="p">(</span><span class="nv">$c</span><span class="p">,</span> <span class="nv">$return_code_task</span><span class="p">);</span>
            <span class="c1">// Return failure if any subtask fails</span>
            <span class="nv">$return_code</span> <span class="o">|=</span> <span class="nv">$return_code_task</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">exit</span><span class="p">(</span><span class="nv">$return_code</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>

<p>もしかしたらfuel/core/phpunit.xmlをfuel/app/phpunit.xmlにコピーしないと動かないかもしれません。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />42位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/746f1f44cb352f935b7d">mongodbででっかいデータを入れすぎてファイルがけせない場合の対処法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-18 16:45:22</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[MongoDB]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>でっかいデータをずどーんと入れてファイル容量が圧迫すると<br>
mongodb本体がロックをかけてremove()ができなくなります。</p>

<div class="code-frame" data-lang="mongo"><div class="highlight"><pre><span></span>db.access_before.remove()
Can't take a write lock while out of disk space
</pre></div></div>

<p>re….removeができない</p>

<h2>
<span id="対処法" class="fragment"></span><a href="#%E5%AF%BE%E5%87%A6%E6%B3%95"><i class="fa fa-link"></i></a>対処法</h2>

<h3>
<span id="その１-mongoをまず止める" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%91-mongo%E3%82%92%E3%81%BE%E3%81%9A%E6%AD%A2%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>その１ mongoをまず止める</h3>

<p>止めましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/mongod stop
</pre></div></div>

<h3>
<span id="その2-lockfileを削除する" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE2-lockfile%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>その2 lockfileを削除する</h3>

<p>デフォルトの設定なら/var/lib/mongoにあります</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd /path/to/mongo
rm /path/to/mongo/mongod.lock
</pre></div></div>

<h3>
<span id="その3-再度mongoを起動させる" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE3-%E5%86%8D%E5%BA%A6mongo%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>その3 再度mongoを起動させる</h3>

<p>起動させましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/mongod start
</pre></div></div>

<h3>
<span id="その４-もう一回removeを使用して消去する" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%94-%E3%82%82%E3%81%86%E4%B8%80%E5%9B%9Eremove%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E6%B6%88%E5%8E%BB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>その４ もう一回remove()を使用して消去する</h3>

<p>消去しましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mongo
&gt; use apache
&gt; db.access_before.count()
0
</pre></div></div>

<p>消せました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />43位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>6</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/40b527c390f068985f75">virtualbox(centos)でnginxをwebsocketを使用出来る状態でインストールする方法メモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-28 12:30:48</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Node.js]</b> <b>[nginx]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>node.jsでwebsocketを使用する場合nginx_tcp_proxy_moduleというモジュールが必要らしいが入れてなかった。<br>
しかもモジュールの追加の場合は再コンパイルをしなくてはならない。<br>
ガーーーン。<br>
ということで一旦yumで入れたnginxを一旦アンインストールしてコンパイルして入れ直すことにした。</p>

<h2>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h2>

<ul>
<li>ここから先は全てroo(権限)ユーザーで実行しています</li>
<li>要git</li>
<li>開発環境構築の話です。本番環境などはもっと詳しいブログをみつけてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://memo.yomukaku.net/entries/ZRcHAtD" rel="nofollow noopener" target="_blank">nginx 1.0.10をCentOSでインストール（WebSocketのリバースプロキシ付き）</a></li>
<li><a href="https://github.com/kuchbhi/nginx-setup/blob/master/nginx_install" rel="nofollow noopener" target="_blank">nginx-setup / nginx_install</a></li>
<li><a href="http://havelog.ayumusato.com/develop/javascript/e211-nodejs_build_env.html" rel="nofollow noopener" target="_blank">node.js用の環境作り - ディレクトリ構成とnginxの設定から起動テストまで</a></li>
</ul>

<h2>
<span id="nginxのソースを取ってくる" class="fragment"></span><a href="#nginx%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E5%8F%96%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8B"><i class="fa fa-link"></i></a>nginxのソースを取ってくる</h2>

<p>取ってくる</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local</span></div>
<div class="highlight"><pre><span></span>cd /usr/local/
wget http://nginx.org/download/nginx-1.3.13.tar.gz
tar zxvf nginx-1.3.13.tar.gz
cd /usr/local/nginx-1.3.13
</pre></div>
</div>

<h2>
<span id="nginxのモジュールを追加する" class="fragment"></span><a href="#nginx%E3%81%AE%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>nginxのモジュールを追加する</h2>

<p>便利なものが色々あるので追加する</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/nginx-1.3.13</span></div>
<div class="highlight"><pre><span></span>cd /usr/local/nginx-1.3.13
git clone https://github.com/yaoweibin/nginx_tcp_proxy_module.git
git clone https://github.com/agentzh/headers-more-nginx-module.git
git clone https://github.com/FRiCKLE/ngx_cache_purge.git
</pre></div>
</div>

<h2>
<span id="nginx_tcp_proxy_moduleのパッチを当てる" class="fragment"></span><a href="#nginx_tcp_proxy_module%E3%81%AE%E3%83%91%E3%83%83%E3%83%81%E3%82%92%E5%BD%93%E3%81%A6%E3%82%8B"><i class="fa fa-link"></i></a>nginx_tcp_proxy_moduleのパッチを当てる</h2>

<p>このモジュールがないとwebsocket使えないです。<br>
パッチ当てるって初めてやったのですがコマンド打つだけでした。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/nginx-1.3.13</span></div>
<div class="highlight"><pre><span></span>patch -p1 &lt; nginx_tcp_proxy_module/tcp.patch 
</pre></div>
</div>

<h2>
<span id="コンパイルする際に必要なモジュールの追加" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>コンパイルする際に必要なモジュールの追加</h2>

<p>足らなければ入れましょう。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum install -y patch
yum install -y pcre-devel
yum install -y zlib-devel openssl-devel
</pre></div></div>

<h2>
<span id="configureからのmakemake-install" class="fragment"></span><a href="#configure%E3%81%8B%E3%82%89%E3%81%AEmakemake-install"><i class="fa fa-link"></i></a>configureからのmake,make install</h2>

<p>いつもどおりで</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/nginx-1.3.13</span></div>
<div class="highlight"><pre><span></span>./configure --prefix='/usr/local/nginx' --with-http_ssl_module --with-http_stub_status_module --with-http_xslt_module --with-http_realip_module --with-http_gzip_static_module --error-log-path=/var/log/nginx/error.log --pid-path=/var/run/nginx.pid --lock-path=/var/lock/nginx.lock --http-log-path=/var/log/nginx/access.log --with-debug --add-module=./headers-more-nginx-module --add-module=./ngx_cache_purge --add-module=./nginx_tcp_proxy_module
</pre></div>
</div>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/nginx-1.3.13</span></div>
<div class="highlight"><pre><span></span>make
make install
</pre></div>
</div>

<h2>
<span id="起動コマンドの作成" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>起動コマンドの作成</h2>

<p><a href="http://memo.yomukaku.net/entries/ZRcHAtD" rel="nofollow noopener" target="_blank">nginx 1.0.10をCentOSでインストール（WebSocketのリバースプロキシ付き）</a>を参照しました</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/init.d/nginx</span></div>
<div class="highlight"><pre><span></span>vim /etc/init.d/nginx


#!/bin/sh
#
# nginx - this script starts and stops the nginx daemin
#
# chkconfig:   - 85 15 
# description:  Nginx is an HTTP(S) server, HTTP(S) reverse \
#               proxy and IMAP/POP3 proxy server
# processname: nginx
# config:      /usr/local/nginx/conf/nginx.conf
# pidfile:     /var/run/nginx.pid

# Source function library.
. /etc/rc.d/init.d/functions

# Source networking configuration.
. /etc/sysconfig/network

# Check that networking is up.
[ "$NETWORKING" = "no" ] &amp;&amp; exit 0

#nginx="/usr/local/sbin/nginx"
nginx="/usr/local/nginx/sbin/nginx"
prog=$(basename $nginx)

NGINX_CONF_FILE="/usr/local/nginx/conf/nginx.conf"

lockfile=/var/lock/subsys/nginx

start() {
    [ -x $nginx ] || exit 5
    [ -f $NGINX_CONF_FILE ] || exit 6
    echo -n $"Starting $prog: "
    daemon $nginx -c $NGINX_CONF_FILE
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; touch $lockfile
    return $retval
}

stop() {
    echo -n $"Stopping $prog: "
    killproc $prog -QUIT
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile
    return $retval
}

restart() {
    configtest || return $?
    stop
    start
}

reload() {
    configtest || return $?
    echo -n $"Reloading $prog: "
    killproc $nginx -HUP
    RETVAL=$?
    echo
}

force_reload() {
    restart
}

configtest() {
  $nginx -t -c $NGINX_CONF_FILE
}

rh_status() {
    status $prog
}

rh_status_q() {
    rh_status &gt;/dev/null 2&gt;&amp;1
}

case "$1" in
    start)
        rh_status_q &amp;&amp; exit 0
        $1
        ;;
    stop)
        rh_status_q || exit 0
        $1
        ;;
    restart|configtest)
        $1
        ;;
    reload)
        rh_status_q || exit 7
        $1
        ;;
    force-reload)
        force_reload
        ;;
    status)
        rh_status
        ;;
    condrestart|try-restart)
        rh_status_q || exit 0
            ;;
    *)
        echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}"
        exit 2
esac
</pre></div>
</div>

<h2>
<span id="confの設定を変更する" class="fragment"></span><a href="#conf%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>confの設定を変更する</h2>

<p>コメントアウト色々消去しちゃいました。ローカル環境なので最低限の構成で</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/nginx/conf/nginx.conf</span></div>
<div class="highlight"><pre><span></span>
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;

    keepalive_timeout  65;

    #ここからの設定がapacheでいうvirtualhostの設定の項目になります。
    #rootがapacheでいうドキュメントルート
    #server_nameに/etc/hostsで書いたvirtulahostと解釈して変更してください。

    #lo.test.org server directive
    server {
        listen       80;
        server_name  lo.test.org;
        location / {
            root   /home/web/lo.test.org/www;
            index  index.html index.htm;
        }

        location = /50x.html {
            root   /usr/share/nginx/html;
        }


        #nginxでphpを使いたい場合の設定です。fastcgi_passはphp-fpmを起動しているポート番号を指定してください。(デフォルトは9000で起動している)
        location ~ \.php$ {
            root           html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /home/web/lo.test.org/www$fastcgi_script_name;
            include        fastcgi_params;
        }
    }


    #lo.sample.org server directive
    server {
        listen       80;
        server_name  lo.sample.org;
        root   /home/web/lo.sample.org/www;
        index  index.php index.html index.htm;
        location ~ \.php$ {
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /home/web/lo.sample.org/www$fastcgi_script_name;
            include        fastcgi_params;
        }
    }
}
</pre></div>
</div>

<h2>
<span id="nginxの起動確認" class="fragment"></span><a href="#nginx%E3%81%AE%E8%B5%B7%E5%8B%95%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>nginxの起動確認</h2>

<p>書いた起動スクリプトを実行するだけ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/nginx start
nginx を起動中:                                            [  OK  ]
</pre></div></div>

<h2>
<span id="起動時に自動でnginxが起動するようにする" class="fragment"></span><a href="#%E8%B5%B7%E5%8B%95%E6%99%82%E3%81%AB%E8%87%AA%E5%8B%95%E3%81%A7nginx%E3%81%8C%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>起動時に自動でnginxが起動するようにする</h2>

<p>chkconfigに設定を追加しましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>chkconfig --add nginx
chkconfig nginx on
</pre></div></div>

<p>以上。パッチとかはじめ面倒そうってイメージでしたが以外とすんなりいけたのでよかった。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />44位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/845fd7329572dd923217">FuelPHP【parser】デフォルトのviewの拡張子が.phpだとみずらいので識別拡張子を変更する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-07 12:06:26</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[FuelPHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>テンプレートエンジンって書きづらくないですか？<br>
書きづらくない。そうですか。<br>
自分は素のPHPがすきなんですがFuel\Coew\Viewの拡張子が.phpだとvimとかでタブをいっぱい開いたときにどれがcontrollerでどれがviewかがわかりずらいのでいっそのこと拡張子を変更することにしました。</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3</li>
<li>fuelPHP1.6.1</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.3以上</li>
<li>git</li>
<li>fuelPHPがインストール済みであること インストールをしていない場合は<a href="http://qiita.com/items/ae107a96699745a02560">FuelPHP【入門】-- CRUDを作った時のメモ(インストールからCRUD作成まで) --</a>を参考にインストールしてください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://fuelphp.jp/docs/1.6/" rel="nofollow noopener" target="_blank">日本語版ドキュメント(1.6ドキュメント)</a></li>
</ul>

<h2>
<span id="packagesparserconfigperserphpをコピーする" class="fragment"></span><a href="#packagesparserconfigperserphp%E3%82%92%E3%82%B3%E3%83%94%E3%83%BC%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>packages/parser/config/perser.phpをコピーする</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cp fuel/packages/parser/parser.php fuel/app/config/
</pre></div></div>

<h3>
<span id="編集" class="fragment"></span><a href="#%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>編集</h3>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/config/parser.php</span></div>
<div class="highlight"><pre><span></span><span class="k">return</span> <span class="k">array</span><span class="p">(</span>

    <span class="c1">// ------------------------------------------------------------------------</span>
    <span class="c1">// Register extensions to their parsers, either classname or array config</span>
    <span class="c1">// ------------------------------------------------------------------------</span>
    <span class="s1">'extensions'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'phtml'</span>     <span class="o">=&gt;</span> <span class="s1">'View'</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">);</span>

</pre></div>
</div>

<p>1.5系とかは適時packagesのパスを置き換えてください。</p>

<h2>
<span id="packageのロード" class="fragment"></span><a href="#package%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>packageのロード</h2>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/app/config/config.php</span></div>
<div class="highlight"><pre><span></span>    <span class="s1">'always_load'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'packages'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'parser'</span><span class="p">,</span>
           <span class="s1">'my'</span><span class="p">,</span>
        <span class="p">),</span>
</pre></div>
</div>

<h2>
<span id="fuelcoreviewを継承したクラスを作成する" class="fragment"></span><a href="#fuelcoreview%E3%82%92%E7%B6%99%E6%89%BF%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Fuel\Core\Viewを継承したクラスを作成する</h2>

<p>ファイルの置き場所は好みに応じて自分は自分用パッケージ作って管理しました。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir fuel/packages/my fuel/packages/classes fuel/packages/my/config fuel/packages/my/tests 
</pre></div></div>

<h2>
<span id="bootstrapphpを置く" class="fragment"></span><a href="#bootstrapphp%E3%82%92%E7%BD%AE%E3%81%8F"><i class="fa fa-link"></i></a>bootstrap.phpを置く</h2>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/packages/my/bootstrap.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nx">Autoloader</span><span class="o">::</span><span class="na">add_core_namespace</span><span class="p">(</span><span class="s1">'My'</span><span class="p">);</span>

<span class="nx">Autoloader</span><span class="o">::</span><span class="na">add_classes</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'My\\View'</span>                         <span class="o">=&gt;</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">'/classes/view.php'</span><span class="p">,</span>
<span class="p">));</span>


<span class="cm">/* End of file bootstrap.php */</span>
</pre></div>
</div>

<h2>
<span id="拡張viewクラス" class="fragment"></span><a href="#%E6%8B%A1%E5%BC%B5view%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>拡張viewクラス</h2>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">fuel/packages/my/clasees/view.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">My</span><span class="p">;</span>


<span class="sd">/**</span>
<span class="sd"> * View class</span>
<span class="sd"> *</span>
<span class="sd"> * Acts as an object wrapper for HTML pages with embedded PHP, called "views".</span>
<span class="sd"> * Variables can be assigned with the view object and referenced locally within</span>
<span class="sd"> * the view.</span>
<span class="sd"> *</span>
<span class="sd"> * @package   My</span>
<span class="sd"> * @category  View</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">View</span> <span class="k">extends</span> <span class="nx">\Fuel\Core\View</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var  string  The view file extension</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$extension</span> <span class="o">=</span> <span class="s1">'phtml'</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</div>

<p>$extensionはお好みに応じて変更すればと</p>

<p>上記の設定が完了したらviewsのファイルの拡張子を変更すればできあがりです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />45位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/8deb1a7ff7fa9d109a94">mongodbでTSVをインポートする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-15 18:07:28</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[MongoDB]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>こうやる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mongoimport --db db名 --collection collection名 --type tsv --file 取り込みたいファイル --fields hoge1,hoge2,hoge3
#fieldsがtsvのカラム名
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />46位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/02f0b20539e816d10230">今日作りたくなる簡単cookbook [Kim&apos;sキッチン] jq</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-04 13:36:48</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[chef]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下全ても●みち風に書いたメモ</p>

<p>皆さんおはようございます。<br>
<a href="http://qiita.com/users/ryurock@github">ryurock@github</a>です。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">フガすけ(14歳)</span></div>
<div class="highlight"><pre><span></span>jsonの表示を整形するjqを入れたいっす
</pre></div>
</div>

<p>今日はそんな<a href="http://stedolan.github.io/jq/tutorial/" rel="nofollow noopener" target="_blank">jq</a>を簡単なcookbookをknife-soloでご紹介したいと思います。</p>

<h2>
<span id="レシピ作成時間" class="fragment"></span><a href="#%E3%83%AC%E3%82%B7%E3%83%94%E4%BD%9C%E6%88%90%E6%99%82%E9%96%93"><i class="fa fa-link"></i></a>レシピ作成時間</h2>

<p>約2分</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>mac-osx（ホストOS）</li>
<li>centos6.4-x86-minimal (ゲストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>virtualbox</li>
<li>ruby 1.9.3p327 (rbenv) ※1.9.3-p286でもいけた</li>
<li>chef ※入れていない方は<code>gem install chef</code>とshellから打ってください</li>
<li>vagrant ※入れていない方は<a href="http://qiita.com/items/3cb756a9c951371a4089">chef-soloで使用するvirtualbox(vagrant)をveeweeを使用して作る</a>を参考に入れておいてください</li>
<li>git</li>
<li>knife-soloのセットアップ ※やっていない方は<a href="http://qiita.com/items/c99215e25bd2ff846207">今日作りたくなる簡単cookbook [Kim'sキッチン] yumsetup(yum-fastestmirrorにyum update添え)</a>の前準備を参考にしてやっておいてください。</li>
</ul>

<h2>
<span id="参考にしたサイト書籍" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88%E6%9B%B8%E7%B1%8D"><i class="fa fa-link"></i></a>参考にしたサイト（書籍）</h2>

<ul>
<li>
<a href="http://tatsu-zine.com/books/chef-solo" rel="nofollow noopener" target="_blank">入門ChefSolo-InfrastructureasCode-1.0.0</a>(達人出版)</li>
<li><a href="http://stedolan.github.io/jq/" rel="nofollow noopener" target="_blank">jq</a></li>
</ul>

<h2>
<span id="その１-レシピ名を決める" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%EF%BC%91-%E3%83%AC%E3%82%B7%E3%83%94%E5%90%8D%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>[その１] レシピ名を決める</h2>

<p>今回のレシピ名はjqで行きましょう</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife cookbook create jq -o site-cookbooks
</pre></div></div>

<h2>
<span id="その2-chef-repojqrecipesdefaultrbを編集" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE2-chef-repojqrecipesdefaultrb%E3%82%92%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>[その2] chef-repo/jq/recipes/default.rbを編集</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">chef-repo/jq/recipes/default.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">git</span> <span class="s2">"/tmp/jq"</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s2">"git://github.com/stedolan/jq.git"</span>
  <span class="n">reference</span> <span class="s2">"master"</span>
  <span class="n">action</span> <span class="ss">:checkout</span>
  <span class="n">user</span> <span class="s2">"root"</span>
  <span class="n">group</span> <span class="s2">"root"</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">'execute[jq_make_install]'</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="c1"># install</span>
<span class="n">execute</span> <span class="s2">"jq_make_install"</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="s2">"/tmp/jq"</span>
  <span class="n">command</span> <span class="s2">"./configure; make; make install"</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

</pre></div>
</div>

<h2>
<span id="その4rbenv-cookbookをリモート側で実行する設定を追加" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE4rbenv-cookbook%E3%82%92%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E8%A8%AD%E5%AE%9A%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>[その4]rbenv cookbookをリモート側で実行する設定を追加</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vim chef-repo/nodes/{接続名称（任意）}.json

{"run_list":[
        "jq"
]}
</pre></div></div>

<p>run_listをすでに記載している場合は追記でお願いします。<br>
またrbenvのインストールのみで問題ないならrbenvだけでも問題ないです。</p>

<h2>
<span id="その5-リモート側に実行依頼をする" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE5-%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E5%81%B4%E3%81%AB%E5%AE%9F%E8%A1%8C%E4%BE%9D%E9%A0%BC%E3%82%92%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>[その5] リモート側に実行依頼をする</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd chef-repo
knife solo cook {接続名称（任意）}

</pre></div></div>

<h2>
<span id="今日はこれで決まりjqの完成です" class="fragment"></span><a href="#%E4%BB%8A%E6%97%A5%E3%81%AF%E3%81%93%E3%82%8C%E3%81%A7%E6%B1%BA%E3%81%BE%E3%82%8Ajq%E3%81%AE%E5%AE%8C%E6%88%90%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>今日はこれで決まり「jq」の完成です</h2>

<p>resource <a href="http://docs.opscode.com/resource_common_notifications.html" rel="nofollow noopener" target="_blank">notification</a>を使った簡単なサンプルです</p>

<p>使った<a href="http://docs.opscode.com/resource.html" rel="nofollow noopener" target="_blank">Chef Resources</a></p>

<hr>

<ul>
<li><a href="http://docs.opscode.com/resource_git.html" rel="nofollow noopener" target="_blank">git</a></li>
<li><a href="http://docs.opscode.com/resource_execute.html" rel="nofollow noopener" target="_blank">execute</a></li>
<li><a href="http://docs.opscode.com/resource_common_notifications.html" rel="nofollow noopener" target="_blank">notification</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />47位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/ec143d100218af8fc5f9">php5.4でphp-test_helpersを入れてみる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-05 12:37:34</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>php-test_helpersなるものをいれなくては行けないことになった<br>
<a href="http://d.hatena.ne.jp/shimooka/20101206/1291622471" rel="nofollow noopener" target="_blank">[PHP][PECL]test_helpers拡張モジュール</a>からの引用ですと</p>

<blockquote>
<p>コンセプトとしては、ユニットテストを書けないようなレガシーコードで、ユニットテストを楽に書けるようにするための拡張モジュールのようで、ざっと機能をまとめてみると、</p>

<p>*exit/die関数の無効化やコールバックを指定できる<br>
*newオペレータの実行時にコールバックを指定できる<br>
*関数の改名</p>
</blockquote>

<p>ができるらしい。<br>
が、phpenvで入れたPHP5.4.11で入れようとしたらエラーになったのでその時のメモです</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3（ゲストOS）</li>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>php5.4以上</li>
<li>git</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="https://github.com/sebastianbergmann/php-test-helpers" rel="nofollow noopener" target="_blank">sebastianbergmann / php-test-helpers</a></li>
<li><a href="http://d.hatena.ne.jp/shimooka/20101206/1291622471" rel="nofollow noopener" target="_blank">[PHP][PECL]test_helpers拡張モジュール</a></li>
</ul>

<h2>
<span id="gitから最新を落としてこないとエラーになりますよ" class="fragment"></span><a href="#git%E3%81%8B%E3%82%89%E6%9C%80%E6%96%B0%E3%82%92%E8%90%BD%E3%81%A8%E3%81%97%E3%81%A6%E3%81%93%E3%81%AA%E3%81%84%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%99%E3%82%88"><i class="fa fa-link"></i></a>gitから最新を落としてこないとエラーになりますよ！！</h2>

<p>peclのtgzから落とすとmakeでこのエラーに悩まされた</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$make


/bin/sh /tmp/test_helpers-1.0.0/libtool --mode=compile cc  -I. -I/tmp/test_helpers-1.0.0 -DPHP_ATOM_INC -I/tmp/test_helpers-1.0.0/include -I/tmp/test_helpers-1.0.0/main -I/tmp/test_helpers-1.0.0 -I/root/.phpenv/versions/5.4.11/include/php -I/root/.phpenv/versions/5.4.11/include/php/main -I/root/.phpenv/versions/5.4.11/include/php/TSRM -I/root/.phpenv/versions/5.4.11/include/php/Zend -I/root/.phpenv/versions/5.4.11/include/php/ext -I/root/.phpenv/versions/5.4.11/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /tmp/test_helpers-1.0.0/test_helpers.c -o test_helpers.lo 
mkdir .libs
 cc -I. -I/tmp/test_helpers-1.0.0 -DPHP_ATOM_INC -I/tmp/test_helpers-1.0.0/include -I/tmp/test_helpers-1.0.0/main -I/tmp/test_helpers-1.0.0 -I/root/.phpenv/versions/5.4.11/include/php -I/root/.phpenv/versions/5.4.11/include/php/main -I/root/.phpenv/versions/5.4.11/include/php/TSRM -I/root/.phpenv/versions/5.4.11/include/php/Zend -I/root/.phpenv/versions/5.4.11/include/php/ext -I/root/.phpenv/versions/5.4.11/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /tmp/test_helpers-1.0.0/test_helpers.c  -fPIC -DPIC -o .libs/test_helpers.o
/tmp/test_helpers-1.0.0/test_helpers.c: In function ‘new_handler’:
/tmp/test_helpers-1.0.0/test_helpers.c:87: error: ‘znode_op’ has no member named ‘u’
</pre></div></div>

<p>Cは読めないって。。。。</p>

<h2>
<span id="ググること２時間" class="fragment"></span><a href="#%E3%82%B0%E3%82%B0%E3%82%8B%E3%81%93%E3%81%A8%EF%BC%92%E6%99%82%E9%96%93"><i class="fa fa-link"></i></a>ググること２時間</h2>

<p>gitがあることに気づく！！</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd /tmp
git clone https://github.com/sebastianbergmann/php-test-helpers.git
cd php-test-helpers
phpize
./configure
make
make test
make install 
</pre></div></div>

<h2>
<span id="設定" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>設定</h2>

<p>注意が必要でzend_extensionがロードしているPHPの場合はそれより下にモジュールのロードをしないとエラーになるそうです。公式に書いてましたが気づかずに２０分ほどハマりました。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">/root/.phpenv/versions/5.4.11/etc/conf.d/xdebug.ini</span></div>
<div class="highlight"><pre><span></span> <span class="nx">zend_extension</span><span class="o">=</span><span class="s2">"/root/.phpenv/versions/5.4.11/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so"</span>
 <span class="nx">html_errors</span><span class="o">=</span><span class="nx">on</span>
<span class="c1"># 下記を追加</span>
 <span class="nx">zend_extension</span><span class="o">=/</span><span class="nx">root</span><span class="o">/.</span><span class="nx">phpenv</span><span class="o">/</span><span class="nx">versions</span><span class="o">/</span><span class="mf">5.4</span><span class="o">.</span><span class="mi">11</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">php</span><span class="o">/</span><span class="nx">extensions</span><span class="o">/</span><span class="nx">no</span><span class="o">-</span><span class="nx">debug</span><span class="o">-</span><span class="nx">non</span><span class="o">-</span><span class="nx">zts</span><span class="o">-</span><span class="mi">20100525</span><span class="o">/</span><span class="nx">test_helpers</span><span class="o">.</span><span class="nx">so</span>
<span class="o">~</span>
</pre></div>
</div>

<p>PATHなどは適時自分の環境に置き換えてください。自分はphpenvでいれたディレクトリが<br>
/root/.phpenv/versions/5.4.11/lib/php/extensions/no-debug-non-zts-20100525/だったのでそこに入れてます。phpの拡張モジュールのファイル先を指定すれば大丈夫です。</p>

<p>またxdebug.iniを編集していますがxdebugを入れてなければ新規で作成しても多分問題ないと思います。</p>

<h2>
<span id="nginx-or-apacheの再起動" class="fragment"></span><a href="#nginx-or-apache%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginx or apacheの再起動</h2>

<p>webサーバーを再起動しましょう</p>

<h2>
<span id="php-fpmの再起動" class="fragment"></span><a href="#php-fpm%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>php-fpmの再起動</h2>

<p>php-fpmを使っているならば再起動しましょう</p>

<h2>
<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h2>

<p>実際に使ってみる</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">test_helper.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nx">set_exit_overload</span><span class="p">(</span><span class="k">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span> <span class="p">});</span>
<span class="k">exit</span><span class="p">;</span>
<span class="k">print</span> <span class="s1">'We did not exit.'</span><span class="p">;</span>
<span class="nx">unset_exit_overload</span><span class="p">();</span>
<span class="k">exit</span><span class="p">;</span>
<span class="k">print</span> <span class="s1">'We exited and this will not be printed.'</span><span class="p">;</span>
</pre></div>
</div>

<p>exitをかけているがスルーしてWe did not exit.が表示されればOKです。</p>

<p>test_helpersがgitに移行されていてpeclとかは既に古くなってるのでご注意ください。これだいぶハマりました。。。。。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />48位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/bb412e02981168e49a2d">Ansible-installerってのを作ってみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-26 17:09:45</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[Ansible]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://github.com/ryurock/ansible-installer" rel="nofollow noopener" target="_blank">ryurock/ansible-installer</a></p>

<p><a href="http://www.ansible.com/home" rel="nofollow noopener" target="_blank">Ansible</a>の関係でpythonを入れる時に<a href="https://github.com/yyuu/pyenv-installer" rel="nofollow noopener" target="_blank">yyuu/pyenv-installer</a>ってのを見つけて、にゃるほどと思いansibleを入れる時も同じ要領で作っておけば楽チンだと思いまして作ってみました。</p>

<p>作ったばっかなので自己責任でお願いします。(キリッ!!)</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>osx</li>
<li>Linux</li>
</ul>

<h2>
<span id="注意事項" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"><i class="fa fa-link"></i></a>注意事項</h2>

<ul>
<li>Pythonのインストールで<a href="https://github.com/yyuu/pyenv-installer" rel="nofollow noopener" target="_blank">pyenv-installer</a>を使用しています。pyenvを既にお使いの方はpython2.6.9がインストールされますのでご注意ください。globalも2.6.9になります。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="https://github.com/yyuu/pyenv-installer" rel="nofollow noopener" target="_blank">yyuu/pyenv-installer</a></li>
</ul>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>README.mdどおりでいけます。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>curl https://raw.github.com/ryurock/ansible-installer/master/bin/setup <span class="p">|</span> bash
<span class="c1"># OSX</span>
<span class="nb">source</span> ~/.bashrc
<span class="c1"># Linux</span>
<span class="nb">source</span> /etc/profile
</pre></div></div>

<h2>
<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h2>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>ansible --version
ansible <span class="m">1</span>.4.5
</pre></div></div>

<p>Ansibleとか使ってみたい〜とか思いましたら使ってみてください</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />49位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/dae3649e412c323015c0">virtualbox(centos)にphpmyadmin+nginxでインストールする方法メモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-28 23:49:00</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[MySQL]</b> <b>[nginx]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>nginxでphpmyadminを設定する方法のメモ</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3（ゲストOS）</li>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>nginx ※入れてない方は<a href="http://qiita.com/items/40b527c390f068985f75">virtualbox(centos)でnginxをwebsocketを使用出来る状態でインストールする方法メモ</a>を参照してください</li>
<li>php-build+phpenvでPHPをインストール済みであること。インストールしていない場合は<a href="http://qiita.com/items/7d031440bb174a55a6a1">virtualbox(centos)でphpenv+php-buildインストールメモ(5.3,5.4変更確認まで)</a>を参照してください。</li>
<li>mysql ※入れていない方は<a href="http://qiita.com/items/73df4ab45c96092b63b8">virtualbox(centos)でMYSQLインストールメモ(mysqld_multiで複数インスタンス起動まで)</a>を参照してください。</li>
</ul>

<h2>
<span id="参考にしたサイト" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>参考にしたサイト</h2>

<ul>
<li><a href="http://centossrv.com/phpmyadmin.shtml" rel="nofollow noopener" target="_blank">MySQL用GUI設定ツール導入(phpMyAdmin)</a></li>
</ul>

<h2>
<span id="nginxの設定を追加する" class="fragment"></span><a href="#nginx%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>nginxの設定を追加する</h2>

<p>ソースからコンパイルしている場合は/usr/local/nginx/conf/nginx.confとか<br>
yumでインストールしている場合は<br>
/etc/nginx/conf/conf.d/default.confとかにあります。<br>
httpディレクティブの項目に追加するだけです。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/usr/local/nginx/conf/nginx.conf</span></div>
<div class="highlight"><pre><span></span>http {
#下記の項目を追加
    server {
        listen       80;
        server_name  lo.pma.org;
        root   /home/web/lo.pma.org/www; #ドキュメントルートは適時変更してください
        index  index.php index.html index.htm;
        location ~ \.php$ {
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /home/web/lo.pma.org/www$fastcgi_script_name; #ドキュメントルートは適時変更してください
            include        fastcgi_params;
        }
    }
}
</pre></div>
</div>

<h2>
<span id="phpmyadminのインストール" class="fragment"></span><a href="#phpmyadmin%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>phpMyAdminのインストール</h2>

<p>svnから一発で</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#ココらへんの設定は各自で
cd /home/web/lo.pma.org/www
svn checkout https://phpmyadmin.svn.sourceforge.net/svnroot/phpmyadmin/tags/STABLE/phpMyAdmin ./
</pre></div></div>

<h2>
<span id="configファイルの編集" class="fragment"></span><a href="#config%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>configファイルの編集</h2>

<p>デフォルトファイルは残しておきましょうね</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/home/web/lo.pma.org/www/</span></div>
<div class="highlight"><pre><span></span>cp /home/web/lo.pma.org/www/config.sample.inc.php /home/web/lo.pma.org/www/config.inc.php
</pre></div>
</div>

<p>編集</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">/home/web/lo.pma.org/www/config.inc.php</span></div>
<div class="highlight"><pre><span></span><span class="c1">#修正前</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'blowfish_secret'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="c1">#修正後</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'blowfish_secret'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'ojwelolk6gmsswpgqosameeBmtxswelzamM4wdfcfolbz&gt;'</span><span class="p">;</span> <span class="c1">#適当な42文字</span>
<span class="c1">#修正前</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'host'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="c1">#修正後</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'host'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'127.0.0.1'</span><span class="p">;</span>

<span class="c1">#追加</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Server'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'port'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'3306'</span><span class="p">;</span>
</pre></div>
</div>

<p>上記の設定の追加はmysqld_multiで複数ポートで運用している場合です。そうではない場合はblowfish_secretだけでOKです</p>

<h2>
<span id="nginxの再起動" class="fragment"></span><a href="#nginx%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginxの再起動</h2>

<p>動いていなければstartだけOKです。ちなみにrestartだと動かなかったです。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/nginx stop
nginx を停止中:                                            [  OK  ]


/etc/init.d/nginx start
nginx を起動中:                                            [  OK  ]
</pre></div></div>

<h2>
<span id="hostos側のhostsを追加" class="fragment"></span><a href="#hostos%E5%81%B4%E3%81%AEhosts%E3%82%92%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>hostOS側のhostsを追加</h2>

<p>ローカル環境だと思うので</p>

<h3>
<span id="ifconfigで自分のipを調べる" class="fragment"></span><a href="#ifconfig%E3%81%A7%E8%87%AA%E5%88%86%E3%81%AEip%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>ifconfigで自分のipを調べる</h3>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ifconfig

#下記の項目(inet)がどこかにあるのでメモしておく（デフォルトだと192.168.xx.xxx）なはず
inet addr:192.168.56.101
</pre></div></div>

<h3>
<span id="hostsファイルの編集" class="fragment"></span><a href="#hosts%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>hostsファイルの編集</h3>

<p>※windowsの場合は「windows host」とかでググってください。<br>
今回はmacの場合で説明します</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">/etc/hosts</span></div>
<div class="highlight"><pre><span></span>sudo vim /etc/hosts

192.168.56.101  lo.jenkins.org #ifconfigで調べたipとホストOSから見る場合のvirtualhostを指定する
</pre></div>
</div>

<h2>
<span id="動作確認" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>動作確認</h2>

<p>hostsで書いたアドレスにアクセス<br>
今回は<a href="http://lo.pma.org" rel="nofollow noopener" target="_blank">http://lo.pma.org</a>にアクセスしてphpmyadminのログイン画面が見えればOK!!</p>

<p>大体10分くらいでできました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />50位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/1e2404ab4b0fc28d5fa2">virtualbox centos6にnginxを3分でインストールする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-03 23:47:02</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[nginx]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">centos6.3</span></div>
<div class="highlight"><pre><span></span>sudo rpm -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm

&gt;yum list nginx 
Available Packages
nginx.x86_64                 1.2.1-1.el6.ngx                  nginx

&gt;sudo yum install nginx
</pre></div>
</div>

<p>以上</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />51位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/a95b05cbcfc3f4bb60e5">mongodbでapacheのアクセスログをISODateに変換する関数</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-17 18:25:02</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[MongoDB]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>apacheのリクエスト時間のデフォルトの日付フォーマットをISODateに渡せるように変換スクリプトを書いてみた</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">apacheDate2ISODate.js</span></div>
<div class="highlight"><pre><span></span>    apacheDate2ISODate = function (apacheDate)
    {

        rawStr = apacheDate.replace(/^(\[)/, "").replace(/\]/, "")
        dateArr = rawStr.split(" ");

        dateSeparate  = dateArr[0].split('/')
        dateSeparate2 = dateSeparate[2].split(':')

        day   = dateSeparate[0]
        month = dateSeparate[1]
        year  = dateSeparate2[0]
        hours = dateSeparate2[1]
        minute = dateSeparate2[2]
        second = dateSeparate2[3]
        date   = dateSeparate2[1] + dateSeparate2[2] + dateSeparate2[3]

        DateString = month + " " + day + " " + year + " " + hours + ":" + minute + ":" + second
        convertDate = new Date(DateString)

        date     = ( convertDate.getDate()   &lt; 10 )  ? '0' + convertDate.getDate()    : convertDate.getDate()
        month    = ( convertDate.getMonth()   &lt; 10 ) ? '0' + convertDate.getMonth()   : convertDate.getMonth()
        hours    = ( convertDate.getHours()   &lt; 10 ) ? '0' + convertDate.getHours()   : convertDate.getHours()
        minute   = ( convertDate.getMinutes() &lt; 10 ) ? '0' + convertDate.getMinutes() : convertDate.getMinutes()
        second   = ( convertDate.getSeconds() &lt; 10 ) ? '0' + convertDate.getSeconds() : convertDate.getSeconds()

        dateStr = convertDate.getFullYear() + '-' + month + '-' + date + ' ' + hours + ':' + minute + ':' + second

        return ISODate(dateStr)
    }
</pre></div>
</div>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>apacheDate2ISODate(apacheのリクエスト時間)
</pre></div></div>

<p>多分合ってると思う。。。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />52位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/b2ce06e8f2ee0237d723">virtualbox(centos)にphpenvで入れたphpにPECL::memcachedをインストールする方法メモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-01 17:01:23</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>phpenvで入れたphpにpeclのmemcachedをインストールするメモ</p>

<h2>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h2>

<ul>
<li>centos6.3（ゲストOS）</li>
<li>macosx10.8(ホストOS)</li>
</ul>

<h2>
<span id="事前準備に必要なもの" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>事前準備に必要なもの</h2>

<ul>
<li>phpenvの環境 ※作っていない場合はpecl installとかでサクッとインストールしてください。</li>
<li>remiのリポジトリが必要です。入れていない場合は<a href="http://qiita.com/items/662e41376efa97251575">外部リポジトリの追加（remi,epel）</a>を参考にして入れてみてください。</li>
</ul>

<h2>
<span id="必要なものをインストールする" class="fragment"></span><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>必要なものをインストールする</h2>

<p>最新のバージョンのPECL::memcached 2.1.0の場合はデフォルトのcentosのリポジトリのlibmemcachedだとエラーになったのでremiから取ってくる。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>yum install memcached memcached-devel
yum install libmemcached libmemcached-devel enablerepo=remi
</pre></div></div>

<h2>
<span id="peclからmemcachedを取得する" class="fragment"></span><a href="#pecl%E3%81%8B%E3%82%89memcached%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>peclからmemcachedを取得する</h2>

<div class="code-frame" data-lang="shell：/tmp"><div class="highlight"><pre><span></span>cd /tmp
wget http://pecl.php.net/get/memcached-2.1.0.tgz
tar zxvf memcached-2.1.0.tgz 
cd memcached-2.1.0
</pre></div></div>

<h2>
<span id="phpizeでコンパイル" class="fragment"></span><a href="#phpize%E3%81%A7%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB"><i class="fa fa-link"></i></a>phpizeでコンパイル</h2>

<p>いつもどおり</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">shell：/tmp/memcached-2.1.0</span></div>
<div class="highlight"><pre><span></span>cd /tmp/memcached-2.1.0
phpize
./configure
make
make test
make install
</pre></div>
</div>

<h2>
<span id="memcachedのサービスの起動自動起動" class="fragment"></span><a href="#memcached%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E8%B5%B7%E5%8B%95%E8%87%AA%E5%8B%95%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>memcachedのサービスの起動(自動起動)</h2>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>/etc/init.d/memcached start
chkconfig memcached on
</pre></div></div>

<h2>
<span id="nginx-or-httpd-の再起動" class="fragment"></span><a href="#nginx-or-httpd-%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>nginx or httpd の再起動</h2>

<p>php-fpmならそっちも再起動したほうがいいかも</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#nginxの場合
/etc/init.d/nginx stop
/etc/init.d/nginx start
#httpdの場合
/etc/init.d/httpd stop
/etc/init.d/httpd start
</pre></div></div>

<p>phpinfo()とかで見る<br>
以上</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />53位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/b484c9188ff216bc7b96">apacheのrequest_dateをawkでdatetimeフォーマット形式を変換する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-21 11:34:06</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[awk]</b> <b>[shell]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>awkって便利ですよね。<br>
apacheログのrequest_dateって以外と自力でパースすると面倒臭っかたのでメモ<br>
（正規表現は自信がないのでこっちのほうがはやんいじゃねぇ？）ってツッコミ大歓迎です。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">access_log.awk</span></div>
<div class="highlight"><pre><span></span>{
    request_date = $4 $5
    #両端にある[]を除去する
    req_length = length(request_date);
    request_date = substr(request_date, 2, req_length)
    request_date = substr(request_date, 1, req_length - 2 )
    #print request_date

    split(request_date, arr, "/");
    day = arr[1]
    month = arr[2]
    #月の英字月を数字に変換
    sub(/(January|Jan|JANUARY|JAN)/, "01", month)
    sub(/(February|Feb|FEBRUARY|FEB)/, "02", month)
    sub(/(March|Mar|MARCH|MAR)/, "03", month)
    sub(/(April|Apr|APRIL|APR)/, "04", month)
    sub(/(May|MAY)/, 05, month)
    sub(/(June|Jun|JUNE|JUN)/, "06", month)
    sub(/(July|Jul|JULY|JUL)/, "07", month)
    sub(/(August|Aug|AUGUST|AUG)/, "08", month)
    sub(/(September|Sep|SEPTEMBER|SEP)/, "09", month)
    sub(/(October|Oct|OCTOBER|OCT)/, "10", month)
    sub(/(November|Nov|NOVEMBER|NOV)/, "11", month)
    sub(/(December|Dec|DECEMBER|DEC)/, "12", month)

    split(arr[3], arr2, ":");
    year = arr2[1]
    hour = arr2[2]
    minute = arr2[3]
    split(arr2[4], arr3, "+")
    second = arr3[1]
    request_date = year "-" month "-" day " " hour ":" minute ":" second
}
{
    method = $6
    path = $7
    code = $9
}
#tsvだとimportとかしやすいのでお好みで
{print request_date "\t" method"\t"path "\t"code}
</pre></div>
</div>

<p>使い方</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>#画像,css,jsは除外してます
cat -r /path/to/access_log | grep -v .jpg | grep -v .png | grep -v .gif | grep -v .css | grep -v .js | awk -f access_log.awk
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>ryurockさんの<br />54位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/ryurock/items/2c9be64dd329e39bd670">mongo shellで書いたjavascriptをmongoimportでimportできるjsonに変換する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-20 11:08:50</center>
	</td>
	<td style="width:200px;">
		@ryurock<br />(フリーランス 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/5564/profile-images/1473682090">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[MongoDB]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://api.mongodb.org/js/current/symbols/_global_.html#printjson" rel="nofollow noopener" target="_blank">mongodb API</a>に書いてあった</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">hoge.js</span></div>
<div class="highlight"><pre><span></span>hoge = {fuga : "opopop"}
jsononeline(hoge)

</pre></div>
</div>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mongo --quiet host名/db名 実行するjavascript.js &gt; 書き出したい.js
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
