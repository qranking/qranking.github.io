<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (tenntenn)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (tenntenn さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1956</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/0e33a4959250d1a55045">Go言語の初心者が見ると幸せになれる場所　#golang</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-11 11:54:21</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="本家サイトと日本語訳サイト" class="fragment"></span><a href="#%E6%9C%AC%E5%AE%B6%E3%82%B5%E3%82%A4%E3%83%88%E3%81%A8%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%A8%B3%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>本家サイトと日本語訳サイト</h1>

<h2>
<span id="本家サイト" class="fragment"></span><a href="#%E6%9C%AC%E5%AE%B6%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a><a href="http://golang.org/" rel="nofollow noopener" target="_blank">本家サイト</a>
</h2>

<p>標準ライブラリの使い方はここを見ればよい。<br>
APIドキュメントからソースが簡単に見れるので、勉強になる。</p>

<h2>
<span id="go-wiki" class="fragment"></span><a href="#go-wiki"><i class="fa fa-link"></i></a><a href="https://github.com/golang/go/wiki" rel="nofollow noopener" target="_blank">Go Wiki</a>
</h2>

<p><a href="https://github.com/golang/go/wiki/SliceTricks" rel="nofollow noopener" target="_blank">SliceTrics</a>など，初心者向けの情報があるのでチェックするとよい．少し情報が古いところもある。</p>

<h2>
<span id="golang-jporg" class="fragment"></span><a href="#golang-jporg"><i class="fa fa-link"></i></a><a href="http://golang-jp.org/" rel="nofollow noopener" target="_blank">golang-jp.org</a>
</h2>

<p>本家サイトを日本語に翻訳しているサイト．情報は新しいが，一部未翻訳の箇所あり．翻訳プロジェクトはgithubで管理されているので，翻訳に<a href="https://github.com/gophersjp/go/wiki/%E7%BF%BB%E8%A8%B3%E5%8D%94%E5%8A%9B%E3%83%95%E3%83%AD%E3%83%BC" rel="nofollow noopener" target="_blank">協力</a>もできる．</p>

<h1>
<span id="入門" class="fragment"></span><a href="#%E5%85%A5%E9%96%80"><i class="fa fa-link"></i></a>入門</h1>

<h2>
<span id="a-tour-of-go" class="fragment"></span><a href="#a-tour-of-go"><i class="fa fa-link"></i></a><a href="http://go-tour-jp.appspot.com/#1" rel="nofollow noopener" target="_blank">A Tour of Go</a>
</h2>

<p>A Tour of Goの日本語版。Go言語の機能の説明を一通り網羅している。練習問題が若干初心者には厳しい（ニュートン法とか）。<br>
追記：英語版は改定されてて，取っ付きにくい練習問題はなくなっているらしい。</p>

<h2>
<span id="whispering-gophers" class="fragment"></span><a href="#whispering-gophers"><i class="fa fa-link"></i></a><a href="http://whispering-gophers.appspot.com/talk.slide#1" rel="nofollow noopener" target="_blank">Whispering Gophers</a>
</h2>

<p>チャットアプリを作る順々に作っていけるサンプル．channelやgoroutineについて学べる．<br>
リポジトリ：<a href="https://code.google.com/p/whispering-gophers/" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/whispering-gophers/</a></p>

<h2>
<span id="はじめてのgo" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%A6%E3%81%AEgo"><i class="fa fa-link"></i></a><a href="http://gihyo.jp/dev/feature/01/go_4beginners" rel="nofollow noopener" target="_blank">はじめてのGo</a>
</h2>

<p>Jxckさんの入門記事です。非常に分かりやすいので，入門としておすすめ。</p>

<h2>
<span id="go-web-プログラミング" class="fragment"></span><a href="#go-web-%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a><a href="http://astaxie.gitbooks.io/build-web-application-with-golang/content/ja/index.html" rel="nofollow noopener" target="_blank">Go Web プログラミング</a>
</h2>

<p>astaxieさんのGoによるWebプログラミング入門の日本語訳です。</p>

<h1>
<span id="よいコードを書くために見た方がよさそうなところ" class="fragment"></span><a href="#%E3%82%88%E3%81%84%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%9F%E3%82%81%E3%81%AB%E8%A6%8B%E3%81%9F%E6%96%B9%E3%81%8C%E3%82%88%E3%81%95%E3%81%9D%E3%81%86%E3%81%AA%E3%81%A8%E3%81%93%E3%82%8D"><i class="fa fa-link"></i></a>よいコードを書くために見た方がよさそうなところ</h1>

<h2>
<span id="go-proverbs" class="fragment"></span><a href="#go-proverbs"><i class="fa fa-link"></i></a><a href="https://go-proverbs.github.io/" rel="nofollow noopener" target="_blank">Go Proverbs</a>
</h2>

<p>Rob Pike氏のGoの格言をまとめたサイト。Gophers Slackのロード画面にも出てくる。</p>

<h2>
<span id="go-code-review-comments日本語訳" class="fragment"></span><a href="#go-code-review-comments%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%A8%B3"><i class="fa fa-link"></i></a><a href="https://github.com/golang/go/wiki/CodeReviewComments" rel="nofollow noopener" target="_blank">Go Code Review Comments</a>（<a href="http://qiita.com/knsh14/items/8b73b31822c109d4c497" id="reference-0896e6a5403568aedd36">日本語訳</a>)</h2>

<p>Goのコードを書く上で、気をつけることがまとめられているサイト。公式ドキュメントの<a href="https://golang.org/doc/effective_go.html" rel="nofollow noopener" target="_blank">Effective Go</a>をまとめたものが多い。</p>

<h1>
<span id="コミュニティ" class="fragment"></span><a href="#%E3%82%B3%E3%83%9F%E3%83%A5%E3%83%8B%E3%83%86%E3%82%A3"><i class="fa fa-link"></i></a>コミュニティ</h1>

<h2>
<span id="golang-nuts" class="fragment"></span><a href="#golang-nuts"><i class="fa fa-link"></i></a><a href="https://groups.google.com/forum/#!forum/golang-nuts" rel="nofollow noopener" target="_blank">golang-nuts</a>
</h2>

<p>Google Groups上のグループ。Go言語の情報はここにほとんど集まっている。但し英語。</p>

<h2>
<span id="go" class="fragment"></span><a href="#go"><i class="fa fa-link"></i></a><a href="https://plus.google.com/communities/114112804251407510571" rel="nofollow noopener" target="_blank">Go+</a>
</h2>

<p>英語のGoogle+上のコミュニティ。golang-nutsよりは情報が少ないが、Google+上なので情報をキャッチしやすい。</p>

<h2>
<span id="golang-jpgoogle" class="fragment"></span><a href="#golang-jpgoogle"><i class="fa fa-link"></i></a><a href="https://plus.google.com/communities/107075098212007233819" rel="nofollow noopener" target="_blank">Golang JP(Google+)</a>
</h2>

<p>Google+上の日本のGo言語コミュニティ。日本語なので、質問しやすい。日本のGo言語のイベントの情報等もここに流れる。</p>

<h2>
<span id="lingr-go言語" class="fragment"></span><a href="#lingr-go%E8%A8%80%E8%AA%9E"><i class="fa fa-link"></i></a><a href="http://lingr.com/room/golang" rel="nofollow noopener" target="_blank">Lingr-Go言語</a>
</h2>

<p>Go言語の話題を話すチャットルーム。<br>
リアルタイムで聞けます！</p>

<h2>
<span id="slack-gophers" class="fragment"></span><a href="#slack-gophers"><i class="fa fa-link"></i></a><a href="http://blog.gopheracademy.com/gophers-slack-community/" rel="nofollow noopener" target="_blank">Slack-Gophers</a>
</h2>

<p>Slackのコミュニティです。<code>#japan</code>や<code>#tokyo</code>には日本の方がいるので，日本語で質問しやすい。この他にも分野や地域ごとに部屋があるので，いろいろ部屋を見るとよい。</p>

<h1>
<span id="ドキュメントやまとめサイト" class="fragment"></span><a href="#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%84%E3%81%BE%E3%81%A8%E3%82%81%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>ドキュメントやまとめサイト</h1>

<h2>
<span id="go-search" class="fragment"></span><a href="#go-search"><i class="fa fa-link"></i></a><a href="http://go-search.org/" rel="nofollow noopener" target="_blank">Go Search</a>
</h2>

<p>Go言語のライブラリを探せる．検索結果にgodoc.orgやGo Walkerへのリンクがある．<br>
どういうライブラリがよく利用されているかわかるので便利．</p>

<h2>
<span id="godocorg" class="fragment"></span><a href="#godocorg"><i class="fa fa-link"></i></a><a href="http://godoc.org/" rel="nofollow noopener" target="_blank">godoc.org</a>
</h2>

<p>様々なGo言語のライブラリのAPIドキュメントを生成するサービス。<br>
URLの後ろにライブラリのインポートパスを入れると自動でAPIドキュメントが生成、公開される。トップページのPopular Packagesを眺めるだけで、人気のパッケージが分かる。</p>

<h2>
<span id="go-walker" class="fragment"></span><a href="#go-walker"><i class="fa fa-link"></i></a><a href="https://gowalker.org/" rel="nofollow noopener" target="_blank">Go Walker</a>
</h2>

<p>APIドキュメントを生成するサービス．個人的には，godoc.orgより使いやすい．</p>

<h2>
<span id="golang-samples" class="fragment"></span><a href="#golang-samples"><i class="fa fa-link"></i></a><a href="https://github.com/golang-samples" rel="nofollow noopener" target="_blank">golang-samples</a>
</h2>

<p>Go言語のサンプルを集めたGithubのOrganization。誰でも参加して、新しいレポジトリを追加できる。参加したければ、<a href="mailto:golang.samples@gmail.com" class="autolink">golang.samples@gmail.com</a> にメールを送れば良い。pull requestを送るだけでもよい。</p>

<h2>
<span id="goz" class="fragment"></span><a href="#goz"><i class="fa fa-link"></i></a><a href="http://goz.hexacosa.net/" rel="nofollow noopener" target="_blank">goz</a>
</h2>

<p>Go言語の熱い記事をチェックできるサイト．</p>

<h2>
<span id="go-by-example日本語訳" class="fragment"></span><a href="#go-by-example%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%A8%B3"><i class="fa fa-link"></i></a><a href="https://gobyexample.com/" rel="nofollow noopener" target="_blank">Go by Example</a>（<a href="https://oohira.github.io/gobyexample-jp/" rel="nofollow noopener" target="_blank">日本語訳</a>）</h2>

<p>豊富なサンプルを見つけることができるサイト．</p>

<h2>
<span id="go-tutorial-dot-net-perls" class="fragment"></span><a href="#go-tutorial-dot-net-perls"><i class="fa fa-link"></i></a><a href="http://www.dotnetperls.com/go" rel="nofollow noopener" target="_blank">Go Tutorial: Dot Net Perls</a>
</h2>

<p>基本的な機能を具体的な例と実行結果を提示しているサイト．<br>
<code>regexp</code>パッケージや<code>strings</code>パッケージのサンプルがあって分かりやすい．</p>

<h1>
<span id="便利サイト便利ツール" class="fragment"></span><a href="#%E4%BE%BF%E5%88%A9%E3%82%B5%E3%82%A4%E3%83%88%E4%BE%BF%E5%88%A9%E3%83%84%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>便利サイト，便利ツール</h1>

<h2>
<span id="go-playground" class="fragment"></span><a href="#go-playground"><i class="fa fa-link"></i></a><a href="http://play.golang.org/" rel="nofollow noopener" target="_blank">Go Playground</a>
</h2>

<p>Web上でGo言語を実行できるサイト。Go言語をインストールする前にここで試してみるといいかもしれない。</p>

<h2>
<span id="goenv" class="fragment"></span><a href="#goenv"><i class="fa fa-link"></i></a><a href="https://bitbucket.org/ymotongpoo/goenv" rel="nofollow noopener" target="_blank">goenv</a>
</h2>

<p>プロジェクトごとにGOPATHを設定できるツール．</p>

<h2>
<span id="dash" class="fragment"></span><a href="#dash"><i class="fa fa-link"></i></a><a href="https://itunes.apple.com/us/app/dash-docs-snippets/id458034879?mt=12" rel="nofollow noopener" target="_blank">Dash</a>
</h2>

<p>色々な言語のドキュメントをすばやく閲覧したり、スニペットを登録できるMacのアプリ。Go言語のドキュメントもある。</p>

<h2>
<span id="お気楽-go-言語プログラミング入門" class="fragment"></span><a href="#%E3%81%8A%E6%B0%97%E6%A5%BD-go-%E8%A8%80%E8%AA%9E%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E5%85%A5%E9%96%80"><i class="fa fa-link"></i></a><a href="http://www.geocities.jp/m_hiroi/golang/index.html" rel="nofollow noopener" target="_blank">お気楽 Go 言語プログラミング入門</a>
</h2>

<p>Go言語の文法や演習問題など網羅的に解説してあるサイト。</p>

<h1>
<span id="環境構築エディタの使い方" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>環境構築・エディタの使い方</h1>

<ul>
<li>vim : <a href="http://mattn.kaoriya.net/software/vim/20130531000559.htm" rel="nofollow noopener" target="_blank">Vimを使ったGo言語開発手法</a>
</li>
<li>Emacs : <a href="http://ymotongpoo.hatenablog.com/entry/2013/07/06/154448" rel="nofollow noopener" target="_blank">Emacsを使ったGo言語開発手法（2013.07版）</a>
</li>
<li>LiteIDE: <a href="http://python.matrix.jp/2013/05/09/go_start1.html" rel="nofollow noopener" target="_blank">go言語の始め方(1)</a>
</li>
</ul>

<h1>
<span id="書籍" class="fragment"></span><a href="#%E6%9B%B8%E7%B1%8D"><i class="fa fa-link"></i></a>書籍</h1>

<p>参考：<a href="https://github.com/golang/go/wiki/Books#japanese" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/golang/go/wiki/Books#japanese</a></p>

<ul>
<li><a href="http://www.amazon.co.jp/%E3%81%AF%E3%81%98%E3%82%81%E3%81%A6%E3%81%AE%E3%80%8CGo%E8%A8%80%E8%AA%9E%E3%80%8D-I%E3%83%BBO-BOOKS-%E8%8C%A8%E6%9C%A8-%E9%9A%86%E5%BD%B0/dp/4777515591" rel="nofollow noopener" target="_blank">はじめての「Go言語」</a></li>
<li><a href="http://www.amazon.co.jp/Go%E8%A8%80%E8%AA%9E%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E5%85%A5%E9%96%80on-Google-App-Engine-%E6%A8%AA%E5%B1%B1/dp/4798031801" rel="nofollow noopener" target="_blank">Go言語プログラミング入門on Google App Engine</a></li>
<li><a href="http://www.amazon.co.jp/%E3%81%AF%E3%81%98%E3%82%81%E3%81%A6%E3%81%AEGoogle-App-Engine-Go%E8%A8%80%E8%AA%9E%E7%B7%A8-BOOKS/dp/4777516601" rel="nofollow noopener" target="_blank">はじめてのGoogle App Engine Go言語編</a></li>
<li><a href="http://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9EGo%E3%83%95%E3%83%AC%E3%83%BC%E3%82%BA%E3%83%96%E3%83%83%E3%82%AF-David-Chisnall/dp/486401096X" rel="nofollow noopener" target="_blank">プログラミング言語Goフレーズブック</a></li>
<li>
<a href="http://www.amazon.co.jp/%E5%9F%BA%E7%A4%8E%E3%81%8B%E3%82%89%E3%82%8F%E3%81%8B%E3%82%8B-Go%E8%A8%80%E8%AA%9E-%E5%8F%A4%E5%B7%9D-%E6%98%87/dp/4863541171" rel="nofollow noopener" target="_blank">基礎からわかる Go言語</a>（<a href="http://www.c-r.com/book/detail/1018" rel="nofollow noopener" target="_blank">改訂2版</a>）</li>
<li><a href="http://www.golang-book.com/" rel="nofollow noopener" target="_blank">An Introduction to Programming in Go</a></li>
<li><a href="https://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9EGo-ADDISON-WESLEY-PROFESSIONAL-COMPUTING-Donovan/dp/4621300253" rel="nofollow noopener" target="_blank">プログラミング言語Go</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>362</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/b8b27e32c28f7569f41a">Go言語でWebAppの開発に必要なN個のこと</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-11 01:04:51</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://d.hatena.ne.jp/gfx/20130909/1378741015" rel="nofollow noopener" target="_blank">元ネタ</a></p>

<p>あるプログラミング言語で実際にWebAppを開発できるようになるまで、何が必要だろうか。言語仕様の習得は終えているとしよう。おそらく、最低限以下のような知識が必要だと思われる。とりあえずGo言語について知っていることを書いた。</p>

<h2>
<span id="パッケージマネージャ" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3"><i class="fa fa-link"></i></a>パッケージマネージャ</h2>

<p>標準でついてるgoツールを使おう。必要なライブラリはリポジトリから、go getで取ってこよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go get &lt;リポジトリ&gt;
</pre></div></div>

<ul>
<li><a href="http://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies</a></li>
</ul>

<h2>
<span id="アプリケーションサーバ" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B5%E3%83%BC%E3%83%90"><i class="fa fa-link"></i></a>アプリケーションサーバ</h2>

<p>標準パッケージの<a href="http://golang.org/pkg/net/http" rel="nofollow noopener" target="_blank">net/httpパッケージ</a>を使えばhttpサーバを動かすことができる。apacheやnginxで動かしたかったら、標準パッケージの<a href="http://golang.org/pkg/net/http/cgi/" rel="nofollow noopener" target="_blank">net/http/cgiパッケージ</a>や<a href="http://golang.org/pkg/net/http/fcgi" rel="nofollow noopener" target="_blank">net/http/fcgiパッケージ</a>を使えばいい。</p>

<ul>
<li><a href="http://golang.org/pkg/net/http" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/net/http</a></li>
<li><a href="http://golang.org/pkg/net/http/cgi/" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/net/http/cgi/</a></li>
<li><a href="http://golang.org/pkg/net/http/fcgi" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/net/http/fcgi</a></li>
</ul>

<h2>
<span id="ルーティングとリクエストパラメータの処理" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A8%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>ルーティングとリクエストパラメータの処理</h2>

<p>標準パッケージだと<a href="http://golang.org/pkg/net/http/#Request" rel="nofollow noopener" target="_blank">net/http.Request</a>や<a href="http://golang.org/pkg/net/http/#ServeMux" rel="nofollow noopener" target="_blank">net/http.ServeMux</a>あたりを使えばいける。もっと機能が欲しければ<a href="https://github.com/stretchr/goweb" rel="nofollow noopener" target="_blank">goweb</a>や<a href="http://www.gorillatoolkit.org/" rel="nofollow noopener" target="_blank">gorilla</a>も便利。</p>

<ul>
<li><a href="http://golang.org/pkg/net/http/#Request" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/net/http/#Request</a></li>
<li><a href="http://golang.org/pkg/net/http/#ServeMux" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/net/http/#ServeMux</a></li>
<li><a href="https://github.com/stretchr/goweb" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/stretchr/goweb</a></li>
<li><a href="http://www.gorillatoolkit.org/" class="autolink" rel="nofollow noopener" target="_blank">http://www.gorillatoolkit.org/</a></li>
</ul>

<h2>
<span id="データベース" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>データベース</h2>

<p>標準でRDB用のインタフェースを<a href="http://golang.org/pkg/database/sql/" rel="nofollow noopener" target="_blank">database/sqlパッケージ</a>で定義している。実際は、各RDBMSの<a href="https://code.google.com/p/go-wiki/wiki/SQLDrivers" rel="nofollow noopener" target="_blank">ドライバ</a>使う。ORMなら<a href="https://github.com/coopernurse/gorp" rel="nofollow noopener" target="_blank">gorp</a>がいい<a href="http://mattn.kaoriya.net/software/lang/go/20120914222828.htm" rel="nofollow noopener" target="_blank">らしい</a>。</p>

<ul>
<li><a href="http://golang.org/pkg/database/sql" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/database/sql</a></li>
<li><a href="https://code.google.com/p/go-wiki/wiki/SQLDrivers" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/go-wiki/wiki/SQLDrivers</a></li>
<li><a href="https://github.com/coopernurse/gorp" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/coopernurse/gorp</a></li>
<li><a href="http://mattn.kaoriya.net/software/lang/go/20120914222828.htm" class="autolink" rel="nofollow noopener" target="_blank">http://mattn.kaoriya.net/software/lang/go/20120914222828.htm</a></li>
</ul>

<h2>
<span id="ビューのレンダリング" class="fragment"></span><a href="#%E3%83%93%E3%83%A5%E3%83%BC%E3%81%AE%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>ビューのレンダリング</h2>

<p>HTMLなら標準パッケージの<a href="http://golang.org/pkg/html/template" rel="nofollow noopener" target="_blank">html/templateパッケージ</a>を使えば、テンプレートエンジンが使える。JSONやXMLなら標準パッケージの<a href="http://golang.org/pkg/encoding/" rel="nofollow noopener" target="_blank">encodingパッケージ</a>以下のパッケージを使えばいい。サードパーティ製であれば<a href="https://github.com/ugorji/go/tree/master/codec" rel="nofollow noopener" target="_blank">MessagePack</a>もある。</p>

<ul>
<li><a href="http://golang.org/pkg/encoding/" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/encoding/</a></li>
<li><a href="http://golang.org/pkg/html/template" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/html/template</a></li>
<li><a href="https://github.com/ugorji/go/tree/master/codec" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ugorji/go/tree/master/codec</a></li>
</ul>

<h2>
<span id="httpクライアント" class="fragment"></span><a href="#http%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>HTTPクライアント</h2>

<p>標準パッケージの<a href="http://golang.org/pkg/net/http/#Client" rel="nofollow noopener" target="_blank">net/http.Client</a>を使えばいいと思う。</p>

<ul>
<li><a href="http://golang.org/pkg/net/http/#Client" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/net/http/#Client</a></li>
</ul>

<h2>
<span id="テストフレームワーク" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF"><i class="fa fa-link"></i></a>テストフレームワーク</h2>

<p>goツールの<code>go test</code>を使えばいい。<br>
テストプログラムを書くには、標準パッケージの<a href="http://golang.org/pkg/testing" rel="nofollow noopener" target="_blank">testingパッケージ</a>を使う。webアプリのテストなら標準パッケージの<a href="http://golang.org/pkg/net/http/httptest" rel="nofollow noopener" target="_blank">net/http/httptestパッケージ</a>も使えるだろう。</p>

<ul>
<li><a href="http://golang.org/doc/code.html#Testing" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/doc/code.html#Testing</a></li>
<li><a href="http://golang.org/pkg/net/http/httptest" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/net/http/httptest</a></li>
<li><a href="http://golang.org/pkg/testing" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/pkg/testing</a></li>
</ul>

<h2>
<span id="waf" class="fragment"></span><a href="#waf"><i class="fa fa-link"></i></a>WAF</h2>

<p>私個人はそんなに必要性を感じないが、<a href="https://github.com/stretchr/goweb" rel="nofollow noopener" target="_blank">goweb</a>は便利だと思った。</p>

<ul>
<li><a href="https://github.com/stretchr/goweb" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/stretchr/goweb</a></li>
</ul>

<h2>
<span id="マスコット" class="fragment"></span><a href="#%E3%83%9E%E3%82%B9%E3%82%B3%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>マスコット</h2>

<p>標準パッケージではないが、Gopher君というマスコットがかわいい。<br>
Webアプリには関係ない。</p>

<ul>
<li><a href="https://github.com/golang-samples/gopher-vector" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/golang-samples/gopher-vector</a></li>
</ul>

<p>以上。他にもあれば指摘してほしい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>196</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/e04441a40aeb9c31dbaf">Go言語における埋め込みによるインタフェースの部分実装パターン</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-19 02:10:47</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="構造体" class="fragment"></span><a href="#%E6%A7%8B%E9%80%A0%E4%BD%93"><i class="fa fa-link"></i></a>構造体</h2>

<p>Go言語には、クラスがない。そのため、代わりに構造体（struct）を使い、その型にメソッドを設けることで似たような振る舞いをさせる。</p>

<p><a href="http://play.golang.org/p/WosVAwNGad" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/WosVAwNGad</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type Person struct {
    FirstName string
    LastName  string
}

func (p *Person) Name() string {
    return p.FirstName + " " + p.LastName
}

func main() {
    person := &amp;Person{"Taro", "Yamada"}
    fmt.Println(person.Name())
}

</pre></div></div>

<h2>
<span id="インタフェース" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>インタフェース</h2>

<p>Go言語にはインタフェースがある。明示的に実装しなくてもインタフェースが定義するメソッドをすべて実装していれば、そのインタフェースを実装していることになる（ダックタイピング）。</p>

<p><a href="http://play.golang.org/p/hqHGJZek3a" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/hqHGJZek3a</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type Person struct {
    FirstName string
    LastName  string
}

func (p *Person) Name() string {
    return p.FirstName + " " + p.LastName
}

type Named interface {
    Name() string
}

func printName(named Named) {
    fmt.Println(named.Name())
}

func main() {
    person := &amp;Person{"Tarou", "Yamada"}
    printName(person)
}
</pre></div></div>

<h2>
<span id="構造体の埋め込み" class="fragment"></span><a href="#%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AE%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>構造体の埋め込み</h2>

<p>Go言語の構造体はクラスではないため、継承ができない。しかし、埋め込みを使うことで他の構造体をラップした構造体を作ることができる。<br>
中に埋め込んだ構造体のフィールドやメソッドはあたかも外の構造体のもののように振る舞うことができる。</p>

<p><a href="http://play.golang.org/p/VyKJCRdEFB" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/VyKJCRdEFB</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type Hoge struct {
    N int
}

type Piyo struct {
    Hoge
    M int
}

func main() {
    piyo := &amp;Piyo{Hoge{1}, 2}
    fmt.Println(piyo.N, piyo.M)
    fmt.Println(piyo.Hoge.N, piyo.M)
}
</pre></div></div>

<h2>
<span id="埋め込みを使ったインタフェースの部分実装" class="fragment"></span><a href="#%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AE%E9%83%A8%E5%88%86%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>埋め込みを使ったインタフェースの部分実装</h2>

<p>埋め込む構造体にあるインタフェース定義するメソッドの一部を実装させ、残りのメソッドは外側の構造体で実装するという手法が使える。下の例だと、Nameメソッドはperson構造体で共通の実装をして、Titleメソッドはfemaleとmaleで別の実装をしている。また、Personインタフェース以外はパッケージ外にエクスポートしないことで、使用者に詳細の実装を見せないようにしている。</p>

<p><a href="http://play.golang.org/p/fbARybwPOd" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/fbARybwPOd</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type Gender int

const (
    Female = iota
    Male
)

type Person interface {
    Name() string
    Title() string
}

func New(gender Gender, firstName, lastName string) Person {
    p := &amp;person{firstName, lastName}
    if gender == Male {
        return &amp;male{p}
    } else {
        return &amp;female{p}
    }
}

type person struct {
    firstName string
    lastName  string
}

func (p *person) Name() string {
    return p.firstName + " " + p.lastName
}

type female struct {
    *person
}

func (f *female) Title() string {
    return "Ms."
}

type male struct {
    *person
}

func (m *male) Title() string {
    return "Mr."
}

func printFullName(p Person) {
    fmt.Println(p.Title(), p.Name())
}

func main() {
    taro := New(Male, "Taro", "Yamada")
    printFullName(taro)

    hanako := New(Female, "Hanako", "Yamada")
    printFullName(hanako)
}

</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>101</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/dddb13c15643454a7c3b">[Go言語] database/sqlパッケージを使ってみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-02 13:56:58</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="ドライバを入れる" class="fragment"></span><a href="#%E3%83%89%E3%83%A9%E3%82%A4%E3%83%90%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>ドライバを入れる</h2>

<p>MySQLのドライバをいれてみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go get "github.com/go-sql-driver/mysql"
</pre></div></div>

<p>使うときは、<code>init</code>関数を呼び出せばよいみたいなので、<code>_</code>でインポートする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>import _ "github.com/go-sql-driver/mysql"
</pre></div></div>

<h2>
<span id="データベースを開く" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E9%96%8B%E3%81%8F"><i class="fa fa-link"></i></a>データベースを開く</h2>

<p>ドライバの名前を指定して、データベースに接続する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cnn := sql.Open("mysql", "user:password@tcp(host:port)/dbname")
</pre></div></div>

<h2>
<span id="1レコードをselectしてみる" class="fragment"></span><a href="#1%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92select%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>1レコードをSELECTしてみる</h2>

<p><code>QueryRow</code>メソッドを使えば、1レコード分を取得できる。<br>
Go言語得意のポイントを渡して、出力引数で受け取る。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>id := 100
var name string

if err := cnn.QueryRow("SELECT name FROM person WHERE id = ?LIMIT 1", id).Scan(&amp;name); err != nil {
    log.Fatal(err)
}

fmt.Println(id, name)
</pre></div></div>

<h2>
<span id="複数レコードをselectしてみる" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92select%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>複数レコードをSELECTしてみる</h2>

<p><code>Query</code>メソッドを使えば、複数のレコードを取得できる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>rows, err := cnn.Query("SELECT id, name FROM person")
if err != nil {
    log.Fatal(err)
}
defer rows.Close()

for rows.Next() {
    var id int
    var name string 
    if err := rows.Scan(&amp;id, &amp;name); err != nil {
        log.Fatal(err)
    }
    fmt.Println(id, name)
}

if err := rows.Err(); err != nil {
    log.Fatal(err)
}
</pre></div></div>

<h2>
<span id="updateしてみる" class="fragment"></span><a href="#update%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>UPDATEしてみる</h2>

<p>レコードを取得する必要のない、クエリは<code>Exec</code>メソッドを使う。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>result, err := cnn.Exec("UPDATE person SET name = ? WHERE id = ?", "Hogera", 100)
if err != nil {
    log.Fatal(err)
}
</pre></div></div>

<p><code>Result</code>インタフェースを使うと、最後に挿入したレコードのキーや影響の合ったレコード数を取得できる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type Result interface {
        LastInsertId() (int64, error)
        RowsAffected() (int64, error)
}
</pre></div></div>

<h2>
<span id="トランザクションを使ってみる" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>トランザクションを使ってみる</h2>

<h3>
<span id="トランザクションの開始とコミット" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E9%96%8B%E5%A7%8B%E3%81%A8%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>トランザクションの開始とコミット</h3>

<p><code>Begin</code>メソッドを呼び出すと、<code>Tx</code>型のポインタとエラー値が返ってくる。<br>
<code>Tx</code>型は<code>DB</code>型と似たようなメソッドを持っているため、<code>Query</code>や<code>QueryRow</code>、<code>Exec</code>などが使える。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>tx, err := cnn.Begin()
if err != nil {
    log.Fatal(err)
}
</pre></div></div>

<p><code>Commit</code>メソッドを使えばコミットできる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>tx.Commit()
</pre></div></div>

<h3>
<span id="ロールバック" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>ロールバック</h3>

<p><code>Rollback</code>メソッドでロールバックできる。<br>
以下の例は、パニックが起きたら、ロールバックする例である。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>func hoge(tx *sql.Tx) {
    defer func() {
        // panicがおきたらロールバック
        if err := recover(); err != nil {
            tx.Rollback()
        }
    }()
    // …
    tx.Exec(…)
}
</pre></div></div>

<h2>
<span id="感想" class="fragment"></span><a href="#%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>感想</h2>

<p><a href="http://golang.org/pkg/database/sql/#DB" rel="nofollow noopener" target="_blank">ドキュメント</a>を見ると、コネクションプールとかよしなにやってくれるらしい。<br>
最初は以下のようにやってたけど、不要のようだ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>var cnnPool chan *sql.DB

func main() {
    cnnPool = make(chan *sql.DB, 10)
    for i := 0; i &lt; cap(cnnPool); i++ {
        cnnPool &lt;- sql.Open("mysql", "user:password@tpc(host:port)/dbname")
    }
}

func getFromDB() { 
    cnn := &lt;-cnnPool
    defer func() {
        cnnPool &lt;- cnn
    }()
    // cnnを使った処理
}
</pre></div></div>

<p>まだまだ、使い始めたばっかなので、基本的な使い方だけまとめた。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>73</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/55fd8fc98cf29b1e43e5">作って分かるJavaScriptでデータバインド</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-04 05:11:17</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[knockoutjs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>JavaScriptにおけるデータバインドの実装方法を双方向データバインドライブラリのKnockoutJSのソースコードを読み、自分で以下のような最低限の機能を実装をしていきます。</p>

<ul>
<li>変更を<code>subscribe</code>できる<code>observable</code>オブジェクト</li>
<li>他の<code>observable</code>オブジェクトの値の変更を検知して、自身の値を変える<code>dependentObservable</code>オブジェクト</li>
</ul>

<p>上記の機能を実現するために、KnockoutJSの以下のオブジェクトの仕組みを解析しました。</p>

<ul>
<li>ko.subscribable</li>
<li>ko.observable</li>
<li>ko.dependencyDetection</li>
<li>ko.dependentObservable(ko.computed)</li>
</ul>

<p>この記事のソースコードはgithubで提供されています。</p>

<ul>
<li><a href="https://github.com/tenntenn/js-binding-hundson" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/tenntenn/js-binding-hundson</a></li>
</ul>

<p>それぞれの機能をいくつかのステップに分けて説明します。各ステップは<code>step0</code>からディレクトリに分けられています。ステップ毎にスケルトンコードと説明(<code>README.md</code>)があります。スケルトンコードには<code>TODO</code>が書かれており、埋める事でコードを完成させることが出来ます。なお、各ステップの解答例は<code>answers</code>以下に同じディレクトリ構成で置かれています。</p>

<p>なお、この内容はKnockoutJSについて11月のALM（社内勉強会）で発表したものを基にしています。<br>
勉強会のスライドはこちら。</p>

<ul>
<li><a href="http://www.slideshare.net/takuyaueda967/knockout-js-alm11" class="autolink" rel="nofollow noopener" target="_blank">http://www.slideshare.net/takuyaueda967/knockout-js-alm11</a></li>
</ul>

<h2>
<span id="step-0-前準備" class="fragment"></span><a href="#step-0-%E5%89%8D%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>STEP 0: 前準備</h2>

<p>まずは、前準備をしましょう。<br>
このステップでは、特に<code>TODO</code>はありません。<br>
他のステップで使う、いくつかの関数やオブジェクトを用意しましょう。</p>

<p>はじめに、グローバルオブジェクトを極力汚さないように、名前空間を用意しましょう。<br>
名前空間の名前は特に意味はありませんが、KnockoutJSの<code>ko</code>をマネして、2文字くらいが使いやすいでしょう。<br>
今回は、無作為に2文字選びました。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">go</span> <span class="o">=</span> <span class="p">{};</span>
</pre></div></div>

<p>つぎに、デバッグ用の<code>log</code>関数を用意しましょう。<br>
<code>console.log</code>を使ってログをコンソールに出力し、ブラウザを使った場合には、JSON形式でHTMLのリストでも出力する関数です。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">global</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

<span class="c1">// log</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">log</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">logStr</span> <span class="o">=</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">selector</span> <span class="o">&amp;&amp;</span> <span class="nx">global</span><span class="p">.</span><span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">lst</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">selector</span> <span class="o">+</span> <span class="s1">'&gt;'</span> <span class="o">+</span> <span class="s1">'ul'</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lst</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">lst</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'ul'</span><span class="p">);</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">lst</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">lst</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s1">'&lt;li&gt;'</span><span class="o">+</span><span class="nx">logStr</span><span class="o">+</span><span class="s1">'&lt;/li&gt;'</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">go</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="nx">log</span><span class="p">;</span>
<span class="p">})(</span><span class="s1">'#result'</span><span class="p">);</span>
</pre></div></div>

<p>さいごに、継承を行なうための関数を用意しましょう。<br>
<code>go.extend</code>は第1引数で渡したオブジェクトのプロパティを第2引数で渡したオブジェクトにコピーする関数です。継承とはちょっと異なりますが、ここでは簡単の為にこうしておきましょう。この関数は深くコピーすることに注意しておきましょう。コピーしたプロパティのオブジェクト(配列)は別のオブジェクト(配列)となります。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// extend</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">extend</span><span class="p">(</span><span class="nx">_super</span><span class="p">,</span> <span class="nx">sub</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">_super</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_super</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">_super</span><span class="p">[</span><span class="nx">k</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">sub</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_super</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_super</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">_super</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'object'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sub</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">extend</span><span class="p">(</span><span class="nx">_super</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="nx">i</span><span class="p">],</span> <span class="nx">sub</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="nx">i</span><span class="p">]);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">_super</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'object'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sub</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">extend</span><span class="p">(</span><span class="nx">_super</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span> <span class="nx">sub</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">sub</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_super</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">go</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">;</span>
<span class="p">})();</span>
</pre></div></div>

<h2>
<span id="step-1-subscribeとnotify" class="fragment"></span><a href="#step-1-subscribe%E3%81%A8notify"><i class="fa fa-link"></i></a>STEP 1: <code>subscribe</code>と<code>notify</code>
</h2>

<h3>
<span id="バインディングの魔法" class="fragment"></span><a href="#%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E9%AD%94%E6%B3%95"><i class="fa fa-link"></i></a>バインディングの魔法</h3>

<p>私はバインディングという機能が好きで、JavaFXやAngularJS、そしてKnockoutJSのバインディングを色々ためしました。また、面白そうだったので、自分で<a href="https://github.com/tenntenn/simple-binding.js" rel="nofollow noopener" target="_blank">バインディングライブラリ</a>を作ってみたりしました。</p>

<p>KnockoutJSのバインディングはHTMLとJSのオブジェクトを双方向バインドすることができます。双方向なので、片方が変更されるともう片方も変更されます。<br>
たとえば、以下の例を見てみると、<code>input</code>タグの<code>value</code>に、<code>vm.count</code>がバインディングされています。<code>vm.count</code>の値は、タイマーでカウントアップされ、その結果が<code>input</code>の<code>value</code>へと反映されます。また、<code>input</code>の<code>value</code>をフォームから変更することもでき、その変更は<code>vm.count</code>へと反映されます。</p>

<p><a href="http://jsfiddle.net/uedatakuya/HXPb4" rel="nofollow noopener" target="_blank">JSFiddleで見る</a></p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span>counter: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"number"</span> <span class="na">id</span><span class="o">=</span><span class="s">"counter"</span> <span class="na">data-bind</span><span class="o">=</span><span class="s">"value: count"</span> <span class="p">/&gt;</span>

</pre></div></div>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">count</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindings</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>

<span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">vm</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">count</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</pre></div></div>

<p>上記の例を見ると、KnockoutJSのバインディングは魔法のようにオブジェクトとHTMLをバインドしているようです。<br>
もちろん、魔法などではありません。バインドされているもう一方に変更を伝える仕組みが働いていて、変更に追従しているのです。<br>
この変更を伝える仕組みをKockoutJSでは、<code>ko.subcribable</code>が担っています。<br>
KnockoutJSでメインに使われる<code>ko.observable</code>や<code>ko.observableArray</code>、<code>ko.computed</code>(<code>ko.dependentObservable</code>のエイリアス)はこのオブジェクトの機能を継承しています。</p>

<h3>
<span id="subscribeとnotify" class="fragment"></span><a href="#subscribe%E3%81%A8notify"><i class="fa fa-link"></i></a><code>subscribe</code>と<code>notify</code>
</h3>

<p>KnockoutJSの<code>ko.subcribable</code>は変更を伝える役目を担っており、以下の2つの機能から成っています。</p>

<ul>
<li>
<code>subscribe</code>：変更を通知してもらうオブジェクト(<code>subscripter</code>)を登録する</li>
<li>
<code>notifySubscripter</code>：登録している<code>subscripter</code>に通知する</li>
</ul>

<p>KnockoutJSのソースコードを参考にしながら、<code>TODO</code>を埋めていきましょう。</p>

<ul>
<li><a href="https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/subscribable.js" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/subscribable.js</a></li>
</ul>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// subscribable</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">subscribable</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">_subscriptions</span><span class="o">:</span> <span class="p">[],</span>
        <span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="nx">callbackTarget</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">_subscribable</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">callback</span><span class="o">:</span> <span class="cm">/* TODO: callbackTargetがあったらバインドしてコールバックを設定*/</span><span class="p">,</span>
                <span class="nx">dispose</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="c1">// TODO: 破棄したというフラグを立てておく</span>

                    <span class="c1">// TODO: _subscribable._subscriptionsの中に自身(this)を発見したら配列から取り除く</span>
                <span class="p">},</span>
                <span class="nx">isDisposed</span><span class="o">:</span> <span class="kc">false</span>
            <span class="p">};</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_subscriptions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">subscription</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">subscription</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nx">notifySubscripters</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">valueToNotify</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">_subscriptions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_subscriptions</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_subscriptions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">_subscriptions</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="c1">// TODO: disposeされていなかったら、callback呼び出す</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">subscribable</span> <span class="o">=</span> <span class="nx">subscribable</span><span class="p">;</span>
<span class="p">})();</span>
</pre></div></div>

<p><code>subscription</code>は<code>callback</code>と<code>dispose</code>というプロパティを持っており、<code>callback</code>は引数で渡された<code>callback</code>に<code>callbackTarget</code>を<code>Function.bind</code>したものです。一方、<code>dispose</code>は<code>_subscriptoions</code>から自身を取り除く処理を行なう関数です。<code>_subscriptions</code>から取り除いただけでは、<code>subscription</code>オブジェクトから分からないので、フラグを立てておきます。<code>subscribe</code>は<code>subscription</code>を返すので、登録を破棄したければ、<code>dispose</code>を呼べば破棄されます。</p>

<p>つづいて、<code>notifySubscripters</code>を考えてみましょう。<code>notifySubscripters</code>は、<code>_subscriptions</code>に登録されている<code>subscription</code>の<code>callback</code>を呼び出す事によって、<code>subscript</code>しているオブジェクト(<code>subscripter</code>)に通知を送るメソッドです。<code>notifySubscripters</code>の引数は通知する値です。引数で渡された値は<code>subscription</code>の<code>callback</code>関数の引数として渡されます。</p>

<p><code>TODO</code>をすべて埋めたらindex.htmlをブラウザで開いて、以下のテストプログラムの動作を確認してみましょう。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// Test</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// 継承してみる</span>
    <span class="kd">var</span> <span class="nx">subscribable</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">go</span><span class="p">.</span><span class="nx">subscribable</span><span class="p">,</span> <span class="nx">subscribable</span><span class="p">);</span>

    <span class="c1">// 通知がきたら、ログに出力する</span>
    <span class="kd">var</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">subscribable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// subscripterに'hoge'を通知する</span>
    <span class="nx">subscribable</span><span class="p">.</span><span class="nx">notifySubscripters</span><span class="p">(</span><span class="s1">'hoge'</span><span class="p">);</span>

    <span class="c1">// disposeして破棄する</span>
    <span class="nx">subscription</span><span class="p">.</span><span class="nx">dispose</span><span class="p">();</span>

    <span class="c1">// subscripterに'piyo'を通知する</span>
    <span class="c1">// しかし、subscriptionはdisposeされているので、通知されない</span>
    <span class="nx">subscribable</span><span class="p">.</span><span class="nx">notifySubscripters</span><span class="p">(</span><span class="s1">'piyo'</span><span class="p">);</span>
<span class="p">})();</span>
</pre></div></div>

<p>以下のように出力されているはずです。</p>

<ul>
<li>"hoge"</li>
</ul>

<p>コメントにも書かれていますが、1回目の<code>notifySubscripters</code>では、<code>subscription</code>の<code>callback</code>に通知されます。しかし、2回目は通知する<code>subscripter</code>がないので、どのオブジェクトにも通知されません。</p>

<h2>
<span id="step-2-値の更新を通知するオブジェクト" class="fragment"></span><a href="#step-2-%E5%80%A4%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%92%E9%80%9A%E7%9F%A5%E3%81%99%E3%82%8B%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a>STEP 2: 値の更新を通知するオブジェクト</h2>

<h3>
<span id="observableオブジェクト" class="fragment"></span><a href="#observable%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a><code>observable</code>オブジェクト</h3>

<p><code>subscribable</code>オブジェクトは、通知の登録(<code>subscribe</code>)と通知(<code>notify</code>)はできましたが、値そのものを保持することはできませんでした。<br>
そこで、このステップでは内部に値を保持できる<code>observable</code>オブジェクトを作る関数を実装してみましょう。</p>

<p>KnockoutJSの<code>ko.observable</code>は、内部に値を保持できるオブジェクトを作る関数です。このオブジェクトは、関数オブジェクトで引数を渡して呼び出すと書き込み(write)になり、引数なしで呼び出すと読み出し(read)になります。<code>ko.observable</code>では、内部に保持する値の変更を<code>subscribe</code>することで、検知することができます。<code>subscribe</code>の機能は、<code>ko.subscribable</code>を継承することで実現しています。つまり、書き込み時に<code>notifySubscripters</code>を実行する事で、書き込みを通知します。具体的な使い方を見てみましょう。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// 200とalertされる</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="c1">// 200と出力される</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">());</span>
</pre></div></div>

<p>上記の例では<code>var foo = ko.observable(100);</code>で初期化が行なわれ、<code>observable</code>オブジェクトが作られています。この時初期値として、<code>100</code>が設定されています。つづいて、<code>subcribable</code>で、変更を検知して、<code>alert</code>を呼び出すコールバック仕掛けます。<code>foo(200)</code>で書き込みが行なわれると、仕掛けたコールバックが呼ばれて、<code>alert</code>が行なわれます。<code>foo()</code>のように引数なしで呼ばれると、内部に保持している値をそのまま返すため、コンソールに<code>200</code>が出力されます。</p>

<p>それでは、KnockoutJSのソースコードを参考にしながら、<code>TODO</code>を埋めていきましょう。</p>

<ul>
<li><a href="https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/observable.js" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/observable.js</a></li>
</ul>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// observable</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">observable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">initialValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">initialValue</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">observable</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="cm">/* TODO: 引数があれば書き込み */</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// write</span>
        <span class="kd">var</span> <span class="nx">newValue</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="c1">// TODO: 値が変わっていれば、更新して、nofityする</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// read</span>
        <span class="k">return</span> <span class="nx">lastValue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// TODO: go.subscribableを継承する</span>
    <span class="c1">// TODO: observableなオブジェクトを返す</span>
  <span class="p">};</span>
  <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">;</span>
<span class="p">})();</span>
</pre></div></div>

<p><code>observable</code>オブジェクト（値が保持できて、変更の検知ができる）を作る関数を<code>go.observable</code>とします。<code>go.observable</code>の引数は、<code>observable</code>オブジェクトに設定する初期値を受取りましょう。戻り値はもちろん<code>observable</code>オブジェクトです。</p>

<p><code>observable</code>という関数が2つ出てきてややこしいですが、外側の関数(<code>go.observable</code>)は<code>ko.observable</code>にあたる関数で、内側の関数が実際に値を保持する<code>observable</code>なオブジェクトになります。<code>go.observable</code>が呼び出される度に、内側の<code>observable</code>関数(<code>observable</code>オブジェクト)が作られます。<code>lastValue</code>は<code>observable</code>オブジェクト内に保持する値を入れる変数で、<code>go.observable</code>の引数で貰った値を初期値としています。通知する機能は<code>go.subscribable</code>で作っているため、<code>observable</code>オブジェクトは、<code>go.subscribable</code>を継承しています。</p>

<p><code>observable</code>オブジェクトは2種類の呼ばれ方をしています。ひとつめが<code>foo(200)</code>のような引数がある呼ばれ方、ふたつめが<code>foo()</code>のような引数がない呼ばれ方です。前者が書き込みで後者が読み出しです。JavaScriptの関数の中では、<code>arguments</code>という引数を保持する配列っぽい特別なオブジェクトが使えます。<code>arguments</code>は、複数のパターンの引数をとる場合によく使われます。この場合は、<code>arguments.length</code>を見て、引数の有無で書き込み処理と読込み処理を分ければ良いでしょう。読み込み処理の場合は、単に最後に設定された値(<code>lastValue</code>)を返すだけでいいでしょう。書き込み処理も、第1引数の値を<code>lastValue</code>に入れれば良さそうです。書き込み処理では、もうひとつ大切な処理を行なう必要があります。新しい値が設定された場合、その事を<code>subscripter</code>に通知する処理です。これは<code>go.subscribable</code>から継承した<code>notifySubscripters</code>を使えば済みます。</p>

<p><code>TODO</code>をすべて埋めたらindex.htmlをブラウザで開いて、以下のテストプログラムの動作を確認してみましょう。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// Test</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="s1">'hoge'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">observable</span><span class="p">(),</span> <span class="nx">count</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">observable</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>
    <span class="nx">observable</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>
    <span class="nx">observable</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">);</span>
    <span class="nx">subscription</span><span class="p">.</span><span class="nx">dispose</span><span class="p">();</span>
    <span class="nx">observable</span><span class="p">(</span><span class="s1">'piyo'</span><span class="p">);</span>
<span class="p">})();</span>
</pre></div></div>

<p>以下のように出力されているはずです。</p>

<ul>
<li>["foo",1]</li>
<li>["bar",2]</li>
</ul>

<p>値が新しい値に変更された場合のみ、通知が行なわれていることが分かります。</p>

<h2>
<span id="step-3-依存関係の検出とdependencydetection" class="fragment"></span><a href="#step-3-%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%81%AE%E6%A4%9C%E5%87%BA%E3%81%A8dependencydetection"><i class="fa fa-link"></i></a>STEP 3: 依存関係の検出と<code>dependencyDetection</code>
</h2>

<h3>
<span id="依存関係の検出" class="fragment"></span><a href="#%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%81%AE%E6%A4%9C%E5%87%BA"><i class="fa fa-link"></i></a>依存関係の検出</h3>

<p>KnockoutJSには、<code>ko.computed</code>という他の<code>ko.observable</code>の値に依存したような<code>observable</code>なオブジェクトがあります。<code>ko.computed</code>は以下のように使います。</p>

<p><a href="http://jsfiddle.net/uedatakuya/52J5b" rel="nofollow noopener" target="_blank">JSFiddleで見る</a></p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"result"</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">hoge</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">piyo</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="nx">hoge</span><span class="p">()</span> <span class="o">+</span> <span class="nx">piyo</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#result'</span><span class="p">).</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
<span class="p">});</span>
<span class="nx">hoge</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</pre></div></div>

<p><code>foo</code>の値(引数なしで評価された値)は、<code>hoge</code>が<code>piyo</code>が変更された場合、自動的に更新されます。もちろん、<code>subscribe</code>しておけば、その変更は通知されます。<br>
不思議ですよね？KnockoutJSはどのようにして、<code>foo</code>が<code>hoge</code>と<code>piyo</code>に依存していることを知っているのでしょう？</p>

<p>この不思議を解明するために、以下のように、<code>ko.computed</code>に渡す関数が評価される回数を数えてみましょう。</p>

<p><a href="http://jsfiddle.net/uedatakuya/MckQ8" rel="nofollow noopener" target="_blank">JSFiddleで見る</a></p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"result"</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">hoge</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">piyo</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#result'</span><span class="p">).</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">count</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">hoge</span><span class="p">()</span> <span class="o">+</span> <span class="nx">piyo</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">hoge</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</pre></div></div>

<p>直感的には、<code>hoge(300)</code>の変更の時に1度呼ばれているだけの様な気がしますが、結果は<code>2</code>となっています。何故でしょう？<br>
実は、この関数は<code>ko.computed</code>に渡されたときに、1度評価されます。そして、その評価の時に評価された<code>observable</code>オブジェクト(ここでは、<code>hoge</code>と<code>piyo</code>)を記録することで、依存関係を検知しています。また、その時の評価値を初期値として設定しています。</p>

<p>これはKnockoutJSを使う上では非常に大切なことです。なぜならば、この<code>ko.computed</code>に渡す関数内で副作用のある処理をすると、意図しない結果になる場合があるからです。事前に呼び出されることをちゃんと知った上で、使わないと思わぬバグになってしまいます。</p>

<h3>
<span id="dependencydetectionオブジェクト" class="fragment"></span><a href="#dependencydetection%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a><code>dependencyDetection</code>オブジェクト</h3>

<p>KnockoutJSの<code>ko.dependencyDetection</code>は、前述の依存関係の検出を行なうオブジェクトです。<code>ko.dependencyDetection.begin</code>を実行した後に、評価された<code>obsrvable</code>オブジェクトを登録します。<code>dependencyDetection</code>オブジェクトには、依存関係の検出を始める<code>begin</code>メソッドと、依存関係に<code>subscribable</code>オブジェクトを追加する<code>registerDependency</code>メソッドが必要です。また、<code>go.observable</code>の方にも修正が必要です。読込みの場合に、依存関係を記録する必要があるため、引数なしで呼び出された場合の処理に追加しなければなりません。</p>

<p>それでは、KnockoutJSのソースコードを参考にしながら、<code>TODO</code>を埋めていきましょう。</p>

<ul>
<li><a href="https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependencyDetection.js" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependencyDetection.js</a></li>
</ul>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// observable</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">observable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">initialValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">initialValue</span><span class="p">;</span>

        <span class="kd">function</span> <span class="nx">observable</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// write</span>
                <span class="kd">var</span> <span class="nx">newValue</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span> <span class="o">!==</span> <span class="nx">lastValue</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span>
                    <span class="nx">observable</span><span class="p">.</span><span class="nx">notifySubscripters</span><span class="p">(</span><span class="nx">lastValue</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// read</span>
                <span class="c1">// TODO: 依存関係に追加(go.dependencyDetectionを使う)</span>
                <span class="k">return</span> <span class="nx">lastValue</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">go</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">go</span><span class="p">.</span><span class="nx">subscribable</span><span class="p">,</span> <span class="nx">observable</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">observable</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">;</span>
<span class="p">})();</span>

<span class="c1">// dependencyDetection</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">distinctDependencies</span><span class="p">,</span> <span class="nx">callback</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">dependencyDetection</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">begin</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">_callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// TODO: callbackを初期化</span>
            <span class="c1">// TODO: distinctDependenciesを初期化</span>
        <span class="p">},</span>
        <span class="nx">registerDependency</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subscribable</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// TODO: すでに依存関係にあった場合と1度もbeginが呼ばれていない場合は無視</span>

            <span class="c1">// TODO: subscribableを依存関係に追加</span>
            <span class="c1">// TODO: コールバックが設定してあったら呼び出す</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">dependencyDetection</span> <span class="o">=</span> <span class="nx">dependencyDetection</span><span class="p">;</span>
<span class="p">})();</span>
</pre></div></div>

<p><code>TODO</code>をすべて埋めたらindex.htmlをブラウザで開いて、以下のテストプログラムの動作を確認してみましょう。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// Test</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">observables</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">dependencyDetection</span><span class="p">.</span><span class="nx">begin</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">observable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nx">observable</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">===</span> <span class="nx">observable</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'b'</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">observable</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">a</span><span class="p">();</span>
    <span class="nx">a</span><span class="p">();</span>
    <span class="nx">b</span><span class="p">();</span>
<span class="p">})();</span>
</pre></div></div>

<p>以下のように出力されているはずです。</p>

<ul>
<li>"a"</li>
<li>"b"</li>
</ul>

<p><code>observable</code>オブジェクトの値が読み込まれた時に、<code>go.dependencyDetection.registerDependency</code>が呼び出されているのが分かります。また、1度登録された<code>observable</code>オブジェクトは重複して登録されていません。これで十分に動くように見えますが、実はうまく動きません。しかし、<code>dependentObservable</code>(<code>computed</code>)を実装する際に、必要となってくるので、ここはこのまま進みましょう。</p>

<h2>
<span id="step-4-計算結果の変更を検出する" class="fragment"></span><a href="#step-4-%E8%A8%88%E7%AE%97%E7%B5%90%E6%9E%9C%E3%81%AE%E5%A4%89%E6%9B%B4%E3%82%92%E6%A4%9C%E5%87%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>STEP 4: 計算結果の変更を検出する</h2>

<h3>
<span id="dependentobservableオブジェクト" class="fragment"></span><a href="#dependentobservable%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a><code>dependentObservable</code>オブジェクト</h3>

<p>前述の通り、KnockoutJSには<code>ko.computed</code>関数を使うと他の<code>observable</code>オブジェクトを使って計算した結果を自身の値とする<code>dependentObservable</code>オブジェクトを作ることができます。また、<code>dependentObservable</code>オブジェクトが他の<code>dependentObservable</code>に依存しても問題ありません。もちろん、通常の<code>observable</code>オブジェクトと同様に、<code>subscribe</code>できる必要があります。そのため、以下のように読込み処理の時に毎回値を評価する方法では、効率が悪く、<code>subscribe</code>しても依存する<code>observable</code>オブジェクトの値が更新されても、次の読込み処理が走るまで<code>notify</code>することができません。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// dependentObservable</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lastValue</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">dependentObservable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">readFunction</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">function</span> <span class="nx">dependentObservable</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// write</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Cannot write to computed'</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// read                                </span>
                <span class="kd">var</span> <span class="nx">newValue</span> <span class="o">=</span> <span class="nx">readFunction</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span> <span class="o">!==</span> <span class="nx">lastValue</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span>
                    <span class="nx">dependentObservable</span><span class="p">.</span><span class="nx">notifySubscripters</span><span class="p">(</span><span class="nx">lastValue</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">go</span><span class="p">.</span><span class="nx">dependencyDetection</span><span class="p">.</span><span class="nx">registerDependency</span><span class="p">(</span><span class="nx">dependentObservable</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">lastValue</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">go</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">go</span><span class="p">.</span><span class="nx">subscribable</span><span class="p">,</span> <span class="nx">dependentObservable</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">dependentObservable</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">dependentObservable</span> <span class="o">=</span> <span class="nx">dependentObservable</span><span class="p">;</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">computed</span> <span class="o">=</span> <span class="nx">dependentObservable</span><span class="p">;</span>
<span class="p">})();</span>
</pre></div></div>

<p>依存関係を検出するには、STEP 3で作成した<code>go.dependencyDetection</code>を使います。検出された依存する<code>observable</code>オブジェクトを<code>subscribe</code>して変更された場合に<code>readFunction</code>を読み込み<code>lastValue</code>を更新します。</p>

<p>それでは、KnockoutJSのソースコードを参考にしながら、<code>TODO</code>を埋めていきましょう。</p>

<ul>
<li><a href="https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependentObservable.js" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependentObservable.js</a></li>
</ul>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// dependentObservable</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dependentObservable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">readFunction</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">lastValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">isBeingEvaluated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">hasBeenEvaluated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">subscriptionsToDependencies</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="kd">function</span> <span class="nx">evaluateImmediate</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// TODO: evaluateImmediateが既に呼び出し済み(呼び出し済みフラグがtrue)なら何もしない</span>

            <span class="c1">// TODO: 呼び出し済みフラグをtrueにする</span>

            <span class="c1">// TODO: 記録しているsubscriptionsをdisposeして配列を空にする</span>

            <span class="nx">go</span><span class="p">.</span><span class="nx">dependencyDetection</span><span class="p">.</span><span class="nx">begin</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">subscribable</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// TODO: 検知されたsubscribableをsubscribeして、そのsubscriptionを記録</span>
            <span class="p">});</span>

            <span class="kd">var</span> <span class="nx">newValue</span> <span class="o">=</span> <span class="nx">readFunction</span><span class="p">();</span>
            <span class="c1">// TODO: 1度でも評価されているかどうかを表すフラグをtrueにする</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span> <span class="o">!==</span> <span class="nx">lastValue</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span>
                <span class="nx">dependentObservable</span><span class="p">.</span><span class="nx">notifySubscripters</span><span class="p">(</span><span class="nx">lastValue</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// TODO: 呼び出し済みフラグをfalseにする</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">dependentObservable</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// write</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Cannot write to computed'</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// read                </span>
                <span class="k">if</span> <span class="p">(</span><span class="cm">/* TODO: 一度も評価されていない場合 */</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">evaluateImmediate</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="nx">go</span><span class="p">.</span><span class="nx">dependencyDetection</span><span class="p">.</span><span class="nx">registerDependency</span><span class="p">(</span><span class="nx">dependentObservable</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">lastValue</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nx">go</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">go</span><span class="p">.</span><span class="nx">subscribable</span><span class="p">,</span> <span class="nx">dependentObservable</span><span class="p">);</span>
        <span class="c1">// TODO: 最初の評価と初期値の設定</span>
        <span class="k">return</span> <span class="nx">dependentObservable</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">dependentObservable</span> <span class="o">=</span> <span class="nx">dependentObservable</span><span class="p">;</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">computed</span> <span class="o">=</span> <span class="nx">dependentObservable</span><span class="p">;</span>
<span class="p">})();</span>
</pre></div></div>

<p><code>evaluateImmediate</code>は<code>readFunction</code>を呼び出し、保持している<code>observable</code>の値を更新します。また、その際に<code>go.dependencyDetection</code>を使って、依存する<code>subscribable</code>(<code>observable</code>)を検知します。検知した<code>subscribable</code>の<code>subscribe</code>する事で、更新された時に再度<code>evaluateImmediate</code>を呼び出されるようにします。<code>evaluateImmediate</code>が呼び出される度に、検知した依存関係を破棄し、<code>subscription</code>も破棄(<code>dispose</code>)するために、配列<code>subscriptionsToDependencies</code>で保持しています。<code>dependentObservable</code>オブジェクトも<code>observable</code>オブジェクトの一種なので、値が変更された場合は<code>notifySubscripters</code>で変更を通知します。<code>hasBeenEvaluated</code>は、一番最初の場合は問答無用で<code>evaluateImmediate</code>を呼び出すために使われます。</p>

<p><code>TODO</code>をすべて埋めたらindex.htmlをブラウザで開いて、以下のテストプログラムの動作を確認してみましょう。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// Test</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span><span class="p">()</span> <span class="o">+</span> <span class="nx">b</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">(),</span> <span class="nx">b</span><span class="p">(),</span> <span class="nx">c</span><span class="p">());</span>
    <span class="nx">a</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">(),</span> <span class="nx">b</span><span class="p">(),</span> <span class="nx">c</span><span class="p">());</span>
<span class="p">})();</span>
</pre></div></div>

<p>以下のように出力されているはずです。</p>

<ul>
<li>[100,200,300]</li>
<li>[400,200,600]</li>
</ul>

<p>うまく動いているように見えます。しかし、これではうまく動かない場合があります。<br>
次のステップでその部分を改良しましょう。</p>

<h2>
<span id="step-5-問題点の改善" class="fragment"></span><a href="#step-5-%E5%95%8F%E9%A1%8C%E7%82%B9%E3%81%AE%E6%94%B9%E5%96%84"><i class="fa fa-link"></i></a>STEP 5: 問題点の改善</h2>

<p>このステップでは、STEP 4での実装をうまく動かない例を示して、問題点を改善していきます。</p>

<h3>
<span id="入れ子にした場合" class="fragment"></span><a href="#%E5%85%A5%E3%82%8C%E5%AD%90%E3%81%AB%E3%81%97%E3%81%9F%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>入れ子にした場合</h3>

<p>STEP 4までの実装では、以下のように<code>computed</code>が入れ子になっている場合にうまく動作しません。最初の出力では、<code>100 200</code>、2番目の出力では<code>150 300</code>と出力されて欲しいところですが、実際には2番目の出力は<code>150 200</code>となります。STEP 4までの実装では、<code>readFunction</code>の中で<code>go.dependenctyDetection.begin</code>を多重に呼び出すことを前提としていません。そのため、2度<code>begin</code>を呼び出すと前回の呼び出しの分の<code>distinctDependencies</code>が消えてしまいます。そこで、<code>distinctDependencies</code>をスタックで管理するようにしましょう。スタックで管理すれば、入れ子に呼び出されても問題ありません。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span>    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">a</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">c</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">(),</span><span class="nx">b</span><span class="p">());</span>
    <span class="nx">a</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">(),</span><span class="nx">b</span><span class="p">());</span>

</pre></div></div>

<p>それでは、KnockoutJSのソースコードを参考にしながら、<code>TODO</code>を埋めていきましょう。</p>

<ul>
<li><a href="https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependencyDetection.js" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependencyDetection.js</a></li>
<li><a href="https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependentObservable.js" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependentObservable.js</a></li>
</ul>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// dependencyDetection</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">frames</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">dependencyDetection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO: 新しいframeをpushして、依存関係の検出を開始する。callbackが無かったら、undefinedをpushする</span>
    <span class="p">},</span>
    <span class="nx">end</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// TODO: 先頭のframeをpopして、依存関係の検出を終了する</span>
    <span class="p">},</span>
    <span class="nx">registerDependency</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subscribable</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">frames</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">topFrame</span> <span class="o">=</span> <span class="nx">frames</span><span class="p">[</span><span class="nx">frames</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="c1">// TODO: topFrameがundefinedの場合とすでにsubscribableが登録してあったら何もしない</span>

        <span class="nx">topFrame</span><span class="p">.</span><span class="nx">distinctDependencies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">subscribable</span><span class="p">);</span>
        <span class="nx">topFrame</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="nx">subscribable</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">go</span><span class="p">.</span><span class="nx">dependencyDetection</span> <span class="o">=</span> <span class="nx">dependencyDetection</span><span class="p">;</span>
<span class="p">})();</span>

<span class="c1">// dependentObservable</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">dependentObservable</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">readFunction</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lastValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">isBeingEvaluated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">hasBeenEvaluated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">subscriptionsToDependencies</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="kd">function</span> <span class="nx">evaluateImmediate</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isBeingEvaluated</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">isBeingEvaluated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">subscriptionsToDependencies</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">subscriptionsToDependencies</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">dispose</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="nx">subscriptionsToDependencies</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">go</span><span class="p">.</span><span class="nx">dependencyDetection</span><span class="p">.</span><span class="nx">begin</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">subscribable</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">subscriptionsToDependencies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">subscribable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">evaluateImmediate</span><span class="p">));</span>
      <span class="p">});</span>
      <span class="kd">var</span> <span class="nx">newValue</span> <span class="o">=</span> <span class="nx">readFunction</span><span class="p">();</span>
      <span class="nx">hasBeenEvaluated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span> <span class="o">!==</span> <span class="nx">lastValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span>
        <span class="nx">dependentObservable</span><span class="p">.</span><span class="nx">notifySubscripters</span><span class="p">(</span><span class="nx">lastValue</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// TODO: 依存関係の検出を終了する</span>
      <span class="nx">isBeingEvaluated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">dependentObservable</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// write</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Cannot write to computed'</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// read                </span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasBeenEvaluated</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">evaluateImmediate</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">go</span><span class="p">.</span><span class="nx">dependencyDetection</span><span class="p">.</span><span class="nx">registerDependency</span><span class="p">(</span><span class="nx">dependentObservable</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">lastValue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">go</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">go</span><span class="p">.</span><span class="nx">subscribable</span><span class="p">,</span> <span class="nx">dependentObservable</span><span class="p">);</span>
    <span class="nx">evaluateImmediate</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">dependentObservable</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">go</span><span class="p">.</span><span class="nx">dependentObservable</span> <span class="o">=</span> <span class="nx">dependentObservable</span><span class="p">;</span>
  <span class="nx">go</span><span class="p">.</span><span class="nx">computed</span> <span class="o">=</span> <span class="nx">dependentObservable</span><span class="p">;</span>
<span class="p">})();</span>
</pre></div></div>

<p>スタックを<code>frames</code>という名前にし、<code>begin</code>でスタックに積み、<code>end</code>でスタックから取り除くようにしています。また、<code>dependentObservable</code>の<code>evaluateImmediate</code>も循環で呼び出されないようにしましょう。<code>begin</code>したら<code>end</code>するのを忘れないようにしましょう。</p>

<p><code>TODO</code>をすべて埋めたらindex.htmlをブラウザで開いて、以下のテストプログラムの動作を確認してみましょう。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// Test</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

    <span class="c1">// 入れ子にしても問題ないか？</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">go</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">a</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">c</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">(),</span><span class="nx">b</span><span class="p">());</span>
    <span class="nx">a</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
    <span class="nx">go</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">(),</span><span class="nx">b</span><span class="p">());</span>
<span class="p">})();</span>
</pre></div></div>

<p>以下のように出力されているはずです。</p>

<ul>
<li>[100,200]</li>
<li>[150,300]</li>
</ul>

<p><code>b</code>の依存関係と<code>b</code>の<code>readFunction</code>の中で作られている<code>c</code>の依存関係はスタックを使うことで別物として扱うことができるようになりました。<code>a</code>を変更すると、<code>b</code>と<code>c</code>に変更が通知され、それぞれの<code>evaluateImmediate</code>が実行されます。もちろん、<code>c</code>は<code>b</code>の<code>readFunction</code>が呼ばれる度に生成されるので、普通はこのような呼び方はしないでしょう。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>KnockoutJSの以下のオブジェクトの簡易実装を作ってみました。KnockoutJSのデータバインドは<code>dependenctyDetection</code>がキモで、この機構があるおかげで、明示的に依存関係を定義する必要がありません。しかしながら、その仕組みをあまり理解せずに使用していると、思わぬバグに遭遇して困るのではないでしょうか。ここでは、説明が複雑になるので、<code>ko.applyBindings</code>を使ったHTMLとの双方向バインディングの仕組みについて触れませんでしたが、ソースを軽く見た感じでは<code>computed</code>をうまく使って実装されているようです。また時間があれば、そちらの実装の方もまとめたいと思います。これを書いている間もmasterブランチのソースコードが結構変わっているので、内容が古くなるかもしれませんが、このまとめが誰かの役に立てば幸いです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>65</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/63d52c01a6339eb392f0">Go言語で顔認識してみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-02 00:46:45</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[OpenCV]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>Go Advent Calendarの12月1日分の記事です。<br>
はい、すいません。もう12月2日ですが、寝るまでが12月1日ということで。<br>
今回は、cgoの練習ということで、OpenCVをいじってみました。</p>

<h2>
<span id="opencvのインストール" class="fragment"></span><a href="#opencv%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>OpenCVのインストール</h2>

<p>私はMacを使っているので、homebrewで入れました。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew install opencv
</pre></div></div>

<p>しばらくhomebrewを使っていなかったので、アップデートしようとしたら、エラーが沢山でました。その辺は以下を見て解決しました。</p>

<ul>
<li><a href="https://github.com/mxcl/homebrew/issues/11448" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mxcl/homebrew/issues/11448</a></li>
</ul>

<h2>
<span id="やり方を探す" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E6%96%B9%E3%82%92%E6%8E%A2%E3%81%99"><i class="fa fa-link"></i></a>やり方を探す</h2>

<p>とりあえず、「opencv golang」でググると、便利そうなバインディングが見つかりました。</p>

<ul>
<li><a href="https://code.google.com/p/go-opencv/" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/go-opencv/</a></li>
</ul>

<p><code>go get</code>してみよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go get code.google.com/p/go-opencv/trunk/opencv
</pre></div></div>

<p>コンパイルに失敗する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># code.google.com/p/go-opencv/opencv
./cxcore.go:218:5: struct size calculation error off=60 bytesize=40
</pre></div></div>

<p>うむ、良くわからん。ググろう。<br>
この辺とか出てきたけど、よくわからないので、やめよう。</p>

<ul>
<li><a href="https://code.google.com/p/go/issues/detail?id=3505" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/go/issues/detail?id=3505</a></li>
</ul>

<p>時間がないので、バインディングを使う方法はやめました。</p>

<h2>
<span id="直にcgoを使う" class="fragment"></span><a href="#%E7%9B%B4%E3%81%ABcgo%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>直にcgoを使う</h2>

<p>またもや「opencv golang」ググります。<br>
良さげな記事を発見しました。</p>

<ul>
<li><a href="http://codeblag.wordpress.com/2013/03/09/how-to-use-opencv-with-go-on-linux/" class="autolink" rel="nofollow noopener" target="_blank">http://codeblag.wordpress.com/2013/03/09/how-to-use-opencv-with-go-on-linux/</a></li>
</ul>

<p>説明の英語には目もくれず、Go言語のソースコードを見ます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import (
    "fmt"
)

//#cgo pkg-config: opencv
//#include &lt;cv.h&gt;
//#include &lt;highgui.h&gt;
import "C"
import "unsafe"

func main() {
    fmt.Println("Hello World!")
    text := C.CString("Hello World!")
    defer C.free(unsafe.Pointer(text))
    C.cvNamedWindow(text, 1)
    img := unsafe.Pointer(C.cvCreateImage(C.cvSize(640, 480), C.IPL_DEPTH_8U, 1))
    C.cvSet(img, C.cvScalar(0, 0, 0, 0), nil)
    var font C.CvFont
    C.cvInitFont(&amp;font, C.CV_FONT_HERSHEY_SIMPLEX|C.CV_FONT_ITALIC,
        1.0, 1.0, 0, 1, 8)
    C.cvPutText(img, text, C.cvPoint(200, 400), &amp;font,
        C.cvScalar(255, 255, 0, 0))
    C.cvShowImage(text, img)
    C.cvWaitKey(0)
}
</pre></div></div>

<p>実行すると、<code>Hello, World</code>と出ます。<br>
ふむふむ！顔認識をやってみよう。</p>

<h2>
<span id="顔認識" class="fragment"></span><a href="#%E9%A1%94%E8%AA%8D%E8%AD%98"><i class="fa fa-link"></i></a>顔認識</h2>

<p>cgoの使い方はふんわり分かったので、次はopencvで顔認識をするサンプルをGoogle先生で調べました。</p>

<ul>
<li><a href="http://www.aianet.ne.jp/~asada/prog_doc/opencv/opencv_obj_det_img.htm" class="autolink" rel="nofollow noopener" target="_blank">http://www.aianet.ne.jp/~asada/prog_doc/opencv/opencv_obj_det_img.htm</a></li>
</ul>

<p>なかなか、良さげな記事を発見しました。静止画の顔認識をやってみます。<br>
C言語のコードの前に<code>C</code>を付けていく簡単なお仕事をやってみます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># command-line-arguments
./sample.go:21: not enough arguments in call to _Cfunc_cvLoad
./sample.go:21: cannot convert _Cfunc_cvLoad(_Cfunc_CString("haarcascade_frontalface_default.xml")) (type unsafe.Pointer) to type C.CvHaarClassifierCascade
./sample.go:21: invalid indirect of _Ctype_CvHaarClassifierCascade(_Cfunc_cvLoad(_Cfunc_CString("haarcascade_frontalface_default.xml"))) (type C.CvHaarClassif
ierCascade)
./sample.go:25: cannot use tarImg (type *_Ctype_IplImage) as type unsafe.Pointer in function argument
./sample.go:25: not enough arguments in call to _Cfunc_cvHaarDetectObjects
./sample.go:28: undefined: CvRect
./sample.go:28: cannot use i (type int) as type C.int in function argument
./sample.go:30: not enough arguments in call to _Cfunc_cvRectangle
./sample.go:36: cannot use tarImg (type *_Ctype_IplImage) as type unsafe.Pointer in function argument
./sample.go:37: not enough arguments in call to _Cfunc_cvNamedWindow
./sample.go:37: too many errors
</pre></div></div>

<p>なんかいっぱいエラーでた。<br>
どうやら、省略されている引数があるようです。<br>
あとはキャストに失敗している部分があるようです。</p>

<p>エラーを解決していくと、以下のようになりました。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">face_detection1.go</span></div>
<div class="highlight"><pre><span></span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="c1">//#cgo pkg-config: opencv</span>
<span class="c1">//#include &lt;cv.h&gt;</span>
<span class="c1">//#include &lt;highgui.h&gt;</span>
<span class="kn">import</span> <span class="s">"C"</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"flag"</span>
    <span class="s">"unsafe"</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="p">(</span>
    <span class="nx">filePath</span> <span class="p">=</span> <span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">"f"</span><span class="p">,</span> <span class="s">"lena.jpg"</span><span class="p">,</span> <span class="s">"file path"</span><span class="p">)</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>

    <span class="nx">tarImg</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">cvLoadImage</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="o">*</span><span class="nx">filePath</span><span class="p">),</span> <span class="nx">C</span><span class="p">.</span><span class="nx">CV_LOAD_IMAGE_ANYDEPTH</span><span class="p">|</span><span class="nx">C</span><span class="p">.</span><span class="nx">CV_LOAD_IMAGE_ANYCOLOR</span><span class="p">)</span>

    <span class="nx">cvHCC</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">CvHaarClassifierCascade</span><span class="p">)(</span><span class="nx">C</span><span class="p">.</span><span class="nx">cvLoad</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"haarcascade_frontalface_default.xml"</span><span class="p">),</span> <span class="p">(</span><span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">CvMemStorage</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span> <span class="p">(</span><span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span> <span class="p">(</span><span class="o">**</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)))</span>

    <span class="nx">cvMStr</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">cvCreateMemStorage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nx">face</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">cvHaarDetectObjects</span><span class="p">(</span>
        <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">tarImg</span><span class="p">),</span>
        <span class="nx">cvHCC</span><span class="p">,</span>
        <span class="nx">cvMStr</span><span class="p">,</span>
        <span class="mf">1.11</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">cvSize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">cvSize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">face</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">faceRect</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">CvRect</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">cvGetSeqElem</span><span class="p">(</span><span class="nx">face</span><span class="p">,</span> <span class="nx">i</span><span class="p">)))</span>    
        <span class="nx">C</span><span class="p">.</span><span class="nx">cvRectangle</span><span class="p">(</span>
            <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">tarImg</span><span class="p">),</span>
            <span class="nx">C</span><span class="p">.</span><span class="nx">cvPoint</span><span class="p">(</span><span class="nx">faceRect</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">faceRect</span><span class="p">.</span><span class="nx">y</span><span class="p">),</span>
            <span class="nx">C</span><span class="p">.</span><span class="nx">cvPoint</span><span class="p">(</span><span class="nx">faceRect</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">faceRect</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">faceRect</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">faceRect</span><span class="p">.</span><span class="nx">height</span><span class="p">),</span>
            <span class="nx">C</span><span class="p">.</span><span class="nx">cvScalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="mi">3</span><span class="p">,</span>
            <span class="nx">C</span><span class="p">.</span><span class="nx">CV_AA</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">C</span><span class="p">.</span><span class="nx">cvNamedWindow</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"face_detect"</span><span class="p">),</span> <span class="nx">C</span><span class="p">.</span><span class="nx">CV_WINDOW_AUTOSIZE</span><span class="p">)</span>
    <span class="nx">C</span><span class="p">.</span><span class="nx">cvShowImage</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"face_detect"</span><span class="p">),</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">tarImg</span><span class="p">))</span>

    <span class="nx">C</span><span class="p">.</span><span class="nx">cvWaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nx">C</span><span class="p">.</span><span class="nx">cvDestroyWindow</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"face_detect"</span><span class="p">))</span>
<span class="p">}</span>

</pre></div>
</div>

<p><code>haarcascade_frontalface_default.xml</code>は顔認識の学習データらしく、ググると見つけれます。<code>lena.jpg</code>はいつものお姉さんです。</p>

<p>実行してみる。</p>

<p><a href="https://camo.qiitausercontent.com/9619f1a2cfe25a0ffa5f667d26563b96ff27054d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31343935322f61656262366334652d626166322d336566622d343233372d3835303166313861343365332e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9619f1a2cfe25a0ffa5f667d26563b96ff27054d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31343935322f61656262366334652d626166322d336566622d343233372d3835303166313861343365332e6a706567" alt="face_detection1.jpg" title="face_detection1.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/14952/aebb6c4e-baf2-3efb-4237-8501f18a43e3.jpeg"></a></p>

<p>ふむ。何か物足りない。そうだ、Gopher君だ！</p>

<p>画像の上に画像を重ねる方法を探そうと思い、Google先生に聞きました。</p>

<ul>
<li><a href="http://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q13101143038" class="autolink" rel="nofollow noopener" target="_blank">http://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q13101143038</a></li>
</ul>

<p>Yahoo!知恵袋で質問している方がいました。ナイス！知恵袋の正しい使い方ですね。</p>

<p>ふむふむ。ROIは<code>Region of Interes</code>の略で、指定した矩形領域にしか作用させないようにする機能なのかな？</p>

<p>早速、やってみましょう。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">face_detection2.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="c1">//#cgo pkg-config: opencv</span>
<span class="c1">//#include &lt;cv.h&gt;</span>
<span class="c1">//#include &lt;highgui.h&gt;</span>
<span class="kn">import</span> <span class="s">"C"</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"flag"</span>
    <span class="s">"unsafe"</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="p">(</span>
    <span class="nx">filePath</span> <span class="p">=</span> <span class="nx">flag</span><span class="p">.</span><span class="nx">String</span><span class="p">(</span><span class="s">"f"</span><span class="p">,</span> <span class="s">"lena.jpg"</span><span class="p">,</span> <span class="s">"file path"</span><span class="p">)</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">flag</span><span class="p">.</span><span class="nx">Parse</span><span class="p">()</span>

    <span class="nx">gopherImg</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">cvLoadImage</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"gopher_head.png"</span><span class="p">),</span> <span class="nx">C</span><span class="p">.</span><span class="nx">CV_LOAD_IMAGE_ANYDEPTH</span><span class="p">|</span><span class="nx">C</span><span class="p">.</span><span class="nx">CV_LOAD_IMAGE_ANYCOLOR</span><span class="p">)</span>
    <span class="nx">tarImg</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">cvLoadImage</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="o">*</span><span class="nx">filePath</span><span class="p">),</span> <span class="nx">C</span><span class="p">.</span><span class="nx">CV_LOAD_IMAGE_ANYDEPTH</span><span class="p">|</span><span class="nx">C</span><span class="p">.</span><span class="nx">CV_LOAD_IMAGE_ANYCOLOR</span><span class="p">)</span>

    <span class="nx">cvHCC</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">CvHaarClassifierCascade</span><span class="p">)(</span><span class="nx">C</span><span class="p">.</span><span class="nx">cvLoad</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"haarcascade_frontalface_default.xml"</span><span class="p">),</span> <span class="p">(</span><span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">CvMemStorage</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span> <span class="p">(</span><span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span><span class="p">)(</span><span class="kc">nil</span><span class="p">),</span> <span class="p">(</span><span class="o">**</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)))</span>

    <span class="nx">cvMStr</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">cvCreateMemStorage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nx">face</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">cvHaarDetectObjects</span><span class="p">(</span>
        <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">tarImg</span><span class="p">),</span>
        <span class="nx">cvHCC</span><span class="p">,</span>
        <span class="nx">cvMStr</span><span class="p">,</span>
        <span class="mf">1.11</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">cvSize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">cvSize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">face</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">faceRect</span> <span class="o">:=</span> <span class="p">(</span><span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">CvRect</span><span class="p">)(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">cvGetSeqElem</span><span class="p">(</span><span class="nx">face</span><span class="p">,</span> <span class="nx">i</span><span class="p">)))</span>
        <span class="nx">roi</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nx">cvRect</span><span class="p">(</span>
            <span class="nx">faceRect</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">faceRect</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="nx">gopherImg</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="nx">faceRect</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">faceRect</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="nx">gopherImg</span><span class="p">.</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
            <span class="nx">gopherImg</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
            <span class="nx">gopherImg</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">cvSetImageROI</span><span class="p">(</span><span class="nx">tarImg</span><span class="p">,</span> <span class="nx">roi</span><span class="p">)</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">cvCopy</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">gopherImg</span><span class="p">),</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">tarImg</span><span class="p">),</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="kc">nil</span><span class="p">))</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">cvResetImageROI</span><span class="p">(</span><span class="nx">tarImg</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">C</span><span class="p">.</span><span class="nx">cvNamedWindow</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"face_detect"</span><span class="p">),</span> <span class="nx">C</span><span class="p">.</span><span class="nx">CV_WINDOW_AUTOSIZE</span><span class="p">)</span>
    <span class="nx">C</span><span class="p">.</span><span class="nx">cvShowImage</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"face_detect"</span><span class="p">),</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">(</span><span class="nx">tarImg</span><span class="p">))</span>

    <span class="nx">C</span><span class="p">.</span><span class="nx">cvWaitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nx">C</span><span class="p">.</span><span class="nx">cvDestroyWindow</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">CString</span><span class="p">(</span><span class="s">"face_detect"</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>

<p>変わったのは、Gopher君の画像の読込みと以下の部分です。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>roi := C.cvRect(
    faceRect.x+faceRect.width/2-gopherImg.width/2,
         faceRect.y+faceRect.height/2-gopherImg.height/2,
         gopherImg.width,
         gopherImg.height,
)
C.cvSetImageROI(tarImg, roi)
C.cvCopy(unsafe.Pointer(gopherImg), unsafe.Pointer(tarImg), unsafe.Pointer(nil))
C.cvResetImageROI(tarImg)
</pre></div></div>

<p>顔認識された矩形領域の中心にGopher君の画像の中心が来るようにしています。</p>

<p>実行結果です。</p>

<p><a href="https://camo.qiitausercontent.com/6f7406ac4ba71fd449e0502002941edbcbe2f31d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31343935322f31356666313330342d613461642d393064312d313034612d3966613166373536336335372e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6f7406ac4ba71fd449e0502002941edbcbe2f31d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31343935322f31356666313330342d613461642d393064312d313034612d3966613166373536336335372e6a706567" alt="face_detection2.jpg" title="face_detection2.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/14952/15ff1304-a4ad-90d1-104a-9fa1f7563c57.jpeg"></a></p>

<p>透過処理とか難しいので、省いたらなんか変。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>cgoは楽しいですね。opencvをやりたいけど、Cで書きたくない場合はオススメです。しかし、キャストとか<code>C</code>付けるのは面倒です。次は動画の顔認識をやってみたいですね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>44</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/a06b6b178959e3a63196">Go言語におけるinterface{}とリフレクションを使ったパターン</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-19 14:00:13</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="出力引数としてinterfaceを受け取る" class="fragment"></span><a href="#%E5%87%BA%E5%8A%9B%E5%BC%95%E6%95%B0%E3%81%A8%E3%81%97%E3%81%A6interface%E3%82%92%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B"><i class="fa fa-link"></i></a>出力引数としてinterface{}を受け取る</h2>

<p>設定したい変数のポインタをinterface{}として受け取る。<br>
interface{}なので、任意の型を渡すことができる。<br>
<code>reflect.ValueOf</code>で<code>reflect.Value</code>型に変換する。<br>
その後、<code>Value.Elem()</code>でポインタが指している先を取得して、<code>Value.Set()</code>で値を設定する。</p>

<p><a href="http://play.golang.org/p/qsTwrL11mu" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/qsTwrL11mu</a></p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">reflect_pattern1.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"reflect"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">set</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">v</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="nx">pv</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span> <span class="o">!=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">Ptr</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"p must be pointer."</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">vv</span> <span class="o">:=</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">pv</span><span class="p">.</span><span class="nx">Elem</span><span class="p">().</span><span class="nx">Kind</span><span class="p">()</span> <span class="o">!=</span> <span class="nx">vv</span><span class="p">.</span><span class="nx">Kind</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">"p type and v type do not mutch"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">pv</span><span class="p">.</span><span class="nx">Elem</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="nx">vv</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hoge</span> <span class="kt">int</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">hoge</span><span class="p">)</span>
    <span class="nx">set</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">hoge</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">hoge</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">set</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">hoge</span><span class="p">,</span> <span class="mf">10.4</span><span class="p">))</span>
<span class="p">}</span>

</pre></div>
</div>

<h2>
<span id="関数をinterfaceで受け取る" class="fragment"></span><a href="#%E9%96%A2%E6%95%B0%E3%82%92interface%E3%81%A7%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8B"><i class="fa fa-link"></i></a>関数をinterface{}で受け取る</h2>

<p>関数は引数や戻り値を含めて型なので、引数や戻り値が一致しないと同じ型として扱うことができない。そのため、引数の型をinterface{}にしておき、任意の関数を渡し、リフレクションして呼び出す。</p>

<p><a href="http://play.golang.org/p/fFmGNRlqcn" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/fFmGNRlqcn</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import (
    "fmt"
    "reflect"
)

func call(f interface{}) {
    fv := reflect.ValueOf(f)
    if fv.Kind() != reflect.Func {
        panic("f must be func.")
    }
    fv.Call([]reflect.Value{})
}

func main() {
    f := func() {
        fmt.Println("hello!")
    }
    call(f)
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>43</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/0a3af58b225eeae29088">[Go言語] constとiota面白い</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-21 16:03:03</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="連番を付ける" class="fragment"></span><a href="#%E9%80%A3%E7%95%AA%E3%82%92%E4%BB%98%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>連番を付ける</h2>

<p>iotaを使うと連番が付けれる。</p>

<p><a href="http://play.golang.org/p/w9KX9ry0Da" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/w9KX9ry0Da</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

const (
    a = iota
    b
    c
)

func main() {
    fmt.Println(a, b, c)
}
</pre></div></div>

<h2>
<span id="iotaとシフトを組み合わせてみる" class="fragment"></span><a href="#iota%E3%81%A8%E3%82%B7%E3%83%95%E3%83%88%E3%82%92%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>iotaとシフトを組み合わせてみる</h2>

<p>シフトと組み合わせると簡単にフラグが作れる。</p>

<p><a href="http://play.golang.org/p/rHew6bPIWQ" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/rHew6bPIWQ</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type flag uint
const (
    flag1 flag= iota &lt;&lt; 1
    flag2
    flag3
    flag4
    bits = iota - 1
    mask = 1&lt;&lt;bits - 1
)

func main() {
    fmt.Printf("%b, %b, %b, %b, %d, %b", flag1, flag2, flag3, flag4, bits, mask)
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>42</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/9aebce917760f157c44e">[Go言語] deferに関する実験</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-29 17:02:48</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="実験1最後に書いたものが" class="fragment"></span><a href="#%E5%AE%9F%E9%A8%931%E6%9C%80%E5%BE%8C%E3%81%AB%E6%9B%B8%E3%81%84%E3%81%9F%E3%82%82%E3%81%AE%E3%81%8C"><i class="fa fa-link"></i></a>実験1：最後に書いたものが</h2>

<p>最後に書いたものが最初に呼ばれるよ。</p>

<p><a href="http://play.golang.org/p/gb8tbGk4wr" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/gb8tbGk4wr</a></p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">"fmt"</span>

<span class="kd">func</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"2"</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"3"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">f</span><span class="p">()</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="実験2引数の評価は" class="fragment"></span><a href="#%E5%AE%9F%E9%A8%932%E5%BC%95%E6%95%B0%E3%81%AE%E8%A9%95%E4%BE%A1%E3%81%AF"><i class="fa fa-link"></i></a>実験2：引数の評価は</h2>

<p>引数の評価は、<code>defer</code>で関数の呼び出しが予約される時に行なわれるよ。</p>

<p><a href="http://play.golang.org/p/-MPMro0vUy" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/-MPMro0vUy</a></p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">"fmt"</span>

<span class="kd">func</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">defer</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"i is %d"</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
    <span class="nx">i</span> <span class="p">=</span> <span class="mi">100</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">f</span><span class="p">()</span>
<span class="p">}</span>
</pre></div></div>

<p><a href="http://play.golang.org/p/FXKl3S4mi0" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/FXKl3S4mi0</a></p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">"fmt"</span>

<span class="kd">func</span> <span class="nx">f</span><span class="p">()</span> <span class="p">(</span><span class="nx">ret</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ret</span><span class="p">)</span>
    <span class="p">}(</span><span class="nx">ret</span><span class="p">)</span> <span class="c1">// retはゼロ値で初期化されている</span>

    <span class="k">return</span> <span class="mi">100</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">f</span><span class="p">())</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="実験3メソッドオブジェクトでも" class="fragment"></span><a href="#%E5%AE%9F%E9%A8%933%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A7%E3%82%82"><i class="fa fa-link"></i></a>実験3：メソッドオブジェクトでも</h2>

<p>メソッドオブジェクトでも<code>defer</code>呼び出しはいける</p>

<p><a href="http://play.golang.org/p/ewH2vlyWsL" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/ewH2vlyWsL</a></p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">"fmt"</span>

<span class="kd">type</span> <span class="nx">Hoge</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">N</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">h</span> <span class="o">*</span><span class="nx">Hoge</span><span class="p">)</span> <span class="nx">PrintN</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">N</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">h</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Hoge</span><span class="p">{</span><span class="mi">100</span><span class="p">}</span>
    <span class="nx">m</span> <span class="o">:=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">PrintN</span>
    <span class="k">defer</span> <span class="nx">m</span><span class="p">()</span>
    <span class="nx">h</span><span class="p">.</span><span class="nx">N</span> <span class="p">=</span> <span class="mi">200</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">f</span><span class="p">()</span>
<span class="p">}</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>27</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/b7bd54c7ba0ff90f1707">[Go言語] httpハンドラの共通部分を取り出していい感じにする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-14 13:33:29</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ハンドラをラップするようなハンドラを作る関数つくればいい。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import (
    "fmt"
    "log"
    "net/http"
)

func baseHandlerFunc(handler func(w http.ResponseWriter, r *http.Request)) http.Handler {
    return baseHandler(http.HandlerFunc(handler))
}

func baseHandler(handler http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        // common
        log.Println(r.URL, r.Method)
        handler.ServeHTTP(w, r)
    })
}

// handler
func index(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "hello")
}

func main() {
    http.Handle("/", baseHandlerFunc(index))
    http.ListenAndServe(":8080", nil)
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>22</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/06bbb9971e8a6c3ccc95">AngularJS + Typescript用のyeomanのgenerator</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-13 21:49:13</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[TypeScript]</b> <b>[AngularJS]</b> <b>[yeoman]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://github.com/JakubMrozek/generator-angular-typescript#pkazy" rel="nofollow noopener" target="_blank">JakubMrozek/generator-angular-typescript</a>というgeneratorがある。</p>

<p>基本的にreadme.mdに書いてある通りにすれば動く。<br>
「grunt server」を実行した際に、「components/types/angularjs/angular.d.ts:88」でエラーが出る場合は、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>directive(name: string, directiveFactory: (...params)=&gt; IDirective): IModule;
</pre></div></div>

<p>を</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>directive(name: string, directiveFactory: (...params: any[])=&gt; IDirective): IModule;
</pre></div></div>

<p>に変更すれば良い。<br>
以下チェコ語か何かで書かれたreadme.mdを頑張って和訳したもの。</p>

<h2>
<span id="インストール方法" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>インストール方法</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>npm install yo grunt-cli bower testacular -g
npm install git://github.com/JakubMrozek/generator-angular-typescript.git
yo angular
npm install &amp;&amp; bower install
</pre></div></div>

<h2>
<span id="コマンド" class="fragment"></span><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>コマンド</h2>

<ul>
<li>grunt server - 開発を始める</li>
<li>grunt test - すべてのテストを実行する</li>
<li>grunt testacular:unit - 自動リフレッシュで単体テストを行なうために、Testacularを開始する</li>
<li>grunt build - プロジェクトをビルドする（ミニファイや最適化など）</li>
</ul>

<h2>
<span id="基本的な使い方" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>基本的な使い方</h2>

<p>コントローラ、ディレクティブ、フィルターおよびサービスとそのテストの生成方法。</p>

<h3>
<span id="コントローラ" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9"><i class="fa fa-link"></i></a>コントローラ</h3>

<p>生成方法：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yo angular:controller Ctrl
</pre></div></div>

<p>生成される app/scripts/controllers/ctrl.ts:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/// &lt;reference path="../app.ts" /&gt;

'use strict';

module app.controller {

  export class Ctrl implements IController {

    constructor (private $scope) {

    }

}

}

app.registerController('Ctrl', ['$scope']);
</pre></div></div>

<h3>
<span id="ディレクティブ" class="fragment"></span><a href="#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96"><i class="fa fa-link"></i></a>ディレクティブ</h3>

<p>生成方法：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yo angular:directive dir
</pre></div></div>

<p>生成される app/scripts/directives/dir.ts:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/// &lt;reference path="../app.ts" /&gt;

'use strict';

module app.directive {

  export class Dir implements IDirective {

    template = '&lt;div&gt;&lt;/div&gt;';

    restrict = 'E';

    link (scope, element: JQuery, attrs: ng.IAttributes) {
      element.text('this is the dir directive');
    }

}

}

app.registerDirective('Dir', []);
</pre></div></div>

<h3>
<span id="フィルター" class="fragment"></span><a href="#%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%BC"><i class="fa fa-link"></i></a>フィルター</h3>

<p>生成方法：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yo angular:filter fil
</pre></div></div>

<p>生成される app/scripts/filters/fil.ts:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/// &lt;reference path="../app.ts" /&gt;

'use strict';

module app.filter {

  export class Fil implements IFilter {

    filter (input: string) {
      return 'fil filter: ' + input;
    }

}

}

app.registerFilter('Fil', []);
</pre></div></div>

<h3>
<span id="サービス" class="fragment"></span><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9"><i class="fa fa-link"></i></a>サービス</h3>

<p>生成方法：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yo angular:service serv
</pre></div></div>

<p>生成される app/scripts/services/serv.ts:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/// &lt;reference path="../app.ts" /&gt;

'use strict';

module app.service {

  export class Serv implements IService {

    private meaningOfLife = 42;

    constructor () {

    }

    someMethod () {
      return this.meaningOfLife;
    }

  }

}

app.registerService('Serv', []);
</pre></div></div>

<h2>
<span id="詳細はこちらを参照" class="fragment"></span><a href="#%E8%A9%B3%E7%B4%B0%E3%81%AF%E3%81%93%E3%81%A1%E3%82%89%E3%82%92%E5%8F%82%E7%85%A7"><i class="fa fa-link"></i></a>詳細はこちらを参照</h2>

<p><a href="http://weblog.ronniweb.net" class="autolink" rel="nofollow noopener" target="_blank">http://weblog.ronniweb.net</a></p>

<h2>
<span id="ライセンス" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>ライセンス</h2>

<p><a href="http://opensource.org/licenses/bsd-license.php" rel="nofollow noopener" target="_blank">BSDライセンス</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>20</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/c3afc87a20d9f50998bb">Go言語におけるエイリアス型を使ったパターン</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-19 02:35:46</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="型のエイリアス" class="fragment"></span><a href="#%E5%9E%8B%E3%81%AE%E3%82%A8%E3%82%A4%E3%83%AA%E3%82%A2%E3%82%B9"><i class="fa fa-link"></i></a>型のエイリアス</h2>

<p>Go言語では、ある型に別名をつけ、別の型として使うことができる。<br>
もちろん、組込み型へのエイリアス型を作ることもできる。</p>

<p><a href="http://play.golang.org/p/wm5sWaa1J7" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/wm5sWaa1J7</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type Int int

func main() {
    n := 100
    m := Int(n) // キャスト
    fmt.Printf("%T, %T", n, m)
}
</pre></div></div>

<h2>
<span id="メソッドの実装" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>メソッドの実装</h2>

<p>別名をつけた新しい型には、別途メソッドを設ける事ができる。<br>
組込み型にメソッドを設けたい場合は便利である。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type Hex int

func (h Hex) String() string {
    return fmt.Sprintf("%#x", int(h))
}

func main() {
    fmt.Println(Hex(100))
}
</pre></div></div>

<h2>
<span id="用途や単位としての型" class="fragment"></span><a href="#%E7%94%A8%E9%80%94%E3%82%84%E5%8D%98%E4%BD%8D%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AE%E5%9E%8B"><i class="fa fa-link"></i></a>用途や単位としての型</h2>

<p>単位が違う場合や用途が違う場合、同じ値でも同じように扱うことを避けたい場合がある。その場合は、共通型に別のエイリアスを付けることで、区別することができる。</p>

<p><a href="http://play.golang.org/p/AIai9zuemn" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/AIai9zuemn</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type Meter int
type Kilogram int

type Person struct {
    Name   string
    Height Meter
    Weight Kilogram
}

type Female *Person
type Male *Person

func femaleOnly(f Female) {
    fmt.Println(f.Name, "is a female.")
}

func main() {
    yamada := &amp;Person{"Yamada", Meter(172), Kilogram(60)}
    fmt.Println(yamada)

    femaleOnly(Female(yamada))

}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/1c0d6b0523992f38bfd0">[Go言語] JSONを解析するのに、型作るのはめんどい</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-03 00:46:36</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[JSON]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ChromeのDevToolsには、timelineという機能があり、Webアプリのパフォーマンスチューニングに使えます。このtimelineで記録したデータはJSONで保存ができます。<br>
最初はjqを使って解析しようと思いましたが、スクリプトがだんだんと黒魔術臭がしてきました。</p>

<p>そこで、Go言語で解析しようと思ったのですが、正直このJSONのフォーマットがイマイチ分からないので、型が作れません。また、Chromeさんはバージョンがガンガン上がるので、いつフォーマットが変わるか分かりません。その度に型が変わるのは嫌です。</p>

<p>ということで、型を作らずにJSONを解析するライブラリ的なものを作ってみました。<br>
<code>reflect</code>パッケージ的な感じに使えます。</p>

<ul>
<li><a href="https://github.com/tenntenn/gj" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/tenntenn/gj</a></li>
</ul>

<p>こんな感じで使えます。<code>ResourceSendRequest</code>レコードを羅列する例です。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import (
    "github.com/tenntenn/gj"

    "fmt"
    "io/ioutil"
    "os"
)

func main() {
    jsonStr, _ := ioutil.ReadAll(os.Stdin)
    v, _ := gj.New(jsonStr)
    traversal(v.Slice(1, v.Len()))
}

func traversal(v *gj.Value) {

    if v.IsArray() {
        v.EachIndex(func(i int, v *gj.Value) {
            traversal(v)
        })
        return
    }

    if v.IsObject() {

        if v.Has("type") &amp;&amp; v.Get("type").String() == "ResourceSendRequest" {
            fmt.Println(v.Get("data").Get("url").String())
        }

        if v.Has("children") {
            traversal(v.Get("children"))
        }
    }
}
</pre></div></div>

<p>まだまだ改良の余地がありそうですが、個人で使う分にはいい感じかな。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/fbb83c4da759af285dd5">RequireJSで循環参照</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-01-23 17:15:39</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[RequireJS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://requirejs.org/docs/api.html#circular" rel="nofollow noopener" target="_blank">ここ</a>を参考に、循環参照を解決する方法を記述する。</p>

<p>A.jsとB.jsがそれぞれのモジュールを相互に使いたい場合、以下のように、requireを使って、必要な時にモジュールを取得すれば良い。<br>
そうしなければ、どちらかのモジュールは <em>undefined</em> になる。</p>

<div class="code-frame" data-lang="Javascript">
<div class="code-lang"><span class="bold">A.js</span></div>
<div class="highlight"><pre><span></span><span class="nx">define</span><span class="p">(</span><span class="s1">'A'</span><span class="p">,[</span><span class="s1">'require'</span><span class="p">,</span> <span class="s1">'B'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">B</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"B"</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"A"</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">B</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">A</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>

<div class="code-frame" data-lang="Javascript">
<div class="code-lang"><span class="bold">B.js</span></div>
<div class="highlight"><pre><span></span><span class="nx">define</span><span class="p">(</span><span class="s1">'B'</span><span class="p">,[</span><span class="s1">'require'</span><span class="p">,</span> <span class="s1">'A'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="nx">A</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">B</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">A</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"A"</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"B"</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">B</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/3add893529707c837b4f">[Go言語] reflectパッケージで変数の値を変える</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-21 16:15:11</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下の記事に書いてあることをまとめる。</p>

<ul>
<li><a href="http://golang.org/doc/articles/laws_of_reflection.html" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/doc/articles/laws_of_reflection.html</a></li>
</ul>

<h2>
<span id="変数の値を変える" class="fragment"></span><a href="#%E5%A4%89%E6%95%B0%E3%81%AE%E5%80%A4%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>変数の値を変える</h2>

<p>よく考えれば当たり前だが、一度ポインタにしないと変数の値を変えることができない。</p>

<p><a href="http://play.golang.org/p/grX4uYh2VO" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/grX4uYh2VO</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import (
    "fmt"
    "reflect"
)

func main() {
    n := 100

    // ダメ
    nv := reflect.ValueOf(n)
    fmt.Println(nv.CanSet())

    // ポインタを使う
    npv := reflect.ValueOf(&amp;n)
    fmt.Println(npv.Elem().CanSet())
    npv.Elem().SetInt(200)

    fmt.Println(n)
}
</pre></div></div>

<p>一度ポインタにして、<code>Elem</code>メソッドでまたポインタの指す先に戻しているあたりが気持ち悪い。<br>
<code>Elem</code>メソッドの<a href="https://code.google.com/p/go/source/browse/src/pkg/reflect/value.go#780" rel="nofollow noopener" target="_blank">ソース</a>を見ると、<a href="https://code.google.com/p/go/source/browse/src/pkg/reflect/value.go#76" rel="nofollow noopener" target="_blank"><code>flagRO</code></a>フラグは元の<code>Value</code>の物を保持して、<a href="https://code.google.com/p/go/source/browse/src/pkg/reflect/value.go#78" rel="nofollow noopener" target="_blank"><code>flagAddr</code></a>フラグと<a href="https://code.google.com/p/go/source/browse/src/pkg/reflect/value.go#77" rel="nofollow noopener" target="_blank"><code>flagIndir</code></a>フラグを立てている。そのため、<a href="https://code.google.com/p/go/source/browse/src/pkg/reflect/value.go#330" rel="nofollow noopener" target="_blank"><code>CanSet</code></a>メソッドで<code>true</code>が返る（つまり、代入可能にしている）ことが分かる。<br>
一方、<code>reflect.ValueOf(100)</code>のようにした場合は、<a href="https://code.google.com/p/go/source/browse/src/pkg/reflect/value.go#77" rel="nofollow noopener" target="_blank"><code>flagIndir</code></a>しか<a href="https://code.google.com/p/go/source/browse/src/pkg/reflect/value.go#2130" rel="nofollow noopener" target="_blank">フラグがたてられない</a>。よって、<code>CanSet</code>はfalseとなり、<code>Set</code>できない。</p>

<h2>
<span id="構造体のフィールドの値を変える" class="fragment"></span><a href="#%E6%A7%8B%E9%80%A0%E4%BD%93%E3%81%AE%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%81%AE%E5%80%A4%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>構造体のフィールドの値を変える</h2>

<p>上記と同様に、構造体のフィールドの値を変えるのにも一度ポインタに変換する必要がある。</p>

<p><a href="http://play.golang.org/p/SSW28W5bXn" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/SSW28W5bXn</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import (
    "fmt"
    "reflect"
)

type Hoge struct {
    N int
}

func main() {
    h := Hoge{10}
    hpv := reflect.ValueOf(&amp;h)
    hpv.Elem().FieldByName("N").SetInt(200)

    fmt.Println(h)
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>12</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/8fab45298490fe654ab1">Google I/O 2013のGo言語に関するセッション一覧</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-20 05:21:42</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[io13]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><ul>
<li><p><a href="https://developers.google.com/events/io/sessions/332768653" rel="nofollow noopener" target="_blank">Advanced Go Concurrency Patterns</a><br>
（<a href="http://www.youtube.com/watch?v=QDDwwePbDtw" rel="nofollow noopener" target="_blank">ビデオ</a>, <a href="http://talks.golang.org/2013/advconc.slide" rel="nofollow noopener" target="_blank">スライド</a>）</p></li>
<li><p><a href="https://developers.google.com/events/io/sessions/333519914" rel="nofollow noopener" target="_blank">High Performance Apps with Go on App Engine</a>（<a href="http://www.youtube.com/watch?v=fc25ihfXhbg" rel="nofollow noopener" target="_blank">ビデオ</a>, <a href="http://talks.golang.org/2013/highperf.slide" rel="nofollow noopener" target="_blank">スライド</a>）</p></li>
<li><p><a href="https://developers.google.com/events/io/sessions/332838749" rel="nofollow noopener" target="_blank">Fireside Chat with the Go Team</a>（<a href="http://www.youtube.com/watch?v=p9VUCp98ay4" rel="nofollow noopener" target="_blank">ビデオ</a>）</p></li>
<li><p><a href="https://developers.google.com/events/io/sessions/327696300" rel="nofollow noopener" target="_blank">All the Ships in the World: Visualizing Data with Google Cloud and Maps</a>（<a href="http://www.youtube.com/watch?v=MT7cd4M9vzs" rel="nofollow noopener" target="_blank">ビデオ</a>）</p></li>
<li><p><a href="https://developers.google.com/events/io/sessions/356379867" rel="nofollow noopener" target="_blank">Whispering Gophers: network programming in Go</a></p></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/7f532cc883c9ba3151a8">Gowebで静的ページとRESTful APIを両方ともハンドリングする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-01 10:08:19</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[rest]</b> <b>[goweb]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>「<a href="http://localhost:8080/%E3%80%8D%E3%81%A7%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%95%E3%82%8C%E3%81%9F%E3%82%89%E3%80%81index.html%E3%82%92%E3%80%8Chttp://localhost:8080/api/%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E5%90%8D%E3%80%8D%E3%81%A7%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%95%E3%82%8C%E3%81%9F%E3%82%89Restful" class="autolink" rel="nofollow noopener" target="_blank">http://localhost:8080/」でアクセスされたら、index.htmlを「http://localhost:8080/api/リソース名」でアクセスされたらRestful</a> APIでハンドリングするには以下の様にハンドリングすればいい。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"github.com/stretchrcom/goweb/goweb"</span>
    <span class="s">"net/http"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// Gowebのコントローラーの登録とかをする</span>

    <span class="c1">// RESTful APIのハンドリング -&gt; Gowebへ</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">"/api/"</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StripPrefix</span><span class="p">(</span><span class="s">"/api"</span><span class="p">,</span> <span class="nx">goweb</span><span class="p">.</span><span class="nx">DefaultHttpHandler</span><span class="p">))</span>

    <span class="c1">// 静的ファイルのハンドリング -&gt; ファイルサーバへ</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">"static"</span><span class="p">)))</span>

    <span class="c1">// Webサーバの開始</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">"static"</span><span class="p">)))</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/8b32423de7db09181dea">[Go言語] sort.Searchでランキングを作ってみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-05 03:12:36</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>3連休なので、<a href="http://golang.org/pkg/sort/#Search" rel="nofollow noopener" target="_blank">sort.Search</a>関数を使ってみました。この関数は、ソート済みのスライスや配列をバイナリサーチするのに使います。<code>[0, n)</code>の範囲を探索し、<code>f</code>が<code>true</code>となる最初の<code>i</code>を返します。<code>f</code>は<code>[0, n)</code>の範囲で、<code>f(i+1) == true</code>であれば<code>f(i+1) == true</code>であるような関数でなければなりません。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">Search</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">f</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span><span class="p">)</span> <span class="kt">int</span>
</pre></div></div>

<p>ちょっと分かり辛いので、具体例を見てみましょう。パッケージドキュメントにある例です。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">example1.go</span></div>
<div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">:=</span> <span class="mi">23</span>
<span class="nx">i</span> <span class="o">:=</span> <span class="nx">sort</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">x</span> <span class="p">})</span>
<span class="k">if</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="c1">// x is present at data[i]</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// x is not present in data,</span>
    <span class="c1">// but i is the index where it would be inserted.</span>
<span class="p">}</span>
</pre></div>
</div>

<p>検索対象は<code>data</code>というスライスで、<code>23</code>を検索しています。<br>
もし、<code>sort.Search</code>に渡した関数は、<code>data[i] &gt;= x</code>が<code>true</code>となる最初の<code>i</code>を返します。<code>data</code>が昇順に並んでいるとすると、<code>x</code>すなわち<code>23</code>以上となる最初の添字を返すというわけです。もし、<code>23</code>が<code>data</code>にない場合は、<code>len(data)+1</code>が返ります。そのため、<code>if</code>文でやっているのは、<code>i &lt; len(data)</code>（<code>f</code>を満たす添字<code>i</code>があった）かつ<code>data[i]</code>が<code>23</code>であった、つまり<code>data</code>の中に<code>23</code>があるかないかを判定してます。</p>

<p>この<code>sort.Search</code>が便利なのは、添字で扱える点です。Go言語にはジェネリクスは無いですが、この方法であれば、添字だけを考えればいいので、どんな型のスライスや配列にも使えます。むしろ、スライスや配列である必要すらありません。<code>math/rand</code>パッケージの<a href="http://golang.org/pkg/math/rand/#Perm" rel="nofollow noopener" target="_blank">rand.Perm</a>でも添字を使った方法が使われています。</p>

<p>せっかくなので、構造体を使った例をあげてみましょう。</p>

<p><a href="http://play.golang.org/p/5u2H9WDgCt" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/5u2H9WDgCt</a></p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">ranking.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"sort"</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Item</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">id</span>    <span class="kt">string</span>
    <span class="nx">score</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">add</span><span class="p">(</span><span class="nx">items</span> <span class="p">[]</span><span class="nx">Item</span><span class="p">,</span> <span class="nx">item</span> <span class="nx">Item</span><span class="p">)</span> <span class="p">[]</span><span class="nx">Item</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="s">"&lt;="</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span>

    <span class="nx">i</span> <span class="o">:=</span> <span class="nx">sort</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">items</span><span class="p">),</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">score</span> <span class="p">&lt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">score</span> <span class="o">||</span>
            <span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">score</span> <span class="o">==</span> <span class="nx">item</span><span class="p">.</span><span class="nx">score</span> <span class="o">&amp;&amp;</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="p">&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">items</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">Item</span><span class="p">{})</span>
    <span class="nb">copy</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">:])</span>
    <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">item</span>

    <span class="k">return</span> <span class="nx">items</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">items</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">Item</span><span class="p">{}</span>
    <span class="nx">items</span> <span class="p">=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">Item</span><span class="p">{</span><span class="s">"A"</span><span class="p">,</span> <span class="mi">100</span><span class="p">})</span>
    <span class="nx">items</span> <span class="p">=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">Item</span><span class="p">{</span><span class="s">"C"</span><span class="p">,</span> <span class="mi">200</span><span class="p">})</span>
    <span class="nx">items</span> <span class="p">=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">Item</span><span class="p">{</span><span class="s">"B"</span><span class="p">,</span> <span class="mi">200</span><span class="p">})</span>
    <span class="nx">items</span> <span class="p">=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">Item</span><span class="p">{</span><span class="s">"D"</span><span class="p">,</span> <span class="mi">50</span><span class="p">})</span>
    <span class="nx">items</span> <span class="p">=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">Item</span><span class="p">{</span><span class="s">"E"</span><span class="p">,</span> <span class="mi">100</span><span class="p">})</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>要素をスコア順（降順）に並べてみる例です。<br>
同スコアだった場合はIDで辞書順になるようにしています。<br>
<code>return items[i].score &lt; item.score || (items[i].score == item.score &amp;&amp; items[i].id &gt; item.id)</code>の部分ですね。<br>
このプログラムでは、同じIDの<code>item</code>が追加された場合を考慮していません。考慮したければ、一度削除する必要があります。</p>

<p><a href="http://play.golang.org/p/SVBZPmf8Lq" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/SVBZPmf8Lq</a></p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">example2.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"sort"</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Item</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">id</span>    <span class="kt">string</span>
    <span class="nx">score</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">item</span> <span class="o">*</span><span class="nx">Item</span><span class="p">)</span> <span class="nx">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"{%s:%d}"</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">score</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Ranking</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">items</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Item</span>
    <span class="nx">m</span>     <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">Item</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Ranking</span><span class="p">)</span> <span class="nx">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"%v"</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Ranking</span><span class="p">)</span> <span class="nx">Add</span><span class="p">(</span><span class="nx">item</span> <span class="o">*</span><span class="nx">Item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="s">"&lt;="</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span>

    <span class="c1">// remove before insert</span>
    <span class="k">if</span> <span class="nx">old</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">sort</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">),</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">score</span> <span class="p">&lt;</span> <span class="nx">old</span><span class="p">.</span><span class="nx">score</span> <span class="o">||</span>
                <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">score</span> <span class="o">==</span> <span class="nx">old</span><span class="p">.</span><span class="nx">score</span> <span class="o">&amp;&amp;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">&gt;=</span> <span class="nx">old</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="nb">copy</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">:],</span> <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="kc">nil</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">items</span> <span class="p">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">delete</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">m</span><span class="p">,</span> <span class="nx">old</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">i</span> <span class="o">:=</span> <span class="nx">sort</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">),</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">score</span> <span class="p">&lt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">score</span> <span class="o">||</span>
            <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">score</span> <span class="o">==</span> <span class="nx">item</span><span class="p">.</span><span class="nx">score</span> <span class="o">&amp;&amp;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="p">&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">r</span><span class="p">.</span><span class="nx">items</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="nb">copy</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">:])</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nx">item</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="p">=</span> <span class="nx">item</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ranking</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Ranking</span><span class="p">{</span><span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">Item</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">Item</span><span class="p">)}</span>
    <span class="nx">ranking</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Item</span><span class="p">{</span><span class="s">"A"</span><span class="p">,</span> <span class="mi">100</span><span class="p">})</span>
    <span class="nx">ranking</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Item</span><span class="p">{</span><span class="s">"C"</span><span class="p">,</span> <span class="mi">200</span><span class="p">})</span>
    <span class="nx">ranking</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Item</span><span class="p">{</span><span class="s">"B"</span><span class="p">,</span> <span class="mi">200</span><span class="p">})</span>
    <span class="nx">ranking</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Item</span><span class="p">{</span><span class="s">"D"</span><span class="p">,</span> <span class="mi">50</span><span class="p">})</span>
    <span class="nx">ranking</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Item</span><span class="p">{</span><span class="s">"E"</span><span class="p">,</span> <span class="mi">100</span><span class="p">})</span>
    <span class="nx">ranking</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Item</span><span class="p">{</span><span class="s">"A"</span><span class="p">,</span> <span class="mi">200</span><span class="p">})</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ranking</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>ちょっと頑張ってみました。<br>
ランキングを構造体にしてみました。<br>
古い<code>item</code>を<code>map</code>から取得して、そのスコアを元に一度検索して、削除しています。</p>

<p>わりと簡単に<code>sort.Search</code>が使えました。面白いですね。</p>

<p>ちなみに、スライスの操作は<a href="https://code.google.com/p/go-wiki/wiki/SliceTricks" rel="nofollow noopener" target="_blank">SliceTricks</a>を参考にしました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/061e3bdf37e1a2454fbf">俺的Go研まとめ Vol.0</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-26 11:47:30</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[goken]</b> <b>[goken00]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>追記：<br>
ここにまとめられている内容は<a href="https://github.com/goken/goken" rel="nofollow noopener" target="_blank">githubのリポジトリ</a>に移動しました。</p>

<h2>
<span id="参加者" class="fragment"></span><a href="#%E5%8F%82%E5%8A%A0%E8%80%85"><i class="fa fa-link"></i></a>参加者</h2>

<ul>
<li><a href="https://twitter.com/Jxck_" rel="nofollow noopener" target="_blank">Jxck</a></li>
<li><a href="https://twitter.com/tenntenn" rel="nofollow noopener" target="_blank">tenntenn</a></li>
<li><a href="https://twitter.com/manji0112" rel="nofollow noopener" target="_blank">manji0112</a></li>
<li><a href="https://twitter.com/hogedigo" rel="nofollow noopener" target="_blank">hogedigo</a></li>
<li><a href="https://twitter.com/yssk22" rel="nofollow noopener" target="_blank">yssk22</a></li>
</ul>

<h2>
<span id="今回の概要" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>今回の概要</h2>

<ul>
<li>connpass：<a href="http://connpass.com/event/2222/" class="autolink" rel="nofollow noopener" target="_blank">http://connpass.com/event/2222/</a>
</li>
<li>発表者：Jxck</li>
<li>バージョン：go1.0.3</li>
<li>パッケージ：net/http</li>
</ul>

<h2>
<span id="話題に上がった点" class="fragment"></span><a href="#%E8%A9%B1%E9%A1%8C%E3%81%AB%E4%B8%8A%E3%81%8C%E3%81%A3%E3%81%9F%E7%82%B9"><i class="fa fa-link"></i></a>話題に上がった点</h2>

<h3>
<span id="servermux型のexplicitは何なのか" class="fragment"></span><a href="#servermux%E5%9E%8B%E3%81%AEexplicit%E3%81%AF%E4%BD%95%E3%81%AA%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>ServerMux型のexplicitは何なのか？</h3>

<p>ServerMux型は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type ServeMux struct {
    mu sync.RWMutex
    m  map[string]muxEntry
}

type muxEntry struct {
    explicit bool
    h        Handler
}
</pre></div></div>

<p>と宣言されている。<br>
このmuxEntry型のexplicitというフィールドは何の為に使用しているのか？という点が話題に挙がった。</p>

<p>ServerMux.Handleの定義（server.go:944）は以下のようになっている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>// Handle registers the handler for the given pattern.
// If a handler already exists for pattern, Handle panics.
func (mux *ServeMux) Handle(pattern string, handler Handler) {
    mux.mu.Lock()
    defer mux.mu.Unlock()

    if pattern == "" {
        panic("http: invalid pattern " + pattern)
    }
    if handler == nil {
        panic("http: nil handler")
    }
    if mux.m[pattern].explicit {
        panic("http: multiple registrations for " + pattern)
    }

    mux.m[pattern] = muxEntry{explicit: true, h: handler}

    // Helpful behavior:
    // If pattern is /tree/, insert an implicit permanent redirect for /tree.
    // It can be overridden by an explicit registration.
    n := len(pattern)
    if n &gt; 0 &amp;&amp; pattern[n-1] == '/' &amp;&amp; !mux.m[pattern[0:n-1]].explicit {
    mux.m[pattern[0:n-1]] = muxEntry{h: RedirectHandler(pattern, StatusMovedPermanently)}
    }
}
</pre></div></div>

<p>これを見ると、すでに指定したパタンにハンドラが設定してあるかどうかをチェックするフラグとして使用されている。<br>
しかし、mapはキーが「ある」か「ない」かを<a href="http://play.golang.org/p/Msxq9bIhMn" rel="nofollow noopener" target="_blank">チェックできる</a>。<br>
そのため、このフィールドが指す意味が良くわからなかった。<br>
ちなみに、explicitを設定しているのは、上記の</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mux.m[pattern] = muxEntry{explicit: true, h: handler}
</pre></div></div>

<p>の部分だけだった。</p>

<p>追記：<br>
鵜飼さんから、Google+のコミュニティでexplicitの意味を教えていただきました。<br>
<a href="https://plus.google.com/u/0/117100596700604439455/posts/bowpjrpButJ" class="autolink" rel="nofollow noopener" target="_blank">https://plus.google.com/u/0/117100596700604439455/posts/bowpjrpButJ</a></p>

<h3>
<span id="responsewriterがinterfaceな理由" class="fragment"></span><a href="#responsewriter%E3%81%8Cinterface%E3%81%AA%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>ResponseWriterがinterfaceな理由</h3>

<p>http.Handler.ServeHTTPの引数には、http.Request型とhttp.ResponseWriter型が使われている。http.Request型がstructであるのに対し、http.ResponseWriter型がinterfaceである理由について、話題に挙がった。</p>

<p>http.ResponseWriter型がinterfaceである理由は、Handlerのテストをするためではないかと推測できる。理由は、net/http/httptestパッケージのhttptest.ResponseRecorder型を見れば分かる。httptest.ResponseRecorder型では、Handlerの返したレスポンスを記録し、あとで取得することができる。そして、返したレスポンスを取得し、想定していたものと同じものがレスポンスされたかどうかチェックすることができる。</p>

<p>このように、レスポンスについては、本番用は通常通りクライアントサイドにレスポンスする。一方で、単体テストでは、httptest.ResponseRecorderの内部にレスポンスを保持することで、テストを容易にしている。</p>

<h3>
<span id="importについて" class="fragment"></span><a href="#import%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>importについて</h3>

<p>import文について以下の2点が話題に挙がった。</p>

<h4>
<span id="import--パッケージ" class="fragment"></span><a href="#import--%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>import . "パッケージ"</h4>

<p>「.」を使うことで、Javaのstaticインポートのようなことができる。つまり、「.」で別名を付けたパッケージのメンバはパッケージ名無しで呼び出すことができる（<a href="http://play.golang.org/p/--dWV6PHYA" rel="nofollow noopener" target="_blank">参考</a>）。</p>

<h4>
<span id="import-_-パッケージ" class="fragment"></span><a href="#import-_-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>import _ "パッケージ"</h4>

<p>「<em>」をつけることで、未使用のパッケージがあってもコンパイルエラーを出さなくて済む（<a href="http://play.golang.org/p/EcgE0plkD9" rel="nofollow noopener" target="_blank">参考</a>）。<br>
また、「</em>」を付けてインポートしても、そのパッケージのinit関数は呼ばれる（<a href="https://github.com/golang-samples/basic/tree/master/import/underscore" rel="nofollow noopener" target="_blank">参考</a>）。</p>

<h3>
<span id="httpdefaultservemuxについて" class="fragment"></span><a href="#httpdefaultservemux%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>http.DefaultServeMuxについて</h3>

<p>http.Server型の定義は以下のようになっている(server.go:997)。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>// A Server defines parameters for running an HTTP server.
type Server struct {
    Addr           string        // TCP address to listen on, ":http" if empty
    Handler        Handler       // handler to invoke, http.DefaultServeMux if nil
    ReadTimeout    time.Duration // maximum duration before timing out read of the request
    WriteTimeout   time.Duration // maximum duration before timing out write of the response
    MaxHeaderBytes int           // maximum size of request headers, DefaultMaxHeaderBytes if 0
    TLSConfig      *tls.Config   // optional TLS config, used by ListenAndServeTLS
}
</pre></div></div>

<p>http.ListenAndServe関数では、このうちのhttp.Server.Addrをhttp.Server.Handlerを以下のように設定している。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>func ListenAndServe(addr string, handler Handler) error {
    server := &amp;Server{Addr: addr, Handler: handler}
    return server.ListenAndServe()
}
</pre></div></div>

<p>ここで設定されたHandlerがリクエストを捌く際に使用される（<a href="http://www.slideshare.net/takuyaueda967/go-webgocon-2013-spring" rel="nofollow noopener" target="_blank">参考</a>）。この値がnilである場合は、代わりにhttp.DefaultServeMuxが使用される。なお、http.Handle関数などは、このhttp.DefaultServeMuxに対してのラッパーである。そのため、http.Server.Handlerがnilでない場合は、http.Server.Handlerに設定した値が優先されるため、http.Handleやhttp.HandleFuncでいくらハンドラを設定しても意味がない。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/954c7b48fe4b1ca8a368">[JS]KnockoutJS 3.0 Upgrade Noteを読む 第1弾</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-27 18:51:19</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[knockoutjs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>KnockoutJSの3.0がリリースされましたね。<br>
Upgrade Notesを読んで分かった事をまとめます。<br>
今回は、「1. Computed properties now notify only when their value changes」を読みます。</p>

<p>説明を読むと、2.xまでは<code>computed</code>が評価された際は、必ず変更したとういう通知が行くそうです。<code>subscribe</code>でコールバックを仕掛ければ、その通知を受取ることができます。3.0では、<code>computed</code>が評価された結果が前回と同じであれば、通知がいかないようになっています。</p>

<p>文章だけ見ると、分かったようで分からないので、KnockoutJSのソースコードを読みましょう。</p>

<h2>
<span id="230のコード" class="fragment"></span><a href="#230%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>2.3.0のコード</h2>

<p>2.3.0のコードを見てみます。<br>
<a href="https://github.com/knockout/knockout/blob/v2.3.0/src/subscribables/dependentObservable.js#L80-L84" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/knockout/knockout/blob/v2.3.0/src/subscribables/dependentObservable.js#L80-L84</a></p>

<p><code>evaluateImmediate</code>が呼ばれると、値の更新とその事の通知が行なわれているのが分かります。ただし、依存しているobservableが更新されないと<code>evaluateImmediate</code>が呼ばれずに、前回評価した値を使うので注意が必要です。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">2.3.0.dependentObservable.js</span></div>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">evaluateImmediate</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//...</span>
    <span class="c1">// ここで値の更新と通知している</span>
    <span class="nx">dependentObservable</span><span class="p">[</span><span class="s2">"notifySubscribers"</span><span class="p">](</span><span class="nx">_latestValue</span><span class="p">,</span> <span class="s2">"beforeChange"</span><span class="p">);</span>
    <span class="nx">_latestValue</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span>
    <span class="nx">dependentObservable</span><span class="p">[</span><span class="s2">"notifySubscribers"</span><span class="p">](</span><span class="nx">_latestValue</span><span class="p">);</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="300のコード" class="fragment"></span><a href="#300%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>3.0.0のコード</h2>

<p>次に、3.0.0のコードを見てみます。<br>
<a href="https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependentObservable.js#L85-L91" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/knockout/knockout/blob/v3.0.0/src/subscribables/dependentObservable.js#L85-L91</a></p>

<p>2.3.0に無かったif文が追加されているのが分かります。<br>
見ての通り、値に変化がなかったら更新も通知もしないというものです。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">3.0.0.dependentObservable.js</span></div>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">evaluateImmediate</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//...</span>
    <span class="c1">// 変更なければ、更新も通知もしない</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dependentObservable</span><span class="p">[</span><span class="s1">'equalityComparer'</span><span class="p">]</span> <span class="o">||</span> <span class="o">!</span><span class="nx">dependentObservable</span><span class="p">[</span><span class="s1">'equalityComparer'</span><span class="p">](</span><span class="nx">_latestValue</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">dependentObservable</span><span class="p">[</span><span class="s2">"notifySubscribers"</span><span class="p">](</span><span class="nx">_latestValue</span><span class="p">,</span> <span class="s2">"beforeChange"</span><span class="p">);</span>
        <span class="nx">_latestValue</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">;</span>
        <span class="nx">dependentObservable</span><span class="p">[</span><span class="s2">"notifySubscribers"</span><span class="p">](</span><span class="nx">_latestValue</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>

<h3>
<span id="動かして違いを見る" class="fragment"></span><a href="#%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E9%81%95%E3%81%84%E3%82%92%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>動かして違いを見る</h3>

<p>ソースコード上の違いが分かったので、実際に動きの違いを見てみましょう。<br>
以下のコードには、<code>n</code>という<code>observable</code>と<code>evenN</code>という<code>computed</code>がでてきます。<code>n</code>には数値が入り、<code>evenN</code>は<code>n</code>が偶数だったら<code>true</code>を返すようにしてあります。<br>
2.xの場合、<code>evenN</code>の結果が同じでも通知がいきます。例えば、以下のコードでは、はじめ<code>n</code>に<code>10</code>が入っており、その後<code>20</code>に変わっています。どちらも偶数なので、<code>evenN</code>は共に<code>true</code>になります。<code>evenN</code>の値は変わっていないので、通知はいってほしくないですが、2.xの場合は通知がいってしまいます。<br>
一方、3.0.0の場合は、<code>n(20)</code>では<code>evenN</code>の値は変わらないので、通知はいいません。<code>n(21)</code>では、奇数になるので、<code>evenN</code>の値は<code>false</code>となるので、通知がいきます。</p>

<p>JSFiddleで動作を確認してみましょう。<br>
2.3.0：<a href="http://jsfiddle.net/uedatakuya/TdErN/" class="autolink" rel="nofollow noopener" target="_blank">http://jsfiddle.net/uedatakuya/TdErN/</a><br>
3.0.0：<a href="http://jsfiddle.net/uedatakuya/xxK9E/" class="autolink" rel="nofollow noopener" target="_blank">http://jsfiddle.net/uedatakuya/xxK9E/</a></p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">evenN</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isEven</span> <span class="o">=</span> <span class="nx">n</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">isEven</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">isEven</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">isEven</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">evenN</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"change evenN to "</span> <span class="o">+</span> <span class="nx">newValue</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"change evenN to "</span> <span class="o">+</span> <span class="nx">newValue</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">n</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="nx">n</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span>
</pre></div></div>

<h3>
<span id="挙動が変わると困る場合" class="fragment"></span><a href="#%E6%8C%99%E5%8B%95%E3%81%8C%E5%A4%89%E3%82%8F%E3%82%8B%E3%81%A8%E5%9B%B0%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>挙動が変わると困る場合</h3>

<p>上述のように、3.0.0では2.xと挙動が変わります。2.xの挙動と同じようにしたい場合は、Upgrade Notesに書いてある通り、<code>myComputed.extend({ notify: 'always' });</code>のように、必ず通知がいくようにしましょう。</p>

<p><a href="http://jsfiddle.net/uedatakuya/sKHgg/" class="autolink" rel="nofollow noopener" target="_blank">http://jsfiddle.net/uedatakuya/sKHgg/</a></p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">evenN</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">computed</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isEven</span> <span class="o">=</span> <span class="nx">n</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">isEven</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">isEven</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">isEven</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 必ず通知がいくようにする</span>
<span class="nx">evenN</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">notify</span><span class="o">:</span> <span class="s1">'always'</span><span class="p">});</span>

<span class="nx">evenN</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">"change evenN to "</span> <span class="o">+</span> <span class="nx">newValue</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"change evenN to "</span> <span class="o">+</span> <span class="nx">newValue</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">n</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="nx">n</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/64d633a68c61454df82e">[Go言語] templateパッケージでtwigとかのextends的なあれをやるにはどうしようか</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-29 16:14:13</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h1>

<p>twigでいくと以下のようなやつ。<br>
でも、デフォルトがあってそれを上書きするとかいう機能は別にいらない。<br>
共通部分を使い回せればそれでいい。</p>

<p>参考：<a href="http://twig.sensiolabs.org/doc/tags/extends.html" class="autolink" rel="nofollow noopener" target="_blank">http://twig.sensiolabs.org/doc/tags/extends.html</a></p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">base.html</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        {% block head %}
            <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"style.css"</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block title %}{% endblock %} - My Webpage<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
        {% endblock %}
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"content"</span><span class="p">&gt;</span>{% block content %}{% endblock %}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"footer"</span><span class="p">&gt;</span>
            {% block footer %}
                <span class="ni">&amp;copy;</span> Copyright 2011 by <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"http://domain.invalid/"</span><span class="p">&gt;</span>you<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.
            {% endblock %}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">child.html</span></div>
<div class="highlight"><pre><span></span>{% extends "base.html" %}

{% block title %}Index{% endblock %}
{% block head %}
    {{ parent() }}
    <span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/css"</span><span class="p">&gt;</span>
        <span class="p">.</span><span class="nc">important</span> <span class="p">{</span> <span class="k">color</span><span class="p">:</span> <span class="mh">#336699</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
{% endblock %}
{% block content %}
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Index<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">"important"</span><span class="p">&gt;</span>
        Welcome on my awesome homepage.
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>

<h1>
<span id="やってみた" class="fragment"></span><a href="#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F"><i class="fa fa-link"></i></a>やってみた</h1>

<p>とりあえず、PlayGroundでやってみた。</p>

<p><a href="http://play.golang.org/p/YQd6ChZFqd" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/YQd6ChZFqd</a></p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"os"</span>
    <span class="s">"text/template"</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">layoutStr</span> <span class="p">=</span> <span class="s">`{{define "layout"}}header</span>
<span class="s">{{template "content"}}</span>
<span class="s">footer{{end}}`</span>

<span class="kd">var</span> <span class="nx">hogeStr</span> <span class="p">=</span> <span class="s">`{{define "content"}}hoge{{end}}`</span>

<span class="kd">var</span> <span class="nx">piyoStr</span> <span class="p">=</span> <span class="s">`{{define "content"}}piyo{{end}}`</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">hoge</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">).</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">hogeStr</span><span class="p">))</span>
    <span class="nx">hoge</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">layoutStr</span><span class="p">)</span>
    <span class="nx">hoge</span><span class="p">.</span><span class="nx">ExecuteTemplate</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">,</span> <span class="s">"layout"</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">()</span>

    <span class="nx">piyo</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">"piyo"</span><span class="p">).</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">piyoStr</span><span class="p">))</span>
    <span class="nx">piyo</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">layoutStr</span><span class="p">)</span>
    <span class="nx">piyo</span><span class="p">.</span><span class="nx">ExecuteTemplate</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">,</span> <span class="s">"layout"</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>

<span class="p">}</span>
</pre></div>
</div>

<h1>
<span id="もっとちゃんとやってみた" class="fragment"></span><a href="#%E3%82%82%E3%81%A3%E3%81%A8%E3%81%A1%E3%82%83%E3%82%93%E3%81%A8%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F"><i class="fa fa-link"></i></a>もっとちゃんとやってみた</h1>

<p><a href="https://github.com/golang-samples/template/tree/master/extends" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/golang-samples/template/tree/master/extends</a></p>

<h2>
<span id="baseを作る" class="fragment"></span><a href="#base%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>baseを作る</h2>

<p>まずは、baseとなるhtmlを作る。<br>
テンプレートの名前は、<code>base</code>としておく。<br>
<code>template</code>で<code>content</code>という別のテンプレートを読み込んでいる。</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">base.html</span></div>
<div class="highlight"><pre><span></span>{{define "base"}}
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

      <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Title of {{.}}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"hoge"</span><span class="p">&gt;</span>Hoge<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"piyo"</span><span class="p">&gt;</span>Piyo<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>

      <span class="p">&lt;</span><span class="nt">article</span> <span class="na">id</span><span class="o">=</span><span class="s">"content"</span><span class="p">&gt;</span>
        {{template "content" .}}
      <span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>

      <span class="p">&lt;</span><span class="nt">footer</span><span class="p">&gt;</span>
        <span class="ni">&amp;copy;</span> Copyright 2013 by golang-samples.
      <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
{{end}}
</pre></div>
</div>

<h2>
<span id="コンテンツを作る" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>コンテンツを作る</h2>

<p>続いて、コンテンツとなるhtmlを作る。<br>
<code>base.html</code>に埋め込まれるので、テンプレートの名前は2つとも<code>content</code>にしておく。</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">hoge.html</span></div>
<div class="highlight"><pre><span></span>{{define "content"}}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hoge<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
  I'm Hoge.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{{end}}
</pre></div>
</div>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">piyo.html</span></div>
<div class="highlight"><pre><span></span>{{define "content"}}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Piyo<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
  I'm Piyo.
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
{{end}}
</pre></div>
</div>

<h2>
<span id="goから読み込む" class="fragment"></span><a href="#go%E3%81%8B%E3%82%89%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>Goから読み込む</h2>

<p>以下のように、別々のテンプレートとしてパースすることで、<code>content</code>という名前が被ってもできる。もちろん、<code>ParseGlob</code>とかで一気にパースするとダメ。</p>

<p>ベースで指定した部分を上書きするtwigのextendsの方が自由度高いが、まぁコレくらいできたら別にいいや。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"html/template"</span>
    <span class="s">"net/http"</span>
<span class="p">)</span>

<span class="kd">var</span> <span class="nx">hogeTmpl</span> <span class="p">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">"hoge"</span><span class="p">).</span><span class="nx">ParseFiles</span><span class="p">(</span><span class="s">"base.html"</span><span class="p">,</span> <span class="s">"hoge.html"</span><span class="p">))</span>

<span class="kd">func</span> <span class="nx">hogeHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">hogeTmpl</span><span class="p">.</span><span class="nx">ExecuteTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">"base"</span><span class="p">,</span> <span class="s">"Hoge"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">piyoTmpl</span> <span class="p">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">"piyo"</span><span class="p">).</span><span class="nx">ParseFiles</span><span class="p">(</span><span class="s">"base.html"</span><span class="p">,</span> <span class="s">"piyo.html"</span><span class="p">))</span>

<span class="kd">func</span> <span class="nx">piyoHandler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">piyoTmpl</span><span class="p">.</span><span class="nx">ExecuteTemplate</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">"base"</span><span class="p">,</span> <span class="s">"Piyo"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// hoge</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="nx">hogeHandler</span><span class="p">)</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">"/hoge"</span><span class="p">,</span> <span class="nx">hogeHandler</span><span class="p">)</span>

    <span class="c1">// piyo</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">"/piyo"</span><span class="p">,</span> <span class="nx">piyoHandler</span><span class="p">)</span>

    <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">":8080"</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />22位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/f2a154dd436c0fa37c5b">[Go言語] 埋め込んだときに、メソッド名が被っててインタフェースを実装できない場合はどうするのか？</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-29 16:42:03</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="明示的に判別ないとインタフェースの型として振る舞えない" class="fragment"></span><a href="#%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AB%E5%88%A4%E5%88%A5%E3%81%AA%E3%81%84%E3%81%A8%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AE%E5%9E%8B%E3%81%A8%E3%81%97%E3%81%A6%E6%8C%AF%E3%82%8B%E8%88%9E%E3%81%88%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>明示的に判別ないとインタフェースの型として振る舞えない</h2>

<p>以下のように、同じ<code>Name</code>というメソッドを持つ構造体を埋め込むと、<code>Named</code>という<code>Name</code>を持つインタフェースを実装できない。<br>
なぜならば、<code>Hoge</code>の<code>Name</code>を呼べばいいのか、<code>Piyo</code>の<code>Name</code>を呼べばいいのか分からない。<br>
もちろん、<code>Foo</code>型として振る舞っているときは明示的に埋め込んでいる型を指定すれば、呼び出せる。</p>

<p><a href="http://play.golang.org/p/oRWf4VQnql" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/oRWf4VQnql</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import "fmt"

type Named interface {
    Name() string
}

type Hoge struct {
}

func (_ *Hoge) Name() string {
    return "Hoge"
}

func (_ *Hoge) HogeMethod() {
    fmt.Println("Hoge Method!")
}

type Piyo struct {
}

func (_ *Piyo) Name() string {
    return "Piyo"
}

func (_ *Piyo) PiyoMethod() {
    fmt.Println("Piyo Method!")
}

type Foo struct {
    *Hoge
    *Piyo
}

func hello(named Named) {
    fmt.Println("Hello", named.Name())
}

func main() {
    hoge := &amp;Hoge{}
    piyo := &amp;Piyo{}
    foo := &amp;Foo{hoge, piyo}

    fmt.Println(foo.Hoge.Name())
    fmt.Println(foo.Piyo.Name())

    foo.HogeMethod()
    foo.PiyoMethod()

    hello(foo)
}
</pre></div></div>

<h2>
<span id="明示的に定義する" class="fragment"></span><a href="#%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AB%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>明示的に定義する</h2>

<p>どっちか分からないなら<code>Foo</code>のメソッドとして、明示定義してやればいい。</p>

<p><a href="http://play.golang.org/p/xYMbf7oO3J" class="autolink" rel="nofollow noopener" target="_blank">http://play.golang.org/p/xYMbf7oO3J</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>func (f *Foo) Name() string {
    return f.Piyo.Name()
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />23位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/ce053f1ff89b9f7ae4cd">俺的Go研まとめ Vol.1</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-26 23:11:54</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[goken]</b> <b>[goken01]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>追記：<br>
ここにまとめられている内容は<a href="https://github.com/goken/goken" rel="nofollow noopener" target="_blank">githubのリポジトリ</a>に移動しました。</p>

<h2>
<span id="参加者" class="fragment"></span><a href="#%E5%8F%82%E5%8A%A0%E8%80%85"><i class="fa fa-link"></i></a>参加者</h2>

<ul>
<li><a href="https://twitter.com/Jxck_" rel="nofollow noopener" target="_blank">Jxck</a></li>
<li><a href="https://twitter.com/tenntenn" rel="nofollow noopener" target="_blank">tenntenn</a></li>
<li><a href="https://twitter.com/manji0112" rel="nofollow noopener" target="_blank">manji0112</a></li>
<li><a href="https://twitter.com/hogedigo" rel="nofollow noopener" target="_blank">hogedigo</a></li>
</ul>

<h2>
<span id="今回の概要" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>今回の概要</h2>

<ul>
<li>connpass：<a href="http://connpass.com/event/2355/" class="autolink" rel="nofollow noopener" target="_blank">http://connpass.com/event/2355/</a>
</li>
<li>発表者：hogedigo</li>
<li>バージョン：go1.1</li>
<li>パッケージ：io</li>
</ul>

<h2>
<span id="話題に上がった点" class="fragment"></span><a href="#%E8%A9%B1%E9%A1%8C%E3%81%AB%E4%B8%8A%E3%81%8C%E3%81%A3%E3%81%9F%E7%82%B9"><i class="fa fa-link"></i></a>話題に上がった点</h2>

<h3>
<span id="eof" class="fragment"></span><a href="#eof"><i class="fa fa-link"></i></a>EOF</h3>

<p>EOFを表すerrorには、io.EOFとio. ErrUnexpectedEOFがある。io.EOFは期待しているEOFに使用する。一方で、io. ErrUnexpectedEOFは期待しないEOFの場合に使用する。io.EOFについては、error型ではあるがエラーという扱いはあまりしないようだ。</p>

<h3>
<span id="ioreaderインタフェース" class="fragment"></span><a href="#ioreader%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>io.Readerインタフェース</h3>

<p>io.Reader.Readメソッドは、n( &gt; 0), io.EOFが返される場合があるため、単にEOFをチェックするだけでループを抜けると最後のnバイト分飛ばしてしまう。</p>

<h3>
<span id="ioseekerseekメソッドの引数whence" class="fragment"></span><a href="#ioseekerseek%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E5%BC%95%E6%95%B0whence"><i class="fa fa-link"></i></a>io.Seeker.Seekメソッドの引数whence</h3>

<p>io.Seekerインタフェースは以下のように定義されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type Seeker interface {
        Seek(offset int64, whence int) (ret int64, err error)
}
</pre></div></div>

<p>Seekメソッドは、第2引数にwhence（どこから）として、0〜2の値をとる。それぞれの値の意味は以下の通りである。</p>

<ul>
<li>0: ファイルの先頭から</li>
<li>1: 現在のオフセットの位置から</li>
<li>2: ファイルの末尾から</li>
</ul>

<p>これらの値は、定数で宣言されていない。そのため、なぜ以下のように定義しないのかという点が議論に挙がった（<a href="http://play.golang.org/p/GqU3Yot0S3" rel="nofollow noopener" target="_blank">参考</a>）。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type Whence int
const (
    HEAD Whence = iota
    CURRENT
    END
)
</pre></div></div>

<h3>
<span id="ioreaderfromインタフェースとiowritertoインタフェース" class="fragment"></span><a href="#ioreaderfrom%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%A8iowriterto%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>io.ReaderFromインタフェースとio.WriterToインタフェース</h3>

<p>io.ReaderFromインタフェースは、以下のように定義されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type ReaderFrom interface {
        ReadFrom(r Reader) (n int64, err error)
}
</pre></div></div>

<p>また、io.WriterToインタフェースは、以下のように定義されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type WriterTo interface {
        WriteTo(w Writer) (n int64, err error)
}
</pre></div></div>

<p>名前から想像すると、io.ReaderFromは読み込み処理を行なうように思える。しかし、実際には引数で渡されたio.Readerから読み込みを行い、その後何かしらの処理を行なうというインタフェースである。例えば、以下のような、io.Copy関数ではこのインタフェースを実装していると期待されているのは、第1引数のdstであり、これはio.Writerインタフェースを実装している。つまり、io.ReaderFromインタフェースは、io.WriterなどのWriterが書き込むデータの提供元を保証するインタフェースとなっている。また、反対にio.WriterToインタフェースもReaderが読み込んだデータの提供先を保証するインタフェースとなっている。なお、io.Copy関数では、srcがio.WriterToを実装していることを期待されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>func Copy(dst Writer, src Reader) (written int64, err error)
</pre></div></div>

<h3>
<span id="引数のwriter出力先とreader入力元の順序" class="fragment"></span><a href="#%E5%BC%95%E6%95%B0%E3%81%AEwriter%E5%87%BA%E5%8A%9B%E5%85%88%E3%81%A8reader%E5%85%A5%E5%8A%9B%E5%85%83%E3%81%AE%E9%A0%86%E5%BA%8F"><i class="fa fa-link"></i></a>引数のWriter（出力先）とReader（入力元）の順序</h3>

<p>上述のio.Copy関数のように、Go言語では、出力先と入力元の順序が他の言語と逆になっていることが多い。例えば、http.HandlerのServeHTTPメソッドもhttp.ResponseWriterが第1引数で、http.Requestが第2引数である。</p>

<h3>
<span id="ioreaderatインタフェース" class="fragment"></span><a href="#ioreaderat%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>io.ReaderAtインタフェース</h3>

<p>io.ReaderAtインタフェースは以下のように定義されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type ReaderAt interface {
        ReadAt(p []byte, off int64) (n int, err error)
}
</pre></div></div>

<p>第2引数はoffsetであり、読み込み開始位置がoffset分ずれて読み込まれる。<br>
一方、io.Seeker.Seekメソッドでは、次の読み込み／書き込み開始位置をoffset分ずらす役割があるが、第1戻り値で新しいoffsetを返すことができる。</p>

<p>また、ReadAtメソッドは、n &lt; len(p)のとき、全データを読み込むかエラーが起きるまでブロックする。一方、io.Reader.Readメソッドはブロックしない。<br>
つまり、ReadAtメソッドは、戻り値のnがn &lt; len(p)のとき、エラーにてその理由を返す。<br>
呼び出し側は、同じソースからReadAtメソッドを使用してパラレルに読み込んでよい。</p>

<h3>
<span id="iowriteratインタフェース" class="fragment"></span><a href="#iowriterat%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>io.WriterAtインタフェース</h3>

<p>io.WriterAtインタフェースは以下のように定義されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type WriterAt interface {
        WriteAt(p []byte, off int64) (n int, err error)
}
</pre></div></div>

<p>オーバーラップしていなければ、io.WriterAt.WriteAtメソッドは、パラレルに書き込んで良い。</p>

<h3>
<span id="iobytescannerunreadbyteメソッド" class="fragment"></span><a href="#iobytescannerunreadbyte%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>io.ByteScanner.UnreadByteメソッド</h3>

<p>io.ByteScannerインタフェースは以下のように定義されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type ByteScanner interface {
    ByteReader
    UnreadByte() error
}
</pre></div></div>

<p>UnreadByteメソッドは、読み込んだバイトを読み込まなかった事にし、次のReadByte()メソッドで前回読み込んだバイトと同じものを返す。<br>
<a href="http://golang.org/src/pkg/net/textproto/reader.go:159" rel="nofollow noopener" target="_blank">net/textproto/reader.go</a>のskipSpace()で、空白を飛ばしていき、空白以外が来たら1バイト戻って、最後の空白の次から処理をするという使われ方をしている。</p>

<h3>
<span id="stringerwriterインタフェースについて" class="fragment"></span><a href="#stringerwriter%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>stringerWriterインタフェースについて</h3>

<p>io.stringerWriterインタフェースは、<a href="http://golang.org/src/pkg/io/io.go" rel="nofollow noopener" target="_blank">io/io.go</a>でWriteStringを実装しているかどうかをチェックする為だけに使われている。</p>

<h3>
<span id="iocopyの戻り値のint64について" class="fragment"></span><a href="#iocopy%E3%81%AE%E6%88%BB%E3%82%8A%E5%80%A4%E3%81%AEint64%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>io.Copyの戻り値のint64について</h3>

<p>io.Copyの戻り値のint64を超えるようなコピーが行なわれた場合、オーバーフローし、マイナスの値をとることもあるのではないか？<br>
例えば、あるReaderから入ってきたデータをそのままあるWriterに受け流すような処理があり、その処理が常時行なわれるようなものだった場合、そのうちint64の範囲を超えるのではないか？<br>
ちなみに、オーバーフローを起こしても、panicにはならない。</p>

<h3>
<span id="iolimitedreaderはデコレータパターン" class="fragment"></span><a href="#iolimitedreader%E3%81%AF%E3%83%87%E3%82%B3%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>io.LimitedReaderはデコレータパターン</h3>

<p>io.LimitedReader型は以下のように定義されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>type LimitedReader struct {
    R Reader // underlying reader
    N int64  // max bytes remaining
}
</pre></div></div>

<p>実際の読み込む処理については、LimitedReader.Rに<a href="https://code.google.com/p/go/source/browse/src/pkg/io/io.go#387" rel="nofollow noopener" target="_blank">任せており</a>、これはデザインパターンのデコレータパターンになっている。</p>

<h3>
<span id="ioteereader関数" class="fragment"></span><a href="#ioteereader%E9%96%A2%E6%95%B0"><i class="fa fa-link"></i></a>io.TeeReader関数</h3>

<p>io.TeeReader関数は以下の様な関数である。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>func TeeReader(r Reader, w Writer) Reader
</pre></div></div>

<p>この関数は、Unix/Linuxコマンドのteeと同じような働きをする。<br>
戻り値で返されたReaderのReadメソッドで読み込むと、その内容がwで指定したWriterに書き込まれる。<br>
実際の読み込みには引数rで指定したReaderが使用される。</p>

<h3>
<span id="bufioパッケージ" class="fragment"></span><a href="#bufio%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>bufioパッケージ</h3>

<p>bufio は buffer を使ってシステムコールを減らす。<br>
（詳細を忘れました）</p>

<h3>
<span id="_testgoファイル" class="fragment"></span><a href="#_testgo%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB"><i class="fa fa-link"></i></a>_test.goファイル</h3>

<p><em>test.goに書いたものはコンパイル対象から外れる。<br>
src/pkg/runtime/以下にある_linux.goなどのファイルはコンパイル時に環境によってうまく使用するファイルを選ぶのか？<br>
たとえば、linuxの場合は</em>linux.goをコンパイルに含めるが、windowsのものは含めないとか。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />24位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>6</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/ca8f67d013870ec2e29a">gem install bundleでlibがないってエラーが出たら</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-13 11:30:10</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[bundle]</b> <b>[Gem]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>rbenvとかで以下の様なエラーが出た場合の対処法</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo gem install bundle
Fetching: bundler-1.2.3.gem (100%)
Fetching: bundle-0.0.1.gem (100%)
Successfully installed bundler-1.2.3
Successfully installed bundle-0.0.1
2 gems installed
Installing ri documentation for bundler-1.2.3...
Installing ri documentation for bundle-0.0.1...
file 'lib' not found
Installing RDoc documentation for bundler-1.2.3...
Installing RDoc documentation for bundle-0.0.1...
file 'lib' not found
</pre></div></div>

<p>先にrdocをインストールするだけでよい</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo gem install rdoc
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />25位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/bd8daa5fae2934e973e8">Go言語で使えるAWSのライブラリ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-04 21:58:31</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[AWS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>使い方は良くわからないけど、メモ</p>

<h1>
<span id="githubcomkrs3" class="fragment"></span><a href="#githubcomkrs3"><i class="fa fa-link"></i></a><a href="https://github.com/kr/s3" rel="nofollow noopener" target="_blank">github.com/kr/s3</a>
</h1>

<p>使った事無い</p>

<h1>
<span id="goamz" class="fragment"></span><a href="#goamz"><i class="fa fa-link"></i></a><a href="https://wiki.ubuntu.com/goamz" rel="nofollow noopener" target="_blank">goamz</a>
</h1>

<ul>
<li><a href="https://github.com/golang-samples/goamz/tree/master/s3/simple" rel="nofollow noopener" target="_blank">S3のサンプル</a></li>
</ul>

<h1>
<span id="githubcombmizeranyaws4" class="fragment"></span><a href="#githubcombmizeranyaws4"><i class="fa fa-link"></i></a><a href="https://github.com/bmizerany/aws4" rel="nofollow noopener" target="_blank">github.com/bmizerany/aws4</a>
</h1>

<p>使った事無い</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />26位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/6d2945c36dec84e1f21d">KnockoutJSのcomputedにおける依存関係の仕組み for v.2.2.1</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-03 11:39:53</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[knockoutjs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下のように、computed（dependentObservable）の<a href="https://github.com/knockout/knockout/blob/v2.2.1/src/subscribables/dependentObservable.js#L40" rel="nofollow noopener" target="_blank">evaluateImmediate</a>は作られた際とそれを関数呼び出しした際に呼ばれる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>var x = ko.observable(1);
var y = ko.observable(2);

// 1回目
var sum = ko.computed(function(){
    return x() + y();
});

// 2回目
console.log(sum());
</pre></div></div>

<p>evaluateImmediateが呼ばれると、内部で<a href="https://github.com/knockout/knockout/blob/v2.2.1/src/subscribables/dependencyDetection.js#L6" rel="nofollow noopener" target="_blank">ko.dependencyDetection.begin</a>が<a href="https://github.com/knockout/knockout/blob/v2.2.1/src/subscribables/dependentObservable.js#L63" rel="nofollow noopener" target="_blank">呼ばれる</a>。<br>
beginが呼ばれた後に、ko.computedでdependentObservableを作った際に渡した関数（上記の例だとxとyを足している関数）を<a href="https://github.com/knockout/knockout/blob/v2.2.1/src/subscribables/dependentObservable.js#L71" rel="nofollow noopener" target="_blank">呼び出す</a>。<br>
この関数内(readFunction)で、依存しているobservableが呼び出される。上記の例では、x()とy()が実行されている。<br>
observableの<a href="https://github.com/knockout/knockout/blob/v2.2.1/src/subscribables/observable.js#L21" rel="nofollow noopener" target="_blank">値の読み出し</a>が行なわれると、<a href="https://github.com/knockout/knockout/blob/v2.2.1/src/subscribables/dependencyDetection.js#L14" rel="nofollow noopener" target="_blank">ko.dependencyDetection.registerDependency</a>が呼び出される。<br>
ko.dependencyDetection.registerDependencyでは、最後にbeginして、endが呼び出されていない依存関係のチェーンに対して、呼び出されたobservableを<a href="https://github.com/knockout/knockout/blob/v2.2.1/src/subscribables/dependencyDetection.js#L21" rel="nofollow noopener" target="_blank">追加している</a>。<br>
上記の例では、xとyがsumで作られた依存チェーンに登録される。<br>
evaluateImmediate内でendが<a href="https://github.com/knockout/knockout/blob/v2.2.1/src/subscribables/dependentObservable.js#L84" rel="nofollow noopener" target="_blank">呼び出される</a>と依存チェーンの登録対象から外れる。</p>

<p>このように、computedが依存している、obsearvableを検知して依存関係を構築している。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tenntennさんの<br />27位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/tenntenn/items/8f07fa641589bc02c073">俺的Go研まとめ 一覧</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-26 23:12:58</center>
	</td>
	<td style="width:200px;">
		@tenntenn<br />(Souzoh, Inc. (affiliated by Mercari, Inc.) 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14952/profile-images/1476846346">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[goken]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>追記：<br>
ここにまとめられている内容は<a href="https://github.com/goken/goken" rel="nofollow noopener" target="_blank">githubのリポジトリ</a>に移動しました。</p>

<p>Go研を個人的にまとめています。<br>
随時更新していきます。</p>

<ul>
<li>
<a href="http://qiita.com/items/061e3bdf37e1a2454fbf">vol.0</a> 2013/04/24</li>
<li>
<a href="http://qiita.com/private/ce053f1ff89b9f7ae4cd">vol.1</a> 2013/05/15</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
