<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (tadsan)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (tadsan さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1963</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/99d816e78ca429093b75">ライセンスの選択を恐れる必要はありません</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-07 01:12:52</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ライセンス]</b> <b>[GPL]</b> <b>[MIT-License]</b> <b>[ApacheLicense]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><del>この記事は<a href="http://creativecommons.org/licenses/by/3.0/" rel="nofollow noopener" target="_blank">CC BY 3.0</a>に基いて公開されてゐるWebサイト<a href="http://choosealicense.com/" rel="nofollow noopener" target="_blank">Choosing an OSS license doesn’t need to be scary - ChooseALicense.com</a>のコンテンツ各ページを翻訳し、単一記事として再構成、訳者による補足を追加したものです</del>。</p>

<div class=""><ins datetime="2017-05-09T20:45:00+09:00">2017年5月9日に<a href="http://blog.qiita.com/post/160423117339/communityguideline" rel="nofollow noopener" target="_blank">開示</a>された<a href="http://help.qiita.com/ja/articles/qiita-community-guideline" rel="nofollow noopener" target="_blank">コミュニティガイドライン</a>に伴って、本記事の翻訳部分につきましては削除いたしました。 (この記事が削除または非公開化されない限り、<a href="http://qiita.com/tadsan/items/99d816e78ca429093b75/revisions">編集履歴</a>からお読みいただくことは可能です。)</ins></div>

<div class="">日本語での自由ソフトウェア/オープンソースライセンスについての紹介については、<a href="http://www.catch.jp/" rel="nofollow noopener" target="_blank">可知豊</a>(@<a href="https://twitter.com/y_catch" rel="nofollow noopener" target="_blank">y_catch</a>)先生の<a href="http://www.catch.jp/oss-license/2013/09/10/github/" rel="nofollow noopener" target="_blank">Githubによる、オープンソースライセンスの選び方 | オープンソース・ライセンスの談話室</a>をオススメします。</div>

<p><em>(訳註:  この「はじめに」及び末尾の「訳者による補足」の章は原文にはなく、翻訳者(<a href="/tadsan" class="user-mention js-hovercard" title="tadsan" data-hovercard-target-type="user" data-hovercard-target-name="tadsan">@tadsan</a>)によるものです。記事の著作権表示及び元Webサイトの利用規約、免責事項、そしてこの記事についての訳者の見解について記します)</em></p>

<p><a rel="nofollow noopener" href="http://creativecommons.org/licenses/by/3.0/" target="_blank"><img alt="Creative Commons Attribution-ShareAlike 3.0 Unported License" src="https://camo.qiitausercontent.com/baa8e523109b47427ff02f2c286e94ea8e8c43d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f62363630633461342d336435352d653664362d343130382d3061363933396561376165652e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/b660c4a4-3d55-e6d6-4108-0a6939ea7aee.png"></a></p>

<p>(この記事の一部または全て ——ただしコメント欄は含まれない—— はCC BY-SA 3.0に則る限り、自由に利用することができます。<del>翻訳と「はじめに」「訳註」については独自の著作権は主張しません。</del> 改竄しても二次利用は独自の責任にて行ってください。)</p>

<blockquote>
<p>Please consult a legal expert before adopting a software license for your project.<br>
This site is licensed under the Creative Commons Attribution 3.0 Unported License.</p>

<p>Demystified with &lt;3 by GitHub, Inc.</p>
</blockquote>

<p>元サイトには利用規約として<a href="http://choosealicense.com/terms-of-service/" rel="nofollow noopener" target="_blank">Terms of Service - ChooseALicense.com</a>が存在します。この利用規約の有効性及び有効範囲について、訳者(<a href="/tadsan" class="user-mention js-hovercard" title="tadsan" data-hovercard-target-type="user" data-hovercard-target-name="tadsan">@tadsan</a>)は <strong>言及しません</strong>。参考として、見出しのみを抜萃し、()内に訳者による参考訳を補ひました。</p>

<blockquote>

<h3>
<span id="terms-of-service---choosealicensecom" class="fragment"></span><a href="#terms-of-service---choosealicensecom"><i class="fa fa-link"></i></a><a href="http://choosealicense.com/terms-of-service/" rel="nofollow noopener" target="_blank">Terms of Service - ChooseALicense.com</a>
</h3>

<ol>
<li>Introduction (はじめに)</li>
<li>Agreement to the Terms (規約に同意すること)</li>
<li>No legal advice is being provided (法的な助言をするものではない)</li>
<li>DISCLAIMER OF WARRANTIES (保証の抛棄)</li>
<li>LIMITATION OF LIABILITY (責任の制限)</li>
<li>Indemnification for breach of the Terms (規約違反の補償)</li>
<li>Termination of this Agreement (契約の終了)</li>
<li>Miscellaneous Terms (雑則)</li>
</ol>
</blockquote>

<p>この記事において「ライセンス」とは、特に断りのない限りはフリーソフトウェア(自由ソフトウェア)・オープンソースライセンスと呼ばれる形態のライセンスのことです(<a href="https://ja.wikipedia.org/wiki/FLOSS" rel="nofollow noopener" target="_blank">FLOSS - Wikipedia</a>)。</p>

<p>もとのWebサイト(<a href="http://creativecommons.org" rel="nofollow noopener" target="_blank">creativecommons.org</a>)及びこの翻訳記事は、あなたに <strong>法的な助言</strong> を与へるものではありません。ライセンス問題及び各ライセンスが日本及び外国の法律・条約・条例に基いて有効・適法な契約であるかについては、必ず弁護士などの法律専門家の判断を仰いでください。上記の "Term of Service" の解釈についても同様とします。</p>

<p>翻訳は直訳よりは日本語として解釈しやすいように意訳してあります。原文との見解の相違がないように注意して訳しますが、英語及びライセンスへの認識の差により、原文と矛盾した意味になってしまってゐるリスクもあります。 <em>(訳註:</em> から始まる文章は、訳者(<a href="/tadsan" class="user-mention js-hovercard" title="tadsan" data-hovercard-target-type="user" data-hovercard-target-name="tadsan">@tadsan</a>)が <strong>独自の見解により</strong> 本文の内容を註釈・補足するものです。</p>

<p>筆者は翻訳及び訳註により原文と異った意味に改変することを望まないので、もし誤訳及びライセンス見解の誤り、その他ミスなどを発見した場合には訳者(<a href="/tadsan" class="user-mention js-hovercard" title="tadsan" data-hovercard-target-type="user" data-hovercard-target-name="tadsan">@tadsan</a>)にコメントなどでフィードバックをいただけると幸ひです。</p>

<p>翻訳にあたって法律の専門家や法律智識を持った翻訳家の助言を受けたものではありません。また、この記事はあくまでライセンス原文を解釈し、要約を試みたものなので、優先されるべきは常に原文です。 <em>(本記事のみならず、ほかの翻訳・ライセンス解説についても同様に解釈するべきです)</em></p>

<p>繰り返しますが、この記事は専門家による法律判断ではありません。法律問題への対処には専門家によるアドバイスを受けてください。元サイト及び本記事を参考にしたことで受けた全ての利益・損害について、原著者及び翻訳者は一切の権利・責任を負ひません。</p>

<p><em>(以下より記事本文です)</em></p>

<hr>

<p><a href="https://choosealicense.com/" rel="nofollow noopener" target="_blank">Choose an open source license (choosealicense.com)</a>をお読みください。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/4121/2aa5eda8-c273-9d9f-df07-b2b2500bc78a.png" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/36f52a9b1c7ba318450636c12c5e58bcde8619b0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32616135656461382d633237332d396439662d646630372d6232623235303062633738612e706e67" alt="Choose an open source license {Which of the following best describes your situation?}" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/2aa5eda8-c273-9d9f-df07-b2b2500bc78a.png"></a></p>

<ins datetime="2017-05-09T20:45:00+09:00">(日本語訳文は削除されました。原文または「<a href="http://www.catch.jp/oss-license/2013/09/10/github/" rel="nofollow noopener" target="_blank">Githubによる、オープンソースライセンスの選び方</a>」をお読みください。</ins>

<hr>

<p><em>(翻訳による内容は、ここまで)</em></p>

<h2>
<span id="訳者による補足" class="fragment"></span><a href="#%E8%A8%B3%E8%80%85%E3%81%AB%E3%82%88%E3%82%8B%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>訳者による補足</h2>

<h3>
<span id="補足1-ライセンスを宣言する方法" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B31-%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%82%92%E5%AE%A3%E8%A8%80%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>補足1. ライセンスを宣言する方法</h3>

<p>最善の方法はソースコードすべてにライセンスを明示することです。</p>

<p>そして、<code>README</code> などと同じディレクトリに <code>LICENSE.txt</code> または <code>COPYING</code> などのファイルを用意して、そこにライセンスの本文や要約をコピーします。</p>

<p>ライセンスの本文の上部に <code>Copyright (c) [year] [fullname]</code> のような形式の穴埋めテンプレートがある場合は、そこ「だけ」を現在の年と自分の名前に変更します。いくつかのライセンスは、本文を「改変しない限り再配布して良い」と許諾してゐること、そして不用意に本文を変更したり条件を追加することで利用者に混乱をきたすことがその理由です。</p>

<p>GitHubではリポジトリ作成時にライセンスを選択して、自動で作成させることもできます(<a href="https://help.github.com/articles/open-source-licensing" rel="nofollow noopener" target="_blank">Open source licensing · GitHub Help</a>)。</p>

<p>ただし、Webで使用されるJavaScriptなどファイル単位で読み込まれる場合、当然ながら <code>README</code> や <code>LICENSE</code> などのテキストファイルは添付しにくくなります。参考までに、そのような場合のライセンス表示のサンプルを紹介します。</p>

<p><a href="https://ajax.googleapis.com/ajax/libs/prototype/1.7.1.0/prototype.js" rel="nofollow noopener" target="_blank">prototype.js</a>の先頭には以下の記述があります。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">prototype.js</span></div>
<div class="highlight"><pre><span></span><span class="cm">/*  Prototype JavaScript framework, version 1.7.1</span>
<span class="cm"> *  (c) 2005-2010 Sam Stephenson</span>
<span class="cm"> *</span>
<span class="cm"> *  Prototype is freely distributable under the terms of an MIT-style license.</span>
<span class="cm"> *  For details, see the Prototype web site: http://www.prototypejs.org/</span>
<span class="cm"> *</span>
<span class="cm"> *--------------------------------------------------------------------------*/</span>
</pre></div>
</div>

<p>また、jQuery の場合はもっと簡潔です。 (<a href="http://code.jquery.com/jquery-2.0.3.min.js" rel="nofollow noopener" target="_blank">jquery-2.0.3.min.js</a>)</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">jquery-2.0.3.min.js</span></div>
<div class="highlight"><pre><span></span><span class="cm">/*! jQuery v2.0.3 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license</span>
<span class="cm">*/</span>
</pre></div>
</div>

<p>どちらの場合にも著作権表示があり、前者はライセンス名で表記、後者はライセンスを明記したページのURLへ誘導してゐることが特徴的です。</p>

<h3>
<span id="補足2-マルチライセンス" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B32-%E3%83%9E%E3%83%AB%E3%83%81%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>補足2. マルチライセンス</h3>

<p>PerlはArtistic Licenseで公開されてゐると上記にありますが、実際には <a href="http://dev.perl.org/licenses/" rel="nofollow noopener" target="_blank">Perl Licensing - dev.perl.org</a> 及び配布パッケージ内の <code>README</code> 内には以下の記述があります。</p>

<blockquote>
<p>Perl5 is Copyright (C) 1993-2005, by Larry Wall and others.</p>

<p>It is free software; you can redistribute it and/or modify it under the terms of either:</p>

<ul>
<li>a) the <a href="http://dev.perl.org/licenses/gpl1.html" rel="nofollow noopener" target="_blank">GNU General Public License</a> as published by the <a href="http://www.fsf.org/" rel="nofollow noopener" target="_blank">Free Software Foundation; either</a> <a href="http://dev.perl.org/licenses/gpl1.html" rel="nofollow noopener" target="_blank">1</a>, or (at your option) any <a href="http://www.fsf.org/licenses/licenses.html#GNUGPL" rel="nofollow noopener" target="_blank">later version</a>, or</li>
<li>b) the "Artistic License".</li>
</ul>
</blockquote>

<p><em>—— <a href="http://dev.perl.org/licenses/" class="autolink" rel="nofollow noopener" target="_blank">http://dev.perl.org/licenses/</a> より引用 (2013年9月7日 閲覧)</em></p>

<p>これは、ライセンスとして「GPLv1(または任意に指定された番号)以上のバージョン」または「Artistic License」のうちの <strong>どれか</strong> の条件に従へば良いといふことになります。このような状態を「マルチライセンス」と呼びます(この場合は2つなので「デュアルライセンス」、3つなら「トリプルライセンス」とも呼ばれます)。</p>

<p>このマルチライセンスに含めるライセンスは必ずしもフリーソフトウェアライセンスである必要はなく、金銭を対価にサービスを提供するような商業契約(コマーシャルライセンス)であることもあります。<a href="https://ja.wikipedia.org/wiki/MySQL#.E3.83.A9.E3.82.A4.E3.82.BB.E3.83.B3.E3.82.B9" rel="nofollow noopener" target="_blank">MySQL</a>がこの形態のソフトウェアの代表例です。</p>

<h3>
<span id="補足3-ライセンスを明示しないこと" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B33-%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%82%92%E6%98%8E%E7%A4%BA%E3%81%97%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>補足3. ライセンスを明示しないこと</h3>

<p>サイボウズ・ラボの西尾泰和さんのことばに次のようなものがあります。</p>

<blockquote>
<p>著作権を主張しないつもりなんだったらそれを明示的に宣言して欲しい。ライセンスが明示されていないのは、どんなライセンスよりも厳しいライセンスだ。</p>
</blockquote>

<p><em>(<a href="http://d.hatena.ne.jp/nishiohirokazu/20100819/1282200581" rel="nofollow noopener" target="_blank">Ruby 1.9.2リリースとWEBrick脆弱性問題の顛末 - 西尾泰和のはてなダイアリー</a> より引用)</em></p>

<p>また、2chの <a href="http://toro.2ch.net/test/read.cgi/unix/1265413075/" rel="nofollow noopener" target="_blank">Navi2ch for Emacs (Part 20)</a> スレのテンプレには次のようなFAQがあります。</p>

<blockquote>
<p>Q. パッチを作ったんだけど、ここに up すれば良いの？ <br>
A. 2ch で晒すと取り込めなくなるので、sourceforge に投げてね。 <br>
ttp://sourceforge.net/tracker/?atid=435774&amp;group_id=39552&amp;func=browse </p>

<p>Q. 自作の関数や設定を晒したいんだけど、どうすれば良い？ <br>
A. 設定はともかく、関数を 2ch で晒すのは NG。 <br>
navi2ch に取り込んで欲しいなら、上記にパッチを投げてね。 <br>
ただ晒したいだけなら、メーリングリストやグループに投げてね。 </p>
</blockquote>

<p><em>(<a href="http://toro.2ch.net/test/read.cgi/unix/1265413075/2" class="autolink" rel="nofollow noopener" target="_blank">http://toro.2ch.net/test/read.cgi/unix/1265413075/2</a> より引用)</em></p>

<p>匿名でライセンスを明示しないソースコードを公開するリスクは本文中に訳註として書いた通りです。特に2chでは後から作者を特定することができず、よってライセンスを変更することも不可能になり、合法的に二次利用することができなくなります。</p>

<h3>
<span id="補足4-より信頼のおける情報源" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B34-%E3%82%88%E3%82%8A%E4%BF%A1%E9%A0%BC%E3%81%AE%E3%81%8A%E3%81%91%E3%82%8B%E6%83%85%E5%A0%B1%E6%BA%90"><i class="fa fa-link"></i></a>補足4. より信頼のおける情報源</h3>

<p>もっと基礎から詳しくライセンスについて学びたいのでしたら、有料(800円)の電子書籍ですが、「<a href="http://tatsu-zine.com/books/osslicense" rel="nofollow noopener" target="_blank">知る、読む、使う！ オープンソースライセンス</a>」が良いかもしれません。(実は訳者はまだ読んでゐません!)</p>

<p>もっと深くライセンスについて理解するための資料としては、IPA(独立行政法人 情報処理推進機構)のWebサイトに<a href="http://www.ipa.go.jp/osc/osslegal.html" rel="nofollow noopener" target="_blank">OSSライセンス関連情報</a>として、多数まとめられてゐます。特に<a href="http://ossipedia.ipa.go.jp/doc/187/" rel="nofollow noopener" target="_blank">GNU GPL v3 逐条解説書</a>は非常に詳細なレポートで、<a href="http://ja.wikipedia.org/wiki/Software_Freedom_Law_Center" rel="nofollow noopener" target="_blank">SFLC</a>の協力を受けてまとめられた、極めて信頼度の高いものです。さらにこのレポートは<a href="http://creativecommons.org/licenses/by-nc-nd/2.1/jp/" rel="nofollow noopener" target="_blank">Creative Commons 表示 - 非営利 - 改変禁止 2.1 日本(CC BY-NC-ND 2.1 JP)</a>として利用可能です。</p>

<h3>
<span id="補足5-ライセンスの互換性" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B35-%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%81%AE%E4%BA%92%E6%8F%9B%E6%80%A7"><i class="fa fa-link"></i></a>補足5. ライセンスの互換性</h3>

<p><em>(この話はわかりやすさ重視の例で、技術的な正確性はありません)</em></p>

<p>突然ですが、あなたは画像ブラウザを作りました。これは、<a href="https://ja.wikipedia.org/wiki/Windows%E3%83%93%E3%83%83%E3%83%88%E3%83%9E%E3%83%83%E3%83%97" rel="nofollow noopener" target="_blank">BMP形式</a>の画像をとても快適に管理できる、べんりなアプリケーションです <em>(言語は何でも良いですが、<a href="https://ja.wikipedia.org/wiki/Delphi" rel="nofollow noopener" target="_blank">Delphi</a>でネイティブコードにコンパイルしたとします)</em>。</p>

<p>ある日、あなたは気がつきました。「画像をBMP形式に変換して読み込めば、どんな形式の画像でもサポートできるぞ!」と。</p>

<p>あなたが最初に見付けたのは、JPEG画像をBMPに変換するライブラリでした。これは一切著作権を主張しないことが宣言された、パブリックライセンスのライブラリでした。このソースコードを使って、あなたのアプリケーションはJPEG対応になりました。</p>

<dl>
<dt>Q.</dt>
<dd>このアプリケーションのソースコードを公開する必要はありますか?</dd>
<dt>A.</dt>
<dd>公開義務はありません。なぜなら、著作権はわたしが持ってゐるからです。また、JPEGライブラリには著作権は<em>ありませんでした。</em>
</dd>
</dl>

<p>次に見付けたのは、John Smithさんが作った、PNG画像をBMPに変換するライブラリでした。これは2条項BSDライセンスでした。このライブラリを静的リンクすることで、あなたのアプリケーションはPNG形式対応になりました。</p>

<dl>
<dt>Q.</dt>
<dd>このアプリケーションのソースコードを公開する必要はありますか?</dd>
<dt>A.</dt>
<dd>公開義務はありません。なぜなら、わたしが著作権を持つコードと、2条項BSDライセンスのコードから構成されるからです。</dd>
<dt>Q.</dt>
<dd>あなたは何をしなければなりませんか?</dd>
<dt>A.</dt>
<dd>ドキュメントにPNGライブラリの作者名とライセンスを明記することです。わたしは<code>README</code>ファイルに<strong>License</strong>の章を設け、次のように追記しました。</dd>
</dl>

<blockquote>

<h2>
<span id="license" class="fragment"></span><a href="#license"><i class="fa fa-link"></i></a>License</h2>

<h3>
<span id="hogepnglibrary" class="fragment"></span><a href="#hogepnglibrary"><i class="fa fa-link"></i></a>HogePngLibrary</h3>

<blockquote>
<p>(C) Copyright 2001 John Smith</p>

<p>All rights reserved.</p>

<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>

<ul>
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
<li>Neither the name of the  nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</li>
</ul>

<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</blockquote>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>189</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/7afce87fe2cae3580f61">Rubyのコードを解析する…?</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-21 00:33:51</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>はいこんにちはこんにちは。プログラミング初心者のZonu.EXEです。</p>

<p>今日は<a href="http://qiita.com/advent-calendar/2012/ruby">Ruby Advent Calendar 2012</a>の20日めです…?</p>

<p>ちょっと前まで自宅警備員で、一個月ほど前からアルバイトでるびーおんれーるずを書くお仕事に就いたのですが、Ruby基礎力が低すぎて困ることが多々あります。</p>

<p>そんなわけで、Rubyをきちんと学ぶために基礎の基礎から調べてみましょか、みたいなテンションで書いてました。</p>

<p>ほんとは字句解析だけでがっつりと書きたかったんですけれど、ねたを集める時間がなかったので枝葉末節がひどいです。</p>

<p>タイトルと内容が合ってない気もするけど気にするな! 全然毛色が違ってるねたが混ざってても気にするな! オムニバス!</p>

<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>プログラミング言語で書かれたソースコードを読んで何らかの処理を行ふソフトウェアを「処理系」と呼びます。よくわかんないですけど、何らかの処理をしてくれるんですね。処理系はコンパイラだったり、インタプリタだったりします。</p>

<p>Rubyの文脈においては、プログラミング言語の名前はRuby、処理系は本家の<strong>Ruby</strong>、Javaで書かれた<strong>JRuby</strong>、.NET環境で動くIronRuby、Rubyで書かれた<strong>Rubinius</strong>があります。</p>

<p>まあ、ふつうにふつうの<strong>Ruby</strong>で全然問題ありませんね。</p>

<blockquote>
<p>本家本元のRubyは言語名と区別するために(コマンド名と同じ)小文字で<code>ruby</code>、(Jと対比して)C言語で書かれてるから<strong>CRuby</strong>、Matzが作った処理系だから<em>Matz Ruby Implementation</em> 、縮めて<strong>MRI</strong>と呼ばれたりします。<br>
いろんな呼びかたがありますね ヾ(〃＞＜)ﾉﾞ</p>
</blockquote>

<h2>
<span id="コード解析とは" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E8%A7%A3%E6%9E%90%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>コード解析とは</h2>

<p>別にそんなに難しいことばを持ち出して警戒する必要もないのですが、要するに書いたコードがどんな意味を持つのかを調べるってだけの話です。</p>

<p>コード解析の種類には<strong>動的解析</strong>と<strong>静的解析</strong>がありますが、別にこれも難しく捉へる必要はないです。「コードだけを見ればわかる」のが<strong>静的解析</strong>、「実際に動かしてみればわかる」のが<strong>動的解析</strong>です。</p>

<p>ただし動的解析にはテストフレームワークなどを使ったテストを含みますが、今回はテストについては触れません。RSpecやTest::Unitを使ったテストのことは、いつかもっとえろいひとがしてくれるのでは。</p>

<p>この記事では静的とか動的って話はあまりしない気がします。</p>

<h2>
<span id="環境構築" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>環境構築</h2>

<p>いまどきMacに標準添付<strong>のRuby1.8</strong>(<em>賞味期限切れ</em>)はださいので、ちゃんとしたRubyを入れること。</p>

<p>2012年12月20日現在でいちばんナウい安定版は<strong>Ruby 1.9.3-p327</strong>です。<strong>2.0 preview2</strong>で痛い目に遭っても泣かない子はそっちでもたぶん可。</p>

<p><a href="http://qiita.com/items/9dd797f42e7bea674705">OS Xでrbenvを使ってruby 1.9.3の環境を作る</a>や<a href="http://qiita.com/items/b07beebca21ba7ed8e7f">rbenv &amp; ruby-buildの使い方メモ</a>を参考にすると、たいへん良いですね。</p>

<p>餘談ですが、そらはー師匠の記事で触れられてる<strong>Xcode</strong>の代りに<a href="https://github.com/kennethreitz/osx-gcc-installer" rel="nofollow noopener" target="_blank">kennethreitz/osx-gcc-installer · GitHub</a>のパッケージを使っても良さげらしいですね。僕自身は未検証なんですけど。</p>

<p>最近ナウい対話環境は<strong>Pry</strong>なので、<code>gem install rdoc pry-doc</code>とかやってください。依存でいろいろgemが入ります。</p>

<h2>
<span id="開発環境" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>開発環境</h2>

<p><strong>Pry</strong>が入ったので使ってみませう。コマンドは<code>pry</code>です。rbenvを使ってる人は<code>gem install</code>した後に<code>rbenv rehash</code>を忘れないでね。</p>

<p><strong>Pry</strong>は、Rubyに最初からくっついてきてる<strong>IRB</strong>よりも、さらに強いやつです。色がついたり、キーボードの<code>TAB</code>キーでメソッド名補完もできたり、いたれりつくせりですね。</p>

<h2>
<span id="pryでメソッドの説明を読む" class="fragment"></span><a href="#pry%E3%81%A7%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E8%AA%AC%E6%98%8E%E3%82%92%E8%AA%AD%E3%82%80"><i class="fa fa-link"></i></a>Pryでメソッドの説明を読む</h2>

<p>この記事でわざわざ<strong>Pry</strong>の話から始めたのは、この説明がしたかったからです。</p>

<p>Pryでは<code>show-doc</code>コマンドで、メソッドの説明を読むことができます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="n">doc</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">lex</span>

<span class="ss">From</span><span class="p">:</span> <span class="sr">/Users/me</span><span class="n">gurine</span><span class="o">/.</span><span class="n">rbenv</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">preview1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">ripper</span><span class="o">/</span><span class="n">lexer</span><span class="o">.</span><span class="n">rb</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">38</span><span class="p">:</span>
<span class="no">Number</span> <span class="n">of</span> <span class="ss">lines</span><span class="p">:</span> <span class="mi">18</span>
<span class="ss">Owner</span><span class="p">:</span> <span class="c1">#&lt;Class:Ripper&gt;</span>
<span class="ss">Visibility</span><span class="p">:</span> <span class="kp">public</span>
<span class="ss">Signature</span><span class="p">:</span> <span class="n">lex</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="sc">?,</span> <span class="n">lineno</span><span class="o">=</span><span class="sc">?)</span>

<span class="no">Tokenizes</span> <span class="n">the</span> <span class="no">Ruby</span> <span class="n">program</span> <span class="ow">and</span> <span class="n">returns</span> <span class="n">an</span> <span class="nb">Array</span> <span class="n">of</span> <span class="n">an</span> <span class="nb">Array</span><span class="p">,</span>
<span class="n">which</span> <span class="n">is</span> <span class="n">formatted</span> <span class="n">like</span> <span class="o">[[</span><span class="n">lineno</span><span class="p">,</span> <span class="n">column</span><span class="o">]</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">token</span><span class="o">].</span>

  <span class="nb">require</span> <span class="s1">'ripper'</span>
  <span class="nb">require</span> <span class="s1">'pp'</span>

  <span class="nb">p</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">lex</span><span class="p">(</span><span class="s2">"def m(a) nil end"</span><span class="p">)</span>
    <span class="c1">#=&gt; [[[1,  0], :on_kw,     "def"],</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_sp</span><span class="p">,</span>     <span class="s2">" "</span>  <span class="o">]</span><span class="p">,</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">4</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_ident</span><span class="p">,</span>  <span class="s2">"m"</span>  <span class="o">]</span><span class="p">,</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_lparen</span><span class="p">,</span> <span class="s2">"("</span>  <span class="o">]</span><span class="p">,</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">6</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_ident</span><span class="p">,</span>  <span class="s2">"a"</span>  <span class="o">]</span><span class="p">,</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_rparen</span><span class="p">,</span> <span class="s2">")"</span>  <span class="o">]</span><span class="p">,</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">8</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_sp</span><span class="p">,</span>     <span class="s2">" "</span>  <span class="o">]</span><span class="p">,</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">9</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_kw</span><span class="p">,</span>     <span class="s2">"nil"</span><span class="o">]</span><span class="p">,</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_sp</span><span class="p">,</span>     <span class="s2">" "</span>  <span class="o">]</span><span class="p">,</span>
         <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_kw</span><span class="p">,</span>     <span class="s2">"end"</span><span class="o">]]</span>
</pre></div>
</div>

<p>これ、実際に端末で実行してみてもちゃんと色がつきます。かっこいいですね。</p>

<p>注意なのですが、Rubyレベルではクラスメソッドの呼び出しは、たとへば<code>String::new</code>でも<code>String.new</code>でも良いのですが、(現在のバージョンのpry-docでは)<code>show-doc</code>コマンドの引数としては<code>String.new</code>と書かないとだめです。気をつけてくださいね。</p>

<blockquote>
<p>閑話休題。Pryの実装は読んでないのですが、<code>method(:'show-doc')</code>とかやっても<code>Method</code>オブジェクトを得られないので、Rubyレベルのメソッドではないコマンドみたいですね。</p>
</blockquote>

<h2>
<span id="クラスの継承関係を辿る" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%B6%99%E6%89%BF%E9%96%A2%E4%BF%82%E3%82%92%E8%BE%BF%E3%82%8B"><i class="fa fa-link"></i></a>クラスの継承関係を辿る</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Foo</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="kp">nil</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span> <span class="k">end</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Foo</span><span class="o">.</span><span class="n">ancestors</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="no">Foo</span><span class="p">,</span> <span class="no">Object</span><span class="p">,</span> <span class="no">PP</span><span class="o">::</span><span class="no">ObjectMixin</span><span class="p">,</span> <span class="no">Kernel</span><span class="p">,</span> <span class="no">BasicObject</span><span class="o">]</span>
</pre></div>
</div>

<p><code>Class.ancestors</code>メソッドはクラスの継承関係を配列で並べて返します。<strong>Rubyに多重継承はない</strong>ので、常に直線です。</p>

<h2>
<span id="オブジェクトのメソッド一覧を調べる" class="fragment"></span><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E4%B8%80%E8%A6%A7%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>オブジェクトのメソッド一覧を調べる</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Z</span><span class="p">;</span><span class="k">end</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Z:0x007f990509cdd8&gt;</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">z</span><span class="o">.</span><span class="n">methods</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:pry</span><span class="p">,</span>
 <span class="ss">:__binding__</span><span class="p">,</span>
 <span class="ss">:pretty_print</span><span class="p">,</span>
 <span class="ss">:pretty_print_cycle</span><span class="p">,</span>
 <span class="ss">:pretty_print_instance_variables</span><span class="p">,</span>
 <span class="ss">:pretty_print_inspect</span><span class="p">,</span>
<span class="err">…</span>
</pre></div>
</div>

<p>実際にはもっとたくさんのメソッドが定義されますし、表示することもできます。</p>

<p>じゃあ定義されたメソッドの数を数へみましょっかー、といふときにはどうするのが良いですかね。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">z</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">size</span>
<span class="o">=&gt;</span> <span class="mi">63</span>
</pre></div>
</div>

<p>はい、お手軽にできました。</p>

<p>ここからはちょっとした応用篇。</p>

<h2>
<span id="fixnumオブジェクトのto_xxxメソッドを列挙したい" class="fragment"></span><a href="#fixnum%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AEto_xxx%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%88%97%E6%8C%99%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a><code>Fixnum</code>オブジェクトの<code>to_xxx</code>メソッドを列挙したい</h2>

<p><code>Array#grep</code>メソッドと正規表現で、お望みのメソッド名を抽出してみるのが良さげですね。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/^to_.*/</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:to_s</span><span class="p">,</span> <span class="ss">:to_f</span><span class="p">,</span> <span class="ss">:to_i</span><span class="p">,</span> <span class="ss">:to_int</span><span class="p">,</span> <span class="ss">:to_r</span><span class="p">,</span> <span class="ss">:to_c</span><span class="p">,</span> <span class="ss">:to_enum</span><span class="o">]</span>
</pre></div>
</div>

<h2>
<span id="シンボルにあって文字列にないメソッドを列挙したい" class="fragment"></span><a href="#%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AB%E3%81%AB%E3%81%82%E3%81%A3%E3%81%A6%E6%96%87%E5%AD%97%E5%88%97%E3%81%AB%E3%81%AA%E3%81%84%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%88%97%E6%8C%99%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>「シンボルにあって文字列にないメソッド」を列挙したい</h2>

<p>配列同士の引き算を利用してらどうですかね。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="ss">:''</span><span class="o">.</span><span class="n">methods</span> <span class="o">-</span> <span class="s1">''</span><span class="o">.</span><span class="n">methods</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:id2name</span><span class="p">,</span> <span class="ss">:to_proc</span><span class="o">]</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="s1">''</span><span class="o">.</span><span class="n">methods</span> <span class="o">-</span> <span class="ss">:''</span><span class="o">.</span><span class="n">methods</span>
<span class="o">=&gt;</span> <span class="s2">"[:+, :*, :%, :[]=, :insert, :bytesize, :succ!, :next!, :upto, :index, :rindex, :replace, :clear, :chr, :getbyte, :setbyte, :byteslice, :to_i, :to_f, :to_str, :dump, :upcase!, :downcase!, :capitalize!, :swapcase!, :hex, :oct, :split, :lines, :bytes, :chars, :codepoints, :reverse, :reverse!, :concat, :&lt;&lt;, :prepend, :crypt, :ord, :include?, :start_with?, :end_with?, :scan, :ljust, :rjust, :center, :sub, :gsub, :chop, :chomp, :strip, :lstrip, :rstrip, :sub!, :gsub!, :chop!, :chomp!, :strip!, :lstrip!, :rstrip!, :tr, :tr_s, :delete, :squeeze, :count, :tr!, :tr_s!, :delete!, :squeeze!, :each_line, :each_byte, :each_char, :each_codepoint, :sum, :slice!, :partition, :rpartition, :force_encoding, :valid_encoding?, :ascii_only?, :unpack, :encode, :encode!, :to_r, :to_c, :shellsplit, :shellescape, :shell_split]</span>
</pre></div>
</div>

<p><code>Symbol</code>と<code>String</code>は相互変換可能だけど全然別物なんだぜ? みたいな傍證のひとつでした。</p>

<h2>
<span id="ソースコードを字句解析してみる" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%AD%97%E5%8F%A5%E8%A7%A3%E6%9E%90%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>ソースコードを字句解析してみる</h2>

<p><strong>字句解析</strong>(<em>lexical analysis</em>)とは、文字列をプログラミング言語のソースコードとして認識するためのプロセスのひとつです。</p>

<p>たとへば <code>def f(a,b);nil;end</code> といふ文字の並びを、Rubyはどのように字句解析するのか調べてみませう。</p>

<p>Ruby本体に添付されてゐる<strong>Ripper</strong>といふライブラリを利用することで、ソースコードに対してRubyと同じ字句解析を行うことができます。</p>

<p><strong>Ripper</strong>は標準添付のライブラリなので、Rubyをちゃんとインストールされた方ならば、特にインストール作業の必要ありません。 </p>

<p><code>Ripper.tokenize</code>は、文字列を単純にトークン単位に分解します。 <strong>トークン</strong>とは、意味をもった文字の塊の単位のことです。</p>

<p>そして、<code>Ripper.lex</code>は、その切り分けられたトークンの位置と、そのトークンの具体的な意味、つまり何者であるかを調べることができます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">'ripper'</span>
<span class="o">=&gt;</span> <span class="kp">true</span>

<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="s2">"def f(a,b);nil;end"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">"def"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="s2">"("</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">","</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">")"</span><span class="p">,</span> <span class="s2">";"</span><span class="p">,</span> <span class="s2">"nil"</span><span class="p">,</span> <span class="s2">";"</span><span class="p">,</span> <span class="s2">"end"</span><span class="o">]</span>

<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">lex</span><span class="p">(</span><span class="s2">"def f(a,b);nil;end"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_kw</span><span class="p">,</span> <span class="s2">"def"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_sp</span><span class="p">,</span> <span class="s2">" "</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_ident</span><span class="p">,</span> <span class="s2">"f"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_lparen</span><span class="p">,</span> <span class="s2">"("</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_ident</span><span class="p">,</span> <span class="s2">"a"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_comma</span><span class="p">,</span> <span class="s2">","</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_ident</span><span class="p">,</span> <span class="s2">"b"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_rparen</span><span class="p">,</span> <span class="s2">")"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_semicolon</span><span class="p">,</span> <span class="s2">";"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_kw</span><span class="p">,</span> <span class="s2">"nil"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_semicolon</span><span class="p">,</span> <span class="s2">";"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_kw</span><span class="p">,</span> <span class="s2">"end"</span><span class="o">]]</span>
</pre></div>
</div>

<p>はい、綺麗に分解してくれましたね。<code>on_kw</code>は、いはゆる予約語です。</p>

<p><code>on_ident</code>は<strong>識別子</strong>です。この場合での<code>f</code>はメソッド名、<code>a</code>と<code>b</code>は仮引数名と素性はあきらかですが、いつでもそうとは限りません。識別子はメソッド呼び出しかもしれませんし、変数名かもしれません。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">lex</span><span class="p">(</span><span class="s1">'a = "foo"'</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_ident</span><span class="p">,</span> <span class="s2">"a"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_sp</span><span class="p">,</span> <span class="s2">" "</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_op</span><span class="p">,</span> <span class="s2">"="</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_sp</span><span class="p">,</span> <span class="s2">" "</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_tstring_beg</span><span class="p">,</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_tstring_content</span><span class="p">,</span> <span class="s2">"foo"</span><span class="o">]</span><span class="p">,</span>
 <span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="o">]</span><span class="p">,</span> <span class="ss">:on_tstring_end</span><span class="p">,</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="o">]]</span>
</pre></div>
</div>

<blockquote>
<p>話は逸れますが、<code>(a??a)?:a: :a</code>や<code>_?(?:,:'?')</code>は、まったく有効なRubyのコードです。このコードをRipperで字句解析してみたりするとおもしろいですね。<br>
あと、実際にこのコードを動作させるにはどんな準備が必要なのかチャレンジしてみませうヾ(〃＞＜)ﾉﾞ☆</p>
</blockquote>

<h2>
<span id="parsetreeで構文木をダンプする" class="fragment"></span><a href="#parsetree%E3%81%A7%E6%A7%8B%E6%96%87%E6%9C%A8%E3%82%92%E3%83%80%E3%83%B3%E3%83%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>parsetreeで構文木をダンプする</h2>

<p>こんな感じのファイルを用意します。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">foo1.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="s2">"foo"</span>
<span class="nb">puts</span> <span class="n">a</span>
</pre></div>
</div>

<p><code>ruby --dump parsetree ./foo1.rb</code> みたいにして実行してみませう。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>% vim foo1.rb
% ruby --dump parsetree ./foo1.rb
<span class="c1">###########################################################</span>
<span class="c1">## Do NOT use this node dump for any purpose other than  ##</span>
<span class="c1">## debug and research.  Compatibility is not guaranteed. ##</span>
<span class="c1">###########################################################</span>

<span class="c1"># @ NODE_SCOPE (line: 3)</span>
<span class="c1"># +- nd_tbl: :a</span>
<span class="c1"># +- nd_args:</span>
<span class="c1"># |   (null node)</span>
<span class="c1"># +- nd_body:</span>
<span class="c1">#     @ NODE_BLOCK (line: 1)</span>
<span class="c1">#     +- nd_head:</span>
<span class="c1">#     |   @ NODE_DASGN_CURR (line: 1)</span>
<span class="c1">#     |   +- nd_vid: :a</span>
<span class="c1">#     |   +- nd_value:</span>
<span class="c1">#     |       @ NODE_STR (line: 1)</span>
<span class="c1">#     |       +- nd_lit: "foo"</span>
<span class="c1">#     +- nd_next:</span>
<span class="c1">#         @ NODE_BLOCK (line: 2)</span>
<span class="c1">#         +- nd_head:</span>
<span class="c1">#         |   @ NODE_FCALL (line: 2)</span>
<span class="c1">#         |   +- nd_mid: :puts</span>
<span class="c1">#         |   +- nd_args:</span>
<span class="c1">#         |       @ NODE_ARRAY (line: 2)</span>
<span class="c1">#         |       +- nd_alen: 1</span>
<span class="c1">#         |       +- nd_head:</span>
<span class="c1">#         |       |   @ NODE_DVAR (line: 2)</span>
<span class="c1">#         |       |   +- nd_vid: :a</span>
<span class="c1">#         |       +- nd_next:</span>
<span class="c1">#         |           (null node)</span>
<span class="c1">#         +- nd_next:</span>
<span class="c1">#             (null node)</span>
</pre></div></div>

<p>構文木とは… とか説明を書いてる時間はないのですが、この構文木はCのデータ構造になってます。Ruby1.8以前はこの構文木を辿って実行されるインタプリタでした。</p>

<p><code>ruby</code>に<code>--dump parsetree</code>を付けて実行すると、Rubyは実行時の構文木を人間に見やすい形式で出力してくれます。</p>

<p>さて、<code>NODE_DASGN_CURR</code>は<strong>代入文</strong>、<code>NODE_DVAR</code>は<strong>変数の参照</strong>、それぞれの下にぶら下がってる<code>nd_vid: :a</code>が変数名、みたいな感じですね。</p>

<p>じゃあ今度はこんなコード。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">foo2.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">a</span> <span class="p">()</span>
  <span class="k">return</span> <span class="s2">"Foo"</span>
<span class="k">end</span>


<span class="nb">puts</span> <span class="n">a</span>
</pre></div>
</div>

<p>実行してみると…</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% ruby --dump parsetree ./foo2.rb
###########################################################
## Do NOT use this node dump for any purpose other than  ##
## debug and research.  Compatibility is not guaranteed. ##
###########################################################

# @ NODE_SCOPE (line: 7)
# +- nd_tbl: (empty)
# +- nd_args:
# |   (null node)
# +- nd_body:
#     @ NODE_BLOCK (line: 1)
#     +- nd_head:
#     |   @ NODE_DEFN (line: 1)
#     |   +- nd_mid: :a
#     |   +- nd_defn:
#     |       @ NODE_SCOPE (line: 3)
#     |       +- nd_tbl: (empty)
#     |       +- nd_args:
#     |       |   @ NODE_ARGS (line: 1)
#     |       |   +- nd_frml: 0
#     |       |   +- nd_next:
#     |       |   |   @ NODE_ARGS_AUX (line: 1)
#     |       |   |   +- nd_rest: (null)
#     |       |   |   +- nd_body: (null)
#     |       |   |   +- nd_next:
#     |       |   |       (null node)
#     |       |   +- nd_opt:
#     |       |       (null node)
#     |       +- nd_body:
#     |           @ NODE_STR (line: 2)
#     |           +- nd_lit: "Foo"
#     +- nd_next:
#         @ NODE_BLOCK (line: 6)
#         +- nd_head:
#         |   @ NODE_FCALL (line: 6)
#         |   +- nd_mid: :puts
#         |   +- nd_args:
#         |       @ NODE_ARRAY (line: 6)
#         |       +- nd_alen: 1
#         |       +- nd_head:
#         |       |   @ NODE_VCALL (line: 6)
#         |       |   +- nd_mid: :a
#         |       +- nd_next:
#         |           (null node)
#         +- nd_next:
#             (null node)
</pre></div></div>

<p>よく見てくださいよ奥さん、<code>print a</code>の行はまったく同じはずなのに、出来上がった構文木では<code>NODE_DVAR</code>だった箇所が<code>NODE_VCALL</code>になってますよ… おっかないですね…</p>

<p>じゃあ、このコードのどこかに<code>a = "foo"</code>って足したらどうなるんですかね……?</p>

<h2>
<span id="vmのバイトコードを読む" class="fragment"></span><a href="#vm%E3%81%AE%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E8%AA%AD%E3%82%80"><i class="fa fa-link"></i></a>VMのバイトコードを読む</h2>

<p>先程の章で1.8では構文木を辿って実行されるのだ、と書きましたが、1.9ではさらに通称<strong>YARV</strong>と呼ばれるVMで実行されるバイトコードにコンパイルされて実行されます。</p>

<p><a href="http://ja.wikipedia.org/wiki/%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89" rel="nofollow noopener" target="_blank">バイトコード</a>とは… って、やっぱりja.Wpでも読んだ方が良いですね。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">`pry`</span></div>
<div class="highlight"><pre><span></span><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">puts</span> <span class="no">RubyVM</span><span class="o">::</span><span class="no">InstructionSequence</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">"puts !true"</span><span class="p">)</span><span class="o">.</span><span class="n">disasm</span>
<span class="o">==</span> <span class="ss">disasm</span><span class="p">:</span> <span class="o">&lt;</span><span class="no">RubyVM</span><span class="o">::</span><span class="ss">InstructionSequence</span><span class="p">:</span><span class="o">&lt;</span><span class="n">compiled</span><span class="o">&gt;</span><span class="err">@</span><span class="o">&lt;</span><span class="n">compiled</span><span class="o">&gt;&gt;==========</span>
<span class="mo">0000</span> <span class="n">trace</span>            <span class="mi">1</span>                                               <span class="p">(</span>   <span class="mi">1</span><span class="p">)</span>
<span class="mo">0002</span> <span class="n">putself</span>
<span class="mo">0003</span> <span class="n">putobject</span>        <span class="kp">true</span>
<span class="mo">0005</span> <span class="n">opt_not</span>          <span class="o">&lt;</span><span class="n">callinfo!</span><span class="ss">mid</span><span class="p">:</span><span class="o">!</span><span class="p">,</span> <span class="ss">argc</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="no">ARGS_SKIP</span><span class="o">&gt;</span>
<span class="mo">0007</span> <span class="nb">send</span>             <span class="o">&lt;</span><span class="n">callinfo!</span><span class="ss">mid</span><span class="p">:</span><span class="nb">puts</span><span class="p">,</span> <span class="ss">argc</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="no">FCALL</span><span class="o">|</span><span class="no">ARGS_SKIP</span><span class="o">&gt;</span>
<span class="mo">000</span><span class="mi">9</span> <span class="n">leave</span>
</pre></div>
</div>

<p>流れでバイトコードの見方も紹介しましたが、正直僕自身は構文木ほどには心惹かれるものは… けふんけふん。</p>

<blockquote>
<p>ちなみにPythonはバイトコード形式にコンパイルしたものが<code>.pyc</code>や<code>.pyo</code>の拡張子のファイルとして保存されますが、Rubyにはそれに相当するようなファイル形式は存在せず、毎度毎度バイトコードにコンパイルをしてから実行するようになってます。<br>
Python方式とRuby方式のメリットデメリットを比較してみるとおもしろいかもしれませんねヾ(〃＞＜)ﾉﾞ☆</p>
</blockquote>

<h2>
<span id="参考資料" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99"><i class="fa fa-link"></i></a>参考資料</h2>

<p>この記事を書く参考にはあまりしてなくて、ふつうにRubyの勉強に役立つんじゃないかなー、って資料ですねヾ(〃＞＜)ﾉﾞ</p>

<h3>
<span id="rubyソースコード完全解説rhg" class="fragment"></span><a href="#ruby%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E5%AE%8C%E5%85%A8%E8%A7%A3%E8%AA%ACrhg"><i class="fa fa-link"></i></a>Rubyソースコード完全解説(RHG)</h3>

<ul>
<li><a href="http://i.loveruby.net/ja/rhg/" rel="nofollow noopener" target="_blank">『Rubyソースコード完全解説』サポートページ</a></li>
</ul>

<p>えっと、バイブルです。通称:<strong>RHG</strong>。</p>

<p>出版された本ですが全文無料で読めます(書籍は入手困難)。ベースのRubyが古いですが、Rubyの<strong>基礎</strong>(<a href="http://togetter.com/li/333205" rel="nofollow noopener" target="_blank">foundation的な意味で</a>)を理解するには、未だにこれ以上ない金字塔。</p>

<h3>
<span id="rubyist-magazine---yarv-maniacs" class="fragment"></span><a href="#rubyist-magazine---yarv-maniacs"><i class="fa fa-link"></i></a>Rubyist Magazine - YARV Maniacs</h3>

<ul>
<li><a href="http://jp.rubyist.net/magazine/?0006-YarvManiacs" rel="nofollow noopener" target="_blank">Rubyist Magazine - YARV Maniacs 【第 1 回】 『Ruby ソースコード完全解説』不完全解説</a></li>
</ul>

<p>若き日のささだこういち先生の書かれた連載記事(の第1回)です。</p>

<p><strong>RHG</strong>をつまみ食ひするための手がかりとしても、Ruby1.9と1.8以前の差異のまとめとしても、たいへん勉強になります。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>127</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/a40b2a9c1f7768abd3bb">ラムダ式で学ぶクロージャとDSL</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-29 00:06:05</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[JavaScript]</b> <b>[ラムダ式]</b> <b>[DSL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>はいこんにちはこんにちは！ 今日はラムダ式でクロージャとDSLの解説をします。</p>

<p>ガチなラムダ計算の話ではまったくないのでご安心ください。函数型プログラミング言語の話でもないので怯える必要はありません。</p>

<p>それと、実用なDSLそのものではなく、どちらかといふと <em>ふざけたDSL</em> をシンプルに作ってみました! といふ例題なのでその点はご承知おきください。</p>

<h2>
<span id="謎のコピペとdsl" class="fragment"></span><a href="#%E8%AC%8E%E3%81%AE%E3%82%B3%E3%83%94%E3%83%9A%E3%81%A8dsl"><i class="fa fa-link"></i></a>謎のコピペとDSL</h2>

<p>まづはこちらのソースコードをお読みください。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">tsuyoi.rb</span></div>
<div class="highlight"><pre><span></span><span class="c1"># -*- Coding: utf-8 -*-</span>
<span class="n">scripter</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">){</span><span class="o">-&gt;</span><span class="p">{</span><span class="nb">puts</span> <span class="n">args</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)}}</span>
<span class="n">title</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">text</span><span class="p">){</span><span class="s2">"『</span><span class="si">#{</span><span class="n">text</span><span class="si">}</span><span class="s2">』</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span>
<span class="n">paragraph</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">){</span><span class="n">args</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span><span class="o">+</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span>
<span class="n">chara</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="nb">name</span><span class="p">){</span>
  <span class="o">-&gt;</span><span class="p">(</span><span class="n">text</span><span class="p">){</span><span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">「</span><span class="si">#{</span><span class="n">text</span><span class="si">}</span><span class="s2">」"</span><span class="p">}</span>
<span class="p">}</span>

<span class="n">ryu</span> <span class="o">=</span> <span class="n">chara</span><span class="o">[</span><span class="p">:</span><span class="err">リュウ</span><span class="o">]</span>
<span class="n">tak</span> <span class="o">=</span> <span class="n">chara</span><span class="o">[</span><span class="p">:</span><span class="err">たかし</span><span class="o">]</span>
<span class="n">script</span> <span class="o">=</span> <span class="n">scripter</span><span class="o">[</span>
  <span class="n">title</span><span class="o">[</span><span class="p">:</span><span class="err">俺より強い奴に、会いに行く</span><span class="o">]</span><span class="p">,</span>
  <span class="n">paragraph</span><span class="o">[</span>
    <span class="p">:</span><span class="err">ピンポーン</span><span class="p">,</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">こんにちは</span><span class="o">]</span><span class="p">,</span>
    <span class="n">tak</span><span class="o">[</span><span class="p">:</span><span class="err">はいどなた</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">いまちょっといいですか</span><span class="o">]</span><span class="p">,</span> 
    <span class="n">tak</span><span class="o">[</span><span class="p">:</span><span class="err">これから出かけます</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">午後出勤ですか？</span><span class="o">]</span><span class="p">,</span>
    <span class="n">tak</span><span class="o">[</span><span class="p">:</span><span class="err">はい</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">強そうですね</span><span class="o">]</span><span class="p">,</span>
    <span class="n">tak</span><span class="o">[</span><span class="p">:</span><span class="err">なにがですか</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">態度が</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="p">:</span><span class="err">リュウは、自分より強そうな奴に、会いにいったのだった。　完</span> 
  <span class="o">]</span>
<span class="o">]</span>

<span class="n">script</span><span class="o">[]</span>
</pre></div>
</div>

<p>これは何の言語のコードかおわかりですね。 <strong>はい、みんな大好きなRubyです！</strong> 僕も愛してるよ！</p>

<p>それはさておいて、このコードが「まともな」Rubyに見えないことは、これを書いた僕にも認めざるを得ません。 (ここで <strong>Rubyなんかわからねえよ</strong> と感想をお持ちになった方もご安心ください。このページの末尾にJavaScript版も用意してありますので、そちらを先にお読んでも差支へありません！)</p>

<p>このコードを実行すると次のように出力されます。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">out1.txt</span></div>
<div class="highlight"><pre><span></span>『俺より強い奴に、会いに行く』

ピンポーン
リュウ「こんにちは」
たかし「はいどなた」

リュウ「いまちょっといいですか」
たかし「これから出かけます」

リュウ「午後出勤ですか？」
たかし「はい」

リュウ「強そうですね」
たかし「なにがですか」

リュウ「態度が」

リュウは、自分より強そうな奴に、会いにいったのだった。　完
</pre></div>
</div>

<p>このコピペ(と、僕の書いたRubyコード)の初出は <a href="http://2chnull.info/r/news4vip/1321183007/301-400#res325" rel="nofollow noopener" target="_blank">2011年11月15日のVIPミングスレの&gt;&gt;325</a> です。が、この流れでなぜこんな意味不明なコピペが貼られたのか、未だに謎です。唐突すぎて意味がまったくわかりません。</p>

<p>それはさておいて昼休みも半ばを過ぎた頃になってこのスレを読んだ僕は思ったのでした。ああ、これを出力してやるRubyコードを書いてレスしてやらねばならないな、と……。そしてまた思ひました。「ラムダ式の組み合せでコードを構成してやりたい」そして、「それは立派なDSLと呼べるのではないか」と。</p>

<p>……などと考へた結果が以上のコードになりました。</p>

<h2>
<span id="dslとは何か" class="fragment"></span><a href="#dsl%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B"><i class="fa fa-link"></i></a>DSLとは何か</h2>

<p>さて、以上のような出力は実は次のようなRubyコードでも得ることが可能です。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">yowai.rb</span></div>
<div class="highlight"><pre><span></span><span class="c1"># -*- Coding: utf-8 -*-</span>
<span class="nb">puts</span> <span class="s1">'『俺より強い奴に、会いに行く』'</span>
<span class="nb">puts</span> 
<span class="nb">puts</span> <span class="s1">'ピンポーン'</span>
<span class="nb">puts</span> <span class="s1">'リュウ「こんにちは」'</span>
<span class="nb">puts</span> <span class="s1">'たかし「はいどなた」'</span>
<span class="nb">puts</span> 
<span class="nb">puts</span> <span class="s1">'リュウ「いまちょっといいですか」'</span>
<span class="nb">puts</span> <span class="s1">'たかし「これから出かけます」'</span>
<span class="nb">puts</span> 
<span class="nb">puts</span> <span class="s1">'リュウ「午後出勤ですか？」'</span>
<span class="nb">puts</span> <span class="s1">'たかし「はい」'</span>
<span class="nb">puts</span> 
<span class="nb">puts</span> <span class="s1">'リュウ「強そうですね」'</span>
<span class="nb">puts</span> <span class="s1">'たかし「なにがですか」'</span>
<span class="nb">puts</span> 
<span class="nb">puts</span> <span class="s1">'リュウ「態度が」'</span>
<span class="nb">puts</span> 
<span class="nb">puts</span> <span class="s1">'リュウは、自分より強そうな奴に、会いにいったのだった。　完'</span>
<span class="nb">puts</span> <span class="s1">''</span>
</pre></div>
</div>

<p>「これで良いじゃん」と思はれる方がいらっしゃるかもしれません。……ほんとにそうですか?</p>

<p>たとへば、せりふを <code>人物「せりふ」</code> ではなくて <code>【人物】せりふ</code> の形式にしたいと思ったとき、どうしますか? 一度直接書いてしまったものを後から変更するのは、なかなかに面倒なことです。 (ふつうはエディタで一括置換することになりますよね。しかしそれでも、意図した通りに処理できないのはよくあることです)</p>

<p>上記のスクリプトで生成した場合なら、こんなパッチを当ててやるだけです。ひどくお手軽ですね。</p>

<div class="code-frame" data-lang="diff">
<div class="code-lang"><span class="bold">tsuyoi.patch</span></div>
<div class="highlight"><pre><span></span><span class="gd">--- tsuyoi.rb   2012-10-28 03:08:17.648000000 +0900</span>
<span class="gi">+++ b.rb        2012-10-28 03:08:03.516000141 +0900</span>
<span class="gu">@@ -2,7 +2,7 @@</span>
 title = -&gt;(text){"『#{text}』\n"}
 paragraph = -&gt;(*args){args.join("\n")+"\n"}
 chara = -&gt;(name){
<span class="gd">-  -&gt;(text){"#{name}「#{text}」"}</span>
<span class="gi">+  -&gt;(text){"【#{name}】 #{text}"}</span>
 }

 ryu = chara[:リュウ]
</pre></div>
</div>

<p>実行してみませう。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">out2.txt</span></div>
<div class="highlight"><pre><span></span>『俺より強い奴に、会いに行く』

ピンポーン
【リュウ】 こんにちは
【たかし】 はいどなた

【リュウ】 いまちょっといいですか
【たかし】 これから出かけます

【リュウ】 午後出勤ですか？
【たかし】 はい

【リュウ】 強そうですね
【たかし】 なにがですか

【リュウ】 態度が

リュウは、自分より強そうな奴に、会いにいったのだった。　完
</pre></div>
</div>

<p>と、そんな感じでデータを <strong>抽象化</strong> するメリットについてはおわかりいただけたことと思ひます。そしてDSLはそれを実現するためのひとつの手段です。</p>

<p>DSL —— <a href="http://ja.wikipedia.org/wiki/%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E5%9B%BA%E6%9C%89%E8%A8%80%E8%AA%9E" rel="nofollow noopener" target="_blank">ドメイン固有言語</a> とは、特定の目的のために特化したプログラミング言語を設計することです。</p>

<p>DSLにも大別すると二種類があって、作ったDSLがホスト言語(つまり、作成した言語を処理するプログラムを作成するために使用した言語)の言語仕様と関係のない独立した「外部DSL」と、ホスト言語の仕様を積極的に利用する「内部DSL」に分けることができます。</p>

<p>「外部DSL」「内部DSL」はそれぞれ「言語外DSL」「言語内DSL」と呼ぶこともあります。</p>

<p>この分類でいくと、この謎コピペを記述するために書いたDSLは「Rubyを使った内部DSL」だと言ふことができます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">tsuyoi_script.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">ryu</span> <span class="o">=</span> <span class="n">chara</span><span class="o">[</span><span class="p">:</span><span class="err">リュウ</span><span class="o">]</span> <span class="c1"># キャラクター「リュウ」を作成</span>
<span class="n">tak</span> <span class="o">=</span> <span class="n">chara</span><span class="o">[</span><span class="p">:</span><span class="err">たかし</span><span class="o">]</span> <span class="c1"># キャラクター「たかし」を作成</span>

<span class="c1"># ここからシナリオを記述</span>
<span class="n">script</span> <span class="o">=</span> <span class="n">scripter</span><span class="o">[</span>
  <span class="c1"># タイトルを表示</span>
  <span class="n">title</span><span class="o">[</span><span class="p">:</span><span class="err">俺より強い奴に、会いに行く</span><span class="o">]</span><span class="p">,</span>
  <span class="c1">#段落ごとに分けて記述できる</span>
  <span class="n">paragraph</span><span class="o">[</span>
    <span class="c1"># 地の文はそのまま書く</span>
    <span class="p">:</span><span class="err">ピンポーン</span><span class="p">,</span>
    <span class="c1"># キャラクターのせりふ</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">こんにちは</span><span class="o">]</span><span class="p">,</span>
    <span class="n">tak</span><span class="o">[</span><span class="p">:</span><span class="err">はいどなた</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">いまちょっといいですか</span><span class="o">]</span><span class="p">,</span> 
    <span class="n">tak</span><span class="o">[</span><span class="p">:</span><span class="err">これから出かけます</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">午後出勤ですか？</span><span class="o">]</span><span class="p">,</span>
    <span class="n">tak</span><span class="o">[</span><span class="p">:</span><span class="err">はい</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">強そうですね</span><span class="o">]</span><span class="p">,</span>
    <span class="n">tak</span><span class="o">[</span><span class="p">:</span><span class="err">なにがですか</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="n">ryu</span><span class="o">[</span><span class="p">:</span><span class="err">態度が</span><span class="o">]</span>
  <span class="o">]</span><span class="p">,</span><span class="n">paragraph</span><span class="o">[</span>
    <span class="p">:</span><span class="err">リュウは、自分より強そうな奴に、会いにいったのだった。　完</span> 
  <span class="o">]</span>
<span class="o">]</span>
<span class="c1"># シナリオを終了</span>
</pre></div>
</div>

<p>これらのDSLには、それぞれ一長一短があります。</p>

<p>内部DSLは飽くまで「独自言語に <em>見せかけた</em> 」ホスト言語で書かれたプログラムに過ぎません。しかしその代りに、ホスト言語の機能を利用できるために、DSL作者の手間は(相対的に見て)少なくなります。また、DSL利用者はホスト言語に対応した開発環境の支援機能を利用することができます。短所としては、ホスト言語を他の言語に移植しようとするとまったく同じ言語にできないことがある、もしくはまったく同じにしようとすると他のホスト言語では <strong>外部DSLになってしまふ</strong> ことがある、といふことがあります。</p>

<p>外部DSLは、その言語で利用したい機能を作者が想定し、実装してやる必要があります。そのため、開発にかかるコストは単純なものならばさほどではありませんが、多機能なものでは機能の多さに比例して非常に複雑になり、困難なものになっていきます。これはデメリットに見えるかもしれませんが、DSL作者が利用者に許可したくない機能をむやみに利用されないのでセキュリティ上望ましい、といふ場合もあるかもしれません。 (内部DSLであれば必ずしもセキュアであるといふことは意味しません) また、ホスト言語から独立した言語であるため、ほかのホスト言語にまったく同じ仕様のDSLを移植することもできます。</p>

<p>そんなわけでどちらが良いのかと一概に決めることはできないのですが、とりわけRubyは <strong>内部DSLが作りやすい言語</strong> だとされます。 (外部DSLが不得意といふわけではなく、 <a href="http://i.loveruby.net/ja/projects/racc/doc/" rel="nofollow noopener" target="_blank">Racc ユーザマニュアル</a> や <a href="http://jparsec.codehaus.org/Ruby+Parsec" rel="nofollow noopener" target="_blank">Ruby Parsec</a> といった汎用のパーサジェネレータライブラリが存在し、複雑な外部DSL開発を支援する環境は整ってゐます)</p>

<p>しかし今回作った内部DSLはRuby特有の言語仕様はあまり利用してをらず、(いはゆる)ラムダ式と可変長引数をサポートした言語ならば、容易に移植することができます。(あくまで内部DSLなので、まったく同じものではありませんが)たとへばホスト言語をJavaScriptに移植した例は、次の項で紹介します。</p>

<h2>
<span id="さあクロージャの紹介だ" class="fragment"></span><a href="#%E3%81%95%E3%81%82%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E7%B4%B9%E4%BB%8B%E3%81%A0"><i class="fa fa-link"></i></a>さあ、クロージャの紹介だ。</h2>

<p>この項では上記のコードを一行づつ解説することで、ラムダ式とクロージャ(閉包)について解説していかうと思ひます。</p>

<p>はじめにRubyの <strong>ラムダ式</strong> について説明させていただきます。</p>

<p><code>f = -&gt;(x){ 2 * x + 3 }</code> と書くことで、算数の授業で習った <code>f(x) = 2x + 3</code> といふ函数式と同じものを定義することができます。Rubyではこれを <strong>ラムダ式</strong> と呼びます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>f = -&gt;(x){ 2 * x + 3 }
f = lambda{ |x| 2 * x + 3 } # この書き方でも意味は同じ

p f.class
#=&gt; Proc
p f.lambda?
#=&gt; true
</pre></div></div>

<p><code>Proc</code> とは函数のことだと考へて良いです。正確には <em>procedure</em> / <strong>手続き</strong> オブジェクトで、 <code>lambda</code> はその特殊な場合です (<code>f.lambda?</code> で、その <code>Proc</code> オブジェクトが <code>lambda</code> であるかを検査することができます) 。</p>

<p>このコードは <code>f.call(5)</code> または <code>f[5]</code> 、 <code>f.(5)</code> と書くことで計算結果を得ることができます。 <code>f(5)</code> は、 <strong>だめです</strong> 。</p>

<p>あれっ、 <code>def</code> を使ってこんなふうに書いた方が良いんじゃないの? と思ったあなたは非常に聡いです。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">using_def_f.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">3</span>
<span class="k">end</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">result</span>
<span class="c1">#=&gt; 13</span>
</pre></div>
</div>

<p>が、いま欲しいのはメソッドではなく <strong>函数</strong> なので採用しません。</p>

<p>Rubyの <code>def</code> とは何者なのだ? と興味のある方は、むかし書いた <a href="http://d.hatena.ne.jp/zonu_exe/20111205/1323096647" rel="nofollow noopener" target="_blank">Ruby vs Python! ～def vs def～ - DT戦記(zonu_exeの日記)</a> といふ記事がありますので、こちらをお読みください。</p>

<p>では、解説を開始します。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">part_scripter.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">scripter</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">){</span><span class="o">-&gt;</span><span class="p">{</span><span class="nb">puts</span> <span class="n">args</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)}}</span>
</pre></div>
</div>

<p>実はここだけ初出時とは仕様が変化してゐます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">part_scripter_origin.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">scripter</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">){</span><span class="nb">puts</span> <span class="n">args</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)}</span>
</pre></div>
</div>

<p>これが初出時のコードです。これにもRubyの言語仕様の解説が必要なのですが、 <code>*args</code> と書くことで、 <em>引数をいくつでも取ることができるようになり</em> ( <strong>可変長引数</strong> ) 、そしてその引数は <code>arg</code> という配列に代入されます。</p>

<p>単純な例では、このような函数を作ることができます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">sample_lambda_join.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">join</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">words</span><span class="p">){</span> <span class="n">words</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">join</span><span class="o">[</span><span class="s1">'apple'</span><span class="p">,</span> <span class="s1">'orange'</span><span class="p">,</span> <span class="s1">'banana'</span><span class="p">,</span> <span class="s1">'peach'</span><span class="o">]</span>
<span class="c1">#=&gt; "apple,orange,banana,peach"</span>

<span class="nb">puts</span> <span class="n">join</span><span class="o">[</span><span class="s1">'kiwi'</span><span class="p">,</span> <span class="s1">'papaya'</span><span class="p">,</span> <span class="s1">'mango'</span><span class="o">]</span>
<span class="c1">#=&gt; "kiwi,papaya,mango"</span>
</pre></div>
</div>

<p>さて、次になぜ変更を加へたのか、といふ話をします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>f = -&gt;(str){ str }
</pre></div></div>

<p>このコードを <code>f.call("string")</code> または  <code>f["string"]</code> すると、 <code>"string"</code> といふ文字列がそのまま返ってきます。では、次のようにすると?</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>f = -&gt;(str){
  -&gt;{ str }
}
p f.class
#=&gt; Proc

f_ = f.call("mystring")
p f_.class
#=&gt; Proc

p f_.call
#=&gt; "mystring"
</pre></div></div>

<p>最初の函数 <code>f</code> には <code>-&gt;{}</code> が二重になってゐます (説明が遅れましたが、引数をとらない場合は <code>()</code> を書く必要がありません)。そして、 <code>f.call</code> の結果を <code>f_</code> に代入すると、 <code>f_</code> に代入されたものがさらに函数であることがわかります </p>

<p>ここで注目して欲しいのは、引数を渡したのは <code>f</code> なのに、 <code>f_</code> を呼び出したときまで <code>"mystring"</code> といふ文字列が保存されてゐることです。「えっ、 <code>str</code> って変数に <code>"mystring"</code> が代入されてるんだからそんなのあたりまへじゃないか」と感じるならばおめでたうございます。あなたはクロージャを理解できてゐます！</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">tsuyoi_part_title-paragraph.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">text</span><span class="p">){</span><span class="s2">"『</span><span class="si">#{</span><span class="n">text</span><span class="si">}</span><span class="s2">』</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span>
<span class="n">paragraph</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">){</span><span class="n">args</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span><span class="o">+</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span>
</pre></div>
</div>

<p>ここは割合普通ですね。特に説明する必要もないかなー、と思ひます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>chara = -&gt;(name){
  -&gt;(text){"#{name}「#{text}」"}
}

ryu = chara[:リュウ]
tak = chara[:たかし]
</pre></div></div>

<p>ここからがクロージャの実践になります。 <code>chara</code> といふ函数にキャラ名を渡すと、函数が返ってきます。その函数にせりふとなる文字列を渡してやると、文字列を整形して返します。</p>

<p>つまり、 <code>chara['はまちちゃん']['こんにちはこんにちは！！！']</code> とすることで、 <code>"はまちちゃん「こんにちはこんにちは！！！」"</code> といふ文字列が返ってきます。ここで重要なのは「はまちちゃん」といふキャラクターの情報を持ってゐる途中の状態を保存しておける、といふことです。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">counter.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">{</span>
  <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="o">-&gt;</span><span class="p">{</span> <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">counter</span><span class="o">[]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">counter</span><span class="o">[]</span>

<span class="n">a</span><span class="o">[]</span><span class="p">;</span> <span class="n">b</span><span class="o">[]</span><span class="p">;</span> <span class="n">a</span><span class="o">[]</span><span class="p">;</span> <span class="n">b</span><span class="o">[]</span><span class="p">;</span>
<span class="n">a</span><span class="o">[]</span><span class="p">;</span> <span class="n">a</span><span class="o">[]</span><span class="p">;</span>

<span class="nb">p</span> <span class="n">a</span><span class="o">[]</span>
<span class="c1">#=&gt; 5</span>
<span class="nb">p</span> <span class="n">b</span><span class="o">[]</span>
<span class="c1">#=&gt; 3</span>
</pre></div>
</div>

<p>これはRubyでは一般的な手法ではありません。なぜならRubyはオブジェクト指向言語なので、クラスを定義してオブジェクトを生成する手法がふつうです。つまり、かうします。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">counter_using_class.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span><span class="p">{</span>
  <span class="k">def</span> <span class="nf">[]</span>
    <span class="vi">@n</span> <span class="o">||=</span> <span class="mi">0</span>
    <span class="vi">@n</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">[]</span><span class="p">;</span> <span class="kp">new</span><span class="p">;</span> <span class="k">end</span>
<span class="p">}</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">counter</span><span class="o">[]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">counter</span><span class="o">[]</span>

<span class="n">a</span><span class="o">[]</span><span class="p">;</span> <span class="n">b</span><span class="o">[]</span><span class="p">;</span> <span class="n">a</span><span class="o">[]</span><span class="p">;</span> <span class="n">b</span><span class="o">[]</span><span class="p">;</span>
<span class="n">a</span><span class="o">[]</span><span class="p">;</span> <span class="n">a</span><span class="o">[]</span><span class="p">;</span>

<span class="nb">p</span> <span class="n">a</span><span class="o">[]</span>
<span class="c1">#=&gt; 5</span>
<span class="nb">p</span> <span class="n">b</span><span class="o">[]</span>
<span class="c1">#=&gt; 3</span>
</pre></div>
</div>

<p>Rubyを使ってこのくらゐシンプルな機能を実現するのにクロージャを利用するか、特異クラスを利用するかは完全に趣味の問題です。特異クラスを使った方が <code>inspect</code> が定義されるぶん、作り込まなくても内部状態を調べやすい、といふメリットはあります。もちろん、拡張性はクラスを利用した方が格段に上です。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>script = scripter[
  title[:俺より強い奴に、会いに行く],
  paragraph[
    :ピンポーン,
    ryu[:こんにちは],
    tak[:はいどなた]
  ],paragraph[
    ryu[:いまちょっといいですか], 
    tak[:これから出かけます]
  ],paragraph[
    ryu[:午後出勤ですか？],
    tak[:はい]
  ],paragraph[
    ryu[:強そうですね],
    tak[:なにがですか]
  ],paragraph[
    ryu[:態度が]
  ],paragraph[
    :リュウは、自分より強そうな奴に、会いにいったのだった。　完 
  ]
]
</pre></div></div>

<p>ここが実際にDSLを利用して本文を記述する部分です。全体が <code>scripter[ ... ]</code> で括られてゐて、中身は全て <code>,</code> 区切りの引数になってます。段落ごとに <code>paragraph[ ... ]</code> に渡し、せりふでは <code>ryu</code>, <code>tak</code> 函数にそれぞれせりふを渡します。</p>

<p>なほ、文字列 ( <code>"hogehoge"</code> ) ではなく、シンボル (<code>:hogehoge</code>) といふ形式で書いてるのはRubyをよく知らない人にRubyっぽくないと印象を抱かせることが目的なので、ふつうに文字列で渡して問題ありません。</p>

<h2>
<span id="javascriptで強い奴に会ひに行く" class="fragment"></span><a href="#javascript%E3%81%A7%E5%BC%B7%E3%81%84%E5%A5%B4%E3%81%AB%E4%BC%9A%E3%81%B2%E3%81%AB%E8%A1%8C%E3%81%8F"><i class="fa fa-link"></i></a>JavaScriptで強い奴に会ひに行く</h2>

<p>と、最後になりましたが、このDSLのJavaScript版を紹介します。 node.js で動きました。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">tsuyoi.js</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="kd">var</span> <span class="nx">tag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">memo</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tagname</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">memo</span><span class="p">[</span><span class="nx">tagname</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">memo</span><span class="p">[</span><span class="nx">tagname</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"#{tagname}"</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">"tagname"</span><span class="p">,</span> <span class="nx">tagname</span><span class="p">));</span>
    <span class="p">};</span>
<span class="p">}();</span>
<span class="kd">var</span> <span class="nx">scripter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">));</span>
    <span class="p">};</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">){</span>
    <span class="k">return</span> <span class="s2">"『#{text}』\n"</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">tag</span><span class="p">(</span><span class="s2">"text"</span><span class="p">),</span><span class="nx">text</span><span class="p">);</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">paragraph</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="o">+</span><span class="s2">"\n"</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">chara</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">){</span>
        <span class="k">return</span> <span class="s2">"#{name}「#{text}」"</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">tag</span><span class="p">(</span><span class="s2">"name"</span><span class="p">),</span> <span class="nx">name</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">tag</span><span class="p">(</span><span class="s2">"text"</span><span class="p">),</span> <span class="nx">text</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">ryu</span> <span class="o">=</span> <span class="nx">chara</span><span class="p">(</span><span class="s2">"リュウ"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">tak</span> <span class="o">=</span> <span class="nx">chara</span><span class="p">(</span><span class="s2">"たかし"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">script</span> <span class="o">=</span> <span class="nx">scripter</span><span class="p">(</span>
    <span class="nx">title</span><span class="p">(</span><span class="s2">"俺より強い奴に、会いに行く"</span><span class="p">),</span>
    <span class="nx">paragraph</span><span class="p">(</span>
        <span class="s2">"ピンポーン"</span><span class="p">,</span>
        <span class="nx">ryu</span><span class="p">(</span><span class="s2">"こんにちは"</span><span class="p">),</span>
        <span class="nx">tak</span><span class="p">(</span><span class="s2">"はいどなた"</span><span class="p">)</span>
    <span class="p">),</span><span class="nx">paragraph</span><span class="p">(</span>
        <span class="nx">ryu</span><span class="p">(</span><span class="s2">"いまちょっといいですか"</span><span class="p">),</span> 
        <span class="nx">tak</span><span class="p">(</span><span class="s2">"これから出かけます"</span><span class="p">)</span>
    <span class="p">),</span><span class="nx">paragraph</span><span class="p">(</span>
        <span class="nx">ryu</span><span class="p">(</span><span class="s2">"午後出勤ですか？"</span><span class="p">),</span>
        <span class="nx">tak</span><span class="p">(</span><span class="s2">"はい"</span><span class="p">)</span>
    <span class="p">),</span><span class="nx">paragraph</span><span class="p">(</span>
        <span class="nx">ryu</span><span class="p">(</span><span class="s2">"強そうですね"</span><span class="p">),</span>
        <span class="nx">tak</span><span class="p">(</span><span class="s2">"なにがですか"</span><span class="p">)</span>
    <span class="p">),</span><span class="nx">paragraph</span><span class="p">(</span>
        <span class="nx">ryu</span><span class="p">(</span><span class="s2">"態度が"</span><span class="p">)</span>
    <span class="p">),</span><span class="nx">paragraph</span><span class="p">(</span>
        <span class="s2">"リュウは、自分より強そうな奴に、会いにいったのだった。　完"</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="nx">script</span><span class="p">();</span>
<span class="p">})();</span>
</pre></div>
</div>

<h2>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h2>

<p>えっと、最後にDSLの抽象化のメリットとしてこんなの書いてみたんですけど、そんなにシンプルじゃなくなった気がしてるので、興味あればお読みください。 <a href="https://gist.github.com/3968734" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/3968734</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>84</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/8f9f5c458451167399ae">日本語を書くなら絶対に導入したい! 私が10年で厳選した超おすすめ入力メソッド10選</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-12 20:46:05</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[SKK]</b> <b>[日本語入力]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>こんにちはこんにちは！ 日本語書いてますか？<br>
さて、本日は数々の日本語入力ソフトウェアを使ってきた私が、日本語を書くなら <strong>絶対に</strong> 導入したい超厳選日本語入力メソッドを紹介します ヾ(〃＞＜)ﾉﾞ☆</p>

<p>今回は無料で使用できるものばかり集めてみましたので、有料ソフトに関しては後日またご紹介したいと思ひます（＾＾）</p>

<p>それでは、ご覧ください！！</p>

<p>↓↓↓</p>

<hr>

<h2>
<span id="第10位" class="fragment"></span><a href="#%E7%AC%AC10%E4%BD%8D"><i class="fa fa-link"></i></a>第10位</h2>

<p><a href="https://camo.qiitausercontent.com/6be7a8c2f1493965261c1e9171b1a0001119d727/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f33326239353235622d663137342d306536362d363666662d6337613837393661396539362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6be7a8c2f1493965261c1e9171b1a0001119d727/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f33326239353235622d663137342d306536362d363666662d6337613837393661396539362e706e67" alt="skkime.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/32b9525b-f174-0e66-66ff-c7a8796a9e96.png"></a></p>

<p>はい、定番の <strong>SKKIME for Windows' 98</strong> ですね！ WindowsユーザにはこのバージョンでSKKを知ったひとも多いはずです。</p>

<p>後継OS用にはいくつものSKKが生まれましたが、Windows 98の世界では未だに他の追随を許さない永遠の王者です！</p>

<h2>
<span id="第9位" class="fragment"></span><a href="#%E7%AC%AC9%E4%BD%8D"><i class="fa fa-link"></i></a>第9位</h2>

<p><a href="https://camo.qiitausercontent.com/7110d10d8baa0bf148ec4031c81b62bb5b117fd2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f63366630656433652d393963332d396434612d336339662d3231373737346338346235612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7110d10d8baa0bf148ec4031c81b62bb5b117fd2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f63366630656433652d393963332d396434612d336339662d3231373737346338346235612e706e67" alt="scim-skk.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/c6f0ed3e-99c3-9d4a-3c9f-217774c84b5a.png"></a></p>

<p>9位は <strong>SCIM-SKK</strong> です！ しかしSCIM自体を一瞬しか触らなかったので、僕はあまり使ったことがありません！</p>

<h2>
<span id="第8位" class="fragment"></span><a href="#%E7%AC%AC8%E4%BD%8D"><i class="fa fa-link"></i></a>第8位</h2>

<p><a href="https://camo.qiitausercontent.com/6be7a8c2f1493965261c1e9171b1a0001119d727/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f33326239353235622d663137342d306536362d363666662d6337613837393661396539362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6be7a8c2f1493965261c1e9171b1a0001119d727/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f33326239353235622d663137342d306536362d363666662d6337613837393661396539362e706e67" alt="skkime.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/32b9525b-f174-0e66-66ff-c7a8796a9e96.png"></a></p>

<p>8位にランクインしたのは <strong><a href="http://coexe.web.fc2.com/skkime.html" rel="nofollow noopener" target="_blank">SKKIME 1.5改</a></strong>！</p>

<p>原作である <strong>skkime 1.5</strong> は2003年頃から長きにわたってWindowsの代表的なSKKとして君臨してきた実装で、これをフォークして近代化改修が施されたバージョンになります！</p>

<p>ちなみにskkimeの1.5には看板に偽りがあって、<a href="http://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%B3%E3%83%97%E3%83%83%E3%83%88_%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89_%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF" rel="nofollow noopener" target="_blank">IME</a>ではなく<a href="http://ja.wikipedia.org/wiki/Text_Services_Framework" rel="nofollow noopener" target="_blank">TIP</a>です ヾ(〃＞＜)ﾉﾞ☆</p>

<h2>
<span id="第7位" class="fragment"></span><a href="#%E7%AC%AC7%E4%BD%8D"><i class="fa fa-link"></i></a>第7位</h2>

<p><a href="https://camo.qiitausercontent.com/5b0cc10a954566aa6dfa64d66ecd67ac29c91dce/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f39386330323964612d326236372d313466352d313861302d3530376535333061316466362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5b0cc10a954566aa6dfa64d66ecd67ac29c91dce/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f39386330323964612d326236372d313466352d313861302d3530376535333061316466362e706e67" alt="vimlogo.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/98c029da-2b67-14f5-18a0-507e530a1df6.png"></a></p>

<p>はい、7位は <strong><a href="https://github.com/tyru/eskk.vim" rel="nofollow noopener" target="_blank">eskk.vim</a></strong> です！ </p>

<p>なんとあの<a href="http://blog.supermomonga.com/articles/vim/startdash-with-mac.html" rel="nofollow noopener" target="_blank">Macを購入したら絶対に導入したい！私が3年間で厳選した超オススメアプリ</a>の第一位に選ばれた <strong>Vim</strong> でも快適な日本語入力が！ 可能！ なんです！</p>

<h2>
<span id="第6位" class="fragment"></span><a href="#%E7%AC%AC6%E4%BD%8D"><i class="fa fa-link"></i></a>第6位</h2>

<p><a href="https://camo.qiitausercontent.com/7110d10d8baa0bf148ec4031c81b62bb5b117fd2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f63366630656433652d393963332d396434612d336339662d3231373737346338346235612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7110d10d8baa0bf148ec4031c81b62bb5b117fd2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f63366630656433652d393963332d396434612d336339662d3231373737346338346235612e706e67" alt="scim-skk.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/c6f0ed3e-99c3-9d4a-3c9f-217774c84b5a.png"></a></p>

<p>6位にランクインした <strong>uim-skk</strong> ！ 筆者はiBusに移行するまで、Ubuntuで使ってました。</p>

<h2>
<span id="第5位" class="fragment"></span><a href="#%E7%AC%AC5%E4%BD%8D"><i class="fa fa-link"></i></a>第5位</h2>

<p><a href="https://camo.qiitausercontent.com/f317aa2601d8ee6ade66123c3a209109e53d0495/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f38356438336534342d323239342d366464642d643538622d3237663734376135623430302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f317aa2601d8ee6ade66123c3a209109e53d0495/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f38356438336534342d323239342d366464642d643538622d3237663734376135623430302e706e67" alt="aquaskk.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/85d83e44-2294-6ddd-d58b-27f747a5b400.png"></a></p>

<p>Mac で動くSKK として名高い <strong><a href="http://aquaskk.sourceforge.jp/" rel="nofollow noopener" target="_blank">AquaSKK</a></strong> が第5位にランクイン！ 筆者がふだん一番利用頻度が高いSKKです。</p>

<p>AquaSKKプロジェクトとしては活動を終了してるため、2013年10月現在のところ更新される見込みはありません。</p>

<p>skkservとしても動作するので他のSKKと連携することもできます！ Terminal.appやiTerm2と相性が悪いのが玉に瑕！</p>

<h2>
<span id="第4位" class="fragment"></span><a href="#%E7%AC%AC4%E4%BD%8D"><i class="fa fa-link"></i></a>第4位</h2>

<p><a href="https://camo.qiitausercontent.com/afa1cfa754f66fc9738c4d2f5688e6eefcc0e8ba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31666438326630612d663434312d303930322d313031642d6436346533393639353838642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/afa1cfa754f66fc9738c4d2f5688e6eefcc0e8ba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31666438326630612d663434312d303930322d313031642d6436346533393639353838642e706e67" alt="ibus-skk.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/1fd82f0a-f441-0902-101d-d64e3969588d.png"></a></p>

<p>4位の <strong><a href="https://github.com/ueno/ibus-skk" rel="nofollow noopener" target="_blank">ibus-skk</a></strong> はPC-UNIXのデスクトップ環境で動くSKKクライアント実装です！</p>

<p>初期のバージョン(<a href="http://packages.ubuntu.com/lucid/ibus-skk" rel="nofollow noopener" target="_blank">0.2.1</a>のあたり)はちょっと実用するのは無理なレベルでしたが、進化を続けて優秀なSKKに進化しました！</p>

<p>最近のバージョンは結構すごいらしいですが、筆者はまだUbuntu 12.04 LTSの環境で未だに<a href="http://packages.ubuntu.com/precise/ibus-skk" rel="nofollow noopener" target="_blank">1.3.9</a>を使ってるので、早く最新の環境に移行したいです！ (12.10以降は<a href="http://packages.ubuntu.com/quantal/ibus-skk" rel="nofollow noopener" target="_blank">1.4.1</a>)</p>

<h2>
<span id="第3位" class="fragment"></span><a href="#%E7%AC%AC3%E4%BD%8D"><i class="fa fa-link"></i></a>第3位</h2>

<p><a href="https://camo.qiitausercontent.com/1dc9157241a7be06ec92d529e4fac02bdee6b63f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f36373230383839652d353864342d656566652d613933652d3837626532306564303666642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1dc9157241a7be06ec92d529e4fac02bdee6b63f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f36373230383839652d353864342d656566652d613933652d3837626532306564303666642e706e67" alt="CorvusSKK.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/6720889e-58d4-eefe-a93e-87be20ed06fd.png"></a></p>

<p>3位に輝いた <strong><a href="https://code.google.com/p/corvus-skk/" rel="nofollow noopener" target="_blank">CorvusSKK</a></strong> ！ これはWindowsで動作するSKKで、<a href="http://www.forest.impress.co.jp/docs/review/20121023_567771.html" rel="nofollow noopener" target="_blank">Windowsストアアプリ上でも動作します</a>。</p>

<p>オーソドックスなSKK実装で、<del>skkservとしても動作するので</del>他のSKKと連携することもできます！</p>

<p><ins datetime="2013-10-12T22:25:00:00+09:00">skkservとしては動作しませんが、skkservのクライアントとして動作します。</ins></p>

<h2>
<span id="第2位" class="fragment"></span><a href="#%E7%AC%AC2%E4%BD%8D"><i class="fa fa-link"></i></a>第2位</h2>

<p><a href="https://camo.qiitausercontent.com/d998cbbca7f326c22a893185ca7e3c4187b7ff61/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32653439633936372d373236372d653937342d396235342d3533356533363735626539622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d998cbbca7f326c22a893185ca7e3c4187b7ff61/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32653439633936372d373236372d653937342d396235342d3533356533363735626539622e706e67" alt="emacs.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/2e49c967-7267-e974-9b54-535e3675be9b.png"></a></p>

<p>第2位は <strong>DDSKK</strong> こと <em>Daredevil SKK</em>！ Emacs Lispで書かれたSKK実装で、初代SKKの血を引いた末裔にあたります。</p>

<p>なんとあの<a href="http://blog.id774.net/post/2013/10/11/408/" rel="nofollow noopener" target="_blank">Mac を購入したら絶対に導入したい！超オススメアプリ 10 選！</a>の第一位に選ばれた <strong>Emacs</strong> でも快適な日本語入力が！ 可能！ なんです！</p>

<h2>
<span id="第1位" class="fragment"></span><a href="#%E7%AC%AC1%E4%BD%8D"><i class="fa fa-link"></i></a>第1位</h2>

<p>栄光の第1位は… <a href="http://coexe.web.fc2.com/skkfep.html" rel="nofollow noopener" target="_blank">SKK日本語入力FEP</a>です！</p>

<p>SKKの伝統を受け継ぎつつ、現代的な日本語入力メソッドとして再設計され、ほかの日本語入力からの移行も違和感がありません！</p>

<p>skkime(1.5系)からの伝統に則って、<a href="http://ja.wikipedia.org/wiki/%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%83%97%E3%83%AD%E3%82%BB%E3%83%83%E3%82%B5" rel="nofollow noopener" target="_blank">FEP</a>を名乗ってるくせに<a href="http://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%B3%E3%83%97%E3%83%83%E3%83%88_%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89_%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF" rel="nofollow noopener" target="_blank">IME</a>ですらなく<a href="http://ja.wikipedia.org/wiki/Text_Services_Framework" rel="nofollow noopener" target="_blank">TIP</a>だといふ小憎いやつです。</p>

<h2>
<span id="もとねた" class="fragment"></span><a href="#%E3%82%82%E3%81%A8%E3%81%AD%E3%81%9F"><i class="fa fa-link"></i></a>もとねた</h2>

<ul>
<li><a href="http://blog.supermomonga.com/articles/vim/startdash-with-mac.html" rel="nofollow noopener" target="_blank">Macを購入したら絶対に導入したい！私が3年間で厳選した超オススメアプリ10選！ | かなりすごいブログ</a></li>
<li><a href="http://blog.id774.net/post/2013/10/11/408/" rel="nofollow noopener" target="_blank">Mac を購入したら絶対に導入したい！超オススメアプリ 10 選！ | 774::Blog</a></li>
</ul>

<p>SKKのすごいところは、MacでもLinuxでもWindowsでも*BSDでもEmacsでもVimでも動くところなんです！！！！１１</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>ここだけちょっとまじめに。</p>

<ul>
<li>Windows(Vista, 7, 8)

<ul>
<li>伝統的なSKKが良い→ <strong>CorvusSKK</strong>
</li>
<li>SKKであることに拘らない→ <strong>SKKFEP</strong>
</li>
</ul>
</li>
<li>Mac OS X(10.3以降)

<ul>
<li><strong>AquaSKK</strong></li>
</ul>
</li>
<li>Linux, *BSD, 他UNIXのデスクトップ環境

<ul>
<li>(ただしインプットメソッドフレームワークはOS標準のパッケージマネージャで入れる前提)</li>
<li>
<a href="http://ja.wikipedia.org/wiki/IBus" rel="nofollow noopener" target="_blank">iBus</a>動かせる→ <strong>ibus-skk</strong>

<ul>
<li>12.04以降のUbuntuならおすすめ</li>
</ul>
</li>
<li>
<a href="http://ja.wikipedia.org/wiki/Uim" rel="nofollow noopener" target="_blank">uim</a>動かせる→ <strong>uim-skk</strong>

<ul>
<li>Ubuntuの10.04 LTSとかならuimを入れてこっち</li>
</ul>
</li>
<li>
<a href="http://ja.wikipedia.org/wiki/SCIM" rel="nofollow noopener" target="_blank">SCIM</a>がいい→ <strong>scim-skk</strong>
</li>
</ul>
</li>
<li>Emacsで上記との組合せがうまく動かない

<ul>
<li><strong>ddskk</strong></li>
</ul>
</li>
<li>Vimで上記との組合せがうまく動かない

<ul>
<li><strong>eskk.vim</strong></li>
</ul>
</li>
<li>Windows XP

<ul>
<li><em>SKKIME 1.5改</em></li>
</ul>
</li>
<li>Windows 2000

<ul>
<li>
<strong>SKKIME 1.5 for Windows 2000</strong> (本家)</li>
</ul>
</li>
<li>Windows 98

<ul>
<li><strong>SKKIME 1.0 for Windows' 98</strong></li>
</ul>
</li>
</ul>

<p>環境から選ぶとこんな感じになるんじゃないですかね…?</p>

<p>筆者が常用してるのは <strong>AquaSKK</strong>, <strong>SKK日本語入力FEP</strong>, <strong>ibus-skk(1.3.9)</strong> です。端末やGUIのEmacsでも現在のところ特に困ってないので、基本的には同じものを使ってます。</p>

<p>ちなみに、Windows Mobile, Android, iOSにはSKK実装が事実上存在しないので、標準インプットメソッドよりましなものを求めてATOKに依存してます… ぐぬぬぬぬ…</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>61</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/7c1280808a3035a26611">IntelliJ IDEA 13にRubyプラグインをインストール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-18 03:38:35</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[IntelliJ]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>なんか情弱い感じのタイトルでかっこわるいんですけど、ここまで辿りつくのに相当苦労しました…</p>

<p>IDEとかまじめに使ったことがないので正直よくわからないんですが。</p>

<h2>
<span id="なぜプラグインが必要か" class="fragment"></span><a href="#%E3%81%AA%E3%81%9C%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%8B"><i class="fa fa-link"></i></a>なぜプラグインが必要か</h2>

<p>IntelliJ IDEA は <em>RubyMine</em>, <em>PyCharm</em>, <em>PhpStorm</em>, <em>Android Studio</em>, <em>WebStorm</em> などの言語に特化したIDEの機能を全て持つ全部入りバージョン… なのですが、実は前者3つの機能はIntelliJ IDEA 13 Ultimate Editionの標準パッケージには含まれて居らず、プラグインをインストールする必要があります。</p>

<p>が、そのプラグインのインストール方法が全然わからんので探しました。</p>

<h3>
<span id="罠" class="fragment"></span><a href="#%E7%BD%A0"><i class="fa fa-link"></i></a>罠</h3>

<p><a href="http://www.jetbrains.com/idea/features/ruby_rails.html" rel="nofollow noopener" target="_blank">IntelliJ IDEA :: Ruby on Rails IDE for quick reach web application development</a>などを見ると<a href="http://plugins.jetbrains.com/plugin/?id=1293" rel="nofollow noopener" target="_blank">JetBrains Plugin Repository :: Ruby</a>へのリンクはあるが、今は無視しろ。ここからダウンロードする必要はない。</p>

<h2>
<span id="プラグインをインストールしよう" class="fragment"></span><a href="#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>プラグインをインストールしよう</h2>

<p>例ではRubyを取り上げますが、PHPやPythonでもだいたい同じはず。</p>

<h3>
<span id="1-メニューからpreferencesを選ぶ" class="fragment"></span><a href="#1-%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%81%8B%E3%82%89preferences%E3%82%92%E9%81%B8%E3%81%B6"><i class="fa fa-link"></i></a>1. メニューから<code>Preferences...</code>を選ぶ</h3>

<p><a href="https://camo.qiitausercontent.com/e9417b8bbddca31f7df83f286bbcab96f792702b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32303563643563312d303034322d386230372d303662612d3863376137346235663266302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e9417b8bbddca31f7df83f286bbcab96f792702b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32303563643563312d303034322d386230372d303662612d3863376137346235663266302e706e67" alt="IntelliJ IDEAのメニューバーにある`Preferences...`を選択" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/205cd5c1-0042-8b07-06ba-8c7a74b5f2f0.png"></a></p>

<h3>
<span id="2-設定項目からpluginsを探し出しbrowse-repositoriesを押す" class="fragment"></span><a href="#2-%E8%A8%AD%E5%AE%9A%E9%A0%85%E7%9B%AE%E3%81%8B%E3%82%89plugins%E3%82%92%E6%8E%A2%E3%81%97%E5%87%BA%E3%81%97browse-repositories%E3%82%92%E6%8A%BC%E3%81%99"><i class="fa fa-link"></i></a>2. 設定項目から<code>Plugins</code>を探し出し<code>Browse repositories...</code>を押す</h3>

<p><a href="https://camo.qiitausercontent.com/a3b99a21fddb634f2cf8cb2686b7aa4ca00c6e43/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32313861383731342d623163652d356465662d326237632d6531346230336238623937622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a3b99a21fddb634f2cf8cb2686b7aa4ca00c6e43/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32313861383731342d623163652d356465662d326237632d6531346230336238623937622e706e67" alt="`Preference`の左ペインの`IDE Settings/Plugin`を選び、`Browse repositories...`を押す" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/218a8714-b1ce-5def-2b7c-e14b03b8b97b.png"></a></p>

<h3>
<span id="3-検索窓にrubyと入力してrubyプラグインを探し出しダブルクリックする" class="fragment"></span><a href="#3-%E6%A4%9C%E7%B4%A2%E7%AA%93%E3%81%ABruby%E3%81%A8%E5%85%A5%E5%8A%9B%E3%81%97%E3%81%A6ruby%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E6%8E%A2%E3%81%97%E5%87%BA%E3%81%97%E3%83%80%E3%83%96%E3%83%AB%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3. 検索窓に<code>ruby</code>と入力してRubyプラグインを探し出し、ダブルクリックする</h3>

<p><a href="https://camo.qiitausercontent.com/c70138de9e2dda73cbda3548593232219837141c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f65303262316339322d393366342d353835342d333765332d3336666462633162663066362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c70138de9e2dda73cbda3548593232219837141c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f65303262316339322d393366342d353835342d333765332d3336666462633162663066362e706e67" alt="`Browse Repositories`を`ruby `で検索して、`Ruby`をダブルクリックする" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/e02b1c92-93f4-5854-37e3-36fdbc1bf0f6.png"></a></p>

<h4>
<span id="罠-1" class="fragment"></span><a href="#%E7%BD%A0-1"><i class="fa fa-link"></i></a>罠</h4>

<ul>
<li>デフォルトのソート順だと<code>Ruby</code>が下の方になります

<ul>
<li>あと、検索は<code>ruby</code>(←最後のスペース重要)でしないと、埋もれる</li>
</ul>
</li>
<li>そんな小手先の技を使っても、PHPは埋もれてるのでがんばって探してください</li>
<li>そんな小手先の技がなくても、Pythonはすぐに見つかります</li>
</ul>

<h3>
<span id="4-インストールしていいか確認されるので気前良くyesを押す" class="fragment"></span><a href="#4-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%97%E3%81%A6%E3%81%84%E3%81%84%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%95%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%A7%E6%B0%97%E5%89%8D%E8%89%AF%E3%81%8Fyes%E3%82%92%E6%8A%BC%E3%81%99"><i class="fa fa-link"></i></a>4. インストールしていいか確認されるので、気前良く<code>Yes</code>を押す</h3>

<p><a href="https://camo.qiitausercontent.com/71cc0ebcd5866d7ff95f450e44f2df0119fa39a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f62666131333031662d356166662d663063622d623730312d3030383335653939386563652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/71cc0ebcd5866d7ff95f450e44f2df0119fa39a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f62666131333031662d356166662d663063622d623730312d3030383335653939386563652e706e67" alt="Download_and_Install_と_Browse_Repositories_と_Preferences_と_ruby-zhttp_-____repo_ruby-zhttp_.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/bfa1301f-5aff-f0cb-b701-00835e998ece.png"></a></p>

<h3>
<span id="5-ほかにも必要っぽいプラグインがあれば入れる" class="fragment"></span><a href="#5-%E3%81%BB%E3%81%8B%E3%81%AB%E3%82%82%E5%BF%85%E8%A6%81%E3%81%A3%E3%81%BD%E3%81%84%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%8C%E3%81%82%E3%82%8C%E3%81%B0%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>5. ほかにも必要っぽいプラグインがあれば入れる</h3>

<p>プラグインの有効化には再起動が必要なので、必要っぽいのは入れられるだけ入れてみる。</p>

<ul>
<li><code>Markdown</code></li>
<li>Ruby

<ul>
<li><code>Railways</code></li>
<li><code>Slim</code></li>
</ul>
</li>
</ul>

<p>RailsとかSlimは使ふので入れた。</p>

<p>終ったらウィンドウをCloseする。</p>

<p><a href="https://camo.qiitausercontent.com/4f7b1f5cd22c8a3570afa0bd6965c12955953537/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31323563383166362d656163382d363465362d353132342d6563633133616232353663362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4f7b1f5cd22c8a3570afa0bd6965c12955953537/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31323563383166362d656163382d363465362d353132342d6563633133616232353663362e706e67" alt="`Browse_Repositories`の右下にある`Closeボタンを押す`" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/125c81f6-eac8-64e6-5124-ecc13ab256c6.png"></a></p>

<h3>
<span id="6-okを押しプラグインを有効化するために再起動する" class="fragment"></span><a href="#6-ok%E3%82%92%E6%8A%BC%E3%81%97%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E5%86%8D%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>6. <code>OK</code>を押し、プラグインを有効化するために再起動する</h3>

<p><a href="https://camo.qiitausercontent.com/27156106a9d775650910f3b0dfe2160953802ab0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f66366661653934362d643865322d383264372d666534642d3032656538653135623964302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/27156106a9d775650910f3b0dfe2160953802ab0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f66366661653934362d643865322d383264372d666534642d3032656538653135623964302e706e67" alt="`Preference`の右下の`Close`を押し、続いて確認ダイアログの`Restart`を押す" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/f6fae946-d8e2-82d7-fe4d-02ee8e15b9d0.png"></a></p>

<p>しばし待て。</p>

<h3>
<span id="7-再起動する" class="fragment"></span><a href="#7-%E5%86%8D%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>7. 再起動する</h3>

<p>やったねたえちゃん</p>

<h2>
<span id="既存のプロジェクトを開く" class="fragment"></span><a href="#%E6%97%A2%E5%AD%98%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E9%96%8B%E3%81%8F"><i class="fa fa-link"></i></a>既存のプロジェクトを開く</h2>

<h3>
<span id="1-メニューからプロジェクトを新規作成" class="fragment"></span><a href="#1-%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%81%8B%E3%82%89%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1. メニューからプロジェクトを新規作成</h3>

<p><a href="https://camo.qiitausercontent.com/9a10ce74a6238819a214ed0f3172a3c108482846/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f34613764326334392d386535612d386266662d666264322d3036656635363934666435372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9a10ce74a6238819a214ed0f3172a3c108482846/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f34613764326334392d386535612d386266662d666264322d3036656635363934666435372e706e67" alt="File_と_Menubar-4.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/4a7d2c49-8e5a-8bff-fbd2-06ef5694fd57.png"></a></p>

<h3>
<span id="2-rubyを選びプロジェクトのディレクトリを指定しnextを押す" class="fragment"></span><a href="#2-ruby%E3%82%92%E9%81%B8%E3%81%B3%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97next%E3%82%92%E6%8A%BC%E3%81%99"><i class="fa fa-link"></i></a>2. <code>Ruby</code>を選び、プロジェクトのディレクトリを指定し、<code>Next</code>を押す</h3>

<p><a href="https://camo.qiitausercontent.com/f81b16ffe053746942f01b619e9140920062c2df/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f37643534366631632d313937612d383431632d616639632d3062316630353730613038652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f81b16ffe053746942f01b619e9140920062c2df/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f37643534366631632d313937612d383431632d616639632d3062316630353730613038652e706e67" alt="左ペインから`Other Project/Ruby`を選択し、プロジェクトのディレクトリを指定し、右下の`Next`を押す" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/7d546f1c-197a-841c-af9c-0b1f0570a08e.png"></a></p>

<h3>
<span id="3-sdkを選択する" class="fragment"></span><a href="#3-sdk%E3%82%92%E9%81%B8%E6%8A%9E%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3. SDKを選択する</h3>

<p><a href="https://camo.qiitausercontent.com/f915da38d23e2dceccb1cbdb625cc26bbcd4d0da/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32653263623664382d303933382d363365332d623265302d3162346336383065623331662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f915da38d23e2dceccb1cbdb625cc26bbcd4d0da/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f32653263623664382d303933382d363365332d623265302d3162346336383065623331662e706e67" alt="New_Project" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/2e2cb6d8-0938-63e3-b2e0-1b4c680eb31f.png"></a></p>

<p>「<a href="https://github.com/sstephenson/rbenv" rel="nofollow noopener" target="_blank">rbenv</a>は<a href="https://ja.wikipedia.org/wiki/%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E9%96%8B%E7%99%BA%E3%82%AD%E3%83%83%E3%83%88" rel="nofollow noopener" target="_blank">SDK</a>なのか?」との疑問もあるが、ここはぐっと我慢の子です。</p>

<p>rbenvがSDKだといふよりも、どうもRubyのインタプリタと標準ライブラリがSDKなのか。</p>

<h3>
<span id="4-依存する技術があればチェックをつけfinishを押す" class="fragment"></span><a href="#4-%E4%BE%9D%E5%AD%98%E3%81%99%E3%82%8B%E6%8A%80%E8%A1%93%E3%81%8C%E3%81%82%E3%82%8C%E3%81%B0%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%92%E3%81%A4%E3%81%91finish%E3%82%92%E6%8A%BC%E3%81%99"><i class="fa fa-link"></i></a>4. 依存する技術があればチェックをつけ、<code>Finish</code>を押す</h3>

<p><a href="https://camo.qiitausercontent.com/a01864dcf1e214da35ed1b12b11cb648f00279c4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f38356337343831322d393530322d373335662d356365332d3730646434306536323738302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a01864dcf1e214da35ed1b12b11cb648f00279c4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f38356337343831322d393530322d373335662d356365332d3730646434306536323738302e706e67" alt="Prease select the desired technologies." data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/85c74812-9502-735f-5ce3-70dd40e62780.png"></a></p>

<p>今回はライブラリなので、特に何にも依存しない。</p>

<h3>
<span id="5-プロジェクトファイルをバージョン管理対象にするか聞かれるので二度と聞かれないようにチェックを入れて華麗に断る" class="fragment"></span><a href="#5-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E5%AF%BE%E8%B1%A1%E3%81%AB%E3%81%99%E3%82%8B%E3%81%8B%E8%81%9E%E3%81%8B%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%A7%E4%BA%8C%E5%BA%A6%E3%81%A8%E8%81%9E%E3%81%8B%E3%82%8C%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%92%E5%85%A5%E3%82%8C%E3%81%A6%E8%8F%AF%E9%BA%97%E3%81%AB%E6%96%AD%E3%82%8B"><i class="fa fa-link"></i></a>5. プロジェクトファイルをバージョン管理対象にするか聞かれるので二度と聞かれないようにチェックを入れて華麗に断る</h3>

<p><a href="https://camo.qiitausercontent.com/901340ccfaa4ab9ee7079cf5a27251ad62385bba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31303064363638662d376364642d656635312d333833642d6139613735373337343662302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/901340ccfaa4ab9ee7079cf5a27251ad62385bba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31303064363638662d376364642d656635312d333833642d6139613735373337343662302e706e67" alt="`Add File to Git`ダイアログで`Remember, don't ask again`にチェックを入れ、`No`と押す" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/100d668f-7cdd-ef51-383d-a9a7573746b0.png"></a></p>

<p>僕の人生では特定のIDEのプロジェクトファイルが管理対象になる必要性は生じない気がするので断る。もし必要になることがあれば、そのときは自分で追加するだろ。</p>

<h3>
<span id="6-プロジェクトのディレクトリにbundlerをセットアップ" class="fragment"></span><a href="#6-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%ABbundler%E3%82%92%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>6. プロジェクトのディレクトリにBundlerをセットアップ</h3>

<p>このプロジェクトは<code>git clone</code>したての新鮮なリポジトリなので、<code>bundle install</code>とかしてませんでしたてへぺろ。</p>

<p><a href="https://camo.qiitausercontent.com/628105c6b8db129a1a012ed007c4de60c485a967/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f64643761643736652d313135652d663030392d353430302d3733613638316539633037632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/628105c6b8db129a1a012ed007c4de60c485a967/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f64643761643736652d313135652d663030392d353430302d3733613638316539633037632e706e67" alt="ウィンドウ右上のポップアップの`install missing gems`を押す" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/dd7ad76e-115e-f009-5400-73a681e9c07c.png"></a></p>

<p>このポップアップはすぐ消える。同じことをするにはメニューから<code>Tools→Bundler→Install</code>する。拘りがないなら、オプションは空欄で。</p>

<h3>
<span id="7-開発を始める準備が完了" class="fragment"></span><a href="#7-%E9%96%8B%E7%99%BA%E3%82%92%E5%A7%8B%E3%82%81%E3%82%8B%E6%BA%96%E5%82%99%E3%81%8C%E5%AE%8C%E4%BA%86"><i class="fa fa-link"></i></a>7. 開発を始める準備が完了</h3>

<p><a href="https://camo.qiitausercontent.com/42d071e8939e8610ffb02b8a13c017564c7bc4c3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31343532616534312d316565392d333436352d363265302d6661633933646137643361362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/42d071e8939e8610ffb02b8a13c017564c7bc4c3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31343532616534312d316565392d333436352d363265302d6661633933646137643361362e706e67" alt="`rubicure`" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/1452ae41-1ee9-3465-62e0-fac93da7d3a6.png"></a></p>

<p><q cite="アニメ『フレッシュプリキュア!』 登場人物の蒼乃美希口癖より"><strong>あたし完璧！</strong></q>(by <a href="http://dic.pixiv.net/a/%E8%92%BC%E4%B9%83%E7%BE%8E%E5%B8%8C" rel="nofollow noopener" target="_blank">mktn</a></p>

<h2>
<span id="phpは" class="fragment"></span><a href="#php%E3%81%AF"><i class="fa fa-link"></i></a>PHPは…?</h2>

<p>僕にはよくわからなかった。</p>

<p>ちなみに<code>Composer project</code>は既存の<code>phar</code>をダウンロードして展開してくれる、超強力な機能。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>安くはなかったので、それなりに使ってみたいところです ヾ(〃＞＜)ﾉﾞ☆</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>44</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/e718cf3a90fc29f61107">コマンドラインから画像形式を変換する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-10 12:21:52</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ImageMagick]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="最初に結論" class="fragment"></span><a href="#%E6%9C%80%E5%88%9D%E3%81%AB%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>最初に結論</h2>

<p><a href="http://www.imagemagick.org/script/index.php" rel="nofollow noopener" target="_blank">ImageMagick</a>に入ってる <code>convert</code> コマンドを使ふ。</p>

<p>以下のコマンドを実行すると、PNGから可能な限り劣化を最小限に変換できる。 <strong>Windows可</strong></p>

<div class="code-frame" data-lang="bat"><div class="highlight"><pre><span></span>convert hogehoge.png -quality 100 hogehoge.jpg
</pre></div></div>

<h2>
<span id="画像形式について" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E5%BD%A2%E5%BC%8F%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>画像形式について</h2>

<p>画像形式にはJPEGやPNG、GIF、それとWindows bitmap(BMP)なんかがありますね。いや、ほかにもたくさんたくさんあるんですけど、Webで汎用的かつ一般に流通してるのは99.9%これですね。</p>

<p>最近のアプリケーションはたいてい賢いので、これらの形式ならどれでも大差なく扱ってくれるのですが、それでもどれか一つの形式に統一しなければいけない、あるいはしておきたい場面はあるものです。</p>

<p>ちょっと考へてみたところでは、同人ゲーム制作なんかではありがちかもしれないですね。僕はやったことないですけど。</p>

<p>んで、上に挙げた形式の中でJPEGだけは <strong>lossy</strong> (データを間引くことでサイズを縮める、つまりファイルが劣化する。非可逆)なファイル形式です。JPEGに変換するだけで、確実にデータが損失します。ところが <strong>どうしてもJPEGにしたい</strong> といふことはあります。 <em>僕にはあるんです</em></p>

<p>そんなときには妥協して、PNGなどからJPEGの圧縮率100に変換することにします。圧縮率100とは、JPEGの最も高画質な状態です(が、通常はそれでも僅かに劣化することに注意する必要があります)。</p>

<p>で、圧縮率100のJPEGに変換してやるにはGIMPなどを使ってもできるんですが、起動がめんどくさいのと、マウス操作必須なのでいろいろだるいです(数年前はこれでやってました…)。そこで、コマンドラインから <a href="http://www.imagemagick.org/script/index.php" rel="nofollow noopener" target="_blank">ImageMagick</a> を使ひませう。</p>

<p>ちなみにGIF形式は仕様上256色までしか扱ふことができないので、単純なアイコンなどには向きますが、写真や鮮やかな色彩のイラストなどでは減色の必要があり、やはり画質の劣化、データの損失が発生します。</p>

<h2>
<span id="imagemagickの導入" class="fragment"></span><a href="#imagemagick%E3%81%AE%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>ImageMagickの導入</h2>

<p>Windowsのひとは <a href="http://www.imagemagick.org/script/binary-releases.php#windows" rel="nofollow noopener" target="_blank">ImageMagick: Install from Binary Distribution</a> から <em>"Win32 dynamic at 16 bits-per-pixel"</em> ってやつを選んでインストール。 (なんでこんなに差分があるのよ、って理由はリンク先に英語で書いてあるんですが、精度の問題です。ふつうはこのバージョン以外を選ぶ理由はない)</p>

<p>DebianとかUbuntuを使ってたら <code>sudo apt-get install imagemagick</code> とかやったら入る気がします。Mac OS XならHomeBrewでもMacPortsでも入るんじゃないですかね。入ったはずです。タブンネ。</p>

<h2>
<span id="画像形式を変換する" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E5%BD%A2%E5%BC%8F%E3%82%92%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>画像形式を変換する</h2>

<p><strong>やり方は冒頭に書いた通り</strong> なのですが、これでは説明不足なので補足します。ImageMagickはとっても賢い子なので、拡張子から空気を読んで、よしなにファイル形式を選んでくれます。</p>

<p><code>-quality 100</code> と指定する必要があるのは(ここまで紹介してきた形式では)JPEGだけです。つまり、GIFからPNGに変換するには次のやうにすれば良いです。</p>

<div class="code-frame" data-lang="bat"><div class="highlight"><pre><span></span>convert hogehoge.gif hogehoge.png
</pre></div></div>

<p>あと、 <code>-quality 100</code> の指定なしにJPEGに変換しようとすると、ファイルサイズは縮みますが</p>

<h2>
<span id="pngからjpegに決め打ちで変換したい" class="fragment"></span><a href="#png%E3%81%8B%E3%82%89jpeg%E3%81%AB%E6%B1%BA%E3%82%81%E6%89%93%E3%81%A1%E3%81%A7%E5%A4%89%E6%8F%9B%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>PNGからJPEGに決め打ちで変換したい</h2>

<p>僕の使ってる用途(CDのアルバムアートを合法的に蒐集して音楽ライブラリに取り込む)だと、PNGで存在する画像をJPEGにしたい! って感じなので、わざわざこんなコマンドを打ち込むのはめんどくさいですね。</p>

<p>ってわけで、バッチファイルにします。ファイル名は <code>p2j.bat</code> といふ名前にして、 <code>Path</code> の通ったフォルダに保存します。よくわかんないならメモ帳か何かでデスクトップに保存してから、マウスで <code>C:\Windows</code> とかに抛り込むと良いんじゃないですかね。きっと。</p>

<div class="code-frame" data-lang="bat">
<div class="code-lang"><span class="bold">p2j.bat</span></div>
<div class="highlight"><pre><span></span><span class="c1">REM p2j: PNG-to-JPEG convert</span>
<span class="c1">REM usage:</span>
<span class="c1">REM     p2j hogehoge</span>
<span class="c1">REM hogehoge.png -&gt; hogehoge.jpg</span>
convert <span class="s2">"</span><span class="nv">%~pn1</span><span class="s2">.png"</span> -quality 100 <span class="s2">"</span><span class="nv">%~pn1</span><span class="s2">.jpg"</span>
</pre></div>
</div>

<p>変換したい対象の画像ファイルが <code>folder.png</code> で、これをJPEGに変換したいとします。そのファイルのあるフォルダをエクスプローラで開いて、アドレスバーに <code>p2j folder</code> と打ち込みます。すると、 <code>folder.jpg</code> ができあがります。</p>

<p>えっ、そんなのめんどくさい? 覚えられない? うるせえ。 [png jpeg 右クリック 変換] とかで検索して出てきたツールでも入れてりゃ良いんじゃないんですか? クォリティも使ひ方も安全性も面倒見切れませんよ＞＜</p>

<h2>
<span id="ちなみにちなみに" class="fragment"></span><a href="#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB"><i class="fa fa-link"></i></a>ちなみにちなみに</h2>

<p><code>-compress LossLess</code> を指定してやればロスレス形式のJPEGに変換できる… のですが、これは互換性の問題で非推奨です(Windows7では表示できましたが、どのJPEGライブラリでもデコードできるとは限りません)。</p>

<p>僕は「一枚単位で画像変換するくらゐでけちけちする必要ないよね!」といふ <em>富豪的プログラミングな発想</em> で <strong>Q16</strong> を勧めるのですが、大量の画像を捌くから高速な方が良い! なんて場合は <strong>Q8</strong> 版を使って全然大丈夫なはずです。それから、<a href="http://qiita.com/items/e86a1cf8fe64dc8bf1b8">ImageMagick高速化まとめ #ImageMagick #Linux - Qiita</a>によれば、自前でビルドできるなら  <code>--disable-openmp</code> オプションを付けてやると良いみたいですね。僕は知りません。</p>

<p>あと、ImageMagickには <code>mogrify</code> といふコマンドがあって、これを使っても似たやうなことができ、なほかつ一括処理に向いてゐます。が、こちらを使ふと基本的にファイルは上書きしてしまふことになるので、僕は使ひません。PNGからJPEGへの変換は必ずlossyなので、元のファイルは残しておきたいからです。</p>

<h2>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h2>

<ul>
<li><a href="http://www.imagemagick.org/Usage/formats/" rel="nofollow noopener" target="_blank">Common Formats -- IM v6 Examples</a></li>
</ul>

<p>……あんまり読んでないです＞＜</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>42</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/c4a80f46623ea266f5c5">ぼくの.emacs 2013</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-01 20:03:31</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>12月がはじまりました。アドベントカレンダーの季節です。</p>

<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>筆者は仕事でRubyやPHPを書いたりしてます。ふだんはUbuntu 12.04 LTSで<a href="https://launchpad.net/%7Ecassou/+archive/emacs" rel="nofollow noopener" target="_blank">ppa:cassou/emacs</a>のEmacsをデスクトップで使用してますが、Ubuntu 12.10以降には<a href="http://packages.ubuntu.com/quantal/emacs24" rel="nofollow noopener" target="_blank">emacs24</a>パッケージもあります。</p>

<p>個人的な文章やプログラムはMacBook Airで<a href="http://sourceforge.jp/projects/macemacsjp/releases/?package_id=13490" rel="nofollow noopener" target="_blank">Emacs24-with-inline-patch - MacEmacs JP</a>のパッケージでインストールしたものをターミナルから起動するようにしてます。</p>

<p>現在仕事で利用してる現行の<code>.emacs</code>は<a href="https://gist.github.com/zonuexe/3696989" rel="nofollow noopener" target="_blank">gist:zonuexe/3696989</a>ですが、今回紹介する<code>.emacs</code>は移行作業中の<a href="https://github.com/zonuexe/.emacs.d" rel="nofollow noopener" target="_blank">zonuexe/.emacs.d</a>です。</p>

<h2>
<span id="セットアップ" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>セットアップ</h2>

<p>Emacs24が利用できる環境では<code>git clone</code>してEmacsを起動するだけで準備完了します。そのために、<code>init.el</code>は以下のようになってます。</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">init.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">load</span> <span class="p">(</span><span class="nv">locate-user-emacs-file</span> <span class="s">"./macros"</span><span class="p">))</span>
<span class="p">(</span><span class="nb">load</span> <span class="p">(</span><span class="nv">locate-user-emacs-file</span> <span class="s">"./packages"</span><span class="p">))</span>

<span class="c1">;;; load config files</span>
<span class="p">(</span><span class="nv">pkg-sync</span> <span class="ss">'init-loader</span> <span class="nb">require</span>
          <span class="p">(</span><span class="nv">init-loader-load</span> <span class="p">(</span><span class="nv">locate-user-emacs-file</span> <span class="s">"./conf"</span><span class="p">)))</span>
</pre></div>
</div>

<p><code>pkg-sync</code>は指定したパッケージがインストールされてなければ<code>pakcage.el</code>で自動インストールされるようになってます。</p>

<p>パッケージの導入時には<code>M-x package-install</code>して… と説明されることが多いですが、そのでは別の環境で再セットアップをする際の手順がとても複雑になるので筆者は設定ファイルに直接書き込む方法が好きです。</p>

<p>ただし現状では、セットアップのために初回起動時のみ2度ほどEmacsを再起動する必要はあります。また、パッケージが勝手に最新にアップデートされたりはしないので、更新頻度の高いものはたまに更新してやってください。</p>

<p>package.elの使用方法、パッケージのアップグレードのしかたなどは<a href="http://emacs-jp.github.io/packages/package-management/package-el.html" rel="nofollow noopener" target="_blank">package.el - Emacs JP</a>に日本語で情報がまとまってます。</p>

<h3>
<span id="pakcageel-vs-el-get" class="fragment"></span><a href="#pakcageel-vs-el-get"><i class="fa fa-link"></i></a>pakcage.el VS El-Get</h3>

<p><code>package.el</code>はEmacs24に標準添付の機能ですが、競合するパッケージ管理の仕組には<a href="https://github.com/dimitri/el-get" rel="nofollow noopener" target="_blank">El-Get</a>があります。El-Getでも対話的なインストール(<code>M-x el-get-install</code>)を利用することができますが、以下のようにも書くことができます。</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">helm.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">el-get</span> <span class="ss">'sync</span> <span class="ss">'helm</span><span class="p">)</span>
<span class="p">(</span><span class="nv">helm-mode</span> <span class="no">t</span><span class="p">)</span>
</pre></div>
</div>

<p>このようにすることで、依存するパッケージの管理と必要な設定を接近して書くことができるので筆者は好きです。</p>

<p><code>el-get 'sync</code>のこの記法にインスパイヤされて作ったのが<code>pkg-sync</code>で、このように書くことができるようになります。</p>

<div class="code-frame" data-lang="common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">pkg-sync</span> <span class="ss">'helm</span> <span class="nb">require</span><span class="p">)</span>
<span class="p">(</span><span class="nv">helm-mode</span> <span class="no">t</span><span class="p">)</span>
</pre></div></div>

<p><code>package.el</code>とEl-Getのどちらが良いのか筆者はまだ結論を出せてません。なので、いまはまだEmacs23の頃からよく慣れたEl-Getを使用することが多いです。</p>

<h2>
<span id="ui要素" class="fragment"></span><a href="#ui%E8%A6%81%E7%B4%A0"><i class="fa fa-link"></i></a>UI要素</h2>

<p>意外にこの設定をしてないひとが多い気がするのですが、Emacsのツールバー(アイコンが並んだ領域)とメニューバー(文字が並んだ領域)は隠すことができます。</p>

<p>MacやUbuntu(Unity)のようにシステムのメニューバーとアプリケーションのメニューバー・タイトルバーが統合されたデスクトップ環境以外ではメニューバーがほぼ一行ぶんの画面領域を占有してますが、これを非表示にすることで表示できる文字数が増えます。</p>

<div class="code-frame" data-lang="common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">cond</span>
 <span class="p">(</span><span class="nv">window-system</span> <span class="p">(</span><span class="nv">tool-bar-mode</span> <span class="mi">-1</span><span class="p">))</span>
 <span class="p">(</span><span class="no">t</span>             <span class="p">(</span><span class="nv">menu-bar-mode</span> <span class="mi">-1</span><span class="p">)))</span>
</pre></div></div>

<h3>
<span id="端末とマウス" class="fragment"></span><a href="#%E7%AB%AF%E6%9C%AB%E3%81%A8%E3%83%9E%E3%82%A6%E3%82%B9"><i class="fa fa-link"></i></a>端末とマウス</h3>

<p>ちなみに端末で使用中にメニューバーが表示されるのは決して飾りではありません。</p>

<p><code>xterm-mouse-mode</code>を有効することで、メニューバーをクリックするとその要素に直接アクセスできるようになります。便利… かなあ? 標準的なアクセス方法としては<code>M-</code>`でメニューバーの機能を利用することができます。</p>

<p>メニューバーは不必要な存在ではありますが、<code>xterm-mouse-mode</code>は便利かもしれないし、便利ではないかもしれません。筆者は好きです。</p>

<h2>
<span id="magit" class="fragment"></span><a href="#magit"><i class="fa fa-link"></i></a>Magit</h2>

<p><a href="https://github.com/magit/magit" rel="nofollow noopener" target="_blank">magit</a>はEmacsから利用できるGitのインターフェイスです。Magitを使用するために標準添付のvc-gitは不必要になるので無効化しておきます。</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">vc.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">vc-handled-backends</span> <span class="o">'</span><span class="p">())</span>
<span class="p">(</span><span class="nv">eval-after-load</span> <span class="s">"vc"</span>
  <span class="o">'</span><span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">'find-file-hooks</span> <span class="ss">'vc-find-file-hook</span><span class="p">))</span>

<span class="p">(</span><span class="nv">el-get</span> <span class="ss">'sync</span> <span class="ss">'magit</span><span class="p">)</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">'magit</span><span class="p">)</span>
<span class="p">(</span><span class="nv">eval-after-load</span> <span class="ss">'magit</span>
  <span class="o">'</span><span class="p">(</span><span class="k">progn</span>
     <span class="p">(</span><span class="nv">set-face-foreground</span> <span class="ss">'magit-diff-add</span> <span class="s">"green3"</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">set-face-foreground</span> <span class="ss">'magit-diff-del</span> <span class="s">"red3"</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">not</span> <span class="nv">window-system</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">set-face-background</span> <span class="ss">'magit-item-highlight</span> <span class="s">"white"</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-x m"</span><span class="p">)</span> <span class="ss">'magit-status</span><span class="p">)</span>
</pre></div>
</div>

<p>筆者はEmacsで電子メールを使用することはないので、<code>C-x m</code>でMagitを利用するようにしました。</p>

<h3>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h3>

<ul>
<li><a href="http://stackoverflow.com/questions/5676977/how-to-use-magit-even-more-effectively" rel="nofollow noopener" target="_blank">git - How to Use Magit Even More Effectively? - Stack Overflow</a></li>
<li><a href="http://stackoverflow.com/questions/5748814/how-does-one-disable-vc-git-in-emacs" rel="nofollow noopener" target="_blank">How does one disable vc-git in emacs? - Stack Overflow</a></li>
</ul>

<h2>
<span id="paredit" class="fragment"></span><a href="#paredit"><i class="fa fa-link"></i></a>ParEdit</h2>

<p><a href="http://www.emacswiki.org/emacs/ParEdit" rel="nofollow noopener" target="_blank">ParEdit</a>はLisp系のプログラミング言語を編集する際にとても便利なマイナーモードです。当然Emacs Lispを含むので、Emacsの設定ファイルを書くためだけに入れても便利です。</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">20-lisp.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">el-get</span> <span class="ss">'sync</span> <span class="ss">'paredit</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'emacs-lisp-mode-hook</span> <span class="ss">'enable-paredit-mode</span><span class="p">)</span>
</pre></div>
</div>

<h2>
<span id="フォント設定" class="fragment"></span><a href="#%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>フォント設定</h2>

<p>フォントは無料で見やすい <strong>Migu 2M</strong> を利用してます。</p>

<ul>
<li><a href="http://mix-mplus-ipa.sourceforge.jp/migu/" rel="nofollow noopener" target="_blank">Miguフォント : M+とIPAの合成フォント</a></li>
</ul>

<p>Ubuntu 12.10以降では<code>apt-get</code>で<a href="http://packages.ubuntu.com/saucy/fonts-migmix" rel="nofollow noopener" target="_blank">fonts-migmix</a>パッケージをインストールすることでも導入可能です。</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">fonts.el</span></div>
<div class="highlight"><pre><span></span><span class="c1">;; -*- Mode: Emacs-Lisp ; Coding: utf-8 -*-</span>
<span class="c1">;;; いろはにほへと　ちりぬるを</span>
<span class="c1">;;; わかよたれそ　　つねならむ</span>
<span class="c1">;;; うゐのおくやま　けふこえて</span>
<span class="c1">;;; あさきゆめみし　ゑひもせす</span>
<span class="p">(</span><span class="nb">when</span> <span class="nv">window-system</span>
  <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">'default</span> <span class="no">nil</span>
              <span class="ss">:family</span> <span class="s">"Migu 2M"</span>
              <span class="ss">:height</span> <span class="mi">120</span><span class="p">))</span>
</pre></div>
</div>

<h2>
<span id="ruby開発のための設定" class="fragment"></span><a href="#ruby%E9%96%8B%E7%99%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>Ruby開発のための設定</h2>

<p>筆者は長い引数列は横幅が長くならないように浅く改行するのが好きなので <code>(setq ruby-deep-indent-paren-style nil)</code> のように設定します。</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">ruby.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">el-get</span> <span class="ss">'sync</span> <span class="o">'</span><span class="p">(</span><span class="nv">ruby-mode</span> <span class="nv">rcodetools</span><span class="p">))</span>
<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'ruby-mode</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my/ruby-mode-hook-function</span> <span class="p">()</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">ruby-deep-indent-paren-style</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'ac-omni-completion-sources</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'ac-ignore-case</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">ac-ignore-case</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">ac-omni-completion-sources</span> <span class="o">'</span><span class="p">((</span><span class="s">"\\.\\="</span> <span class="o">.</span> <span class="p">(</span><span class="nv">ac-source-rcodetools</span><span class="p">))))</span>
    <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'ruby-mode-hook</span> <span class="ss">'my/ruby-mode-hook-function</span><span class="p">))</span>
</pre></div>
</div>

<h2>
<span id="php開発のための設定" class="fragment"></span><a href="#php%E9%96%8B%E7%99%BA%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>PHP開発のための設定</h2>

<p>PHPは配列を作るリテラルが<code>array()</code>と、ほかの言語から来た身にはたいへんつらい仕様なので、<code>[</code>だけで入力できるようにします。</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">php.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">el-get</span> <span class="ss">'sync</span> <span class="ss">'smartchr</span><span class="p">)</span>
<span class="p">(</span><span class="nv">el-get</span> <span class="ss">'sync</span> <span class="o">'</span><span class="p">(</span><span class="nv">php-mode</span> <span class="nv">php-completion</span> <span class="nv">php-eldoc</span><span class="p">))</span>
<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'php-mode</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">my/php-mode-hook-function</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">'php-completion</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">php-completion-mode</span> <span class="no">t</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">define-key</span> <span class="nv">php-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-o"</span><span class="p">)</span> <span class="ss">'phpcmp-complete</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">define-key</span> <span class="nv">php-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"["</span><span class="p">)</span> <span class="p">(</span><span class="nv">smartchr</span> <span class="s">"[]"</span> <span class="s">"array()"</span> <span class="s">"[[]]"</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">define-key</span> <span class="nv">php-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"]"</span><span class="p">)</span> <span class="p">(</span><span class="nv">smartchr</span> <span class="s">"array "</span> <span class="s">"]"</span> <span class="s">"]]"</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">my/php-offset</span> <span class="mi">4</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">tab-width</span> <span class="nv">my/php-offset</span>
            <span class="nv">c-basic-offset</span> <span class="nv">my/php-offset</span>
            <span class="nv">indent-tabs-mode</span> <span class="no">nil</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">c-set-offset</span> <span class="ss">'case-label</span><span class="o">'</span> <span class="nv">my/php-offset</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">c-set-offset</span> <span class="ss">'arglist-intro</span><span class="o">'</span> <span class="nv">my/php-offset</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">c-set-offset</span> <span class="ss">'arglist-cont-nonempty</span><span class="o">'</span> <span class="nv">my/php-offset</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">c-set-offset</span> <span class="ss">'arglist-close</span><span class="o">'</span> <span class="mi">0</span><span class="p">))</span>
    <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'php-mode-hook</span> <span class="ss">'my/php-mode-hook-function</span><span class="p">))</span>
</pre></div>
</div>

<h2>
<span id="過去の記事から" class="fragment"></span><a href="#%E9%81%8E%E5%8E%BB%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%8B%E3%82%89"><i class="fa fa-link"></i></a>過去の記事から</h2>

<h3>
<span id="カーソルキーで分割ウィンドウ移動" class="fragment"></span><a href="#%E3%82%AB%E3%83%BC%E3%82%BD%E3%83%AB%E3%82%AD%E3%83%BC%E3%81%A7%E5%88%86%E5%89%B2%E3%82%A6%E3%82%A3%E3%83%B3%E3%83%89%E3%82%A6%E7%A7%BB%E5%8B%95"><i class="fa fa-link"></i></a>カーソルキーで分割ウィンドウ移動</h3>

<p>筆者がEmacsなどのスクリーンエディタを使用する強い動機のひとつは画面分割があることなのですが、ほかのウィンドウに移動するときにいちいち<code>C-x o</code>と押すのは、特に3つ以上に分割したときに煩しく感じます。</p>

<ul>
<li><a href="http://qiita.com/tadsan/items/114ffe6bb645551268dd" id="reference-3f648f136d42a87dd148">Emacsの分割ウィンドウを←↓↑→で移動 - Qiita [キータ]</a></li>
</ul>

<p>矢印キーは使用しない派閥のひとも多いですが、筆者は積極的に活用します。</p>

<h3>
<span id="esc連打" class="fragment"></span><a href="#esc%E9%80%A3%E6%89%93"><i class="fa fa-link"></i></a>ESC連打</h3>

<p>うっかり<code>ESC</code>キーを複数回打ってしまったときに慌てなくなるための設定です。</p>

<p><a href="http://qiita.com/tadsan/items/e7557c8db33a3c590fec" id="reference-3be88fa5072bf12b2272">Emacs - ESCを連打したときにclose-other-windowsされたくない - Qiita [キータ]</a></p>

<h3>
<span id="auto-completeで大文字小文字を区別" class="fragment"></span><a href="#auto-complete%E3%81%A7%E5%A4%A7%E6%96%87%E5%AD%97%E5%B0%8F%E6%96%87%E5%AD%97%E3%82%92%E5%8C%BA%E5%88%A5"><i class="fa fa-link"></i></a>auto-completeで大文字小文字を区別</h3>

<p>オブジェクト指向のようなスタイルでコードを書くときに <code>book = Book.new</code> のようなコードが頻発すると補完の先頭文字列が大文字小文字を混同されると意図通りにならなくて苛立つことがあります。</p>

<ul>
<li><a href="http://qiita.com/tadsan/items/ab3c3b594b5bf6203f02" id="reference-45c11b1a5c3f1d11abe5">Emacs - auto-complete環境で補完の大文字小文字を区別する - Qiita [キータ]</a></li>
</ul>

<p>しれっと上記のRuby設定の中にも書かれてます。</p>

<h2>
<span id="さいごに" class="fragment"></span><a href="#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB"><i class="fa fa-link"></i></a>さいごに</h2>

<p><a href="http://qiita.com/advent-calendar/2013/dot-emacs">.emacs Advent Calendar 2013</a>の2日めは、べんりなEmacs Lispを開発・紹介していらっしゃいます <a href="/syohex@github" class="user-mention js-hovercard" title="syohex@github" data-hovercard-target-type="user" data-hovercard-target-name="syohex@github">@syohex@github</a> さん(<a href="http://d.hatena.ne.jp/syohex/" rel="nofollow noopener" target="_blank">Life is very short</a>)です。</p>

<p>この記事の半分ほどは某卓球ハウスで鍋を御馳走になりながら書いてました。カレー鍋とてもおいしうございました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>34</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/a232f68d7a37e51d4eae">Rubyの三項演算子の話</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-04 12:54:13</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>JavaScript や C ではちょっとした場面にぴりりと役に立つ三項演算子(条件演算子)だけれど、実は Ruby ではかなり存在感の微妙な要らない子だったりします。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">ternary_sample.rb.js</span></div>
<div class="highlight"><pre><span></span><span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nx">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nx">x</span> <span class="o">=</span> <span class="s2">"hi"</span>
<span class="nx">y</span> <span class="o">=</span> <span class="s2">"bye"</span>

<span class="nx">v</span> <span class="o">=</span> <span class="nx">a</span><span class="o">&lt;</span><span class="nx">b</span><span class="o">?</span><span class="nx">x</span><span class="o">:</span><span class="nx">y</span>
</pre></div>
</div>

<p>こんなコードの場合を考へてみます。このコードは JavaScript 処理系では問題なく実行できるけど、 Ruby では <code>Syntax Error</code> であり、まったく動きません。</p>

<p>Ruby では、<code>b?</code> のようなメソッド名が許されて、 <code>:y</code> はシンボルです。また、  <code>?x</code> は文字列の <code>"x"</code> と等価です。はてには、次のようなコードを書くこともできます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">arg_label.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">d</span> <span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">)</span>
  <span class="n">arg</span>
<span class="k">end</span>

<span class="n">d</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">foo</span><span class="p">:</span><span class="s2">"bar"</span><span class="p">,</span> <span class="ss">fizz</span><span class="p">:</span> <span class="ss">:buzz</span><span class="p">,</span> <span class="s2">"hoge"</span> <span class="o">=&gt;</span> <span class="ss">:fuga</span>
<span class="c1"># =&gt; [1, 2, 3, {:foo=&gt;"bar", :fizz=&gt;:buzz, "hoge"=&gt;:fuga}]</span>
</pre></div>
</div>

<p>そのような言語仕様のために、 Ruby の字句解析器・構文解析器は <code>a&lt;b?x:y</code> を正しいコードとしてパースできません。正しく意図通りに解釈させるには、 <code>?</code> と <code>:</code> の前後にはきっちり空白を入れて、 <code>a&lt;b ? x : y</code> と書かなければいけないのです。</p>

<p>では Ruby の処理系は実際にどのように解釈してるのか、確認してみませう。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">check_syntax_ternary.rb</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env ruby</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="nb">require</span> <span class="s1">'ripper'</span>
<span class="nb">require</span> <span class="s1">'pp'</span>

<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">x</span> <span class="o">=</span> <span class="s2">"hi"</span>
<span class="n">y</span> <span class="o">=</span> <span class="s2">"bye"</span>

<span class="n">wrong</span> <span class="o">=</span> <span class="s1">'v = a&lt;b?x:y'</span>
<span class="nb">puts</span> <span class="s2">"まちがひ: </span><span class="si">#{</span><span class="n">wrong</span><span class="si">}</span><span class="s2">"</span>
<span class="n">pp</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">tokenize</span> <span class="n">wrong</span>
<span class="n">pp</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">lex</span> <span class="n">wrong</span>

<span class="nb">puts</span>

<span class="n">correct</span> <span class="o">=</span> <span class="s1">'v = a&lt;b ? x : y'</span>
<span class="nb">puts</span> <span class="s2">"せいかい: </span><span class="si">#{</span><span class="n">correct</span><span class="si">}</span><span class="s2">"</span>
<span class="n">pp</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">tokenize</span> <span class="n">correct</span>
<span class="n">pp</span> <span class="no">Ripper</span><span class="o">.</span><span class="n">lex</span> <span class="n">correct</span>

<span class="nb">puts</span>

<span class="nb">puts</span> <span class="s2">"eval: </span><span class="si">#{</span><span class="n">correct</span><span class="si">}</span><span class="s2"> #=&gt; </span><span class="si">#{</span><span class="nb">eval</span><span class="p">(</span><span class="n">correct</span><span class="p">)</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</div>

<p>おのおのの手元で実行してみて欲しいのですが( <code>irb</code> や <code>pry</code> でも動く)、<a href="http://ideone.com/bP4r7" rel="nofollow noopener" target="_blank">実行結果は ideone にも置いておきます</a>。</p>

<p>さて、空白のない <code>a&lt;b?x:y</code> の部分を抜萃してみませう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>[[[1, 4], :on_ident, "a"],
 [[1, 5], :on_op, "&lt;"],
 [[1, 6], :on_ident, "b?"],
 [[1, 8], :on_label, "x:"],
 [[1, 10], :on_ident, "y"]]
</pre></div></div>

<p><code>:on_ident</code> は識別子(メソッド名、変数名など)で、 <code>:on_op</code> は演算子。ここで注目すべきは、 <code>b?</code> と <code>x:</code> がそれぞれひとつの塊として認識されてゐることです。 <code>:on_label</code> は引数のラベルです。</p>

<p>つまり、この <code>b?x:y</code> の部分は別の書き方をすると <code>a &lt; b?(:x =&gt; y)</code> と同じとして解釈されてることがわかります。それを証拠に、 <code>def b? (*args); args; end</code> のようなコードを追加してみれば、エラーなく動作はすることがわかると思ひます。 (しかしそれでも <code>a&lt;b?x:y</code> は動かない)</p>

<p>さてここで、三項演算子がどうして C や JavaScript で役に立つのか考へてみませう。</p>

<div class="code-frame" data-lang="javasript">
<div class="code-lang"><span class="bold">sample-use-if.c.js</span></div>
<div class="highlight"><pre><span></span>if (foo()) {
    tmp = "fuga";
} else {
    tmp = "hoge";
}

bar(tmp);
</pre></div>
</div>

<p>このように <code>foo()</code> によって渡す引数を分岐したいときに、 <code>tmp =</code> を二回書くのは、激しく <strong>ださい</strong> ですね。そんなとき、三項演算子では <code>if</code> なしに次のやうに簡潔に書くことができます。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">sample-use-ternary.c.js</span></div>
<div class="highlight"><pre><span></span><span class="nx">tmp</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">()</span><span class="o">?</span><span class="s2">"fuga"</span><span class="o">:</span><span class="s2">"hoge"</span><span class="p">;</span>
<span class="nx">bar</span><span class="p">(</span><span class="nx">tmp</span><span class="p">);</span>
</pre></div>
</div>

<p>または直接このように書いて引数に渡すこともできます。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">sample-use-ternary2.c.js</span></div>
<div class="highlight"><pre><span></span><span class="nx">bar</span><span class="p">(</span><span class="nx">foo</span><span class="p">()</span><span class="o">?</span><span class="s2">"fuga"</span><span class="o">:</span><span class="s2">"hoge"</span><span class="p">);</span>
</pre></div>
</div>

<p>もし Ruby でも、たかだか2種類の分岐程度ならば三項演算子を使っても簡潔に書けます。しかし三項演算子では、それ以上の分岐が必要になったときには、ネスト地獄が待ってゐることを、みなさまは知ってゐることでせう……。</p>

<p>さて、 Ruby では以下のやうなコードが許されます。 (是非論はすこし脇においておいて)</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="k">if</span> <span class="n">foo</span><span class="p">();</span> <span class="s2">"fuga"</span> <span class="k">else</span> <span class="s2">"hoge"</span> <span class="k">end</span>
<span class="n">bar</span> <span class="n">tmp</span>

<span class="c1"># もちろんインデントしてもおｋ</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="k">if</span> <span class="n">foo</span><span class="p">()</span>
        <span class="s2">"fuga"</span>
      <span class="k">else</span>
        <span class="s2">"hoge"</span>
      <span class="k">end</span>
<span class="n">bar</span> <span class="n">tmp</span>
</pre></div></div>

<p>そして、この書きかたは <code>case-when</code> でも使用することができます。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="k">case</span> <span class="n">foo</span>
      <span class="k">when</span> <span class="ss">:fizz</span>
        <span class="s2">"fugafuga"</span>
      <span class="k">when</span> <span class="ss">:buzz</span>
        <span class="s2">"piyopiyo"</span>
      <span class="k">else</span>
        <span class="s2">"gudaguda"</span>
      <span class="k">end</span>
<span class="n">bar</span> <span class="n">tmp</span>
</pre></div></div>

<p>分岐し放題ヤッター！ (ちなみに公平のために、この記法は有名な <a href="http://shugo.net/ruby-codeconv/codeconv.html#label-16" rel="nofollow noopener" target="_blank">前田修吾さんのコーディング規約</a> では制限されてゐるものであることを紹介しておきます )</p>

<p>なほ、もしどうしても三項演算子を使用したいときは <code>(a &lt; b) ? x : y</code> のように条件式を <code>()</code> で括り、条件式中にもきちんと空白を入れ、きっちりと <code>?</code> と <code>:</code> の前後を空けることをおすすめします。 (C や JavaScript でも条件式は <code>()</code> で括った方が読みやすいですね)</p>

<p>ちなみになのですが、 Ruby の三項演算子と <code>if</code> は、見ためこそ異なりますが、インタプリタの内部的には <strong>まったく同じもの</strong> です。 <a href="https://github.com/ruby/ruby/blob/ruby_1_9_3/parse.y#L2364" rel="nofollow noopener" target="_blank">parse.y をご覧ください</a> 。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/114ffe6bb645551268dd">Emacsの分割ウィンドウを←↓↑→で移動</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-25 00:53:22</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Emacs では <code>C-x 2</code> や <code>C-x 3</code> で画面を複数のウィンドウに分割することができ、これらの間は <code>C-x o</code> でトグルして移動することができます。しかし、みっつ以上に分割した場合には <code>C-x o</code> といふ2ストロークのキーバインドを連打する必要があり、戻りたいときにも標準では <code>C-u C-x o</code> も利かない不親切仕様です。</p>

<p>ところで、 <code>tmux</code> といふターミナルマルチプレクサ (GNU Screen のご同類です) には、複数の分割した領域を <code>C-b [←↓↑→]</code> で移動できる設定が標準であります。これを拝借してきませう。</p>

<p>Emacs には標準で <code>windmove</code> といふ機能が含まれてゐます。 <code>M-x windmove</code> と押すと、特に設定してなくとも <code>windmove-{left,down,up,right}</code> 函数がご利用いただけることが確認できると思ひます。これがまさに <code>tmux</code> の移動と同様のものですので、ここにキーバインドを設定してやれば良さげですね。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">keybindings-windmove.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c &lt;left&gt;"</span><span class="p">)</span>  <span class="ss">'windmove-left</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c &lt;down&gt;"</span><span class="p">)</span>  <span class="ss">'windmove-down</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c &lt;up&gt;"</span><span class="p">)</span>    <span class="ss">'windmove-up</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"C-c &lt;right&gt;"</span><span class="p">)</span> <span class="ss">'windmove-right</span><span class="p">)</span>
</pre></div>
</div>

<p>できましたー。</p>

<p>しかし…</p>

<p><a href="http://www.emacswiki.org/emacs/WindMove" rel="nofollow noopener" target="_blank">EmacsWiki: Wind Move</a></p>

<p>あれっ、まったく同じことやってた…</p>

<p>ちなみに最初はプレフィックス <code>C-c</code> じゃなくて <code>C-x</code> でやってましたが、最近ちょっと使ひ始めてみた <a href="http://www.emacswiki.org/emacs/BackButton" rel="nofollow noopener" target="_blank">EmacsWiki: Back Button</a> の標準キーバインドと衝突してたので、晴れて EmacsWiki 版と同じに戻ってしまひましたとさ。ちゃんちゃん。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>29</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/7658038487b7a82778ec">1分でPAGER環境変数を設定したあとページャーを知る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-03 03:01:59</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[1分シリーズ]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>しょっちゅう宗教戦争の火種になるエディタやブラウザと違って、注目されない日陰の存在。</p>

<p>知ったところで何かが劇的に革新されるわけではまったくないけど、世界の景色がちょっとだけ違って見える、かもしれない。</p>

<p>一分で知ったところで何かが実現できるかもしれないし、何も実現できないかもしれない。そんな<a href="http://qiita.com/advent-calendar/2013/one-minute">1分で実現できる有用な技術 Advent Calendar 2013</a>の三日め、はじまります。</p>

<hr>

<h3>
<span id="ページャーって何" class="fragment"></span><a href="#%E3%83%9A%E3%83%BC%E3%82%B8%E3%83%A3%E3%83%BC%E3%81%A3%E3%81%A6%E4%BD%95"><i class="fa fa-link"></i></a>ページャーって何?</h3>

<p>端末の画面でテキストを読むアプリケーションのこと</p>

<ul>
<li>ファイルを読むこともできる

<ul>
<li><code>less /etc/passwd</code></li>
</ul>
</li>
<li>長いコマンドの実行結果をまとめて読むこともできる

<ul>
<li><code>seq 109 10 9999 | less</code></li>
</ul>
</li>
<li>もちろんテキスト検索もできる</li>
</ul>

<h3>
<span id="まづどうすればいいの" class="fragment"></span><a href="#%E3%81%BE%E3%81%A5%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E3%81%84%E3%81%84%E3%81%AE"><i class="fa fa-link"></i></a>まづどうすればいいの</h3>

<p>好きなページャーを選んで<code>PAGER</code>環境変数に登録しよう</p>

<h3>
<span id="好きなページャーを探す" class="fragment"></span><a href="#%E5%A5%BD%E3%81%8D%E3%81%AA%E3%83%9A%E3%83%BC%E3%82%B8%E3%83%A3%E3%83%BC%E3%82%92%E6%8E%A2%E3%81%99"><i class="fa fa-link"></i></a>好きなページャーを探す</h3>

<p>いろいろありまっせ。</p>

<p>たいていは <code>brew</code> とか <code>apt-get</code> でインストールできるので積極的にためしてみると良いですね。</p>

<ul>
<li>
<code>less</code>

<ul>
<li>ページャー界のデファクトスタンダート</li>
</ul>
</li>
<li>
<code>lv</code>

<ul>
<li>国産のページャー</li>
<li>日本語の文字コードに強い… らしい</li>
<li>コマンド名の短かさ押しやすさからページャー界に根強いファン層あり</li>
</ul>
</li>
<li>
<code>w3m</code>

<ul>
<li>国産テキストブラウザとして有名だがページャーでもある</li>
</ul>
</li>
<li>
<code>most</code>

<ul>
<li>JED Editorの作者が作ったページャーです</li>
<li>青い</li>
</ul>
</li>
<li>
<code>vimpager</code>

<ul>
<li>Homebrewでインストールできる。まじかよ…</li>
<li>Vimの標準パッケージに入ってる<code>less.sh</code>よりもずっと良い(主観)</li>
<li>それでも正直「お、おう…」って感じです</li>
<li>
<code>emacspager</code>も存在する? らしい…?</li>
</ul>
</li>
</ul>

<h3>
<span id="ページャーを選ぶ" class="fragment"></span><a href="#%E3%83%9A%E3%83%BC%E3%82%B8%E3%83%A3%E3%83%BC%E3%82%92%E9%81%B8%E3%81%B6"><i class="fa fa-link"></i></a>ページャーを選ぶ</h3>

<p>実際にUNIXを利用する際、よくページャーを利用するのは<code>man</code>コマンドです。上で紹介したページャーはどれも、すくなくとも<code>man</code>は問題なく利用でき <em>(るように見え)</em>ます。</p>

<p>一時的に任意のページャーを使って<code>man</code>コマンドを利用するにはシェルから <code>PAGER=vimpager man less</code> のように起動します。</p>

<h3>
<span id="それからどうするの" class="fragment"></span><a href="#%E3%81%9D%E3%82%8C%E3%81%8B%E3%82%89%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>それからどうするの?</h3>

<ul>
<li>
<code>.bashrc</code>とか<code>.zshrc</code>とかで <code>export PAGER='lv -c'</code> と追記する</li>
<li>
<code>git config --global core.pager 'lv -c'</code> と実行したりする</li>
<li><a href="http://mercurial.selenic.com/wiki/PagerExtension" rel="nofollow noopener" target="_blank">.hgrcにpager設定をする</a></li>
</ul>

<p><em>ほかにもあったら知りたいな!</em></p>

<h3>
<span id="もうひとつの観点" class="fragment"></span><a href="#%E3%82%82%E3%81%86%E3%81%B2%E3%81%A8%E3%81%A4%E3%81%AE%E8%A6%B3%E7%82%B9"><i class="fa fa-link"></i></a>もうひとつの観点</h3>

<p><code>git config --global color.ui auto</code> など設定すると、<code>git diff</code>や<code>git log</code>などでカラー表示されるようになります。君の選んだページャーはエスケープシーケンスに対応してるかな?</p>

<p><strong>結末はキミの目で確かめろ！</strong> (完)</p>

<hr>

<p>ここまで1分(で読み切れる、といいなあ…)</p>

<h2>
<span id="結局のところ" class="fragment"></span><a href="#%E7%B5%90%E5%B1%80%E3%81%AE%E3%81%A8%E3%81%93%E3%82%8D"><i class="fa fa-link"></i></a>結局のところ</h2>

<ul>
<li>
<code>lv</code>って打ちやすくね?</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>25</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/cf30eb45312b498c97b0">クロージャって何? どこがオブジェクト指向と似てるの? をRubyで説明するために書いたコード</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-25 03:41:40</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>タイトルの通り。</p>

<p>人にコードだけ見せて書き捨てるのももったいない気がしたので、説明を加筆して公開。</p>

<ul>
<li>わからないところがあったら質問ください</li>
<li>誤りや語弊のある表現があれば突っ込みください</li>
</ul>

<p>オブジェクト指向とは何か、と語りはじめるとたいへん長い話になり、僕は議論できるほど理解を深めてないので <strong>「諸説あるが」</strong> で済ませるとして、ここではRubyのクラスベースオブジェクト指向プログラミング、つまりC++風の抽象データ型に基くOOPの話になります。 <em>乱暴だなあ</em> 。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span>
  <span class="k">def</span> <span class="nf">initialize</span> <span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="c1"># インスタンス変数(メンバ変数)定義</span>
    <span class="c1"># これは同じインスタンスのメソッドの中からしか参照できない</span>
    <span class="vi">@x</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">upcase</span>
  <span class="k">end</span>

<span class="c1"># メソッド定義</span>
  <span class="k">def</span> <span class="nf">call</span>
    <span class="c1"># インスタンス変数@xの値を取り出す</span>
    <span class="k">return</span> <span class="vi">@x</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># 定数に函数を代入してる</span>
<span class="n">B</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">){</span>
  <span class="c1"># 函数定義の中で変数定義</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">upcase</span>
  <span class="c1"># Bが呼びだされると、このfuncが新たに生成される</span>
  <span class="n">func</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">{</span>
    <span class="c1"># この函数の中からは変数xを参照できる</span>
    <span class="c1"># むしろxは、Bの函数定義内からしか参照できない=閉ぢてる=クロージャ</span>
    <span class="k">return</span> <span class="n">x</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">func</span>
<span class="p">}</span>

<span class="c1"># インスタンス生成</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
<span class="c1"># メソッド呼び出し</span>
<span class="nb">p</span> <span class="n">a1</span><span class="o">.</span><span class="n">call</span>

<span class="c1"># インスタンス生成みたいなもの</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="p">(</span><span class="s2">"foo"</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">b1</span><span class="o">.</span><span class="n">call</span>

<span class="c1">### aとa2, bとb2が新しい別のインスタンスであることを確認</span>

<span class="c1"># インスタンス生成</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">)</span>
<span class="c1"># メソッド呼び出し</span>
<span class="nb">p</span> <span class="n">a2</span><span class="o">.</span><span class="n">call</span>

<span class="c1"># インスタンス生成みたいなもの</span>
<span class="n">b2</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="p">(</span><span class="s2">"baz"</span><span class="p">)</span>
<span class="nb">p</span> <span class="n">b2</span><span class="o">.</span><span class="n">call</span>
</pre></div></div>

<ul>
<li>
<code>a1</code> と <code>a2</code> の <code>@x</code> と、 <code>b1</code> と <code>b2</code> から見た <code>x</code> は、それぞれ別物。</li>
<li>
<code>B</code> 内部の <code>x</code> は、この場合 <code>func</code> からしか参照することができない

<ul>
<li>
<code>B</code> と名前を付けられた函数定義が、変数のスコープを作ってる</li>
<li>函数定義によって閉ぢたスコープができるから <strong>クロージャ(閉包)</strong> って呼ばれる</li>
<li>
<code>x</code> の中身は外部から参照したり破壊されたりしないので <em>隠しておける</em>
</li>
<li>これってつまり一般にオブジェクト指向の特徴の一つだと呼ばれることがある <strong>「隠蔽」だよね</strong>
</li>
</ul>
</li>
<li>
<code>A</code> の <code>@x</code> はインスタンスのメソッドからしか参照・操作できない (<em>建前、裏技あり</em>)

<ul>
<li>でも <code>A</code> のなかに <code>def x; @x; end</code> とか <code>def x= (arg); @x = arg; end</code> みたいなメソッドを定義すれば <code>a.x = "foo"</code> みたいに C# のプロパティと似たようなことができる</li>
<li>でもって、 <code>attr_accessor :x</code> と書けば、上記の定義とまったく同じものを省略することができる。ぐぐれ。</li>
<li>Ruby の世界では <code>x=</code> は一つのメソッド名。なのに <code>a.x = "foo"</code> とか書けちゃう。ふしぎふしぎ。</li>
</ul>
</li>
<li>僕は JavaScript とか Scheme とか素人だけど、たいへんお世話になってます</li>
<li>Python はクロージャを作りにくかった(上のコードを素直に移植してもうまくいかない)んだけど、Python 3 では <code>nonlocal</code> が追加されたので作りやすくなりました</li>
<li>Ruby でもクロージャは使へるけど、ふつうは素直にクラスを使って表現するべき</li>
<li>でも最近仕事で PHP は <a href="http://php.net/manual/ja/language.variables.scope.php" rel="nofollow noopener" target="_blank">変数のスコープがファイルローカルじゃない</a> ときいて、クロージャを作って <code>call_user_func</code> で呼び出す必要があった (しろめ)</li>
</ul>

<h2>
<span id="補足" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>補足</h2>

<ul>
<li>Ruby の <code>-&gt;(){ ... }</code> は函数オブジェクトを作成する構文

<ul>
<li>
<code>lambda{ ... }</code> って書いてもほとんど同じなので、文脈によって読みやすさ、かっこよさで選んで良い</li>
</ul>
</li>
<li>( <em>あとでまた書く</em> )</li>
</ul>

<h2>
<span id="合せて読まれたい" class="fragment"></span><a href="#%E5%90%88%E3%81%9B%E3%81%A6%E8%AA%AD%E3%81%BE%E3%82%8C%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>合せて読まれたい</h2>

<p>そして突っ込みが欲しい</p>

<ul>
<li><a href="http://qiita.com/items/a40b2a9c1f7768abd3bb">ラムダ式で学ぶクロージャとDSL #Ruby #ラムダ式 #JavaScript #DSL - Qiita</a></li>
<li><a href="http://d.hatena.ne.jp/zonu_exe/20110910/1315669228" rel="nofollow noopener" target="_blank">カリー化ってなぁに? をRubyから。 - DT戦記(zonu_exeの日記)</a></li>
<li><a href="http://d.hatena.ne.jp/zonu_exe/20110911/1315754365" rel="nofollow noopener" target="_blank">Rubyでのカリー化、をまじめに。 - DT戦記(zonu_exeの日記)</a></li>
<li><a href="http://d.hatena.ne.jp/zonu_exe/20111205/1323096647" rel="nofollow noopener" target="_blank">Ruby vs Python! ～def vs def～ - DT戦記(zonu_exeの日記)</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>22</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/ab3c3b594b5bf6203f02">auto-complete環境で補完の大文字小文字を区別する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-28 15:46:40</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Emacs]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>全国100万人のEmacs・ニュービーのみなさまこんばんは。</p>

<p>みなみなさまも<code>auto-complete</code>を使って快適な補完ライフを享受されてることと存じます。</p>

<p>しかしRailsなんかでごりごりごりっとコードを書いてますと、<code>Book</code>だったり<code>book</code>だったり<code>books</code>だったりと、大文字小文字が入り乱れるコードになります。そんな環境では、小文字で出して欲しかったのに大文字が補完されたりして、たいへん不快な目に遭ひます。</p>

<ul>
<li><a href="http://d.hatena.ne.jp/m2ym/20091206/1260111718" rel="nofollow noopener" target="_blank">auto-completeに大文字小文字を区別しないオプションを追加しました - Functional Emacser</a></li>
</ul>

<p>この記事を参照、ではあるのですが、リンク先当時と違っていまのデフォルトは<code>'smart</code>です。</p>

<p>つまり、デフォルト値の定義はこんなふうになってます。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">auto-complete.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defcustom</span> <span class="nv">ac-ignore-case</span> <span class="ss">'smart</span>
  <span class="s">"Non-nil means auto-complete ignores case.</span>
<span class="s">If this value is `smart', auto-complete ignores case only when</span>
<span class="s">a prefix doen't contain any upper case letters."</span>
  <span class="ss">:type</span> <span class="o">'</span><span class="p">(</span><span class="nv">choice</span> <span class="p">(</span><span class="nv">const</span> <span class="ss">:tag</span> <span class="s">"Yes"</span> <span class="no">t</span><span class="p">)</span>
                 <span class="p">(</span><span class="nv">const</span> <span class="ss">:tag</span> <span class="s">"Smart"</span> <span class="nv">smart</span><span class="p">)</span>
                 <span class="p">(</span><span class="nv">const</span> <span class="ss">:tag</span> <span class="s">"No"</span> <span class="no">nil</span><span class="p">))</span>
  <span class="ss">:group</span> <span class="ss">'auto-complete</span><span class="p">)</span>
</pre></div>
</div>

<p>てなわけで、全体でこの挙動を<code>nil</code>にしてやりたければ、<code>.emacs</code>にこんなふうに書いてやればおｋですね。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs.d/init.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">custom-set-valiables</span>
 <span class="o">'</span><span class="p">(</span><span class="nv">ac-ignore-case</span> <span class="no">nil</span><span class="p">))</span>
</pre></div>
</div>

<p>「Rubyでは無効にしたい… でも全体では<code>'smart</code>のままがいい…」なんてわがままさんもいらっしゃいますよね。僕のことなんですけれども。</p>

<p>そんな方にはこちら！</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs.d/conf/init-ruby.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'ruby-mode-hook</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'ac-ignore-case</span><span class="p">)</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">ac-ignore-case</span> <span class="no">nil</span><span class="p">)))</span>
</pre></div>
</div>

<p>いえい。これで<code>ruby-mode</code>なバッファでだけ<code>ac-ignore-case</code>が<code>nil</code>になってくれます。めでたいですね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/f313010e5ca345fdce07">AquaSKKをSKK日本語FEP互換の記号入力無双にする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-15 01:50:42</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[SKK]</b> <b>[AquaSKK]</b> <b>[SKK日本語入力FEP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote>

<h2>
<span id="2015年9月28日追記" class="fragment"></span><a href="#2015%E5%B9%B49%E6%9C%8828%E6%97%A5%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>2015年9月28日追記</h2>

<p><a href="https://github.com/codefirst/aquaskk" rel="nofollow noopener" target="_blank">codefirst/aquaskk</a>にこの記事の設定が取り込まれました！ 最新版に更新しよう<br>
<a href="http://mzp.hatenablog.com/entry/2015/09/27/091030" rel="nofollow noopener" target="_blank">📦AquaSKK 4.2.7: SKK日本語入力FEP互換の記号入力 - みずぴー日記</a></p>
</blockquote>

<p><a href="http://aquaskk.sourceforge.jp/" rel="nofollow noopener" target="_blank">AquaSKK</a>とはMac向けのかっこいい日本語入力システムです。かっこいいですね。</p>

<p>ところで、Windowsには<a href="http://coexe.web.fc2.com/skkfep.html" rel="nofollow noopener" target="_blank">SKK日本語入力FEP</a>といふ、さらにかっこいい日本語入力システムがあります。</p>

<p>どちらも<a href="http://openlab.ring.gr.jp/skk/index-j.html" rel="nofollow noopener" target="_blank">SKK</a>のクローンなので基本的にほとんど同じ操作感で日本語を入力することができますが、SKK日本語入力FEPはさらに意欲的にさまざまな機能を取り入れてゐます。</p>

<p>その一つとして、SKK日本語入力FEPでは<code>z</code>と特定のキーの組合せでさまざまな約物(記号)が2ストローク(打鍵)で入力できるやうになることがあります。</p>

<p>Google日本語入力では<code>z/</code>で[・]、<code>z.</code>で[…]、<code>z[hjkl]</code>で[←↓↑→]が入力できることをご存じかもしれません。そして、これらのキーバインドはSKKの基本的な初期設定です。</p>

<p>AquaSKKでは上記のキーバインドなどのいくつかの約物(記号)しかありませんが、SKK日本語入力FEPではそれに加へて、実に多彩な約物を入力することができます。</p>

<p>たとへば「<strong>ひだまりスケッチ×☆☆☆</strong> (ひだまりすけっちほしみっつ)」といふ文字列を入力しようと思ったとき、「えっと、ひだまりすけっち、かける、ほし、ほし、ほし」などといちいち変換する必要がありません。SKK日本語入力FEPでは[☆]は<code>z6</code>、[★]は<code>z&amp;</code>(<em>日本語キーボードの場合</em>)、[×]は<code>z*</code>です。</p>

<p>といふことで、<code>hidamariqsukettiqz*z6z6z6</code>と入力してやることで、目的の<strong>ひだまりスケッチ×☆☆☆</strong>と入力してやることができます。やりましたね。</p>

<p>で、ここからが本題です。この溢れんばかりの記号入力パゥワーをAquaSKKにも導入しませう！</p>

<p><del>導入はかんたん。AquaSKKを導入済みの環境で <code>Terminal.app</code> などを開いて次のワンライナーを動かしてやるだけです！</del></p>

<blockquote>

<h2>
<span id="2015年9月28日追記-1" class="fragment"></span><a href="#2015%E5%B9%B49%E6%9C%8828%E6%97%A5%E8%BF%BD%E8%A8%98-1"><i class="fa fa-link"></i></a>2015年9月28日追記</h2>

<p><a href="https://github.com/codefirst/aquaskk" rel="nofollow noopener" target="_blank">codefirst/aquaskk</a>では設定が取り込まれたのでインストールは不要です！<br>
<a href="http://mzp.hatenablog.com/entry/2015/09/27/091030" rel="nofollow noopener" target="_blank">📦AquaSKK 4.2.7: SKK日本語入力FEP互換の記号入力 - みずぴー日記</a></p>
</blockquote>

<p>あとはツールバーのAquaSKKのメニューバーの「設定ファイルの再読み込み」をしてから環境設定を開いて、「かな入力規則」で 「SKK日本語FEP互換の記号入力を使う」にチェックをつけてやります。もしこれが出てなければ、お手数ですがユーザのログアウトをして再度ログインしてやってください。</p>

<p>これでAquaSKKにもSKK日本語入力FEPと同様の約物入力パワーを手に入れることができたのですが、ひとつだけ<code>z¥</code>(または<code>z\</code>)で[￥]は再現できませんでした… <strong>AquaSKKの仕様はちゃんと調べてない</strong>。</p>

<p>それと、この記事を書きながらやっと気がついたんですが、これJISキーボードじゃないとSKK日本語入力FEP互換になりませんよね…? ってことでUSキーボードユーザの方、お許しください！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/f96e2c48041562b79beb">ユーザのログインシェルを調べる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-17 01:13:50</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> <b>[OSX]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="linuxなど" class="fragment"></span><a href="#linux%E3%81%AA%E3%81%A9"><i class="fa fa-link"></i></a>Linuxなど</h2>

<p>ふつうのUNIX系システムでは <code>/etc/passwd</code> に格納されてるので、これを調べてやればいいです。</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span></span><span class="gp">%</span> grep <span class="nv">$USER</span> /etc/passwd
<span class="go">megurine:x:1000:1000:Megurine Luka,,,:/home/megurine:/usr/bin/zsh</span>
<span class="gp">%</span> grep <span class="nv">$USER</span> /etc/passwd <span class="p">|</span> cut -d: -f7
<span class="go">/usr/bin/zsh</span>
</pre></div></div>

<p><em>(AWKならパイプで繋がずに書けるかもしれない)</em></p>

<h2>
<span id="mac-os-x-v105" class="fragment"></span><a href="#mac-os-x-v105"><i class="fa fa-link"></i></a>Mac OS X (v10.5〜)</h2>

<p>が、Mac OS Xは「ふつうの」UNIXではないので、この方法では一般ユーザのログインシェルは <em>取得できません</em> X-D</p>

<p>じゃあどうすればいいか。</p>

<p>OS Xではユーザ情報はOpen Directoryに格納されてるので、これを参照しにいきます。</p>

<div class="code-frame" data-lang="shell-session"><div class="highlight"><pre><span></span><span class="gp">%</span> dscl localhost -read Local/Default/Users/<span class="nv">$USER</span> UserShell
<span class="go">UserShell: /usr/local/bin/zsh</span>
<span class="gp">%</span> dscl localhost -read Local/Default/Users/<span class="nv">$USER</span> UserShell <span class="p">|</span> cut -d<span class="s1">' '</span> -f2
<span class="go">/usr/local/bin/zsh</span>
</pre></div></div>

<p>ほむ、いい感じですね。やりましたよ。</p>

<h2>
<span id="参考資料" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99"><i class="fa fa-link"></i></a>参考資料</h2>

<ul>
<li><a href="http://news.mynavi.jp/column/osx/251/index.html" rel="nofollow noopener" target="_blank">【コラム】OS X ハッキング! (251) Leopard解体新書(2) ～さようならNetInfo～ | パソコン | マイナビニュース</a></li>
<li><a href="http://wiki.smalleycreative.com/One_Liners" rel="nofollow noopener" target="_blank">One Liners - The Smalley Creative Wiki</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/f64867520e735ef85491">MySQLのutf8で保存できない文字を弾きたい</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-20 11:43:57</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[MySQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote>

<h3>
<span id="追記" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>追記</h3>

<p>コメントで@mpywさんの紹介されてるコードが有効な場合があります。ご検討ください。</p>
</blockquote>

<p>要するにUTF-8にすると4バイトになる文字を弾きたい。MySQLが悪い。元コードはクラスの静的メソッド。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">assert_mysql_utf8</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$len</span> <span class="o">=</span> <span class="nb">mb_strlen</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$n</span> <span class="o">&lt;</span> <span class="nv">$len</span><span class="p">;</span> <span class="nv">$n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$c</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RangeException</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p><code>strlen</code>と<code>mb_strlen</code>の差異を利用する。</p>

<p>果たしてこんな検証処理をアプリケーション側でするべきなのか激しく悩む。全部MySQLが悪い。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/bc724118f0c9e4def26c">Rubyで標準入力からCSVをパース</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-06 03:33:20</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[CSV]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>CSVを標準入力から読み込んで標準出力に吐き出す、いはゆる UNIX のフィルタプログラムみたいな感じ。</p>

<p>ぐぐってもちゃんとした方法が出てこないので、コード全体を掲載。</p>

<p>これが模範解答。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">csv_filter.rb</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="nb">require</span> <span class="s1">'csv'</span>
<span class="no">CSV</span><span class="p">(</span><span class="no">STDIN</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"''</span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">'' </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div>
</div>

<p>別解。シェルからワンライナー。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>% ruby -rcsv -e<span class="s2">"CSV(STDIN).each{|r|puts %Q(''#{r[1]}'' #{r[2]})}"</span> &lt; hoge.csv
</pre></div></div>

<p>最初に書いた、(自称)70点の回答。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">csv_filter.rb</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="nb">require</span> <span class="s1">'csv'</span>
<span class="no">CSV</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="no">ARGF</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="no">File</span><span class="o">::</span><span class="no">NULL</span><span class="p">,</span> <span class="sc">?w</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"''</span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">'' </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div>
</div>

<p><code>File::NULL</code> は知名度低い気がしますが、UNIX風のOSなら <code>/dev/null</code> 、Windowsなら <code>NUL</code> といふファイルが開かれます。</p>

<p>書き込み先を <code>File::NULL</code> にして、オプション <code>'w'</code> で開かないと、行単位の内容が <code>STDIO</code> に出てきちゃいます ヾ(〃＞＜)ﾉﾞ☆ </p>

<p>なんでこんな仕様なの…</p>

<ul>
<li>
<code>CSV::IOReader</code>

<ul>
<li>全然だめです。1.8以前専用です。</li>
</ul>
</li>
<li>
<code>open(ARGF).each_line</code> して <code>CSV.parse_line</code>

<ul>
<li><strong>だるい</strong></li>
</ul>
</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/5e825271d6eabac14810">nanoエディタでWindowsっぽいキーバインド</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-30 22:28:40</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[nano]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><dl>
<dt>追記</dt>
  <dd>今なら「Windowsっぽいキーバインド」なら<a href="https://micro-editor.github.io/" rel="nofollow noopener" target="_blank">Micro</a>とかの方がおすすめなの</dd>
  <dd><a href="http://qiita.com/tadsan/items/f0747f09ea5ce863f2ec" id="reference-244a8176940b1b802dbf">いま熱い最新スクリーンエディタmicro ことはじめ - Qiita</a></dd>
</dl>

<h2>
<span id="それは小さなエディタなの" class="fragment"></span><a href="#%E3%81%9D%E3%82%8C%E3%81%AF%E5%B0%8F%E3%81%95%E3%81%AA%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%81%AA%E3%81%AE"><i class="fa fa-link"></i></a>それは小さなエディタなの</h2>

<p>nanoとは、最近のPC-UNIX(LinuxとかMac OS Xとか)に入ってるスクリーンエディタのことなの。VimとかEmacsみたいにキーバインドが凝ってなくて、コマンドが常に画面下部に表示されてるから初心者でも混乱しないのが売りなの。端末で動くメモ帳みたいなものなの。</p>

<p>でもnanoのキーバインドって正直言って独特すぎて、ほかのエディタと全然互換性がないの。 <code>C-k</code> でカットなのは Emacs っぽいんだけど、それ以外のキーバインドは… わかりにくいの。</p>

<h2>
<span id="キーバインドそしてお引っ越しなの" class="fragment"></span><a href="#%E3%82%AD%E3%83%BC%E3%83%90%E3%82%A4%E3%83%B3%E3%83%89%E3%81%9D%E3%81%97%E3%81%A6%E3%81%8A%E5%BC%95%E3%81%A3%E8%B6%8A%E3%81%97%E3%81%AA%E3%81%AE"><i class="fa fa-link"></i></a>キーバインド、そしてお引っ越しなの!</h2>

<p>だからWindowsのメモ帳みたいなキーバインドにしてみたいと思ったの。</p>

<p>そしたらこんな感じになったの!</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># Windows (notepad) like keybinding for nano editor
# written by zonuexe, license under GPLv3 or NYSL(0.9982)
# lastupdate: h240921
#
# how to install
# a. rename and move this file to $HOME/.nanorc
#    % mv nanorc.keybindings $HOME/.nanorc
# b. concatenate this file with tail of $HOME/.nanorc
#    % cat nanorc.keybindings &gt;&gt; $HOME/.nanorc

bind ^C copytext    main
bind ^F whereis     main
bind ^G gotoline    main
bind ^I indent      main
bind ^N exit        main
bind ^M enter       main
bind ^S writeout    main
bind ^R replace     main
bind ^V uncut       main
bind ^X cut         main
bind ^Y redo        main
bind ^Z undo        main

bind F1 help        main
bind F3 whereis     main
#bind F3 nexthistory search
## ここの設定のしかたがわからないの
</pre></div></div>

<p>まだいろいろ弄りたいところがあるけど、nanoの挙動がよくわからないのでこの辺にしておくの。正直、メモ帳の <code>C-n</code> の挙動とか今回初めて知ったの。 <code>Shift</code> とかで範囲選択ができないのはもやもやするけど、 <code>C-x</code> で切り取り、 <code>C-v</code> で貼り付けとかできればストレスはなくなると思ふの。</p>

<p>めんどくさいひとは端末で <code>curl https://gist.githubusercontent.com/zonuexe/3760480/raw/nanorc.keybindings &gt;&gt; ~/.nanorc</code> ってやっておくと良いの。でもOS Xに入ってるnanoは古すぎるので、 <a href="http://www.nano-editor.org/download.php" rel="nofollow noopener" target="_blank">GNU nano: Download</a> からダウンロードしてビルドしなきゃだめなの。残念ながらいまのところHomeBrewには入ってないみたいなの。MacPortsのことは知らないの。</p>

<p>そこまでやる気がない子はふつうにLinuxを使っておくか、Vimの操作を覚えておくのが良いの。実際Vimだって基本的な機能だけならそんなに難しくないの。 といふか、SSHでVPSに繋いでるとかじゃなきゃ <code>gedit</code> の方が最初からそれっぽいキーバインドなので、そっちを使っておくのがずっと良いの。</p>

<h2>
<span id="備考" class="fragment"></span><a href="#%E5%82%99%E8%80%83"><i class="fa fa-link"></i></a>備考</h2>

<p>この記事を書いてる自宅警備員は、実は <em>なのちゃん</em> のことをよく知らないの。</p>

<p>この設定ファイルの初出は <a href="https://gist.github.com/3760480" rel="nofollow noopener" target="_blank">nano editorでWindows風のキーバインドなの — Gist</a> なの。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/4800e5635d76c3542d95">private,protectedなメソッドを呼び出してテストする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-03 22:34:21</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>どうしても<code>public</code>にしたくないメソッドをテストしたいなー、ってときに無理やりメソッドを呼び出す。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * メソッドと同じように呼べる無名函数を返す</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">callMethodAsPublic</span> <span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$method</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$ref</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\ReflectionMethod</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$method</span><span class="p">);</span>
    <span class="nv">$ref</span><span class="o">-&gt;</span><span class="na">setAccessible</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="nv">$obj</span> <span class="o">=</span> <span class="p">(</span><span class="nb">gettype</span><span class="p">(</span><span class="nv">$class</span><span class="p">)</span> <span class="o">===</span> <span class="s1">'object'</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$class</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">return</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$ref</span><span class="p">,</span> <span class="nv">$obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$args</span> <span class="o">=</span> <span class="nb">func_get_args</span><span class="p">();</span>
        <span class="k">return</span> <span class="nv">$ref</span><span class="o">-&gt;</span><span class="na">invokeArgs</span><span class="p">(</span><span class="nv">$obj</span><span class="p">,</span> <span class="nv">$args</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div></div>

<p>静的メソッドでも動的メソッドでも呼べるようにした。でもバッドノウハウくさくてうーんって感じだ。うーん…</p>

<p>うーんって感じなので、作ったはいいものの、自分でも使ってない。</p>

<h2>
<span id="例" class="fragment"></span><a href="#%E4%BE%8B"><i class="fa fa-link"></i></a>例</h2>

<p><a href="https://gist.github.com/zonuexe/9324923" rel="nofollow noopener" target="_blank">gistにも置いた</a>。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">Testklass.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Testklass</span>
<span class="p">{</span>
   <span class="k">public</span> <span class="k">function</span> <span class="nf">publicMethod</span> <span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
   <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"public: </span><span class="si">$str</span><span class="s2">"</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">publicStaticMethod</span> <span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
   <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"public+static: </span><span class="si">$str</span><span class="s2">"</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">private</span> <span class="k">function</span> <span class="nf">privateMethod</span> <span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
   <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"private: </span><span class="si">$str</span><span class="s2">"</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">privateStaticMethod</span> <span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
   <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"private+static: </span><span class="si">$str</span><span class="s2">"</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">protected</span> <span class="k">function</span> <span class="nf">protectedMethod</span> <span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
   <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"protected: </span><span class="si">$str</span><span class="s2">"</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">protectedStaticMethod</span> <span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
   <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"protected+static: </span><span class="si">$str</span><span class="s2">"</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">TestklassTest.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">'./Testklass.php'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TestklassTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">methodAsPublic</span> <span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$method</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$ref</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\ReflectionMethod</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$method</span><span class="p">);</span>
        <span class="nv">$ref</span><span class="o">-&gt;</span><span class="na">setAccessible</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="nv">$obj</span> <span class="o">=</span> <span class="p">(</span><span class="nb">gettype</span><span class="p">(</span><span class="nv">$class</span><span class="p">)</span> <span class="o">===</span> <span class="s1">'object'</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$class</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>

        <span class="k">return</span> <span class="k">function</span> <span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$ref</span><span class="p">,</span> <span class="nv">$obj</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$args</span> <span class="o">=</span> <span class="nb">func_get_args</span><span class="p">();</span>
            <span class="k">return</span> <span class="nv">$ref</span><span class="o">-&gt;</span><span class="na">invokeArgs</span><span class="p">(</span><span class="nv">$obj</span><span class="p">,</span> <span class="nv">$args</span><span class="p">);</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_publicMethod</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$method</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">methodAsPublic</span><span class="p">(</span><span class="k">new</span> <span class="nx">Testklass</span><span class="p">,</span> <span class="s1">'publicMethod'</span><span class="p">);</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="nv">$method</span><span class="p">(</span><span class="s1">'$str'</span><span class="p">);</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="s1">'public: $str'</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_publicStaticMethod</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$method</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">methodAsPublic</span><span class="p">(</span><span class="s1">'Testklass'</span><span class="p">,</span> <span class="s1">'publicStaticMethod'</span><span class="p">);</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="nv">$method</span><span class="p">(</span><span class="s1">'$str'</span><span class="p">);</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="s1">'public+static: $str'</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_privateMethod</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$method</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">methodAsPublic</span><span class="p">(</span><span class="k">new</span> <span class="nx">Testklass</span><span class="p">,</span> <span class="s1">'privateMethod'</span><span class="p">);</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="nv">$method</span><span class="p">(</span><span class="s1">'$str'</span><span class="p">);</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="s1">'private: $str'</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_privateStaticMethod</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$method</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">methodAsPublic</span><span class="p">(</span><span class="s1">'Testklass'</span><span class="p">,</span> <span class="s1">'privateStaticMethod'</span><span class="p">);</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="nv">$method</span><span class="p">(</span><span class="s1">'$str'</span><span class="p">);</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="s1">'private+static: $str'</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_protectedMethod</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$method</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">methodAsPublic</span><span class="p">(</span><span class="k">new</span> <span class="nx">Testklass</span><span class="p">,</span> <span class="s1">'protectedMethod'</span><span class="p">);</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="nv">$method</span><span class="p">(</span><span class="s1">'$str'</span><span class="p">);</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="s1">'protected: $str'</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_protectedStaticMethod</span> <span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$method</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">methodAsPublic</span><span class="p">(</span><span class="s1">'Testklass'</span><span class="p">,</span> <span class="s1">'protectedStaticMethod'</span><span class="p">);</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="nv">$method</span><span class="p">(</span><span class="s1">'$str'</span><span class="p">);</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="s1">'protected+static: $str'</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>当然だけどテスト用途以外に使ってはならない(戒め)。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/2047365675b15552eb89">最近オブジェクト指向ってのが流行ってるみたいなので、Rubyに実装してみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-01 00:03:31</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[oop]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ぼくオブジェクト指向ってよくわかんないんですけど、データ構造と処理を抽象化してオブジェクトと呼ぶものにメッセージを送信することでプログラミングを実現する考へかたのことなんじゃないですかねえ……。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">ruby-oop.rb</span></div>
<div class="highlight"><pre><span></span><span class="no">Klass</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">klass</span><span class="p">){</span>
  <span class="n">lex</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">methods</span><span class="p">:</span> <span class="p">{},</span>
    <span class="ss">class_methods</span><span class="p">:</span> <span class="p">{</span>
      <span class="kp">new</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">{}</span>
    <span class="p">},</span>
  <span class="p">}</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
  <span class="n">kvars</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">return</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">source</span><span class="p">){</span>
    <span class="n">object</span> <span class="o">=</span> <span class="p">{</span><span class="ss">source</span><span class="p">:</span> <span class="n">source</span><span class="p">}</span>
    <span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="o">-&gt;</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">*</span><span class="n">as</span><span class="p">){</span><span class="n">lex</span><span class="o">[</span><span class="ss">:methods</span><span class="o">][</span><span class="nb">name</span><span class="o">][*[</span><span class="n">object</span><span class="o">]+</span><span class="n">as</span><span class="o">]</span><span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="no">OreString</span> <span class="o">=</span> <span class="no">Klass</span><span class="o">[</span>
  <span class="nb">name</span><span class="p">:</span> <span class="s1">'OreString'</span><span class="p">,</span>
  <span class="nb">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nb">to_s</span><span class="p">:</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">rsv</span><span class="p">){</span> <span class="n">rsv</span><span class="o">[</span><span class="ss">:source</span><span class="o">]</span> <span class="p">}</span>
  <span class="p">},</span>
<span class="o">]</span>

<span class="n">str</span> <span class="o">=</span> <span class="no">OreString</span><span class="o">[</span><span class="s2">"String"</span><span class="o">]</span>

<span class="nb">p</span> <span class="n">str</span><span class="o">[</span><span class="ss">:to_s</span><span class="o">]</span>
<span class="c1">#=&gt; "String"</span>
</pre></div>
</div>

<p>もうちょっとうまい実装の仕方があるんだけど、時間がなかった。 <code>class_methods</code> って書いてあるあたりから察しろ……!</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/b539eab11fb6902c17f1">函数・クロージャの引数の個数を調べる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-23 01:15:05</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>その函数は引数をいくつ要求するのか、つまり「函数の引数の数」のことを、一般的にarity(<a href="http://ja.wikipedia.org/wiki/%E3%82%A2%E3%83%AA%E3%83%86%E3%82%A3" rel="nofollow noopener" target="_blank">アリティ</a>)と呼びます。</p>

<p>これはJavaScriptやRubyでは比較的容易に取得できます。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">f</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{}</span>
<span class="o">&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">length</span>
<span class="mi">1</span>
<span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">g</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{}</span>
<span class="o">&gt;</span> <span class="nx">g</span><span class="p">.</span><span class="nx">length</span>
<span class="mi">2</span>
<span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">k</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{}</span>
<span class="o">&gt;</span> <span class="nx">k</span><span class="p">.</span><span class="nx">length</span>
<span class="mi">3</span>

<span class="o">&gt;</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){}).</span><span class="nx">length</span>
<span class="mi">1</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){}).</span><span class="nx">length</span>
<span class="mi">2</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">){}).</span><span class="nx">length</span>
<span class="mi">3</span>
</pre></div></div>

<p>Rubyだとこんな感じ</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nb">lambda</span><span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="p">}</span><span class="o">.</span><span class="n">arity</span>
<span class="o">=&gt;</span> <span class="mi">1</span>
<span class="o">&gt;</span> <span class="nb">lambda</span><span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span><span class="p">}</span><span class="o">.</span><span class="n">arity</span>
<span class="o">=&gt;</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="nb">lambda</span><span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">|</span><span class="p">}</span><span class="o">.</span><span class="n">arity</span>
<span class="o">=&gt;</span> <span class="mi">3</span>

<span class="o">&gt;</span> <span class="k">def</span> <span class="nf">f</span> <span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="k">end</span>
<span class="o">&gt;</span> <span class="nb">method</span><span class="p">(</span><span class="ss">:f</span><span class="p">)</span><span class="o">.</span><span class="n">arity</span>
<span class="o">=&gt;</span> <span class="mi">1</span>
<span class="o">&gt;</span> <span class="k">def</span> <span class="nf">g</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="k">end</span>
<span class="o">&gt;</span> <span class="nb">method</span><span class="p">(</span><span class="ss">:g</span><span class="p">)</span><span class="o">.</span><span class="n">arity</span>
<span class="o">=&gt;</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="k">def</span> <span class="nf">h</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span> <span class="k">end</span>
<span class="o">&gt;</span> <span class="nb">method</span><span class="p">(</span><span class="ss">:h</span><span class="p">)</span><span class="o">.</span><span class="n">arity</span>
<span class="o">=&gt;</span> <span class="mi">3</span>
</pre></div></div>

<p>じゃあPHPは? 函数の内部からは実行時に受け取った個数を<a href="http://www.php.net/manual/ja/function.func-num-args.php" rel="nofollow noopener" target="_blank"><code>func_num_args</code></a>で参照することはできますが、欲しいのはコレジャナイです。飽くまで <strong>定義された仮引数の個数</strong> を、 <strong>実行することなく</strong>知りたいのです。</p>

<h2>
<span id="じゃあphpはどうすんのさ" class="fragment"></span><a href="#%E3%81%98%E3%82%83%E3%81%82php%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%93%E3%81%AE%E3%81%95"><i class="fa fa-link"></i></a>じゃあPHPはどうすんのさ</h2>

<p><a href="http://ja.wikipedia.org/wiki/%E3%83%AA%E3%83%95%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3_(%E6%83%85%E5%A0%B1%E5%B7%A5%E5%AD%A6)" rel="nofollow noopener" target="_blank">リフレクション</a>です… <a href="http://www.php.net/manual/ja/book.reflection.php" rel="nofollow noopener" target="_blank">PHPのリフレクション</a>を利用するのです…</p>

<h3>
<span id="函数" class="fragment"></span><a href="#%E5%87%BD%E6%95%B0"><i class="fa fa-link"></i></a>函数</h3>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$f</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">){};</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReflectionFunction</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">getNumberOfParameters</span><span class="p">());</span>

<span class="nv">$d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReflectionFunction</span><span class="p">(</span><span class="s2">"strcmp"</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$d</span><span class="o">-&gt;</span><span class="na">getNumberOfParameters</span><span class="p">());</span>
</pre></div></div>

<p><a href="http://www.php.net/manual/ja/class.reflectionfunction.php" rel="nofollow noopener" target="_blank">ReflectionFunction</a>を利用します。</p>

<p>これで<a href="http://jp1.php.net/manual/ja/functions.user-defined.php" rel="nofollow noopener" target="_blank">ユーザー定義函数</a>も<a href="http://jp1.php.net/manual/ja/functions.internal.php" rel="nofollow noopener" target="_blank">ビルトイン函数</a>も<a href="http://php.net/manual/ja/functions.anonymous.php" rel="nofollow noopener" target="_blank">無名函数</a>もばっちりです。やったね。</p>

<h3>
<span id="メソッド" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>メソッド</h3>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Hoge</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">fuga</span> <span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"fuga"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">piyo</span> <span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"piyo"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReflectionClass</span><span class="p">(</span><span class="s2">"Hoge"</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">(</span><span class="s2">"fuga"</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getNumberOfParameters</span><span class="p">());</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$c</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">(</span><span class="s2">"piyo"</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getNumberOfParameters</span><span class="p">());</span>

<span class="nv">$d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReflectionClass</span><span class="p">(</span><span class="k">new</span> <span class="nx">Hoge</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$d</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">(</span><span class="s2">"fuga"</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getNumberOfParameters</span><span class="p">());</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$d</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">(</span><span class="s2">"piyo"</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getNumberOfParameters</span><span class="p">());</span>
</pre></div></div>

<p><a href="http://www.php.net/manual/ja/class.reflectionobject.php" rel="nofollow noopener" target="_blank">ReflectionObject</a>と<a href="http://www.php.net/manual/ja/class.reflectionmethod.php" rel="nofollow noopener" target="_blank">ReflectionMethod</a>を利用します。</p>

<p><a href="http://www.php.net/manual/ja/reflectionclass.construct.php" rel="nofollow noopener" target="_blank">ReflectionClass::__construct</a>に渡す値はインスタンスオブジェクトでもクラス名を表す文字列でも大丈夫です。</p>

<h3>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h3>

<p>めんどくさいので<a href="http://www.php.net/manual/ja/language.types.callable.php" rel="nofollow noopener" target="_blank">callback</a>の形式をまとめてサポートする函数を書いた。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Returns an indication of the number of arguments accepted by a callable.</span>
<span class="sd"> *</span>
<span class="sd"> * @param callable $callable</span>
<span class="sd"> * @return int|null</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">arity</span> <span class="p">(</span><span class="nx">callable</span> <span class="nv">$callable</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$callable</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$callable</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$callable</span><span class="p">,</span> <span class="s1">'::'</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">list</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$method</span><span class="p">)</span> <span class="o">=</span> <span class="nb">is_string</span><span class="p">(</span><span class="nv">$callable</span><span class="p">)</span> <span class="o">?</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'::'</span><span class="p">,</span> <span class="nv">$callable</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$callable</span><span class="p">;</span>
            <span class="nv">$reflection</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">ReflectionClass</span><span class="p">(</span><span class="nv">$class</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">(</span><span class="nv">$method</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$reflection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReflectionFunction</span><span class="p">(</span><span class="nv">$callable</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$reflection</span><span class="o">-&gt;</span><span class="na">getNumberOfParameters</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">test_arity</span><span class="p">(</span><span class="s1">'strpos'</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="nx">test_arity</span><span class="p">(</span><span class="s1">'hoge'</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="nx">test_arity</span><span class="p">(</span><span class="s1">'Datetime::createFromFormat'</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="nx">test_arity</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">){},</span> <span class="mi">3</span><span class="p">);</span>
<span class="nx">test_arity</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">DateTime</span><span class="p">,</span> <span class="s1">'setTime'</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">hoge</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nf">test_arity</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$expected</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$actual</span> <span class="o">=</span> <span class="nx">arity</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="k">echo</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nx">PHP_EOL</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">var_export</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
    <span class="k">echo</span> <span class="s1">' is '</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$actual</span> <span class="o">!==</span> <span class="nv">$expected</span> <span class="o">?</span> <span class="s1">'in'</span> <span class="o">:</span> <span class="s1">''</span><span class="p">)</span> <span class="o">.</span> <span class="s1">'valid.'</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p><a href="http://www.kmonos.net/nysl/" rel="nofollow noopener" target="_blank">煮るなり焼くなりお好きにどうぞ</a> or <a href="http://en.wikipedia.org/wiki/WTFPL" rel="nofollow noopener" target="_blank">You just DO WHAT THE FUCK YOU WANT TO</a>.</p>

<h2>
<span id="追記" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>追記</h2>

<h3>
<span id="1" class="fragment"></span><a href="#1"><i class="fa fa-link"></i></a>1</h3>

<p>忘れてた。<a href="http://www.php.net/manual/ja/reflectionfunctionabstract.getnumberofparameters.php" rel="nofollow noopener" target="_blank">PHP: ReflectionFunctionAbstract::getNumberOfParameters - Manual</a>のほかにも<a href="http://www.php.net/manual/ja/reflectionfunctionabstract.getnumberofrequiredparameters.php" rel="nofollow noopener" target="_blank">PHP: ReflectionFunctionAbstract::getNumberOfRequiredParameters - Manual</a>とかあるんで、お好みに合せてどうぞ。</p>

<h3>
<span id="2" class="fragment"></span><a href="#2"><i class="fa fa-link"></i></a>2</h3>

<p><a href="http://php.net/manual/ja/language.oop5.typehinting.php" rel="nofollow noopener" target="_blank">タイプヒンティング</a>の<a href="http://www.php.net/manual/ja/language.types.callable.php" rel="nofollow noopener" target="_blank">callback</a>が追加されたのは5.4なので、5.3では動きません(のでバージョン指定を5.3から5.4に変更)。 <a href="/t_cyrill" class="user-mention js-hovercard" title="t_cyrill" data-hovercard-target-type="user" data-hovercard-target-name="t_cyrill">@t_cyrill</a> ありがたうございます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/9fea1bb2f269263d621a">UNIXシェルの初歩</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-03 00:34:53</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[UNIX]</b> <b>[sh]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>おぼえよう。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /tmp
<span class="c1"># cd(=Current Directory)は作業ディレクトリを変更するコマンド</span>

$ mkdir shtest
<span class="c1"># mkdir(=MaKe DIRectory)はディレクトリを作成するコマンド</span>

$ <span class="nb">cd</span> shtest

$ <span class="nb">pwd</span>
/tmp/shtest
<span class="c1"># pwd(=Print Working Directory)は現在の作業ディレクトリをプリント(標準出力)するコマンド</span>

$ <span class="nb">echo</span> hoge
hoge
<span class="c1"># echoは引数(+改行)を標準出力するコマンド</span>
<span class="c1"># = 標準出力されたコマンドは何事もないと画面に出てくる</span>

$ <span class="nb">echo</span> hoge <span class="p">|</span> wc -c
       <span class="m">5</span>
<span class="c1"># wc(=Word Count) は単語をカウントするコマンド</span>
<span class="c1"># = wc -c は単語数ではなく文字数だけをカウントするためのオプション</span>
<span class="c1"># = "hoge"+(見えない改行文字)が入力されるので結果は `5'</span>
<span class="c1"># |(たてぼう) はパイプと呼ばれる</span>
<span class="c1"># =  コマンドの標準出力を、ほかのコマンドの標準入力に渡す</span>

$ touch myfile1
<span class="c1"># ファイルのタイムスタンプを更新するコマンド</span>
<span class="c1"># = ファイルが存在しないと新規作成されるので、こちらの目的で利用されることが多い</span>

$ <span class="nb">echo</span> hoge &gt; myfile1
<span class="c1"># &gt; はリダイレクト</span>
<span class="c1"># = echo の結果をファイル `myfile1' に保存する</span>

$ <span class="nb">echo</span> fuga &gt; myfile2
<span class="c1"># まだ存在しないファイルにリダレクトすることもできる</span>

$ cat myfile1 myfile2
hoge
fuga
<span class="c1"># cat(conCAT) は引数で渡されたファイルを連結して標準出力するコマンド</span>
<span class="c1"># = なぜ前半を略したし…</span>

$ <span class="nb">echo</span> piyo <span class="p">|</span> cat myfile1 - myfile2
hoge
piyo
fuga
<span class="c1"># - の位置に標準入力された内容も連結することができる</span>

$ <span class="nb">echo</span> foobar &gt;&gt; myfile1
<span class="c1"># &gt;&gt; は追記型のリダイレクト</span>
<span class="c1"># = 追記とは、存在するファイルに対して追加で内容を記録すること</span>

$ cat myfile1
hoge
foobar
<span class="c1"># 驚くべきことに、catファイルひとつを標準出力することもできる</span>
<span class="c1"># = concatに由来するはずの名前に反して(!)</span>

$ cat myfile1 <span class="p">|</span> wc -l
       <span class="m">2</span>
<span class="c1"># wc -l は行数(Lines)をカウントするオプション</span>

$ ls
myfile1 myfile2
<span class="c1"># ls(=LiSt directory contents)はディレクトリの内容(ファイル・ディレクトリ)を出力するコマンド</span>

$ ls &gt; files
<span class="c1"># lsの結果もファイルにリダイレクトすることができる</span>
</pre></div></div>

<h3>
<span id="課題" class="fragment"></span><a href="#%E8%AA%B2%E9%A1%8C"><i class="fa fa-link"></i></a>課題</h3>

<ol>
<li>
<code>files</code> ファイルの内容を標準出力しよう</li>
<li>
<code>ls</code> コマンドを使ってファイルの数を調べる方法を検討しよう</li>
</ol>

<h2>
<span id="あとがき" class="fragment"></span><a href="#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D"><i class="fa fa-link"></i></a>あとがき</h2>

<ul>
<li>12/3の<a href="http://qiita.com/advent-calendar/2013/one-minute">1分シリーズ</a>のために書いた記事でしたが消すのはもったいないので供養</li>
<li>CとかRubyとかでファイル操作するのだるいので、標準入出力するような小さいプログラムを書く習慣を身につけるのが正義だって、私信じてる!</li>
<li>書き始めたときのタイトルは「覚えられるだけ覚えたいUNIXシェルの基礎とawk」でしたが、いやいや一分じゃ無理だろｊｋ…</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />22位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/e7557c8db33a3c590fec">ESCを連打したときにclose-other-windowsされたくない</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-07 18:25:06</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Emacsで <code>ESC</code> (Escape)キーを連打してたらウィンドウがひとつになってしまって orz<br>
そんなことってありますよね……?</p>

<p>あるんです ヾ(〃＞＜)ﾉﾞ☆</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">init.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"M-ESC ESC"</span><span class="p">)</span> <span class="ss">'keyboard-quit</span><span class="p">)</span>
</pre></div>
</div>

<p><code>.emacs</code>ファイルにこの一行を足してやれば良いですね。</p>

<ul>
<li>
<code>M-ESC ESC</code> は、<code>ESC</code> が三回押された状態のことです</li>
<li>
<code>keyboard-quit</code> は <code>C-g</code> したときに呼ばれるコマンドです</li>
</ul>

<h2>
<span id="初出" class="fragment"></span><a href="#%E5%88%9D%E5%87%BA"><i class="fa fa-link"></i></a>初出</h2>

<ul>
<li><a href="https://github.com/emacs-jp/issues/issues/4" rel="nofollow noopener" target="_blank">keyboard-quit の beep を差し替えたい · Issue #4 · emacs-jp/issues</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />23位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/9ba5eb157e09463740f4">Emacsにzshの環境変数PATHを取り込む</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-09-27 17:17:24</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> <b>[Zsh]</b> <b>[EShell]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote>

<h2>
<span id="追記" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>追記:</h2>

<p>この記事の内容は時代遅れなので、<a href="https://github.com/purcell/exec-path-from-shell" rel="nofollow noopener" target="_blank">purcell/exec-path-from-shell</a>を利用しよう。<br>
<a href="http://qiita.com/catatsuy/items/3dda714f4c60c435bb25" id="reference-810e8b97f5466834b060">EmacsでPATHの設定が引き継がれない問題をエレガントに解決する - Qiita</a></p>
</blockquote>

<p>Ruby や Python を <code>/usr/bin</code> や <code>/usr/local/bin</code> などのシステムディレクトリではなく、バージョンごとにホームディレクトリ内にインストールして環境変数 <code>PATH</code> を通して使用する、なんてひとも少なくはないですね。筆者も rbenv や Pythonz 、 nodebrew に頼りきりです。</p>

<p>ところで Ubuntu で GTK 版の Emacs をデスクトップのランチャーから起動すると、ユーザのログインシェルを <code>/bin/zsh</code> などに設定してても、 環境変数をちゃんと引き継いでくれません。これは困った！ 特に <code>/usr/bin/ruby</code> には何もありませんし。</p>

<p>Emacs から <code>term</code> などで、 <code>zsh</code> を起動する場合はその中で <code>.zshenv</code> を読んでくれるのでまた困らないんですけど、 Emacs のシェルと言ったら Eshell なので、こっちの <code>PATH</code> は確実に設定しておきたいところです。</p>

<p>あ、Zsh の <code>PATH</code> はちゃんと <code>.zshenv</code> とかに設定しといてください。</p>

<div class="code-frame" data-lang="common-lisp">
<div class="code-lang"><span class="bold">set_path.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">zshpath</span> <span class="p">(</span><span class="nv">shell-command-to-string</span>
         <span class="s">"/usr/bin/env zsh -c 'printenv PATH'"</span><span class="p">))</span>
       <span class="p">(</span><span class="nv">pathlst</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">zshpath</span> <span class="s">":"</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">exec-path</span> <span class="nv">pathlst</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">eshell-path-env</span> <span class="nv">zshpath</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">setenv</span> <span class="s">"PATH"</span> <span class="nv">zshpath</span><span class="p">))</span>
</pre></div>
</div>

<p>これを評価すると</p>

<ol>
<li>
<code>zsh</code> を起動して、出力される <code>$PATH</code> を文字列として受け取る</li>
<li>
<strong>1</strong> で取得した <code>PATH</code> 環境変数を Emacs の環境にも設定する</li>
<li>
<code>PATH</code> は <code>:</code> 区切り形式の文字列なのでリストに変換する</li>
<li>
<strong>2</strong> のリストを Emacs の <code>exec-path</code> 、 <code>eshell-path-env</code> に設定する</li>
</ol>

<p>って流れで設定していきます。 </p>

<p>練習がてらにもうちょっと汎用性持たせて Windows のこともちょびっと考慮しつつ Emacs Lisp としてまとめてみるのも良いですかね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />24位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/248f63934204683f909b">ファイルを読み込む</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-05 00:52:43</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[emacs-lisp]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Emacs Lispでファイルを文字列として読み込んで加工ー、なんてことがしたいとする。</p>

<p>「Emacs ファイル 読み込み」でぐぐると <a href="http://www.bookshelf.jp/texi/elisp-manual-20-2.5-jp/elisp_25.html#SEC374" rel="nofollow noopener" target="_blank">GNU Emacs Lispリファレンスマニュアル: ファイル - 24.3 ファイルの読み込み</a> が出てきて、試してみると「<em>これ、ファイルの中身が直接バッファに出てきちゃうじゃーん</em>」と絶望することになる。</p>

<h2>
<span id="愚直" class="fragment"></span><a href="#%E6%84%9A%E7%9B%B4"><i class="fa fa-link"></i></a>愚直</h2>

<p>だが待ってほしい、ここはEmacsの世界だ。郷に入っては郷を従へといふ名セリフを知らないのかよ。</p>

<div class="code-frame" data-lang="common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">with-temp-buffer</span>
  <span class="p">(</span><span class="nv">insert-file-contents</span> <span class="s">"./input.txt"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">buffer-substring-no-properties</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)))</span>
</pre></div></div>

<p><code>with-temp-buffer</code>は実にべんりなマクロで、見えないところに一時的なバッファを作ってくれる。<br>
<a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Current-Buffer.html" rel="nofollow noopener" target="_blank">Current Buffer - GNU Emacs Lisp Reference Manual</a>を参照のこと。</p>

<p><code>(buffer-substring-no-properties (point-min) (point-max)</code>はバッファの中身を全部文字列として得られるいかしたイディオムだぞ!</p>

<h2>
<span id="fの時代" class="fragment"></span><a href="#f%E3%81%AE%E6%99%82%E4%BB%A3"><i class="fa fa-link"></i></a><code>f</code>の時代</h2>

<p><a href="https://github.com/rejeep/f.el" rel="nofollow noopener" target="_blank"><code>f.el</code></a>はいかしたファイル操作ライブラリだよ。</p>

<div class="code-frame" data-lang="common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">f-read-text</span> <span class="s">"./input.txt"</span><span class="p">)</span>
</pre></div></div>

<p>この一行で済むのでした。ちゃんちゃん♪</p>

<p><a href="https://github.com/dimitri/el-get/" rel="nofollow noopener" target="_blank">El-Get</a>を使ってるなら<br>
<code>(el-get 'sync 'f)</code> とかでインストールできるよ。タブンネ。<sub>(<a href="https://github.com/dimitri/el-get/pull/1595" rel="nofollow noopener" target="_blank">Pull Request #1595 · dimitri/el-get</a>がマージされてれば…!)</sub></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />25位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/ba6c690b108f16deec71">PHPよかった探し(array_map)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-28 21:04:03</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>PHPちょうべんりですね()</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">touch.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'/tmp/a.txt'</span><span class="p">,</span>
    <span class="s1">'/tmp/b.txt'</span><span class="p">,</span>
    <span class="s1">'/tmp/c.txt'</span><span class="p">,</span>
<span class="p">);</span>

<span class="c1">// 空ファイルつくる</span>
<span class="nb">array_map</span><span class="p">(</span><span class="s1">'touch'</span><span class="p">,</span> <span class="nv">$files</span><span class="p">);</span>
<span class="c1">// ファイル消す</span>
<span class="nb">array_map</span><span class="p">(</span><span class="s1">'unlink'</span><span class="p">,</span> <span class="nv">$files</span><span class="p">);</span>
</pre></div>
</div>

<ul>
<li>まじめに補足しておくと、この簡潔さはRubyやPythonでは出しにくいですね</li>
<li>といふか、この例に限ってはこころなしかLispっぽさありますね

<ul>
<li>副作用目的であって、返値を捨ててるのがアレだけど</li>
</ul>
</li>
<li>でもな… 函数名の文字列… 文字列…

<ul>
<li>
<a href="http://php.net/manual/ja/language.types.callable.php" rel="nofollow noopener" target="_blank">callable</a> の仕様作った人すごい… (虚ろな目をしながら)</li>
</ul>
</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />26位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>6</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/b51d5215e4a169540bb5">任意のウィンドウを常に再前面に出したい</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-14 04:13:39</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[Ubuntu]</b> <b>[WindowManager]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ウィンドウズが常に前面に出るようにすることを <em>Always On Top</em> といふらしい。</p>

<ul>
<li><a href="http://askubuntu.com/questions/7377/how-to-start-an-app-with-always-on-top-set" rel="nofollow noopener" target="_blank">gnome - How to start an app with "Always On Top" set? - Ask Ubuntu</a></li>
</ul>

<p>Ask Ubuntuを参照してるけど<a href="http://tomas.styblo.name/wmctrl/" rel="nofollow noopener" target="_blank">wmctrl</a>はいろんなウィンドウマネージャに対応してる、とてもいかしたやつなので、Ubuntuじゃなくても全然動くっぽいですね ヾ(〃＞＜)ﾉﾞ☆</p>

<p>まあ、Debian系のディストリならこんな感じで入る。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apt-get wmctrl
</pre></div></div>

<p>さて、まあなんか<a href="https://ja.wikipedia.org/wiki/Xeyes" rel="nofollow noopener" target="_blank">xeyes</a>をいつも再前面に出したいよねー、とか思ったりするとします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>xeyes &amp;
wmctrl -r "xeyes" -b add,above
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/bd529f8b3a461d4bd78389b731e7fec8d42af5c5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f62316164653661352d316566612d393662362d666134622d3666393539346465303534352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/bd529f8b3a461d4bd78389b731e7fec8d42af5c5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f62316164653661352d316566612d393662362d666134622d3666393539346465303534352e706e67" alt="Big Brother is watching you!" title="kobito.1381691094.461297.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/b1ade6a5-1efa-96b6-fa4b-6f9594de0545.png"></a></p>

<p>Emacsでコーディングしてても、いつもxeyesさんが僕のことを視ててくれます ヾ(〃＞＜)ﾉﾞ☆</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />27位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>6</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/e6d04df824e2207d8909">自己主張しないtmux設定(SSH向け)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-05 00:55:54</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[tmux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ローカルでもリモートでも <code>tmux</code> を使ひたい! でも2段のステータスラインはやりすぎだ!<br>
…と思ってるので、SSH経由でリモートログインするサーバのアカウントにはこんな設定を入れてます。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">tmux.conf</span></div>
<div class="highlight"><pre><span></span>set-option -g default-shell /bin/zsh
set-option -g prefix C-t
bind C-t next-window
set-option -g status off
</pre></div>
</div>

<p>いまのところこれだけ。もうちょっと足すと良い設定があるかもしれない。</p>

<h2>
<span id="なんか説明" class="fragment"></span><a href="#%E3%81%AA%E3%82%93%E3%81%8B%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>なんか説明</h2>

<ul>
<li>
<em>(これはお好みで)</em> tmux経由でのみZ Shellに

<ul>
<li>ふつうは <code>chsh</code> するのが良いです</li>
</ul>
</li>
<li>
<code>status off</code> にすることで存在感を消す</li>
<li>プレフィクスを <kbd>C-t</kbd> (<kbd>Ctrl+T</kbd>)にする</li>
<li>ステータスラインごときに画面をもう一行占有されたくないので <em>表示しない</em>
</li>
<li>そんな状態で多数のウィンドウを扱ふのはめんどくさいので、リモートサーバでは、 <strong>たかだか2枚のウィンドウでしか作業しない</strong> 前提に立つ

<ul>
<li>
<strong>例)</strong> エディタに一枚、シェルに一枚</li>
<li>
<strong>例)</strong> <code>tail -f</code>に一枚、シェルに一枚

<ul>
<li>最近はデスクトップのEmacsの<code>tramp-mode</code>でリモートのファイルを直接編輯することが多いので後者を多用してる</li>
</ul>
</li>
</ul>
</li>
<li>すると <kbd>C-t C-t</kbd> で常に2枚のウィンドウをトグルできる

<ul>
<li>もちろん必要があればさらに増やすんだけど、そうそうないようにしたい</li>
<li>ローカルのtmuxですらウィンドウを増やしまくるので、軸が増えても関心が発散しないように

<ul>
<li>まあ、集中力がないのでしばしば気が散っていくんですけど…</li>
</ul>
</li>
</ul>
</li>
</ul>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>要は、気の持ちようとシンプルな設定ですっきりした環境を保て、みたいな話でした。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />28位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>6</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/e88ffb4a00b589dc0f95">DTを蝕む「Ruby脳」の恐怖</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-22 23:04:40</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="まへがき" class="fragment"></span><a href="#%E3%81%BE%E3%81%B8%E3%81%8C%E3%81%8D"><i class="fa fa-link"></i></a>まへがき</h2>

<blockquote>
<p>無意識だったわー このコード無意識で書いてたわー<br>
<em>——Zonu.EXE (24歳・中二病)</em></p>
</blockquote>

<h2>
<span id="本文" class="fragment"></span><a href="#%E6%9C%AC%E6%96%87"><i class="fa fa-link"></i></a>本文</h2>

<p>このコードの <code>==</code> メソッドの定義を読んで違和感がなければRuby脳。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">hoge_equals.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Hoge</span>
  <span class="kp">attr_accessor</span> <span class="ss">:foo</span><span class="p">,</span> <span class="ss">:bar</span>
  <span class="k">def</span> <span class="nf">initialize</span> <span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="vi">@foo</span> <span class="o">=</span> <span class="n">arg</span><span class="o">[</span><span class="ss">:foo</span><span class="o">]</span>
    <span class="vi">@bar</span> <span class="o">=</span> <span class="n">arg</span><span class="o">[</span><span class="ss">:bar</span><span class="o">]</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">==</span> <span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="o">[</span><span class="nb">self</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">bar</span><span class="o">]</span> <span class="o">==</span> <span class="o">[</span><span class="n">other</span><span class="o">.</span><span class="n">foo</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">bar</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">fizz</span> <span class="o">=</span> <span class="no">Hoge</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">foo</span><span class="p">:</span> <span class="s2">"Foo"</span><span class="p">,</span> <span class="ss">bar</span><span class="p">:</span> <span class="s2">"Bar"</span><span class="p">)</span>
<span class="n">bazz</span> <span class="o">=</span> <span class="no">Hoge</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">foo</span><span class="p">:</span> <span class="s2">"Foo"</span><span class="p">,</span> <span class="ss">bar</span><span class="p">:</span> <span class="s2">"Bar"</span><span class="p">)</span>

<span class="nb">p</span> <span class="n">fizz</span> <span class="o">==</span> <span class="n">bazz</span>
<span class="c1"># =&gt; true</span>
</pre></div>
</div>

<h2>
<span id="補足" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>補足</h2>

<ul>
<li>タイトルで煽ってますが、このコードが問題視されることは、おそらく多くありません

<ul>
<li> <strong>Rubyの世界では</strong> 実行時に多少のオーバーヘッドがあったとしても、コードの書きやすさ、可読性が重視される文化だからです</li>
<li>僕はさう思ってますが、Rubyistの間でも見解の差があるかもしれません (きっとある)</li>
</ul>
</li>
<li>他人の書いたPythonをあまり読んだことがないのですが、Pyの文化ではどうなのでせう…? <em>(ちゃんと動きます)</em>
</li>
</ul>

<h2>
<span id="解答に代へて" class="fragment"></span><a href="#%E8%A7%A3%E7%AD%94%E3%81%AB%E4%BB%A3%E3%81%B8%E3%81%A6"><i class="fa fa-link"></i></a>解答に代へて</h2>

<p>これをPHPに直訳すると、こんな <em>(気持ち悪い)</em> ことになります ヾ(＃＞＜)ﾉﾞ</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">hoge_equals.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Hoge</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span> <span class="p">(</span><span class="k">array</span> <span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span> <span class="o">=</span> <span class="nv">$arg</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">];</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">=</span> <span class="nv">$arg</span><span class="p">[</span><span class="s1">'bar'</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">equals</span> <span class="p">(</span><span class="nv">$other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">)</span> <span class="o">==</span> <span class="k">array</span><span class="p">(</span><span class="nv">$other</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">,</span> <span class="nv">$other</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$fizz</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hoge</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'foo'</span> <span class="o">=&gt;</span> <span class="s2">"Foo"</span><span class="p">,</span> <span class="s1">'bar'</span> <span class="o">=&gt;</span> <span class="s2">"Bar"</span><span class="p">));</span>
<span class="nv">$bazz</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hoge</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'foo'</span> <span class="o">=&gt;</span> <span class="s2">"Foo"</span><span class="p">,</span> <span class="s1">'bar'</span> <span class="o">=&gt;</span> <span class="s2">"Bar"</span><span class="p">));</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$fizz</span><span class="o">-&gt;</span><span class="na">equals</span><span class="p">(</span><span class="nv">$bazz</span><span class="p">));</span>
<span class="c1"># =&gt; true</span>
</pre></div>
</div>

<h2>
<span id="個人的な見解" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A6%8B%E8%A7%A3"><i class="fa fa-link"></i></a>個人的な見解</h2>

<blockquote>
<p>言語デザインの力ってすごいよね<br>
<em>——tadsan (24歳・自称エンジニア)</em></p>
</blockquote>

<h2>
<span id="一般的な模範解答" class="fragment"></span><a href="#%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E6%A8%A1%E7%AF%84%E8%A7%A3%E7%AD%94"><i class="fa fa-link"></i></a>一般的な模範解答</h2>

<ul>
<li><code>(self.foo == other.foo) &amp;&amp; (self.bar == other.bar)</code></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />29位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/5189d445399414654b3c">EmacsでF#</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-20 23:05:20</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> <b>[F#]</b> <b>[el-get]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>たまにはEmacsでF#の開発環境を構築したいなー、って思ったりする。</p>

<h2>
<span id="fsharp-modeを入れる" class="fragment"></span><a href="#fsharp-mode%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a><code>fsharp-mode</code>を入れる</h2>

<p>ぐぐったらいろいろあって混乱するんですけど、<a href="https://github.com/fsharp/fsharpbinding/tree/master/emacs" rel="nofollow noopener" target="_blank">fsharp/fsharpbinding</a>にあるバージョンが、たぶんいちばんいいです。</p>

<h3>
<span id="el-get" class="fragment"></span><a href="#el-get"><i class="fa fa-link"></i></a><a href="https://github.com/dimitri/el-get" rel="nofollow noopener" target="_blank">El-Get</a>
</h3>

<p>僕は情弱くて<a href="http://qiita.com/tadsan/items/c4a80f46623ea266f5c5#3-1" id="reference-f1c20fa0b5064b719e85"><code>package.el</code>とかよくわからない</a>。</p>

<p><code>init.el</code>から読まれるところに<code>(el-get 'sync 'fsharp-mode)</code>って書くだけ。お手軽！</p>

<h3>
<span id="pakcageel" class="fragment"></span><a href="#pakcageel"><i class="fa fa-link"></i></a><code>pakcage.el</code>
</h3>

<p><a href="http://melpa.milkbox.net/" rel="nofollow noopener" target="_blank">MELPA</a>をリポジトリに登録すればうまく行くんじゃないかと思ったけどうまくいかなかったので僕は<a href="https://github.com/dimitri/el-get/pull/1635" rel="nofollow noopener" target="_blank">El-Getに逃げた</a>んです。あとはよろしく！</p>

<h3>
<span id="パッケージマネージャに頼らない" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AB%E9%A0%BC%E3%82%89%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>パッケージマネージャに頼らない</h3>

<p><a href="https://github.com/fsharp/fsharpbinding/blob/master/emacs/README.md" rel="nofollow noopener" target="_blank">fsharpbinding/emacs/README.md at master · fsharp/fsharpbinding</a>を読んで自分でビルドしてもいいんですけど、お手軽には<a href="https://github.com/rneatherway/emacs-fsharp-mode-bin" rel="nofollow noopener" target="_blank">rneatherway/emacs-fsharp-mode-bin</a>を<code>git clone</code>してきてディレクトリに<code>load-path</code>を通すだけでいいです。</p>

<h2>
<span id="usage" class="fragment"></span><a href="#usage"><i class="fa fa-link"></i></a>Usage</h2>

<p>ふつうにF#のコードが書けるようになります。</p>

<p>のみならず、エディタからそのまま範囲を評価してEmacs内で開いた対話環境内で実行できます。</p>

<h3>
<span id="キーバインド" class="fragment"></span><a href="#%E3%82%AD%E3%83%BC%E3%83%90%E3%82%A4%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>キーバインド</h3>

<p><a href="https://github.com/fsharp/fsharpbinding/blob/master/emacs/fsharp-mode.el#L67" rel="nofollow noopener" target="_blank">コード嫁</a>。</p>

<p>要約すると、標準のキー設定だと範囲を指定して<code>C-c C-r</code>で選択範囲を評価(<code>fsharp-eval-region</code>)、<code>C-c C-e</code>で入力中の文を評価(<code>fsharp-eval-phrase</code>)したり、<code>C-c C-c</code>で編集中のファイルをビルドしたりできるます。べんり。</p>

<h2>
<span id="さいごに" class="fragment"></span><a href="#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB"><i class="fa fa-link"></i></a>さいごに</h2>

<p><a href="https://camo.qiitausercontent.com/b0a462dc36daa9d9482e6c9f268c33313f2612f5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f62333763633266632d303366662d613038632d353236312d6330343462643936643732622e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b0a462dc36daa9d9482e6c9f268c33313f2612f5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f62333763633266632d303366662d613038632d353236312d6330343462643936643732622e6a706567" alt="BjLP5qbCUAAAUM8.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/b37cc2fc-03ff-a08c-5261-c044bd96d72b.jpeg"></a></p>

<p><a href="https://gihyo.jp/dp/ebook/2012/978-4-7741-5127-4" rel="nofollow noopener" target="_blank">すごいF#たのしく学ぼう！</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />30位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/51a2b869774f93f0d7cb">Emacsに環境変数を取り込む… をもっと。</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-18 04:42:40</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> <b>[Zsh]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>こんにちはこんにちは、DT です。全然説明してなかった気がするので、説明に上がりました。</p>

<p>ステマのお時間です。</p>

<h2>
<span id="前回" class="fragment"></span><a href="#%E5%89%8D%E5%9B%9E"><i class="fa fa-link"></i></a>前回</h2>

<ul>
<li><a href="https://github.com/zonuexe/shellenv-el" rel="nofollow noopener" target="_blank">zonuexe/shellenv-el · GitHub</a></li>
<li><a href="http://qiita.com/items/bdc979a7b93ea8f76bd3">Emacsに環境変数を取り込む… の次。(with 初めてのelisp) - Qiita</a></li>
</ul>

<h2>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h2>

<ul>
<li>EmacsはGUIで起動したい</li>
<li>システムデフォルトじゃないシェル(zshとか)を常用してる</li>
<li>Bash と zsh で二度も同じ設定を書きたくない</li>
</ul>

<p>設定するのがめんどくさいだけじゃなくて、実際に困ることがありますからね ヾ(〃＞＜)ﾉﾞ☆</p>

<h2>
<span id="導入" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>導入</h2>

<p>前回の記事ではel-getを使って導入する方法をおすすめしましたが、OS X環境に最新のGitを入れると <code>.gitconfig</code> とデフォルトの <code>git</code> のバージョンのミスマッチでel-getが動かなくなる現象が起こるので、 <code>$HOME/.emacs.d/site-lisp/shellenv-el</code> みたいな位置に配置することにしました。</p>

<p>僕は <code>.emacs.d</code> をGitで管理してるので、サブモジュールにして置きます。つまり <code>~/.emacs.d</code> にリポジトリルートがあるとすると、こんな感じのコマンドで配置できますね。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git submodule add git@github.com:zonuexe/shellenv-el.git site-lisp/shellenv-el
</pre></div></div>

<p>で、 <code>~.emacs.d/init.el</code> の、できるだけ頭の行に二行を足します。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">require</span> <span class="ss">'shellenv</span> <span class="s">"~/.emacs.d/site-lisp/shellenv-el/shellenv"</span><span class="p">)</span>
<span class="p">(</span><span class="nv">shellenv/setpath</span> <span class="ss">'zsh</span><span class="p">)</span>
</pre></div>
</div>

<p>この函数を評価すると、以下の副作用が発生します。</p>

<ol>
<li>
<code>zsh</code> が起動され、 <code>$PATH</code> を取得します

<ul>
<li>このとき、 <code>.zshenv</code> などが実行されます</li>
</ul>
</li>
<li>Emacsの環境変数 <code>"PATH"</code> に、zshの <code>$PATH</code> の内容をセットする</li>
<li>
<code>setq-default</code> で次の変数を設定する

<ul>
<li>
<code>eshell-path-env</code> にzshから取得した <code>$PATH</code> を(Lispの)リストに変換したもの</li>
<li>
<code>exec-path</code> にzshから取得した <code>$PATH</code> のリストに既存の <code>exec-path</code> を追加したリスト</li>
</ul>
</li>
</ol>

<p>その結果、次のような効果を得ることができます。</p>

<ul>
<li>
<code>shell-command</code> でzshと同じコマンドを実行することができる</li>
<li>EShellでzshと同じコマンドを実行することができる</li>
</ul>

<p>やりましたね ヾ(〃＞＜)ﾉﾞ☆</p>

<h2>
<span id="さらに" class="fragment"></span><a href="#%E3%81%95%E3%82%89%E3%81%AB"><i class="fa fa-link"></i></a>さらに</h2>

<h3>
<span id="任意の環境変数をセットしたい" class="fragment"></span><a href="#%E4%BB%BB%E6%84%8F%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E3%82%BB%E3%83%83%E3%83%88%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>任意の環境変数をセットしたい</h3>

<p><code>$HOGE</code> を取得したいときは、こんなふうに書けば良いですね。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">shellenv/setenv</span> <span class="s">"HOGE"</span> <span class="ss">'zsh</span><span class="p">)</span>
</pre></div>
</div>

<p><code>shellenv/setenv</code> は環境変数の取得とセットをします。</p>

<h3>
<span id="任意の環境変数を取得したい" class="fragment"></span><a href="#%E4%BB%BB%E6%84%8F%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>任意の環境変数を取得したい</h3>

<p>別にセットはしなくていいけど、取得した文字列を自分で利用したい、みたいな場合。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">shellenv/.getenv</span> <span class="s">"HOGE"</span> <span class="ss">'bash</span><span class="p">)</span>
</pre></div>
</div>

<p>こんな感じで取得できます。</p>

<h3>
<span id="何度もシェルの名前を指定するのはだるい" class="fragment"></span><a href="#%E4%BD%95%E5%BA%A6%E3%82%82%E3%82%B7%E3%82%A7%E3%83%AB%E3%81%AE%E5%90%8D%E5%89%8D%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%AE%E3%81%AF%E3%81%A0%E3%82%8B%E3%81%84"><i class="fa fa-link"></i></a>何度もシェルの名前を指定するのはだるい</h3>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">shellenv/shell</span> <span class="ss">'zsh</span><span class="p">)</span>
<span class="p">(</span><span class="nv">shellenv/setpath</span><span class="p">)</span>
<span class="p">(</span><span class="nv">shellenv/setenv</span> <span class="s">"HOGE"</span><span class="p">)</span>
</pre></div>
</div>

<p>これでいけます。</p>

<h2>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h2>

<p>上記で説明した用途だと問題ないはずですが、このレールから外れたところにまだバグがあ残ってるくさいので直していきたい…?</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />31位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/bdc979a7b93ea8f76bd3">Emacsに環境変数を取り込む… の次。(with 初めてのelisp)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-31 22:14:20</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> <b>[rbenv]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote>

<h2>
<span id="結論" class="fragment"></span><a href="#%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>結論</h2>

<p>Emacsのことが全然わかってないので使ってコード読んでフルボッコにしてください</p>
</blockquote>

<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>しばらく前に<a href="http://qiita.com/items/9ba5eb157e09463740f4">Emacsにzshの環境変数PATHを取り込む</a>といふ記事を書きました童貞です。<br>
こんばんはこんばんは。</p>

<p>標準以外のシェル (Zshellとか) を愛用してると、 GUI な Emacs を利用したときに環境変数、たとへば<code>PATH</code>などがふだんのシェル環境と一致しなくて困ったことが起こりえます。</p>

<p>具体的にはユーザディレクトリ下に<code>.rbenv</code>ディレクトリがあって、ここにある<code>ruby</code>を使用したい。そのために<code>$HOME/.rbenv/shims</code>が<code>PATH</code>の先頭にあって欲しい。みたいなケースですね。</p>

<p>そんな問題を、<code>.emacs</code>にちょっとしたコード断片を書き加へて解決しようとしたのが前回の記事でした。が、</p>

<blockquote>
<p>練習がてらにもうちょっと汎用性持たせて Windows のこともちょびっと考慮しつつ Emacs Lisp としてまとめてみるのも良いですかね。</p>
</blockquote>

<p>……などと、前の記事で口走ってしまったので、旧年中に伏線を回収に上がりました。</p>

<p>つまるところ、この記事は<strong>人柱募集所</strong>なのですがヾ(〃＞＜)ﾉﾞ☆</p>

<h2>
<span id="対象環境" class="fragment"></span><a href="#%E5%AF%BE%E8%B1%A1%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>対象環境</h2>

<p><strong>Emacs24</strong>が動いてるUNIXっぽい環境(<strong>OS X</strong>とか、<strong>Linux</strong>とか、<strong>*BSD</strong>とか…)なら、きっと動く気がします。Windowsとか<strong>Cygwin</strong>環境のことはちょっとわからないので、そのうち調べます……。</p>

<p><strong>Emacs23</strong>では動作確認すらしてないです……!</p>

<h2>
<span id="導入" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>導入</h2>

<ul>
<li><a href="https://github.com/zonuexe/shellenv-el" rel="nofollow noopener" target="_blank">zonuexe/shellenv-el · GitHub</a></li>
</ul>

<p>インストール方法は<code>shellenv.el</code>をダウンロードして<code>load-path</code>の通ったディレクトリに抛り込むなり、<code>git clone</code>してきてディレクトリを<code>load-path</code>に追加するなり、お好みの方法でどうぞ。</p>

<p>個人的には<a href="https://github.com/dimitri/el-get" rel="nofollow noopener" target="_blank">el-get</a>を使ったパッケージ管理が最近のイチオシです。ただ、まだちゃんとしたレシピファイルを用意してないので、<code>.emacs</code>ファイル(できれば<code>$HOME/.emacs.d/init.el</code>)にel-getセットアップ用のスクリプトを加へて、さらにその下に以下のコードを貼ってくださると良さげです。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs.d/init.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">setq</span> <span class="nv">el-get-sources</span>
      <span class="o">'</span><span class="p">((</span><span class="ss">:name</span> <span class="nv">shellenv</span>
               <span class="ss">:type</span> <span class="nv">github</span>
               <span class="ss">:pkgname</span> <span class="s">"zonuexe/shellenv-el"</span>
               <span class="ss">:description</span> <span class="s">"load environment variables of your shell"</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">el-get</span> <span class="ss">'sync</span> <span class="ss">'shellenv</span><span class="p">)</span>
</pre></div>
</div>

<h2>
<span id="設定" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>設定</h2>

<p>いちばんシンプルなのはこんな感じです。<code>custom-set-variables</code>じゃなくて<code>setq</code>でも可。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs.d/init.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">require</span> <span class="ss">'shellenv</span><span class="p">)</span>
<span class="p">(</span><span class="nv">custom-set-variables</span>
 <span class="o">'</span><span class="p">(</span><span class="nv">shellenv/shell</span> <span class="ss">'zsh</span><span class="p">))</span>
<span class="p">(</span><span class="nv">shellenv/setpath</span><span class="p">)</span>
</pre></div>
</div>

<p>あるいは、起動するシェルのパスを直接指定することもできます。</p>

<div class="code-frame" data-lang="cl">
<div class="code-lang"><span class="bold">.emacs.d/init.el</span></div>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">require</span> <span class="ss">'shellenv</span><span class="p">)</span>
<span class="p">(</span><span class="nv">custom-set-variables</span>
 <span class="o">'</span><span class="p">(</span><span class="nv">shellenv/path</span> <span class="s">"/usr/local/bin/zsh"</span><span class="p">))</span>
<span class="p">(</span><span class="nv">shellenv/setpath</span><span class="p">)</span>
</pre></div>
</div>

<p>わざわざ<code>'zsh</code>と指定するのは、このスクリプトが<code>bash</code>, <code>dash</code>, <code>ash</code>(それとPOSIX.1準拠っぽいその他<code>sh</code>)にも対応してるからですヾ(〃＞＜)ﾉﾞ☆</p>

<p>わざわざ「対応」って呼ぶほどの最適化をしてるわけではないのですが…‥。</p>

<h2>
<span id="書いてみて" class="fragment"></span><a href="#%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%81%A6"><i class="fa fa-link"></i></a>書いてみて</h2>

<p>自分でLispのコードをちゃんと書いたのはこれが初めてなのですが、こんな書き方で良いんですかね…? よくわからないので、無作法なところがあれば指摘が欲しいです ヾ(〃＞＜)ﾉﾞ</p>

<p>変数名や函数名の付け方はかなりオレオレで、プレフィクスには<code>shellenv/</code>を付ける、スクリプトローカル用の函数はプレフィクスの次に<code>.</code>を付ける、ローカル変数は<code>let*</code>束縛内で<code>.</code>を付けて短めな名前にする、みたいなルールでつけました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />32位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/efe8a404344fd6fee638">インラインコード記法が化ける</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-02 22:36:34</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>本文は <a href="https://gist.github.com/zonuexe/6793690" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/zonuexe/6793690</a> にあります。</p>

<h2>
<span id="kobitoの場合" class="fragment"></span><a href="#kobito%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Kobitoの場合</h2>

<p><a href="https://camo.qiitausercontent.com/6e04a738519c90f18aaaafec41477bb6522b8ace/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f35343964316634642d633238312d373031332d323238652d6231666130363365393264632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6e04a738519c90f18aaaafec41477bb6522b8ace/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f35343964316634642d633238312d373031332d323238652d6231666130363365393264632e706e67" alt="Kobitoの場合" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/549d1f4d-c281-7013-228e-b1fa063e92dc.png"></a></p>

<h2>
<span id="qiitaのプレビュー" class="fragment"></span><a href="#qiita%E3%81%AE%E3%83%97%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC"><i class="fa fa-link"></i></a>Qiitaのプレビュー</h2>

<p><a href="https://camo.qiitausercontent.com/0c2451faa8d05a3d86dda400241a5a6469daa428/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31383562643064352d316462322d373266332d663432392d6165613430333436333335382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0c2451faa8d05a3d86dda400241a5a6469daa428/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f343132312f31383562643064352d316462322d373266332d663432392d6165613430333436333335382e706e67" alt="Qiitaのプレビュー" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/4121/185bd0d5-1db2-72f3-f429-aea403463358.png"></a></p>

<h2>
<span id="blockcode" class="fragment"></span><a href="#blockcode"><i class="fa fa-link"></i></a>blockcode</h2>

<div class="code-frame" data-lang="markdown"><div class="highlight"><pre><span></span>はじめに、このような場合に `\"` と表示されるのは文字列リテラル `"…"` の中に含まれる文字 `\` を区別して表示してゐるだけなので、 `\` といふ文字が文字列中に含まれるわけではありません。

本当に `hoge = "hoge\\\""` (これは`'hoge\"'`と同じ意味です) といふ文字列があったとして、ここから`String#gsub`を使って`\`を除去するのは`hoge.gsub(/\\/,'')` でできます。

次にRubyからJSON文字列を手で作るケース。これは本当に厄介で、JSONで `"\"ho\\ge\""` (`'"ho\ge"'`) と解釈される文字列をRubyの`"`を使って作るには`"\"\\\"ho\\\\ge\\\"\""`と書く必要があります。例によって`'`を使って書くと`'"\\"ho\\\\ge\\""'`です。
</pre></div></div>

<h2>
<span id="blockquote" class="fragment"></span><a href="#blockquote"><i class="fa fa-link"></i></a>blockquote</h2>

<blockquote>
<p>はじめに、このような場合に <code>\"</code> と表示されるのは文字列リテラル <code>"…"</code> の中に含まれる文字 <code>\</code> を区別して表示してゐるだけなので、 <code>\</code> といふ文字が文字列中に含まれるわけではありません。</p>

<p>本当に <code>hoge = "hoge\\\""</code> (これは<code>'hoge\"'</code>と同じ意味です) といふ文字列があったとして、ここから<code>String#gsub</code>を使って<code>\</code>を除去するのは<code>hoge.gsub(/\\/,'')</code> でできます。</p>

<p>次にRubyからJSON文字列を手で作るケース。これは本当に厄介で、JSONで <code>"\"ho\\ge\""</code> (<code>'"ho\ge"'</code>) と解釈される文字列をRubyの<code>"</code>を使って作るには<code>"\"\\\"ho\\\\ge\\\"\""</code>と書く必要があります。例によって<code>'</code>を使って書くと<code>'"\\"ho\\\\ge\\""'</code>です。</p>
</blockquote>

<h2>
<span id="直接" class="fragment"></span><a href="#%E7%9B%B4%E6%8E%A5"><i class="fa fa-link"></i></a>直接</h2>

<p>はじめに、このような場合に <code>\"</code> と表示されるのは文字列リテラル <code>"…"</code> の中に含まれる文字 <code>\</code> を区別して表示してゐるだけなので、 <code>\</code> といふ文字が文字列中に含まれるわけではありません。</p>

<p>本当に <code>hoge = "hoge\\\""</code> (これは<code>'hoge\"'</code>と同じ意味です) といふ文字列があったとして、ここから<code>String#gsub</code>を使って<code>\</code>を除去するのは<code>hoge.gsub(/\\/,'')</code> でできます。</p>

<p>次にRubyからJSON文字列を手で作るケース。これは本当に厄介で、JSONで <code>"\"ho\\ge\""</code> (<code>'"ho\ge"'</code>) と解釈される文字列をRubyの<code>"</code>を使って作るには<code>"\"\\\"ho\\\\ge\\\"\""</code>と書く必要があります。例によって<code>'</code>を使って書くと<code>'"\\"ho\\\\ge\\""'</code>です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />33位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/6aea9d6143f722900260">ファイルパスによってインデントを変更する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-20 21:21:27</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><strong><em>(この記事には補足があります。最後までお読みください)</em></strong></p>

<p>個人的に書くコードはソフトタブ(空白文字でインデント)だけど、仕事のJavaScriptのコーディングルールはハードタブ(水平タブ文字でインデント)なんだよー、仕事で書くコードは全て <code>hoge</code> が含まれるディレクトリにあるよー、な場合。</p>

<p>なんか適当。正規表現も <code>setq</code> する内容もフックの名前も各自よしなに。要するにモードにフックを追加するだけです。 <code>.emacs.d/init.el</code> とかにどうぞ。</p>

<div class="code-frame" data-lang="common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add-hook</span>
 <span class="ss">'js-mode-hook</span>
 <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
   <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">string-match</span> <span class="s">".*hoge.*/.*\\.js"</span>
                       <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">buffer-file-name</span><span class="p">)</span> <span class="s">""</span><span class="p">))</span>
     <span class="p">(</span><span class="k">setq</span> <span class="nv">indent-tabs-mode</span> <span class="no">t</span> <span class="nv">tab-width</span> <span class="mi">4</span><span class="p">))))</span>
</pre></div></div>

<h2>
<span id="追記" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>追記</h2>

<p><code>js2-mode</code> とか使ってる場合は <code>js2-mode-hook</code>、PHPなら <code>php-mode-hook</code> とか、よしなに書いてくださいね。</p>

<p>メジャーモードによってはフックが提供されてない場合は、<a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Mode-Hooks.html" rel="nofollow noopener" target="_blank">さあどうすれば良いのでせうね</a> ヾ(〃＞＜)ﾉﾞ☆</p>

<h2>
<span id="補足" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>補足</h2>

<p><a href="/yasuyk@github" class="user-mention js-hovercard" title="yasuyk@github" data-hovercard-target-type="user" data-hovercard-target-name="yasuyk@github">@yasuyk@github</a> さんのおっしゃる通り、 <code>.dir-locals.el</code> による ディレクトリ変数 を活用するのも良い方法です。 <em>(僕もコメントで指摘いただくまで存じ上げませんでした…!)</em></p>

<p>ただし、ディレクトリ変数が階層構造による「変数の制禦」を目的とするものであること、上記のコード断片はディクトリ階層ではなく <em>パス中に含まれる文字列</em> による判定を主眼としたもの <em>(階層に依存しない)</em> であることを理解の上で、目的に合致したものを活用するのが良いですね ヾ(〃＞＜)ﾉﾞ☆</p>

<ul>
<li><a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Directory-Variables.html" rel="nofollow noopener" target="_blank">Directory Variables - GNU Emacs Manual</a></li>
<li><a href="http://www.emacswiki.org/emacs/DirectoryVariables" rel="nofollow noopener" target="_blank">EmacsWiki: Directory Variables</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />34位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/9322adc85f7748224251">RuntimeErrorの罠</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-13 21:05:42</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>あの、僕は恥しながら最近まで、といふか現職で仕事を始めるまで、自分で例外を送出するなんて大それたことを考へずに生きてきたんですね。</p>

<p><em>……で。</em></p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">e1</span> <span class="o">=</span> <span class="k">begin</span>
    <span class="k">raise</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="p">;</span> <span class="n">e</span>
  <span class="k">end</span>
<span class="c1">#=&gt; RuntimeError</span>

<span class="n">e2</span> <span class="o">=</span> <span class="k">begin</span>
    <span class="k">raise</span> <span class="s2">"Error!!!"</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="p">;</span> <span class="n">e</span>
  <span class="k">end</span>
<span class="c1">#=&gt; #&lt;RuntimeError: Error!!!&gt;</span>
</pre></div></div>

<p>これを見て僕は、 <code>e1</code> のケースでは <code>RuntimeError</code> のクラスオブジェクトが、 <code>e2</code> のケースでは <code>RuntimeError</code> のインスタンスオブジェクトが返ってくるのか、これはひどい。と判断したわけです。</p>

<p><em>……ちゃうねん。</em></p>

<p>ここでおさらひをしておきます。IRBやPryでは、最後に評価した文の値が画面に <strong>出力</strong> (表示)されます。これは <code>p</code> メソッドを使ったときと同様の出力、つまり <code>p e1</code> としたときと同じになります。</p>

<p>さらに遡ると、この <code>p</code> メソッド (Rubyでの慣習に従って詳細に表記すると <a href="http://doc.ruby-lang.org/ja/2.0.0/method/Kernel/m/p.html" rel="nofollow noopener" target="_blank"><code>Kernel.#p</code></a>) は <code>Object#inspect</code> を呼び出します。</p>

<p>つまり、 <code>p e2</code> は <code>puts e2.inspect</code> と、 <em>概ね同じ意味</em> です。 (Ruby でクラスを自作する際は、忘れずに <code>inspect</code> メソッドを実装してやることで、デバッグ用のかっこいい表示ができます)</p>

<p>PryさんはRubyに標準添付されてるIRBよりも賢くて、最後に評価した値を画面に出力するときに綺麗に色をつけてくれたりします。</p>

<p><em>……これが罠だった!</em></p>

<p>これ、Pryを使ってると綺麗に色がつくのですが、クラス定数だと青色、オブジェクトだと緑色に見えるのですね。</p>

<p><a href="https://camo.qiitausercontent.com/c5d3af0821b8da81395ee0ecaacee0da79b59885/68747470733a2f2f7777772e657665726e6f74652e636f6d2f73686172642f7337372f73682f63653531653335312d383766302d346138382d616161652d3139316561323339613032642f61313536336564353838643230363839353632323432663433343337623037652f7265732f34666635383537392d646136302d343064622d626264612d6665363163343731643939392f736b697463682e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c5d3af0821b8da81395ee0ecaacee0da79b59885/68747470733a2f2f7777772e657665726e6f74652e636f6d2f73686172642f7337372f73682f63653531653335312d383766302d346138382d616161652d3139316561323339613032642f61313536336564353838643230363839353632323432663433343337623037652f7265732f34666635383537392d646136302d343064622d626264612d6665363163343731643939392f736b697463682e706e67" alt="`Object; Object.new; #in Pry`" data-canonical-src="https://www.evernote.com/shard/s77/sh/ce51e351-87f0-4a88-aaae-191ea239a02d/a1563ed588d20689562242f43437b07e/res/4ff58579-da60-40db-bbda-fe61c471d999/skitch.png"></a></p>

<p>さて、</p>

<p><a href="https://camo.qiitausercontent.com/19fc6037ab641c2e33b56c07bcef8a6638f50b5d/68747470733a2f2f7777772e657665726e6f74652e636f6d2f73686172642f7337372f73682f38386533393930302d633164382d343437662d623135302d3366616232653137393463352f36633431643865306538643533613265656565636239323632636530626664352f7265732f39373538646333632d373834622d343631612d623131362d6366383361373433623963662f736b697463682e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/19fc6037ab641c2e33b56c07bcef8a6638f50b5d/68747470733a2f2f7777772e657665726e6f74652e636f6d2f73686172642f7337372f73682f38386533393930302d633164382d343437662d623135302d3366616232653137393463352f36633431643865306538643533613265656565636239323632636530626664352f7265732f39373538646333632d373834622d343631612d623131362d6366383361373433623963662f736b697463682e706e67" alt="inspect `RuntimeError, e1, e2`" data-canonical-src="https://www.evernote.com/shard/s77/sh/88e39900-c1d8-447f-b150-3fab2e1794c5/6c41d8e0e8d53a2eeeecb9262ce0bfd5/res/9758dc3c-784b-461a-b116-cf83a743b9cf/skitch.png"></a></p>

<p>アイエエエ! インスタンスオブジェクトなのにクラス定数みたいに見えるのナンデ!?</p>

<p><em>といふかそもそも…</em></p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="no">RuntimeError</span><span class="o">.</span><span class="n">inspect</span> <span class="o">==</span> <span class="n">e1</span><span class="o">.</span><span class="n">inspect</span>
<span class="c1">#=&gt; true</span>
</pre></div></div>

<p>これが元凶。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />35位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/dce5c4dbf9dee608d6ef">ブロック引数を呼び出し側の環境で実行する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-11 04:52:48</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>さんざん悩んだ後で考へてみるとタイトルが答へそのものなんですけどね。<br>
知ってる人にはかなりどうでも良い話なのですが、僕は忘れてました。</p>

<p>その悩みがどういふことかといふと、</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">X</span>
  <span class="k">def</span> <span class="nf">initialize</span> <span class="p">(</span><span class="o">&amp;</span><span class="nb">proc</span><span class="p">)</span>
    <span class="nb">p</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="nb">self</span>
    <span class="nb">proc</span><span class="o">.</span><span class="n">call</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Y</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">x</span>
    <span class="n">X</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="nb">p</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="nb">self</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">Y</span><span class="o">.</span><span class="n">x</span>
</pre></div></div>

<p>このとき、標準出力には何が出力されるでせう…? といふ話です。<br>
もちろんこの仕様は正しいのですが、<code>1 =&gt;</code> と <code>2 =&gt;</code> の指す値が同じであってほしいこともありますよね。</p>

<p>それが可能になれば、以下のように書くことも可能になるはずです。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">X</span>
  <span class="k">def</span> <span class="nf">initialize</span> <span class="p">(</span><span class="o">&amp;</span><span class="nb">proc</span><span class="p">)</span>
    <span class="sc">??</span><span class="p">?</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">hello</span>
    <span class="nb">puts</span><span class="ss">:hello</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Y</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">hello</span>
    <span class="n">X</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="nb">puts</span> <span class="n">hello</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">Y</span><span class="o">.</span><span class="n">x</span>
</pre></div></div>

<p><code>puts hello</code> では <code>X#hello</code> が呼び出されることを期待します。わくわくしますね。<br>
さっさと結論に進みますが、解決策は <code>proc.call</code> の部分を <code>instance_eval &amp;proc</code> にするだけです。お手軽ですね。</p>

<p>どうしてこんなことになるのかの解説は話しはじめると長いし、こんな時間だから眠いので各自考へてみてくださいね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>tadsanさんの<br />36位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/tadsan/items/64ca67cbac0e3f261c40">(要望)Twitter通知について</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-28 21:10:08</center>
	</td>
	<td style="width:200px;">
		@tadsan<br />(Zonu.me 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/4121/profile-images/1473683797">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>現在の公開後通知のテンプレが簡潔すぎて「僕がいま書いて公開したんですよ」といふ情報が皆無なのがつらいですね。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
