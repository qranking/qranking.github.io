<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (yimajo)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (yimajo さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>737</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/c67cb711851f747c35e5">iOS実機のSSL通信をプロキシによって傍受したり改ざんする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-16 11:19:00</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>スマートフォンアプリ開発でAPIを介しWeb/APIサーバーとやりとりをする場合、「httpsを使っていれば通信はユーザーにバレない」なんてことはなく、Webアプリでツールを使ってできるのと同じようにユーザーには通信内容の確認や改竄などができます。</p>

<p>そのため、そのことを前提にアプリやサーバーAPIの設計と実装を行わない場合、アプリ利用者によるゲームスコア結果送信の改竄や、ソーシャルゲームにおけるレイドボスなどへのダメージ操作、ECサイトアプリでの購入操作なども可能になってしまいます。</p>

<p>また、最近自分は<a href="https://itunes.apple.com/jp/app/nettorajio-j-popmo-wu-liaode/id769979888?mt=8" rel="nofollow noopener" target="_blank">「無料で音楽聴き放題!! - ネットラジオ」というアプリをリリースしたのですが</a>、このアプリに導入するスタティックリンクライブラリが不明な外部サーバーへ通信していないか、SSLを使用しているつもりがそうでない通信をしてしまっていないかのチェックをするため、自分は<a href="http://mitmproxy.org/" rel="nofollow noopener" target="_blank">mitmproxy</a>というプロキシサーバーのツールを利用しています。</p>

<p>以降の内容はこんな感じです</p>

<ul>
<li>mitmproxyとその導入について</li>
<li>通信内容の確認</li>
<li>通信内容の改竄（リクエストの書き換え、レスポンスの書き換え）</li>
</ul>

<p>必要なものは次の通りです</p>

<ul>
<li>有線LAN接続されたMac OSX（有線接続が必要なのはインターネット共有機能のためです）</li>
<li>homebrew</li>
</ul>

<h1>
<span id="mitmproxyとその導入について" class="fragment"></span><a href="#mitmproxy%E3%81%A8%E3%81%9D%E3%81%AE%E5%B0%8E%E5%85%A5%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>mitmproxyとその導入について</h1>

<p>mitmproxyはコマンドライン製のプロキシツールです。名前のmitmとはman-in-the-middleの略で通信用語のman-in-the-middle attack(中間者攻撃)などに使われる用語から来ているようです。</p>

<p>中間者攻撃というと過激ですが、自分で開発したアプリに対して検証をする際には便利なツールとなります。</p>

<p>イメージとしては次のようになります。</p>

<p><a href="https://camo.qiitausercontent.com/08337d55990b56bfeb95aaa5ec69596ddbdd12df/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f64663935346430332d313064642d613361332d393464652d6361633333363165663062322e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/08337d55990b56bfeb95aaa5ec69596ddbdd12df/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f64663935346430332d313064642d613361332d393464652d6361633333363165663062322e6a706567" alt="mitm_2.jpg" title="mitm_2.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/df954d03-10dd-a3a3-94de-cac3361ef0b2.jpeg"></a></p>

<p>Mac OSX搭載の標準設定にあるインターネット共有(OSX自体がWiFiルータになる機能)を使い、通信をproxyで中継しiOS実機でそのWiFiを利用するというのが大雑把な仕組みです。</p>

<h2>
<span id="pythonのインストール" class="fragment"></span><a href="#python%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Pythonのインストール</h2>

<p>mitmproxyの実行には、まずPythonが必要になるのでhomebrewでPythonをインストールします</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span> $ brew update
 $ brew upgrade
 $ brew install python
</pre></div></div>

<p>次にpipをインストールします。easy_insallはbrewによるpythonのインストールと同時にインストールされているはずです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ easy_install pip
</pre></div></div>

<h2>
<span id="mitmproxyのインストール" class="fragment"></span><a href="#mitmproxy%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>mitmproxyのインストール</h2>

<p>pipからmitmproxyをインストールします</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pip install mitmproxy
</pre></div></div>

<p>すでにインストールしていてアップデートしたい場合は次のようにオプション-Uを付けてアップデートしておきましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pip install mitmproxy -U
</pre></div></div>

<p>pipでインストールすることで関連するライブラリもインストールされます。</p>

<h1>
<span id="mitmproxyの起動" class="fragment"></span><a href="#mitmproxy%E3%81%AE%E8%B5%B7%E5%8B%95"><i class="fa fa-link"></i></a>mitmproxyの起動</h1>

<p>実行は次の通り、オプション-pでポートを指定します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mitmproxy -p 8080
</pre></div></div>

<p>私はポート8080を指定していますが、これはiPhone側からのWiFi設定でも8080を指定が必要です。</p>

<p>iOSのWiFi設定からHTTPプロキシで手動を選択しサーバーのアドレスとポート番号を指定できるようになっています。</p>

<p><a href="https://camo.qiitausercontent.com/ed0f5bf92b36217d492ffaf66fd9d6ea3a1c54db/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f33323738633637642d326535612d653133302d616262632d3637626365346130343461642e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ed0f5bf92b36217d492ffaf66fd9d6ea3a1c54db/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f33323738633637642d326535612d653133302d616262632d3637626365346130343461642e6a706567" alt="IMG_0669.jpg" title="IMG_0669.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/3278c67d-2e5a-e130-abbc-67bce4a044ad.jpeg"></a></p>

<p>（図のsunnyとはMac OSXのマシン名で、WiFi名ですので気にしないでください）</p>

<h2>
<span id="iphone実機へのルート証明書のインストール" class="fragment"></span><a href="#iphone%E5%AE%9F%E6%A9%9F%E3%81%B8%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%88%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>iPhone実機へのルート証明書のインストール</h2>

<p>またmitmproxyを実行すると~/.mitmproxy/にmitmroxy-ca.pemという証明書が作成されます。<br>
OS XからiPhoneへこの証明書をメール送信し、iPhone側のメールクライアントから証明書を開くことでインストールすることが可能です。なお、この証明書はiOSアプリ開発者にはお馴染み[設定][一般][プロビジョニング]から確認できます。</p>

<h1>
<span id="mitmproxyを使う" class="fragment"></span><a href="#mitmproxy%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>mitmproxyを使う</h1>

<p>mitmproxyの簡単な利用として、リクエストとレスポンスを見たり、それらを改竄、または通信を止めることが出来ます。</p>

<p>リクエストの改竄については、例えばすでに送信したリクエストからパラメータなどを変更することができ、変更したリクエストを再度送ることが出来ます。</p>

<p><a href="https://camo.qiitausercontent.com/ec98e1f247f51789bc572db4c9ce5eaefa7ca7f1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f35666365616131342d623464332d633133332d366435302d3535396432316130653132372e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ec98e1f247f51789bc572db4c9ce5eaefa7ca7f1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f35666365616131342d623464332d633133332d366435302d3535396432316130653132372e6a706567" alt="名称未設定.jpg" title="名称未設定.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/5fceaa14-b4d3-c133-6d50-559d21a0e127.jpeg"></a></p>

<h2>
<span id="インタラクティブにリクエストレスポンスデータを書き換え" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%83%96%E3%81%AB%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88"><i class="fa fa-link"></i></a>インタラクティブにリクエスト/レスポンスデータを書き換え</h2>

<p>mitmproxyを起動した図の画面のリクエスト一覧から、[Enterキー]でGETしたリクエスト/レスポンスの詳細画面に移ります。<br>
[eキー]でリクエスト（クエリ、パス、URL、ヘッダー、form、body、メソッド）を編集、<br>
一覧に戻り[rキー]で編集したリクエストを再度GETすることができます。</p>

<p>また、気付きづらいのですが[Vキー]で編集をもとに戻すこともできます。これらのショートカットは[?キー]を押すことによって確認することができます。</p>

<p>このようにインタラクティブにリクエストを編集できる機能は、サーバー側にAPIコールをお気楽に試せるため、サーバーAPI側の仕様が不明な場合に検証やテストを行うのに最適です。課金アイテムのリクエストなどでパラメータをデタラメにした場合の異常系や、In-App Purchase時のサーバーへのレシートの送信もテストできるでしょう。</p>

<p>逆にこのインタラクティブな書き換えでは、リクエストを編集し再度GET/POSTなどしても、アプリ側の通信が完了済みのため、アプリ側で改ざんされたリクエスト/レスポンスを受けてのテストなどが出来る場合は少ないと思います。</p>

<h2>
<span id="スクリプトによるリアルタイムなデータ改竄" class="fragment"></span><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%BF%E3%82%A4%E3%83%A0%E3%81%AA%E3%83%87%E3%83%BC%E3%82%BF%E6%94%B9%E7%AB%84"><i class="fa fa-link"></i></a>スクリプトによるリアルタイムなデータ改竄</h2>

<p>mitmproxyではインタラクティブな操作によるリクエスト/レスポンスの改竄ではなく、あらかじめ改ざんする内容を記載したPythonスクリプトファイルを指定することにより、通信ごとにスクリプトを適用することが出来ます。</p>

<p>例えばソーシャルゲームで多人数のユーザーが共通のボスと戦っているレイドボスと呼ばれるシステムがあったとします。</p>

<p>大抵の場合、流れは次のようになるでしょう</p>

<ul>
<li>ユーザーAがボスに100ダメージ与えた</li>
<li>サーバーにユーザーAが100ダメージを与えたことをリクエスト送信</li>
<li>サーバー側はユーザーAが100ダメージ与えたと認識</li>
<li>ユーザーAに完了のレスポンス</li>
</ul>

<p>mitmproxyでダメージを変え、ダメージを与えたご褒美アイテムの数を変更することを考えると、次のようになります。</p>

<ul>
<li>ユーザーAがボスに100ダメージ与えた

<ul>
<li>リクエストをフックし9999ダメージ与えたことに変更</li>
</ul>
</li>
<li>サーバーにユーザーAが9999ダメージを与えたことをリクエスト送信</li>
<li>サーバー側はユーザーAが9999ダメージ与えたと認識</li>
<li>ユーザーAに完了のレスポンス

<ul>
<li>レスポンスをフックしご褒美アイテムの数を増やす</li>
</ul>
</li>
</ul>

<p>スクリプトでリクエストレスポンスの改竄を行うことで、インタラクティブな書き換えではタイムアウトしてしまい出来なかった事ができるようになってしまいます。</p>

<h3>
<span id="スクリプトの指定" class="fragment"></span><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>スクリプトの指定</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mitmproxy -s examples/add_header.py
</pre></div></div>

<p>サンプルにあるadd_header.pyは次のようにシンプルな内容なので導入に持ってこいではないでしょうか。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">add_header.py</span></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">flow</span><span class="p">):</span>
    <span class="n">flow</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"newheader"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"foo"</span><span class="p">]</span>
</pre></div>
</div>

<p>responseメソッドは通信のレスポンスをHTTP(S)クライアントに届ける前に書き換えるメソッドです。このメソッドをオーバーライドし、レスポンスヘッダーに”newheader”を追加し、値をリストから文字列”foo”としています。</p>

<p>FlowクラスやResponseクラスについてはflow.pyに定義されているため、仕様を理解するにはそこを参照するしかないでしょう。</p>

<p><a href="https://github.com/mitmproxy/mitmproxy/blob/master/libmproxy/flow.py" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mitmproxy/mitmproxy/blob/master/libmproxy/flow.py</a></p>

<p>スクリプトで特定のホストに対するリクエストかどうかの条件判断をするサンプルコードもありこれが一番参考になるでしょう。</p>

<p><a href="https://github.com/mitmproxy/mitmproxy/blob/master/examples/redirect_requests.py" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mitmproxy/mitmproxy/blob/master/examples/redirect_requests.py</a></p>

<p>redirect_requests.pyは”example.com"のホストへのリクエスト全てをオリジナルなレスポンスを作成して返し、"example.org”であれば"mitmproxy.org”へとリダイレクトします。</p>

<p>このサンプルコードを元に、自分の用意するホストへのリクエストの改竄を行い検証するのが手っ取り早いでしょう。</p>

<h1>
<span id="mitmdumpについて" class="fragment"></span><a href="#mitmdump%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>mitmdumpについて</h1>

<p>mitmproxyをインストールするとmitmdumpというツールもインストールされます。mitmdumpはこれまで説明してきたmitmproxyと違い、結果を先述のコンソール画面のようなインタラクティブなリスト表示ではなく、標準出力へ出力するため、grepと併用するなどし結果を絞り込むことも出来るようです。これを利用することで特定ホストに対してhttpsを使っているつもりが、httpになっているかなどのチェックを効率的に行うことが出来るでしょう。</p>

<h1>
<span id="操作と用途まとめ" class="fragment"></span><a href="#%E6%93%8D%E4%BD%9C%E3%81%A8%E7%94%A8%E9%80%94%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>操作と用途まとめ</h1>

<ul>
<li>mitmproxyの基本操作でアプリ内課金で不正なリクエストにしてみる</li>
<li>mitmproxyの基本操作でアプリ内課金部分でアプリからニセ（使用済みまたは他のアプリ）のレシートをサーバーに送って何が起こるか簡単に試せる</li>
<li>mitmproxyのスクリプトで特定ホストへのリクエスト/レスポンスを改竄してみる</li>
<li>mitmdumpで特定ホストに対してhttp通信してしまっていないか確認できる</li>
</ul>

<h1>
<span id="ここで書かなかったこと" class="fragment"></span><a href="#%E3%81%93%E3%81%93%E3%81%A7%E6%9B%B8%E3%81%8B%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>ここで書かなかったこと</h1>

<p>ここに書いた方法はポート8080にアクセスするようにwifiの設定を変更しています。ですが、透過型プロキシを使えば、実機がwifiのデフォルトである80ポートを使って通常と同じように通信をしているようにすることも可能です。</p>

<p>透過化型プロキシを使う方法は下記のサイトを参照すれば良いと思います。</p>

<p>MacでWifi共有で透過的にmitmproxy<br>
<a href="http://bagpack.hatenablog.jp/entry/2014/02/04/225553" class="autolink" rel="nofollow noopener" target="_blank">http://bagpack.hatenablog.jp/entry/2014/02/04/225553</a></p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>世の中のWeb API設計/運営者やアプリ開発者が以上のことを正しく知っていないと、障害が起きた時の復旧や違反者の追跡など本来のコンテンツ運営とは違う時間がかかってしまいダメージは大きく計画の停滞感さえまねきます。発端はスマートフォンアプリでhttpsでの通信を行えば安心などの楽観的思考により設計が受け身になっていることだと思うので、まず通信の傍受/改竄方法を知ることが先決かなと思いました。</p>

<p>実際、AppleのGameCenterはplistでスコアを送信しているようで、mitmproxyによるインタラクティブなリクエストの改竄だけで、アプリ利用者のスコアを変更できるようです（現在は対策されているかもしれませんが）。</p>

<p>Setting highscores on Apple's GameCenter<br>
<a href="http://mitmproxy.org/doc/tutorials/gamecenter.html" class="autolink" rel="nofollow noopener" target="_blank">http://mitmproxy.org/doc/tutorials/gamecenter.html</a></p>

<p>具体的なセキュリティ対策に対しては、それぞれのコンテンツの要件と優先順位によって変わると思うので各自で考えましょう。もしくは<a href="http://curiosity.co.jp/" rel="nofollow noopener" target="_blank">弊社に相談を頂ければ一緒になって考えたりもします</a>。</p>

<h2>
<span id="参考url" class="fragment"></span><a href="#%E5%8F%82%E8%80%83url"><i class="fa fa-link"></i></a>参考URL</h2>

<p>mitmproxy<br>
<a href="http://mitmproxy.org/" class="autolink" rel="nofollow noopener" target="_blank">http://mitmproxy.org/</a></p>

<p>mitmproxyのスクリプトサンプル<br>
<a href="https://github.com/mitmproxy/mitmproxy/tree/master/examples" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mitmproxy/mitmproxy/tree/master/examples</a></p>

<p>mitmproxyを使ってSSL通信の中身を確認する<br>
<a href="http://ido.nu/kuma/2012/01/29/how-to-use-mitmproxy/" class="autolink" rel="nofollow noopener" target="_blank">http://ido.nu/kuma/2012/01/29/how-to-use-mitmproxy/</a></p>

<p>pyasn1 and PyOpenSSLの依存関係があるからpip使うようになった?<br>
<a href="https://github.com/mitmproxy/mitmproxy/issues/37" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mitmproxy/mitmproxy/issues/37</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>531</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/7051af0919b5286aecfe">iOS7でナビゲーションバーやステータスバーをカスタマイズする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-19 09:49:12</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> <b>[ios7]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOS7からステータスバーの背景とナビゲーションバーが一体化し、ステータスバーの文字列スタイルをViewControllerで制御するためのdelegateが追加されたのでメモ。</p>

<h1>
<span id="ナビゲーションバーをカスタマイズする" class="fragment"></span><a href="#%E3%83%8A%E3%83%93%E3%82%B2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%90%E3%83%BC%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ナビゲーションバーをカスタマイズする</h1>

<h2>
<span id="ナビゲーションバーの色を変える" class="fragment"></span><a href="#%E3%83%8A%E3%83%93%E3%82%B2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%90%E3%83%BC%E3%81%AE%E8%89%B2%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>ナビゲーションバーの色を変える</h2>

<p>まず、ナビゲーションバーの背景色はbarTintColorで変更できる</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="bp">UINavigationBar</span> <span class="n">appearance</span><span class="p">].</span><span class="n">barTintColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">0.000</span> <span class="nl">green</span><span class="p">:</span><span class="mf">0.549</span> <span class="nl">blue</span><span class="p">:</span><span class="mf">0.890</span> <span class="nl">alpha</span><span class="p">:</span><span class="mf">1.000</span><span class="p">];</span>
</pre></div></div>

<p>ナビゲーションバー上の戻るボタンの色やUIBarButtonItemの色はtintColorで変更できる。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="bp">UINavigationBar</span> <span class="n">appearance</span><span class="p">].</span><span class="n">tintColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
</pre></div></div>

<h2>
<span id="タイトルをカスタマイズする" class="fragment"></span><a href="#%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>タイトルをカスタマイズする</h2>

<p>次に、タイトルの文字色を変える。<br>
iOS7ではUITextAttributeTextColorは非推奨になった。NSForegroundColorAttributeNameが使える。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="bp">UINavigationBar</span> <span class="n">appearance</span><span class="p">].</span><span class="n">titleTextAttributes</span> <span class="o">=</span> <span class="l">@{</span><span class="nl">NSForegroundColorAttributeName</span><span class="p">:</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">whiteColor</span><span class="p">]</span><span class="l">}</span><span class="p">;</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/1c1337981aa0f4e683ec6dfabd3f8d14e1e33be6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37663136636539382d313030312d363333302d386134362d3839326134363766313962342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1c1337981aa0f4e683ec6dfabd3f8d14e1e33be6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37663136636539382d313030312d363333302d386134362d3839326134363766313962342e706e67" alt="nav1.png" title="nav1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/7f16ce98-1001-6330-8a46-892a467f19b4.png"></a></p>

<h1>
<span id="ステータスバーをカスタマイズする" class="fragment"></span><a href="#%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%83%90%E3%83%BC%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ステータスバーをカスタマイズする</h1>

<h2>
<span id="ステータスバーの文字色を一括で変更したい" class="fragment"></span><a href="#%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E6%96%87%E5%AD%97%E8%89%B2%E3%82%92%E4%B8%80%E6%8B%AC%E3%81%A7%E5%A4%89%E6%9B%B4%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>ステータスバーの文字色を一括で変更したい</h2>

<p>ステータスバーの文字色もコードで白に出来る。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="bp">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="nl">setStatusBarStyle</span><span class="p">:</span><span class="n">UIStatusBarStyleLightContent</span><span class="p">];</span>
</pre></div></div>

<p>ただしinfo.plistで”View controller-based status bar”をNOにしておく必要がある。</p>

<h2>
<span id="ステータスバーのスタイルをviewcontroller毎に変えたい場合" class="fragment"></span><a href="#%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%82%92viewcontroller%E6%AF%8E%E3%81%AB%E5%A4%89%E3%81%88%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>ステータスバーのスタイルをViewController毎に変えたい場合</h2>

<p>逆にアプリ全体を一括で変えたくない場合、info.plistで”View controller-based status bar”をYESにしておくと、UIViewControllerでステータスバーのスタイルを動的に変更することができる。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//下の2つのメソッドを呼び出す事を伝える</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setNeedsStatusBarAppearanceUpdate</span><span class="p">;</span>
<span class="c1">//オーバーライドしてスタイル指定</span>
<span class="p">-</span> <span class="p">(</span><span class="n">UIStatusBarStyle</span><span class="p">)</span><span class="nf">preferredStatusBarStyle</span><span class="p">;</span>
<span class="c1">//オーバーライドして非表示かどうかを選択</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">prefersStatusBarHidden</span><span class="p">;</span>
</pre></div></div>

<p>setNeedsStatusBarAppearanceUpdateメソッドを実行した際に、preferredStatusBarStyleと、prefersStatusBarHiddenメソッドが実行されるのでそれぞれをオーバーライドしてスタイルの変更や非表示選択を行える。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">([</span><span class="nb">self</span> <span class="nl">respondsToSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">setNeedsStatusBarAppearanceUpdate</span><span class="p">)])</span> <span class="p">{</span>
        <span class="c1">//viewControllerで制御することを伝える。iOS7 からできたメソッド</span>
        <span class="p">[</span><span class="nb">self</span> <span class="n">setNeedsStatusBarAppearanceUpdate</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">prefersStatusBarHidden</span> <span class="p">{</span>
    <span class="c1">//YESでステータスバーを非表示（NOなら表示）</span>
    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="n">UIStatusBarStyle</span><span class="p">)</span><span class="nf">preferredStatusBarStyle</span> <span class="p">{</span>
    <span class="c1">//文字を白くする</span>
    <span class="k">return</span> <span class="n">UIStatusBarStyleLightContent</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></div>

<h3>
<span id="動的にステータスバーの表示非表示を切り替える" class="fragment"></span><a href="#%E5%8B%95%E7%9A%84%E3%81%AB%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%83%90%E3%83%BC%E3%81%AE%E8%A1%A8%E7%A4%BA%E9%9D%9E%E8%A1%A8%E7%A4%BA%E3%82%92%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>動的にステータスバーの表示・非表示を切り替える</h3>

<p>ボタン押下時にステータスバーを非表示にする場合、フラグを作ってそれをYESにする方法がiOS7 Tech Talkで紹介されていた。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@property</span> <span class="kt">BOOL</span> <span class="n">shouldBeHidingStatusBar</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">prefersStatusBarHidden</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">shouldBeHidingStatusBar</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">hideStatusBar</span>
<span class="p">{</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">shouldBeHidingStatusBar</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">setNeedsStatusBarAppearanceUpdate</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>さらにステータスバーをアニメーションさせたい場合は、setNeedsStatusBarAppearanceUpdateをUIViewのanimateWithDuration:animations:メソッドでblocksに入れ、preferredStatusBarUpdateAnimationメソッドをオーバーライドしてUIStatusBarAnimationを指定する。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">hideStatusBar</span>
<span class="p">{</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">shouldBeHidingStatusBar</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="p">[</span><span class="bp">UIView</span> <span class="nl">animateWithDuration</span><span class="p">:</span><span class="mf">0.5</span> <span class="nl">animations</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="nb">self</span> <span class="n">setNeedsStatusBarAppearanceUpdate</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="c1">//スライドするアニメーションを指定</span>
<span class="p">-</span> <span class="p">(</span><span class="n">UIStatusBarAnimation</span><span class="p">)</span><span class="nf">preferredStatusBarUpdateAnimation</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">UIStatusBarAnimationSlide</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h3>
<span id="uinavigationcontrollerがありviewcontroller毎にスタイルを変えたい場合" class="fragment"></span><a href="#uinavigationcontroller%E3%81%8C%E3%81%82%E3%82%8Aviewcontroller%E6%AF%8E%E3%81%AB%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%82%92%E5%A4%89%E3%81%88%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>UINavigationControllerがあり、ViewController毎にスタイルを変えたい場合、</h3>

<p>ステータスバーのスタイル変更（色を白にしたいなど）は、UINavigationControllerがあると途端にややこしくなる。</p>

<p>まずUINavigationControllerがある場合の基本動作を把握しておく</p>

<h4>
<span id="基本動作" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E5%8B%95%E4%BD%9C"><i class="fa fa-link"></i></a>基本動作</h4>

<ul>
<li>UINavigationControllerのchildViewControllerForStatusBarStyleが動作しnilを返す。

<ul>
<li>nilの場合、自身(UINavigationController)のpreferredStatusBarStyleが動作。</li>
<li>preferredStatusBarStyleはUIStatusBarStyleDefault（つまり黒）を返す</li>
</ul>
</li>
<li>nilを返されて各ViewControllerのpreferredStatusBarStyleが動作しない</li>
</ul>

<p>UINavigationControllerに紐づけてある各ViewControllerのpreferredStatusBarStyleが動作しないので、何が起こっているのか非常にわかりづらいし、コンテナであるUINavigationController自体で問題解決しないといけないとはなかなか気づけなかった。以下が解決方法。</p>

<h4>
<span id="解決方法1-ナビゲーションバーのスタイルを変える" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%951-%E3%83%8A%E3%83%93%E3%82%B2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%90%E3%83%BC%E3%81%AE%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>解決方法1. ナビゲーションバーのスタイルを変える</h4>

<ul>
<li>各ViewControllerでnavigationBar.barStyle = UIBarStyleBlack;とする

<ul>
<li>UINavigationControllerはスタイルが黒のときステータスバーを白になる</li>
</ul>
</li>
</ul>

<h4>
<span id="解決方法2-uinavigationcontrollerを継承かカテゴリで動作を変える" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%952-uinavigationcontroller%E3%82%92%E7%B6%99%E6%89%BF%E3%81%8B%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%A7%E5%8B%95%E4%BD%9C%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>解決方法2. UINavigationControllerを継承かカテゴリで動作を変える</h4>

<ul>
<li>UINavigationControllerのchildViewControllerForStatusBarStyleをオーバーライドして表示しているViewControllerを返す</li>
<li>各ViewControllerでpreferredStatusBarStyleをオーバーライドしスタイルを変える</li>
</ul>

<p>UINavigationControllerをカテゴリでオーバーライドする例</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#import "UINavigationController+StatusBarCustom.h"</span>

<span class="k">@implementation</span> <span class="bp">UINavigationController</span>  <span class="nl">(StatusBarCustom)</span>

<span class="p">-</span> <span class="p">(</span><span class="bp">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nf">childViewControllerForStatusBarStyle</span>
<span class="p">{</span>
    <span class="c1">// デフォルトこいつはnilが返るので表示されたものを返すようにする</span>
    <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">visibleViewController</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</pre></div></div>

<p>個別のViewControllerでpreferredStatusBarStyleが動作するのでステータスバーの色を白にする</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="n">UIStatusBarStyle</span><span class="p">)</span><span class="nf">preferredStatusBarStyle</span> <span class="p">{</span>
    <span class="c1">//文字を白くする</span>
    <span class="k">return</span> <span class="n">UIStatusBarStyleLightContent</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h3>
<span id="解決方法の選定" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95%E3%81%AE%E9%81%B8%E5%AE%9A"><i class="fa fa-link"></i></a>解決方法の選定</h3>

<p>そもそもUINavigationControllerのchildViewControllerForStatusBarStyleがデフォルトでnilを返している基本動作がおかしい気がする。同じコンテナのUITabBarControllerはnilを返しておらず、タブが選択されたViewControllerを返していて理にかなっているし、そのおかげでコンテナに邪魔されない。もしコンテナで一括で変えたい場合などはそこで設定すればいいと考えられるので自然じゃないかな。</p>

<p>そのため、解決方法2についてはカテゴリで既存の動作をオーバーライドするのも悪くない手ではないかと思う。むしろこういう時こそカテゴリでUIKitをオーバーライドすべきじゃないかなとすら思う。すでにアプリの設計上UINavigationControllerを継承で作りきっているならカテゴリ使う必要ないよねってな感想。</p>

<p>解決方法1については、UINavigationBarを黒にすることでたまたまステータスバーが白くなることを利用している風に感じてしまう。UINavigaitonBarに画像やTintColorを設定しなければほんとに黒くなるので、そうしたい場合には理にかなっているが、黒と設定しているが見た目が黒じゃないということ自体には人の書いたコードを保守する目線で見ると辛い。</p>

<h2>
<span id="ナビゲーションバーの非表示と同時にステータスバーを非表示にする" class="fragment"></span><a href="#%E3%83%8A%E3%83%93%E3%82%B2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%90%E3%83%BC%E3%81%AE%E9%9D%9E%E8%A1%A8%E7%A4%BA%E3%81%A8%E5%90%8C%E6%99%82%E3%81%AB%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%83%90%E3%83%BC%E3%82%92%E9%9D%9E%E8%A1%A8%E7%A4%BA%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ナビゲーションバーの非表示と同時にステータスバーを非表示にする</h2>

<p>UINavigationControllerのsetNavigationBarHidden:animated:メソッドを使いナビゲーションコントローラを非表示にしようとする場合、ステータスバー更新のためのUIViewControllerのsetNeedsStatusBarAppearanceUpdateメソッドを使う必要がない。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//フルスクリーンにするメソッドを作る</span>
<span class="c1">//ナビゲーションバーとステータスバーを非表示にしたい</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">changeFullScreen</span>
<span class="p">{</span>
    <span class="c1">//ここでナビゲーションバーを非表示にするが</span>
    <span class="c1">//同時にステータスバー更新のメソッドも呼ばれる</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">navigationController</span> <span class="nl">setNavigationBarHidden</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">animated</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>

    <span class="c1">//以下は意味なし</span>
    <span class="c1">//ここでステータスバーの更新を呼んでも2度手間になる</span>
<span class="c1">//    [self setNeedsStatusBarAppearanceUpdate]; </span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="分かってないこと" class="fragment"></span><a href="#%E5%88%86%E3%81%8B%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>分かってないこと</h2>

<p>MFMailComposeViewControllerでメールのモーダルの画面を立ち上げるとステータスバーの文字色が黒色（デフォルト）になってしまいコントロール出来ない...</p>

<p>SKStoreProductViewControllerでAppStoreを表示するモーダルの場合は、ナビゲーションバーのtintColorをコントロールする方法をしりたい…</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>WWDC2013 のsession214</p>

<p>iOS 7におけるUIStatusBarStyleのベストプラクティス <br>
<a href="http://cockscomb.hatenablog.com/entry/2013/11/12/190905" class="autolink" rel="nofollow noopener" target="_blank">http://cockscomb.hatenablog.com/entry/2013/11/12/190905</a></p>

<p>iOS7 Teck Talk Videos : Architecting Modern Apps,Part1<br>
<a href="https://developer.apple.com/tech-talks/videos/index.php?id=2" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/tech-talks/videos/index.php?id=2</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>447</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/254c7cebab7864678246">やはりお前らのiOS7対応は間違っている(解説編)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-16 15:26:11</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>クックパッドさんが月イチで行っている第3回potatotips（ポテトチップス）というTips共有会がYahoo!Japanさんで開かれたので参加させてもらい、『やはりお前らのiOS7対応は間違っている』という刺激的&amp;挑戦的なタイトルで発表させてもらいました。</p>

<p>発表時には時間もなかったせいかツッコミがなかったのですが、おそらく公開したらツッコミがあると思うのでいくつかの補足を付けて公開します（<a href="http://www.slideshare.net/YoshinoriImajo/ios7-30039408" rel="nofollow noopener" target="_blank">発表時の資料はSlideShareに上げてます</a>が、Qiitaのほうが編集リクエストもあるし直しやすいかと思います）。</p>

<h1>
<span id="何を間違っているか" class="fragment"></span><a href="#%E4%BD%95%E3%82%92%E9%96%93%E9%81%95%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>何を間違っているか</h1>

<p>最近、<a href="http://techblog.yahoo.co.jp/ios/ios7yahoo/" rel="nofollow noopener" target="_blank">iOS7でUINavigationBarにself.viewが潜り込む</a>という話をよく目にすると思います。この対応方法として「edgesForExtededLayoutプロパティをUIRectEdgeNoneとする（StoryboardではUnder Top Barsのチェックを外す）ことで潜りこみを回避できますよ」とあり、デメリットとして「これのデメリットはすりガラス表現が失われることです」とあります。</p>

<p>コードでは次のように書かれていたりしますね</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="nb">self</span><span class="p">.</span><span class="n">edgesForExtendedLayout</span> <span class="o">=</span> <span class="n">UIRectEdgeNone</span><span class="p">;</span> <span class="c1">//良い方法じゃないぜ？</span>
</pre></div></div>

<p>これは長くプロジェクトを続けていく上では決して良い方法ではないし、デメリットも微妙に表現が間違っています。</p>

<p>この表現を多くのブログが引用していることから、おそらくこれらの設定の理解が出来てないのではないかと感じたわけです。</p>

<p>また、Storyboardを使えばコード上でedgesForExtededLayoutを使う必要はなく、Extend Edges項目のUnder Top Barsのチェックになるので以降の説明にはこれを使います。</p>

<p><a href="https://camo.qiitausercontent.com/36a5ba239d9e67bd6c9f09085695f8646a0c705d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f65306262666531352d663835622d323938392d363539392d3238636666333561303666362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/36a5ba239d9e67bd6c9f09085695f8646a0c705d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f65306262666531352d663835622d323938392d363539392d3238636666333561303666362e706e67" alt="スクリーンショット 2014-01-16 1.14.39.png" title="スクリーンショット 2014-01-16 1.14.39.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/e0bbfe15-f85b-2989-6599-28cff35a06f6.png"></a></p>

<p>ほとんどの場合このチェックはすべきです。チェックしてUINavigationBarにself.viewが潜り込むのなら、それは他の方法でずれを直すべきですよといのうがこの文章の結論です。</p>

<h2>
<span id="そもそもすりガラス表現は失われてなかったんだぜ" class="fragment"></span><a href="#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%81%99%E3%82%8A%E3%82%AC%E3%83%A9%E3%82%B9%E8%A1%A8%E7%8F%BE%E3%81%AF%E5%A4%B1%E3%82%8F%E3%82%8C%E3%81%A6%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%82%93%E3%81%A0%E3%81%9C"><i class="fa fa-link"></i></a>そもそもすりガラス表現は失われてなかったんだぜ</h2>

<p>Under Top Barsのチェックを外した場合、背景にはUIWindowしかないことから真っ黒な背景に対してすりガラス表現が適用されているだけです。</p>

<p>ビューを立体的に見てみると分かりやすいでしょう。</p>

<p><a href="https://camo.qiitausercontent.com/449a35927dd1b373ef97b3e909feee65dc82d92a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f35336532653734392d633632612d326432322d313964642d6161396138326563656636612e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/449a35927dd1b373ef97b3e909feee65dc82d92a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f35336532653734392d633632612d326432322d313964642d6161396138326563656636612e6a706567" alt="Under Top Bars をオフにした" title="やはりお前らのiOS7対応は間違っている.019.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/53e2e749-c62a-2d22-19dd-aa9a82ecef6a.jpeg"></a></p>

<p>RootViewControllerと書かれたUINavigationBarの下にピンクのビューが無いため、すりガラス効果が黒の部分に対して適用されています。</p>

<p>逆にUnder Top Barsのチェックをオンにした場合は次のようになりピンクの背景色に対してすりガラス表現が適用されてます。</p>

<p><a href="https://camo.qiitausercontent.com/834d770f7683a56ac969cb63d1bffa71cfe669d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38306538613033662d306266302d343361652d666162372d3330386435623730383366312e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/834d770f7683a56ac969cb63d1bffa71cfe669d7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38306538613033662d306266302d343361652d666162372d3330386435623730383366312e6a706567" alt="すりガラス表現" title="やはりお前らのiOS7対応は間違っているp11.018.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/80e8a03f-0bf0-43ae-fab7-308d5b7083f1.jpeg"></a></p>

<h2>
<span id="新しいxcodeに移行した途端ずれているからといってviewの開始をuinavigationbarの下からにするのは良いやり方じゃない" class="fragment"></span><a href="#%E6%96%B0%E3%81%97%E3%81%84xcode%E3%81%AB%E7%A7%BB%E8%A1%8C%E3%81%97%E3%81%9F%E9%80%94%E7%AB%AF%E3%81%9A%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B%E3%82%89%E3%81%A8%E3%81%84%E3%81%A3%E3%81%A6view%E3%81%AE%E9%96%8B%E5%A7%8B%E3%82%92uinavigationbar%E3%81%AE%E4%B8%8B%E3%81%8B%E3%82%89%E3%81%AB%E3%81%99%E3%82%8B%E3%81%AE%E3%81%AF%E8%89%AF%E3%81%84%E3%82%84%E3%82%8A%E6%96%B9%E3%81%98%E3%82%83%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>新しいXcodeに移行した途端、ずれているからといってViewの開始をUINavigationBarの下からにするのは良いやり方じゃない</h2>

<p>ずれているのはiOS7から考え方が全画面表示になったからで、それに伴ってView上のコンポーネントを調整しましょう。はい、調整するとiOS6がずれますね、そしたらiOS6/7 Deltaで座標値を変えてiOS6用に調整すればよいです。</p>

<h1>
<span id="パターン別のしっかりとした解決方法" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E5%88%A5%E3%81%AE%E3%81%97%E3%81%A3%E3%81%8B%E3%82%8A%E3%81%A8%E3%81%97%E3%81%9F%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>パターン別のしっかりとした解決方法</h1>

<p>解決方法の分類のため3パターン考えてみました。</p>

<ul>
<li>UITableViewControllerを使う場合</li>
<li>UIViewControllerを使う場合</li>
<li>UIScrollViewやUICollectionViewで全画面写真表示したい場合</li>
</ul>

<p>表で設定をまとめるとわかりやすくなります。</p>

<table>
<thead>
<tr>
<th style="text-align: left"></th>
<th style="text-align: center">Adjust Scroll View Insets</th>
<th style="text-align: center">Under Top Bars</th>
<th style="text-align: left">iOS6対応のため</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">UITableViewController</td>
<td style="text-align: center">チェックする</td>
<td style="text-align: center">チェックする</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">UIViewController</td>
<td style="text-align: center">チェックする</td>
<td style="text-align: center">チェックする</td>
<td style="text-align: left">まずiOS7用にコンポーネントを配置し直し、その上でiOS6/7 Deltasで座標値調整</td>
</tr>
<tr>
<td style="text-align: left">UIScrollViewなどで全画面写真表示</td>
<td style="text-align: center">チェック外す</td>
<td style="text-align: center">チェックする</td>
<td style="text-align: left">Use Full Screenをチェック</td>
</tr>
</tbody>
</table>

<p>基本的にUnder Top Barsは全てチェックをしたままが良いでしょう。<br>
UINavigationBarがない場合はチェックを外してもいいかもしれませんが、なければこのチェックが意味を成さないだけです。</p>

<p>自分の経験上、あえてUnder Top Barsのチェックを外さなきゃならないパターンが見当たらないので他にあれば教えてください。</p>

<h2>
<span id="adjust-scroll-view-insetsにチェックしないパターン" class="fragment"></span><a href="#adjust-scroll-view-insets%E3%81%AB%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%97%E3%81%AA%E3%81%84%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>Adjust Scroll View Insetsにチェックしないパターン</h2>

<p>イレギュラーなのが先述の3パターン目だけです。Adjust Scroll View InsetsとUnder Top Barsをチェックしてしまうとその設定によって、View自体はちゃんとウインドウの左上から始まるのですがcontentInsets.topが調整されてしまいナビゲーションバーの下からscrollViewがはじまり全画面ぽくないですね（図の右側）。</p>

<p><a href="https://camo.qiitausercontent.com/eda47238e633fbb4830fd76e567d92389c9bb5a1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37323863343436642d656333642d316132342d613939322d6361303638623538653739392e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/eda47238e633fbb4830fd76e567d92389c9bb5a1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37323863343436642d656333642d316132342d613939322d6361303638623538653739392e6a706567" alt="全画面表示.jpg" title="全画面表示.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/728c446d-ec3d-1a24-a992-ca068b58e799.jpeg"></a></p>

<h1>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h1>

<h2>
<span id="storyboard使えるならstoryboardで設定するのがオススメです" class="fragment"></span><a href="#storyboard%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AA%E3%82%89storyboard%E3%81%A7%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8C%E3%82%AA%E3%82%B9%E3%82%B9%E3%83%A1%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>Storyboard使えるならStoryboardで設定するのがオススメです</h2>

<p>Storyboard(Interface Buildr)の設定はわりとよく考えられていて、iOS7だけにしか効果が無い設定やiOS6だけにしか効果が無い設定があるので、コード上で分岐させる必要もなくなる上に、将来的にiOS8などが出てiOS6が非対応になった際にもその設定は変更する必要がなくなるわけです。おそらく表面的にも表示されなくなるでしょう。ソースコードで書いてしまうと精神衛生上それらを消さないってわけにも行かないし、消しても良いコード悪いコードの判別を強いられるの嫌ですよね。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//ViewControllerのloadViewなどでの処理</span>
<span class="k">if</span> <span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">NSFoundationVersionNumber</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">NSFoundationVersionNumber_iOS_6_1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//ここにiOS7用のプロパティへの代入を書かなくてもStoryboardへの設定が反映される</span>
    <span class="c1">//例)self.edgesForExtendedLayout = UIRectEdgeAll;</span>
    <span class="c1">//Storyboardに設定した値と違う値をセット出来てしまって保守しづらい</span>

    <span class="c1">//iOS7以上でStoryboardで設定できない処理があるなら書くしかないが</span>
    <span class="c1">//そうすると消しても良いStoryboardで設定できるコードと</span>
    <span class="c1">//そうでないコードがViewControllerに混在して判別しづらい</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="potatotipsで発表した資料" class="fragment"></span><a href="#potatotips%E3%81%A7%E7%99%BA%E8%A1%A8%E3%81%97%E3%81%9F%E8%B3%87%E6%96%99"><i class="fa fa-link"></i></a>potatotipsで発表した資料</h2>

<p>SlideShareにアップロードしてます<br>
<a href="http://www.slideshare.net/YoshinoriImajo/ios7-30039408" class="autolink" rel="nofollow noopener" target="_blank">http://www.slideshare.net/YoshinoriImajo/ios7-30039408</a></p>

<h2>
<span id="設定が反映されるviewについて" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E3%81%8C%E5%8F%8D%E6%98%A0%E3%81%95%E3%82%8C%E3%82%8Bview%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>設定が反映されるviewについて</h2>

<p>Adjust Scroll View InsetsやUnder Top Barsは設定したViewController直下のviewにだけ効果があると思っていましたが、直下のviewに対してaddしたview（view.subviews[0]）についても設定が反映されるようです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>385</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/419c3f71d2bd89ff6e04">iOSアプリ開発をする自分が始めたばかりの頃から何度も読みなおしてる本</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-29 13:07:22</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> <b>[Books]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOSについては環境の進化が速く、書籍の内容が古くなっていることがほとんどなのですが<a href="http://takiguchi0817.github.io/blog/2013/09/28/android-books/" rel="nofollow noopener" target="_blank"><br>
Android開発を始めたばかりの僕が読みたかった本</a>が面白かったので自分も似たようなことを書いておきます。</p>

<h2>
<span id="詳解-objective-c-20" class="fragment"></span><a href="#%E8%A9%B3%E8%A7%A3-objective-c-20"><i class="fa fa-link"></i></a>詳解 Objective-C 2.0</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4797368276/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4797368276&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/c63d0db14deefaf2c86528cb5bb8bd9dd3f8cc64/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343739373336383237362e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4797368276.09.MZZZZZZZ.jpg"><br>
</a></p>

<p>Objective-Cのメモリ管理の仕組みであるリファレンスカウンタについて理解するために購入。現在発売中の第3版ではARCについても記載されているので最新のものを買うのが良いです。</p>

<p>Objective-Cの特徴であるカテゴリやプロトコル、KVOについても詳細に記載されているので何度も読み返すことになると思います。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4797368276/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4797368276&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: 詳解 Objective-C 2.0 第3版</a><a href="https://camo.qiitausercontent.com/cd9c03d989b3383948663553475dfda50b36496c/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34373937333638323736" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/cd9c03d989b3383948663553475dfda50b36496c/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34373937333638323736" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4797368276"></a></p>

<h2>
<span id="ios開発におけるパターンによるオートマティズム" class="fragment"></span><a href="#ios%E9%96%8B%E7%99%BA%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AB%E3%82%88%E3%82%8B%E3%82%AA%E3%83%BC%E3%83%88%E3%83%9E%E3%83%86%E3%82%A3%E3%82%BA%E3%83%A0"><i class="fa fa-link"></i></a>iOS開発におけるパターンによるオートマティズム</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4861007348/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4861007348&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/a5d967445587729601e18ceb191ebadb96becfc7/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343836313030373334382e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4861007348.09.MZZZZZZZ.jpg"><br>
</a></p>

<p>マイナビで<a href="http://news.mynavi.jp/author/0000204/" rel="nofollow noopener" target="_blank">iPhoneアプリ開発の連載</a>を持たれていた<a href="http://hmdt.jp/" rel="nofollow noopener" target="_blank">HMDTさん</a>の書かれた本です。</p>

<p>UIやメモリ管理、実際のモデル設計など盛りだくさんの内容で、メモリ管理の話題ではP94のsetterの実装についての内容が自分にとっては勉強になりました。UITableViewなどで使われるdataSourceやdelegateはそもそもなぜそのような手法なのか、など他の本では取り扱わない事柄に触れていて珍しい一冊です。</p>

<p>ただ、本書に書かれている内容は、設計手法やコードの記述に癖が強く、複数人の開発でこの流儀をそのまま持ってこられるのは反発を招くことがあります。たとえばプロトコルの文法を使わずNSObjectへのカテゴリ追加でまかなうという非形式プロトコルを使っている点については、個人で把握できる範囲内の規模の開発だけなら良いですが、そうでない場合そのまま真似してしまうのはデメリットのほうが多いでしょう。</p>

<p>また、2011年の発売でARC以前のコードなので、今は惜しい感じになってます。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4861007348/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4861007348&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: iOS開発におけるパターンによるオートマティズム</a><a href="https://camo.qiitausercontent.com/086a3ccdbc9a25283b34629891df39effd7ff2fd/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383631303037333438" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/086a3ccdbc9a25283b34629891df39effd7ff2fd/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383631303037333438" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4861007348"></a></p>

<h2>
<span id="iphoneプログラミングuikit詳解リファレンス" class="fragment"></span><a href="#iphone%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0uikit%E8%A9%B3%E8%A7%A3%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>iPhoneプログラミングUIKit詳解リファレンス</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4897978440/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4897978440&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/0805091c86399621a721353daf8328fbff87bc24/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343839373937383434302e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4897978440.09.MZZZZZZZ.jpg"><br>
</a></p>

<p>UIKitについて書かれたかなり詳しい本で、iPhoneアプリ開発の現場では机の上に最もよく見かけた本です。リファレンスとしてあの部品の使い方ってどうやるんだろうという時に役に立ちました。例えばピッカーの使い方はネットで調べるより本で読んだほうがまとまっていて良いですね。</p>

<p>ただ、2010年ぐらいの本なのでiOS7用に書きなおして貰えると最高なんですが…</p>

<p><a href="http://www.amazon.co.jp/gp/product/4897978440/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4897978440&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: iPhoneプログラミングUIKit詳解リファレンス</a><a href="https://camo.qiitausercontent.com/c83bac8ed355070cdba965944d54d749284ca49d/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383937393738343430" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c83bac8ed355070cdba965944d54d749284ca49d/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383937393738343430" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4897978440"></a></p>

<h2>
<span id="iphoneアプリ設計の極意-思わずタップしたくなるアプリのデザイン" class="fragment"></span><a href="#iphone%E3%82%A2%E3%83%97%E3%83%AA%E8%A8%AD%E8%A8%88%E3%81%AE%E6%A5%B5%E6%84%8F-%E6%80%9D%E3%82%8F%E3%81%9A%E3%82%BF%E3%83%83%E3%83%97%E3%81%97%E3%81%9F%E3%81%8F%E3%81%AA%E3%82%8B%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>iPhoneアプリ設計の極意 ―思わずタップしたくなるアプリのデザイン</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4873115027/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4873115027&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/4e3e900ca1d9538ea8073a17f77584bf30d4646b/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343837333131353032372e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4873115027.09.MZZZZZZZ.jpg"><br>
</a></p>

<p>iOSアプリはUIの魅力がその良さの9割を決めてしまうらしいのですが、洗練されたUIとは何か、他のアプリはどのようにしてUIを決めているのかという事が書かれています。</p>

<p>デザインという大枠だけではなく、ウインドウを閉じるボタン、アプリ内に表示する用語、チュートリアルなどについて心理学、文化、人間工学の視点から語られていて興味深く読めます。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4873115027/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4873115027&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: iPhoneアプリ設計の極意 ―思わずタップしたくなるアプリのデザイン</a><a href="https://camo.qiitausercontent.com/685d3b05bc3506f48154888459c214534a01fd36/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383733313135303237" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/685d3b05bc3506f48154888459c214534a01fd36/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383733313135303237" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4873115027"></a></p>

<h2>
<span id="インターフェースデザインの実践教室" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%81%AE%E5%AE%9F%E8%B7%B5%E6%95%99%E5%AE%A4"><i class="fa fa-link"></i></a>インターフェースデザインの実践教室</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4873116082/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4873116082&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/fd6a86983a5b55a3b2dbb679a7e1d42d9cea0a80/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343837333131363038322e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4873116082.09.MZZZZZZZ.jpg"><br>
</a></p>

<p>心理学などの観点から使いやすいUIについてさらに知りたくなったら、インターフェースデザインについての専門書を読むのがお勧めです。</p>

<p>最近発売されたインターフェースデザインの実践教室では、iOSにかぎらず使いやすいUIで優れたUXを提供するための「リサーチ」「デザイン」「インプリメンテーション」というフェーズで分かりやすく書かれています。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4873116082/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4873116082&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: インタフェースデザインの実践教室 ―優れたユーザビリティを実現するアイデアとテクニック</a><a href="https://camo.qiitausercontent.com/d1261ba5c54e15ffb09cc12b51f5cc13a94c71e2/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383733313136303832" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d1261ba5c54e15ffb09cc12b51f5cc13a94c71e2/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383733313136303832" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4873116082"></a></p>

<h1>
<span id="高速な動作をさせたくなったり無駄のないコードを書きたくなったら" class="fragment"></span><a href="#%E9%AB%98%E9%80%9F%E3%81%AA%E5%8B%95%E4%BD%9C%E3%82%92%E3%81%95%E3%81%9B%E3%81%9F%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E3%82%8A%E7%84%A1%E9%A7%84%E3%81%AE%E3%81%AA%E3%81%84%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8D%E3%81%9F%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E3%82%89"><i class="fa fa-link"></i></a>高速な動作をさせたくなったり、無駄のないコードを書きたくなったら</h1>

<p>ここから先は作成したアプリケーションをフラストレーションなく動作させたくなったり、さらに深く知りたくなった人用の書籍についてです。</p>

<h2>
<span id="ios-sdk-hacks-プロが教えるiphoneアプリ開発テクニック" class="fragment"></span><a href="#ios-sdk-hacks-%E3%83%97%E3%83%AD%E3%81%8C%E6%95%99%E3%81%88%E3%82%8Biphone%E3%82%A2%E3%83%97%E3%83%AA%E9%96%8B%E7%99%BA%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>iOS SDK Hacks ―プロが教えるiPhoneアプリ開発テクニック</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4873114721/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4873114721&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/12a7a21103c372095fcddcdb911bb4a2775c93d2/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343837333131343732312e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4873114721.09.MZZZZZZZ.jpg"><br>
</a></p>

<p>Method SwizzlingやrespondesToSelectorメソッドをフックするコードなどHackと呼ぶにふさわしい内容が書かれています。iOSアプリ開発者の机の上には結構な確率で置いてある本ですね。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4873114721/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4873114721&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: iOS SDK Hacks ―プロが教えるiPhoneアプリ開発テクニック</a><a href="https://camo.qiitausercontent.com/7f94d1fb3b686278e5312b21c70efad93f809ec4/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383733313134373231" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7f94d1fb3b686278e5312b21c70efad93f809ec4/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383733313134373231" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4873114721"></a></p>

<h2>
<span id="エキスパートobjective-cプログラミング--iosos-xのメモリ管理とマルチスレッド" class="fragment"></span><a href="#%E3%82%A8%E3%82%AD%E3%82%B9%E3%83%91%E3%83%BC%E3%83%88objective-c%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0--iosos-x%E3%81%AE%E3%83%A1%E3%83%A2%E3%83%AA%E7%AE%A1%E7%90%86%E3%81%A8%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>エキスパートObjective-Cプログラミング -iOS/OS Xのメモリ管理とマルチスレッド</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4844331094/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4844331094&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/55e24443d91e9495df7c54e0d555dadeb102249f/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343834343333313039342e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4844331094.09.MZZZZZZZ.jpg"><br>
</a></p>

<p>Objective-Cへ新たに追加されたARCやBlocks、GCDについて詳しく書かれています。序盤のメモリ管理についての項目が例がありObjective-C初心者寄りなので、始めたばかりの人はこの本の序盤をまず読むのが良いかもしれません。</p>

<p>GCDについては同期/非同期、キュー、dispatch系の関数の細かな使い分けが詳細に書かれている点や、所々にあるコラムが言語の歴史的経緯について記載されているところがとても良いです。BlocksについてはBlocks自身の実装について書かれているので、Blocksを使う上での制限を理解することに役立ちます。</p>

<p>ただ、文章のわかり辛い点を図が効果的に説明していない事があって惜しいところです。例えば強い参照、弱い参照は文字でわかり辛いのを補足するのであれば、図中の文字で強い/弱いを記載するのではなく、図自身で強弱を示して比較するようにしたほうがいいんじゃないかなと思いました（また、図が必要以上に大きい気がしてこなれていない感があるところが気になります）。</p>

<p><a href="http://tatsu-zine.com/" rel="nofollow noopener" target="_blank">達人出版会</a>で電子書籍版も出ていますが、私は電子書籍版も買っていて、自宅のソファでは紙の本で、事務所では電子書籍で読むような使い方をしています。電子書籍版は更新されているようで内容が増えていて素晴らしいです。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4844331094/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4844331094&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: エキスパートObjective-Cプログラミング －iOS/OS Xのメモリ管理とマルチスレッド－</a><a href="https://camo.qiitausercontent.com/748f7ef146a0a7655a149ca94434feb37a4f6aec/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383434333331303934" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/748f7ef146a0a7655a149ca94434feb37a4f6aec/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383434333331303934" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4844331094"></a></p>

<h1>
<span id="番外-プログラミングについてさらに詳しく知りたくなったら" class="fragment"></span><a href="#%E7%95%AA%E5%A4%96-%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%95%E3%82%89%E3%81%AB%E8%A9%B3%E3%81%97%E3%81%8F%E7%9F%A5%E3%82%8A%E3%81%9F%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E3%82%89"><i class="fa fa-link"></i></a>番外: プログラミングについてさらに詳しく知りたくなったら</h1>

<h2>
<span id="エキスパートcプログラミング知られざるcの深層" class="fragment"></span><a href="#%E3%82%A8%E3%82%AD%E3%82%B9%E3%83%91%E3%83%BC%E3%83%88c%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E7%9F%A5%E3%82%89%E3%82%8C%E3%81%96%E3%82%8Bc%E3%81%AE%E6%B7%B1%E5%B1%A4"><i class="fa fa-link"></i></a>エキスパートCプログラミング―知られざるCの深層</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4756116396/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4756116396&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/997b778733172692300cadca5a84de30157b1d07/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343735363131363339362e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4756116396.09.MZZZZZZZ.jpg"><br>
</a></p>

<p>Objective-Cでプログラミングしていても、根本はC言語であり開発時にはポインタ、スタティックリンク、ヒープやセグメントなどといった用語を目にすることも多いと思います。</p>

<p>本書はそういった内容を歴史的経緯から説明していて、かなり軽い口調で書かれているので読みやすく、あれってそういう意味だったのかと思うことが多いでしょう。</p>

<p>また、ライブラリのリンクについてもページを割いているので、Xcodeが出すライブラリに関するビルドエラーについてもなんとなくわかってくるのではないかと思います。</p>

<p>初版は1996年に発行されたものなので、最近ではほとんど売ってないため本屋で見つけたら即買いの一冊です。この本にかぎらず、古い良書は技術書も揃う大型書店よりも大型電気店の技術書コーナーなどにひっそりとあったりしますので確認してみると良いでしょう。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4756116396/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4756116396&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: エキスパートCプログラミング―知られざるCの深層 (Ascii books)</a><a href="https://camo.qiitausercontent.com/fc92269d4b26cc9a6aefc396535f49f7e4a8c25b/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34373536313136333936" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/fc92269d4b26cc9a6aefc396535f49f7e4a8c25b/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34373536313136333936" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4756116396"></a></p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>ARCやBlocksなどの比較的新しい技術によって、本屋に並んでいるiOS関連書籍は選ぶのが難しいのですが、今でも読み返す本を選んでみました。</p>

<p>また、iOS7の登場でUIKitに関する書籍は定番がなくなっているので、新たな定番本が出てくるのが待ち遠しいところです。著者の皆さんには頑張っていい本を作っていただけることを期待してます。</p>

<p>追記：他にも最近はこういう本がいいよというのがありましたらコメントやメールで教えて頂ければと思います！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>263</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/a7ed557d382077498181">iOS7からのUITabBarのデザインのカスタマイズまとめ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-11 12:51:05</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOS7から変わったUITabBarのデザインよりのカスタマイズについて。と言ってもレンダリングモードだけiOS7からなのでそこだけ注意すればいい。</p>

<h2>
<span id="uitabbarのテキストフォントとカラーを変更する" class="fragment"></span><a href="#uitabbar%E3%81%AE%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88%E3%81%A8%E3%82%AB%E3%83%A9%E3%83%BC%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>UITabBarのテキストフォントとカラーを変更する</h2>

<p>appearanceのsetTitleTextAttributes:forStateメソッドを使う。タブバーの画像はデフォルト。</p>

<p><a href="https://camo.qiitausercontent.com/27335874ac1ab819d87080c0cacc180dc89b66ba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f65303863363261382d626164312d326536302d313933352d3861623161313930623737612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/27335874ac1ab819d87080c0cacc180dc89b66ba/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f65303863363261382d626164312d326536302d313933352d3861623161313930623737612e706e67" alt="スクリーンショット 2013-11-11 10.21.54.png" title="スクリーンショット 2013-11-11 10.21.54.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/e08c62a8-bad1-2e60-1935-8ab1a190b77a.png"></a></p>

<p>選択中が赤色、他は非選択（通常時）の青色を設定。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span>
<span class="bp">UIFont</span> <span class="o">*</span><span class="n">font</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIFont</span> <span class="nl">fontWithName</span><span class="p">:</span><span class="s">@"HelveticaNeue-Bold"</span> <span class="nl">size</span><span class="p">:</span><span class="mf">10.0f</span><span class="p">];</span>
 <span class="c1">//タブ選択時のフォントとカラー</span>
<span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">selectedAttributes</span> <span class="o">=</span> <span class="l">@{</span><span class="nl">NSFontAttributeName</span> <span class="p">:</span> <span class="n">font</span><span class="p">,</span>
                                      <span class="nl">NSForegroundColorAttributeName</span> <span class="p">:</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">redColor</span><span class="p">]</span><span class="l">}</span><span class="p">;</span>

<span class="p">[[</span><span class="bp">UITabBarItem</span> <span class="n">appearance</span><span class="p">]</span> <span class="nl">setTitleTextAttributes</span><span class="p">:</span><span class="n">selectedAttributes</span>
                                         <span class="nl">forState</span><span class="p">:</span><span class="n">UIControlStateSelected</span><span class="p">];</span>

<span class="c1">//通常時のフォントとカラー</span>
<span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">attributesNormal</span> <span class="o">=</span> <span class="l">@{</span><span class="nl">NSFontAttributeName</span> <span class="p">:</span> <span class="n">font</span><span class="p">,</span>
                                    <span class="nl">NSForegroundColorAttributeName</span> <span class="p">:</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">blueColor</span><span class="p">]</span><span class="l">}</span><span class="p">;</span>

<span class="p">[[</span><span class="bp">UITabBarItem</span> <span class="n">appearance</span><span class="p">]</span> <span class="nl">setTitleTextAttributes</span><span class="p">:</span><span class="n">attributesNormal</span>
                                         <span class="nl">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
</pre></div></div>

<h2>
<span id="uitabbarの画像を作成する" class="fragment"></span><a href="#uitabbar%E3%81%AE%E7%94%BB%E5%83%8F%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>UITabBarの画像を作成する</h2>

<p>i0S7になっても変わらず画像は30x30px（Ratina 60x60px)で作成する。このサイズはドキュメントで決められたサイズではないのか公式の記述がないのでだいたいこんなもんだろうという感じだと思う。</p>

<p>元画像は <a href="http://icons8.com/free-ios-7-icons-in-vector/" class="autolink" rel="nofollow noopener" target="_blank">http://icons8.com/free-ios-7-icons-in-vector/</a> のサイトのpng画像を使った例（brickというキューブな画像を適用）。</p>

<p><a href="https://camo.qiitausercontent.com/0693d33f7ba836aa4c6c9fdeefc9c69d550ae5f7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f65323936613833332d386130392d333265322d363639302d3261323339313836393933632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0693d33f7ba836aa4c6c9fdeefc9c69d550ae5f7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f65323936613833332d386130392d333265322d363639302d3261323339313836393933632e706e67" alt="名称未設定.png" title="名称未設定.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/e296a833-8a09-32e2-6690-2a239186993c.png"></a></p>

<p>画像の作りとして、brickをダウンロードして見ればわかるが、黒色(#000)の線のみで作られた画像がデフォルトでは選択時は薄い青っぽくなり、非選択時（通常時）は灰色になる。</p>

<h3>
<span id="選択時の色を変える" class="fragment"></span><a href="#%E9%81%B8%E6%8A%9E%E6%99%82%E3%81%AE%E8%89%B2%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>選択時の色を変える</h3>

<p>選択時の色を替える場合はtintColorを変更するだけ</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="bp">UITabBar</span> <span class="n">appearance</span><span class="p">]</span> <span class="nl">setTintColor</span><span class="p">:[</span><span class="bp">UIColor</span> <span class="n">greenColor</span><span class="p">]];</span>
</pre></div></div>

<p>tintColor原色緑を指定すると薄い緑になる。これはレンダリングモードが画像をテンプレートとして使用しているからだろうと思う。</p>

<p><a href="https://camo.qiitausercontent.com/720007b838394d175206991d2b0be1351a53fecf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61613466363863662d623865622d313666312d396464352d6639623337633034633538632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/720007b838394d175206991d2b0be1351a53fecf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61613466363863662d623865622d313666312d396464352d6639623337633034633538632e706e67" alt="スクリーンショット 2013-11-11 11.22.04.png" title="スクリーンショット 2013-11-11 11.22.04.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/aa4f68cf-b8eb-16f1-9dd5-f9b37c04c58c.png"></a></p>

<p>iOS7からレンダリングモードはUIImageで設定するようになった。画像をテンプレートとしてマスクして使っている。</p>

<p>AppleのiOS7移行ガイド日本語訳参照<br>
<a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/UserExperience/Conceptual/TransitionGuide/Bars/Bars.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/jp/devcenter/ios/library/documentation/UserExperience/Conceptual/TransitionGuide/Bars/Bars.html</a></p>

<h3>
<span id="画像をそのまま表示したい" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E3%82%92%E3%81%9D%E3%81%AE%E3%81%BE%E3%81%BE%E8%A1%A8%E7%A4%BA%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>画像をそのまま表示したい</h3>

<p>画像をそのまま使う場合、レンダリングモードをオリジナルにする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>UIImage *image = [[UIImage imageNamed:@"brick"] imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal];

item.selectedImage = image;
</pre></div></div>

<p>ちょっとわかりづらいのは、RenderingModeはオブジェクトのプロパティで自由に設定変更できるわけではなく、設定したらUIImageを再生成するところ。UIImageのインスタンスに対してimageWithRenderingMode:メソッドで生成した戻り値がモードの変更されたUIImageになっているのでそれを利用する。</p>

<p><a href="https://camo.qiitausercontent.com/7907fc3ca393241dd11666afcf569aa237a8187d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f33336466306130612d636564642d336161612d616562312d3266323738636338303962622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7907fc3ca393241dd11666afcf569aa237a8187d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f33336466306130612d636564642d336161612d616562312d3266323738636338303962622e706e67" alt="スクリーンショット 2013-11-11 11.44.36.png" title="スクリーンショット 2013-11-11 11.44.36.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/33df0a0a-cedd-3aaa-aeb1-2f278cc809bb.png"></a></p>

<p>レンダリングモードをオリジナルにすると画像をそのまま使う。brickの画像はこのような黒い線で構成される画像だったのでそのまま表示される。</p>

<h2>
<span id="uitabbarの背景を変更したい" class="fragment"></span><a href="#uitabbar%E3%81%AE%E8%83%8C%E6%99%AF%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>UITabBarの背景を変更したい</h2>

<h3>
<span id="背景色を指定する" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF%E8%89%B2%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>背景色を指定する</h3>

<p>barTintColorを設定することでバー自体の色を変更できる。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">[</span><span class="bp">UITabBar</span> <span class="n">appearance</span><span class="p">].</span><span class="n">barTintColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">brownColor</span><span class="p">];</span>
</pre></div></div>

<p>ブラウンカラーに設定する</p>

<p><a href="https://camo.qiitausercontent.com/235ec88ca442f991c1fa9511e08ed0c465ab0e15/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f63666430396632652d386164622d663965662d356539362d3735313037303366396165642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/235ec88ca442f991c1fa9511e08ed0c465ab0e15/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f63666430396632652d386164622d663965662d356539362d3735313037303366396165642e706e67" alt="bar.png" title="bar.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/cfd09f2e-8adb-f9ef-5e96-7510703f9aed.png"></a></p>

<p>iOS7からbarTintColorに従って半透明になっていたが、iOS7.0.3からbarTintColorを設定すると半透明にならなくなったので、どうしても半透明にしたければUIColor自身に透明度を指定する (<a href="http://qiita.com/yimajo/items/4781d5d2712e34677db2" class="autolink" id="reference-94dcdb8b6f4e4bbed0ef">http://qiita.com/yimajo/items/4781d5d2712e34677db2</a> )。</p>

<h3>
<span id="背景画像を変更する" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF%E7%94%BB%E5%83%8F%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>背景画像を変更する</h3>

<p>背景画像は320x49px (Ratina 640x96px)の画像を用意し、backgroundImageに設定する。iOS7になってもこの部分は変わってない。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">[</span><span class="bp">UITabBar</span> <span class="n">appearance</span><span class="p">].</span><span class="n">backgroundImage</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@"tab_background"</span><span class="p">];</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/e1a88a34b3334838bef59ae900115d82254d8db8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38613561613432322d356335322d653336632d636233312d3865666134303136663335662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e1a88a34b3334838bef59ae900115d82254d8db8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38613561613432322d356335322d653336632d636233312d3865666134303136663335662e706e67" alt="tab.png" title="tab.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/8a5aa422-5c52-e36c-cb31-8efa4016f35f.png"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>253</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/e38e8bafc17144b7af79">画像処理のデファクトスタンダードライブラリGPUImageの基本と応用</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-14 01:45:46</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOSアプリ開発で高速に写真や動画にエフェクトを加える事が出来る<a href="https://github.com/BradLarson/GPUImage" rel="nofollow noopener" target="_blank">GPUImage</a>の基本的なパターンと応用方法を理解するためのメモ。</p>

<p>GPUImageライブラリはOpenGL ES2.0をベースとしているため、大抵の場合は処理にCPUを使った場合よりも高速な動作が特徴。その上、複雑な概念を理解する必要があるOpenGLについて知る必要はなく、さらにカメラのためのAVFoundationのフレームワークを触る必要もない。</p>

<p>これはもう画像処理やカメラアプリに使わない理由がないんだけど案外日本語の説明がなかったので調べて行った過程とフィルタの作成方法についてを書いてみた。構成は下記の通り。</p>

<ol>
<li>GPUImageの基本パターン

<ol>
<li>用意した静止画像へのフィルタ適用で基本パターンを解説。</li>
<li>カメラでのリアルタイムフィルタリング利用のための基本パターン解説</li>
</ol>
</li>
<li>GPUImageの応用

<ol>
<li>複数フィルタを重ねがけする</li>
<li>オリジナルのフィルタを作るための方法</li>
<li>オリジナルフィルタをプログラマブルに調整するための解説</li>
</ol>
</li>
</ol>

<h2>
<span id="gpuimageの基本パターン" class="fragment"></span><a href="#gpuimage%E3%81%AE%E5%9F%BA%E6%9C%AC%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>GPUImageの基本パターン</h2>

<p>静止画像とカメラ動画へのエフェクトの適用（フィルタリング）の基本パターンを<a href="https://github.com/BradLarson/GPUImage/tree/master/examples/iOS" rel="nofollow noopener" target="_blank">GPUImageのリポジトリにあるiOSのデモ</a>のコードをベースに解説する。</p>

<h3>
<span id="gpuimageの基本パターン-静止画像にフィルタリング" class="fragment"></span><a href="#gpuimage%E3%81%AE%E5%9F%BA%E6%9C%AC%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3-%E9%9D%99%E6%AD%A2%E7%94%BB%E5%83%8F%E3%81%AB%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>GPUImageの基本パターン: 静止画像にフィルタリング</h3>

<p><a href="https://github.com/BradLarson/GPUImage/tree/master/examples/iOS/SimpleImageFilter" rel="nofollow noopener" target="_blank">GitHubにあるデモプロジェクトSimpleImageFilter</a>では、プロジェクト内に用意された画像ファイル"WID-small.jpg"に対してフィルタリングしている。</p>

<p>WID-small.jpgはこんな感じの写真</p>

<p><a href="https://camo.qiitausercontent.com/d55394f5b5f1bbed4798c11181a742b0ec6efdf7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f66316132626336352d656661322d343538352d353032312d6466646163356439383964332e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d55394f5b5f1bbed4798c11181a742b0ec6efdf7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f66316132626336352d656661322d343538352d353032312d6466646163356439383964332e6a706567" alt="WID-small.jpeg" title="WID-small.jpeg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/f1a2bc65-efa2-4585-5021-dfdac5d989d3.jpeg"></a></p>

<p>デモプロジェクトではフィルタリングにSobelフィルタを使っていて、輪郭抽出を行っている。</p>

<p><a href="https://camo.qiitausercontent.com/9f35f55a5d23471ffa4be07ede8c1a0f3b85accf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61373166643562312d306261302d396136352d623832652d3130613064323861663434632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9f35f55a5d23471ffa4be07ede8c1a0f3b85accf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61373166643562312d306261302d396136352d623832652d3130613064323861663434632e706e67" alt="スクリーンショット 2013-10-13 19.26.35.png" title="スクリーンショット 2013-10-13 19.26.35.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/a71fd5b1-0ba0-9a65-b82e-10a0d28af44c.png"></a></p>

<h4>
<span id="重要なこと" class="fragment"></span><a href="#%E9%87%8D%E8%A6%81%E3%81%AA%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>重要なこと</h4>

<p>GPUImageの静止画像フィルタリングで抑えておくべきなのは次の点のみ。</p>

<ul>
<li>GPUImagePictureクラスが元画像でそこに処理するフィルタを追加する

<ul>
<li>addTarget:メソッドでフィルタを指定</li>
</ul>
</li>
<li>GPUImageFilterクラスがフィルタになる</li>
<li>GPUImagePictureクラスを使い画像のフィルタリングを行う

<ul>
<li>processImageメソッドでフィルタリング処理を実行</li>
</ul>
</li>
<li>表示のためのViewはGPUImageViewクラスのインスタンスをつかう</li>
</ul>

<h4>
<span id="静止画フィルタリングデモのソースコードは次のようになっている" class="fragment"></span><a href="#%E9%9D%99%E6%AD%A2%E7%94%BB%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0%E3%83%87%E3%83%A2%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E6%AC%A1%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>静止画フィルタリングデモのソースコードは次のようになっている</h4>

<p>重要な事をおさえるとソースコードでやっていることが明確になるので見てみる</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupDisplayFiltering</span><span class="p">;</span>
<span class="p">{</span>
    <span class="c1">//元画像を用意</span>
    <span class="bp">UIImage</span> <span class="o">*</span><span class="n">inputImage</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@"WID-small.jpg"</span><span class="p">];</span>     
    <span class="n">sourcePicture</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImagePicture</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage</span><span class="p">:</span><span class="n">inputImage</span> <span class="nl">smoothlyScaleOutput</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>

    <span class="c1">//フィルタを用意</span>
   <span class="c1">//GPUImageFilterクラスを継承したGPUImageSobelEdgeDetectionFilterで</span>
   <span class="c1">//Sobelフィルタをインスタンス化している。</span>
    <span class="n">sobelFilter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImageSobelEdgeDetectionFilter</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

    <span class="c1">//表示するためのviewを用意。</span>
    <span class="n">GPUImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="p">(</span><span class="n">GPUImageView</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">;</span>
    <span class="p">[</span><span class="n">sobelFilter</span> <span class="nl">forceProcessingAtSize</span><span class="p">:</span><span class="n">imageView</span><span class="p">.</span><span class="n">sizeInPixels</span><span class="p">];</span>

    <span class="c1">//GPUImagePictureでフィルタを追加</span>
    <span class="p">[</span><span class="n">sourcePicture</span> <span class="nl">addTarget</span><span class="p">:</span> <span class="n">sobelFilter</span><span class="p">];</span>
    <span class="c1">//フィルタに表示すためのビューを指定</span>
    <span class="p">[</span><span class="n">sobelFilter</span> <span class="nl">addTarget</span><span class="p">:</span><span class="n">imageView</span><span class="p">];</span>

    <span class="c1">//フィルタリング処理を実行</span>
    <span class="p">[</span><span class="n">sourcePicture</span> <span class="n">processImage</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<h3>
<span id="gpuimageの基本パターン-動画フィルタリング" class="fragment"></span><a href="#gpuimage%E3%81%AE%E5%9F%BA%E6%9C%AC%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3-%E5%8B%95%E7%94%BB%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>GPUImageの基本パターン: 動画フィルタリング</h3>

<p><a href="https://github.com/BradLarson/GPUImage/tree/master/examples/iOS/SimpleVideoFilter" rel="nofollow noopener" target="_blank">GitHubにあるSimpleVideoFilter</a>を使い、次はリアルタイムにカメラで撮影した動画にエフェクトを加えるコードを解説する。</p>

<h4>
<span id="重要なこと-1" class="fragment"></span><a href="#%E9%87%8D%E8%A6%81%E3%81%AA%E3%81%93%E3%81%A8-1"><i class="fa fa-link"></i></a>重要なこと</h4>

<p>動画でのフィルタリングは静止画像とほぼ同じ。</p>

<ul>
<li>GPUImageVideoCameraクラスが元動画で処理するフィルタを追加する

<ul>
<li>addTarget:メソッドでフィルタを指定</li>
</ul>
</li>
<li>GPUImageFilterクラスがフィルタになる</li>
<li>GPUImageVideoCameraクラスを使い撮影とフィルタリングを行う

<ul>
<li>startCameraCaptureメソッドで撮影とフィルタリング処理を開始</li>
</ul>
</li>
<li>表示のためのViewはGPUImageViewクラスのインスタンスをつかう</li>
</ul>

<h4>
<span id="動画フィルタリングデモのコードは次のようになっている" class="fragment"></span><a href="#%E5%8B%95%E7%94%BB%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0%E3%83%87%E3%83%A2%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E6%AC%A1%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>動画フィルタリングデモのコードは次のようになっている</h4>

<p>重要な事を抑えた上でソースコードを見る。動画撮影では静止画像と比較してカメラ設定が細かいのが分かる。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
    <span class="c1">//カメラの設定</span>
    <span class="n">videoCamera</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImageVideoCamera</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithSessionPreset</span><span class="p">:</span><span class="n">AVCaptureSessionPreset640x480</span> <span class="nl">cameraPosition</span><span class="p">:</span><span class="n">AVCaptureDevicePositionBack</span><span class="p">];</span>
    <span class="n">videoCamera</span><span class="p">.</span><span class="n">outputImageOrientation</span> <span class="o">=</span> <span class="n">UIInterfaceOrientationPortrait</span><span class="p">;</span>
    <span class="n">videoCamera</span><span class="p">.</span><span class="n">horizontallyMirrorFrontFacingCamera</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="n">videoCamera</span><span class="p">.</span><span class="n">horizontallyMirrorRearFacingCamera</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>

    <span class="c1">//フィルタのカメラへの追加</span>
    <span class="n">filter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImageSepiaFilter</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">videoCamera</span> <span class="nl">addTarget</span><span class="p">:</span><span class="n">filter</span><span class="p">];</span>
    <span class="c1">//表示用ビューの追加</span>
    <span class="n">GPUImageView</span> <span class="o">*</span><span class="n">filterView</span> <span class="o">=</span> <span class="p">(</span><span class="n">GPUImageView</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">;</span>
    <span class="p">[</span><span class="n">filter</span> <span class="nl">addTarget</span><span class="p">:</span><span class="n">filterView</span><span class="p">];</span>
    <span class="c1">//撮影とフィルタリングの開始</span>
    <span class="p">[</span><span class="n">videoCamera</span> <span class="n">startCameraCapture</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<h3>
<span id="基本パターンおさらい" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%8A%E3%81%95%E3%82%89%E3%81%84"><i class="fa fa-link"></i></a>基本パターンおさらい</h3>

<p>基本パターンのおさらいをすると、静止画ならGPUImagePictureを使い、カメラならGPUImageVideoCameraを使うだけの違いになっている。</p>

<ul>
<li>GPUImagePicture/GPUImageVideoCameraクラスが元画像でそこに処理するフィルタを追加する

<ul>
<li>addTarget:メソッドでフィルタを指定</li>
</ul>
</li>
<li>GPUImageFilterクラスがフィルタになる</li>
<li>GPUImagePicture/GPUImageVideoCameraクラスを使い画像のフィルタリングを行う

<ul>
<li>processImage/startCameraCaptureメソッドでフィルタリング処理を実行</li>
</ul>
</li>
<li>表示のためのViewはGPUImageViewクラスのインスタンスをつかう</li>
</ul>

<p>とても使いやすいライブラリってことがわかる。</p>

<h2>
<span id="gpuimageの応用" class="fragment"></span><a href="#gpuimage%E3%81%AE%E5%BF%9C%E7%94%A8"><i class="fa fa-link"></i></a>GPUImageの応用</h2>

<h3>
<span id="gpuimageの応用-複数フィルタを重ねがけする" class="fragment"></span><a href="#gpuimage%E3%81%AE%E5%BF%9C%E7%94%A8-%E8%A4%87%E6%95%B0%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%82%92%E9%87%8D%E3%81%AD%E3%81%8C%E3%81%91%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>GPUImageの応用: 複数フィルタを重ねがけする</h3>

<p>複数フィルタを重ねがけすることでより複雑なフィルタを作成することが出来る。例として最初に用いたエッジ検出された静止画像にセピア化させるフィルタで説明する。</p>

<p><a href="https://camo.qiitausercontent.com/fcf4f1b0f2c7a545bfd9674f227df393e18dc525/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f33343962313361622d643336372d346164302d633330662d3537666134343530393730302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/fcf4f1b0f2c7a545bfd9674f227df393e18dc525/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f33343962313361622d643336372d346164302d633330662d3537666134343530393730302e706e67" alt="スクリーンショット 2013-10-13 21.48.31.png" title="スクリーンショット 2013-10-13 21.48.31.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/349b13ab-d367-4ad0-c30f-57fa44509700.png"></a></p>

<h4>
<span id="重要なこと-2" class="fragment"></span><a href="#%E9%87%8D%E8%A6%81%E3%81%AA%E3%81%93%E3%81%A8-2"><i class="fa fa-link"></i></a>重要なこと</h4>

<ul>
<li>複数フィルタはGPUImageFilterGroupクラスに追加</li>
<li>複数フィルタはフィルタリングする順序でフィルタ同士ターゲット追加

<ul>
<li>エッジ検出したあとでセピア色にするならエッジにセピアを追加</li>
</ul>
</li>
</ul>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
    <span class="c1">//元画像を用意</span>
    <span class="bp">UIImage</span> <span class="o">*</span><span class="n">inputImage</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@"WID-small.jpg"</span><span class="p">];</span> 
    <span class="n">sourcePicture</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImagePicture</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage</span><span class="p">:</span><span class="n">inputImage</span> <span class="nl">smoothlyScaleOutput</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>

    <span class="c1">//フィルタ用意</span>
    <span class="n">GPUImageSobelEdgeDetectionFilter</span> <span class="o">*</span><span class="n">sobelFilter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImageSobelEdgeDetectionFilter</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="n">GPUImageSepiaFilter</span> <span class="o">*</span><span class="n">sepiaImageFilter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImageSepiaFilter</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

    <span class="c1">//フィルタグループを作ってそこに追加していく</span>
    <span class="n">GPUImageFilterGroup</span> <span class="o">*</span><span class="n">filterGroup</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImageFilterGroup</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">filterGroup</span> <span class="nl">addFilter</span><span class="p">:</span><span class="n">sobelFilter</span><span class="p">];</span>
    <span class="p">[</span><span class="n">filterGroup</span> <span class="nl">addFilter</span><span class="p">:</span><span class="n">sepiaImageFilter</span><span class="p">];</span>
    <span class="p">[</span><span class="n">filterGroup</span> <span class="nl">setInitialFilters</span><span class="p">:</span><span class="l">@[</span><span class="n">sobelFilter</span><span class="l">]</span><span class="p">];</span>
    <span class="p">[</span><span class="n">filterGroup</span> <span class="nl">setTerminalFilter</span><span class="p">:</span><span class="n">sepiaImageFilter</span><span class="p">];</span>

    <span class="c1">//フィルタはフィルタ同士追加していく</span>
    <span class="p">[</span><span class="n">sobelFilter</span> <span class="nl">addTarget</span><span class="p">:</span><span class="n">sepiaImageFilter</span><span class="p">];</span>

    <span class="c1">//表示するためのviewを用意</span>
    <span class="n">GPUImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="p">(</span><span class="n">GPUImageView</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">;</span>
    <span class="p">[</span><span class="n">filterGroup</span> <span class="nl">forceProcessingAtSize</span><span class="p">:</span><span class="n">imageView</span><span class="p">.</span><span class="n">sizeInPixels</span><span class="p">]</span>

    <span class="c1">//GPUImagePictureでフィルタグループ追加</span>
    <span class="p">[</span><span class="n">sourcePicture</span> <span class="nl">addTarget</span><span class="p">:</span><span class="n">filterGroup</span><span class="p">];</span>
    <span class="p">[</span><span class="n">filterGroup</span> <span class="nl">addTarget</span><span class="p">:</span><span class="n">imageView</span><span class="p">];</span>

    <span class="p">[</span><span class="n">sourcePicture</span> <span class="n">processImage</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>フィルタグループにフィルタを順番に追加することでフィルタの一元管理をしてもらいたいものだけど、元のフィルタに次のフィルタを追加する必要があるらしい。</p>

<p>これはおそらくさらに多くのフィルタがあった場合や同じフィルタかけ合わせる場合などを考慮しているためで、上記2つのフィルタだけでは冗長に見えてしまうのかもしれない。ここらへんの理由を知っている人がいたら教えて欲しい。</p>

<h3>
<span id="gpuimageの応用-オリジナルフィルタを作成する" class="fragment"></span><a href="#gpuimage%E3%81%AE%E5%BF%9C%E7%94%A8-%E3%82%AA%E3%83%AA%E3%82%B8%E3%83%8A%E3%83%AB%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>GPUImageの応用: オリジナルフィルタを作成する</h3>

<p>GPUImageには用意されたいくつかのフィルタがあるが、自前でフィルタを作ることも出来る。このオリジナルフィルタはOpenGLの頂点シェーダとフラグメントシェーダを用いて作成する。</p>

<p>これらシェーダについて大雑把に説明すると、頂点シェーダはテクスチャ位置を計算していて、フラグメントシェーダは、フラグメント（ピクセル）ごとに色を決めるための技術。2つのシェーダは"シェーディング言語 (GLSL: OpenGL Shading Language)"を使うことによって実現できる。</p>

<p>シェーダに関しては下記のサイトがとっかかりとしては最適かもしれない</p>

<p>『フラグメントシェーダー事始め』で勉強したメモ<br>
<a href="http://d.hatena.ne.jp/shu223/20130114/1358664861" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/shu223/20130114/1358664861</a></p>

<p>iOSアプリ開発の場合、シェーダはOpenGL ES2.0で使うことになるが、GPUImageは内部でそれをやってくれるので、GLSLを記述するだけで良い。</p>

<h4>
<span id="フラグメントシェーダによる赤と緑の置換フィルタ" class="fragment"></span><a href="#%E3%83%95%E3%83%A9%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%81%AB%E3%82%88%E3%82%8B%E8%B5%A4%E3%81%A8%E7%B7%91%E3%81%AE%E7%BD%AE%E6%8F%9B%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF"><i class="fa fa-link"></i></a>フラグメントシェーダによる赤と緑の置換フィルタ</h4>

<p>赤の要素が緑で、緑の要素が赤のフィルタを作る。これは色を置換しているだけなのでフラグメントシェーダだけで簡単にできる。</p>

<p><a href="https://camo.qiitausercontent.com/a70236770fc6f2a4c93a3398852c1efe945ba04c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f31633436633464352d396562332d613133632d313832392d6235343262666534393465652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a70236770fc6f2a4c93a3398852c1efe945ba04c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f31633436633464352d396562332d613133632d313832392d6235343262666534393465652e706e67" alt="スクリーンショット 2013-10-13 23.21.36.png" title="スクリーンショット 2013-10-13 23.21.36.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/1c46c4d5-9eb3-a13c-1829-b542bfe494ee.png"></a></p>

<p>実際に記述していくにはまず、シェーディング言語を記述するファイルをプロジェクトに追加する。まずは赤と緑をピクセル上で入れ替えるためのフィルターを「ColorSwapFilter.fsh」として作成しプロジェクトに追加する。</p>

<p>このファイルはGPUImageが[NSBundle mainBundle]で読み込むため、Xcodeのターゲットから「Copy Bundle Resources」でリソースとして設定する必要がある（設定しないと読み込めず例外になる）。</p>

<p>実際のコードは次のようになる。テクスチャユニット番号を保持するinputImageTextureと座標値を保持するグローバル変数textureCoordinateが登場しているが、これらはGPUImageでオリジナルフィルタを使う上でのお約束だと思おう。これらの変数を用いてtexture2D関数でピクセルごとの色を取得し、赤と緑を置き換えている。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="c1">//グローバル変数</span>
<span class="cm">/*</span>
<span class="cm">  inputImageTextureという変数名はGPUImageで指定されている。</span>
<span class="cm">  GPUImage(OpenGL)側で初期化されテクスチャ情報がサンプリングされている。</span>
<span class="cm">  uniformはシステムから渡される定数であることを示す。</span>
<span class="cm">  sampler2Dは2Dのテクスチャをサンプリングするデータ型。uniformである必要がある。 </span>
<span class="cm">*/</span>
<span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">inputImageTexture</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm">  textureCoordinateという変数名はGPUImageで指定されている。</span>
<span class="cm">  GPUImage(OpenGL)側で頂点シェーダにより座標値が書き込まれている。</span>
<span class="cm">  varyingは頂点シェーダで書き込まれていることを示す。</span>
<span class="cm">  highpは精度が高いことを示す。</span>
<span class="cm">  vec2は2Dベクトルを示す型。</span>
<span class="cm">*/</span>
<span class="n">varying</span> <span class="n">highp</span> <span class="n">vec2</span> <span class="n">textureCoordinate</span><span class="p">;</span>

<span class="c1">//エントリポイントmainはC言語とは違い戻り値は整数を返さない</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">//texture2Dを使い、指定のテクスチャユニットに対してピクセル単位で色を取得する</span>
    <span class="c1">//引数の1つ目でテクスチャユニットを指定</span>
    <span class="c1">//引数の2つ目で頂点シェーダにより指定された座標値を取得</span>
    <span class="n">lowp</span> <span class="n">vec4</span> <span class="n">textureColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">textureCoordinate</span><span class="p">);</span>
    <span class="c1">//出力するピクセルの色を設定する変数</span>
    <span class="n">lowp</span> <span class="n">vec4</span> <span class="n">outputColor</span><span class="p">;</span>
    <span class="n">outputColor</span><span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">textureColor</span><span class="p">.</span><span class="n">g</span><span class="p">;</span>  <span class="c1">//赤に緑</span>
    <span class="n">outputColor</span><span class="p">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">textureColor</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>  <span class="c1">//緑に赤</span>
    <span class="n">outputColor</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">textureColor</span><span class="p">.</span><span class="n">b</span><span class="p">;</span>  <span class="c1">//青は青</span>
    <span class="n">outputColor</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>             <span class="c1">//アルファ1.0で不透明</span>

    <span class="c1">//グローバルなgl_FragColorが出力するピクセルの色になる</span>
    <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="n">outputColor</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>次に、作成したフラグメントシェーダを読み込むコードを書く。フィルタとして何度も登場しているGPUImageFilterのinitWithFragmentShaderFromFile:メソッドでフラグメントシェーダのファイル名を指定するのみ。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">filterFromShaderFile</span>
<span class="p">{</span>
    <span class="c1">//元画像を用意</span>
    <span class="bp">UIImage</span> <span class="o">*</span><span class="n">inputImage</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@"WID-small.jpg"</span><span class="p">];</span> 
    <span class="n">sourcePicture</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImagePicture</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage</span><span class="p">:</span><span class="n">inputImage</span> <span class="nl">smoothlyScaleOutput</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>

    <span class="c1">//フィルタ用意。ColorSwapFilter.fshを読み込ませる。拡張子はいらない</span>
    <span class="n">GPUImageFilter</span> <span class="o">*</span><span class="n">filter</span> <span class="o">=</span> <span class="p">[[</span><span class="n">GPUImageFilter</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFragmentShaderFromFile</span><span class="p">:</span><span class="s">@"ColorSwapFilter"</span><span class="p">];</span>

    <span class="c1">//表示するためのviewを用意</span>
    <span class="n">GPUImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="p">(</span><span class="n">GPUImageView</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">;</span>
    <span class="p">[</span><span class="n">filter</span> <span class="nl">forceProcessingAtSize</span><span class="p">:</span><span class="n">imageView</span><span class="p">.</span><span class="n">sizeInPixels</span><span class="p">];</span> 

    <span class="c1">//フィルタを対象として追加 </span>
    <span class="p">[</span><span class="n">sourcePicture</span> <span class="nl">addTarget</span><span class="p">:</span><span class="n">filter</span><span class="p">];</span>
    <span class="p">[</span><span class="n">filter</span> <span class="nl">addTarget</span><span class="p">:</span><span class="n">imageView</span><span class="p">];</span>

    <span class="c1">//フィルタリング処理を実行</span>
    <span class="p">[</span><span class="n">sourcePicture</span> <span class="n">processImage</span><span class="p">];</span>
<span class="p">}</span>

</pre></div></div>

<p>これで実行できるはずだし、なんとなくフラグメントシェーダが分かってきたと思う。<br>
理解を深めるために、フラグメントシェーダを読み込むGPUImageFilterのinitWithFragmentShaderFromFile:メソッドを見てみると、記述しなかった頂点シェーダがデフォルトで記述されていることがわかる。</p>

<div class="code-frame" data-lang="c"><div class="highlight"><pre><span></span><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">kGPUImageVertexShaderString</span> <span class="o">=</span> <span class="n">SHADER_STRING</span>
<span class="p">(</span>
 <span class="n">attribute</span> <span class="n">vec4</span> <span class="n">position</span><span class="p">;</span>
 <span class="n">attribute</span> <span class="n">vec4</span> <span class="n">inputTextureCoordinate</span><span class="p">;</span>

 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">textureCoordinate</span><span class="p">;</span>  <span class="c1">//フラグメントシェーダに渡すxy頂点座標</span>

 <span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
 <span class="p">{</span>
     <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">position</span><span class="p">;</span> <span class="c1">//モデルビュー射影変換後の座標</span>
     <span class="n">textureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
 <span class="p">}</span>
 <span class="p">);</span>
</pre></div></div>

<p>まず、SHADER_STRING()はObjective-CのなかでGLSLを記述するマクロ。<br>
textureCoordinateはフラグメントシェーダで利用した座標値だった。デフォルトの頂点シェーダでは単に座標値をグローバル変数にセットしてフラグメントシェーダに受け渡しをしているだけだ。</p>

<h3>
<span id="gpuimageの応用-gpuimageでシェーダと値をやりとりする" class="fragment"></span><a href="#gpuimage%E3%81%AE%E5%BF%9C%E7%94%A8-gpuimage%E3%81%A7%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%81%A8%E5%80%A4%E3%82%92%E3%82%84%E3%82%8A%E3%81%A8%E3%82%8A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>GPUImageの応用: GPUImageでシェーダと値をやりとりする</h3>

<p>シェーダの記述方法は分かったが、シェーダを自在に操れないのでは変化のないフィルタとなってしまう。条件によってシェーダを微調整したいこともあるはずだろう。Objective-Cの変数とシェーディング言語上の変数（厳密には定数）で値をやりとりする場合はどのようにすればよいかは、既存のGPUImageBrightnessFilterを読むと分かる。</p>

<h4>
<span id="gpuimagebrightnessfilterを読む" class="fragment"></span><a href="#gpuimagebrightnessfilter%E3%82%92%E8%AA%AD%E3%82%80"><i class="fa fa-link"></i></a>GPUImageBrightnessFilterを読む</h4>

<p>GPUImageBrightnessFilterは明るさを調整するフィルタだ。明るさはGPUImageBrightnessFilterクラスのプロパティCGFloat brightnessを変更することで調整できるようになっている。</p>

<p>ヘッダーは次のようになっている。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="cp">#import "GPUImageFilter.h"</span>

<span class="k">@interface</span> <span class="nc">GPUImageBrightnessFilter</span> : <span class="nc">GPUImageFilter</span>
<span class="p">{</span>
    <span class="n">GLint</span> <span class="n">brightnessUniform</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Brightness ranges from -1.0 to 1.0, with 0.0 as the normal level</span>
<span class="k">@property</span><span class="p">(</span><span class="k">readwrite</span><span class="p">,</span> <span class="k">nonatomic</span><span class="p">)</span> <span class="n">CGFloat</span> <span class="n">brightness</span><span class="p">;</span> 

<span class="k">@end</span>
</pre></div></div>

<p>実装ファイルの初期化メソッドではメンバ変数brightnessUniformに対して、シェーディング言語で使う定数"brightness"のindexを渡している。indexはシェーディング言語中の変数番号であり、アクセスするためのindexになる。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span><span class="p">;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithFragmentShaderFromString</span><span class="p">:</span><span class="n">kGPUImageBrightnessFragmentShaderString</span><span class="p">]))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//メンバ変数に</span>
    <span class="n">brightnessUniform</span> <span class="o">=</span> <span class="p">[</span><span class="n">filterProgram</span> <span class="nl">uniformIndex</span><span class="p">:</span><span class="s">@"brightness"</span><span class="p">];</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">brightness</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>次に、brightnessプロパティのsetterを見るとシェーディング言語中の定数brightnessに対して、セットする値を代入している。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>- (void)setBrightness:(CGFloat)newValue;
{
    _brightness = newValue;

    [self setFloat:_brightness forUniform:brightnessUniform program:filterProgram];
}
</pre></div></div>

<p>同ファイルにはフラグメントシェーダも記述してありbrightnessを使って明度を調整していることが分かるだろう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>NSString *const kGPUImageBrightnessFragmentShaderString = SHADER_STRING
(
 varying highp vec2 textureCoordinate;

 uniform sampler2D inputImageTexture;
 uniform lowp float brightness;

 void main()
 {
     lowp vec4 textureColor = texture2D(inputImageTexture, textureCoordinate);

     gl_FragColor = vec4((textureColor.rgb + vec3(brightness)), textureColor.w);
 }
);
</pre></div></div>

<p>ここまでくるとuniformは定数で、シェーディング言語に渡された定数であるという説明もわかってくるのではないかと思う。</p>

<h3>
<span id="より良いフィルタを作るため" class="fragment"></span><a href="#%E3%82%88%E3%82%8A%E8%89%AF%E3%81%84%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%9F%E3%82%81"><i class="fa fa-link"></i></a>より良いフィルタを作るため</h3>

<p>より良いオリジナルフィルタを作るため、OpenGLについて知りたい場合は、古い本だけれど「OpenGLプログラミングガイド」が基本的なことについて抑えてある。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4894717239/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4894717239&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/8e64d68ab46f1f1e70a0e5a377460180db9f76a2/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343839343731373233392e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4894717239.09.MZZZZZZZ.jpg"><br>
</a><a href="https://camo.qiitausercontent.com/050594b6b00d8fe7a00ec2167d25e71aa6f6e76b/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383934373137323339" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/050594b6b00d8fe7a00ec2167d25e71aa6f6e76b/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383934373137323339" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4894717239"></a></p>

<p><a href="http://www.amazon.co.jp/gp/product/4894717239/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4894717239&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">Amazonへのリンク: OpenGLプログラミングガイド 原著第5版</a><a href="https://camo.qiitausercontent.com/050594b6b00d8fe7a00ec2167d25e71aa6f6e76b/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383934373137323339" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/050594b6b00d8fe7a00ec2167d25e71aa6f6e76b/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34383934373137323339" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4894717239"></a></p>

<p>Amazonのレビューでは最近の主流であるOpenGL4.0では古すぎて役に立たないと書かれているが、今のところGPUImageで利用するのはOpenGL ES2.0なので微妙に役に立つのではないかと思う。800ページ以上もあるので枕になるし。</p>

<p>最近の本だと「OpenGL+GLSLによる画像処理プログラミング」は3Dではなく画像処理に徹していてGPUImageを使って画像処理を行うには最適な一冊。</p>

<p><a href="http://www.amazon.co.jp/gp/product/4777514765/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4777514765&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank"><br>
<img src="https://camo.qiitausercontent.com/b106b9132f63b4ed7b12f5cbcd7a58c576e8fbc4/687474703a2f2f696d616765732d6a702e616d617a6f6e2e636f6d2f696d616765732f502f343737373531343736352e30392e4d5a5a5a5a5a5a5a2e6a7067" alt="" data-canonical-src="http://images-jp.amazon.com/images/P/4777514765.09.MZZZZZZZ.jpg"><br>
</a></p>

<p><a href="http://www.amazon.co.jp/gp/product/4777514765/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4777514765&amp;linkCode=as2&amp;tag=curiosityamazon-22" rel="nofollow noopener" target="_blank">OpenGL+GLSLによる画像処理プログラミング―「OpenGL」と「シェーダ言語」で「レタッチ・ソフト」の仕組みを知る! (I・O BOOKS)</a><a href="https://camo.qiitausercontent.com/563fc5dc410f36f56949731a4388109a4d16db7a/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34373737353134373635" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/563fc5dc410f36f56949731a4388109a4d16db7a/687474703a2f2f69722d6a702e616d617a6f6e2d616473797374656d2e636f6d2f652f69723f743d637572696f73697479616d617a6f6e2d3232266c3d617332266f3d3926613d34373737353134373635" width="1" height="1" alt="" data-canonical-src="http://ir-jp.amazon-adsystem.com/e/ir?t=curiosityamazon-22&amp;l=as2&amp;o=9&amp;a=4777514765"></a></p>

<p>工学社I/O Booksの本は、本自体が小さいにも関わらず文字サイズが大きく、ソースコードを載せる技術書としてかなり読みづらい。また行間の調整もイマイチで図表とテキストの行間が狭く印刷物としての余白の美しさみたいなものがないので敬遠してたんだけど内容は良かった。</p>

<h2>
<span id="なぜglslは高速に処理を行えるのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9Cglsl%E3%81%AF%E9%AB%98%E9%80%9F%E3%81%AB%E5%87%A6%E7%90%86%E3%82%92%E8%A1%8C%E3%81%88%E3%82%8B%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜGLSLは高速に処理を行えるのか</h2>

<p>フラグメントシェーダや頂点シェーダはGPUを用い、画像の全体あるいは一部の領域の画素に対し画素値の計算を同時に実行する。GPUはSIMD演算ユニットで構成され、1回の命令で複数のデータに対する処理を同時に行う。</p>

<p>SIMD演算の概要<br>
<a href="http://cell.fixstars.com/ps3linux/index.php/2.1_SIMD%E6%BC%94%E7%AE%97%E3%81%AE%E6%A6%82%E8%A6%81" class="autolink" rel="nofollow noopener" target="_blank">http://cell.fixstars.com/ps3linux/index.php/2.1_SIMD%E6%BC%94%E7%AE%97%E3%81%AE%E6%A6%82%E8%A6%81</a></p>

<h3>
<span id="if文の処理" class="fragment"></span><a href="#if%E6%96%87%E3%81%AE%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>if文の処理</h3>

<p>GPUは並列に命令を処理する性質上if elseの命令両方をセットしなくてはならず、命令を実質的に実行するかどうかで処理が変わる。セットするだけでもコストかかるのでelse側の命令を少なくすべき</p>

<p>Kepler GPUアーキテクチャとプログラム最適化<br>
<a href="http://news.mynavi.jp/series/kepler_gpu/002/" class="autolink" rel="nofollow noopener" target="_blank">http://news.mynavi.jp/series/kepler_gpu/002/</a></p>

<h3>
<span id="iphoneのgpuについて" class="fragment"></span><a href="#iphone%E3%81%AEgpu%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>iPhoneのGPUについて</h3>

<p>iPhoneのGPUはプロセッサ内にあり世代別に違いがある。</p>

<table>
<thead>
<tr>
<th style="text-align: left">iPhone</th>
<th style="text-align: left">GPU</th>
<th style="text-align: left">備考</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">iPhone5s</td>
<td style="text-align: left">iPowerVR Series 6 クアッドコア G6340</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">iPhone5</td>
<td style="text-align: left">iPowerVR Series 5XT トリプルコア SGX543MP3</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Phone4S</td>
<td style="text-align: left">iPowerVR Series 5XT  デュアルコア SGX543MP2</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">Phone4</td>
<td style="text-align: left">iPowerVR Series 5 SGX535</td>
<td style="text-align: left"></td>
</tr>
</tbody>
</table>

<p>PowerVR - Wikipedia<br>
<a href="http://en.wikipedia.org/wiki/PowerVR" class="autolink" rel="nofollow noopener" target="_blank">http://en.wikipedia.org/wiki/PowerVR</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>251</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/6cffb5cd5a5dd659edb4">iOSアプリ開発時の実ファイルの配置ベストプラクティス</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-25 21:22:17</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Androidアプリ開発時に使うEclipseなどとは違い、Xcode上のファイルグループ分けと実ファイルの物理構成はリンクしているわけではないので、実ファイルをどのように配置していくのかはプロジェクト初期にメンバーで都度決めていると思います。</p>

<p>自分がいつもやっているのは実ファイルをMVCに分類し、Classesディレクトリの下にMVCディレクトリを作りそこに配置していくことです。</p>

<p>例としてクラスAModel,BModel,AControllerとリソースであるstoryboardやxibがある場合は次のようにしています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>SampleProject/Classes/Models/AModel.h
SampleProject/Classes/Models/AModel.m
SampleProject/Classes/Models/BModel.h
SampleProject/Classes/Models/BModel.m
SampleProject/Classes/Controllers/AController.h
SampleProject/Classes/Controllers/AController.m
SampleProject/Classes/Views/Main.storyboard
SampleProject/Classes/Views/CustumCell.xib
SampleProject/Classes/Views/CustumCell.h
SampleProject/Classes/Views/CustumCell.m
</pre></div></div>

<h2>
<span id="なぜclassesディレクトリを使うのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9Cclasses%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜClassesディレクトリを使うのか</h2>

<p>現在のXcode5系のテンプレートプロジェクトのまま作ってしまうとClassesディレクトリがなく、plistやpcxファイルと同じディレクトリに全てのコードが配置されるとプロジェクトの見通しが悪く感じてしまいます。また、Xcode3系のときはClassesディレクトリが自動で作成されていた事があり、そのClassesという名前をそのまま使っています。</p>

<h2>
<span id="なぜユースケースごとに分けないのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9C%E3%83%A6%E3%83%BC%E3%82%B9%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%94%E3%81%A8%E3%81%AB%E5%88%86%E3%81%91%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜユースケースごとに分けないのか</h2>

<p>複数のユースケースがある場合、どのユースケースのディレクトリに格納すべきか迷うのを避けるためです。webアプリであれば画面ごとにControllerを分けることも多いと思いますが、iOSアプリ開発ではViewControllerは画面に依存しているというよりもViewとModelに依存しており、さらにコンテナ機能によって使い回しがしやすいために画面ごとに分けるのは後々余計な頭を使ってしまいます。</p>

<h2>
<span id="なぜmvc以下は深く分けないのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9Cmvc%E4%BB%A5%E4%B8%8B%E3%81%AF%E6%B7%B1%E3%81%8F%E5%88%86%E3%81%91%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜMVC以下は深く分けないのか</h2>

<p>さきほどの例ではAModel.hとBModel.hは実ファイルの構成上同じModels階層にいますが、この階層を深く分けたくなると思います。例を示すと次のようになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>SampleProject/Classes/Models/A/AModel.h
SampleProject/Classes/Models/A/AModel.m
SampleProject/Classes/Models/B/BModel.h
SampleProject/Classes/Models/B/BModel.m
</pre></div></div>

<p>これで見通しの良さは向上するのですが、開発中、Xcode上でAModelのグループ名Aを変更したくなるときがあるでしょう。そのとき、グループ名を変えた上でディレクトリ名を同じように変えたくなりますよね。しかし、Xcode上で実ディレクトリ名を変えることはできないため、Xcode上での操作+GUI or CUIでのコマンド操作が必要になりどうしても開発のリズムを崩しリファクタリングが億劫になり良くありません(特にgit/svnを使っていた場合は面倒な感じを受けます)。</p>

<p>したがって、リファクタリングでMVC間をまたがるということはないとして、実ファイルはMVCには分けるがそれ以上は分類しないということで妥協します。Xcode上のグループは分かりやすくMVC以下も深く分けていくのが良いと思います。</p>

<h2>
<span id="mvcに分類できないのはどうするの" class="fragment"></span><a href="#mvc%E3%81%AB%E5%88%86%E9%A1%9E%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%81%AE%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>MVCに分類できないのはどうするの？</h2>

<p>よくあるパターンとしてUtilitesとかCategoriesとかでしょうかね。ViewとControllerに分類できないならModelでいいとは思いますが、開発チーム内で話しあって決めたいところです。</p>

<h2>
<span id="画像やサウンドなどリソースの配置はどうするの" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E3%82%84%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89%E3%81%AA%E3%81%A9%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AE%E9%85%8D%E7%BD%AE%E3%81%AF%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>画像やサウンドなどリソースの配置はどうするの？</h2>

<p><a href="http://qiita.com/yimajo/items/239eb68265e4ea772484" id="reference-7897f5339827e38155c1">Xcode5からはAsset Catalog</a>が導入され、画像のリソースの配置や命名についてはほとんど気にしなくなりましたが、Asset Catalogを使えない場合は次のような制約が適切です。</p>

<ul>
<li>リソースは一つのディレクトリに平たく置かず物理ディレクトリを分ける</li>
<li>Resourcesディレクトリを作りその下にimagesとsoundsとする</li>
<li>imagesディレクトリの下にbutton、iconsと構成していく</li>
<li>ディレクトリ構成とグループ構成を一致させる</li>
</ul>

<p>ソースコードの場合はリファクタリングすることが多いためディレクトリ構成を深くしないのですが、画像などのリソースファイルはディレクトリやグループ構成をリファクタリングしたくなることが少ないため、整理しやすさを重視してディレクトリを作成しグループ構成と合わせます。</p>

<p>自分の経験から次のような理由があります</p>

<ul>
<li>デザイナから提供される素材が未整理で一つのディレクトリにまとめて送ってくるという事はないのでその構成を維持してあげる

<ul>
<li>素材を貰う前の自作したダミー構成は捨てる</li>
</ul>
</li>
<li>Xcodeを起動しなくてもディレクトリでわけてあれば他のプロジェクトの画像が把握しやすい

<ul>
<li>再利用するときに他の開発メンバーやデザイナも画像を見つけやすい</li>
</ul>
</li>
</ul>

<p>画像をimagesディレクトリに置くこともメリットがあるので、開発チーム内での認識合わせによると思います。</p>

<p>ちなみにAsset Catalog上のAsset名は実ファイルの画像名と違ってもいいので、デザイナが送ってきたファイル名が規約に沿っていないなどであっても指摘したりファイル名を変更する必要がなくなり便利ですね。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>意図が同じかどうかは分かりませんが、はてなインターン2013の構成も自分と同じような構成だったので参考にリンクしておきます</p>

<p><a href="https://github.com/hatena/ios-Intern-Bookmark-2013/tree/master/InternBookmark/Classes" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/hatena/ios-Intern-Bookmark-2013/tree/master/InternBookmark/Classes</a></p>

<h1>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h1>

<ul>
<li>Xcode上でも物理ファイル構成の連携できてなかったっけ?</li>
<li>他にもいい方法があれば教えて下さい</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>232</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/00970803a37625587111">iOSアプリを受注して開発を進める際の開発フェーズとフローのまとめ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-09 01:12:24</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>自分がやっているiOSアプリの受託開発をするうえでの開発フェーズとフローのまとめです。クライアントから案件の依頼があり、見積→契約成立→要件定義→設計→実装→テスト→検収作業という流れです。</p>

<table>
<thead>
<tr>
<th style="text-align: left">フェーズ</th>
<th style="text-align: center">カテゴリ</th>
<th style="text-align: left">内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">Q&amp;A</td>
<td style="text-align: left">企画書や画面イメージ、参考になる他アプリを提示してもらえるか</td>
</tr>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">Q&amp;A</td>
<td style="text-align: left">細かな仕様の要件がある場合はRFP（Request For Proposal:提案依頼書)があるか</td>
</tr>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">Q&amp;A</td>
<td style="text-align: left">iTunes Connectを利用してアプリの更新を行うAppStoreのアカウントについて整理</td>
</tr>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">明記すること</td>
<td style="text-align: left">機能一覧</td>
</tr>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">明記すること</td>
<td style="text-align: left">見積有効期限</td>
</tr>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">明記すること</td>
<td style="text-align: left">動作確認するiOSのバージョンや端末を前提条件に</td>
</tr>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">明記すること</td>
<td style="text-align: left">納品完了（検収）条件を見積書前提条件に</td>
</tr>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">明記すること</td>
<td style="text-align: left">リジェクト時対応</td>
</tr>
<tr>
<td style="text-align: left">見積</td>
<td style="text-align: center">金額</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">要件定義</td>
<td style="text-align: center">要求まとめ</td>
<td style="text-align: left">リリースするiOSアプリの目的、何をもって目的達成（ダウンロード数や会員数増加）とするか</td>
</tr>
<tr>
<td style="text-align: left">要件定義</td>
<td style="text-align: center">要求まとめ</td>
<td style="text-align: left">機能一覧に優先度を付ける</td>
</tr>
<tr>
<td style="text-align: left">要件定義</td>
<td style="text-align: center">方式検討</td>
<td style="text-align: left">技術的な課題がある部分のプロトタイプの作成</td>
</tr>
<tr>
<td style="text-align: left">要件定義</td>
<td style="text-align: center">UI</td>
<td style="text-align: left">画面イメージやワイヤーフレームの検討</td>
</tr>
<tr>
<td style="text-align: left">要件定義</td>
<td style="text-align: center">UI</td>
<td style="text-align: left">デザインを発注</td>
</tr>
<tr>
<td style="text-align: left">設計</td>
<td style="text-align: center">内部設計</td>
<td style="text-align: left">SQLiteのDB設計またはCoreDataのエンティティを設計しておく</td>
</tr>
<tr>
<td style="text-align: left">設計</td>
<td style="text-align: center">開発指針決め</td>
<td style="text-align: left">NSNotificationやdelegate, blocksなどを利用する場合はあらかじめ方針を決める</td>
</tr>
<tr>
<td style="text-align: left">設計</td>
<td style="text-align: center">開発指針決め</td>
<td style="text-align: left">ライブラリの選定</td>
</tr>
<tr>
<td style="text-align: left">実装</td>
<td style="text-align: center">環境</td>
<td style="text-align: left">接続するサーバー環境を切り分ける場合はDEBUG, RELEASEマクロ定義などで分けられるように</td>
</tr>
<tr>
<td style="text-align: left">実装</td>
<td style="text-align: center">CI</td>
<td style="text-align: left">Jenkinsを使って楽を出来るようにする</td>
</tr>
<tr>
<td style="text-align: left">実装</td>
<td style="text-align: center">実装中の提案</td>
<td style="text-align: left">仕様の曖昧な部分に対して提案しながら確認</td>
</tr>
<tr>
<td style="text-align: left">テスト</td>
<td style="text-align: center">異常系</td>
<td style="text-align: left">通信速度制限</td>
</tr>
<tr>
<td style="text-align: left">検収</td>
<td style="text-align: center">受け入れ</td>
<td style="text-align: left">発注側に問題ないかを確認してもらう</td>
</tr>
<tr>
<td style="text-align: left">リリース</td>
<td style="text-align: center">リリース準備</td>
<td style="text-align: left">iTunes Connectに登録するアプリ情報やスクリーンショットを決める</td>
</tr>
</tbody>
</table>

<p>それぞれのフェーズの詳細を書いておきます</p>

<h1>
<span id="見積フェーズ" class="fragment"></span><a href="#%E8%A6%8B%E7%A9%8D%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA"><i class="fa fa-link"></i></a>見積フェーズ</h1>

<h2>
<span id="見積り用のqa" class="fragment"></span><a href="#%E8%A6%8B%E7%A9%8D%E3%82%8A%E7%94%A8%E3%81%AEqa"><i class="fa fa-link"></i></a>見積り用のQ&amp;A</h2>

<p>見積フェーズでは発注側に企画書や画面イメージ、参考になる他アプリを提示してもらい見積金額を提示します。見積用の資料としてRFPがあれば曖昧な仕様にならずに見積もりを行うことも出来るかもしれませんが、発注側がRFPを用意してくれることは稀です。もし発注側が大手で契約を頻繁に行なっているようであればRFPを作成して頂くほうがスムーズに進みますとダメ元で言ってみるのも有効です。</p>

<p>そもそも、発注側はまずは規模感を知りたい、他社と比較したい事が多く、技術的に難しい場合があっても大きな工数や金額を出してしまうと話が進まなくなってしまうので、見積書には技術的に課題があるポイントや開発する上でのリスクを明示し、それを説明し工数・金額の数字の妥当性を理解してもらいましょう。またこの段階で仕様認識の齟齬がある場合も、上記のやりとりで早めに齟齬をなくすようにするのが良いでしょう。</p>

<p>早めにクライアントの予算も確認したいところですね<br>
参考：<br>
<a href="http://anond.hatelabo.jp/20130724170059" rel="nofollow noopener" target="_blank">【はてな匿名ダイアリー】やり手クライアント　VS　初心者SEの場合</a></p>

<ul>
<li>対応させたいiOSのバージョンはiOS6からかiOS7からか- iPadも専用に対応させたいか（もしくはiPhoneと同じ見た目で良いか）- 企画書や画面イメージ、参考になる他アプリを提示してもらえるか- サーバーと連携する必要があるか</li>
<li>細かな仕様の要件がある場合はRFP（Request For Proposal:提案依頼書)があるか- アプリの申請を行うのはどちらか- 納品完了（検収）条件は何か（開発期間、アプリの検収、ソースコードの納品、AppStoreでのリリースのいずれか）
参考に2014年1月末現在でiOSの利用率はiOS7が80%、2013年12月1日はiOS7が74%だった旨も伝え判断基準にしてもらうと良いかもしれません。</li>
</ul>

<h2>
<span id="見積書に明記してはっきりさせておく事" class="fragment"></span><a href="#%E8%A6%8B%E7%A9%8D%E6%9B%B8%E3%81%AB%E6%98%8E%E8%A8%98%E3%81%97%E3%81%A6%E3%81%AF%E3%81%A3%E3%81%8D%E3%82%8A%E3%81%95%E3%81%9B%E3%81%A6%E3%81%8A%E3%81%8F%E4%BA%8B"><i class="fa fa-link"></i></a>見積書に明記してはっきりさせておく事</h2>

<h3>
<span id="見積有効期限" class="fragment"></span><a href="#%E8%A6%8B%E7%A9%8D%E6%9C%89%E5%8A%B9%E6%9C%9F%E9%99%90"><i class="fa fa-link"></i></a>見積有効期限</h3>

<p>提出することになる概算見積もりはあくまで概算です。詳細見積のための打ち合わせを重ねているうちに明らかになっていなかった仕様が出てきたりもしますので、見積書には見積有効期限を明示することで、提出した概算見積もりから再度詳細な見積もりを出すことを念押しすることができます。</p>

<h3>
<span id="動作検証" class="fragment"></span><a href="#%E5%8B%95%E4%BD%9C%E6%A4%9C%E8%A8%BC"><i class="fa fa-link"></i></a>動作検証</h3>

<p>また、動作確認するiOSのバージョンや端末を見積書に明記しておくことで、あらかじめやるべきことに線引をすることができます。当然、新しいiOSや端末が出た場合は別途見積をしその動作確認をすればよいのであって、そのiOSのバージョンや端末だけで動作すればいいようなプログラムは作るべきではありません。</p>

<h3>
<span id="納品条件" class="fragment"></span><a href="#%E7%B4%8D%E5%93%81%E6%9D%A1%E4%BB%B6"><i class="fa fa-link"></i></a>納品条件</h3>

<ol>
<li>AppStoreでリリース</li>
<li>AppStoreへの申請。発注側にソースコードを納品（発注側のsvnもしくはgitへのコミット）</li>
<li>稼働日での換算</li>
<li>レベニューシェア</li>
</ol>

<p>1はAppleの審査によってリジェクトされると納品できない状態になるため、もし金額を多めに交渉できるとしてもまったくオススメ出来ません。Appleの審査に通ると思える仕様変更を手探りで行う場合もあり、審査方針の規約変更になど心理的に負担が大きくなります。</p>

<p>2は申請できる状態になった=発注側の受け入れで問題がなかったという状態なので審査に依存しないため1よりはオススメです。また、ソースコードの納品形態として発注側のsvn/gitにコミットして納品完了とするパターンもあります。</p>

<p>3は受託というよりも業務委託のパターンです。このパターンでは仕様変更や追加などについて稼働日が変わらなければ再見積ができない、つまり開発者の努力によって貰える金額が増えないためオススメしません。</p>

<p>4はやったことがないので分かりませんが、開発側で判断する材料として企画が優れていてリリース後に回収できる見込みがどのくらいかという目安を計算する必要があるでしょう。発注側に有利なので、開発側はその他の条件を交渉しやすい気もします...。</p>

<h3>
<span id="リジェクト時対応" class="fragment"></span><a href="#%E3%83%AA%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%99%82%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>リジェクト時対応</h3>

<p>リジェクトされた場合に、作業に再見積が発生するのかなど想定しておくのもよいでしょう。開発側の不適際なのか、発注者の要求などで仕方がなかったのか等で切り分けることになりますが、あらかじめリジェクト事例を別途提示すると親切です。リジェクト事例を持ち合わせていない場合は、<a href="http://q.hatena.ne.jp/1231517350" rel="nofollow noopener" target="_blank">最低予算1万ポイントで。iPhoneアプリの審査でリジェクトを食らった事例をお教えください</a>などのリジェクト集を発注側にも情報共有しておくのもいいかもしれません。</p>

<h2>
<span id="金額" class="fragment"></span><a href="#%E9%87%91%E9%A1%8D"><i class="fa fa-link"></i></a>金額</h2>

<p>見積で算出する数値は、機能ごとの工数とし、その工数を金額に変換したものを提示しますが、見積する工数については見積ポーカーと2点見積を複合したやり方で見積を行います。それらのメリットを詳しく知りたい場合は<a href="http://www.google.co.jp/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=4&amp;cad=rja&amp;ved=0CEoQFjAD&amp;url=http%3A%2F%2Fwww.jp.square-enix.com%2Finfo%2Flibrary%2F2011%2Fdldata%2FPM%2FPM.pdf&amp;ei=wszaUZSpIaTQiAfBl4H4Aw&amp;usg=AFQjCNFe-5lFowviD1vIuZMztplIhfcHWQ&amp;sig2=vf_Eu0SuCEnbhCy9rSx1-A" rel="nofollow noopener" target="_blank">【PDF】ゲーム開発 プロジェクトマネジメント講座 - SQUARE ENIX</a>を参照してください。</p>

<p>AppStoreで公開するためのアカウントについても、あらかじめ整理しておく必要があります。発注側にソースコードを渡せば全てやってくれる場合もありますが、こちらで代理として申請を行うのか、こちらのアカウントを使って全ておまかせで公開するかなど細かいことですが見積に関わってきますので確認しておきます。</p>

<h1>
<span id="要件定義フェーズ" class="fragment"></span><a href="#%E8%A6%81%E4%BB%B6%E5%AE%9A%E7%BE%A9%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA"><i class="fa fa-link"></i></a>要件定義フェーズ</h1>

<h2>
<span id="要求まとめ" class="fragment"></span><a href="#%E8%A6%81%E6%B1%82%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>要求まとめ</h2>

<p>発注側とコミュニケーションをしながらリリースしようとするiOSアプリの目的やそのための要求を詰めていくフェーズです。要件定義として打ち合わせを行い、要求を優先度順にまとめるなどドキュメント作成作業の間、技術的に課題がある部分を洗い出すためのプロトタイプ作成を進めておくことも重要です。</p>

<h2>
<span id="方式検討" class="fragment"></span><a href="#%E6%96%B9%E5%BC%8F%E6%A4%9C%E8%A8%8E"><i class="fa fa-link"></i></a>方式検討</h2>

<p>また、複数の方法で設計と実装が出来る場合、発注者に方式検討のメリットデメリットやそれらの方法を選んだ場合の制限を提示しましょう。方式検討はメリットデメリットをわかりやすくした表にすることが有効です。トラブル時などに、なぜこの方法を選んだのか、もうひとつの方法を選ばなかったのかということをすぐに振り返ることもできます。</p>

<h2>
<span id="ui" class="fragment"></span><a href="#ui"><i class="fa fa-link"></i></a>UI</h2>

<h3>
<span id="画面の要件決め" class="fragment"></span><a href="#%E7%94%BB%E9%9D%A2%E3%81%AE%E8%A6%81%E4%BB%B6%E6%B1%BA%E3%82%81"><i class="fa fa-link"></i></a>画面の要件決め</h3>

<p>発注側と開発側で画面イメージやワイヤーフレームをさらに詳細にしていく際には、必ずAppleの<a href="iOS%20%E3%83%92%E3%83%A5%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%20%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3">【PDF】iOS ヒューマンインターフェースガイドライン</a>を参照するようにして下さい。これは使いやすいアプリのためのドキュメントでもありますし、ヒューマンインターフェースガイドラインに沿っていないことでリジェクトされるのを防ぐためです。</p>

<h3>
<span id="デザイン" class="fragment"></span><a href="#%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>デザイン</h3>

<p>デザインの発注が必要な場合、慣れているデザイン業者に頼むのが一番楽なのですが、発注者がiOSアプリのデザイン経験がないデザイン業者に発注する場合など、どのように納品物定義をしていいかわからないこともあるので、その場合は<a href="http://qiita.com/yimajo/items/11be7daeee0a7cd093c6" id="reference-d7b34d897d45a5c65373">【Qiita】iOSアプリ開発でアプリデザイン経験のない人にデザインの納品物をお願いするときのリスト</a>を参考にしてもらうようにしましょう。</p>

<h1>
<span id="設計フェーズ" class="fragment"></span><a href="#%E8%A8%AD%E8%A8%88%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA"><i class="fa fa-link"></i></a>設計フェーズ</h1>

<h2>
<span id="内部設計" class="fragment"></span><a href="#%E5%86%85%E9%83%A8%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>内部設計</h2>

<p>SQLiteを使うのであれば、テーブル定義書を残しましょう。他にはNSUserDefaulstsを素直に使わない場合や、ファイル保存が必要になったが、圧縮したり分割したりする場合など、コードを追えば分かるものの、なぜそのような設計をしなければいけないのかという理由を明記されていると嬉しいものです。</p>

<h2>
<span id="開発指針" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E6%8C%87%E9%87%9D"><i class="fa fa-link"></i></a>開発指針</h2>

<p>設計フェーズではざっくり言うとiOSアプリをどのように作っていくかを決めますので、外部ライブラリの選定や、開発指針（NSNotification, blocks, delegateをどのような場合に使うかなど）を固めておくのも良いと思います。開発指針に関しては開発メンバーの力量を加味したり、優先度をあらかじめ決めておくと楽でしょう。</p>

<p>次のトピックが参考になります。</p>

<p><a href="http://qiita.com/yimajo/items/a3fac0026c07ec538fc2" id="reference-f9f91f7d4771ba0d08fa">【Qiita】変数/クラス名の命名規則に使われる記法の分類</a></p>

<p><a href="http://qiita.com/yimajo/items/c9338a715016e7a812b1" id="reference-d4eb6ad9aae340a1cc16">【Qiita】nilとNSNullの違いとNSNullをnilのように振る舞うようにする</a></p>

<p>また、要件定義フェーズで決まりきらなかった内容や後回しになった事を設計と並行して決めることになります。異常系の動作仕様などは、優先順位が低く要件定義フェーズに時間的余裕もない場合も多いでしょうから設計時に決めても良いでしょう。実装フェーズに入ってからでも問題ない場合が多いのではないかと思います。</p>

<h1>
<span id="実装フェーズ" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA"><i class="fa fa-link"></i></a>実装フェーズ</h1>

<p>実装フェーズでは前のフローで決めきれなかった異常系の処理や、曖昧な仕様のままの正常系の処理などを決めなければいけなくなるはずです。そのような部分は大抵イレギュラーな動作だったりクライアントの判断がつけづらい事であったりするため、都度都度クライアントにどのような仕様を望んでいるかを確認していては話が進まないことも多いでしょう。ここでも開発側であらかじめ提案できるドキュメントまたは実装を進めてから問題があるかの確認をするほうが良いでしょう。</p>

<h2>
<span id="実装中の提案" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E4%B8%AD%E3%81%AE%E6%8F%90%E6%A1%88"><i class="fa fa-link"></i></a>実装中の提案</h2>

<p>UIの改善に関しては、開発者のほうが最近のアプリを日常的にも使っていて同じ事が簡単に出来るよと提案が出来ることも多いと思います。<a href="http://qiita.com/yimajo/items/34d6ba63e4eadfc8f421" id="reference-ef882c432a5f449309c8">【Qiita】UIWebViewの上下フリックでツールバーを表示したりしなかったり</a>のようなあっさりと出来るテクニックはさくっと実装してクライアントに確認すると喜ばれますのでお勧めです。</p>

<h1>
<span id="テストフェーズ" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA"><i class="fa fa-link"></i></a>テストフェーズ</h1>

<p>ネットワークが関係するアプリの場合、テストには必ず通信速度を制限して行いましょう。<a href="http://qiita.com/yimajo/items/efd3a033ac42afd93714" id="reference-1188dce553aaac9ac979">【Qiita】iPhone実機(iOS6.x)で通信速度を制限する</a>が参考になるはずです。</p>

<h1>
<span id="検収フェーズおよびリリース準備" class="fragment"></span><a href="#%E6%A4%9C%E5%8F%8E%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA%E3%81%8A%E3%82%88%E3%81%B3%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>検収フェーズおよびリリース準備</h1>

<p>審査用にiTunes Connectにあらかじめ各種情報を登録することができます。最終的にアプリをXcodeを使ってアップロードしますがあらかじめ登録をしておくほうが良いでしょう。</p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>他にもこんな事をやったほうが良いとかその順序でやるのはセンスがないわー、とかアジャイルだともっとこうなるわーとかあればコメントに書いていただけると楽しいかなと思います</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>214</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/a5e16fa0f9c332a55ccf">自前コンテナでaddChildViewController:するときdidMoveToParentViewController:はやはり使うべき</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-11 14:46:53</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>iOS5からUIViewControllerを自前のクラスにaddChildViewController:メソッドで追加できるようになった。</p>

<p>最近では、こういった自前コンテナは主にFacebookやPath2.0のスライドメニュー風のUI開発なんかに使われていると思う。</p>

<p>このaddChildViewController:メソッドの後には必ずdidMoveToParentViewController:メソッドを呼ぶという説明があるが、これの意味がよくわからなかったのでそのメモ。</p>

<p>例えば</p>

<div class="code-frame" data-lang="objectivec">
<div class="code-lang"><span class="bold">didMoveToParentViewControllerの必要性を疑うコード</span></div>
<div class="highlight"><pre><span></span><span class="c1">//自前コンテナ(self)にchildViewControllerを追加</span>
<span class="p">[</span><span class="nb">self</span> <span class="nl">addChildViewController</span><span class="p">:</span><span class="n">childViewController</span><span class="p">];</span>

<span class="c1">//その後didMoveToParentViewControllerを実行しなければいけない</span>
<span class="p">[</span><span class="n">childViewController</span> <span class="nl">didMoveToParentViewController</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span>
</pre></div>
</div>

<p>この追加(add)したあとになぜ完了(didMove)を明示的に知らせないといけないのか謎という感覚。また、これがなくてもこちらの想定通り動くのでずっと疑問だった。</p>

<h3>
<span id="結論としては" class="fragment"></span><a href="#%E7%B5%90%E8%AB%96%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AF"><i class="fa fa-link"></i></a>結論としては</h3>

<p>自前コンテナでaddChildViewController:を実行した後は、やはり必ずdidMoveToParentViewController:を呼ぶ。これはUIViewController自身が他のコンテナに追加（もしくは削除）されている最中かどうかを知ることで処理を分岐する事もできるようになっていて、それを判断するために完了したことを通知する必要がある。</p>

<p>ちなみに、正しくコードをかけていない場合、追加したViewControllerのviewWillAppear:が動作しない場合がある。</p>

<p>これはどのような事かというと、コンテナのviewを表示したいだけならばViewControllerのviewに対して子ViewControllerのviewをaddSubViewすればいいだけだと思ってしまう。しかしそのViewが表示されたかどうかという判断にはならないためaddChildViewControllerがそもそも必要になってくる。</p>

<h2>
<span id="説明" class="fragment"></span><a href="#%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>説明</h2>

<h3>
<span id="uiviewcontrollerの追加サイクル" class="fragment"></span><a href="#uiviewcontroller%E3%81%AE%E8%BF%BD%E5%8A%A0%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB"><i class="fa fa-link"></i></a>UIViewControllerの追加サイクル</h3>

<p>そもそもUIViewControllerの追加には「開始」と「終了」がかならずセットで必要となる。</p>

<p>・追加: addChildViewController:<br>
・開始: willMoveToParentViewController:(add後に自動で呼ばれる）<br>
・完了: didMoveToParentViewController:(任意のタイミングで呼ぶ）</p>

<p>まず自前コンテナへの追加のためにaddChildViewController:した際に、ViewControllerの追加開始の合図であるwillMoveToParentViewControler:は自動で呼ばれる。</p>

<p>開始は自動で呼ばれるが、それが終了したことをコールするためのdidMoveToParentViewController:メソッドは自動で呼ばれないため必要となる。</p>

<h3>
<span id="終了をコールしないと何に困るのか" class="fragment"></span><a href="#%E7%B5%82%E4%BA%86%E3%82%92%E3%82%B3%E3%83%BC%E3%83%AB%E3%81%97%E3%81%AA%E3%81%84%E3%81%A8%E4%BD%95%E3%81%AB%E5%9B%B0%E3%82%8B%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>終了をコールしないと何に困るのか</h3>

<p>もともとUIViewControllerは自身が他のコンテナに追加（もしくは削除）されている最中かどうかを知ることで処理を分岐する事もできるようになっていて、これを判断するのに完了を呼ぶ必要がある。</p>

<p>ちなみに、追加されている途中かどうかはUIViewControllerのisMovingToParentViewControllerメソッドによって取得できる。</p>

<h3>
<span id="didmovetoparentviewcontrollerがなぜ自動で呼ばれないようになっているか" class="fragment"></span><a href="#didmovetoparentviewcontroller%E3%81%8C%E3%81%AA%E3%81%9C%E8%87%AA%E5%8B%95%E3%81%A7%E5%91%BC%E3%81%B0%E3%82%8C%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>didMoveToParentViewController:がなぜ自動で呼ばれないようになっているか</h3>

<p>では、なぜdidMoveToParentViewController:が自動で呼ばれないかというと、画面遷移にトランジションを指定したい場合が想定されているからだと思う。</p>

<p>例えば次のコードのように、完了までに時間がかかる（実装者が時間を指定できる）場合に、完了のメソッドが明示的にコールできるようになっていることでその意味が出てくる。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span>
<span class="cm">/*fromViewControllerはすでにコンテナに追加されているとする*/</span>

<span class="c1">//toViewControllerをコンテナに追加する</span>
<span class="p">[</span><span class="nb">self</span> <span class="nl">addChildViewController</span><span class="p">:</span><span class="n">toViewController</span><span class="p">];</span>

<span class="c1">//fromからtoへ画面遷移のトランジションを行う</span>
<span class="p">[</span><span class="nb">self</span> <span class="nl">transitionFromViewController</span><span class="p">:</span><span class="n">fromViewController</span>
                   <span class="nl">toViewController</span><span class="p">:</span><span class="n">toViewController</span>
                           <span class="nl">duration</span><span class="p">:</span><span class="mf">1.0</span>
                            <span class="nl">options</span><span class="p">:</span><span class="n">UIViewAnimationOptionTransitionNone</span>
                         <span class="nl">animations</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
                             <span class="c1">// ここで何かしらの遷移アニメーション</span>
                         <span class="p">}</span>
                         <span class="nl">completion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
                             <span class="c1">// 追加完了を明示的に行う</span>
                             <span class="p">[</span><span class="n">toViewController</span> <span class="nl">didMoveToParentViewController</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span>
                         <span class="p">}];</span>
</pre></div></div>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>上記のように、画面遷移のトランジションを使わなくてもaddChildViewController:したらdidMoveToParentViewController:を呼び出すことを忘れないようにしたらよいでしょう。</p>

<p>もし、突っ込みどころ等あればコメントなり編集リクエストがあれば嬉しいです。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>カスタムContainer View Controllerを作る（ルールが分かりやすく纏められている）<br>
<a href="http://qiita.com/edo_m18/items/8b6b457f82b185ab1f6a" class="autolink" id="reference-b4eae8650021e2ad8608">http://qiita.com/edo_m18/items/8b6b457f82b185ab1f6a</a></p>

<p>Cocoa練習帳: [iOS]独自のコンテナViewController<br>
<a href="http://www.bitz.co.jp/weblog/?date=20120923" class="autolink" rel="nofollow noopener" target="_blank">http://www.bitz.co.jp/weblog/?date=20120923</a></p>

<p>isMovingToParentViewControllerメソッドについてはiOS View Controllerカタログの「ナビゲーションスタックの変化の監視」<br>
<a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/ViewControllerCatalog.pdf" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/jp/devcenter/ios/library/documentation/ViewControllerCatalog.pdf</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>194</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/81a1331fea2592821061">Storyboard上のUITableViewCellをxibで作る場合はregisterNib:forCellReuseIdentifier:メソッドが便利</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-14 01:38:14</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Storyboardを使ってUITableViewのある画面を作り、そのCellを複数画面で使いまわすためにxibとして作成するときのTipsです。</p>

<p>UITableViewにiOS5から追加されたregisterNib:forCellReuseIdentifier:メソッドを使うことで、作成したxibをUITableViewに登録することができ、nilチェックとloadNibを必要としないシンプルなコードにすることができます。</p>

<p>コードで例を示すために使いまわしたいCellを"SampleTableViewCell"とします。作成するのは3つ</p>

<ul>
<li>SampleTableViewCell.xib</li>
<li>SampleTableViewCell.h</li>
<li>SampleTableViewCell.m</li>
</ul>

<p>ここで説明するregisterNib:forCellReuseIdentifier:メソッドは、UITableViewを保持するUITableViewControllerのviewDidLoadなどで呼び出します。これによってCell用に作成したxibファイルがUITableViewに登録されます。</p>

<div class="code-frame" data-lang="objective-c"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>

    <span class="bp">UINib</span> <span class="o">*</span><span class="n">nib</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UINib</span> <span class="nl">nibWithNibName</span><span class="p">:</span><span class="s">@"SampleTableViewCell"</span> <span class="nl">bundle</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">tableView</span> <span class="nl">registerNib</span><span class="p">:</span><span class="n">nib</span> <span class="nl">forCellReuseIdentifier</span><span class="p">:</span><span class="s">@"Cell"</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>あとはStoryboardでStaticやDynamicなCellを呼び出す時と同じように次のようにします。</p>

<div class="code-frame" data-lang="objective-c"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="bp">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">CellIdentifier</span> <span class="o">=</span> <span class="s">@"Cell"</span><span class="p">;</span>
    <span class="n">SampleTableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier</span><span class="p">:</span><span class="n">CellIdentifier</span><span class="p">];</span>

    <span class="c1">// Configure the cell...</span>

    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>これで下記のようにcellの再利用をnilチェックし生成する必要はありません。</p>

<div class="code-frame" data-lang="objective-c"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="bp">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">CellIdentifier</span> <span class="o">=</span> <span class="s">@"Cell"</span><span class="p">;</span>
    <span class="n">SampleTableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier</span><span class="p">:</span><span class="n">CellIdentifier</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cell</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// こういう処理は必要なくなるよと</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">SampleTableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle</span><span class="p">:</span><span class="n">UITableViewCellStyleDefault</span> 
          <span class="nl">reuseIdentifier</span><span class="p">:</span><span class="n">CellIdentifier</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="c1">// Configure the cell...</span>

    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>なぜ再利用のチェックと生成を行う必要がないかというと、先ほどの説明通りにnibを登録してればnilを返すことがないからです。これについては<a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UITableView_Class/Reference/Reference.html" rel="nofollow noopener" target="_blank">AppleのUITableViewのリファレンス</a>でdequeueReusableCellWithIdentifier:がnilを返す場合について下記のように言及されていましたので参考になります</p>

<ul>
<li>再利用されるcellが存在しない時</li>
<li>nibが登録されていない時（iOS5から)</li>
<li>Classが登録されていない時（iOS5から)</li>
</ul>

<p>つまり、nilが返るという状態は実装ミスです。実装ミスがすぐに発覚するので良いつくりといえるでしょう。</p>

<p>したがって、先述のメソッドによりCellが登録されることで内部キューになければ自動で生成を行なってくれるため、Cellの再利用チェックと生成のコードが必要ないわけです。余談ですがStoryboardのCellを使うようになってから再利用チェックを書く必要がなくなっていたのはStoryboardが登録の手続きを行なっていたからなんですね。</p>

<p>これらは当然、Storyboard+xibの時にかぎらず、UITableViewでさえあれば使えます。また、registerClass:forCellReuseIdentifier:によりクラスを指定できるためxibである必要も有りません。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>182</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/c30c4d5f5eab06172028">かゆいところに手が届きそうなAVFoundationとMediaPlayerによる音楽再生アプリ作成メモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-17 11:23:56</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>「無料で音楽聴き放題!! - ネットラジオ」というアプリをリリースしました。AppleのiTunes Radioが日本ではリリースされないのでそれっぽいものをという感じで、ストリーミングで流れている楽曲で気に入ったものがあればiTunesで購入できるようにしています。</p>

<p><a href="https://itunes.apple.com/jp/app/nettorajio-j-popmo-wu-liaode/id769979888?mt=8" class="autolink" rel="nofollow noopener" target="_blank">https://itunes.apple.com/jp/app/nettorajio-j-popmo-wu-liaode/id769979888?mt=8</a></p>

<p>以降のメモはそのとき調査して実装したものです。音楽プレイヤーアプリはゲームアプリともツール系アプリとも違う独特の処理を必要としているので、あれどうやるんだっけ的な物になっています。</p>

<p><a href="https://camo.qiitausercontent.com/350ab6b1fcd48df308809195734f617fd48c2648/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61663238313764312d613032392d643736382d303131312d3737623763323537376136392e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/350ab6b1fcd48df308809195734f617fd48c2648/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61663238313764312d613032392d643736382d303131312d3737623763323537376136392e6a706567" alt="IMG_1091.jpg" title="IMG_1091.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/af2817d1-a029-d768-0111-77b7c2577a69.jpeg"></a></p>

<h1>
<span id="画面ロック時の処理" class="fragment"></span><a href="#%E7%94%BB%E9%9D%A2%E3%83%AD%E3%83%83%E3%82%AF%E6%99%82%E3%81%AE%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>画面ロック時の処理</h1>

<h2>
<span id="ロック時でも再生を続ける" class="fragment"></span><a href="#%E3%83%AD%E3%83%83%E3%82%AF%E6%99%82%E3%81%A7%E3%82%82%E5%86%8D%E7%94%9F%E3%82%92%E7%B6%9A%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>ロック時でも再生を続ける</h2>

<p>プロジェクト設定からBackground Audio&amp;AirPlayをONにする。また次のようなコードを実装する。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">AVAudioSession</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="p">[</span><span class="bp">AVAudioSession</span> <span class="n">sharedInstance</span><span class="p">];</span>

<span class="c1">//ロック時も再生のカテゴリを指定</span>
<span class="p">[</span><span class="n">session</span> <span class="nl">setCategory</span><span class="p">:</span><span class="n">AVAudioSessionCategoryPlayback</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="c1">//オーディオセッションを有効化</span>
<span class="p">[</span><span class="n">session</span> <span class="nl">setActive</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</pre></div></div>

<p>上記は一度だけ最初に実行すればよい。再生を管理するシングルトンインスタンスの初期化時などにやればいい。</p>

<h2>
<span id="コントロールセンターに再生ボタンなどのコントロールを表示する" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%E3%81%AB%E5%86%8D%E7%94%9F%E3%83%9C%E3%82%BF%E3%83%B3%E3%81%AA%E3%81%A9%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>コントロールセンターに再生ボタンなどのコントロールを表示する</h2>

<p>ロック画面やコントロールセンターの再生ボタンを表示するには次のようにする</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="bp">UIApplication</span> <span class="n">sharedApplication</span><span class="p">]</span> <span class="n">beginReceivingRemoteControlEvents</span><span class="p">];</span>
</pre></div></div>

<p>再生ボタンなどのイベントを処理するには次のように実装する。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">remoteControlReceivedWithEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">receivedEvent</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">receivedEvent</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">UIEventTypeRemoteControl</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">receivedEvent</span><span class="p">.</span><span class="n">subtype</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">case</span> <span class="nl">UIEventSubtypeRemoteControlPlay</span><span class="p">:</span>
            <span class="k">case</span> <span class="nl">UIEventSubtypeRemoteControlPause</span><span class="p">:</span>
            <span class="k">case</span> <span class="nl">UIEventSubtypeRemoteControlTogglePlayPause</span><span class="p">:</span>
                <span class="p">[</span><span class="nb">self</span> <span class="n">playOrPause</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">default</span><span class="o">:</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>ただし、ViewControllerなどでこの処理を実装する場合、ファーストレスポンダにならなければいけないようなので、もし、上記のメソッドをViewControllerなどで実装するのであればファーストレスポンダの登録を行う。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewWillAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="nl">viewWillAppear</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">becomeFirstResponder</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>大抵の場合そうだと思うけど、ViewControllerにビジネスロジックを書きたくはないとおもうので、特定のオブジェクトにメッセージを送るようにするにはAppDelegate.mでリモートコントロールイベントを受け取るremoteControlReceivedWithEvent:メソッドをオーバーライドし、ビジネスロジックを記述するインスタンスに処理を渡すようにする。</p>

<div class="code-frame" data-lang="objc">
<div class="code-lang"><span class="bold">AppDelegate.m</span></div>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">remoteControlReceivedWithEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">receivedEvent</span>
<span class="p">{</span>
    <span class="p">[[</span><span class="n">MusicPlayManager</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">remoteControlReceivedWithEvent</span><span class="p">:</span><span class="n">receivedEvent</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>

<p>例として、曲の再生管理用にMusicPlayManagerというクラスを作成している。</p>

<h2>
<span id="ロック画面にジャケット画像を表示する" class="fragment"></span><a href="#%E3%83%AD%E3%83%83%E3%82%AF%E7%94%BB%E9%9D%A2%E3%81%AB%E3%82%B8%E3%83%A3%E3%82%B1%E3%83%83%E3%83%88%E7%94%BB%E5%83%8F%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ロック画面にジャケット画像を表示する</h2>

<p>MPNowPlayingInfoCenterのsetNowPlayingInfo:メソッドにDictionaryで画像を渡す。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">MPMediaItemArtwork</span> <span class="o">*</span><span class="n">artwork</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">MPMediaItemArtwork</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithImage</span><span class="p">:[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@"image.png”]];</span>

<span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">songInfo</span> <span class="o">=</span> <span class="l">@{</span><span class="n">MPMediaItemPropertyArtwork</span><span class="p">,</span> <span class="n">artwork</span><span class="l">}</span><span class="p">;</span>
<span class="p">[[</span><span class="bp">MPNowPlayingInfoCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">setNowPlayingInfo</span><span class="p">:</span><span class="n">songInfo</span><span class="p">];</span>
</pre></div></div>

<p>このDictionaryでは曲名やアーティスト名なども渡すことが出来る。</p>

<h1>
<span id="電話などの割り込みから復帰" class="fragment"></span><a href="#%E9%9B%BB%E8%A9%B1%E3%81%AA%E3%81%A9%E3%81%AE%E5%89%B2%E3%82%8A%E8%BE%BC%E3%81%BF%E3%81%8B%E3%82%89%E5%BE%A9%E5%B8%B0"><i class="fa fa-link"></i></a>電話などの割り込みから復帰</h1>

<p>AVAudioSessionDelegateを実装すれば良い。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">AVAudioSession</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="p">[</span><span class="bp">AVAudioSession</span> <span class="n">sharedInstance</span><span class="p">];</span>
<span class="n">session</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#pragma mark -
#pragma mark Interruption event handling
- (void)beginInterruption
{
    //自動で再生中止するのでそのときの処理
}

- (void)endInterruptionWithFlags:(NSUInteger)flags
{
    //再生再開させるようにする
}

</pre></div></div>

<h2>
<span id="ヘッドフォンジャックを抜いた時" class="fragment"></span><a href="#%E3%83%98%E3%83%83%E3%83%89%E3%83%95%E3%82%A9%E3%83%B3%E3%82%B8%E3%83%A3%E3%83%83%E3%82%AF%E3%82%92%E6%8A%9C%E3%81%84%E3%81%9F%E6%99%82"><i class="fa fa-link"></i></a>ヘッドフォンジャックを抜いた時</h2>

<p>ヘッドフォンをジャックから抜くとAVFoundationのAVPlayerは再生が自動で止まる。ボタンも追随して再生中から停止中へと状態を変えてあげる必要があるので</p>

<p>自分の記事だけどこの記事が参考になる<br>
<a href="http://qiita.com/yimajo/items/7f74536fa2ab3cc437f5" class="autolink" id="reference-f3c17102ef8ef8f65b3c">http://qiita.com/yimajo/items/7f74536fa2ab3cc437f5</a></p>

<p>もしくはAVAudioSessionDelegateのinputIsAvailableChangedメソッドを使ってみるのもいいかもしれない。</p>

<h1>
<span id="avplayer再生" class="fragment"></span><a href="#avplayer%E5%86%8D%E7%94%9F"><i class="fa fa-link"></i></a>AVPlayer再生</h1>

<h2>
<span id="avplayerの状態を知る" class="fragment"></span><a href="#avplayer%E3%81%AE%E7%8A%B6%E6%85%8B%E3%82%92%E7%9F%A5%E3%82%8B"><i class="fa fa-link"></i></a>AVPlayerの状態を知る</h2>

<p>AVPlayerの状態はAVPlayerStatus列挙体をもつstatusプロパティがあるが、再生中というステータスはない。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="p">{</span>
   <span class="n">AVPlayerStatusUnknown</span><span class="p">,</span>
   <span class="n">AVPlayerStatusReadyToPlay</span><span class="p">,</span>
   <span class="n">AVPlayerStatusFailed</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="n">NSInteger</span> <span class="n">AVPlayerStatus</span><span class="p">;</span>
</pre></div></div>

<p>再生中かどうかを知りたい場合、rateプロパティが0かどうかを判断すれば良いとStackoverflowにある</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>if ([AVPlayer rate] != 0.0)
</pre></div></div>

<p>Check play state of AVPlayer<br>
<a href="http://stackoverflow.com/questions/5655864/check-play-state-of-avplayer" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/5655864/check-play-state-of-avplayer</a></p>

<p>たしかに停止中は0.0になるが、ストリーミングなど通信を介してAVPlayerで再生をする場合は再生していなくてもrateが0.0にならないことがあった。</p>

<h2>
<span id="タイムアウトを実装する" class="fragment"></span><a href="#%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>タイムアウトを実装する</h2>

<p>再生中のステータスが無いため、タイムアウトはReadyToPlayからタイマーを動かし、AVPlayerでメタデータが変わっていないかなどから判断してタイマーを止めるなどで対応するしかない。これはAVPlayerによるストリーミング音楽再生だけでなく映像再生も同じ。</p>

<h2>
<span id="再生させる" class="fragment"></span><a href="#%E5%86%8D%E7%94%9F%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>再生させる</h2>

<p>RadyToPlayの状態から再生メソッドplayを実行するようにする。ストリーミング再生などでURLから初期化後すぐにplayを実行することもできるが、再生中というステータス自体がないこともあり、再生開始の状態からメソッドを実行しそのとき内部の再生状態用のフラグを変更しつつplayメソッドを実行するほうがスマート。</p>

<h1>
<span id="音楽再生マネージャクラスの設計" class="fragment"></span><a href="#%E9%9F%B3%E6%A5%BD%E5%86%8D%E7%94%9F%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>音楽再生マネージャクラスの設計</h1>

<h2>
<span id="シングルトンな再生用マネージャクラスを設計する" class="fragment"></span><a href="#%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%88%E3%83%B3%E3%81%AA%E5%86%8D%E7%94%9F%E7%94%A8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%A8%AD%E8%A8%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>シングルトンな再生用マネージャクラスを設計する</h2>

<p>ストリーミング音楽再生はAVPlayerを使うが、ViewControllerから直接AVPlayerを監視して操作するのはよくない。曲の再生は画面に依存したくないだろうし、複数のAVPlayerを使うこともないだろう。なのでシングルトンな再生用マネージャクラスを設計する。</p>

<h2>
<span id="再生用マネージャクラスの状態通知はkvoよりnotificaitonのほうが便利" class="fragment"></span><a href="#%E5%86%8D%E7%94%9F%E7%94%A8%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%8A%B6%E6%85%8B%E9%80%9A%E7%9F%A5%E3%81%AFkvo%E3%82%88%E3%82%8Anotificaiton%E3%81%AE%E3%81%BB%E3%81%86%E3%81%8C%E4%BE%BF%E5%88%A9"><i class="fa fa-link"></i></a>再生用マネージャクラスの状態通知はKVOよりNotificaitonのほうが便利</h2>

<p>AVPlayerからの状態の監視はKVOを行うが、ViewControllerやViewなどに一方的に何かがONになった状態を通知したい場合はNotificationをPOSTするのが良いと思う。ただしON/OFFの状態がトグルになる場合はKVOのほうが分かりやすいかもしれない。blocksやdelegateで1対1になってしまうのも設計上よくない。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>AVPlayer =&gt;|KVO|=&gt; 再生用マネージャインスタンス =&gt;|Notification POST|=&gt;ViewController
</pre></div></div>

<p>Notificationを使わずKVOで実装してみたがAVPlayerのKVOもあり混乱してしまった。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>Apple: AVFoundation Framework Reference<br>
<a href="https://developer.apple.com/library/ios/DOCUMENTATION/AVFoundation/Reference/AVFoundationFramework/_index.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/ios/DOCUMENTATION/AVFoundation/Reference/AVFoundationFramework/_index.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>175</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/30c518abd0609c80c741">iOSアプリにおけるOAuth連携の実装</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-16 21:35:00</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iOS]</b> <b>[OAuth]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>拙作のiPhoneアプリShareAlbum (<a href="http://bit.ly/sharealbum_jp" class="autolink" rel="nofollow noopener" target="_blank">http://bit.ly/sharealbum_jp</a>) ではOAuthを使ってInstagramやTumblrなど様々なWebサービスと連携しています。このTipsではOAuth認可・認証のWebサービスと連携するアプリケーションの実装についてGoogleのライブラリによる説明を書いています。</p>

<p><a href="https://camo.qiitausercontent.com/5b327ff39054751fc69bf745b8e49ec170e61ec7/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f33376434353938326632666264326363383739363735666338306236386335622f74756d626c725f6d69646274665761777631717a7a616f376f315f3430302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5b327ff39054751fc69bf745b8e49ec170e61ec7/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f33376434353938326632666264326363383739363735666338306236386335622f74756d626c725f6d69646274665761777631717a7a616f376f315f3430302e706e67" alt="ShareAlbum" data-canonical-src="http://25.media.tumblr.com/37d45982f2fbd2cc879675fc80b68c5b/tumblr_midbtfWawv1qzzao7o1_400.png"></a></p>

<p>OAuth連携することでこんなアプリケーションも簡単に作れますよということです</p>

<h1>
<span id="oauth20について" class="fragment"></span><a href="#oauth20%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>OAuth2.0について</h1>

<p>まずはOAuth2.0についてiOSアプリ開発者が知るべきことは下記の通りです</p>

<ul>
<li>基本的にAPIの認可のためにアクセストークンを取得する</li>
<li>アクセストークンはAPIのパラメータにセットしてリクエストを行う</li>
<li>アクセストークン取得までのフローは複数あり、主に認可コードフローやインプリシットグラントフローが使われる</li>
<li>iOSからはUIWebViewを用いてログイン画面を表示する</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/12170ab14e7d78ec5ba2a4b008101412e6c7056a/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f38653338386363373536643264356265373066326632376339613235303664352f74756d626c725f6d69646430303469593831717a7a616f376f315f3430302e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/12170ab14e7d78ec5ba2a4b008101412e6c7056a/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f38653338386363373536643264356265373066326632376339613235303664352f74756d626c725f6d69646430303469593831717a7a616f376f315f3430302e6a7067" alt="" data-canonical-src="http://24.media.tumblr.com/8e388cc756d2d5be70f2f27c9a2506d5/tumblr_midd004iY81qzzao7o1_400.jpg"></a></p>

<p>UIWebViewでログイン画面を出すとそのOAuthサービスのデザインのまま表示されます</p>

<h2>
<span id="フローについて" class="fragment"></span><a href="#%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>フローについて</h2>

<ul>
<li>認可コードフロー

<ul>
<li>別名サーバサイドWebアプリケーションフロー、エクスプリシットグラントフローとも呼ばれます</li>
</ul>
</li>
<li>インプリシットグラントフロー

<ul>
<li>別名クライアントサイドWebアプリケーションフローとも呼ばれます</li>
</ul>
</li>
<li>リソース所有者パスワードクレデンシャルフロー</li>
<li>クライアントクレデンシャルフロー</li>
</ul>

<p>次にこれらフローについて概要をまとめてみました</p>

<h2>
<span id="認可コードフローの概要" class="fragment"></span><a href="#%E8%AA%8D%E5%8F%AF%E3%82%B3%E3%83%BC%E3%83%89%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>認可コードフローの概要</h2>

<p>OAuthサービスとアプリケーションが共通のclient_secretを保持しておき、それを使って認可コードを取得、これとアクセストークンを交換します。<br>
Webサービスの場合、ブラウザは認可コードについて保持することはありますが、アクセストークンを保持していないのでブラウザ履歴や,referer,jsなどからアクセスされるリスクが低くなります。リフレッシュトークンを使ってアクセストークンをリフレッシュすることが許されています。</p>

<h4>
<span id="特徴まとめ" class="fragment"></span><a href="#%E7%89%B9%E5%BE%B4%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>特徴まとめ</h4>

<ul>
<li>認可コードフローでは認可コードと引き換えにアクセストークンを手に入れる</li>
<li>認可コードはクエリパラメータとしてリダイレクトURLに付けられ送られてくる</li>
<li>アクセストークンはそのリダイレクトURLにアクセスした際にレスポンスとして受け取る</li>
</ul>

<h4>
<span id="使われるケース" class="fragment"></span><a href="#%E4%BD%BF%E3%82%8F%E3%82%8C%E3%82%8B%E3%82%B1%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>使われるケース</h4>

<ul>
<li>長期に渡るアクセスやクライアントアプリがWebアプリケーションサーバの場合</li>
</ul>

<h2>
<span id="インプリシットグラントフローの概要" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%83%97%E3%83%AA%E3%82%B7%E3%83%83%E3%83%88%E3%82%B0%E3%83%A9%E3%83%B3%E3%83%88%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>インプリシットグラントフローの概要</h2>

<p>iPhoneやAndoridなどクライアントアプリケーションでclient_secretを秘匿できないケースのために考えられたフローです。認可コードが不要ですが、そのためアクセストークンの期限が切れた場合に、ID/パスワードによるフローをユーザーに行わせたいため、リフレッシュトークンを利用させることはOAuthの仕様上定義されていません。</p>

<h4>
<span id="使われるケース-1" class="fragment"></span><a href="#%E4%BD%BF%E3%82%8F%E3%82%8C%E3%82%8B%E3%82%B1%E3%83%BC%E3%82%B9-1"><i class="fa fa-link"></i></a>使われるケース</h4>

<ul>
<li>iPhone,AndroidやJS、Flashなどclient_secretを保持できない（リバースエンジニアリングされると見られる）アプリケーション</li>
</ul>

<h2>
<span id="リソース所有者パスワードクレデンシャルの概要" class="fragment"></span><a href="#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E6%89%80%E6%9C%89%E8%80%85%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%82%AF%E3%83%AC%E3%83%87%E3%83%B3%E3%82%B7%E3%83%A3%E3%83%AB%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>リソース所有者パスワードクレデンシャルの概要</h2>

<p>ユーザ名とパスワードを直接access_tokenと交換できます。APIプロバイダ自身（つまりサービス元）が開発したモバイルアプリケーションなど信用できるクライアントのみで使われます。</p>

<h4>
<span id="使われるケース-2" class="fragment"></span><a href="#%E4%BD%BF%E3%82%8F%E3%82%8C%E3%82%8B%E3%82%B1%E3%83%BC%E3%82%B9-2"><i class="fa fa-link"></i></a>使われるケース</h4>

<ul>
<li>OAuthサービス元自身が作成するモバイルアプリケーション</li>
</ul>

<h2>
<span id="クライアントクレデンシャルの概要" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%AF%E3%83%AC%E3%83%87%E3%83%B3%E3%82%B7%E3%83%A3%E3%83%AB%E3%81%AE%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>クライアントクレデンシャルの概要</h2>

<p>特定のユーザでなくストレージサービスやDBサービスのAPIアクセス方法です。</p>

<h4>
<span id="使われるケース-3" class="fragment"></span><a href="#%E4%BD%BF%E3%82%8F%E3%82%8C%E3%82%8B%E3%82%B1%E3%83%BC%E3%82%B9-3"><i class="fa fa-link"></i></a>使われるケース</h4>

<ul>
<li>Webサービスとストレージ系サービス間の認可がすでに委譲済みな場合</li>
</ul>

<h1>
<span id="oauthサービスへのアプリケーション登録例" class="fragment"></span><a href="#oauth%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%B8%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E7%99%BB%E9%8C%B2%E4%BE%8B"><i class="fa fa-link"></i></a>OAuthサービスへのアプリケーション登録例</h1>

<h2>
<span id="instagramのoauthについて" class="fragment"></span><a href="#instagram%E3%81%AEoauth%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>InstagramのOAuthについて</h2>

<p>Instagramはデベロッパー用の管理画面が有り、そこから利用するアプリ情報を登録します。<br>
<a href="http://instagram.com/developer/clients/manage/" class="autolink" rel="nofollow noopener" target="_blank">http://instagram.com/developer/clients/manage/</a></p>

<p>アプリケーションの新規登録画面は次の通り</p>

<p><a href="https://camo.qiitausercontent.com/dbcb10cf659c560479544050a04bd33d2953acab/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f66316239363063313936346438613039326636386435653632303335633531332f74756d626c725f6d696236636665505a7531717a7a616f376f315f313238302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/dbcb10cf659c560479544050a04bd33d2953acab/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f66316239363063313936346438613039326636386435653632303335633531332f74756d626c725f6d696236636665505a7531717a7a616f376f315f313238302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/f1b960c1964d8a092f68d5e62035c513/tumblr_mib6cfePZu1qzzao7o1_1280.png"></a></p>

<p>それぞれ入力するのは次の項目になります</p>

<p>・アプリケーション名 (ユーザに表示される）<br>
・アプリケーションについての詳細(ユーザに表示される）<br>
・ウェブサイトURL(ユーザに表示される）<br>
・リダイレクトURL(認可コードをレスポンスパラメータとして付与されるURL）</p>

<p>アプリケーション登録で重要なのは最後のリダイレクトURLです。</p>

<p>通常、リダイレクトURLはInstagramのアクセストークンを使いたいWebサービスのURLとします。<br>
InstagramのID/パスワード入力画面からそのURLへクエリパラメータとして認可コードを付けてリダイレクトされWebサービスに戻ってくることで、OAuthの認可処理が完了しアクセストークンの利用ができるようになります。</p>

<p>しかしiOSアプリはWebアプリではないため、リダイレクトされるサイトはありません。iOSアプリ側はOAuthサーバーからのリダイレクト要求をキャンセルし、認可コードだけを取得するようにします。そのため、この連携アプリ登録時に入力するリダイレクトURLはダミーでも構いません。</p>

<h1>
<span id="iosアプリ側の仕様について" class="fragment"></span><a href="#ios%E3%82%A2%E3%83%97%E3%83%AA%E5%81%B4%E3%81%AE%E4%BB%95%E6%A7%98%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>iOSアプリ側の仕様について</h1>

<p>ID/パスワードの入力はUIWebViewを使うことができますが、UIWebView内の通信ではレスポンスとしてステータスコードが取得できません。</p>

<p>そのため、OAuthサーバーに登録したリダイレクトURLをあらかじめiOSアプリ側で保存しておき、リダイレクト処理が実行されようとする際に、リダイレクトされようとするURLとあらかじめ保存していたURLとを比較することによってUIWebViewのリダイレクトの通信をキャンセルし、必要があればNSURLConnectionで別途通信を行いレスポンスを取得します。</p>

<h2>
<span id="実装例" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E4%BE%8B"><i class="fa fa-link"></i></a>実装例</h2>

<p>具体的な実装例はGoogleのOAuthライブラリであるGTMOAuth2ViewControllerTouch.mから、UIWebViewがOAuthサービス側からのリダイレクト命令をうけた際に、UIWebViewのdelegateであるwebView:shouldStartLoadWithRequest:navigationType:が実行されるため、リダイレクトしようとする際に処理を挟んでリダイレクトをキャンセルしているのがわかると思います</p>

<div class="code-frame" data-lang="objectivec">
<div class="code-lang"><span class="bold">GTMOAuth2ViewControllerTouch.m</span></div>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">webView:</span><span class="p">(</span><span class="bp">UIWebView</span> <span class="o">*</span><span class="p">)</span><span class="nv">webView</span>
  <span class="nf">shouldStartLoadWithRequest:</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">request</span>
              <span class="nf">navigationType:</span><span class="p">(</span><span class="n">UIWebViewNavigationType</span><span class="p">)</span><span class="nv">navigationType</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hasDoneFinalRedirect_</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//まだアクセストークンを取得するためのリダイレクトがされていなければ</span>
    <span class="c1">//リクエストからリダイレクトさせるかを判定させてアクセストークンを取得させる</span>
    <span class="n">hasDoneFinalRedirect_</span> <span class="o">=</span> <span class="p">[</span><span class="n">signIn_</span> <span class="nl">requestRedirectedToRequest</span><span class="p">:</span><span class="n">request</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">hasDoneFinalRedirect_</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//UIWebViewのリクエストをキャンセルさせる（この時点でアクセストークンは取得済み）</span>
      <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>

<p>[signIn_ requestRedirectedToRequest:request];のrequestRedirectedToRquest:メソッドについて掘り下げましょう。この中では保持していたURLとリダイレクトされようとしたURLを比較しています。</p>

<div class="code-frame" data-lang="objectivec">
<div class="code-lang"><span class="bold">GTMOAuth2SignIn.m</span></div>
<div class="highlight"><pre><span></span><span class="c1">// リダイレクトURLとして指定したコールバックURLなら</span>
<span class="c1">// このメソッドはアクセストークンを取得しYESを返す</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">requestRedirectedToRequest:</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">redirectedRequest</span> <span class="p">{</span>

  <span class="c1">//あらかじめ保持しているリダイレクトURLをNSStringとしてローカルに保持</span>
  <span class="bp">NSString</span> <span class="o">*</span><span class="n">redirectURI</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">authentication</span><span class="p">.</span><span class="n">redirectURI</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">redirectURI</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>

  <span class="c1">//ここではGoogle特有のRedirectURIと同じかどうかをチェックしている。</span>
  <span class="c1">//今回の話とは関係ない</span>
  <span class="bp">NSString</span> <span class="o">*</span><span class="n">standardURI</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">self</span> <span class="k">class</span><span class="p">]</span> <span class="n">nativeClientRedirectURI</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">standardURI</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">redirectURI</span> <span class="nl">isEqual</span><span class="p">:</span><span class="n">standardURI</span><span class="p">])</span> <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>

  <span class="c1">//あらかじめ保持していたリダイレクトURLをNSURLにしておく（比較のため）</span>
  <span class="bp">NSURL</span> <span class="o">*</span><span class="n">redirectURL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="n">redirectURI</span><span class="p">];</span>
  <span class="c1">//リクエストしようとしたURLをNSURLにしておく（比較のため）</span>
  <span class="bp">NSURL</span> <span class="o">*</span><span class="n">requestURL</span> <span class="o">=</span> <span class="p">[</span><span class="n">redirectedRequest</span> <span class="n">URL</span><span class="p">];</span>

  <span class="c1">//リクエストしようとしたURLをhostとパスに分ける、分けて比較するのは</span>
  <span class="c1">//about:blankを指定した際に分ける必要があったから？</span>
  <span class="bp">NSString</span> <span class="o">*</span><span class="n">requestHost</span> <span class="o">=</span> <span class="p">[</span><span class="n">requestURL</span> <span class="n">host</span><span class="p">];</span>
  <span class="bp">NSString</span> <span class="o">*</span><span class="n">requestPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">requestURL</span> <span class="n">path</span><span class="p">];</span>

  <span class="c1">//リクエストしようとしたURLが保持していたURLと同じならコールバックURLとしてYESにする</span>
  <span class="kt">BOOL</span> <span class="n">isCallback</span><span class="p">;</span>
  <span class="c1">//</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">requestHost</span> <span class="o">&amp;&amp;</span> <span class="n">requestPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//ここで比較</span>
    <span class="n">isCallback</span> <span class="o">=</span> <span class="p">[[</span><span class="n">redirectURL</span> <span class="n">host</span><span class="p">]</span> <span class="nl">isEqual</span><span class="p">:[</span><span class="n">requestURL</span> <span class="n">host</span><span class="p">]]</span>
                 <span class="o">&amp;&amp;</span> <span class="p">[[</span><span class="n">redirectURL</span> <span class="n">path</span><span class="p">]</span> <span class="nl">isEqual</span><span class="p">:[</span><span class="n">requestURL</span> <span class="n">path</span><span class="p">]];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">requestURL</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle "about:blank"</span>
    <span class="n">isCallback</span> <span class="o">=</span> <span class="p">[</span><span class="n">redirectURL</span> <span class="nl">isEqual</span><span class="p">:</span><span class="n">requestURL</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">isCallback</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// tell the caller that this request is nothing interesting</span>
    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// we've reached the callback URL</span>

  <span class="c1">// try to get the access code</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">self</span><span class="p">.</span><span class="n">hasHandledCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//クエリパラメータをリクエストしようとしたオブジェクトから取得</span>
    <span class="bp">NSString</span> <span class="o">*</span><span class="n">responseStr</span> <span class="o">=</span> <span class="p">[[</span><span class="n">redirectedRequest</span> <span class="n">URL</span><span class="p">]</span> <span class="n">query</span><span class="p">];</span>
    <span class="c1">//</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">authentication</span> <span class="nl">setKeysForResponseString</span><span class="p">:</span><span class="n">responseStr</span><span class="p">];</span>

<span class="cp">#if DEBUG</span>
    <span class="n">NSAssert</span><span class="p">([</span><span class="nb">self</span><span class="p">.</span><span class="n">authentication</span><span class="p">.</span><span class="n">code</span> <span class="n">length</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
             <span class="o">||</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">authentication</span><span class="p">.</span><span class="n">errorString</span> <span class="n">length</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s">@"response lacks auth code or error"</span><span class="p">);</span>
<span class="cp">#endif</span>
    <span class="c1">//アクセストークンを取得するリクエストを実行</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">authCodeObtained</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="c1">// tell the delegate that we did handle this request</span>
  <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</div>

<p>ちなみに、クエリにある認可コードはURLエンコードされているので、UTF8でデコードしてあげています</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">+</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">unencodedOAuthParameterForString:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">str</span> <span class="p">{</span>
  <span class="bp">NSString</span> <span class="o">*</span><span class="n">plainStr</span> <span class="o">=</span> <span class="p">[</span><span class="n">str</span> <span class="nl">stringByReplacingPercentEscapesUsingEncoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span><span class="p">];</span>
  <span class="k">return</span> <span class="n">plainStr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>

<p>OAuthの説明においてあやふやな部分や、間違っている箇所があればコメントもしくは編集リクエストなどでご指摘頂ければと思います</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>デジタル・アイデンティティ技術最新動向（2）：RFCとなった「OAuth 2.0」――その要点は？ (1/2) - ＠IT<br>
<a href="http://www.atmarkit.co.jp/ait/articles/1209/10/news105.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.atmarkit.co.jp/ait/articles/1209/10/news105.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>137</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/11be7daeee0a7cd093c6">iOSアプリ開発でアプリデザイン経験のない人にデザインの納品物をお願いするときのリスト</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-19 00:14:56</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[Design]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>このTipsはiOSアプリ開発時に納品物定義をする際のリストです。デザインをお願いする他社のデザイナさんがiOSアプリなどの経験がない場合、どのような納品形態として成果物を納めてもらうかということでよく話題になるのでその項目を残しています（同じ社内にいるメンバーの場合は適当にコミュニケーションをとることやググレカスで解決すると思いますが…）。</p>

<p>ですので、デザインに対する細かい指示というよりもそもそも納品物として何がいるんだっけ、どう指定しておけば面倒が増えないんだっけということを書いています。</p>

<p>前提としてディレクターが作ったワイヤーフレームもしくは画面遷移図があり、そのドキュメントを元に他社のデザイナさんとのやりとりがあった後に納品というフェイズがあることを想定しています。</p>

<p>以下がその本文</p>

<hr>

<h1>
<span id="納品物定義" class="fragment"></span><a href="#%E7%B4%8D%E5%93%81%E7%89%A9%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>納品物定義</h1>

<h2>
<span id="納品物" class="fragment"></span><a href="#%E7%B4%8D%E5%93%81%E7%89%A9"><i class="fa fa-link"></i></a>納品物</h2>

<ul>
<li><p>画面全体のデザインとしてのPSDファイル<br>
（納品物として管理するために必要となります。ファイル名は日本語名でかまいません）</p></li>
<li><p>画面ごとのデザインが分かるJPEGファイル<br>
（画面ごとのデザインの確認用に使用します。ファイル名は日本語名でかまいません）</p></li>
<li><p>ボタンや背景画像など各パーツをPNGファイルとして出力したもの<br>
（開発側で使用します。ファイル名ルールについては下記参照）</p></li>
</ul>

<h2>
<span id="備考" class="fragment"></span><a href="#%E5%82%99%E8%80%83"><i class="fa fa-link"></i></a>備考</h2>

<ul>
<li><p>PSDファイルの互換性はPhotoshop CSで開けるファイルでお願いします。</p></li>
<li><p>画面イメージは横画面サイズを640px（iPhone4, iPhone4S, iPhone5相当）で作成をお願いします。</p></li>
<li><p>各パーツの縦横サイズはRetina相当のPNGファイルと、非Retina相当のPNGファイルを2つをお願いします</p></li>
<li><p>PNGファイルの命名はRetina相当のものについては<a href="/2x" class="user-mention js-hovercard" title="2x" data-hovercard-target-type="user" data-hovercard-target-name="2x">@2x</a>をつけてください</p></li>
<li><p>PNGファイルのファイル名はアルファベットすべて小文字で文字の区切りはアンダースコアでお願いします<br>
（例:<a href="mailto:button_back@2x.png" class="autolink">button_back@2x.png</a>)</p></li>
<li><p>Ratian素材の縦横画像サイズは必ず偶数にしてください</p></li>
<li><p>ナビゲーションバーのボタン内の画像は、上下左右の余白なくお願いします。</p></li>
<li><p>タブバーの画像については次のサイトを参考にして下さい <a href="http://golog.plus.vc/web/5866/" class="autolink" rel="nofollow noopener" target="_blank">http://golog.plus.vc/web/5866/</a></p></li>
<li><p>ActivityIndictorはiOSの標準にあるので素材として必要ありません</p></li>
<li><p>セル右側のアクセサリー"&gt;"等は標準のものであれば素材として必要ありません</p></li>
</ul>

<hr>

<p>このような内容をそのまま納品物定義として送っています。</p>

<h1>
<span id="お願いする内容について" class="fragment"></span><a href="#%E3%81%8A%E9%A1%98%E3%81%84%E3%81%99%E3%82%8B%E5%86%85%E5%AE%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>お願いする内容について</h1>

<p>Photoshop CS以降は互換性があるために、CS以降で開けるファイルとお願いすれば良いらしいです。解像度は指定していませんがデザインするキャンバス自体の横サイズを640pxにしてデザインを作成してもらえばRetinaと同じピクセルとなるので、それぞれの素材の解像度が低いということは無い気がします。ファイル名はそのままアプリに組み込みたいので日本語などで作成してもらわず、大文字小文字の区別もしたくないのですべて小文字で作成してもらったほうが楽です。</p>

<p>また、PSDファイルや確認だけできればよいJPEGファイルに独自ルールのアルファベットの名前を付けられることがありますが、これは解りづらいだけです（バージョン管理するなら別かもしれませんが）。</p>

<p>画像のサイズについてRatinaを偶数にする理由は、もし奇数だった場合に非Ratinaのサイズが奇数の半分で小数点以下になってしまうからです。</p>

<p>ナビゲーションバー、ActivityIndicatorやセルなどはなるべく正しい名前を使って指示します。ググってもらえればそれがなにか分かるはずですし、わかりやすくしようと”ぐるぐるのやつ”、"上のバー"などの言葉をつかってしまったりすると逆に混乱を招いたりします。</p>

<p>この他にもこういう勘違いがおこるからこうしたらいいよ！などのご意見があればコメントでお願いします。追記していきます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>122</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/d9409d83fecf9875061d">ViewControllerで戻るボタンのタップを検知する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-30 19:16:46</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ViewControllerによって自動で生成された戻るボタンをユーザーに押された時の処理を検知したいときに調べたメモ。みなさんもユーザーのログ関係でそういうことをしないといけない要件があったりするのではないかなと。</p>

<p>StackOverflowみるといくつか方法があった<br>
<a href="http://stackoverflow.com/questions/5217992/back-button-callback-in-navigationcontroller-in-ios" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/5217992/back-button-callback-in-navigationcontroller-in-ios</a></p>

<p>3つ紹介しておく。</p>

<h2>
<span id="viewwilldisappear時に判定" class="fragment"></span><a href="#viewwilldisappear%E6%99%82%E3%81%AB%E5%88%A4%E5%AE%9A"><i class="fa fa-link"></i></a>viewWillDisappear:時に判定</h2>

<p>viewWillDisappear:時に自分自身がnavigationControllerのコンテナに追加されているかを判定することによって検出できる</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewWillDisappear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">navigationController</span><span class="p">.</span><span class="n">viewControllers</span> <span class="nl">containsObject</span><span class="p">:</span><span class="nb">self</span><span class="p">])</span> <span class="p">{</span>
        <span class="c1">//戻るを押された</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"back"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nb">super</span> <span class="nl">viewWillDisappear</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>viewWillDisappear:はライフサイクルとして動作しているメソッドなので、戻るを押されてこのViewControllerがpopされた後に動作するためこの判定でも検知はできるが、下記のようなお約束の上で成り立っている</p>

<ul>
<li>ViewControllerがpopされた</li>
<li>popされたから画面から消える</li>
<li>画面から消えるからviewWillDisappear:が動作する</li>
<li>ViewControllerが破棄される</li>
</ul>

<p>仕様上、popされた際に必ずviewWillDisappear:が起きるわけではなく、画面の表示が無くなった際に動作するので順番的には妥当っぽく見える。</p>

<p>上手く説明できないけど、ライフサイクルに依存するのは少し綱渡り的な気がするし人に教える時はこの方法はやめとくかな。</p>

<p>Appleのリファレンスを調べると、ライフサイクルを使う方法にはもうひとつやり方がある。それはisMovingFromParentViewControllerプロパティを調べるやり方で、このプロパティ自体の説明としても妥当な使い方をしている</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidDisappear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="nl">viewDidDisappear</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">isMovingFromParentViewController</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//親から削除されているかどうかなので戻るだけでなく閉じても判定</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"isMovingFromParentViewController"</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div></div>

<p>ただ、これは戻るボタンのタップ以外に、この親ViewControllerがモーダルの場合には「戻るボタン」だけでなく閉じても動作して同じように判定してしまう。</p>

<h2>
<span id="didmovetoparentviewcontrollerで判断" class="fragment"></span><a href="#didmovetoparentviewcontroller%E3%81%A7%E5%88%A4%E6%96%AD"><i class="fa fa-link"></i></a>didMoveToParentViewController:で判断</h2>

<p>didMoveToParentViewController:メソッドはコンテナがViewControllerを追加した後にその追加されたViewControllerで実行される。これを使えばpopされたとこを検知できるので戻るを判定できる（モーダルで閉じるにしても動作しない）。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//追加もしくは削除された後に動作する</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">didMoveToParentViewController:</span><span class="p">(</span><span class="bp">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">parent</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">parent</span> <span class="nl">isEqual</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">parentViewController</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"back"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>最初self.parentViewControllerはnilだろうしnilかどうかで判断すればいいのでは...と思ったがこのメソッドの前に他のコンテナに追加されnilでないこともあるんだろう。</p>

<p>また、削除された時はdidMoveToParentViewController:の引数parent自体がnilのはずなのでparentがnilだったら削除されてると判断できなくもない気がする。より厳密さを求めて特定の親ViewControllerを比較したいためにisEqaul:メソッドで比較しているのだと思う（ただ戻るを押した際の動作的にはnilとnilの比較になっていた）。</p>

<p>didMoveToParentViewController:ってどんなんだっけとググったら昔書いた自分のメモがあった<br>
<a href="http://qiita.com/yimajo/items/a5e16fa0f9c332a55ccf" class="autolink" id="reference-59eb4328f29deb324b4b">http://qiita.com/yimajo/items/a5e16fa0f9c332a55ccf</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>115</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/34d6ba63e4eadfc8f421">UIWebViewの上下フリックでツールバーを表示したりしなかったり</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-21 10:53:34</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>SmartNewsやPintrestを見ているとスクロールに応じてツールバー（もしくはタブ）を表示したりしなかったりしている。</p>

<p>これは、UIWebViewの下を見ようとフリックしていく際にはツールバーを消し、逆に上を見ようとフリックした際にはツールバーを表示していて、iPhoneの狭い画面でもなるべく広く使うためのテクニックになっている。</p>

<p><a href="https://camo.qiitausercontent.com/134208b77c8dab89a65486f3b981bda3d58877e0/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f65623765313836306530306563636137333364303033343365636566623638662f74756d626c725f6d6a7a6c7035696e387831717a7a616f376f315f3430302e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/134208b77c8dab89a65486f3b981bda3d58877e0/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f65623765313836306530306563636137333364303033343365636566623638662f74756d626c725f6d6a7a6c7035696e387831717a7a616f376f315f3430302e6a7067" alt="" data-canonical-src="http://24.media.tumblr.com/eb7e1860e00ecca733d00343ecefb68f/tumblr_mjzlp5in8x1qzzao7o1_400.jpg"></a></p>

<p>↑このツールバーは常に表示する必要がないので出したり出さなかったり</p>

<h2>
<span id="仕様をまとめる" class="fragment"></span><a href="#%E4%BB%95%E6%A7%98%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>仕様をまとめる</h2>

<ul>
<li>
<p>画面の下を見ようとする動作でツールバー消す</p>

<ul>
<li>上に向けてフリック</li>
<li>スクロール後のy軸オフセット値がスクロール前より増える</li>
<li>=&gt;スクロールビューのdelegateでオフセット値を計算</li>
<li>=&gt; scrollViewWillBeginDragging:でスクロールし始めを取得</li>
<li>=&gt; scrollViewDidScroll:でスクロール後に増えてたら消す</li>
</ul>
</li>
<li>
<p>画面の上に戻ろうとする動作でツールバーを表示</p>

<ul>
<li>下に向けてフリック</li>
<li>スクロール後のy軸オフセット値がスクロール前より減る</li>
<li>=&gt;スクロールビューのdelegateでオフセット値を計算</li>
<li>=&gt; scrollViewWillBeginDragging:でスクロールし始めを取得</li>
<li>=&gt; scrollViewDidScroll:でスクロール後に増えてたら表示</li>
</ul>
</li>
<li>
<p>ツールバーはアニメーションで消す</p>

<ul>
<li>すでにアニメーションが行われていれば割り込まない</li>
<li>=&gt;フラグもしくは列挙体でステータスを制御</li>
</ul>
</li>
</ul>

<h2>
<span id="コード" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>コード</h2>

<p>スクロールのステータスを表すenumを用意しておく</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
    <span class="n">QVToolBarScrollStatusInit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">QVToolBarScrollStatusAnimation</span> <span class="p">,</span>
<span class="p">}</span><span class="n">QVToolBarScrollStatus</span><span class="p">;</span>
</pre></div></div>

<p>スクロールしはじめのオフセット値を保持するプロパティを用意</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="k">@property</span><span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="n">CGFloat</span> <span class="n">beginScrollOffsetY</span><span class="p">;</span>
</pre></div></div>

<p>UIScrollViewのdelegateを実装して計算</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="c1">//スクロールビューをドラッグし始めた際に一度実行される</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">scrollViewWillBeginDragging:</span><span class="p">(</span><span class="bp">UIScrollView</span> <span class="o">*</span><span class="p">)</span><span class="nv">scrollView</span><span class="p">;</span>
<span class="p">{</span>    
    <span class="nb">self</span><span class="p">.</span><span class="n">beginScrollOffsetY</span> <span class="o">=</span> <span class="p">[</span><span class="n">scrollView</span> <span class="n">contentOffset</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//スクロールビューがスクロールされるたびに実行され続ける</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">scrollViewDidScroll</span><span class="p">:(</span><span class="bp">UIScrollView</span> <span class="o">*</span><span class="p">)</span><span class="n">scrollView</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">QVToolBarScrollStatusAnimation</span> <span class="o">==</span> <span class="nb">self</span><span class="p">.</span><span class="n">toolBarScrollStatus</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">beginScrollOffsetY</span> <span class="o">&lt;</span> <span class="p">[</span><span class="n">scrollView</span> <span class="n">contentOffset</span><span class="p">].</span><span class="n">y</span>
        <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">self</span><span class="p">.</span><span class="n">toolBar</span><span class="p">.</span><span class="n">hidden</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//スクロール前のオフセットよりスクロール後が多い=下を見ようとした =&gt;スクロールバーを隠す</span>
        <span class="p">[</span><span class="bp">UIView</span> <span class="nl">animateWithDuration</span><span class="p">:</span><span class="mf">0.4</span> <span class="nl">animations</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">toolBarScrollStatus</span> <span class="o">=</span> <span class="n">QVToolBarScrollStatusAnimation</span><span class="p">;</span>

            <span class="bp">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">toolBar</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">toolBar</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                                            <span class="n">rect</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">,</span>
                                            <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
                                            <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
        <span class="p">}</span> <span class="nl">completion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">toolBar</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">toolBarScrollStatus</span> <span class="o">=</span> <span class="n">QVToolBarScrollStatusInit</span><span class="p">;</span>
        <span class="p">}];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">scrollView</span> <span class="n">contentOffset</span><span class="p">].</span><span class="n">y</span> <span class="o">&lt;</span> <span class="nb">self</span><span class="p">.</span><span class="n">beginScrollOffsetY</span>
               <span class="o">&amp;&amp;</span> <span class="nb">self</span><span class="p">.</span><span class="n">toolBar</span><span class="p">.</span><span class="n">hidden</span>
               <span class="o">&amp;&amp;</span> <span class="mf">0.0</span> <span class="o">!=</span> <span class="nb">self</span><span class="p">.</span><span class="n">beginScrollOffsetY</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="p">.</span><span class="n">toolBar</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
        <span class="p">[</span><span class="bp">UIView</span> <span class="nl">animateWithDuration</span><span class="p">:</span><span class="mf">0.4</span> <span class="nl">animations</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">toolBarScrollStatus</span> <span class="o">=</span> <span class="n">QVToolBarScrollStatusAnimation</span><span class="p">;</span>

            <span class="bp">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">toolBar</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">toolBar</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
                                            <span class="n">rect</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">,</span>
                                            <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
                                            <span class="n">rect</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
        <span class="p">}</span> <span class="nl">completion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>

            <span class="nb">self</span><span class="p">.</span><span class="n">toolBarScrollStatus</span> <span class="o">=</span> <span class="n">QVToolBarScrollStatusInit</span><span class="p">;</span>
        <span class="p">}];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>96</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/2fa3f814d667af62d73e">iOSアプリ開発でもゆるくJenkinsを使う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-16 18:44:58</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iOS]</b> <b>[Jenkins]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>開発中のプロジェクトをビルドできない状態でリモートリポジトリにPushしてしまったことや、自分や同僚が書いたTODO・FIXMEなどのコメントを集計したいと思ったことはありませんか？</p>

<p>このTipsでは、現状一番楽なJenkinsのインストール方法とJenkinsで出来る下記の事柄について説明しています</p>

<ul>
<li>Gitからのチェックアウト</li>
<li>Xcodeプロジェクトのビルド</li>
<li>ソースコード中のTODOコメントの抽出</li>
<li>ビルド失敗時のメール通知</li>
</ul>

<h2>
<span id="jenkinsのインストール" class="fragment"></span><a href="#jenkins%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Jenkinsのインストール</h2>

<p>Jenkinsはターミナルからhomebrewを使ってインストールします。<br>
アンインストールもhomebrewからできるので安心ですね。</p>

<p>インストールは下記のコマンドで実行します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew install jenkins
</pre></div></div>

<p>実行後には次のようなメッセージが出ます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>==&gt; Downloading http://mirrors.jenkins-ci.org/war/1.498/jenkins.war
######################################################################## 100.0%
==&gt; Caveats
To have launchd start jenkins at login:
    ln -sfv /usr/local/opt/jenkins/*.plist ~/Library/LaunchAgents
Then to load jenkins now:
    launchctl load ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist
Or, if you don't want/need launchctl, you can just run:
    java -jar /usr/local/opt/jenkins/libexec/jenkins.war
</pre></div></div>

<p>インストール後にJenkinsを利用する方法について書かれています。<br>
これによると大まかには2つの方法があり</p>

<p>・launchctl(デーモンのコントローラ)でログイン時に自動で起動<br>
・手動でwarファイルから起動</p>

<p>となっているようです。<br>
まず、1つ目の方法としてlaunchctlから実行させる方法は<br>
そのまま次の通り</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ln -sfv /usr/local/opt/jenkins/*.plist ~/Library/LaunchAgents
$ launchctl load ~/Library/LaunchAgents/homebrew.mxcl.jenkins.plist
</pre></div></div>

<p>lnコマンドでシンボリックリンクをつくり、launchctlに設定をロードさせています。</p>

<p>もしとりあえず動かしたいだけであれば、javaコマンドでwarファイルを指定する方法でよいでしょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ java -jar /usr/local/opt/jenkins/libexec/jenkins.war
</pre></div></div>

<p>デフォルトでポート8080で起動するようなので、<br>
確認には <a href="http://127.0.0.1:8080/" class="autolink" rel="nofollow noopener" target="_blank">http://127.0.0.1:8080/</a> にアクセスしてみてください。</p>

<h2>
<span id="プラグインの導入" class="fragment"></span><a href="#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>プラグインの導入</h2>

<p>Jenkinsはプラグインを導入することで機能を拡張し、<br>
色々な開発環境に対応するため、まずはプラグインをインストールします。</p>

<p>・Jenkins Git plugin<br>
・XCode integration<br>
・Task Scanner Plug-in (未解決タスクの集計)</p>

<p>これらプラグインの利用用途として<br>
gitプラグインで特定のリポジトリからプロジェクトをチェックアウト、<br>
Xcodeプラグインでビルド、<br>
ビルド後に未解決タスクの集計プラグインで集計するようになります。</p>

<h3>
<span id="プラグインの導入-1" class="fragment"></span><a href="#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E5%B0%8E%E5%85%A5-1"><i class="fa fa-link"></i></a>プラグインの導入</h3>

<p>[Jenkinsの管理][プラグインの管理]を選択してください</p>

<p><a href="https://camo.qiitausercontent.com/f654567f9253b82e742778748c6e82904c601c05/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f38626265356437393363303635613664326132336638373433666133656163662f74756d626c725f6d693632666a7850754331717a7a616f376f315f3530302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f654567f9253b82e742778748c6e82904c601c05/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f38626265356437393363303635613664326132336638373433666133656163662f74756d626c725f6d693632666a7850754331717a7a616f376f315f3530302e706e67" alt="" data-canonical-src="http://24.media.tumblr.com/8bbe5d793c065a6d2a23f8743fa3eacf/tumblr_mi62fjxPuC1qzzao7o1_500.png"></a></p>

<p>利用可能な一覧を表示します。</p>

<p><a href="https://camo.qiitausercontent.com/4a9c733761089efe010976203d621d36c0692314/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f39346162396138623336643735636131653835663130336235343633613564392f74756d626c725f6d6936326d63476a424e31717a7a616f376f315f3530302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4a9c733761089efe010976203d621d36c0692314/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f39346162396138623336643735636131653835663130336235343633613564392f74756d626c725f6d6936326d63476a424e31717a7a616f376f315f3530302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/94ab9a8b36d75ca1e85f103b5463a5d9/tumblr_mi62mcGjBN1qzzao7o1_500.png"></a></p>

<p>この利用可能な一覧から下記を選択しインストールします</p>

<p>・Jenkins Git plugin<br>
・XCode integration (SICCI for Xcode Pluginではないので注意)<br>
・Task Scanner Plug-in(未解決タスクの集計)</p>

<h2>
<span id="ジョブの設定" class="fragment"></span><a href="#%E3%82%B8%E3%83%A7%E3%83%96%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ジョブの設定</h2>

<p>Jenkinsダッシュボードに戻り[新規ジョブ作成]からジョブ名を入力し、フリースタイル・プロジェクトのビルドを選択します。</p>

<h2>
<span id="プラグインの設定" class="fragment"></span><a href="#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>プラグインの設定</h2>

<h3>
<span id="git-pulginの設定" class="fragment"></span><a href="#git-pulgin%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>Git pulginの設定</h3>

<p><a href="https://camo.qiitausercontent.com/7d835c58afce8f2f1424c1cf29b8bec1f5644cdb/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f34373562613962353664346631393262383765333563623336323561376637302f74756d626c725f6d696230656a4273597531717a7a616f376f315f3530302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7d835c58afce8f2f1424c1cf29b8bec1f5644cdb/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f34373562613962353664346631393262383765333563623336323561376637302f74756d626c725f6d696230656a4273597531717a7a616f376f315f3530302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/475ba9b56d4f192b87e35cb3625a7f70/tumblr_mib0ejBsYu1qzzao7o1_500.png"></a></p>

<p>Jenkins Git pluginでは主にチェックアウトするリポジトリのパスとbranchを指定します。</p>

<p>また、SCMをポーリングする時間をスケジュール項目でcronでの時間設定のように指定できます。<br>
この例では15分間隔としていて、15分毎にリポジトリに変更がある際にチェックアウトしビルドを行います。</p>

<h3>
<span id="xcode-integrationの設定" class="fragment"></span><a href="#xcode-integration%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>Xcode integrationの設定</h3>

<p><a href="https://camo.qiitausercontent.com/94e18a1dbbb3c5034cab703fdbd00d3a88ee2b58/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f30363635343265333762343463313063313865633063383166643531643439372f74756d626c725f6d69623070656d49485531717a7a616f376f315f3530302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/94e18a1dbbb3c5034cab703fdbd00d3a88ee2b58/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f30363635343265333762343463313063313865633063383166643531643439372f74756d626c725f6d69623070656d49485531717a7a616f376f315f3530302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/066542e37b44c10c18ec0c81fd51d497/tumblr_mib0pemIHU1qzzao7o1_500.png"></a></p>

<p>Xcode integrationプラグインではチェックアウトしたプロジェクトのビルド設定を行います。<br>
最低限必要なのはTarget、Configurationでしょうか。必要であればIPAファイルを出力するようにできます。<br>
(もしKeychain pathがデフォルトで入力されていなければここで入力します）</p>

<p>また、Jenkinsではジョブ用にワークスペースというディレクトリを作成し、<br>
そこを基準にチェックアウトしてきた構成をビルドしようとします。<br>
そのため、このXcode integrationプラグインで設定する各種パスは、<br>
そのワークスペースが起点になっているようです。</p>

<h3>
<span id="task-scanner-pulg-inの設定" class="fragment"></span><a href="#task-scanner-pulg-in%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>Task Scanner Pulg-inの設定</h3>

<p><a href="https://camo.qiitausercontent.com/3f2aa7f7093ef547666633dea6f7d88c0fd05dd4/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f66653338323665343861313839656465313938663836663164383863336361312f74756d626c725f6d69623132624545676b31717a7a616f376f315f3530302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3f2aa7f7093ef547666633dea6f7d88c0fd05dd4/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f66653338323665343861313839656465313938663836663164383863336361312f74756d626c725f6d69623132624545676b31717a7a616f376f315f3530302e706e67" alt="" data-canonical-src="http://24.media.tumblr.com/fe3826e48a189ede198f86f1d88c3ca1/tumblr_mib12bEEgk1qzzao7o1_500.png"></a></p>

<p>Task Scanner Plug-inではTODOコメントなどを集計するファイル名、<br>
また集計する対象となるタグを設定します。</p>

<p>ファイル名はObjective-Cの実装ファイルを対象とするため、ワイルドカードを使い</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>**/*.m
</pre></div></div>

<p>タグはFIXMEやTODOなど優先度を分け、大文字小文字の判別を無視するようにするのが良いでしょう。</p>

<p>なお、高度な設定からデフォルトエンコーディングを選べるため、そこでUTF-8にしておかないと、<br>
抽出されるTODOコメントなどで日本語の文字化けが起こってしまいます。</p>

<p>ビルドが成功すると未解決タスクは次のように表示されるので、ソースコードに書かれたタスクも無理なく常時把握できますね。</p>

<p><a href="https://camo.qiitausercontent.com/d9743b1082e4624d8b5f0aa3a49e9b746e4acd53/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f37343463663835346165663630383861383434353436333034613163653563332f74756d626c725f6d696437336d3245645831717a7a616f376f315f3530302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d9743b1082e4624d8b5f0aa3a49e9b746e4acd53/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f37343463663835346165663630383861383434353436333034613163653563332f74756d626c725f6d696437336d3245645831717a7a616f376f315f3530302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/744cf854aef6088a844546304a1ce5c3/tumblr_mid73m2EdX1qzzao7o1_500.png"></a></p>

<h2>
<span id="メールによる通知" class="fragment"></span><a href="#%E3%83%A1%E3%83%BC%E3%83%AB%E3%81%AB%E3%82%88%E3%82%8B%E9%80%9A%E7%9F%A5"><i class="fa fa-link"></i></a>メールによる通知</h2>

<p>デフォルトではビルド失敗時とビルド失敗から正常に戻った際の2つのタイミングでメールを通知することができます。</p>

<p>まず「Jenkinsの管理」「システムの設定」「E-mail通知」からSMTPサーバの設定を入力しておきます。<br>
<a href="https://camo.qiitausercontent.com/ead467213600f1cf3c53cf332264806e26ac8e3b/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f36613337663931336666383435356233616363393634356630313261306431392f74756d626c725f6d6964366b646c57703731717a7a616f376f315f313238302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ead467213600f1cf3c53cf332264806e26ac8e3b/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f36613337663931336666383435356233616363393634356630313261306431392f74756d626c725f6d6964366b646c57703731717a7a616f376f315f313238302e706e67" alt="" data-canonical-src="http://24.media.tumblr.com/6a37f913ff8455b3acc9645f012a0d19/tumblr_mid6kdlWp71qzzao7o1_1280.png"></a></p>

<p>私はSMTPサーバとしてgmailを使っているので、自分のgmailアカウントのメールアドレスをSMTPユーザ名、返信先アドレスに入力しています。</p>

<p>さらに、個々のジョブのビルド設定から「ビルド後の処理の追加」を「E-mail通知」を選択し、メールの宛先を入力を指定します</p>

<p><a href="https://camo.qiitausercontent.com/f3d09fdc375ab4652544f0a51e42d067c334526f/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f65646163633934613361616330396539316465336365396465363937303133632f74756d626c725f6d696437347139454d7531717a7a616f376f315f313238302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f3d09fdc375ab4652544f0a51e42d067c334526f/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f65646163633934613361616330396539316465336365396465363937303133632f74756d626c725f6d696437347139454d7531717a7a616f376f315f313238302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/edacc94a3aac09e91de3ce9de697013c/tumblr_mid74q9EMu1qzzao7o1_1280.png"></a></p>

<p>ビルドが失敗した際と、失敗してから正常にビルドできるようになった際の2パターンメールが通知されます。</p>

<h2>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h2>

<h2>
<span id="ビルド用のmacを買う必要があるか" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E7%94%A8%E3%81%AEmac%E3%82%92%E8%B2%B7%E3%81%86%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>ビルド用のMacを買う必要があるか</h2>

<p>iOSアプリ開発のよくある話として、Jenkinsを導入しビルド用にMac OSXのサーバーを購入したくなるとは思いますが、そもそも開発を行なっているローカルのMac OSXにJenkinsをインストールするだけで、ほとんど要は満たせると思います。</p>

<p>まずはローカルのJenkinsでCIに慣れていくっていうのもいいんじゃないでしょうか。</p>

<h2>
<span id="参考url" class="fragment"></span><a href="#%E5%8F%82%E8%80%83url"><i class="fa fa-link"></i></a>参考URL</h2>

<p>Jenkinsのメール通知にGmailを使う | コーヒーサーバは香炉である<br>
<a href="http://blog.maripo.org/2012/07/jenkins-gmail/" class="autolink" rel="nofollow noopener" target="_blank">http://blog.maripo.org/2012/07/jenkins-gmail/</a></p>

<p>Safx: Jenkinsでテストとカバレッジの結果をグラフ表示できるようにする <br>
<a href="http://safx-dev.blogspot.jp/2012/03/jenkins.html" class="autolink" rel="nofollow noopener" target="_blank">http://safx-dev.blogspot.jp/2012/03/jenkins.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>89</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/9bfd25005c1312638b8e">Auto Layoutは結構理解するの大変だよねメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-26 17:02:59</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>自分がAuto Layoutを使ってみた感じでは、回転なしの基礎的なことを習得してプロジェクトに使えるようになるのに6時間位は使ってしまって、これは勉強するの無駄じゃないのって気もしないでもないので折角なら忘れないようにおさらい。</p>

<h1>
<span id="auto-layoutの使いどころ" class="fragment"></span><a href="#auto-layout%E3%81%AE%E4%BD%BF%E3%81%84%E3%81%A9%E3%81%93%E3%82%8D"><i class="fa fa-link"></i></a>Auto Layoutの使いどころ</h1>

<p>Auto Layoutは画面サイズによって複数のUIコンポーネントの座標値がそれぞれ微妙に変化する場合に使える。画面デザインによるが、それ以外はAuto Reisizeと自前での座標値計算を行うことでなんとかなる事が多い。</p>

<p>また、回転を考慮する場合もAuto Layoutのほうが楽かもしれない。</p>

<h3>
<span id="auto-resizeのできること" class="fragment"></span><a href="#auto-resize%E3%81%AE%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>Auto Resizeのできること</h3>

<p>Auto Resizeは親Viewからの相対的な位置と大きさの自動的な適用ができる。</p>

<p>例えば</p>

<ul>
<li>画面の下にToolBarを固定することが出来る</li>
<li>UITableViewCellのなかで画像位置を固定する</li>
</ul>

<p>など</p>

<h3>
<span id="auto-layoutのできること" class="fragment"></span><a href="#auto-layout%E3%81%AE%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>Auto Layoutのできること</h3>

<p>Auto Layoutは親Viewや同階層のViewからの制約をつけることで位置を変更できる。</p>

<p>例えば</p>

<ul>
<li>画面の下にToolBarを固定することが出来る</li>
<li>UITableViewCellのなかで画像位置を固定する</li>
<li>水平方向や垂直方向にViewをセンタリングできる</li>
<li>2つのコンポーネント間の位置制約として&lt;=や&gt;=のような制約もできる</li>
</ul>

<p>2つのコンポーネント間の位置を動的に配置したい（&lt;=や&gt;=で決めたい）場合はRelationで"Greater Than or Equal"や"Less Than or Equal"を指定する。</p>

<h1>
<span id="auto-layoutでハマった時の解決法" class="fragment"></span><a href="#auto-layout%E3%81%A7%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E6%99%82%E3%81%AE%E8%A7%A3%E6%B1%BA%E6%B3%95"><i class="fa fa-link"></i></a>Auto Layoutでハマった時の解決法</h1>

<h2>
<span id="見直しリスト" class="fragment"></span><a href="#%E8%A6%8B%E7%9B%B4%E3%81%97%E3%83%AA%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>見直しリスト</h2>

<ul>
<li>Viewのサイズも制約に与えてみる（frameの値と同じにしてみる）</li>
<li>先に固定位置のコンポーネントから制約を与えて石橋を叩きながら進める</li>
<li>Space Containtで=だけでなく&lt;=や&gt;=を使う時は特にエラーが出やすい

<ul>
<li>位置情報を決定するための条件がまだ抜けている</li>
<li>全ての条件（サイズや固定値との接続）を見直していくと一気に解決する</li>
</ul>
</li>
</ul>

<h2>
<span id="見直しのための覚書" class="fragment"></span><a href="#%E8%A6%8B%E7%9B%B4%E3%81%97%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E8%A6%9A%E6%9B%B8"><i class="fa fa-link"></i></a>見直しのための覚書</h2>

<p>2つのViewの距離感に&lt;=や&gt;=を使う場合が結構わかりづらい。</p>

<p>例えば、AとBのViewががあっとして、AとBの垂直方向の距離Lを<br>
3.5inchディスプレイならば6ptになり、<br>
4inchディスプレイなら20ptになるようにしたいとき、<br>
Space Containtで6&lt;=L&lt;=20とする（Greater Than Equalが6でLess Than Equal が20）。</p>

<p>このとき、Aのy座標値は制約として固定されていないとBの位置が決められないために6&lt;=L&lt;=20を設定してもAmbiguity（不定）になる。逆にBが決まっている場合ならそれでいいが、Bが決まっていないとAmbiguityになる。決められる部分を決めていくとAmbiguityが無くなるので、そこから動的に変わる部分をいじっていく。</p>

<h2>
<span id="さらに具体的な例" class="fragment"></span><a href="#%E3%81%95%E3%82%89%E3%81%AB%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E4%BE%8B"><i class="fa fa-link"></i></a>さらに具体的な例</h2>

<p>次の図に例としてタイトルラベル、アーティストラベル、UIImgeView、iTunesで探すボタンと下にToolBarなどがある構成をあげる。</p>

<p>左が4inchで、右が3.5inchで4inchのときは余白をなるべく分散するようにしたい。</p>

<p><a href="https://camo.qiitausercontent.com/58482b50bc9e48ed045ffd03522ad01dcb0fba52/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37623739613233632d353731662d333533312d346262352d6634623163636439386337342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/58482b50bc9e48ed045ffd03522ad01dcb0fba52/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37623739613233632d353731662d333533312d346262352d6634623163636439386337342e706e67" alt="autolayout1.png" title="autolayout1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/7b79a23c-571f-3531-4bb5-f4b1ccd98c74.png"></a></p>

<p>ナビゲーションバーとタイトルの間を2&lt;=L&lt;=10のように動的にした時、まずエラーになる。解決するため水平位置をどうするかを決め、それからタイトルとアーティストの距離を決める。</p>

<p>アーティストの位置が固定であればそれで終わりだが、アーティストの位置もUIImageViewの位置との制約があるので同じように6&lt;=L&lt;=20とする。UIImageViewの位置が固定だったら終わりだが...という風に繰り返していくと最後に全てのAmbiguityが消える。</p>

<h1>
<span id="まだ飲み込めてないこと" class="fragment"></span><a href="#%E3%81%BE%E3%81%A0%E9%A3%B2%E3%81%BF%E8%BE%BC%E3%82%81%E3%81%A6%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>まだ飲み込めてないこと</h1>

<ul>
<li>Viewのサイズも制約で大きくしたり小さくしたりできるんだろうか</li>
<li>placeholderのサイズ指定がどのように効果的なことになるのか</li>
<li>回転させるときどうやるのか</li>
</ul>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>Apple公式: Auto Layout（PDF）<br>
<a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/AutolayoutPG.pdf" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/jp/devcenter/ios/library/documentation/AutolayoutPG.pdf</a></p>

<p>Developer.IO 特集カテゴリーXcode 5 / Auto Layout<br>
<a href="http://dev.classmethod.jp/referencecat/xcode-5-auto-layout/" class="autolink" rel="nofollow noopener" target="_blank">http://dev.classmethod.jp/referencecat/xcode-5-auto-layout/</a></p>

<p>iOSアプリを作ってみる (8) - Autolayoutに振り回される その1<br>
<a href="http://deutschina.hatenablog.com/entry/2013/09/16/164838" class="autolink" rel="nofollow noopener" target="_blank">http://deutschina.hatenablog.com/entry/2013/09/16/164838</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>82</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/44e55fc3ef1c553213fb">iOSアプリ開発者は知らなきゃヤバイ！「Mixpanel iOS SDK」の導入と設定</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-21 01:10:29</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> <b>[mixpanel]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://www.google.co.jp/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CDcQFjAA&amp;url=https%3A%2F%2Fmixpanel.com%2F&amp;ei=XygGU5mEKsyQkwWdn4GQCA&amp;usg=AFQjCNEwfR7fGT09fq2nWzxGIHCv4etVbw&amp;sig2=xktuVgGTBA_KDJLflEZ8_g" rel="nofollow noopener" target="_blank">Mixpanel</a>というユーザイベントにフォーカスした解析サービスがあって、それのiOS SDKの導入と設定についてのメモ。タイトルは完全に釣りです。</p>

<p>似たようなサービスで<a href="http://dev.flurry.com/" rel="nofollow noopener" target="_blank">Flurry</a>というものもあり、これについては<a href="http://qiita.com/yimajo/items/752f69bba344a68a5f9a" id="reference-9cd43b977651807d0dd1">別の記事で同じように説明している</a>ので比較しても面白いかもしれません。</p>

<h1>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h1>

<p>MixpanelのiOS SDKはcocoapodsでインストールできる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pod 'Mixpanel'
</pre></div></div>

<p>Xcode 4系でiOS SDK 6以下の場合は2.1.1未満を使う必要がある</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pod 'Mixpanel', '&lt; 2.1.1'
</pre></div></div>

<h1>
<span id="ライブラリの初期化" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>ライブラリの初期化</h1>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#import &lt;Mixpanel.h&gt;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
<span class="p">{</span>
    <span class="c1">//最初にトークンで初期化</span>
    <span class="p">[</span><span class="n">Mixpanel</span> <span class="nl">sharedInstanceWithToken</span><span class="p">:</span><span class="s">@"トークン"</span><span class="p">];</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div></div>

<p>トークンはMixpanel管理画面で該当するプロジェクトを作成後、設定画面のManagementのタブからTOKENの項目に書かれている。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//以降はsharedInstanceで呼び出す</span>
<span class="n">Mixpanel</span> <span class="o">*</span><span class="n">mixpanel</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mixpanel</span> <span class="n">sharedInstance</span><span class="p">];</span>
</pre></div></div>

<h1>
<span id="イベントのトラッキング" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>イベントのトラッキング</h1>

<h2>
<span id="通常のトラッキング" class="fragment"></span><a href="#%E9%80%9A%E5%B8%B8%E3%81%AE%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>通常のトラッキング</h2>

<p>イベント名と任意の情報をDictionaryで指定する。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">Mixpanel</span> <span class="o">*</span><span class="n">mixpanel</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mixpanel</span> <span class="n">sharedInstance</span><span class="p">];</span>

<span class="c1">//イベント名のみ指定</span>
<span class="p">[</span><span class="n">mixpanel</span> <span class="nl">track</span><span class="p">:</span><span class="s">@"Play Video"</span><span class="p">];</span>

<span class="c1">//イベント名と任意の情報を指定</span>
<span class="p">[</span><span class="n">mixpanel</span> <span class="nl">track</span><span class="p">:</span><span class="s">@"Plan Selected"</span> <span class="nl">properties</span><span class="p">:</span><span class="l">@{</span>
    <span class="s">@"Gender"</span><span class="o">:</span> <span class="s">@"Female"</span><span class="p">,</span>
    <span class="s">@"Plan"</span><span class="o">:</span> <span class="s">@"Premium"</span>
<span class="l">}</span><span class="p">];</span>


</pre></div></div>

<p>DictionaryのKeyはNSString、ValueはNSString, NSNumber, NSNull, NSArray, NSDictionary, NSDate, NSURLいずれかの必要がある。 </p>

<h2>
<span id="トラッキング項目の固定登録" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0%E9%A0%85%E7%9B%AE%E3%81%AE%E5%9B%BA%E5%AE%9A%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>トラッキング項目の固定登録</h2>

<p>都度送る必要がない場合は、registerSuperProperties:メソッドでDicrionaryの項目を登録しておくことができる。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">Mixpanel</span> <span class="o">*</span><span class="n">mixpanel</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mixpanel</span> <span class="n">sharedInstance</span><span class="p">];</span>

<span class="c1">//登録することで常にこの項目が送られる</span>
<span class="p">[</span><span class="n">mixpanel</span> <span class="nl">registerSuperProperties</span><span class="p">:</span><span class="l">@{</span><span class="s">@"User Type"</span><span class="o">:</span> <span class="s">@"Paid"</span><span class="l">}</span><span class="p">];</span>
</pre></div></div>

<h2>
<span id="一度きりのトラッキング項目" class="fragment"></span><a href="#%E4%B8%80%E5%BA%A6%E3%81%8D%E3%82%8A%E3%81%AE%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0%E9%A0%85%E7%9B%AE"><i class="fa fa-link"></i></a>一度きりのトラッキング項目</h2>

<p>registerSuperProperties:と機能は同じだが、一度きりで良い場合はregisterSuperPropertiesOnce:を使う。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">Mixpanel</span> <span class="o">*</span><span class="n">mixpanel</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mixpanel</span> <span class="n">sharedInstance</span><span class="p">];</span>

<span class="p">[</span><span class="n">mixpanel</span> <span class="nl">registerSuperPropertiesOnce</span><span class="p">:</span><span class="l">@{</span><span class="s">@"source"</span><span class="o">:</span> <span class="s">@"ad-01"</span><span class="l">}</span><span class="p">];</span>
</pre></div></div>

<p>これはキャンペーンなどで利用することを想定している様子。</p>

<h1>
<span id="ユーザーの情報" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E6%83%85%E5%A0%B1"><i class="fa fa-link"></i></a>ユーザーの情報</h1>

<h2>
<span id="idを明示的に指定する" class="fragment"></span><a href="#id%E3%82%92%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AB%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>idを明示的に指定する</h2>

<p>Mixpanelはアプリがインストールされた個々のユーザに対してdistinct IDを割り当てている。identify:メソッドでは任意のIDに置き換えることも出来る。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">Mixpanel</span> <span class="o">*</span><span class="n">mixpanel</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mixpanel</span> <span class="n">sharedInstance</span><span class="p">];</span>

<span class="p">[</span><span class="n">mixpanel</span> <span class="nl">identify</span><span class="p">:</span><span class="s">@"13793"</span><span class="p">];</span>
</pre></div></div>

<p>自分が運営しているウェブサービスのユーザーIDなどであれば端末をまたいで同じIDにできるのでメリットがある。</p>

<h2>
<span id="idをひもづける" class="fragment"></span><a href="#id%E3%82%92%E3%81%B2%E3%82%82%E3%81%A5%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>idをひもづける</h2>

<p>distinct IDと特定の情報をひもづけることが出来る。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mixpanel</span> <span class="nl">createAlias</span><span class="p">:</span><span class="s">@"joe@example.com"</span>
    <span class="nl">forDistinctID</span><span class="p">:</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">distinctId</span><span class="p">];</span>

<span class="p">[</span><span class="n">mixpanel</span> <span class="nl">identify</span><span class="p">:</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">distinctId</span><span class="p">];</span>
</pre></div></div>

<p>例えばこれによって運営しているウェブサービスがなく端末をまたがるidを明示的に指定する事ができなくても、ユニークな特定の情報とdistinct IDを紐付け端末をまたいでユーザーの同定を行うことができる。</p>

<h2>
<span id="ユーザー情報の付加" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E6%83%85%E5%A0%B1%E3%81%AE%E4%BB%98%E5%8A%A0"><i class="fa fa-link"></i></a>ユーザー情報の付加</h2>

<p>distinct IDを指定後、peopleプロパティに任意のDictionaryをセットすることでユーザー情報の指定ができる。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">Mixpanel</span> <span class="o">*</span><span class="n">mixpanel</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mixpanel</span> <span class="n">sharedInstance</span><span class="p">];</span>

<span class="p">[</span><span class="n">mixpanel</span> <span class="nl">identify</span><span class="p">:</span><span class="s">@"13793"</span><span class="p">];</span>

<span class="c1">// Sets user 13793's "Plan" attribute to "Premium"</span>
<span class="p">[</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">people</span> <span class="nl">set</span><span class="p">:</span><span class="l">@{</span><span class="s">@"Plan"</span><span class="o">:</span> <span class="s">@"Premium"</span><span class="l">}</span><span class="p">];</span>
</pre></div></div>

<h2>
<span id="ユーザーの情報を変更する" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ユーザーの情報を変更する</h2>

<p>peopleプロパティのincrement:メソッドで任意の情報の値を変爻することが出来る。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//ユーザー情報の値を変爻することが出来る</span>
<span class="p">[</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">people</span> <span class="nl">increment</span><span class="p">:</span><span class="s">@"point count"</span> <span class="nl">by</span><span class="p">:</span><span class="mi">500</span><span class="p">];</span>

<span class="c1">//NSDictionaryで指定</span>
<span class="p">[</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">people</span> <span class="nl">increment</span><span class="p">:</span><span class="l">@{</span>
    <span class="s">@"dollars spent"</span><span class="o">:</span> <span class="mi">@17</span><span class="p">,</span>
    <span class="s">@"credits remaining"</span><span class="o">:</span> <span class="p">@</span><span class="o">-</span><span class="mi">34</span>
<span class="l">}</span><span class="p">];</span>
</pre></div></div>

<p>例えばゲームアプリであればスコアを変更することや、ダイエットアプリなどであれば体重などユーザー情報を上書きするためのものだと思う。</p>

<h2>
<span id="ユーザーの課金をトラッキングする" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E8%AA%B2%E9%87%91%E3%82%92%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ユーザーの課金をトラッキングする</h2>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mixpanel</span> <span class="nl">identify</span><span class="p">:</span><span class="s">@"13793"</span><span class="p">];</span>

<span class="c1">// $100払ってくれた</span>
<span class="p">[</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">people</span> <span class="nl">trackCharge</span><span class="p">:</span><span class="mi">@100</span><span class="p">];</span>

<span class="c1">// $50払い戻された</span>
<span class="p">[</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">people</span> <span class="nl">trackCharge</span><span class="p">:@</span><span class="o">-</span><span class="mi">50</span><span class="p">];</span>

<span class="c1">// $25払われた日にちも指定</span>
<span class="p">[</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">people</span> <span class="nl">trackCharge</span><span class="p">:</span><span class="mi">@25</span> <span class="nl">withProperties</span><span class="p">:</span><span class="l">@{</span>
    <span class="s">@"$time"</span><span class="o">:</span> <span class="s">@"2012-01-02T00:00:00"</span>
<span class="l">}</span><span class="p">];</span>
</pre></div></div>

<p>上のコードではidが13793というユーザーがどれだけ課金してくれたかが分かる。また、Mixpanelの管理画面ではトータルや平均額を計算してくれる。こりゃ便利。しかしドルで送ることを前提にされているようでそこだけ不自由。</p>

<p><a href="https://mixpanel.com/revenue/" class="autolink" rel="nofollow noopener" target="_blank">https://mixpanel.com/revenue/</a></p>

<h1>
<span id="push通知" class="fragment"></span><a href="#push%E9%80%9A%E7%9F%A5"><i class="fa fa-link"></i></a>Push通知</h1>

<p>Push通知も出来る様子。設定はAPNsからデバイストークンが返ってくるメソッドで処理を行う。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span>
<span class="nf">didRegisterForRemoteNotificationsWithDeviceToken:</span>
        <span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="p">)</span><span class="nv">deviceToken</span>
<span class="p">{</span>
    <span class="n">Mixpanel</span> <span class="o">*</span><span class="n">mixpanel</span> <span class="o">=</span> <span class="p">[</span><span class="n">Mixpanel</span> <span class="n">sharedInstance</span><span class="p">];</span>

    <span class="c1">// Make sure identify has been called before sending</span>
    <span class="c1">// a device token.</span>
    <span class="p">[</span><span class="n">mixpanel</span> <span class="nl">identify</span><span class="p">:</span><span class="s">@"13793"</span><span class="p">];</span>

    <span class="c1">// This sends the deviceToken to Mixpanel</span>
    <span class="p">[</span><span class="n">mixpanel</span><span class="p">.</span><span class="n">people</span> <span class="nl">addPushDeviceToken</span><span class="p">:</span><span class="n">deviceToken</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>きっとUIApplicationのregisterForRemoteNotificationTypes:メソッドはコールする必要があるのだろう。</p>

<h1>
<span id="デバッグ設定" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>デバッグ設定</h1>

<p>プリプロセッサマクロで指定する</p>

<p>MIXPANEL_LOG=1でトラックイベントのログ出力<br>
MIXPANEL_DEBUG=1は何をやってくれるか不明</p>

<h1>
<span id="雑感" class="fragment"></span><a href="#%E9%9B%91%E6%84%9F"><i class="fa fa-link"></i></a>雑感</h1>

<p>ライブラリのインストールがcocoapodsなのはとても便利。またユーザーのヒモ付をメールアドレス等特定の情報で出来るのも開発者のことをよく分かっている感があります。ただ、残念なのはユーザー課金の金額をトラッキングする部分がドル固定なのが痛いですね。日本限定アプリの場合は日本円で送っても問題無いとは思いますが。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>82</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/c9338a715016e7a812b1">nilとNSNullの違いとNSNullをnilのように振る舞うようにする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-15 01:02:16</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="nilとnsnullの違い" class="fragment"></span><a href="#nil%E3%81%A8nsnull%E3%81%AE%E9%81%95%E3%81%84"><i class="fa fa-link"></i></a>nilとNSNullの違い</h2>

<p>プログラミング言語でnullは基本的には値がないことや変数が初期化されていないということを表す。</p>

<p>Objective-Cではnilはポインタが何も実体を指していないことを表現し、変数がnilのときオブジェクトを持っていない状態となる。</p>

<p>ただ、NSDictionaryやNSArrayはnilを格納することが出来ず、<br>
空を格納していることを表現するためにNSNullを使う。</p>

<p>nilとNSNullの大きな違いとして、値がnilである変数に対してメッセージを送った場合はnilを返す。<a href="http://www.libjingu.jp/trans/clocFAQ-j.html#objects-nil" rel="nofollow noopener" target="_blank">nilは(id)0として定義されている</a>。これに対し、オブジェクトがNSNullの場合、NSNullオブジェクトに存在しないメッセージを送るとNSInvalidArgument Exceptionの例外を投げ、これをキャッチしなかった場合はクラッシュしてしまう。</p>

<p>nilへのメッセージの戻り値は次のコードで実験できる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>void main()
{
    NSNumber *num = nil; //説明のため明示的に初期化しておく
    NSLog(@"%@", num);                //=&gt; (null)
    NSLog(@"%d", [num integerValue]); //=&gt; 0
    NSLog(@"%d", [num boolValue]);    //=&gt; 0
}
</pre></div></div>

<p>参考: Appleの"Objective-Cによるプログラミング"<br>
<a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/ProgrammingWithObjectiveC.pdf" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/jp/devcenter/ios/library/documentation/ProgrammingWithObjectiveC.pdf</a> </p>

<h2>
<span id="nsnullを使うことになる具体例" class="fragment"></span><a href="#nsnull%E3%82%92%E4%BD%BF%E3%81%86%E3%81%93%E3%81%A8%E3%81%AB%E3%81%AA%E3%82%8B%E5%85%B7%E4%BD%93%E4%BE%8B"><i class="fa fa-link"></i></a>NSNullを使うことになる具体例</h2>

<p>具体例を上げると、<br>
例えばqiitaの<a href="https://qiita.com/api/v1/items?page=2&amp;per_page=30">新規投稿一覧API</a>を呼び出した際、gistのURLがない投稿は下記のようになっている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>"gist_url":null,
</pre></div></div>

<p>先述のようにNSJSONSerializationでこれをパースするとNSDictionaryにはNSNullが格納される。</p>

<p>ちなみにNSLogなどで出力すると下記のようになる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>"gist_url" = "&lt;null&gt;";
</pre></div></div>

<p>APIの設計指針によると思うが、<br>
例えばgist_urlのデータが存在しないようなデータの場合には、JSONにgist_urlの項目自体含めなければ、NSDictionaryでアクセスしてもその存在がないのでnilとして扱うことが出来る。<br>
もし新規にAPIを設計する場合にはデータがない場合には項目自体を含めないことを検討するのもよいかもしれない。</p>

<h2>
<span id="nsnullのメソッド呼び出し時の振る舞いの変更について" class="fragment"></span><a href="#nsnull%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E6%99%82%E3%81%AE%E6%8C%AF%E3%82%8B%E8%88%9E%E3%81%84%E3%81%AE%E5%A4%89%E6%9B%B4%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>NSNullのメソッド呼び出し時の振る舞いの変更について</h2>

<p>NSNullのオブジェクトにメソッドを呼びだそうとした場合にnilと同じように無視する方法は下記のサイトの記事にあるようにやるのが良い。</p>

<p>「NSNull のインスタンスは nil として振舞ってくれると嬉しいなって」<br>
<a href="http://d.hatena.ne.jp/KishikawaKatsumi/20110505/1304598102" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/KishikawaKatsumi/20110505/1304598102</a></p>

<p>記事中では下記2つのメソッドをNSNullのカテゴリとして実装している。</p>

<ul>
<li>(NSMethodSignature*)methodSignature:(SEL)selector;</li>
<li>(void)forwardInvocation:(NSInvocation*)invocation; </li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>@implementation NSNull(IgnoreMessages)

- (void)forwardInvocation:(NSInvocation *)anInvocation {
    if ([self respondsToSelector:[anInvocation selector]]) {
        [anInvocation invokeWithTarget:self];
    }
}

- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector {
    NSMethodSignature *sig=[[NSNull class] instanceMethodSignatureForSelector:aSelector];
    // Just return some meaningless signature
    if (sig == nil) {
        sig = [NSMethodSignature signatureWithObjCTypes:"@^v^c"];
    }

    return sig;
}

@end
</pre></div></div>

<h3>
<span id="どういう仕組なのか" class="fragment"></span><a href="#%E3%81%A9%E3%81%86%E3%81%84%E3%81%86%E4%BB%95%E7%B5%84%E3%81%AA%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>どういう仕組なのか？</h3>

<p>これら処理の内容について詳しくは下記のコラムが参考になる</p>

<p>「ダイナミックObjective-C AspectCocoa (3) - フォワーディングとポージングの利用」<br>
<a href="http://news.mynavi.jp/column/objc/045/index.html" class="autolink" rel="nofollow noopener" target="_blank">http://news.mynavi.jp/column/objc/045/index.html</a></p>

<p>NSNullがnilのようにメソッドを無視するためのフォワーディングは、そもそも他のオブジェクトに処理を頼む仕組みの様子。</p>

<p>forwardInvocation:では実際にメソッドを呼び出すターゲットを指定している。nullメソッドはrespondsToSelector:がYESを返す場合のみNSNullオブジェクト自身をターゲットとし、それ以外のメソッドの場合は何もしない。</p>

<p>methodSignature:はメソッドシグネチャのインスタンス化を行おうとし、それがnilの場合には文字列からダミーのシグネチャのインスタンスを返すようにしている様子。</p>

<p>signatureWithObjCTypes:の引数"@^v^c"の意味ははっきり分からないが、デバッガでanInvocationの値を出力すると次のようになった</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>return value: {@} 0x0
target: {^v} &lt;78f67c01&gt;
argument 1: {^c} 0x34d70a5
</pre></div></div>

<p>つまり戻り値、ターゲット、引数をシグネチャで適当に指定しているということだろうか？</p>

<p>Apple公式のリファレンスを参考にすると@と^v, ^cがなんとなくわかる<br>
「Type Encodings」<br>
<a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" class="autolink" rel="nofollow noopener" target="_blank">http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>80</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/7f74536fa2ab3cc437f5">iOSでヘッドフォンを抜いた時のイベントをフックする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-10 16:39:54</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>AVFoundationフレームワークのAVPlayerを使った動画再生などでは、ヘッドフォンやイヤフォンを抜いた際、動画の再生が強制的に止まるようになっており、このイベントをフックできないと動画プレイヤーのボタンの状態は動画が再生されている状態のままになってしまいます。</p>

<p>Googleの純正YouTubeアプリではこのような仕様にしっかりと対応しています。</p>

<p><a href="https://camo.qiitausercontent.com/d719e7a51c7989183b3d47235ce08aa61ee80000/687474703a2f2f6136372e70686f626f732e6170706c652e636f6d2f75732f72313030302f3130322f507572706c652f76342f66362f35332f33322f66363533333232612d323139362d316539332d383136392d6136343935373139333563362f6d7a6c2e70686764666d69642e333230783438302d37352e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d719e7a51c7989183b3d47235ce08aa61ee80000/687474703a2f2f6136372e70686f626f732e6170706c652e636f6d2f75732f72313030302f3130322f507572706c652f76342f66362f35332f33322f66363533333232612d323139362d316539332d383136392d6136343935373139333563362f6d7a6c2e70686764666d69642e333230783438302d37352e6a7067" alt="" data-canonical-src="http://a67.phobos.apple.com/us/r1000/102/Purple/v4/f6/53/32/f653322a-2196-1e93-8169-a649571935c6/mzl.phgdfmid.320x480-75.jpg"></a></p>

<p>Googleの純正YouTubeアプリ<br>
<a href="https://itunes.apple.com/jp/app/youtube/id544007664" class="autolink" rel="nofollow noopener" target="_blank">https://itunes.apple.com/jp/app/youtube/id544007664</a></p>

<h2>
<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h2>

<p>ヘッドフォンを抜いた時のイベントをフックするクラスをARCで作成し、ソースコードはgithubにおいています<br>
<a href="https://github.com/yimajo/HeadphonesPluggedDemo" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/yimajo/HeadphonesPluggedDemo</a></p>

<p>下記の説明はまず動作させてから読むことで理解が深まると思います。</p>

<h2>
<span id="ヘッドフォンジャックの情報を取得" class="fragment"></span><a href="#%E3%83%98%E3%83%83%E3%83%89%E3%83%95%E3%82%A9%E3%83%B3%E3%82%B8%E3%83%A3%E3%83%83%E3%82%AF%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>ヘッドフォンジャックの情報を取得</h2>

<p>現在の情報はAudioToolboxフレームワークの、<br>
AudioSessionGetProperty関数を使います。</p>

<div class="code-frame" data-lang="objc">
<div class="code-lang"><span class="bold">YIHeadphonesDetector.m</span></div>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">headphonesArePlugged</span>
<span class="p">{</span>
    <span class="kt">BOOL</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="n">CFStringRef</span> <span class="n">route</span><span class="p">;</span>
    <span class="kt">UInt32</span> <span class="n">propertySize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">CFStringRef</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">AudioSessionGetProperty</span><span class="p">(</span><span class="n">kAudioSessionProperty_AudioRoute</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">propertySize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">route</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>  <span class="p">{</span>
        <span class="c1">//__bridge_transferにしてrouteがreleaseされるようにする</span>
        <span class="bp">NSString</span> <span class="o">*</span><span class="n">routeString</span> <span class="o">=</span> <span class="p">(</span><span class="k">__bridge_transfer</span> <span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">route</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">([</span><span class="n">routeString</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"Headphone"</span><span class="p">]</span> <span class="o">==</span> <span class="nb">YES</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>

<h3>
<span id="__bridge_transferキャストについて" class="fragment"></span><a href="#__bridge_transfer%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>__bridge_transferキャストについて</h3>

<p>ARCが有効な場合、CFStringRefのようなC言語のオブジェクトから、Objective-Cのオブジェクトにキャストするには__bridgeキャストを行う必要があります。</p>

<p>ヘッドフォンジャックの情報を取得するAudioSessionGetProperty関数の引数にしたCFStringRefのrouteオブジェクトは、自動でreleaseされるわけではなく、明示的にreleaseすることが必要になります。ここではNSStringオブジェクトへキャストする際に<strong>bridgeではなく、キャスト元をreleaseすることができる</strong>bridge_transferを使っています。</p>

<p>ここで<strong>bridge_transferではなく</strong>bridgeにした場合、おそらくrouteオブジェクトは下記のようにreleaseする必要が出てくるでしょう。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">NSString</span> <span class="o">*</span><span class="n">routeString</span> <span class="o">=</span> <span class="p">(</span><span class="k">__bridge</span> <span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">route</span><span class="p">;</span>
<span class="n">CFRelease</span><span class="p">(</span><span class="n">route</span><span class="p">);</span> <span class="c1">//CFStringRefはreleaseにCFReleaseを使う</span>
</pre></div></div>

<h2>
<span id="ヘッドフォンジャックの抜き差し時のコールバック" class="fragment"></span><a href="#%E3%83%98%E3%83%83%E3%83%89%E3%83%95%E3%82%A9%E3%83%B3%E3%82%B8%E3%83%A3%E3%83%83%E3%82%AF%E3%81%AE%E6%8A%9C%E3%81%8D%E5%B7%AE%E3%81%97%E6%99%82%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>ヘッドフォンジャックの抜き差し時のコールバック</h2>

<p>ヘッドフォンジャックの抜き差しについては、「オーディオハードウェア経路の変化」を見ることによって実現出来ます。</p>

<p>そのためには、オーディオセッションに対するプロパティリスナーコールバック関数を登録します。<br>
下記はinitメソッドの中で登録している例です。</p>

<div class="code-frame" data-lang="objc">
<div class="code-lang"><span class="bold">YIHeadphonesDetector.m</span></div>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">init</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="n">init</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">AudioSessionInitialize</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

        <span class="c1">//プロパティリスナーコールバック関数を登録します</span>
        <span class="n">AudioSessionAddPropertyListener</span><span class="p">(</span><span class="n">kAudioSessionProperty_AudioRouteChange</span><span class="p">,</span> <span class="c1">//監視したいプロパティの識別子</span>
                                        <span class="n">audioRouteChangeListenerCallback</span><span class="p">,</span>       <span class="c1">//コールバック関数への参照</span>
                                        <span class="p">(</span><span class="k">__bridge</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">);</span>  <span class="c1">//呼び出されるコールバック関数に渡されるためのデータです</span>

    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>

<p>initメソッドでコールバック関数を登録した場合は、deallocメソッドでコールバック関数を削除しておくのが良いと思います。明示的に削除しない場合、宣言したオブジェクトが削除されても実行され続けます。</p>

<div class="code-frame" data-lang="objc">
<div class="code-lang"><span class="bold">YIHeadphonesDetector.m</span></div>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">dealloc</span>
<span class="p">{</span>
    <span class="c1">//プロパティリスナーコールバック関数を削除します</span>
    <span class="n">AudioSessionRemovePropertyListenerWithUserData</span><span class="p">(</span><span class="n">kAudioSessionProperty_AudioRouteChange</span><span class="p">,</span>
                                                   <span class="n">audioRouteChangeListenerCallback</span><span class="p">,</span>
                                                   <span class="p">(</span><span class="k">__bridge</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>

<p>コールバック関数の実装は次のような感じ。delegateでViewControllerに処理を委譲しています。</p>

<div class="code-frame" data-lang="objc">
<div class="code-lang"><span class="bold">YIHeadphonesDetector.m</span></div>
<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> @param inUserData オーディオセッションを初期化する際に指定したデータへのポインタです。</span>
<span class="cm"> このcallbackはObjctive-Cのクラス外で実装されているため、callback内で特定のオブジェクトにメッセージを送るためにはObjective-Cのポインタを渡す必要があります。</span>
<span class="cm"> @param inPropertyID このコールバック関数で通知を受ける対象プロパティの識別子です。</span>
<span class="cm"> @param inPropertyValueSize inPropertyValueパラメータに渡されたデータのサイズ(バイト単位)です</span>
<span class="cm"> @param inPropertyValue 監視しているプロパティの値です。</span>
<span class="cm"> kAudioSessionProperty_AudioRouteChangeを指定すると型はCFDictionaryRefとなります。</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">audioRouteChangeListenerCallback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">inUserData</span><span class="p">,</span>
                                       <span class="n">AudioSessionPropertyID</span> <span class="n">inPropertyID</span><span class="p">,</span>
                                       <span class="kt">UInt32</span> <span class="n">inPropertyValueSize</span><span class="p">,</span>
                                       <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">inPropertyValue</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inPropertyID</span> <span class="o">!=</span> <span class="n">kAudioSessionProperty_AudioRouteChange</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">CFDictionaryRef</span> <span class="n">routeChangeDictionary</span> <span class="o">=</span> <span class="n">inPropertyValue</span><span class="p">;</span>
    <span class="n">CFNumberRef</span> <span class="n">routeChangeReasonRef</span> <span class="o">=</span> <span class="n">CFDictionaryGetValue</span> <span class="p">(</span><span class="n">routeChangeDictionary</span><span class="p">,</span> <span class="n">CFSTR</span><span class="p">(</span><span class="n">kAudioSession_AudioRouteChangeKey_Reason</span><span class="p">));</span>
    <span class="kt">SInt32</span> <span class="n">routeChangeReason</span><span class="p">;</span>
    <span class="n">CFNumberGetValue</span><span class="p">(</span><span class="n">routeChangeReasonRef</span><span class="p">,</span> <span class="n">kCFNumberSInt32Type</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">routeChangeReason</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">routeChangeReason</span> <span class="o">==</span> <span class="n">kAudioSessionRouteChangeReason_OldDeviceUnavailable</span>
        <span class="o">||</span> <span class="n">routeChangeReason</span> <span class="o">==</span> <span class="n">kAudioSessionRouteChangeReason_NewDeviceAvailable</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">YIHeadphonesDetector</span> <span class="o">*</span><span class="n">headphonesDetector</span> <span class="o">=</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">YIHeadphonesDetector</span> <span class="o">*</span><span class="p">)</span><span class="n">inUserData</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">([</span><span class="n">headphonesDetector</span><span class="p">.</span><span class="n">delegate</span> <span class="nl">respondsToSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">headphonesDetectorStateChanged</span><span class="p">:)</span> <span class="p">])</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">headphonesDetector</span><span class="p">.</span><span class="n">delegate</span> <span class="nl">headphonesDetectorStateChanged</span><span class="p">:</span><span class="n">headphonesDetector</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<h3>
<span id="__bridgeキャストについて" class="fragment"></span><a href="#__bridge%E3%82%AD%E3%83%A3%E3%82%B9%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>__bridgeキャストについて</h3>

<p>上の例ではコールバック関数登録にselfを__bridgeでキャストしています。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//プロパティリスナーコールバック関数を登録します</span>
<span class="n">AudioSessionAddPropertyListener</span><span class="p">(</span><span class="n">kAudioSessionProperty_AudioRouteChange</span><span class="p">,</span>
                                <span class="n">audioRouteChangeListenerCallback</span><span class="p">,</span>
                                <span class="p">(</span><span class="k">__bridge</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nb">self</span><span class="p">);</span>
</pre></div></div>

<p>コールバック関数内でも</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">YIHeadphonesDetector</span> <span class="o">*</span><span class="n">headphonesDetector</span> <span class="o">=</span> <span class="p">(</span><span class="k">__bridge</span> <span class="n">YIHeadphonesDetector</span> <span class="o">*</span><span class="p">)</span><span class="n">inUserData</span><span class="p">;</span>
</pre></div></div>

<p>としていますが、これはキャスト時にキャスト元オブジェクトをretainもreleaseもしたくないためです。</p>

<p>該当のオブジェクトがdealloc時にコールバック関数を削除する仕組みにしているため、コールバック関数に渡す該当のオブジェクトselfの参照カウンタの管理（+1にしたり-1にしたり）を明示的にする必要がないためとなります。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>オーディオセッションプログラミングガイド<br>
<a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/AudioSessionProgrammingGuide.pdf" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/jp/devcenter/ios/library/documentation/AudioSessionProgrammingGuide.pdf</a></p>

<p>端末で音声再生が可能かチェックする<br>
<a href="http://shiffon.dtiblog.com/blog-entry-47.html" class="autolink" rel="nofollow noopener" target="_blank">http://shiffon.dtiblog.com/blog-entry-47.html</a></p>

<p>[iOS5] ARC : Autorelease, キャスト, 環境設定<br>
<a href="http://blog.natsuapps.com/2011/11/ios5-arc-autorelease-bridge-xcode.html" class="autolink" rel="nofollow noopener" target="_blank">http://blog.natsuapps.com/2011/11/ios5-arc-autorelease-bridge-xcode.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>75</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/efd3a033ac42afd93714">iPhone実機(iOS6.x)で通信速度を制限する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-13 00:59:58</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOS6から設定画面にある「デベロッパ」の中の"Network Link Conditioner"から<br>
通信速度を制限できるようになっていました。</p>

<p>これで回線が細い時の実機テストや通信エラー時のテストをやり放題ですね…!!</p>

<p>追記:<br>
設定画面「デベロッパ」項目はXcodeのOrganizerで"Use Development"にしていると<br>
表示されるとコメントで教えて頂きました。</p>

<h2>
<span id="やり方" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>やり方</h2>

<p>まず下の画像のように設定にデベロッパのセルがあると思います</p>

<p><a href="https://camo.qiitausercontent.com/3534f9702d26ef1704af71bd1c3f2ba111be2ca2/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f30323833356530363136363766303064353263643036383566343466313464342f74756d626c725f6d6934366774304c587131717a7a616f376f315f3430302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3534f9702d26ef1704af71bd1c3f2ba111be2ca2/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f30323833356530363136363766303064353263643036383566343466313464342f74756d626c725f6d6934366774304c587131717a7a616f376f315f3430302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/02835e061667f00d52cd0685f44f14d4/tumblr_mi46gt0LXq1qzzao7o1_400.png"></a></p>

<p>デベロッパをタップするとDeveloper Settingsという<br>
画面が表示されると思います。</p>

<p><a href="https://camo.qiitausercontent.com/8bdd539ea82df3c895fcb5285f6377d86ab6b28f/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f35366263643265336563613566376464346132376265623166376230366237612f74756d626c725f6d6934366774304c587131717a7a616f376f325f3430302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8bdd539ea82df3c895fcb5285f6377d86ab6b28f/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f35366263643265336563613566376464346132376265623166376230366237612f74756d626c725f6d6934366774304c587131717a7a616f376f325f3430302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/56bcd2e3eca5f7dd4a27beb1f7b06b7a/tumblr_mi46gt0LXq1qzzao7o2_400.png"></a></p>

<p>Network Link ConditionerセクションのStatusをタップすると、<br>
次のような画面になります</p>

<p><a href="https://camo.qiitausercontent.com/a86d9ef4355056c5475ebfe8c5be8796d17ee6b7/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f39633266343839323630376563643463623439323464346363303965666637322f74756d626c725f6d6934366774304c587131717a7a616f376f335f3430302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a86d9ef4355056c5475ebfe8c5be8796d17ee6b7/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f39633266343839323630376563643463623439323464346363303965666637322f74756d626c725f6d6934366774304c587131717a7a616f376f335f3430302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/9c2f4892607ecd4cb4924d4cc09eff72/tumblr_mi46gt0LXq1qzzao7o3_400.png"></a></p>

<p>ここで例えばEnabelをオンにして3Gを選ぶと<br>
Wifi接続しているのにDLで1Mbpsも出なくなりました<br>
（実際のWifi接続では20Mbpsくらいの回線）</p>

<p><a href="https://camo.qiitausercontent.com/6295121bcb170aea4cec0376e545015c12d1ecb0/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f34666563646264323366316333626339666461383065663062363832313231652f74756d626c725f6d6934366774304c587131717a7a616f376f345f3430302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6295121bcb170aea4cec0376e545015c12d1ecb0/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f34666563646264323366316333626339666461383065663062363832313231652f74756d626c725f6d6934366774304c587131717a7a616f376f345f3430302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/4fecdbd23f1c3bc9fda80ef0b682121e/tumblr_mi46gt0LXq1qzzao7o4_400.png"></a></p>

<p>ちなみに私の環境では<br>
"100% Loss"は通信がタイムアウト<br>
"Edge"は0.31Mbpsで3Gより低く、<br>
"DSL"は2.24Mbpsで3Gより高く、<br>
"High Latency DNS"はWifiとほぼ同じ、<br>
"Very Bad Netowrk"は試した限り接続ができない状態になりました。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />22位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>74</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/df7264d7dcc78a57a75d">cocoapodsを導入したプロジェクトでアーキテクチャ周りのビルドエラーになる時</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-22 16:19:20</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> <b>[CocoaPods]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="解決方法" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>解決方法</h1>

<ul>
<li>各プロジェクト設定の"Architectures"を揃えているかどうか確認</li>
<li>各プロジェクト設定の"Build Active Architecture Only"で矛盾がないか確認</li>
</ul>

<h1>
<span id="具体的な話" class="fragment"></span><a href="#%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E8%A9%B1"><i class="fa fa-link"></i></a>具体的な話</h1>

<p>例はMixpanelをcocoapods経由で組み込んだ際のビルドエラー</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>"_OBJC_CLASS_$_Mixpanel", referenced from:
objc-class-ref in STAnalytics.o
</pre></div></div>

<p>エラーログの上の方を見ていくとかなり詳細に状態が表示されていた</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Pods was rejected as an implicit dependency for 'libPods.a' because its architectures 'armv7s' didn't contain all required architectures 'armv7 armv7s arm64'
</pre></div></div>

<p>cocoapodsを使う場合Xcodeはワークスペースを使うが、実際のプロジェクトは'armv7 armv7s arm64'でビルドされるべきなのに、cocoapodsのプロジェクトは'armv7s'しかビルドしていなかったために発生していた様子。</p>

<p>Stackoverflowで同じような症状と解決策を探してみると、podsのプロジェクトの"Build Active Architecture Only"をYESからNOにすべしとあった</p>

<p>CocoaPods arm64 issue<br>
<a href="http://stackoverflow.com/questions/19419781/cocoapods-arm64-issue" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/19419781/cocoapods-arm64-issue</a></p>

<p><a href="https://camo.qiitausercontent.com/afbc888e7842cd8a4ae17dd8da8d654914c40e5b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f34633032383661642d616565612d653834322d363333652d3730316237313532663536392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/afbc888e7842cd8a4ae17dd8da8d654914c40e5b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f34633032383661642d616565612d653834322d363333652d3730316237313532663536392e706e67" alt="スクリーンショット 2014-02-22 15.47.09.png" title="Xcodeのpodsプロジェクト設定" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/4c0286ad-aeea-e842-633e-701b7152f569.png"></a></p>

<p>図のようにどうやらデフォルトYESになっていて、これをNOにすべしということらしい。実際にNOにしてビルドエラーはなくなった。</p>

<h2>
<span id="デフォルトyesなのは理由がある" class="fragment"></span><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88yes%E3%81%AA%E3%81%AE%E3%81%AF%E7%90%86%E7%94%B1%E3%81%8C%E3%81%82%E3%82%8B"><i class="fa fa-link"></i></a>デフォルトYESなのは理由がある</h2>

<p>"Build Active Architecture Only"はビルドしようとしているアクティブなアーキテクチャのみバイナリを生成するかどうかなので、例えばiPhone5(armv7s)実機で開発作業の検証を行っている時はarm64のビルドなどしなくて良いのではないかと思う。よって、開発プロジェクト側もDebugの"Build Active Architecture Only"をpodsプロジェクトと併せてYESにするとビルドが出来るようになった。</p>

<p>おそらく全部NOに統一してしまっても開発はできるが特定の端末で動作を確認したい場合でも全部NOに統一するのはビルド時間が無駄なはず。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<ul>
<li>Debug,Release毎に各プロジェクトの"Build Active Architecture Only"を揃える</li>
<li>Xcodeから特定の実機で検証したい場合はDebugビルドの"Build Active Architecture Only"はYES</li>
<li>それ以外（例えばAdHocやRelease）の場合はNOにする</li>
</ul>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>xcodeのarmv7sビルドエラー<br>
<a href="http://spacetimebubble.net/2012/12/26/xcode%E3%81%AEarmv7s%E3%83%93%E3%83%AB%E3%83%89%E3%82%A8%E3%83%A9%E3%83%BC/" class="autolink" rel="nofollow noopener" target="_blank">http://spacetimebubble.net/2012/12/26/xcode%E3%81%AEarmv7s%E3%83%93%E3%83%AB%E3%83%89%E3%82%A8%E3%83%A9%E3%83%BC/</a></p>

<p>Xcode 4.2でarmv6が必要だって怒られる場合の対処方法<br>
<a href="http://d.hatena.ne.jp/paraches/20111029" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/paraches/20111029</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />23位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>73</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/b30799d68302e17a172b">OHHTTPStubsを使ったiOSアプリ開発の進め方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-28 01:27:39</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h1>

<p>スタートアップiOS勉強会 #3<br>
<a href="http://www.zusaar.com/event/4557003" class="autolink" rel="nofollow noopener" target="_blank">http://www.zusaar.com/event/4557003</a></p>

<p>自分もこれで話す内容についてずっと考えていて、laisoさんの<a href="http://laiso.hatenablog.com/entry/2014/03/27/%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%AE%E4%BA%BA%E6%9D%90%E7%8D%B2%E5%BE%97%E6%88%A6%E7%95%A5%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B" rel="nofollow noopener" target="_blank">スタートアップの人材戦略とは何か</a>を読むと先にLTの内容を公開していたのでこちらも公開することにした。</p>

<p>10分以下のLTだと細かいことは多分話せないので、先におおまかに公開し実際のLTでは自分の特に話したいことを集中して話すようになるのではないかと思う（もしくは<a href="http://qiita.com/yimajo/items/336fd0039bd9d35887f6" id="reference-b62838eca03d3f63dccf">ジョブズが成仏した話みたいに</a>当日思いつきでぜんぜん違うことを言うかもしれないし、もしくは近所にガールズバーができたから行ってみたらビール一杯3080円だった話になるかもしれない）。</p>

<h2>
<span id="スタートアップに関する話について" class="fragment"></span><a href="#%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E8%A9%B1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>スタートアップに関する話について</h2>

<p>経験上、iOSアプリ開発ではWebアプリ開発のようにいきなり大人数で開発を進めることがないので、iOSアプリ開発での技術的ノウハウやあるあるネタはスタートアップでの開発あるあるに近いものだという実感があって、スタートアップに関する話を無理にしようとせず、普通にiOSアプリ開発で使うライブラリの話はスタートアップでもきっと役に立つ。なので自分が開発の初期時によく利用する<a href="https://github.com/AliSoftware/OHHTTPStubs" rel="nofollow noopener" target="_blank">OHHTTPStubs</a>を使って進める開発についてがいいかなと思った。</p>

<h1>
<span id="ohhttpstubsについて" class="fragment"></span><a href="#ohhttpstubs%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>OHHTTPStubsについて</h1>

<p><a href="https://github.com/AliSoftware/OHHTTPStubs" rel="nofollow noopener" target="_blank">OHHTTPStubs</a>はiOSアプリのNSURLRequestやNSURLSessionの通信を内部でフックしてスタブ用のレスポンスを返すライブラリ。これを使うことによってAPIがサーバ側で実装されていなくてもクライアントアプリ開発者は開発を進めることが出来る。基本的にNSURLRequestやNSURLSessionの通信をフックしてくれるので、例えばAFNetworkingなどの通信ライブラリを使ったものでも利用できる。</p>

<h2>
<span id="具体的なイメージ" class="fragment"></span><a href="#%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>具体的なイメージ</h2>

<p>API開発者とクライアントアプリ開発者でAPI仕様を詰めた後、API開発者にレスポンスのjsonなどをテキストファイルとして作ってもらう。</p>

<p>この副次的なメリットとして、実際にjsonとしてパース出来るものにしてもらうことで、エクセルなどで作られた仕様書だとDictionaryやArrayの記述間違いがあったりjsonとして正しくない記述に対する些細な指摘ややりとりをする必要もなくなる。</p>

<h1>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h1>

<h2>
<span id="ライブラリの基本的な使い方" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>ライブラリの基本的な使い方</h2>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">OHHTTPStubs</span> <span class="nl">stubRequestsPassingTest</span><span class="p">:</span><span class="o">^</span><span class="kt">BOOL</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="err">#</span><span class="nb">YES</span><span class="err">なら</span><span class="nl">withStubResponse</span><span class="p">:</span><span class="err">のハンドラを実行#</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span> <span class="nl">withStubResponse</span><span class="p">:</span><span class="o">^</span><span class="n">OHHTTPStubsResponse</span> <span class="o">*</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="err">#スタブ用のレスポンスを返す#</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}];</span>
</pre></div></div>

<p>最初のblocksでは全てのHTTP/HTTPSリクエストに対して特定のリクエストをフックするかどうかをBOOLで返す。</p>

<h2>
<span id="具体的な使い方" class="fragment"></span><a href="#%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>具体的な使い方</h2>

<p>OHHTTPStubs#stubRequestsPassingTest:withStubResponse:メソッドは複数作成できるが、管理しないと全てのリクエストに対して実行されてしまうので、全てのリクエストが集中すること前提で条件分岐させるほうが分かりやすい。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">OHHTTPStubs</span> <span class="nl">stubRequestsPassingTest</span><span class="p">:</span><span class="o">^</span><span class="kt">BOOL</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">request</span><span class="p">.</span><span class="n">URL</span><span class="p">.</span><span class="n">absoluteString</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">urlString1</span><span class="p">]){</span>
       <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">request</span><span class="p">.</span><span class="n">URL</span><span class="p">.</span><span class="n">absoluteString</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">urlString2</span><span class="p">]){</span>
       <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
<span class="p">}</span> <span class="nl">withStubResponse</span><span class="p">:</span><span class="o">^</span><span class="n">OHHTTPStubsResponse</span> <span class="o">*</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">request</span><span class="p">.</span><span class="n">URL</span><span class="p">.</span><span class="n">absoluteString</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">urlString1</span><span class="p">]){</span>
        <span class="k">return</span> 
        <span class="p">[</span><span class="n">OHHTTPStubsResponse</span> <span class="nl">responseWithFileAtPath</span><span class="p">:</span><span class="n">OHPathForFileInBundle</span><span class="p">(</span><span class="s">@"stub.txt"</span><span class="p">,</span><span class="nb">nil</span><span class="p">)</span>
                                         <span class="nl">statusCode</span><span class="p">:</span><span class="mi">200</span>
                                            <span class="nl">headers</span><span class="p">:</span><span class="l">@{</span><span class="s">@"Content-Type"</span><span class="o">:</span><span class="s">@"text/plain"</span><span class="l">}</span><span class="p">];</span>

    <span class="p">}</span>
    <span class="c1">//...他の条件を続ける</span>
<span class="p">}];</span>
</pre></div></div>

<p>OHHTTPStubsのREADMEやサンプルコードを読んでもこのような使い方はしておらず、通信毎にこのメソッドを作っている。おそらくスタブをon/offしたい場合はそれでよいが、上記のようにやるほうが楽だし問題を感じたことはない。</p>

<p>コードを見てもらってわかるように、ステータスコードとレスポンスを指定することが出来る。なので上記のように200OKとせず認証エラーにしてみて異常系のテストを実行することも出来る。先に正常系、異常系の分岐を書いておきTODOとコメントしておくことで後々異常系の実装をする箇所が明確になるし、異常系の動作をどのようにするかはアプリによって違ってくるものなので先に設計上の指針を示すためにも良い。</p>

<h2>
<span id="専用のutilityクラスなどを作ると捗る" class="fragment"></span><a href="#%E5%B0%82%E7%94%A8%E3%81%AEutility%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AA%E3%81%A9%E3%82%92%E4%BD%9C%E3%82%8B%E3%81%A8%E6%8D%97%E3%82%8B"><i class="fa fa-link"></i></a>専用のUtilityクラスなどを作ると捗る</h2>

<p>DemoプロジェクトはViewControllerで通信してそこでOHHTTPStubsを使っているが、OHHTTPStubsの処理は1クラスにまとめてAppDelegateでスタブをon/offするほうが便利。</p>

<h2>
<span id="注意点" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><i class="fa fa-link"></i></a>注意点</h2>

<h3>
<span id="リリースバイナリにこのライブラリは含めてはないけない" class="fragment"></span><a href="#%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%81%AB%E3%81%93%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AF%E5%90%AB%E3%82%81%E3%81%A6%E3%81%AF%E3%81%AA%E3%81%84%E3%81%91%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>リリースバイナリにこのライブラリは含めてはないけない</h3>

<p>リリースするバイナリに含めないようにリリースビルドからlibOHHTTPStubs.aファイルを除外されるようにする。例えばテスト用のターゲットを作り、クラスのimport部分を#ifdefもしくは#ifマクロで囲うなどで実現する。</p>

<p>自分の経験上このような部分を作りこんではいけない。このような本質とは関係ない部分を作りこみ確実という自信があろうとも、絶対確認をしないといけないためにその手順が複雑になると確認手順に時間が掛かる。それは絶対によくない。複雑な確認手順は手順自体の正当性も気になってくるし、正当性を気にしない甘い人間は自分の都合の良い用に確認手順を捉えることもある。</p>

<p>チェックが必要な仕組みを作るときは、チェックしやすいかの優先度を高めて考えるべきで、たとえ下手な方法でもチェックがし易いなら時間コスト下げてくれるのでそちらの方がいい。</p>

<h1>
<span id="ライブラリの変更点" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E5%A4%89%E6%9B%B4%E7%82%B9"><i class="fa fa-link"></i></a>ライブラリの変更点</h1>

<h2>
<span id="レスポンスを返すインターフェースが変わっていた" class="fragment"></span><a href="#%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%92%E8%BF%94%E3%81%99%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%81%8C%E5%A4%89%E3%82%8F%E3%81%A3%E3%81%A6%E3%81%84%E3%81%9F"><i class="fa fa-link"></i></a>レスポンスを返すインターフェースが変わっていた</h2>

<p>変更点</p>

<ul>
<li>headersのDictionaryでcontentTypeも返す</li>
<li>レスポンスタイムは指定が必須ではなくなった</li>
<li>レスポンスタイムは定数化されている</li>
<li>リクエストまでにかかる時間も指定できるようになった</li>
</ul>

<p>日本語のブログでググった限り、前はこうだった</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">OHHTTPStubsResponse</span> <span class="nl">responseWithFile</span><span class="p">:</span><span class="s">@"response.json"</span> 
                          <span class="nl">contentType</span><span class="p">:</span><span class="s">@"text/json"</span>
                         <span class="nl">responseTime</span><span class="p">:</span><span class="mf">2.0</span><span class="p">];</span>
</pre></div></div>

<p>新しくなってるのはこのようになる</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">OHHTTPStubsResponse</span> <span class="nl">responseWithFileAtPath</span><span class="p">:</span><span class="n">OHPathForFileInBundle</span><span class="p">(</span><span class="s">@"stub.txt"</span><span class="p">,</span><span class="nb">nil</span><span class="p">)</span>
                                  <span class="nl">statusCode</span><span class="p">:</span><span class="mi">200</span>
                                     <span class="nl">headers</span><span class="p">:</span><span class="l">@{</span><span class="s">@"Content-Type"</span><span class="o">:</span><span class="s">@"text/plain"</span><span class="l">}</span><span class="p">]</span>
 <span class="nl">requestTime</span><span class="p">:</span><span class="mf">1.f</span>
 <span class="nl">responseTime</span><span class="p">:</span><span class="n">OHHTTPStubsDownloadSpeedWifi</span><span class="p">];</span>
</pre></div></div>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>スタートアップiOS勉強会 #3<br>
<a href="http://www.zusaar.com/event/4557003" class="autolink" rel="nofollow noopener" target="_blank">http://www.zusaar.com/event/4557003</a></p>

<p>まだ定員に達してないので参加したい方は参加してみたらいいかもしれない。</p>

<p>ちなみに1回目のときはこんな感じでした</p>

<p><a href="https://camo.qiitausercontent.com/5e83a204a1a03c13b72b78669540c4cb8d1cad8c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f34616366346462632d366430392d313263312d636331322d3861343337336565376433662e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5e83a204a1a03c13b72b78669540c4cb8d1cad8c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f34616366346462632d366430392d313263312d636331322d3861343337336565376433662e6a706567" alt="BggcLLSCAAEKZTu.jpg" title="BggcLLSCAAEKZTu.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/4acf4dbc-6d09-12c1-cc12-8a4373ee7d3f.jpeg"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />24位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>62</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/336fd0039bd9d35887f6">クックパッドでジョブズも成仏する開発Tips発表したったwww</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-13 11:33:23</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>＜この記事は<a href="http://curiosity.co.jp/archives/37" rel="nofollow noopener" target="_blank">自社のブログにも転載しました</a>＞</p>

<p>クックパッドさんが月イチで行っている<a href="https://github.com/potatotips/potatotips/wiki/potatotips-5" rel="nofollow noopener" target="_blank">第5回potatotips（ポテトチップス）という開発Tips共有会</a>が開かれたので参加させてもらい、『ジョブズも成仏するTips考えたったwww』という2chのスレタイみたいなタイトルで発表させてもらいました。</p>

<p><a href="http://www.slideshare.net/YoshinoriImajo/tipswww" rel="nofollow noopener" target="_blank">発表時の資料はSlideShareに上げてます</a>が解説編を書いておきます。</p>

<p><a href="https://camo.qiitausercontent.com/662f58222df8f52493d6ef8f70e6fb9c69499c74/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f34393764666630612d313034622d633531302d636139322d3562306131363361616539372e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/662f58222df8f52493d6ef8f70e6fb9c69499c74/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f34393764666630612d313034622d633531302d636139322d3562306131363361616539372e6a706567" alt="cookpad.jpg" title="cookpad.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/497dff0a-104b-c510-ca92-5b0a163aae97.jpeg"></a></p>

<p>私も前に参加した<a href="http://qiita.com/yimajo/items/254c7cebab7864678246" id="reference-3a9b1107d29cfea6f077">potatotips第3回目</a>はYahoo!Japanさんで開催してましたが、今回はクックパッド社開催で、会場は会社のエントランス部分がキッチンと発表会場のスペースにつながっていました。この写真で見てわかるようにキッチンから発表を眺めるというアットホームな光景ですね。</p>

<h1>
<span id="ジョブズ成仏じょうぶつの発端" class="fragment"></span><a href="#%E3%82%B8%E3%83%A7%E3%83%96%E3%82%BA%E6%88%90%E4%BB%8F%E3%81%98%E3%82%87%E3%81%86%E3%81%B6%E3%81%A4%E3%81%AE%E7%99%BA%E7%AB%AF"><i class="fa fa-link"></i></a>ジョブズ成仏（じょうぶつ）の発端</h1>

<p><a href="https://camo.qiitausercontent.com/038903f28399a5ad7f6b77745933629b7516b04c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61366565363032622d323466642d626262392d323137612d6135666235343062643962312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/038903f28399a5ad7f6b77745933629b7516b04c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61366565363032622d323466642d626262392d323137612d6135666235343062643962312e706e67" alt="スクリーンショット 2014-03-13 1.02.53.png" title="スクリーンショット 2014-03-13 1.02.53.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/a6ee602b-24fd-bbb9-217a-a5fb540bd9b1.png"></a></p>

<p>「ジョブズが通った」はなし。私は<a href="http://cocodrips.hateblo.jp/entry/2013/09/07/221309" rel="nofollow noopener" target="_blank">はてな社のインターンの方のブログ</a>で読んだことがあっただけで<a href="https://twitter.com/cockscomb" rel="nofollow noopener" target="_blank">cockscomb</a>さんが実際に発言したのを聞いたわけでもなかったので半信半疑だったのですが、発表中、会場にいらしたはてな関係者<a href="https://twitter.com/ninjinkun" rel="nofollow noopener" target="_blank">ninjinkun</a>さんが「それcockscombが言ってるだけだよ！」と発言されてたので、どうやらこの事はひた隠しにすべき事実らしい、という手応えを感じました。</p>

<h1>
<span id="ジョブズが成仏じょうぶつしていない" class="fragment"></span><a href="#%E3%82%B8%E3%83%A7%E3%83%96%E3%82%BA%E3%81%8C%E6%88%90%E4%BB%8F%E3%81%98%E3%82%87%E3%81%86%E3%81%B6%E3%81%A4%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>ジョブズが成仏（じょうぶつ）していない?</h1>

<p>うちのXcodeの場合はクラッシュするというよりシミュレータで動作させようとすると1/2ぐらいの確率でXcodeがフリーズします。人に聞くとスニペットを使ってるとクラッシュするという人も居るので各々の環境によって違っているんじゃないかと思います。とにかく成仏してない感じにもジョブズの独自性を感じます。</p>

<h1>
<span id="xcodeがフリーズするとやっかい" class="fragment"></span><a href="#xcode%E3%81%8C%E3%83%95%E3%83%AA%E3%83%BC%E3%82%BA%E3%81%99%E3%82%8B%E3%81%A8%E3%82%84%E3%81%A3%E3%81%8B%E3%81%84"><i class="fa fa-link"></i></a>Xcodeがフリーズするとやっかい</h1>

<p>Xcodeがクラッシュするとクラッシュレポートを送るかどうかのダイアログが出た後に再起動するかを選ぶことが出来ます。フリーズする場合、終了が出来なくなるので強制終了させないといけなくなり結構厄介です。具体的にはOSXの上にあるリンゴマークをクリックして「強制終了」からXcodeを選択するので面倒ですね。</p>

<h1>
<span id="ジョブズに成仏じょうぶつしてもらってxcodeを再起動する" class="fragment"></span><a href="#%E3%82%B8%E3%83%A7%E3%83%96%E3%82%BA%E3%81%AB%E6%88%90%E4%BB%8F%E3%81%98%E3%82%87%E3%81%86%E3%81%B6%E3%81%A4%E3%81%97%E3%81%A6%E3%82%82%E3%82%89%E3%81%A3%E3%81%A6xcode%E3%82%92%E5%86%8D%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ジョブズに成仏（じょうぶつ）してもらってXcodeを再起動する</h1>

<p>成仏してないのであれば成仏してもらうべきですし、Xcodeもそれに伴って再起動すべきでしょう。では成仏させる方法とは？色々考えた結果、神社などで手をパンパン！とたたく柏手（かしわで）という日本古来の方法がベストではないかという結論にたどり着きました。</p>

<p>そもそも柏手（かしわで）とは、神に近い対象に感謝や喜びを表すためでもあるようで、日本の禅や仏にも詳しいジョブズに成仏していただくのにベストなソリューションではないでしょうか？</p>

<p><a href="https://camo.qiitausercontent.com/d5d5d2cbe16cf8546439dfac12f826cea5f043dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f33653234316261642d363461362d376331322d336431622d6166306333396262323764312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d5d5d2cbe16cf8546439dfac12f826cea5f043dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f33653234316261642d363461362d376331322d336431622d6166306333396262323764312e706e67" alt="スクリーンショット 2014-03-13 1.45.41.png" title="スクリーンショット 2014-03-13 1.45.41.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/3e241bad-64a6-7c12-3d1b-af0c39bb27d1.png"></a></p>

<p>つまり、</p>

<p>Xcodeがフリーズ<br>
↓<br>
柏手（かしわで）を2回叩く<br>
↓<br>
ジョブズが成仏（Xcodeが再起動）</p>

<p>となります。この時点で会場にいた大半が「言葉の意味は分かったが何を言ってるかわからない」という感想を持って一体感が生まれていたので、この文章を読んでいる方が何を言っているかわからないと思うのは無理もないと思います（実は資料を作ってて気にならなかったのですが今思うと話の順番が良くなかった気がします）。</p>

<h1>
<span id="柏手かしわでをmacが認識する方法" class="fragment"></span><a href="#%E6%9F%8F%E6%89%8B%E3%81%8B%E3%81%97%E3%82%8F%E3%81%A7%E3%82%92mac%E3%81%8C%E8%AA%8D%E8%AD%98%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>柏手（かしわで）をMacが認識する方法</h1>

<p>本題です。Xcodeを使う開発者が柏手（かしわで）を打って成仏させることをMacが認識しXcodeの再起動を行うには音声認識かジェスチャー認識が必要になります。</p>

<p>MacにはiClapperというアプリが有り、これが柏手（かしわで）の音を認識することがわかりました。</p>

<p><a href="https://camo.qiitausercontent.com/d087b12cc7573547ed8c29cf86dc27bfc3e735e4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f35303137616233322d663434612d623936662d306336622d3863343531336661306665312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d087b12cc7573547ed8c29cf86dc27bfc3e735e4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f35303137616233322d663434612d623936662d306336622d3863343531336661306665312e706e67" alt="スクリーンショット 2014-03-13 2.19.57.png" title="スクリーンショット 2014-03-13 2.19.57.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/5017ab32-f44a-b96f-0c6b-8c4513fa0fe1.png"></a></p>

<p>このアプリでは、音声認識により任意のアプリやAppleScriptを起動でき、システム音声やGrowlにより視覚的な通知も行います。</p>

<p><a href="https://camo.qiitausercontent.com/ba3ed986904918a1caedacc1c293322dca46c649/687474703a2f2f61352e6d7a7374617469632e636f6d2f6a702f7233302f507572706c652f76342f65662f63392f66642f65666339666430332d633665622d613564652d623062652d6339653730663232616137662f73637265656e383030783530302e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ba3ed986904918a1caedacc1c293322dca46c649/687474703a2f2f61352e6d7a7374617469632e636f6d2f6a702f7233302f507572706c652f76342f65662f63392f66642f65666339666430332d633665622d613564652d623062652d6339653730663232616137662f73637265656e383030783530302e6a706567" alt="iClapper" data-canonical-src="http://a5.mzstatic.com/jp/r30/Purple/v4/ef/c9/fd/efc9fd03-c6eb-a5de-b0be-c9e70f22aa7f/screen800x500.jpeg"></a></p>

<p>Xcode再起動用のAppleScriptは次のような感じです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>if application "Xcode" is running then
    tell application "Xcode" to quit
    say "Kill xcode"
    delay 1
end if

say "Boot Xcode"
tell application "Xcode" to activate
</pre></div></div>

<p>ターミナル経由でないスクリプトの進捗はわかりづらいので、sayを使うことで指定した文字列をシステム音声により喋らせるすることが出来ます。上記の例ではすでにXcodeが起動している状態なら"Kill xcode"と発音し、そのあとに"Boot Xcode"の発音とともに起動します。</p>

<h2>
<span id="applescriptについて" class="fragment"></span><a href="#applescript%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>AppleScriptについて</h2>

<p>tell application "&lt;#アプリ名#&gt;"でアプリケーションを指定し、 その後に続くto activateでウインドウを前面に起動出来るようです。</p>

<p>アプリケーションの終了はtell application "&lt;#アプリ名#&gt;" to quitになります。</p>

<p>AppleScript Language Guide<br>
<a href="https://developer.apple.com/library/mac/documentation/applescript/conceptual/applescriptlangguide/reference/aslr_cmds.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/mac/documentation/applescript/conceptual/applescriptlangguide/reference/aslr_cmds.html</a></p>

<h1>
<span id="iclapperの設定" class="fragment"></span><a href="#iclapper%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>iClapperの設定</h1>

<p><a href="https://camo.qiitausercontent.com/1d831d20f561f78c458823ceba5abd1dd849c614/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f62643037336134312d653736662d323964382d323337632d3435613931643332343365372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1d831d20f561f78c458823ceba5abd1dd849c614/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f62643037336134312d653736662d323964382d323337632d3435613931643332343365372e706e67" alt="スクリーンショット 2014-03-13 2.41.05.png" title="スクリーンショット 2014-03-13 2.41.05.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/bd073a41-e76f-29d8-237c-45a91d3243e7.png"></a></p>

<p>DoubleClapのチェックボックスをオンにして任意のAppleScriptを指定します。また音声をあらかじめ学習させることができるので、自分の環境で何度か柏手（かしわで）を打っておきましょう。</p>

<h1>
<span id="デモ" class="fragment"></span><a href="#%E3%83%87%E3%83%A2"><i class="fa fa-link"></i></a>デモ</h1>

<p>会場では発表の最後に実際に柏手（かしわで）での成仏デモを行いました。失敗すると発表者である私がただ元気に手を叩いただけになってしまうので緊張しましたが無事成功しました。緊張感の中での成功だったため、会場のみなさんによる拍手喝采になりXcodeが再起動を繰り返すというアクシデントも有りましたが皆もジョブズの成仏を体験できて何よりです。</p>

<p>音声認識は場所による影響を受けやすいため、会場でうまくいかないだろうと思いあらかじめ撮っておいた成仏動画を公開します。再生時間は53秒程度です。</p>

<p><a href="http://www.youtube.com/watch?v=8eKdCh0QykQ" class="autolink" rel="nofollow noopener" target="_blank">http://www.youtube.com/watch?v=8eKdCh0QykQ</a></p>

<h1>
<span id="雑感" class="fragment"></span><a href="#%E9%9B%91%E6%84%9F"><i class="fa fa-link"></i></a>雑感</h1>

<ul>
<li>参加者ほぼ発表者というのは前でデモをする気持ちがわかってるので緊張感があって面白い</li>
<li>当然だけど参加者クックパッド在籍の方が多く技術的にとんがっている感じだけど直に話すとちゃんとした人たちなので若いエンジニアには良き先輩/上司になるのではないかという気がした</li>
</ul>

<p>クックパッド社ではエンジニアを募集しているようです</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />25位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>61</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/a0449ca9f80f25b84ae8">不要なユーザを強制ログアウトさせる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-23 20:51:16</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Bash]</b> <b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>bashでリモート環境へのセッションが残ってしまったなどの不要なユーザを強制的にログアウトさせるコマンドのメモ。</p>

<h2>
<span id="wコマンドでユーザを調べる" class="fragment"></span><a href="#w%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>wコマンドでユーザを調べる</h2>

<p>wコマンドでログアウトさせたいユーザを探す</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ w
 20:16:19 up 1 day,  5:45,  2 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT
imajo    pts/0    6.41.102.121.dy. 20:09    6:47   0.00s  0.00s -bash
imajo    pts/1    6.41.102.121.dy. 20:10    0.00s  0.01s  0.00s w
</pre></div></div>

<p>pts/0をログアウトさせたい（pts/1のyimajoはwコマンドを使っている自分自身）。</p>

<h2>
<span id="sshdを使っているプロセスを表示" class="fragment"></span><a href="#sshd%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>sshdを使っているプロセスを表示</h2>

<p>psコマンドからsshdを使ってるプロセスを表示</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ps ax | grep sshd
</pre></div></div>

<p>出力は次のようになる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ps ax | grep sshd
26519 ?        Ss     0:00 /usr/sbin/sshd
27126 ?        Ss     0:00 sshd: yimajo [priv]
27128 ?        S      0:00 sshd: yimajo@pts/0
27148 ?        Ss     0:00 sshd: yimajo [priv]
27150 ?        S      0:00 sshd: yimajo@pts/1
27172 pts/1    S+     0:00 grep sshd
</pre></div></div>

<p>27128が終了させたいプロセス番号ですよと。</p>

<h2>
<span id="killでプロセスを終了させる" class="fragment"></span><a href="#kill%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E7%B5%82%E4%BA%86%E3%81%95%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>killでプロセスを終了させる</h2>

<p>killコマンドで9(SIGKILL)を送信してプロセスを終了させる。<br>
kill -9 &lt;プロセスID&gt;で指定するだけ</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>kill -9 27128
</pre></div></div>

<p>最後にもう一度wコマンドを打ってkillできたかを確認しておわり</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />26位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>59</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/9cdf56b5f7bffbfc8e5f">iOS6以上とiOS5の自動回転の制御について</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-11 13:31:15</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h3>
<span id="まずios-sdk6自体の回転に関する前提" class="fragment"></span><a href="#%E3%81%BE%E3%81%9Aios-sdk6%E8%87%AA%E4%BD%93%E3%81%AE%E5%9B%9E%E8%BB%A2%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>まずiOS SDK6自体の回転に関する前提</h3>

<p>・iOS6以上とiOS5では自動回転のメソッドが違う<br>
・iOS SDK6から以前の回転のメソッドが非推奨になった<br>
・iOS SDKが6以上であっても実行する端末がiOS5に対応するのであればiOS5向けの実装をしないといけない</p>

<h3>
<span id="最初に結論" class="fragment"></span><a href="#%E6%9C%80%E5%88%9D%E3%81%AB%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>最初に結論</h3>

<p>・iOS6の場合、コンテナを使いそれぞれのViewControllerで回転の可否を決めたい場合は工夫が必要</p>

<h2>
<span id="ios-sdk6からの自動回転" class="fragment"></span><a href="#ios-sdk6%E3%81%8B%E3%82%89%E3%81%AE%E8%87%AA%E5%8B%95%E5%9B%9E%E8%BB%A2"><i class="fa fa-link"></i></a>iOS SDK6からの自動回転</h2>

<p>iOS6からの自動回転についてはUIViewControllerのshouldAutorotateメソッドで、そのViewControllerで回転処理が存在するかどうかをBOOLで返し、回転する方向をsupportedInterfaceOrientationsメソッドで指定する。</p>

<div class="code-frame" data-lang="objectivec">
<div class="code-lang"><span class="bold">iOS6のUIViewController自動回転メソッド</span></div>
<div class="highlight"><pre><span></span><span class="c1">//回転処理が存在するかどうかを返す</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">shouldAutorotate</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//回転する方向を指定</span>
<span class="p">-</span> <span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nf">supportedInterfaceOrientations</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">UIInterfaceOrientationMaskPortrait</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>

<h3>
<span id="コンテナを使っている場合は子供の指定にまかせる" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AF%E5%AD%90%E4%BE%9B%E3%81%AE%E6%8C%87%E5%AE%9A%E3%81%AB%E3%81%BE%E3%81%8B%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>コンテナを使っている場合は子供の指定にまかせる</h3>

<p>UITabBarControllerやUINavigationControllerなどのようなコンテナを使っていて、そのコンテナに追加している子ViewControllerで回転したい方向をそれぞれで指定したい場合、それぞれの子ViewControllerで処理を任せるようにするのがよさそう。</p>

<p>つまり、コンテナ自体のshouldAutorotateメソッド、supportedInterfaceOrientationsメソッドが呼び出された際、コンテナに追加された子ViewControllerのそれらのメソッドを呼び出すようにする。</p>

<p>具体的には、まずUITabBarControllerを使っている場合、タブで選択されたViewControllerのshouldAutorotateメソッド、supportedInterfaceOrientationsで回転処理の方向を指定させるようにする。</p>

<p>UITabBarControllerには選択されたタブを取得するselectedViewControllerプロパティがあるため、次のようにできる。</p>

<div class="code-frame" data-lang="objectivec">
<div class="code-lang"><span class="bold">UITabBarControllerを継承して実装</span></div>
<div class="highlight"><pre><span></span><span class="c1">//回転させるかどうか</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">shouldAutorotate</span>
<span class="p">{</span>
    <span class="c1">//タブで選択されたViewController(navigationならnavigation)に任せる</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">selectedViewController</span> <span class="n">shouldAutorotate</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">//回転させる向きを指定</span>
<span class="p">-</span> <span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nf">supportedInterfaceOrientations</span>
<span class="p">{</span>
    <span class="c1">//選択したViewController(navigationならnavigation)に任せる</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">selectedViewController</span> <span class="n">supportedInterfaceOrientations</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>

<p>UINavigationControllerには表示されているViewControllerを取得するvisibleViewControllerがあるため、次のようにできる。</p>

<div class="code-frame" data-lang="objectivec">
<div class="code-lang"><span class="bold">UINavigationControllerを継承して実装</span></div>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">shouldAutorotate</span>
<span class="p">{</span>
    <span class="c1">//表示しているViewControllerにまかせる</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">visibleViewController</span> <span class="n">shouldAutorotate</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nf">supportedInterfaceOrientations</span>
<span class="p">{</span>
   <span class="c1">//表示しているViewControllerにまかせる</span>
   <span class="k">return</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">visibleViewController</span> <span class="n">supportedInterfaceOrientations</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="ios5の自動回転" class="fragment"></span><a href="#ios5%E3%81%AE%E8%87%AA%E5%8B%95%E5%9B%9E%E8%BB%A2"><i class="fa fa-link"></i></a>iOS5の自動回転</h2>

<p>iOS5の自動回転についてはUIViewControllerのshouldAutorotateToInterfaceOrientation:メソッドを利用する。</p>

<div class="code-frame" data-lang="objectivec">
<div class="code-lang"><span class="bold">iOS5のUIViewController自動回転メソッド</span></div>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">shouldAutorotateToInterfaceOrientation:</span><span class="p">(</span><span class="n">UIInterfaceOrientation</span><span class="p">)</span><span class="nv">interfaceOrientation</span><span class="p">{</span>
     <span class="c1">//interfaceOriaentationで識別子回転する方向であればYESを返す</span>
     <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>

<p>iOS6と違い、UITabBarControllerやUINavigationControllerを使っている場合も意識する必要がなく、回転させたいViewController上でshouldAutorotateToInterfaceOrientation:メソッドを実行すれば良い。</p>

<h3>
<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h3>

<p>githubに置いてます<br>
<a href="https://github.com/yimajo/AutoRotateDemo" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/yimajo/AutoRotateDemo</a></p>

<p>突っ込みどころ等あれば編集リクエストなり、コメントなりgit hubのpull requestなりでお願いします。</p>

<h3>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h3>

<p><a href="http://d.hatena.ne.jp/oropon/20120926/p1" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/oropon/20120926/p1</a></p>

<p><a href="http://appteam.blog114.fc2.com/blog-entry-242.html" class="autolink" rel="nofollow noopener" target="_blank">http://appteam.blog114.fc2.com/blog-entry-242.html</a></p>

<p><a href="http://blog.livedoor.jp/melodybox/archives/18079532.html" class="autolink" rel="nofollow noopener" target="_blank">http://blog.livedoor.jp/melodybox/archives/18079532.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />27位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>58</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/ff6e9ed31b292c802da6">スワイプでUIViewControllerを戻る動作</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-20 11:25:44</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>最近色んなアプリがスワイプで戻る動作を実装してて、対応していないアプリでもついつい指がスワイプしてしまうので、自分の作るアプリでもコピペで実装できるか調べてみた（大変だったらやりたくない、オープンソースのクラスとかわざわざ入れたくない）。</p>

<p>調べたらやり方は簡単、UIViewControllerのviewDidLoadでUIPanGestureRecognizerを登録、selectorでPanしたx軸の移動距離を見てViewControllerをpopする。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>

    <span class="bp">UIPanGestureRecognizer</span> <span class="o">*</span><span class="n">backGestureRecognizer</span>
        <span class="o">=</span> <span class="p">[[</span><span class="bp">UIPanGestureRecognizer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTarget</span><span class="p">:</span><span class="nb">self</span>
                                                  <span class="nl">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">backGesture</span><span class="p">:)];</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addGestureRecognizer</span><span class="p">:</span><span class="n">backGestureRecognizer</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">backGesture:</span><span class="p">(</span><span class="bp">UIPanGestureRecognizer</span> <span class="o">*</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
    <span class="bp">CGPoint</span> <span class="n">translation</span> <span class="o">=</span> <span class="p">[</span><span class="n">sender</span> <span class="nl">translationInView</span><span class="p">:</span><span class="n">sender</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
    <span class="c1">//閾値を良い感じに調整</span>
    <span class="k">if</span> <span class="p">(</span><span class="mf">60.0</span> <span class="o">&lt;</span> <span class="n">translation</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">navigationController</span> <span class="nl">popViewControllerAnimated</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">removeGestureRecognizer</span><span class="p">:</span><span class="n">sender</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>スワイプを戻る動作と認識させる閾値は、自分的には60pointくらいが丁度いい(自分がよく使うSmartNewsは52か54pointくらいでやってそう)。</p>

<p>iOS4.0でUIPanGestureRecognizerのtranslationがちゃんとした値を返すのかは未検証。</p>

<h2>
<span id="uiwebviewで使う時" class="fragment"></span><a href="#uiwebview%E3%81%A7%E4%BD%BF%E3%81%86%E6%99%82"><i class="fa fa-link"></i></a>UIWebViewで使う時</h2>

<p>UIWebViewで使う場合、viewの横幅が大きくなりスクロールが必要になるとジェスチャーが認識しないので、cssでbody要素の文字を折り返しさせる。pre要素も要素内でスクロールするようにしておくといい感じ。</p>

<div class="code-frame" data-lang="css"><div class="highlight"><pre><span></span><span class="nt">body</span> <span class="p">{</span><span class="k">word-break</span><span class="p">:</span><span class="n">break-all</span><span class="p">;}</span>
<span class="nt">pre</span> <span class="p">{</span><span class="k">overflow</span><span class="p">:</span><span class="kc">scroll</span><span class="p">;}</span>
</pre></div></div>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>1行で導入するback gestureの話とUINavigationBarを拡張した話<br>
<a href="http://blog.ishkawa.org/blog/2013/02/24/backgesture-in-confwd/" class="autolink" rel="nofollow noopener" target="_blank">http://blog.ishkawa.org/blog/2013/02/24/backgesture-in-confwd/</a></p>

<p>UIPanGestureRecognizerはiOS4.0ではtranslationプロパティを正しく返さない<br>
<a href="http://akisute.com/2011/08/uipangesturerecognizerios40translation.html" class="autolink" rel="nofollow noopener" target="_blank">http://akisute.com/2011/08/uipangesturerecognizerios40translation.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />28位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>55</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/1ca179083edddb25df55">Appleのサンプルで学ぶUISearchDisplayControllerの使い方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-24 22:25:14</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Appleの公開している２つのサンプルでUISearchDisplayControllerの使い方をメモしておく。</p>

<h1>
<span id="uisearchdisplaycontrollerとは" class="fragment"></span><a href="#uisearchdisplaycontroller%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>UISearchDisplayControllerとは</h1>

<p>検索画面で検索したらリアルタイムに候補がUITableViewに表示されるやつ。</p>

<h1>
<span id="サンプルについて" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>サンプルについて</h1>

<p>Appleは2つのサンプルを公開している。CoreDataなどを使わないシンプルなものなのでこれを読むのが一番良い。</p>

<ul>
<li>1つ目。Simple UISearchBar with State Restoration

<ul>
<li><a href="https://developer.apple.com/library/ios/samplecode/TableSearch/Introduction/Intro.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/ios/samplecode/TableSearch/Introduction/Intro.html</a></li>
<li>入力された文字列そのまま検索</li>
</ul>
</li>
<li>2つ目。Advanced UISearchBar

<ul>
<li><a href="https://developer.apple.com/library/ios/samplecode/AdvancedTableSearch/Introduction/Intro.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/ios/samplecode/AdvancedTableSearch/Introduction/Intro.html</a></li>
<li>入力された文字列をスペース区切りでAND検索。数字なら値段と年をOR検索</li>
</ul>
</li>
</ul>

<h1>
<span id="simple-uisearchbar-with-state-restoration" class="fragment"></span><a href="#simple-uisearchbar-with-state-restoration"><i class="fa fa-link"></i></a>Simple UISearchBar with State Restoration</h1>

<p><a href="https://camo.qiitausercontent.com/52cfa89f9f0a18d7181e1b84e22c8bda3ddbca0d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37343831326465382d353263352d636631392d376336302d6439313132386335326634662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/52cfa89f9f0a18d7181e1b84e22c8bda3ddbca0d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37343831326465382d353263352d636631392d376336302d6439313132386335326634662e706e67" alt="IMG_1632.PNG" title="IMG_1632.PNG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/74812de8-52c5-cf19-7c60-d91128c52f4f.png"></a></p>

<p>サンプルプロジェクトの画面はシンプルでリストと詳細しかない。このリスト部分で全てのデータを表示し、検索文字列の入力に応じて表示されるデータが絞られる形式となっている。</p>

<p><a href="https://camo.qiitausercontent.com/c35da45c579a2b0c97f9c77835e2fc9961d77b3a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f34393764656562352d393832332d663436612d373466652d6639323936636338653865392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c35da45c579a2b0c97f9c77835e2fc9961d77b3a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f34393764656562352d393832332d663436612d373466652d6639323936636338653865392e706e67" alt="スクリーンショット 2014-02-24 20.10.55.png" title="スクリーンショット 2014-02-24 20.10.55.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/497deeb5-9823-f46a-74fe-f9296cc8e8e9.png"></a></p>

<p>動作的にはApple製品のラインナップ名がデスクトップやラップトップなど区分ごとに検索できるようになっている。</p>

<h2>
<span id="データの用意" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%94%A8%E6%84%8F"><i class="fa fa-link"></i></a>データの用意</h2>

<p>検索するためのデータはappDelegateで用意している。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">willFinishLaunchingWithOptions:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
<span class="p">{</span>
    <span class="bp">NSArray</span> <span class="o">*</span><span class="n">productArray</span> <span class="o">=</span> <span class="l">@[</span><span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"iPhone"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"iPod"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"iPod touch"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"iPad"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"iPad mini"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDesktop</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"iMac"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDesktop</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"Mac Pro"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypePortable</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"MacBook Air"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypePortable</span> <span class="nl">name</span><span class="p">:</span><span class="s">@"MacBook Pro"</span><span class="p">]</span><span class="l">]</span><span class="p">;</span>

    <span class="bp">UINavigationController</span> <span class="o">*</span><span class="n">navigationController</span> <span class="o">=</span> <span class="p">(</span><span class="bp">UINavigationController</span> <span class="o">*</span><span class="p">)[</span><span class="nb">self</span><span class="p">.</span><span class="n">window</span> <span class="n">rootViewController</span><span class="p">];</span>
    <span class="n">APLViewController</span> <span class="o">*</span><span class="n">viewController</span> <span class="o">=</span> <span class="p">[</span><span class="n">navigationController</span><span class="p">.</span><span class="n">viewControllers</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">viewController</span><span class="p">.</span><span class="n">products</span> <span class="o">=</span> <span class="n">productArray</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>APLProductというクラスを用意し、そのインスタンスをNSArrayでまとめ、リスト用のViewController（APLViewController）で保持する。</p>

<p>検索対象となる文字列はNSArrayであればよいということが分かる。</p>

<p>APLProductクラスにはproductWithType:name:メソッドがあり、検索する区分をproductWithTypeで指定し、検索する名前をnameで指定するようになっている。</p>

<h2>
<span id="aplviewcontroller" class="fragment"></span><a href="#aplviewcontroller"><i class="fa fa-link"></i></a>APLViewController</h2>

<h3>
<span id="インターフェース" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>インターフェース</h3>

<p>APLViewControllerは検索対象となる文字列を含むデータをproducsプロパティで保持している（正確にはメンバ変数_producsで保持していると言ったほうがよいかもしれないけど）。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">APLViewController</span> : <span class="bp">UITableViewController</span> <span class="o">&lt;</span><span class="bp">UISearchDisplayDelegate</span><span class="p">,</span> <span class="bp">UISearchBarDelegate</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="bp">NSArray</span> <span class="o">*</span><span class="n">products</span><span class="p">;</span> <span class="c1">// The master content.</span>

<span class="k">@end</span>
</pre></div></div>

<p>UISearchDisplayDelegateは検索文字の入力時に呼ばれるメソッドのためだが、UISearchBarDelegateはここで記述されているものの実装はされていなかった...。</p>

<h3>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h3>

<h4>
<span id="privateなメンバ変数で検索結果を保持" class="fragment"></span><a href="#private%E3%81%AA%E3%83%A1%E3%83%B3%E3%83%90%E5%A4%89%E6%95%B0%E3%81%A7%E6%A4%9C%E7%B4%A2%E7%B5%90%E6%9E%9C%E3%82%92%E4%BF%9D%E6%8C%81"><i class="fa fa-link"></i></a>privateなメンバ変数で検索結果を保持</h4>

<p>無名カテゴリは以下のとおり、NSMutableArrayなsearchResultsプロパティを結果として保持するのだと思う。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">APLViewController</span> <span class="p">()</span>

<span class="cm">/*</span>
<span class="cm"> The searchResults array contains the content filtered as a result of a search.</span>
<span class="cm"> */</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">)</span> <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">searchResults</span><span class="p">;</span>

<span class="k">@end</span>
</pre></div></div>

<h4>
<span id="uitableviewのdatasourceで表示を制御" class="fragment"></span><a href="#uitableview%E3%81%AEdatasource%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%82%92%E5%88%B6%E5%BE%A1"><i class="fa fa-link"></i></a>UITableViewのDataSourceで表示を制御</h4>

<p>APLViewControllerのUITableView DataSourceにてテーブル数を返すメソッドで２つのテーブルを区別してそれぞれの数を返しているのが分かる。<br>
片方は検索結果を返すために無名カテゴリで宣言したsearchResultsの数と、最初に初期化した検索対象の文字列を含むNSArrayの数だ。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#pragma mark - UITableView data source and delegate methods</span>

<span class="p">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     If the requesting table view is the search display controller's table view, return the count of</span>
<span class="cm">     the filtered list, otherwise return the count of the main list.</span>
<span class="cm">     */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tableView</span> <span class="o">==</span> <span class="nb">self</span><span class="p">.</span><span class="n">searchDisplayController</span><span class="p">.</span><span class="n">searchResultsTableView</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">searchResults</span> <span class="n">count</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">products</span> <span class="n">count</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>cellへの表示も上記のようにtableViewを分けて処理を書いているだけなので省略。</p>

<h4>
<span id="uisearchdisplaycontrollerのdelegateuisearchdisplaydelegateを実装する" class="fragment"></span><a href="#uisearchdisplaycontroller%E3%81%AEdelegateuisearchdisplaydelegate%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>UISearchDisplayControllerのdelegate（UISearchDisplayDelegate）を実装する</h4>

<p>検索を行うためには動作するUISearchDisplayControllerのdelegateを実装している。下記コードに説明のコメントを追記した。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#pragma mark - UISearchDisplayController Delegate Methods</span>

<span class="c1">//検索欄に入力された文字列がsearchStringとして渡される</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">searchDisplayController:</span><span class="p">(</span><span class="bp">UISearchDisplayController</span> <span class="o">*</span><span class="p">)</span><span class="nv">controller</span>
<span class="nf">shouldReloadTableForSearchString:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">searchString</span>
<span class="p">{</span>
    <span class="c1">//検索の区分を保持する。</span>
    <span class="bp">NSString</span> <span class="o">*</span><span class="n">scope</span><span class="p">;</span>

    <span class="c1">//選択されている区分のindexを取得</span>
    <span class="n">NSInteger</span> <span class="n">selectedScopeButtonIndex</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">searchDisplayController</span><span class="p">.</span><span class="n">searchBar</span> <span class="n">selectedScopeButtonIndex</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">selectedScopeButtonIndex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//検索する区分を識別</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="p">[[</span><span class="n">APLProduct</span> <span class="n">deviceTypeNames</span><span class="p">]</span> <span class="nl">objectAtIndex</span><span class="p">:(</span><span class="n">selectedScopeButtonIndex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)];</span>
    <span class="p">}</span>

    <span class="c1">//区分と入力された文字列から検索を行う</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">updateFilteredContentForProductName</span><span class="p">:</span><span class="n">searchString</span> <span class="nl">type</span><span class="p">:</span><span class="n">scope</span><span class="p">];</span>

    <span class="c1">// Return YES to cause the search result table view to be reloaded.</span>
    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h4>
<span id="検索部分の実装" class="fragment"></span><a href="#%E6%A4%9C%E7%B4%A2%E9%83%A8%E5%88%86%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>検索部分の実装</h4>

<p>検索は単純に文字列のあるなしを見ているだけだった。検索対象に文字列があればself.searchResultsに追加している。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#pragma mark - Content Filtering</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">updateFilteredContentForProductName:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">productName</span> <span class="nf">type:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">typeName</span>
<span class="p">{</span>
    <span class="c1">//検索対象の文字列がない場合</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">productName</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="o">||</span> <span class="p">[</span><span class="n">productName</span> <span class="n">length</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// If there is no search string and the scope is "All".</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">typeName</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//検索区分もなしなのでそのまま表示</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">searchResults</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">products</span> <span class="n">mutableCopy</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// If there is no search string and the scope is chosen.</span>
            <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">searchResults</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSMutableArray</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">APLProduct</span> <span class="o">*</span><span class="n">product</span> <span class="k">in</span> <span class="nb">self</span><span class="p">.</span><span class="n">products</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">([</span><span class="n">product</span><span class="p">.</span><span class="n">type</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">typeName</span><span class="p">])</span>
                <span class="p">{</span>
                    <span class="p">[</span><span class="n">searchResults</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">product</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">searchResults</span> <span class="o">=</span> <span class="n">searchResults</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">searchResults</span> <span class="n">removeAllObjects</span><span class="p">];</span> <span class="c1">// First clear the filtered array.</span>
    <span class="cm">/*</span>
<span class="cm">     Search the main list for products whose type matches the scope (if selected) and whose name matches searchText; add items that match to the filtered array.</span>
<span class="cm">     */</span>
    <span class="c1">//検索対象のNSArrayから愚直に列挙していく</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">APLProduct</span> <span class="o">*</span><span class="n">product</span> <span class="k">in</span> <span class="nb">self</span><span class="p">.</span><span class="n">products</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//まず区分があっているかどうかを識別</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">typeName</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="o">||</span> <span class="p">[</span><span class="n">product</span><span class="p">.</span><span class="n">type</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">typeName</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="c1">//NSRangeで単純に文字列のマッチする範囲があるかどうかを行っている</span>

            <span class="c1">//NSCaseInsensitiveSearchオプションで大文字小文字を無関係に</span>
            <span class="c1">//NSDiacriticInsensitiveSearchオプションでラテン文字での区別されるべきものを区別するために指定</span>
            <span class="n">NSUInteger</span> <span class="n">searchOptions</span> <span class="o">=</span> <span class="n">NSCaseInsensitiveSearch</span> <span class="o">|</span> <span class="n">NSDiacriticInsensitiveSearch</span><span class="p">;</span>

            <span class="n">NSRange</span> <span class="n">productNameRange</span> <span class="o">=</span> <span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
            <span class="n">NSRange</span> <span class="n">foundRange</span> <span class="o">=</span> <span class="p">[</span><span class="n">product</span><span class="p">.</span><span class="n">name</span> <span class="nl">rangeOfString</span><span class="p">:</span><span class="n">productName</span> <span class="nl">options</span><span class="p">:</span><span class="n">searchOptions</span> <span class="nl">range</span><span class="p">:</span><span class="n">productNameRange</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">foundRange</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//文字列がマッチしていれば検索結果のためのNSMutableArrayに追加</span>
                <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">searchResults</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">product</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="advanced-uisearchbar" class="fragment"></span><a href="#advanced-uisearchbar"><i class="fa fa-link"></i></a>Advanced UISearchBar</h1>

<p>前出のものとの機能的な違いは、入力された文字列をスペース区切りでAND検索。数字なら値段と年をOR検索できることだが、画面的には違いがほとんどない。</p>

<p><a href="https://camo.qiitausercontent.com/20d537ec45471d6be9283335d56f06f6420aae79/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37326238363866332d396239392d363164342d643965662d3765623862326230343638322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/20d537ec45471d6be9283335d56f06f6420aae79/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37326238363866332d396239392d363164342d643965662d3765623862326230343638322e706e67" alt="IMG_1633.PNG" title="IMG_1633.PNG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/72b868f3-9b99-61d4-d9ef-7eb8b2b04682.png"></a></p>

<p>画面構成は前出のものと変わりがなかったので説明を割愛。</p>

<h2>
<span id="データの用意-1" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%94%A8%E6%84%8F-1"><i class="fa fa-link"></i></a>データの用意</h2>

<p>こちらのAPLProductクラスはyearとpriceのプロパティが増えている。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">willFinishLaunchingWithOptions:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
<span class="p">{</span>
    <span class="bp">NSArray</span> <span class="o">*</span><span class="n">productArray</span> <span class="o">=</span> <span class="l">@[</span><span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"iPhone"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">2007</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">599.00</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"iPod"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">2001</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">399.00</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"iPod touch"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">2007</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">210.00</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"iPad"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">2010</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">499.00</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDevice</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"iPad mini"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">2012</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">659.00</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDesktop</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"iMac"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">1997</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">1299.00</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypeDesktop</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"Mac Pro"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">2006</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">2499.00</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypePortable</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"MacBook Air"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">2008</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">1799.00</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">APLProduct</span> <span class="nl">productWithType</span><span class="p">:</span><span class="n">ProductTypePortable</span>
                                                    <span class="nl">name</span><span class="p">:</span><span class="s">@"MacBook Pro"</span>
                                                    <span class="nl">year</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInteger</span><span class="p">:</span><span class="mi">2006</span><span class="p">]</span>
                                                   <span class="nl">price</span><span class="p">:[</span><span class="bp">NSNumber</span> <span class="nl">numberWithDouble</span><span class="p">:</span><span class="mf">1499.00</span><span class="p">]]</span>
                              <span class="l">]</span><span class="p">;</span>

    <span class="bp">UINavigationController</span> <span class="o">*</span><span class="n">navigationController</span> <span class="o">=</span> <span class="p">(</span><span class="bp">UINavigationController</span> <span class="o">*</span><span class="p">)[</span><span class="nb">self</span><span class="p">.</span><span class="n">window</span> <span class="n">rootViewController</span><span class="p">];</span>
    <span class="n">APLViewController</span> <span class="o">*</span><span class="n">viewController</span> <span class="o">=</span> <span class="p">[</span><span class="n">navigationController</span><span class="p">.</span><span class="n">viewControllers</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">viewController</span><span class="p">.</span><span class="n">products</span> <span class="o">=</span> <span class="n">productArray</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h3>
<span id="検索部分の実装-1" class="fragment"></span><a href="#%E6%A4%9C%E7%B4%A2%E9%83%A8%E5%88%86%E3%81%AE%E5%AE%9F%E8%A3%85-1"><i class="fa fa-link"></i></a>検索部分の実装</h3>

<p>前出のものと違うのは検索部分だったのでその部分のみ抜粋して説明のコメントを追記。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">updateFilteredContentForSearchString:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">searchString</span> <span class="nf">productType:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">type</span>
<span class="p">{</span>
    <span class="c1">// start out with the entire list</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">searchResults</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">products</span> <span class="n">mutableCopy</span><span class="p">];</span>

    <span class="c1">// strip out all the leading and trailing spaces</span>
    <span class="c1">//まず文字列の両端からスペースを取り除く</span>
    <span class="bp">NSString</span> <span class="o">*</span><span class="n">strippedStr</span> <span class="o">=</span> <span class="p">[</span><span class="n">searchString</span> <span class="nl">stringByTrimmingCharactersInSet</span><span class="p">:[</span><span class="bp">NSCharacterSet</span> <span class="n">whitespaceCharacterSet</span><span class="p">]];</span>

    <span class="c1">// break up the search terms (separated by spaces)</span>
    <span class="bp">NSArray</span> <span class="o">*</span><span class="n">searchItems</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">strippedStr</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//スペースで区切って文字列をNSArrayに</span>
        <span class="n">searchItems</span> <span class="o">=</span> <span class="p">[</span><span class="n">strippedStr</span> <span class="nl">componentsSeparatedByString</span><span class="p">:</span><span class="s">@" "</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// build all the "AND" expressions for each value in the searchString</span>
    <span class="c1">// AND条件のため要素をフィルタリングするNSPredicateを保持する</span>
    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">andMatchPredicates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>

    <span class="c1">//スペースで区切られた文字列を列挙</span>
    <span class="k">for</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="n">searchString</span> <span class="k">in</span> <span class="n">searchItems</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// each searchString creates an OR predicate for: name, yearIntroduced, introPrice</span>
        <span class="c1">//</span>
        <span class="c1">// example if searchItems contains "iphone 599 2007":</span>
        <span class="c1">//      name CONTAINS[c] "iphone"</span>
        <span class="c1">//      name CONTAINS[c] "599", yearIntroduced ==[c] 599, introPrice ==[c] 599</span>
        <span class="c1">//      name CONTAINS[c] "2007", yearIntroduced ==[c] 2007, introPrice ==[c] 2007</span>
        <span class="c1">//</span>
        <span class="c1">//文字列はnameから</span>
        <span class="c1">//数字は年と値段両方の条件として使われる</span>

        <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">searchItemsPredicate</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>

        <span class="c1">// name field matching</span>
        <span class="bp">NSExpression</span> <span class="o">*</span><span class="n">lhs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSExpression</span> <span class="nl">expressionForKeyPath</span><span class="p">:</span><span class="s">@"name"</span><span class="p">];</span>
        <span class="bp">NSExpression</span> <span class="o">*</span><span class="n">rhs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSExpression</span> <span class="nl">expressionForConstantValue</span><span class="p">:</span><span class="n">searchString</span><span class="p">];</span>

        <span class="bp">NSPredicate</span> <span class="o">*</span><span class="n">finalPredicate</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSComparisonPredicate</span>
                                       <span class="nl">predicateWithLeftExpression</span><span class="p">:</span><span class="n">lhs</span>
                                       <span class="nl">rightExpression</span><span class="p">:</span><span class="n">rhs</span>
                                       <span class="nl">modifier</span><span class="p">:</span><span class="n">NSDirectPredicateModifier</span>
                                       <span class="nl">type</span><span class="p">:</span><span class="n">NSContainsPredicateOperatorType</span>
                                       <span class="nl">options</span><span class="p">:</span><span class="n">NSCaseInsensitivePredicateOption</span><span class="p">];</span>
        <span class="p">[</span><span class="n">searchItemsPredicate</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">finalPredicate</span><span class="p">];</span>

        <span class="c1">// yearIntroduced field matching</span>
        <span class="bp">NSNumberFormatter</span> <span class="o">*</span><span class="n">numFormatter</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSNumberFormatter</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
        <span class="p">[</span><span class="n">numFormatter</span> <span class="nl">setNumberStyle</span><span class="p">:</span><span class="n">NSNumberFormatterNoStyle</span><span class="p">];</span>
        <span class="bp">NSNumber</span> <span class="o">*</span><span class="n">targetNumber</span> <span class="o">=</span> <span class="p">[</span><span class="n">numFormatter</span> <span class="nl">numberFromString</span><span class="p">:</span><span class="n">searchString</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">targetNumber</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span>    <span class="c1">// (searchString may not convert to a number)</span>
        <span class="p">{</span>

            <span class="n">lhs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSExpression</span> <span class="nl">expressionForKeyPath</span><span class="p">:</span><span class="s">@"yearIntroduced"</span><span class="p">];</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSExpression</span> <span class="nl">expressionForConstantValue</span><span class="p">:</span><span class="n">targetNumber</span><span class="p">];</span>
            <span class="n">finalPredicate</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSComparisonPredicate</span>
                              <span class="nl">predicateWithLeftExpression</span><span class="p">:</span><span class="n">lhs</span>
                              <span class="nl">rightExpression</span><span class="p">:</span><span class="n">rhs</span>
                              <span class="nl">modifier</span><span class="p">:</span><span class="n">NSDirectPredicateModifier</span>
                              <span class="nl">type</span><span class="p">:</span><span class="n">NSEqualToPredicateOperatorType</span>
                              <span class="nl">options</span><span class="p">:</span><span class="n">NSCaseInsensitivePredicateOption</span><span class="p">];</span>
            <span class="p">[</span><span class="n">searchItemsPredicate</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">finalPredicate</span><span class="p">];</span>

            <span class="c1">// price field matching</span>
            <span class="n">lhs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSExpression</span> <span class="nl">expressionForKeyPath</span><span class="p">:</span><span class="s">@"introPrice"</span><span class="p">];</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSExpression</span> <span class="nl">expressionForConstantValue</span><span class="p">:</span><span class="n">targetNumber</span><span class="p">];</span>
            <span class="n">finalPredicate</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSComparisonPredicate</span>
                              <span class="nl">predicateWithLeftExpression</span><span class="p">:</span><span class="n">lhs</span>
                              <span class="nl">rightExpression</span><span class="p">:</span><span class="n">rhs</span>
                              <span class="nl">modifier</span><span class="p">:</span><span class="n">NSDirectPredicateModifier</span>
                              <span class="nl">type</span><span class="p">:</span><span class="n">NSEqualToPredicateOperatorType</span>
                              <span class="nl">options</span><span class="p">:</span><span class="n">NSCaseInsensitivePredicateOption</span><span class="p">];</span>
            <span class="p">[</span><span class="n">searchItemsPredicate</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">finalPredicate</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="c1">// at this OR predicate to our master AND predicate</span>
        <span class="c1">// 名前、値段、年をOR条件として作成</span>
        <span class="bp">NSCompoundPredicate</span> <span class="o">*</span><span class="n">orMatchPredicates</span>
            <span class="o">=</span> <span class="p">(</span><span class="bp">NSCompoundPredicate</span> <span class="o">*</span><span class="p">)[</span><span class="bp">NSCompoundPredicate</span> <span class="nl">orPredicateWithSubpredicates</span><span class="p">:</span><span class="n">searchItemsPredicate</span><span class="p">];</span>

        <span class="c1">//ここでaddされるものはAND条件になる? (名前 OR 値段 OR 年) AND (名前 OR 値段 OR 年)</span>
        <span class="p">[</span><span class="n">andMatchPredicates</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">orMatchPredicates</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="bp">NSCompoundPredicate</span> <span class="o">*</span><span class="n">finalCompoundPredicate</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// we have a scope type to narrow our search further</span>
        <span class="c1">//</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">andMatchPredicates</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// we have a scope type and other fields to search on -</span>
            <span class="c1">// so match up the fields of the Product object AND its product type</span>
            <span class="c1">//</span>
            <span class="bp">NSCompoundPredicate</span> <span class="o">*</span><span class="n">compPredicate1</span> <span class="o">=</span>
                <span class="p">(</span><span class="bp">NSCompoundPredicate</span> <span class="o">*</span><span class="p">)[</span><span class="bp">NSCompoundPredicate</span> <span class="nl">andPredicateWithSubpredicates</span><span class="p">:</span><span class="n">andMatchPredicates</span><span class="p">];</span>

            <span class="bp">NSPredicate</span> <span class="o">*</span><span class="n">compPredicate2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSPredicate</span> <span class="nl">predicateWithFormat</span><span class="p">:</span><span class="s">@"(SELF.type == %@)"</span><span class="p">,</span> <span class="n">type</span><span class="p">];</span>

            <span class="c1">//区分がある時は文字列の比較とNSPredicateの==であわせて比較する</span>
            <span class="n">finalCompoundPredicate</span> <span class="o">=</span>
                <span class="p">(</span><span class="bp">NSCompoundPredicate</span> <span class="o">*</span><span class="p">)[</span><span class="bp">NSCompoundPredicate</span> <span class="nl">andPredicateWithSubpredicates</span><span class="p">:</span><span class="l">@[</span><span class="n">compPredicate1</span><span class="p">,</span> <span class="n">compPredicate2</span><span class="l">]</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// match up by product scope type only</span>
            <span class="c1">//区分のみのときは区分のみで比較する</span>
            <span class="n">finalCompoundPredicate</span> <span class="o">=</span>
                <span class="p">(</span><span class="bp">NSCompoundPredicate</span> <span class="o">*</span><span class="p">)[</span><span class="bp">NSPredicate</span> <span class="nl">predicateWithFormat</span><span class="p">:</span><span class="s">@"(SELF.type == %@)"</span><span class="p">,</span> <span class="n">type</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">// no scope type specified, just match up the fields of the Product object</span>
        <span class="n">finalCompoundPredicate</span> <span class="o">=</span>
            <span class="p">(</span><span class="bp">NSCompoundPredicate</span> <span class="o">*</span><span class="p">)[</span><span class="bp">NSCompoundPredicate</span> <span class="nl">andPredicateWithSubpredicates</span><span class="p">:</span><span class="n">andMatchPredicates</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="nb">self</span><span class="p">.</span><span class="n">searchResults</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">self</span><span class="p">.</span><span class="n">searchResults</span> <span class="nl">filteredArrayUsingPredicate</span><span class="p">:</span><span class="n">finalCompoundPredicate</span><span class="p">]</span> <span class="n">mutableCopy</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />29位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>53</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/264e840c0c078eb1bf9d">アプリ内課金のレシートは1つのバイナリになる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-10 15:33:14</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>最近気づいたんだけど、iOSで使われるアプリ内課金（In-App Purchase）では複数の課金をしてもそれぞれにレシートのバイナリができるわけではなく、複数まとめて1つのバイナリになっている。</p>

<p>もしかしたら同じような勘違いをしている人もいるかもしれない。そうするとサンプルコードが全然違って見えるよという話です。</p>

<p>Appleの公式リファレンスである<a href="https://developer.apple.com/library/ios/releasenotes/General/ValidateAppStoreReceipt/Introduction.html#//apple_ref/doc/uid/TP40010573" rel="nofollow noopener" target="_blank">レシート検証プログラミングガイド PDF</a>によるとレシートの構造はこんな感じらしい。</p>

<p><a href="https://camo.qiitausercontent.com/737bfe6124e5837ce2d80a02e20763e59ee7965b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f64626137656638382d366230372d646165622d396637372d6361373533386339303531622e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/737bfe6124e5837ce2d80a02e20763e59ee7965b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f64626137656638382d366230372d646165622d396637372d6361373533386339303531622e6a706567" alt="レシートの構造.jpg" title="レシートの構造.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/dba7ef88-6b07-daeb-9f77-ca7538c9051b.jpeg"></a></p>

<p>（ちなみにこの図のタイトルはレシートの構造のはずなのに後続と訳されていた）</p>

<p>iOS7より前ではtransactionReceiptがNSDataで取得できるので、アイテムごとにレシートが作られているのかと思っていた。コードとしては次のような感じ</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//このメソッドはオリジナルで</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">finishTransaction:</span><span class="p">(</span><span class="bp">SKPaymentTransaction</span> <span class="o">*</span><span class="p">)</span><span class="nv">transaction</span>
<span class="p">{</span>
    <span class="c1">//iOS6など</span>
    <span class="c1">//NSData *receiptData = transaction.transactionDate; //非推奨になった</span>

    <span class="c1">//iOS7から</span>
    <span class="bp">NSURL</span> <span class="o">*</span><span class="n">receiptURL</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="n">appStoreReceiptURL</span><span class="p">];</span>
    <span class="bp">NSData</span> <span class="o">*</span><span class="n">receiptData</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfURL</span><span class="p">:</span><span class="n">receiptURL</span><span class="p">];</span>

   <span class="c1">//...ここでレシートの検証やコンテンツの適用などを行う...//</span>
<span class="p">}</span>
</pre></div></div>

<p>iOS7のやり方ではローカルの場所をURLとして取得するだけで、その場所はトランザクションごとに変わっているわけでもない。うちの実機だと下記のような場所がURLとなる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>file:///var/mobile/Applications/&lt;何かのUUID&gt;/StoreKit/receipt
</pre></div></div>

<p>おそらくiOS7からレシートのバイナリが一つになったわけではないんだろうけど、iOS6以前はtransactionに対してレシートデータが取得できるおかげで変な勘違いをしていた。</p>

<p>ただ、iOS7からレシートはappStoreReceiptURLメソッドで取得できるので、ローカル検証したいときなど特にSKPaymentTransaction経由で取得しなくて良くなったよってことなんだろう（おそらくローカル検証自体もiOS7より前でも出来る、はず）。</p>

<p>日本語に訳されたドキュメントを読んでもイマイチぴんとこなかったんだけど、プロパティを非推奨にしてくれたおかげで勘違いから解放された。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />30位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>53</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/239eb68265e4ea772484">Xcode5から追加されたAsset Catalog最大のメリット</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-14 19:01:40</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/3b23059b036f27b4c495d848efa276786956e739/68747470733a2f2f646576656c6f7065722e6170706c652e636f6d2f6c6962726172792f696f732f726563697065732f78636f64655f68656c702d696d6167655f636174616c6f672d312e302f4172742f61626f75745f696d6167655f636174616c6f67735f32782e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3b23059b036f27b4c495d848efa276786956e739/68747470733a2f2f646576656c6f7065722e6170706c652e636f6d2f6c6962726172792f696f732f726563697065732f78636f64655f68656c702d696d6167655f636174616c6f672d312e302f4172742f61626f75745f696d6167655f636174616c6f67735f32782e706e67" alt="" data-canonical-src="https://developer.apple.com/library/ios/recipes/xcode_help-image_catalog-1.0/Art/about_image_catalogs_2x.png"></a></p>

<h2>
<span id="最大のメリットはバージョン管理でコンフリクトしづらくなること" class="fragment"></span><a href="#%E6%9C%80%E5%A4%A7%E3%81%AE%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%AF%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%A7%E3%82%B3%E3%83%B3%E3%83%95%E3%83%AA%E3%82%AF%E3%83%88%E3%81%97%E3%81%A5%E3%82%89%E3%81%8F%E3%81%AA%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>最大のメリットはバージョン管理でコンフリクトしづらくなること</h2>

<p>Xcode5から追加されたAsset Catalog（ファイルとしては.xcassets）で画像の管理がだいぶ楽になったけど、これの最大のメリットは、新たにプロジェクトに画像ファイルを追加してもプロジェクトファイル（.pbxproj）が変更されないので、svnやgitを使ってる他の開発メンバーとコンフリクトする確率がぐっと下がる...！</p>

<p>従来通りにAsset Catalogを使わなくても開発は進められるけど絶対使った方がいい。</p>

<h3>
<span id="メリットデメリットを比較せずasset-catalog使わないと言い切ってしまうのは老害ということでどうぞよろしくお願いしたいです" class="fragment"></span><a href="#%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%83%87%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%82%92%E6%AF%94%E8%BC%83%E3%81%9B%E3%81%9Aasset-catalog%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84%E3%81%A8%E8%A8%80%E3%81%84%E5%88%87%E3%81%A3%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86%E3%81%AE%E3%81%AF%E8%80%81%E5%AE%B3%E3%81%A8%E3%81%84%E3%81%86%E3%81%93%E3%81%A8%E3%81%A7%E3%81%A9%E3%81%86%E3%81%9E%E3%82%88%E3%82%8D%E3%81%97%E3%81%8F%E3%81%8A%E9%A1%98%E3%81%84%E3%81%97%E3%81%9F%E3%81%84%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>（メリット・デメリットを比較せず）Asset Catalog使わないと言い切ってしまうのは老害ということでどうぞよろしくお願いしたいです</h3>

<p>（ただ、各メンバーがお互いに画像を追加しあったら.xcassetsが更新されてコンフリクトする気がしないでもないけど、.xcassetsファイル自体はディレクトリで、その下にさらにディレクトリを置いて、そこにあるそれぞれのjsonファイルが有るかどうかで見ている様子なので単純に増やしたり減らしたりではコンフリクトはしなさそう）</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>Xcode5から追加されたAsset Catalogの挙動をいろいろ試してみた<br>
<a href="http://qiita.com/takabosoft/items/ac4f337a6dea31e95885" class="autolink" id="reference-337a34422987d0a835ba">http://qiita.com/takabosoft/items/ac4f337a6dea31e95885</a></p>

<p>iOS Developer Library - Asset Catalog Help<br>
<a href="https://developer.apple.com/library/ios/recipes/xcode_help-image_catalog-1.0/Recipe.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/ios/recipes/xcode_help-image_catalog-1.0/Recipe.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />31位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>53</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/a3fac0026c07ec538fc2">変数/クラス名の命名規則に使われる記法の分類</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-20 00:45:53</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[C]</b> <b>[C++]</b> <b>[Objective-C]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="記法一覧" class="fragment"></span><a href="#%E8%A8%98%E6%B3%95%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>記法一覧</h2>

<table>
<thead>
<tr>
<th style="text-align: left">記法名</th>
<th style="text-align: left">例</th>
<th style="text-align: left">備考</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">スネークケース</td>
<td style="text-align: left">example_case</td>
<td style="text-align: left">すべて小文字で複合語のスペースをアンダースコアで区切る。</td>
</tr>
<tr>
<td style="text-align: left">ローワーキャメルケース</td>
<td style="text-align: left">exampleCase</td>
<td style="text-align: left">先頭を小文字で書き始め、複合語のスペースをなくし要素の先頭は大文字にする</td>
</tr>
<tr>
<td style="text-align: left">アッパーキャメルケース</td>
<td style="text-align: left">ExampleCase</td>
<td style="text-align: left">先頭を大文字で書き始め、複合語のスペースをなくし要素の先頭は大文字にする</td>
</tr>
<tr>
<td style="text-align: left">パスカルケース</td>
<td style="text-align: left">ExampleCase</td>
<td style="text-align: left">アッパーキャメルケースと同じ</td>
</tr>
</tbody>
</table>

<h3>
<span id="スネークケース" class="fragment"></span><a href="#%E3%82%B9%E3%83%8D%E3%83%BC%E3%82%AF%E3%82%B1%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>スネークケース</h3>

<p>見た目がヘビの形をしている。DBのテーブル名やフィールド名、jsonの項目名に使われる事が多い。</p>

<h3>
<span id="キャメルケース" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%A1%E3%83%AB%E3%82%B1%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>キャメルケース</h3>

<p>見た目がラクダのコブの形をしている。キャメルケース自体は小文字で始めるローワーキャメルケースとアッパーキャメルケースに分けられるが、アッパーキャメルケースはパスカルケースとも呼ばれるため、一般的にキャメルケースと言われる場合はローワーキャメルケースを指定される事が多い。</p>

<p>ローワーキャメルケースはJavaやObjective-Cの変数名に使われる事が多く、アッパーキャメルケースはJavaやObjective-Cのクラス名に使われる事が多い。</p>

<h3>
<span id="パスカルケース" class="fragment"></span><a href="#%E3%83%91%E3%82%B9%E3%82%AB%E3%83%AB%E3%82%B1%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>パスカルケース</h3>

<p>記法としてはアッパーキャメルケースと同じ。プログラミング言語Pascalで使われていたことからパスカルケースと呼ばれる。ちなみにプログラミング言語Pascalでは変数名の大文字小文字は区別されない。</p>

<h2>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h2>

<h3>
<span id="ヨーダ記法" class="fragment"></span><a href="#%E3%83%A8%E3%83%BC%E3%83%80%E8%A8%98%E6%B3%95"><i class="fa fa-link"></i></a>ヨーダ記法</h3>

<p>if文の条件比較部分にて比較条件の左側を定数、右側を変数にすることによって、==と書くべきところを=と書いてしまうミスを発覚しやすくする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>int status ;
/*…何かしらにstatusが変わる…*/
const int STATUS_OK = 200
if (status = STATUS_OK)  {/*…*/} //代入してif条件に突入
if (STATUS_OK = status)  {/*…*/} //constに代入できないのでコンパイルエラー
</pre></div></div>

<p>かつてC/C++のような言語ではif文の条件比較で代入が行えてしまうため、このような工夫がミスを減らしていたが、最近の言語では条件比較代入が行えないようになっているため、ヨーダ記法は大きなメリットを持たない。また、C/C++でもコンパイラによっては警告を出すようにも出来るだろう。</p>

<p>さらに、若いプログラマはこのヨーダ記法の必要性について知らない場合が多く、なぜこのようにするのかを考えさせてしまうことや違和感を感じさせてしまうので可読性を下げてしまう。</p>

<p>ちなみにヨーダ記法と呼ばれる理由は、映画スターウォーズに登場するヨーダが倒置法を使っていたことが理由とされている（参考：<a href="http://www.amazon.co.jp/gp/product/4873115655/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4873115655&amp;linkCode=as2&amp;tag=architectlabw-22" rel="nofollow noopener" target="_blank">リーダブルコードP85</a>）。英語の倒置法では＜主語＋（助）動詞＞の順番が逆になったり、目的語や副詞が文頭に来たりすることが由来だそうだ。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />32位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>49</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/0459a8fb52913b8c4625">2013年QiitaのiOSタグでストック数が多い記事ランキング100</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-31 20:36:06</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>2013年ふりかえりのため、この1年でQiitaのiOSタグで共有された記事をQiita APIで取得してストック数順に並べてみました。集計期間は2013年12月31日20:10の1年前からです。</p>

<p>個人的には9位の「Xcodeと自動化」がPodfile.lockなど自動化と直接関係ないところへ一旦話題が移っているのがいいですね。</p>

<p>また、コメント数が多いものはストック数関係なくさらに深く議論されていて興味深いと思うので参考にコメント数も表示してます。</p>

<table>
<thead>
<tr>
<th style="text-align: right">ランク</th>
<th style="text-align: right">非ストック数</th>
<th style="text-align: right">コメント数</th>
<th style="text-align: left">タイトル</th>
<th style="text-align: left">ユーザー</th>
<th style="text-align: center">作成日</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right">1</td>
<td style="text-align: right">431</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/koogawa@github/items/5e2ff5a0312cb1f657f8" id="reference-ca865cffb36395554ac3">iPhoneアプリ申請やAppleの審査に関するメモ</a></td>
<td style="text-align: left"><a href="/koogawa@github" class="user-mention js-hovercard" title="koogawa@github" data-hovercard-target-type="user" data-hovercard-target-name="koogawa@github">@koogawa@github</a></td>
<td style="text-align: center">2013/04/06</td>
</tr>
<tr>
<td style="text-align: right">2</td>
<td style="text-align: right">375</td>
<td style="text-align: right">3</td>
<td style="text-align: left"><a href="http://qiita.com/uasi/items/61dc9df0013c5c65822e" id="reference-1ece22eaca36d4f251a1">Objective-C のコードレビューチェックリスト</a></td>
<td style="text-align: left"><a href="/uasi" class="user-mention js-hovercard" title="uasi" data-hovercard-target-type="user" data-hovercard-target-name="uasi">@uasi</a></td>
<td style="text-align: center">2013/05/30</td>
</tr>
<tr>
<td style="text-align: right">3</td>
<td style="text-align: right">329</td>
<td style="text-align: right">2</td>
<td style="text-align: left"><a href="http://qiita.com/cutmail/items/d8614d72c8f4a9e8348d" id="reference-cb69c97990745dbdb3e2">iOSアプリ開発が捗るXcodeプラグイン</a></td>
<td style="text-align: left"><a href="/cutmail" class="user-mention js-hovercard" title="cutmail" data-hovercard-target-type="user" data-hovercard-target-name="cutmail">@cutmail</a></td>
<td style="text-align: center">2013/12/21</td>
</tr>
<tr>
<td style="text-align: right">4</td>
<td style="text-align: right">268</td>
<td style="text-align: right">1</td>
<td style="text-align: left"><a href="http://qiita.com/makoto_kw/items/d7ed59aff27fb95c9fde" id="reference-982d91c00d7173676fbb">iOS7ステータスバー対策まとめ</a></td>
<td style="text-align: left"><a href="/makoto_kw" class="user-mention js-hovercard" title="makoto_kw" data-hovercard-target-type="user" data-hovercard-target-name="makoto_kw">@makoto_kw</a></td>
<td style="text-align: center">2013/09/24</td>
</tr>
<tr>
<td style="text-align: right">5</td>
<td style="text-align: right">263</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/419c3f71d2bd89ff6e04" id="reference-e9943ddd26aa054175e9">iOSアプリ開発をする自分が始めたばかりの頃から何度も読みなおしてる本</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/09/29</td>
</tr>
<tr>
<td style="text-align: right">6</td>
<td style="text-align: right">257</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/a99ed643b9f0b2ed4254" id="reference-024a52004fd2e38afc75">評判のいいiOSアプリ開発のTips ベスト20</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/05/01</td>
</tr>
<tr>
<td style="text-align: right">7</td>
<td style="text-align: right">245</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/ffd2202eaf92d342f83d" id="reference-7b31a7bc3c391ab8e96c">「顔以外」のものを画像認識する</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/12/02</td>
</tr>
<tr>
<td style="text-align: right">8</td>
<td style="text-align: right">243</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/uasi/items/80660f9aa20afaf671f3" id="reference-73cdd43e19b7a48bc5a2">Objective-C のプロパティ属性のガイドライン</a></td>
<td style="text-align: left"><a href="/uasi" class="user-mention js-hovercard" title="uasi" data-hovercard-target-type="user" data-hovercard-target-name="uasi">@uasi</a></td>
<td style="text-align: center">2013/05/07</td>
</tr>
<tr>
<td style="text-align: right">9</td>
<td style="text-align: right">242</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/keroxp@github/items/de5b1982345cfb1e2320" id="reference-01ccb23cf6688e92a228">Xcodeと自動化</a></td>
<td style="text-align: left"><a href="/keroxp@github" class="user-mention js-hovercard" title="keroxp@github" data-hovercard-target-type="user" data-hovercard-target-name="keroxp@github">@keroxp@github</a></td>
<td style="text-align: center">2013/11/30</td>
</tr>
<tr>
<td style="text-align: right">10</td>
<td style="text-align: right">221</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/170b899df86952544c17" id="reference-eb65f33e9b135104b6cf">Xcodeプロジェクト内のクラスの依存関係を図示する</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/01/10</td>
</tr>
<tr>
<td style="text-align: right">11</td>
<td style="text-align: right">190</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/68f3dfd8d4dd55bae2cb" id="reference-18ace402f02928960503">【iOS7】フラットデザインUI実装に役立つライブラリのまとめ</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/06/18</td>
</tr>
<tr>
<td style="text-align: right">12</td>
<td style="text-align: right">186</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/makoto_kw/items/b23350aed11ea87cd92b" id="reference-ef1e5249b8ee12b8b0ae">趣味でつくるiOSアプリこそJenkinsでリリースを自動化</a></td>
<td style="text-align: left"><a href="/makoto_kw" class="user-mention js-hovercard" title="makoto_kw" data-hovercard-target-type="user" data-hovercard-target-name="makoto_kw">@makoto_kw</a></td>
<td style="text-align: center">2013/12/09</td>
</tr>
<tr>
<td style="text-align: right">13</td>
<td style="text-align: right">185</td>
<td style="text-align: right">2</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/3d139133c9116f115d59" id="reference-4c74faef1a149c70a337">iOS 7 の新機能のサンプルコード集『iOS7 Sampler』</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/09/24</td>
</tr>
<tr>
<td style="text-align: right">14</td>
<td style="text-align: right">172</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/CarmineScarlet/items/59745e26584a00ddfba3" id="reference-c69d9a1ec5cf9b1cd77d">Xcode の便利プラグインまとめ</a></td>
<td style="text-align: left"><a href="/CarmineScarlet" class="user-mention js-hovercard" title="CarmineScarlet" data-hovercard-target-type="user" data-hovercard-target-name="CarmineScarlet">@CarmineScarlet</a></td>
<td style="text-align: center">2013/01/16</td>
</tr>
<tr>
<td style="text-align: right">15</td>
<td style="text-align: right">170</td>
<td style="text-align: right">2</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/c67cb711851f747c35e5" id="reference-6155179c8cd9f3d885c9">iOS実機のSSL通信をプロキシによって傍受したり改ざんする方法</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/12/16</td>
</tr>
<tr>
<td style="text-align: right">16</td>
<td style="text-align: right">170</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/kenchan0130@github/items/24800c00659efd5f5048" id="reference-c523e367d7348cd06b1d">iOS系の便利ライブラリ</a></td>
<td style="text-align: left"><a href="/kenchan0130@github" class="user-mention js-hovercard" title="kenchan0130@github" data-hovercard-target-type="user" data-hovercard-target-name="kenchan0130@github">@kenchan0130@github</a></td>
<td style="text-align: center">2013/01/28</td>
</tr>
<tr>
<td style="text-align: right">17</td>
<td style="text-align: right">164</td>
<td style="text-align: right">2</td>
<td style="text-align: left"><a href="http://qiita.com/u1_fukui/items/d4b88b35179f22fa4a5a" id="reference-d9f5f5a5c7c72dcf8cd2">iPhoneアプリ開発を始めて分からなかった疑問点まとめ</a></td>
<td style="text-align: left"><a href="/u1_fukui" class="user-mention js-hovercard" title="u1_fukui" data-hovercard-target-type="user" data-hovercard-target-name="u1_fukui">@u1_fukui</a></td>
<td style="text-align: center">2013/05/25</td>
</tr>
<tr>
<td style="text-align: right">18</td>
<td style="text-align: right">136</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/7051af0919b5286aecfe" id="reference-13fb12f1ae6f22eca3bd">iOS7でナビゲーションバーやステータスバーをカスタマイズする</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/09/19</td>
</tr>
<tr>
<td style="text-align: right">19</td>
<td style="text-align: right">129</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yusuga_/items/809cfd3887c8841bee2f" id="reference-6cd8c14451350fa7c529">iOSアプリ開発で格段に開発速度を高めているXCodeの機能</a></td>
<td style="text-align: left"><a href="/yusuga_" class="user-mention js-hovercard" title="yusuga_" data-hovercard-target-type="user" data-hovercard-target-name="yusuga_">@yusuga_</a></td>
<td style="text-align: center">2013/03/27</td>
</tr>
<tr>
<td style="text-align: right">20</td>
<td style="text-align: right">128</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/makoto_kw/items/edf758a67bd4c2ba5b7a" id="reference-f6fee6f798010223fd9b">CocoaPodsでPodの利用＆作成のメモ</a></td>
<td style="text-align: left"><a href="/makoto_kw" class="user-mention js-hovercard" title="makoto_kw" data-hovercard-target-type="user" data-hovercard-target-name="makoto_kw">@makoto_kw</a></td>
<td style="text-align: center">2013/02/05</td>
</tr>
<tr>
<td style="text-align: right">21</td>
<td style="text-align: right">119</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/awakia/items/fc5c0283040ac780dc13" id="reference-092066d60a6b72fa7c38">iOS7対策にとりあえず見ておいたらよさそうなリンク一覧</a></td>
<td style="text-align: left"><a href="/awakia" class="user-mention js-hovercard" title="awakia" data-hovercard-target-type="user" data-hovercard-target-name="awakia">@awakia</a></td>
<td style="text-align: center">2013/06/11</td>
</tr>
<tr>
<td style="text-align: right">22</td>
<td style="text-align: right">110</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/Vexus2/items/741550f1821a73227c2e" id="reference-e48015373c650f0aabb4">[iOS]Revealで快適なGUIデバッグ</a></td>
<td style="text-align: left"><a href="/Vexus2" class="user-mention js-hovercard" title="Vexus2" data-hovercard-target-type="user" data-hovercard-target-name="Vexus2">@Vexus2</a></td>
<td style="text-align: center">2013/06/04</td>
</tr>
<tr>
<td style="text-align: right">23</td>
<td style="text-align: right">101</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/6ee131aff8751b42666a" id="reference-48b6fb2cf30bf87ad691">『iOSアプリ開発 達人のレシピ100』のレシピ一覧</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/05/28</td>
</tr>
<tr>
<td style="text-align: right">24</td>
<td style="text-align: right">98</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/inonb/items/0386dd98b00c6bbfdce8" id="reference-5f17e8217b93c7fb186b">かんたんMacアプリ for iOSエンジニア</a></td>
<td style="text-align: left"><a href="/inonb" class="user-mention js-hovercard" title="inonb" data-hovercard-target-type="user" data-hovercard-target-name="inonb">@inonb</a></td>
<td style="text-align: center">2013/07/15</td>
</tr>
<tr>
<td style="text-align: right">25</td>
<td style="text-align: right">94</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/koogawa@github/items/e0b3862c0fbdf97b579f" id="reference-f8161ab3e60a335b7833">iPhoneで取得・検知できる情報10連発！（サンプルアプリもあるよ）</a></td>
<td style="text-align: left"><a href="/koogawa@github" class="user-mention js-hovercard" title="koogawa@github" data-hovercard-target-type="user" data-hovercard-target-name="koogawa@github">@koogawa@github</a></td>
<td style="text-align: center">2013/12/11</td>
</tr>
<tr>
<td style="text-align: right">26</td>
<td style="text-align: right">89</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/eda02dc7d334c339ff64" id="reference-eb559d601d00213671fa">フリーの iOS 向け音声認識／音声合成ライブラリ『OpenEars』の使い方</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/08/10</td>
</tr>
<tr>
<td style="text-align: right">27</td>
<td style="text-align: right">89</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/cyan_ishii/items/0babccb20c0f183b1c5f" id="reference-29b35f42b170dad6dcbd">ios7のnavigationbarをios6以前のデザインに合わせる方法</a></td>
<td style="text-align: left"><a href="/cyan_ishii" class="user-mention js-hovercard" title="cyan_ishii" data-hovercard-target-type="user" data-hovercard-target-name="cyan_ishii">@cyan_ishii</a></td>
<td style="text-align: center">2013/09/24</td>
</tr>
<tr>
<td style="text-align: right">28</td>
<td style="text-align: right">88</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/uasi/items/fd93314cba7d41e53499" id="reference-aa738c0a8669f658f7e3">weakify/strongify マクロを使うと weak self パターンが簡単に書ける</a></td>
<td style="text-align: left"><a href="/uasi" class="user-mention js-hovercard" title="uasi" data-hovercard-target-type="user" data-hovercard-target-name="uasi">@uasi</a></td>
<td style="text-align: center">2013/10/15</td>
</tr>
<tr>
<td style="text-align: right">29</td>
<td style="text-align: right">88</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/851c3cfa8ca076a5ece3" id="reference-f4332eb6011a684030a3">シャッター音の鳴らないカメラアプリを実装する</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/01/08</td>
</tr>
<tr>
<td style="text-align: right">30</td>
<td style="text-align: right">87</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/ne_ko_/items/5da4b2a247e65431c7cf" id="reference-d9c21993f5c5b6246b0f">iOS 6/7 で UILabel などの見た目がずれるよ〜とお嘆きのあなたへ</a></td>
<td style="text-align: left"><a href="/ne_ko_" class="user-mention js-hovercard" title="ne_ko_" data-hovercard-target-type="user" data-hovercard-target-name="ne_ko_">@ne_ko_</a></td>
<td style="text-align: center">2013/09/20</td>
</tr>
<tr>
<td style="text-align: right">31</td>
<td style="text-align: right">85</td>
<td style="text-align: right">1</td>
<td style="text-align: left"><a href="http://qiita.com/kouchi67/items/c8405c8c34e0e1a4168e" id="reference-891f91803fa5be3e3c45">これからiOSやる奴はここ読んどけ</a></td>
<td style="text-align: left"><a href="/kouchi67" class="user-mention js-hovercard" title="kouchi67" data-hovercard-target-type="user" data-hovercard-target-name="kouchi67">@kouchi67</a></td>
<td style="text-align: center">2013/05/26</td>
</tr>
<tr>
<td style="text-align: right">32</td>
<td style="text-align: right">82</td>
<td style="text-align: right">4</td>
<td style="text-align: left"><a href="http://qiita.com/naodroid/items/186cc7f8924fd62c72c3" id="reference-ace95d9cb093a5285a12">イニシャライザが守るべき3つのルール</a></td>
<td style="text-align: left"><a href="/naodroid" class="user-mention js-hovercard" title="naodroid" data-hovercard-target-type="user" data-hovercard-target-name="naodroid">@naodroid</a></td>
<td style="text-align: center">2013/06/19</td>
</tr>
<tr>
<td style="text-align: right">33</td>
<td style="text-align: right">82</td>
<td style="text-align: right">4</td>
<td style="text-align: left"><a href="http://qiita.com/KUMAN/items/8bcd083e59d68ad94927" id="reference-ef211dbc84cb0060bb9e">Modern Objective-Cでのシンプルなプロパティ記述方式</a></td>
<td style="text-align: left"><a href="/KUMAN" class="user-mention js-hovercard" title="KUMAN" data-hovercard-target-type="user" data-hovercard-target-name="KUMAN">@KUMAN</a></td>
<td style="text-align: center">2013/04/15</td>
</tr>
<tr>
<td style="text-align: right">34</td>
<td style="text-align: right">80</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/beakmark/items/33c0b73603e491f08a33" id="reference-a391dda1b9635228cfc8">iOSアプリの署名を付け替える</a></td>
<td style="text-align: left"><a href="/beakmark" class="user-mention js-hovercard" title="beakmark" data-hovercard-target-type="user" data-hovercard-target-name="beakmark">@beakmark</a></td>
<td style="text-align: center">2013/10/26</td>
</tr>
<tr>
<td style="text-align: right">35</td>
<td style="text-align: right">79</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/slightair/items/0a30469d598a12e473ef" id="reference-f1dd0afe8c3796f5b9ad">iOS/Android アプリのアイコンつくるなら Makeappicon がべんり</a></td>
<td style="text-align: left"><a href="/slightair" class="user-mention js-hovercard" title="slightair" data-hovercard-target-type="user" data-hovercard-target-name="slightair">@slightair</a></td>
<td style="text-align: center">2013/09/12</td>
</tr>
<tr>
<td style="text-align: right">36</td>
<td style="text-align: right">77</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/gonsee/items/76ee350d6ef266bb33da" id="reference-7ae3551d6c796b100136">objc.io #1-1 軽量なView Controller（日本語訳）</a></td>
<td style="text-align: left"><a href="/gonsee" class="user-mention js-hovercard" title="gonsee" data-hovercard-target-type="user" data-hovercard-target-name="gonsee">@gonsee</a></td>
<td style="text-align: center">2013/11/24</td>
</tr>
<tr>
<td style="text-align: right">37</td>
<td style="text-align: right">77</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/ryota-ku/items/3e3485baed79842c51f2" id="reference-fd7b8233cdae296f1763">以外と知られていないxibのこと</a></td>
<td style="text-align: left"><a href="/ryota-ku" class="user-mention js-hovercard" title="ryota-ku" data-hovercard-target-type="user" data-hovercard-target-name="ryota-ku">@ryota-ku</a></td>
<td style="text-align: center">2013/09/18</td>
</tr>
<tr>
<td style="text-align: right">38</td>
<td style="text-align: right">77</td>
<td style="text-align: right">3</td>
<td style="text-align: left"><a href="http://qiita.com/makopo/items/4d358981c4c4cff51df0" id="reference-693dda31ac21ad7c3e51">Objective C のプロパティ属性まとめ</a></td>
<td style="text-align: left"><a href="/makopo" class="user-mention js-hovercard" title="makopo" data-hovercard-target-type="user" data-hovercard-target-name="makopo">@makopo</a></td>
<td style="text-align: center">2013/03/20</td>
</tr>
<tr>
<td style="text-align: right">39</td>
<td style="text-align: right">76</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/hedjirog/items/abd48a55387891cc8503" id="reference-1e79f0ec2eec2fa6dd88">iBeaconを利用したアプリ開発でチェックしておきたい！良記事・ソースコードまとめ</a></td>
<td style="text-align: left"><a href="/hedjirog" class="user-mention js-hovercard" title="hedjirog" data-hovercard-target-type="user" data-hovercard-target-name="hedjirog">@hedjirog</a></td>
<td style="text-align: center">2013/12/02</td>
</tr>
<tr>
<td style="text-align: right">40</td>
<td style="text-align: right">76</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/ytka/items/8835743c5a60d3ee5b44" id="reference-e7ceb47030da966af47a">CoreDataの非同期処理 - UIスレッドを止めないために</a></td>
<td style="text-align: left"><a href="/ytka" class="user-mention js-hovercard" title="ytka" data-hovercard-target-type="user" data-hovercard-target-name="ytka">@ytka</a></td>
<td style="text-align: center">2013/11/24</td>
</tr>
<tr>
<td style="text-align: right">41</td>
<td style="text-align: right">73</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/y_matsuwitter/items/4fcccb3806499ff5a0be" id="reference-33bc16dd398b9737217e">ビルドからTestflight配信までやるコマンド作った</a></td>
<td style="text-align: left"><a href="/y_matsuwitter" class="user-mention js-hovercard" title="y_matsuwitter" data-hovercard-target-type="user" data-hovercard-target-name="y_matsuwitter">@y_matsuwitter</a></td>
<td style="text-align: center">2013/10/06</td>
</tr>
<tr>
<td style="text-align: right">42</td>
<td style="text-align: right">70</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/griffin_stewie/items/8371c09059b3ba7bb202" id="reference-512bd66dccca32aa2b0c">Background Fetch を試してみた</a></td>
<td style="text-align: left"><a href="/griffin_stewie" class="user-mention js-hovercard" title="griffin_stewie" data-hovercard-target-type="user" data-hovercard-target-name="griffin_stewie">@griffin_stewie</a></td>
<td style="text-align: center">2013/09/29</td>
</tr>
<tr>
<td style="text-align: right">43</td>
<td style="text-align: right">69</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/8a1d064411a2a122983d" id="reference-e837a6baa3ef037eecaf">UIKit で物理演算エンジンを使用する</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/05/01</td>
</tr>
<tr>
<td style="text-align: right">44</td>
<td style="text-align: right">69</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yusuga_/items/3751cf2a0b0dbf2eefd8" id="reference-4d4113b0d1e6f355dbfb">NSLog デバッグ用の各種ログマクロまとめ</a></td>
<td style="text-align: left"><a href="/yusuga_" class="user-mention js-hovercard" title="yusuga_" data-hovercard-target-type="user" data-hovercard-target-name="yusuga_">@yusuga_</a></td>
<td style="text-align: center">2013/02/21</td>
</tr>
<tr>
<td style="text-align: right">45</td>
<td style="text-align: right">68</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/223492e4f061032e652e" id="reference-8e33e152afdde0dd306b">iOSで使える日本語OKな音声読み上げエンジン8種（TTS,音声合成）</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/12/02</td>
</tr>
<tr>
<td style="text-align: right">46</td>
<td style="text-align: right">67</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/5d8a245e5743f77df9eb" id="reference-e51ad0cffc65506fe340">Xcodeのファイルテンプレートを自作する</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/01/09</td>
</tr>
<tr>
<td style="text-align: right">47</td>
<td style="text-align: right">66</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/amay077/items/95a4139e6f553d8a56a1" id="reference-7bf799b1858e20630340">ARC のメモリ解放タイミングを調べた</a></td>
<td style="text-align: left"><a href="/amay077" class="user-mention js-hovercard" title="amay077" data-hovercard-target-type="user" data-hovercard-target-name="amay077">@amay077</a></td>
<td style="text-align: center">2013/09/02</td>
</tr>
<tr>
<td style="text-align: right">48</td>
<td style="text-align: right">64</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/asakahara/items/9cb68bef56ca70b505c6" id="reference-c8b208605729519d5747">AFNetworking 2.0 のまとめ</a></td>
<td style="text-align: left"><a href="/asakahara" class="user-mention js-hovercard" title="asakahara" data-hovercard-target-type="user" data-hovercard-target-name="asakahara">@asakahara</a></td>
<td style="text-align: center">2013/11/21</td>
</tr>
<tr>
<td style="text-align: right">49</td>
<td style="text-align: right">64</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/e38e8bafc17144b7af79" id="reference-f54e8b4d28b7a51765cd">画像処理のデファクトスタンダードライブラリGPUImageの基本と応用</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/10/14</td>
</tr>
<tr>
<td style="text-align: right">50</td>
<td style="text-align: right">60</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/naodroid/items/d84a301527cba7900294" id="reference-792241040514104beedd">Android開発者がiOS開発を始めるときに便利かもなAPI対応表</a></td>
<td style="text-align: left"><a href="/naodroid" class="user-mention js-hovercard" title="naodroid" data-hovercard-target-type="user" data-hovercard-target-name="naodroid">@naodroid</a></td>
<td style="text-align: center">2013/06/24</td>
</tr>
<tr>
<td style="text-align: right">51</td>
<td style="text-align: right">60</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/KUMAN/items/a2a1e903b26b062d2d79" id="reference-e0e8782032bb2ce44000">AVFoundationで動画の加工合成処理</a></td>
<td style="text-align: left"><a href="/KUMAN" class="user-mention js-hovercard" title="KUMAN" data-hovercard-target-type="user" data-hovercard-target-name="KUMAN">@KUMAN</a></td>
<td style="text-align: center">2013/04/22</td>
</tr>
<tr>
<td style="text-align: right">52</td>
<td style="text-align: right">59</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/EntreGulss/items/d7d9fb5d0b93eb509d43" id="reference-1b0effa99770df0000da">URLから画像を非同期に読み込む3種類の実装</a></td>
<td style="text-align: left"><a href="/EntreGulss" class="user-mention js-hovercard" title="EntreGulss" data-hovercard-target-type="user" data-hovercard-target-name="EntreGulss">@EntreGulss</a></td>
<td style="text-align: center">2013/10/01</td>
</tr>
<tr>
<td style="text-align: right">53</td>
<td style="text-align: right">58</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/11be7daeee0a7cd093c6" id="reference-a19af074c4f9b7ded0e8">iOSアプリ開発でアプリデザイン経験のない人にデザインの納品物をお願いするときのリスト</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/02/19</td>
</tr>
<tr>
<td style="text-align: right">54</td>
<td style="text-align: right">57</td>
<td style="text-align: right">2</td>
<td style="text-align: left"><a href="http://qiita.com/u1_fukui/items/04bb758fa03343d176ef" id="reference-3fe57650aee7d7b2bfe4">ARCを使用したメモリ管理の基礎</a></td>
<td style="text-align: left"><a href="/u1_fukui" class="user-mention js-hovercard" title="u1_fukui" data-hovercard-target-type="user" data-hovercard-target-name="u1_fukui">@u1_fukui</a></td>
<td style="text-align: center">2013/06/21</td>
</tr>
<tr>
<td style="text-align: right">55</td>
<td style="text-align: right">55</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/asakahara/items/9d553a76e82df00319cd" id="reference-c641e10b5fe4780e3fd0">無料でここまでできる！iOSでグラフ／チャートを描くためのライブラリ</a></td>
<td style="text-align: left"><a href="/asakahara" class="user-mention js-hovercard" title="asakahara" data-hovercard-target-type="user" data-hovercard-target-name="asakahara">@asakahara</a></td>
<td style="text-align: center">2013/12/15</td>
</tr>
<tr>
<td style="text-align: right">56</td>
<td style="text-align: right">54</td>
<td style="text-align: right">1</td>
<td style="text-align: left"><a href="http://qiita.com/fnobi/items/2f08a67800dec1d61f21" id="reference-a24104c22da2318fa368">WebAudioAPIで遊べるようになった</a></td>
<td style="text-align: left"><a href="/fnobi" class="user-mention js-hovercard" title="fnobi" data-hovercard-target-type="user" data-hovercard-target-name="fnobi">@fnobi</a></td>
<td style="text-align: center">2013/10/22</td>
</tr>
<tr>
<td style="text-align: right">57</td>
<td style="text-align: right">54</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/uro_uro_/items/d4e5fb66f2039090000f" id="reference-ef9bf868d444fa673225">UIWebViewを使うときに気をつけていること</a></td>
<td style="text-align: left"><a href="/uro_uro_" class="user-mention js-hovercard" title="uro_uro_" data-hovercard-target-type="user" data-hovercard-target-name="uro_uro_">@uro_uro_</a></td>
<td style="text-align: center">2013/01/31</td>
</tr>
<tr>
<td style="text-align: right">58</td>
<td style="text-align: right">53</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/w650/items/33ef2894e4b2df143a7a" id="reference-713eaae5a2ccdb63e1e7">【非公式】Qiitaクライアントアプリ公開!!【iPhone】</a></td>
<td style="text-align: left"><a href="/w650" class="user-mention js-hovercard" title="w650" data-hovercard-target-type="user" data-hovercard-target-name="w650">@w650</a></td>
<td style="text-align: center">2013/12/12</td>
</tr>
<tr>
<td style="text-align: right">59</td>
<td style="text-align: right">52</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/e776cd80f7ef1eff9c39" id="reference-5da609c22f761b3882f3">vImageで画像処理を行う</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/02/07</td>
</tr>
<tr>
<td style="text-align: right">60</td>
<td style="text-align: right">51</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/ux_design_tokyo/items/75cbd122651f470a84f3" id="reference-615320afb8f3e2a1c520">iOS7対応</a></td>
<td style="text-align: left"><a href="/ux_design_tokyo" class="user-mention js-hovercard" title="ux_design_tokyo" data-hovercard-target-type="user" data-hovercard-target-name="ux_design_tokyo">@ux_design_tokyo</a></td>
<td style="text-align: center">2013/09/19</td>
</tr>
<tr>
<td style="text-align: right">61</td>
<td style="text-align: right">51</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/5bfba10e642b453e6d30" id="reference-6e286a5018ea2600eaf4">.ipa ファイル生成を自動化する</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/03/13</td>
</tr>
<tr>
<td style="text-align: right">62</td>
<td style="text-align: right">50</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/3809f9a6e0945554bc37" id="reference-c807d77824cbf7d601d3">openFrameworks for iOS の日本語チュートリアル記事まとめ</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/12/09</td>
</tr>
<tr>
<td style="text-align: right">63</td>
<td style="text-align: right">48</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/2fa3f814d667af62d73e" id="reference-1f52ca574b7e165a044d">iOSアプリ開発でもゆるくJenkinsを使う</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/02/16</td>
</tr>
<tr>
<td style="text-align: right">64</td>
<td style="text-align: right">48</td>
<td style="text-align: right">5</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/c9338a715016e7a812b1" id="reference-97177e37127fee55e685">nilとNSNullの違いとNSNullをnilのように振る舞うようにする</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/04/15</td>
</tr>
<tr>
<td style="text-align: right">65</td>
<td style="text-align: right">47</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/c72ca6d3c7de0e0d63ba" id="reference-ad8af6e0bb763f461d0b">APIクライアントをAFNetworkingを用いてつくる手順</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/09/08</td>
</tr>
<tr>
<td style="text-align: right">66</td>
<td style="text-align: right">47</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yusuga_/items/4847c86d0b99ac68727e" id="reference-8bf120deffe365a57947">NSRegularExpression iOSで使う正規表現</a></td>
<td style="text-align: left"><a href="/yusuga_" class="user-mention js-hovercard" title="yusuga_" data-hovercard-target-type="user" data-hovercard-target-name="yusuga_">@yusuga_</a></td>
<td style="text-align: center">2013/02/25</td>
</tr>
<tr>
<td style="text-align: right">67</td>
<td style="text-align: right">47</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/sora0077@github/items/154f8d39f7189f22daa7" id="reference-620a135db1e0c8ced511">iOS開発でよく使うマクロ数種</a></td>
<td style="text-align: left"><a href="/sora0077@github" class="user-mention js-hovercard" title="sora0077@github" data-hovercard-target-type="user" data-hovercard-target-name="sora0077@github">@sora0077@github</a></td>
<td style="text-align: center">2013/04/01</td>
</tr>
<tr>
<td style="text-align: right">68</td>
<td style="text-align: right">47</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/78af3e20b4d6cd18f8a6" id="reference-768113c62855f658a7f3"> Instrumentsを使用せず、プログラムから空きメモリ量や使用中のメモリ量、CPU負荷を取得する</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/01/06</td>
</tr>
<tr>
<td style="text-align: right">69</td>
<td style="text-align: right">46</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/hachinobu/items/fdcd2be5f00bff31a33e" id="reference-b86572b2486464ac7fdf">NSDictionary⇔自作オブジェクトに変換する方法</a></td>
<td style="text-align: left"><a href="/hachinobu" class="user-mention js-hovercard" title="hachinobu" data-hovercard-target-type="user" data-hovercard-target-name="hachinobu">@hachinobu</a></td>
<td style="text-align: center">2013/08/19</td>
</tr>
<tr>
<td style="text-align: right">70</td>
<td style="text-align: right">45</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yamakuda/items/8003b71c272c3327a856" id="reference-681622c59aba94734342">iPhone,iPadのアイコンなどのサイズ</a></td>
<td style="text-align: left"><a href="/yamakuda" class="user-mention js-hovercard" title="yamakuda" data-hovercard-target-type="user" data-hovercard-target-name="yamakuda">@yamakuda</a></td>
<td style="text-align: center">2013/02/07</td>
</tr>
<tr>
<td style="text-align: right">71</td>
<td style="text-align: right">43</td>
<td style="text-align: right">6</td>
<td style="text-align: left"><a href="http://qiita.com/takabosoft/items/50886fc211a4033856d2" id="reference-858419ba5092480e21bb">TAKABO SOFT流 Objective-C ソースの書き方</a></td>
<td style="text-align: left"><a href="/takabosoft" class="user-mention js-hovercard" title="takabosoft" data-hovercard-target-type="user" data-hovercard-target-name="takabosoft">@takabosoft</a></td>
<td style="text-align: center">2013/10/31</td>
</tr>
<tr>
<td style="text-align: right">72</td>
<td style="text-align: right">43</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/makoto_kw/items/39d63b86a8a0a5debc3f" id="reference-7944a62a9d59627fbe0e">Flat UI ColorsをUIColorで表現してみた</a></td>
<td style="text-align: left"><a href="/makoto_kw" class="user-mention js-hovercard" title="makoto_kw" data-hovercard-target-type="user" data-hovercard-target-name="makoto_kw">@makoto_kw</a></td>
<td style="text-align: center">2013/06/25</td>
</tr>
<tr>
<td style="text-align: right">73</td>
<td style="text-align: right">42</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/7f74536fa2ab3cc437f5" id="reference-d92ea0f9ef88f110625f">iOSでヘッドフォンを抜いた時のイベントをフックする</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/03/10</td>
</tr>
<tr>
<td style="text-align: right">74</td>
<td style="text-align: right">42</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yusuga_/items/4698478a246245a0f6b4" id="reference-f3ca955e81a85d5aee10">NSFileManager よく使うファイル操作メソッド(保存、削除、取得、列挙)</a></td>
<td style="text-align: left"><a href="/yusuga_" class="user-mention js-hovercard" title="yusuga_" data-hovercard-target-type="user" data-hovercard-target-name="yusuga_">@yusuga_</a></td>
<td style="text-align: center">2013/02/22</td>
</tr>
<tr>
<td style="text-align: right">75</td>
<td style="text-align: right">42</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/cd612613761720ccc059" id="reference-508c1b5fa8a075609583">ダウンロード可能な Audio Unit 関連のサンプルコード11個</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/02/21</td>
</tr>
<tr>
<td style="text-align: right">76</td>
<td style="text-align: right">41</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yuch_i/items/4b3aea76772c103c215b" id="reference-9bb64b2f289484ad0bff">影付きビューの表示を高速化する</a></td>
<td style="text-align: left"><a href="/yuch_i" class="user-mention js-hovercard" title="yuch_i" data-hovercard-target-type="user" data-hovercard-target-name="yuch_i">@yuch_i</a></td>
<td style="text-align: center">2013/01/24</td>
</tr>
<tr>
<td style="text-align: right">77</td>
<td style="text-align: right">41</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/glayash/items/25d54ff2c9d91f0b6673" id="reference-1980b0c91e44411e9494">convertRect:toView:系メソッドについて。</a></td>
<td style="text-align: left"><a href="/glayash" class="user-mention js-hovercard" title="glayash" data-hovercard-target-type="user" data-hovercard-target-name="glayash">@glayash</a></td>
<td style="text-align: center">2013/04/06</td>
</tr>
<tr>
<td style="text-align: right">78</td>
<td style="text-align: right">40</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/a7ed557d382077498181" id="reference-3d8066300329e45cafe9">iOS7からのUITabBarのデザインのカスタマイズまとめ</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/11/11</td>
</tr>
<tr>
<td style="text-align: right">79</td>
<td style="text-align: right">39</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/himara2/items/3a4d4c120a4ff1ea2e56" id="reference-7834109bc40abe6e78b9">PUSH通知機能を持ったiPhoneアプリを作る（デバイストークンの登録とメッセージの受信）</a></td>
<td style="text-align: left"><a href="/himara2" class="user-mention js-hovercard" title="himara2" data-hovercard-target-type="user" data-hovercard-target-name="himara2">@himara2</a></td>
<td style="text-align: center">2013/05/07</td>
</tr>
<tr>
<td style="text-align: right">80</td>
<td style="text-align: right">39</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/roothybrid7/items/6e1399cec9fbe865b132" id="reference-f6df40b623e5f1b996bf">iOSのUIWebViewでHTTPステータスをチェックする</a></td>
<td style="text-align: left"><a href="/roothybrid7" class="user-mention js-hovercard" title="roothybrid7" data-hovercard-target-type="user" data-hovercard-target-name="roothybrid7">@roothybrid7</a></td>
<td style="text-align: center">2013/01/20</td>
</tr>
<tr>
<td style="text-align: right">81</td>
<td style="text-align: right">38</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/jarinosuke@github/items/f83e846ffb866ca5b7b7" id="reference-12d0f63e8a868ab903ba">Launch Arguments を使った一つ上の NSLocalizedString</a></td>
<td style="text-align: left"><a href="/jarinosuke@github" class="user-mention js-hovercard" title="jarinosuke@github" data-hovercard-target-type="user" data-hovercard-target-name="jarinosuke@github">@jarinosuke@github</a></td>
<td style="text-align: center">2013/12/16</td>
</tr>
<tr>
<td style="text-align: right">82</td>
<td style="text-align: right">38</td>
<td style="text-align: right">1</td>
<td style="text-align: left"><a href="http://qiita.com/yusuga_/items/4054e1e197a6e8f221e6" id="reference-1113e8abdfdd2c8aa610">StoreKit アプリ内課金で正常に終了していないトランザクションに対する対処方法</a></td>
<td style="text-align: left"><a href="/yusuga_" class="user-mention js-hovercard" title="yusuga_" data-hovercard-target-type="user" data-hovercard-target-name="yusuga_">@yusuga_</a></td>
<td style="text-align: center">2013/03/21</td>
</tr>
<tr>
<td style="text-align: right">83</td>
<td style="text-align: right">37</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/hirayaCM/items/513786631575db8e1fb1" id="reference-65e7003f2a0ba87bbc90">iOSアプリのUIテストツール候補</a></td>
<td style="text-align: left"><a href="/hirayaCM" class="user-mention js-hovercard" title="hirayaCM" data-hovercard-target-type="user" data-hovercard-target-name="hirayaCM">@hirayaCM</a></td>
<td style="text-align: center">2013/10/10</td>
</tr>
<tr>
<td style="text-align: right">84</td>
<td style="text-align: right">37</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/b4363d4b41ac96bd23fc" id="reference-6b6c0007ead23a888904">iOSアプリに友達招待機能を追加できる『AppSocially SDK』の使い方</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/09/06</td>
</tr>
<tr>
<td style="text-align: right">85</td>
<td style="text-align: right">37</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yusuga_/items/2be8c55ca561bba44702" id="reference-112613a918e02633a017">CoreText ヒラギノフォント(日本語)で正確に描画サイズを取得する</a></td>
<td style="text-align: left"><a href="/yusuga_" class="user-mention js-hovercard" title="yusuga_" data-hovercard-target-type="user" data-hovercard-target-name="yusuga_">@yusuga_</a></td>
<td style="text-align: center">2013/03/22</td>
</tr>
<tr>
<td style="text-align: right">86</td>
<td style="text-align: right">36</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/Jacminik/items/21f87aadc3a4363b9802" id="reference-b1785e4fbe26783fadb8">UILabelを使って行間や文字間を簡易的に調整する。</a></td>
<td style="text-align: left"><a href="/Jacminik" class="user-mention js-hovercard" title="Jacminik" data-hovercard-target-type="user" data-hovercard-target-name="Jacminik">@Jacminik</a></td>
<td style="text-align: center">2013/06/14</td>
</tr>
<tr>
<td style="text-align: right">87</td>
<td style="text-align: right">35</td>
<td style="text-align: right">2</td>
<td style="text-align: left"><a href="http://qiita.com/jtemplej/items/c3c25a5301c7250305fe" id="reference-97aa3e1cb5cbf8578a10">AFNetworking 2.0</a></td>
<td style="text-align: left"><a href="/jtemplej" class="user-mention js-hovercard" title="jtemplej" data-hovercard-target-type="user" data-hovercard-target-name="jtemplej">@jtemplej</a></td>
<td style="text-align: center">2013/11/04</td>
</tr>
<tr>
<td style="text-align: right">88</td>
<td style="text-align: right">35</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/shu223/items/c15547667f8318d4acfe" id="reference-e7b2bfe708f7dfa2fabb">パスに沿ってアニメーションさせる</a></td>
<td style="text-align: left"><a href="/shu223" class="user-mention js-hovercard" title="shu223" data-hovercard-target-type="user" data-hovercard-target-name="shu223">@shu223</a></td>
<td style="text-align: center">2013/05/01</td>
</tr>
<tr>
<td style="text-align: right">89</td>
<td style="text-align: right">35</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/30c518abd0609c80c741" id="reference-9707369fee47aa5c7a3e">iOSアプリにおけるOAuth連携の実装</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/02/16</td>
</tr>
<tr>
<td style="text-align: right">90</td>
<td style="text-align: right">35</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yusuga_/items/8c057a67e0ac021c54bc" id="reference-ef637b903ad9e50011d8">iOS /tmpと/Cachesディレクトリの違いと運用方法</a></td>
<td style="text-align: left"><a href="/yusuga_" class="user-mention js-hovercard" title="yusuga_" data-hovercard-target-type="user" data-hovercard-target-name="yusuga_">@yusuga_</a></td>
<td style="text-align: center">2013/04/18</td>
</tr>
<tr>
<td style="text-align: right">91</td>
<td style="text-align: right">34</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yuch_i/items/b4612fae110254c816f4" id="reference-f8c478e4db9619325e0b">IB/Storyboard使わない派のlayoutSubviewsによるレイアウト調整</a></td>
<td style="text-align: left"><a href="/yuch_i" class="user-mention js-hovercard" title="yuch_i" data-hovercard-target-type="user" data-hovercard-target-name="yuch_i">@yuch_i</a></td>
<td style="text-align: center">2013/11/30</td>
</tr>
<tr>
<td style="text-align: right">92</td>
<td style="text-align: right">33</td>
<td style="text-align: right">2</td>
<td style="text-align: left"><a href="http://qiita.com/fmtonakai/items/6d13c8e535c5d8904c60" id="reference-99fa975b2f2a6b6dac71">In App Purchaseのレシートをローカルで検証できるようになった話</a></td>
<td style="text-align: left"><a href="/fmtonakai" class="user-mention js-hovercard" title="fmtonakai" data-hovercard-target-type="user" data-hovercard-target-name="fmtonakai">@fmtonakai</a></td>
<td style="text-align: center">2013/12/06</td>
</tr>
<tr>
<td style="text-align: right">93</td>
<td style="text-align: right">33</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/makoto_kw/items/5a99e37f7172337ae4be" id="reference-3980b39272b6eb7b4733">iOSアプリ未インストール時にSafariでカスタムURLスキームを開く時の対策</a></td>
<td style="text-align: left"><a href="/makoto_kw" class="user-mention js-hovercard" title="makoto_kw" data-hovercard-target-type="user" data-hovercard-target-name="makoto_kw">@makoto_kw</a></td>
<td style="text-align: center">2013/03/04</td>
</tr>
<tr>
<td style="text-align: right">94</td>
<td style="text-align: right">33</td>
<td style="text-align: right">5</td>
<td style="text-align: left"><a href="http://qiita.com/kasajei/items/8c9ba3030c3eae736e89" id="reference-98f6ff18c4fd784a6605">Xcode&amp;gitで開発する時の.gitignore</a></td>
<td style="text-align: left"><a href="/kasajei" class="user-mention js-hovercard" title="kasajei" data-hovercard-target-type="user" data-hovercard-target-name="kasajei">@kasajei</a></td>
<td style="text-align: center">2013/01/18</td>
</tr>
<tr>
<td style="text-align: right">95</td>
<td style="text-align: right">32</td>
<td style="text-align: right">3</td>
<td style="text-align: left"><a href="http://qiita.com/somtd@github/items/9386e2185adfff4c54bc" id="reference-5eb6ed588066ddb732fc">自前のライブラリをCocoaPodsで管理するメモ</a></td>
<td style="text-align: left"><a href="/somtd@github" class="user-mention js-hovercard" title="somtd@github" data-hovercard-target-type="user" data-hovercard-target-name="somtd@github">@somtd@github</a></td>
<td style="text-align: center">2013/07/28</td>
</tr>
<tr>
<td style="text-align: right">96</td>
<td style="text-align: right">32</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/griffin_stewie/items/baf6782a5e363a091178" id="reference-de3037881a1b10d2f505">Remote Push からの Background Fetch を試してみた</a></td>
<td style="text-align: left"><a href="/griffin_stewie" class="user-mention js-hovercard" title="griffin_stewie" data-hovercard-target-type="user" data-hovercard-target-name="griffin_stewie">@griffin_stewie</a></td>
<td style="text-align: center">2013/10/08</td>
</tr>
<tr>
<td style="text-align: right">97</td>
<td style="text-align: right">32</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/a5e16fa0f9c332a55ccf" id="reference-069a077815811633955f">自前コンテナでaddChildViewController:するときの話</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/02/11</td>
</tr>
<tr>
<td style="text-align: right">98</td>
<td style="text-align: right">32</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/yimajo/items/9cdf56b5f7bffbfc8e5f" id="reference-15f7568d39cb1af2cc2c">iOS6以上とiOS5の自動回転の制御について</a></td>
<td style="text-align: left"><a href="/yimajo" class="user-mention js-hovercard" title="yimajo" data-hovercard-target-type="user" data-hovercard-target-name="yimajo">@yimajo</a></td>
<td style="text-align: center">2013/02/11</td>
</tr>
<tr>
<td style="text-align: right">99</td>
<td style="text-align: right">32</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/Ushio@github/items/ebed20972ab92326c12c" id="reference-03e47667460b32c4291d">カメラからの画像にリアルタイムでエフェクトをかける</a></td>
<td style="text-align: left"><a href="/Ushio@github" class="user-mention js-hovercard" title="Ushio@github" data-hovercard-target-type="user" data-hovercard-target-name="Ushio@github">@Ushio@github</a></td>
<td style="text-align: center">2013/03/24</td>
</tr>
<tr>
<td style="text-align: right">100</td>
<td style="text-align: right">30</td>
<td style="text-align: right">0</td>
<td style="text-align: left"><a href="http://qiita.com/tnantoka/items/5c24e72dc569da1c9b62" id="reference-51262dc400b5e9fdf137">Sprite Kitでブロック崩し</a></td>
<td style="text-align: left"><a href="/tnantoka" class="user-mention js-hovercard" title="tnantoka" data-hovercard-target-type="user" data-hovercard-target-name="tnantoka">@tnantoka</a></td>
<td style="text-align: center">2013/12/04</td>
</tr>
</tbody>
</table>

<p>(ストック数が同じものが同じ順位に出来てません。紅白見たくなったのでコード触るのに飽きた）</p>

<p>集計用のコードは無理やりObjective-Cで書きました。OS Xのコマンドラインで動作します。<br>
<a href="https://github.com/yimajo/QiitaRunkChecker" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/yimajo/QiitaRunkChecker</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />33位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>45</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/d4f484deda7cb9f61a49">grapeメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-16 14:28:11</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> <b>[grape]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Ruby on RailsでAPI用のコントローラ実装が楽になるgrapeを使ってみた。<br>
grapeのバージョンは0.6.1。</p>

<h1>
<span id="railsにgrapeをインストール" class="fragment"></span><a href="#rails%E3%81%ABgrape%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Railsにgrapeをインストール</h1>

<h2>
<span id="gemを使ってインストール" class="fragment"></span><a href="#gem%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>gemを使ってインストール</h2>

<p>Gemfileに</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>gem 'grape'
</pre></div></div>

<p>と追記して</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ bundle install
</pre></div></div>

<h2>
<span id="apiクラスの読み込み" class="fragment"></span><a href="#api%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>APIクラスの読み込み</h2>

<p>あとで作成するAPIクラスのために読み込みを設定する。config/application.rbに下記を追加</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>config.paths.add File.join('app', 'api'), glob: File.join('**', '*.rb')
config.autoload_paths += Dir[Rails.root.join('app', 'api', '*')]
</pre></div></div>

<p>例</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nn">Sample</span>
  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>

    <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">add</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'app'</span><span class="p">,</span> <span class="s1">'api'</span><span class="p">),</span> <span class="ss">glob</span><span class="p">:</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'**'</span><span class="p">,</span> <span class="s1">'*.rb'</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">+=</span> <span class="no">Dir</span><span class="o">[</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'app'</span><span class="p">,</span> <span class="s1">'api'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">)</span><span class="o">]</span>

  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>

<h2>
<span id="ルーティング" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>ルーティング</h2>

<p>config/routes.rbでルーティングの設定</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mount API =&gt; '/'
</pre></div></div>

<p>例</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Sample::Application.routes.draw do
  mount API =&gt; '/'
end
</pre></div></div>

<h2>
<span id="apiクラスの設置" class="fragment"></span><a href="#api%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E8%A8%AD%E7%BD%AE"><i class="fa fa-link"></i></a>APIクラスの設置</h2>

<p>app/apiディレクトリを作りその下にapi.rbを設置。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">API</span> <span class="o">&lt;</span> <span class="no">Grape</span><span class="o">::</span><span class="no">API</span>
  <span class="n">prefix</span> <span class="s1">'api'</span>
  <span class="n">version</span> <span class="s1">'v1'</span><span class="p">,</span> <span class="ss">using</span><span class="p">:</span> <span class="ss">:path</span>
  <span class="nb">format</span> <span class="ss">:json</span>

  <span class="n">helpers</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">dummy_name</span>
      <span class="s2">"dummy"</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">err401</span>
      <span class="n">error!</span><span class="p">(</span><span class="s1">'401 Unauthorized'</span><span class="p">,</span> <span class="mi">401</span><span class="p">)</span> 
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">resource</span> <span class="ss">:room</span> <span class="k">do</span>

    <span class="n">get</span> <span class="ss">:status</span> <span class="k">do</span>
      <span class="s2">"room is good"</span>
    <span class="k">end</span>

    <span class="n">get</span> <span class="ss">:secret</span> <span class="k">do</span>
      <span class="n">err401</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

</pre></div></div>

<p>APIアクセスするURLを下記のようになるようにしている。</p>

<p><a href="http://localhost/:3000/api/v1/room/status" class="autolink" rel="nofollow noopener" target="_blank">http://localhost/:3000/api/v1/room/status</a></p>

<p><a href="http://localhost/:3000/" class="autolink" rel="nofollow noopener" target="_blank">http://localhost/:3000/</a>&lt;#プレフィックス#&gt;/&lt;#バージョン#&gt;/&lt;#リソース#&gt;/&lt;#メソッド#&gt;?&lt;#パラメータ#&gt;</p>

<h2>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h2>

<p>rake routeは下記のようになるのでよくあるControllerのルーティングとは違うことに注意。これで問題ない。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rake routes
Prefix Verb URI Pattern Controller#Action
api  / API
</pre></div></div>

<h1>
<span id="プライベートメソッド" class="fragment"></span><a href="#%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>プライベートメソッド</h1>

<p>helpersで行う。例</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span>  <span class="n">helpers</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">dummy_name</span>
      <span class="s2">"dummy"</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">err401</span>
      <span class="n">error!</span><span class="p">(</span><span class="s1">'401 Unauthorized'</span><span class="p">,</span> <span class="mi">401</span><span class="p">)</span> 
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div></div>

<h1>
<span id="バリデーション" class="fragment"></span><a href="#%E3%83%90%E3%83%AA%E3%83%87%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>バリデーション</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>desc "チェックイン用のAPI"
params do
  requires :twitter_name, type: String, desc: "TwitterName"
end
post 'checkin/' do
end
</pre></div></div>

<h2>
<span id="必須" class="fragment"></span><a href="#%E5%BF%85%E9%A0%88"><i class="fa fa-link"></i></a>必須</h2>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">&lt;</span><span class="c1">#シンボル#&gt;</span>
</pre></div></div>

<h2>
<span id="タイプ指定" class="fragment"></span><a href="#%E3%82%BF%E3%82%A4%E3%83%97%E6%8C%87%E5%AE%9A"><i class="fa fa-link"></i></a>タイプ指定</h2>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">requires</span> <span class="o">&lt;</span><span class="c1">#シンボル#&gt;, type: &lt;#クラス#&gt;</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />34位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>45</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/054069e829855548058f">Githubにあるチュートリアルのライブラリを検討する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-14 15:41:48</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="チュートリアルのライブラリの検討" class="fragment"></span><a href="#%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%AE%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E6%A4%9C%E8%A8%8E"><i class="fa fa-link"></i></a>チュートリアルのライブラリの検討</h1>

<p>画面初期起動時に使い方を説明する画面を一般的にはチュートリアルと言ったりイントロダクションと言うようです。自力で実装したほうが早そうですがgithubにあるものはどういう特徴があるのかを調べてみました。</p>

<p>念のため、チュートリアルというのは使い方を体験を通じて説明する手段を一般的に指すことなので、この「スワイプして画面を切り替えること」自体をチュートリアルというのではありません。</p>

<h2>
<span id="myblurintroductionview" class="fragment"></span><a href="#myblurintroductionview"><i class="fa fa-link"></i></a>MYBlurIntroductionView</h2>

<p><a href="https://camo.qiitausercontent.com/ceb5b3d864de188f35f4973baaf6ff2f8e9d5cea/68747470733a2f2f7261772e6769746875622e636f6d2f4d617474686577596f726b2f4d59426c7572496e74726f64756374696f6e566965772f6d61737465722f5265736f75726365732f496d616765732f4d59426c7572496e74726f64756374696f6e566965772e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ceb5b3d864de188f35f4973baaf6ff2f8e9d5cea/68747470733a2f2f7261772e6769746875622e636f6d2f4d617474686577596f726b2f4d59426c7572496e74726f64756374696f6e566965772f6d61737465722f5265736f75726365732f496d616765732f4d59426c7572496e74726f64756374696f6e566965772e676966" alt="MYBlurIntroductionView&lt;br&gt;
" data-canonical-src="https://raw.github.com/MatthewYork/MYBlurIntroductionView/master/Resources/Images/MYBlurIntroductionView.gif"></a></p>

<p>MYBlurIntroductionViewはスワイプ後のテキストのアニメーションが特徴の様子。cocoapodsでインストールできます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$pod try MYBlurIntroductionView
</pre></div></div>

<h2>
<span id="aotutorial" class="fragment"></span><a href="#aotutorial"><i class="fa fa-link"></i></a>AOTutorial</h2>

<p><a href="https://github.com/Appsido/AOTutorial" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/Appsido/AOTutorial</a></p>

<p><a href="https://camo.qiitausercontent.com/e698f205e399c173e6a13aef2a180bb77c0af7e8/68747470733a2f2f6769746875622d63616d6f2e676c6f62616c2e73736c2e666173746c792e6e65742f353930643332356662616265396436323237303835613539343662323535343638666135386434342f363837343734373033613266326637303735363236633639363332653631373037303733363936343666326536333666366432663639353036383666366536353266373037353632366336393633326634313466353437353734366637323639363136633266343134663534373537343666373236393631366335333633373236353635366535663331326533303265373036653637" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e698f205e399c173e6a13aef2a180bb77c0af7e8/68747470733a2f2f6769746875622d63616d6f2e676c6f62616c2e73736c2e666173746c792e6e65742f353930643332356662616265396436323237303835613539343662323535343638666135386434342f363837343734373033613266326637303735363236633639363332653631373037303733363936343666326536333666366432663639353036383666366536353266373037353632366336393633326634313466353437353734366637323639363136633266343134663534373537343666373236393631366335333633373236353635366535663331326533303265373036653637" alt="AOTutorial" data-canonical-src="https://github-camo.global.ssl.fastly.net/590d325fbabe9d6227085a5946b255468fa58d44/687474703a2f2f7075626c69632e6170707369646f2e636f6d2f6950686f6e652f7075626c69632f414f5475746f7269616c2f414f5475746f7269616c53637265656e5f312e302e706e67"></a></p>

<p>AOTutorialはテキストはスワイプ出来るけども、ロゴとボタンはスクロールしないという画面を実現出来る様子。でもこれだけだと自力で実装したほうが早い気がしてしまいます。</p>

<h2>
<span id="eaintroview" class="fragment"></span><a href="#eaintroview"><i class="fa fa-link"></i></a>EAIntroView</h2>

<p><a href="https://github.com/ealeksandrov/EAIntroView" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ealeksandrov/EAIntroView</a></p>

<p><a href="https://camo.qiitausercontent.com/dbb7b810188193e1a8fb5b2688581cfee22a91d8/68747470733a2f2f7261772e6769746875622e636f6d2f65616c656b73616e64726f762f4541496e74726f566965772f6d61737465722f322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/dbb7b810188193e1a8fb5b2688581cfee22a91d8/68747470733a2f2f7261772e6769746875622e636f6d2f65616c656b73616e64726f762f4541496e74726f566965772f6d61737465722f322e706e67" alt="EAIntroView" data-canonical-src="https://raw.github.com/ealeksandrov/EAIntroView/master/2.png"></a></p>

<p>EAIntroViewは何をスクロールさせて、何をスクロールさせないかを指定できる。例えばボタンはスクロールしないようにしたりだとかを指定します。</p>

<p>デモプロジェクトを起動すると、カスタムする内容に合わせてサンプルコードを確認できるのが便利。カスタマイズするパターンをテーブルビューにあらかじめ並べてくれています。</p>

<p><a href="https://camo.qiitausercontent.com/8717d3266f59292664b912cd6c85077e6f70afdc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38363036633037362d616562392d326264662d343764642d3635353634366332353332322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8717d3266f59292664b912cd6c85077e6f70afdc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38363036633037362d616562392d326264662d343764642d3635353634366332353332322e706e67" alt="IMG_1776.PNG" title="IMG_1776.PNG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/8606c076-aeb9-2bdf-47dd-655646c25322.png"></a></p>

<p>ここまでやってくれると、実装中に要件が変わった時なんかにサクッと変更も出来そうで良いですね。</p>

<p>これもcocoapodsでインストールできます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$pod try EAIntroView
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />35位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>45</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/2a0a2ef963da666ed48c">申請したいアプリ内課金の状態がWaiting For ReviewになってないのでDeveloper Rejectした</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-09 16:41:49</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOSでのアプリ内課金のアイテム登録でつまづいてしまって申請をやり直したのでそのときのメモ。</p>

<p>他の人も同じようにつまづくかもしれないし、公式ドキュメントに書いてあることと違うような気がするのでまとめてみたけど、同じようにして解決できなくても責任は負えません。また、2013年12月現在の内容なのでiTunes Connect側の仕様が変わるとこの内容は正しくなくなる可能性もあるので注意して下さい。</p>

<h2>
<span id="要点" class="fragment"></span><a href="#%E8%A6%81%E7%82%B9"><i class="fa fa-link"></i></a>要点</h2>

<ul>
<li>アプリがWating For Reviewのとき、リリースしたいアプリ内課金のアイテムもWaiting For Reviewになっていないといけない(Ready to Submitだとダメ)</li>
<li>アプリ内課金のアイテムがWaiting For Reviewになるにはアプリをアップロードしてからでは遅い</li>
<li>必要があればDeveloper Rejectして状態を変更しないといけない</li>
</ul>

<h2>
<span id="アプリがwating-for-reviewのときリリースしたいアプリ内課金のアイテムもwaiting-for-reviewになっていないといけない" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%81%8Cwating-for-review%E3%81%AE%E3%81%A8%E3%81%8D%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%81%97%E3%81%9F%E3%81%84%E3%82%A2%E3%83%97%E3%83%AA%E5%86%85%E8%AA%B2%E9%87%91%E3%81%AE%E3%82%A2%E3%82%A4%E3%83%86%E3%83%A0%E3%82%82waiting-for-review%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%81%A8%E3%81%84%E3%81%91%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>アプリがWating For Reviewのとき、リリースしたいアプリ内課金のアイテムもWaiting For Reviewになっていないといけない</h2>

<p>アプリ内課金のアイテムを登録し、アプリをアップロードした後もアイテムのステータスがReady to Submit状態のままで、アイテムの詳細画面では下記のようなメッセージが出ていた。</p>

<p><a href="https://camo.qiitausercontent.com/8f693dac64fb8dee7142aa107f22c1ee78c47e7e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61343566636263362d663835622d383733342d383538312d3133303731363834656265632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8f693dac64fb8dee7142aa107f22c1ee78c47e7e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61343566636263362d663835622d383733342d383538312d3133303731363834656265632e706e67" alt="IAP画面で警告.png" title="IAP画面で警告.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/a45fcbc6-f85b-8734-8581-13071684ebec.png"></a></p>

<blockquote>
<p>Your first In-App Purchase(s) must be submitted with a new app version. Select them from the In-App Purchases section of the Version Details page and then click Ready to Upload Binary.</p>
</blockquote>

<p>「アプリのバージョン詳細でIn App Purchases sectionから選択しろ」とあるが、このIn App Purchasesのsectionがアプリ詳細から見つからないので選択できないのでどうしようもないなと思っていると"...and then click Ready to Upload Binary"とあるので、つまりReady to Upload Binary（Appをアップロードする前の）の前に処理をしないといけないのではないかと気づく。</p>

<p>気をつけたいのは、Ready to Upload Binaryの状態ではなく、Ready to Upload Binaryボタンを押す前の状態であり、そのときにしかアプリ内課金をレビュー待ちにする処理ができないということになる。</p>

<p>最初から分かってればそんなことしなくてもよかったんだろうけど、このときアプリの状態をWating for ReviewからPrepare for Uploadの状態にするにはDeveloper Rejectしなければいけなかった。Developer Rejectすると状態はDeveloper Rejectedになるが、Prepare for Uploadと同じだ。</p>

<h2>
<span id="アプリの状態" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E7%8A%B6%E6%85%8B"><i class="fa fa-link"></i></a>アプリの状態</h2>

<p>Developer RejectしてからPrepare for Upload(Developer Rejected)にすると、アプリ詳細(View Details)にIn App Purchasesの項目が表示される。選択するとモーダルビューが表示されレビューしてもらうアプリが表示されるのでチェックボックスにチェックして保存。</p>

<p>この項目が表示されないままWaiting for UploadやWaiting for Reviewまで行くと手遅れだと思う。</p>

<p><a href="https://camo.qiitausercontent.com/711ad949b867b0eab07a315ec3433445cbc4fac2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f65363266386138322d383265322d313431652d353865642d6637663864636233613765352e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/711ad949b867b0eab07a315ec3433445cbc4fac2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f65363266386138322d383265322d313431652d353865642d6637663864636233613765352e6a706567" alt="アプリ詳細でIAP有効化.jpg" title="アプリ詳細でIAP有効化.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/e62f8a82-82e2-141e-58ed-f7f8dcb3a7e5.jpeg"></a></p>

<p>アプリをReady to Uploadの状態にし、アプリをアップロードしなおすと完了。課金アイテムもWating for Reviewになっていた。</p>

<h2>
<span id="ステータスの流れをまとめるとこんな感じになる" class="fragment"></span><a href="#%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%81%AE%E6%B5%81%E3%82%8C%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%82%8B%E3%81%A8%E3%81%93%E3%82%93%E3%81%AA%E6%84%9F%E3%81%98%E3%81%AB%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>ステータスの流れをまとめるとこんな感じになる</h2>

<ul>
<li>アプリを新規登録するとPrepare for Upload状態になる

<ul>
<li>&lt;ここでアプリ詳細からアプリ内課金のアイテムを有効化する&gt;</li>
</ul>
</li>
<li>Ready to Uploadボタンを押すとWating for Upload状態になる</li>
<li>アプリをアップロードするとUpload Received状態になる</li>
<li>Upload Received状態になってしばらくするとWating for Review状態になる</li>
<li>アイテム有効化していればアイテムの状態もWaiting for Reviewになっている</li>
</ul>

<p>一度Waiting for Reviewにしてしまうと、Developer Rejectする必要があった</p>

<ul>
<li>アイテムの状態がReady to SubmitでアプリステータスがWaiting for Reviewになっている</li>
<li>Developer Rejectボタンを押すとDeveloper Rejected状態になる

<ul>
<li>&lt;ここでアプリ詳細からアプリ内課金のアイテムを有効化する&gt;</li>
</ul>
</li>
<li>Ready to Uploadボタンを押すとWating for Upload状態になる</li>
<li>アプリをアップロードするとUpload Received状態になる</li>
<li>Upload Received状態になってしばらくするとWating for Review状態になる</li>
<li>アイテム有効化していればアイテムの状態もWaiting for Reviewになっている</li>
</ul>

<h1>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h1>

<p>実は過去に上記の問題を解決しないまま、アプリ内課金のアイテム購入ができない状態でリリースしたこともあったんだけど、そのときは申請が通ってしまった。つまりアプリ内課金が動作してないのにレビュアーは申請を通してしまってリリースされ、リリース後に自分で購入してみて気がついた。</p>

<p>また、公式のドキュメントではアプリ内課金のアイテム詳細で “Submit for Review”ボタンを押すとWaiting for Review状態になるという説明があって、それが押せる状態にならないのが謎のまま。これはもしかして最初の一つ目だけは必要ないが後からこの手順が必要ということだろうか....。</p>

<p><a href="https://camo.qiitausercontent.com/d8c0a81c9fe1246b6e52edeb4db72253c949f080/68747470733a2f2f646576656c6f7065722e6170706c652e636f6d2f6c6962726172792f696f732f646f63756d656e746174696f6e2f4c616e6775616765735574696c69746965732f436f6e6365707475616c2f6954756e6573436f6e6e6563745f47756964652f4172742f6961705f7375626d69745f666f725f726576696577322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d8c0a81c9fe1246b6e52edeb4db72253c949f080/68747470733a2f2f646576656c6f7065722e6170706c652e636f6d2f6c6962726172792f696f732f646f63756d656e746174696f6e2f4c616e6775616765735574696c69746965732f436f6e6365707475616c2f6954756e6573436f6e6e6563745f47756964652f4172742f6961705f7375626d69745f666f725f726576696577322e706e67" alt="" data-canonical-src="https://developer.apple.com/library/ios/documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/Art/iap_submit_for_review2.png"></a></p>

<p>最初の申請はレビューまでに時間がかかるのでアプリ内課金を実装しておくと申請までにつまづいてしまうこともある。だから最初の申請はアプリ内課金を実装せずに出し一刻も早くユーザーの評価を受けて、バージョンアップで対応することも手かなと思う。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>Apple 公式ドキュメント<br>
<a href="https://developer.apple.com/library/ios/documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/13_ManagingIn-AppPurchases/ManagingIn-AppPurchases.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/ios/documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/13_ManagingIn-AppPurchases/ManagingIn-AppPurchases.html</a></p>

<p>アプリ内課金が Waiting for Review にならない<br>
<a href="http://relaxylab.blogspot.jp/2012/10/waiting-for-review.html" class="autolink" rel="nofollow noopener" target="_blank">http://relaxylab.blogspot.jp/2012/10/waiting-for-review.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />36位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>37</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/15e25915d0062c6e56f6">iOS7から画面ロック中の音楽再生/停止ボタンのイベントはUIEventSubtypeRemoteControlTogglePlayPauseではありません</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-19 01:55:27</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOS7になってから公式以外の色々な音楽再生アプリで画面ロック中の再生/停止ボタンを押しても反応しなくなったので調べました。なんか間違ってたらコメントを貰えると助かります。</p>

<h1>
<span id="説明" class="fragment"></span><a href="#%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>説明</h1>

<p>具体的に次のスクリーンショットで説明すると、音楽再生中にiPhoneをロックし、停止ボタンを押しても停止しないので不愉快です！ってな感じでした。</p>

<p><a href="https://camo.qiitausercontent.com/350ab6b1fcd48df308809195734f617fd48c2648/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61663238313764312d613032392d643736382d303131312d3737623763323537376136392e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/350ab6b1fcd48df308809195734f617fd48c2648/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61663238313764312d613032392d643736382d303131312d3737623763323537376136392e6a706567" alt="IMG_1091.jpg" title="IMG_1091.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/af2817d1-a029-d768-0111-77b7c2577a69.jpeg"></a></p>

<h1>
<span id="原因" class="fragment"></span><a href="#%E5%8E%9F%E5%9B%A0"><i class="fa fa-link"></i></a>原因</h1>

<p>原因は、ロック画面での再生/停止ボタン押下によるUIEventSubtypeのイベントがUIEventSubtypeRemoteControlTogglePlayPauseではなく、UIEventSubtypeRemoteControlPlayとUIEventSubtypeRemoteControlPauseに別れたことだと思います。</p>

<p>（公式のドキュメントに書かれていないけど、後述する内容から理にかなっていると思えなくもないのと、実装上そのように変わっているのでまあそうなのかなと）</p>

<h2>
<span id="そもそもどうやってこのイベントをフックしているか" class="fragment"></span><a href="#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E3%81%93%E3%81%AE%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E3%83%95%E3%83%83%E3%82%AF%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>そもそもどうやってこのイベントをフックしているか</h2>

<p>まず、ロック画面の再生/停止ボタンなどはUIResponderクラスで定義されている以下のメソッドをオーバーライドします。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">remoteControlReceivedWithEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">receivedEvent</span><span class="p">;</span>
</pre></div></div>

<p>上記メソッドの引数としてわたってくる UIEvent オブジェクトにリモコンからの情報(再生、停止、次送りなど)が送られてきます（参考：<a href="http://d.hatena.ne.jp/glass-_-onion/20120405/1333611664" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/glass-_-onion/20120405/1333611664</a> )。</p>

<p>このメソッドはdelegateの受け渡しによる実行ではなく、まずアプリがリモートコンロールイベントを受け取れるということを設定することと、オブジェクトがファーストレスポンダになることによって動作します。</p>

<div class="code-frame" data-lang="objecrivec"><div class="highlight"><pre><span></span>//アプリがリモートコントロールイベントを受け取れる旨を通知
[[UIApplication sharedApplication] beginReceivingRemoteControlEvents];

//ファーストレスポンダになる
[self becomeFirstResponder];
</pre></div></div>

<p>リモートコントロールイベントを受け取れるというのは、iPhoneなどのイヤフォン（4極端子）からの再生、停止、次送り操作も出来るようになります。</p>

<h2>
<span id="ios7からのremotecontrolreceivedwitheventメソッドのイベント" class="fragment"></span><a href="#ios7%E3%81%8B%E3%82%89%E3%81%AEremotecontrolreceivedwithevent%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%AE%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>iOS7からのremoteControlReceivedWithEvent:メソッドのイベント</h2>

<p>iOS7より前は、ロック中の再生/停止ボタン押下時はUIEventSubtypeRemoteControlTogglePlayPauseが発生していたようですが、iOS7端末で再生中に画面をロックし、remoteControlReceivedWithEvent:メソッドを調べたところ、再生させようとした際はUIEventSubtypeRemoteControlPlayイベントが発生し、停止させようとした際はUIEventSubtypeRemoteControlPauseイベントが発生するようになってました。</p>

<p>ロック画面での動作をまとめると</p>

<ul>
<li>iOS7より前はUIEventSubtypeRemoteControlTogglePlayPauseが発生していたが

<ul>
<li>iOS7から、再生はUIEventSubtypeRemoteControlPlayが発生</li>
<li>iOS7から、停止はUIEventSubtypeRemoteControlPauseが発生</li>
</ul>
</li>
</ul>

<p>ちなみに、Appleイヤフォンからの再生/停止操作はUIEventSubtypeRemoteControlTogglePlayPauseが発生しています。</p>

<p>これは勘ですが、Appleイヤフォンなどいわゆる4極端子は再生/停止に同じ信号を送っていてiOS側が状態に応じ再生するか停止するかを判断しているからではないかと思います。つまりアプリ側はイベントとしてトグル操作的なUIEventSubtypeRemoteControlTogglePlayPauseを受け取るのは正しく思えます。</p>

<p>また、ロック画面からのイベントがPlayとPauseに別れたことに対しても画面上で再生か停止かの状態がわかるので操作側はトグル操作ではないため、理にかなっているとも思えます。</p>

<p>ただ、この変更は既存のアプリで対応ができていないものが正常に動作しなくなるし、細かくてわかりづらいというデメリットのほうが大きすぎ、流石Apple俺たちにできないことを平然とやってのけるッ！...という感じですかね。</p>

<h1>
<span id="対応方法" class="fragment"></span><a href="#%E5%AF%BE%E5%BF%9C%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>対応方法</h1>

<p>remoteControlReceivedWithEvent:メソッドの中で、イベントの種類を<br>
UIEventSubtypeRemoteControlTogglePlayPauseだけで判断せず、UIEventSubtypeRemoteControlPlayとUIEventSubtypeRemoteControlPauseも使うのが良いでしょう。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">remoteControlReceivedWithEvent:</span> <span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span> <span class="nv">receivedEvent</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">receivedEvent</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">UIEventTypeRemoteControl</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">receivedEvent</span><span class="p">.</span><span class="n">subtype</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">case</span> <span class="nl">UIEventSubtypeRemoteControlPlay</span><span class="p">:</span>
            <span class="k">case</span> <span class="nl">UIEventSubtypeRemoteControlPause</span><span class="p">:</span>
            <span class="k">case</span> <span class="nl">UIEventSubtypeRemoteControlTogglePlayPause</span><span class="p">:</span>
                <span class="c1">//再生だったら再生するし停止だったら停止する</span>
                <span class="p">[</span><span class="nb">self</span> <span class="n">playOrPause</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="nl">UIEventSubtypeRemoteControlPreviousTrack</span><span class="p">:</span>
                <span class="p">[</span><span class="nb">self</span> <span class="n">prev</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="nl">UIEventSubtypeRemoteControlNextTrack</span><span class="p">:</span>
                <span class="p">[</span><span class="nb">self</span> <span class="n">next</span><span class="p">];</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">default</span><span class="o">:</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>実際の検証は、iRSSさんのGitHubリポジトリにあるMusicStoreLiteをcloneして確かめて、上記の変更点をpull requestをしました。</p>

<p>MusicStoreLite<br>
<a href="https://github.com/funami/MusicStoreLite" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/funami/MusicStoreLite</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />37位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>36</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/49bd534e8c257294a2e3">iOSデバイスの向きを角度で取得</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-10 18:55:47</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOS端末の現在の向きを取得するためのメモです。現在の向きと言っても縦横などの簡単な回転方向ではなく、どの向きにどの程度傾いているかを角度で取得します。</p>

<p>サンプルのプロジェクトをgithubにpushしときました(Xcode5+iOS7)<br>
<a href="https://github.com/yimajo/DeviceMotionAttitudeDemo" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/yimajo/DeviceMotionAttitudeDemo</a></p>

<p>サンプルの画面はこんな感じ</p>

<p><a href="https://camo.qiitausercontent.com/cc1269de86d2a6bbffe5d12350f20af61c938177/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37316462623838652d613662362d376637372d376633382d6532373732313763323030352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/cc1269de86d2a6bbffe5d12350f20af61c938177/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37316462623838652d613662362d376637372d376633382d6532373732313763323030352e706e67" alt="IMG_0622.PNG" title="IMG_0622.PNG" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/71dbb88e-a6b6-7f77-7f38-e277217c2005.png"></a></p>

<h2>
<span id="モーションデータ取得イベント" class="fragment"></span><a href="#%E3%83%A2%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%96%E5%BE%97%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>モーションデータ取得イベント</h2>

<p>モーションデータの取得タイミングは自前のプル型と自動のプッシュ型があります。それぞれの説明は次のとおりです。</p>

<ul>
<li>プル型

<ul>
<li>自前で取得しに行くタイミングを設定します。例えばゲームアプリでループの画面更新処理を作った場合などに無駄がないのではないかと思います。センサーに対してpullするからプル型と覚えるとスッキリします。</li>
</ul>
</li>
<li>プッシュ型

<ul>
<li>自動的に取得できます。センサーからpushされるからプッシュだと覚えるとスッキリします。</li>
</ul>
</li>
</ul>

<h2>
<span id="デバイスの回転方向" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E5%9B%9E%E8%BB%A2%E6%96%B9%E5%90%91"><i class="fa fa-link"></i></a>デバイスの回転方向</h2>

<p>デバイスの向きはオイラー角としてデバイスの3次元空間上の姿勢から取得できます。軸はPitch、Roll、Yawで、それぞれ次の図ではX,Y,Zとなります</p>

<p><a href="https://camo.qiitausercontent.com/ddfd4a39a97bc5c983bcd14ab8e79b29005964af/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38666432313030342d336631622d333563662d376130612d6137616365346561306530362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ddfd4a39a97bc5c983bcd14ab8e79b29005964af/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38666432313030342d336631622d333563662d376130612d6137616365346561306530362e706e67" alt="スクリーンショット 2013-10-10 18.39.37.png" title="スクリーンショット 2013-10-10 18.39.37.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/8fd21004-3f1b-35cf-7a0a-a7ace4ea0e06.png"></a></p>

<h2>
<span id="コード" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>コード</h2>

<p>イベントハンドラの部分的なコードのみ抜粋するとこんな感じ。エラー処理はいれてません。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>- (void)attiude
{
    if (self.motionManager.deviceMotionAvailable) {

        __weak MasterViewController *viewController = self;

        // 向きの更新通知を開始する
        [self.motionManager startDeviceMotionUpdatesToQueue:[NSOperationQueue currentQueue]
                                                withHandler:^(CMDeviceMotion *motion, NSError *error)
         {
             viewController.pitchLabel.text
                = [NSString stringWithFormat:@"%f", motion.attitude.pitch * 180 / M_PI];

             viewController.rollLabel.text
                = [NSString stringWithFormat:@"%f", motion.attitude.roll * 180 / M_PI];

             viewController.yawLabel.text
                = [NSString stringWithFormat:@"%f", motion.attitude.yaw * 180 / M_PI];

         }];
    }
}
</pre></div></div>

<p>重要なのはCMMotionManagerのメソッドで取得できるCMDeviceMotionのプロパティCMAttiudeが現在の回転角度を保持している点です。CMGyroDataを取得してしまうとジャイロデータにそのままアクセスしてしまい、回転した方向とその速度が都度取得できます（それが必要になることもあるんでしょうが今回の趣旨とはズレていました）。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>Apple公式 「iOSイベント処理ガイド」PDF<br>
<a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/EventHandlingiPhoneOS.pdf" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/jp/devcenter/ios/library/documentation/EventHandlingiPhoneOS.pdf</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />38位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/51ec837de220c0e94cfd">広告表示がないアプリでGoogle Analytics for iOSを組み込んでいるとリジェクトされる問題</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-13 14:07:55</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>今年2月に入ってからAdSupport.frameworkのASIdentifierManagerクラスにあるadvertisingIdentifierメソッドを使ったアプリがリジェクトされているという投稿が目立っていました。</p>

<p>参考：<br>
ASIdentifierManager の advertisingIdentifier を使っているとリジェクトされる問題<br>
<a href="http://qiita.com/monry/items/b473e3db7e48f05be96b" class="autolink" id="reference-a274e552f19e3c0bc7e1">http://qiita.com/monry/items/b473e3db7e48f05be96b</a></p>

<p>（上記では主にUnityが吐き出すコードを変更して対応）</p>

<h1>
<span id="解決法" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%95"><i class="fa fa-link"></i></a>解決法</h1>

<p>Google Analyticsのライブラリを最新のv3.03aに置き換えることでAdSupport.frameworkをリンクしなくてもビルドできるようになります。</p>

<p>Downloads - iOS SDK<br>
<a href="https://developers.google.com/analytics/devguides/collection/ios/resources?hl=ja" class="autolink" rel="nofollow noopener" target="_blank">https://developers.google.com/analytics/devguides/collection/ios/resources?hl=ja</a></p>

<p>念のためAdHocビルドしたアプリのバイナリファイルに対してstringsコマンドでadvertisingIdentifierが使われていないか文字列を全て調べて見るのもよいでしょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ unzip &lt;アプリのバイナリ名&gt;.ipa
$ cd Payload/
$ cd &lt;アプリのバイナリ名&gt;.app/
$ strings &lt;アプリのバイナリ&gt; | grep advertisingIdentifier
</pre></div></div>

<p>Payloadとか何やねんっという人は次の記事が参考になるでしょう<br>
<a href="http://qiita.com/yimajo/items/b2afd85513ea7c47b66a" class="autolink" id="reference-8271be9a809171d21932">http://qiita.com/yimajo/items/b2afd85513ea7c47b66a</a></p>

<h1>
<span id="adsupportframework周辺のことがら" class="fragment"></span><a href="#adsupportframework%E5%91%A8%E8%BE%BA%E3%81%AE%E3%81%93%E3%81%A8%E3%81%8C%E3%82%89"><i class="fa fa-link"></i></a>AdSupport.framework周辺のことがら</h1>

<h2>
<span id="advertisingidentifierとは" class="fragment"></span><a href="#advertisingidentifier%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>advertisingIdentifierとは</h2>

<p>iOS6からUDIDが実質使えなくなったことで、広告ネットワーク用の共通のUUIDとして使われることを想定しているようです。</p>

<p>利用方法としてはAdSupport.frameworkをリンクし次のようなコードを書きます</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">ASIdentifierManager</span> <span class="o">*</span><span class="n">adManager</span> <span class="o">=</span> <span class="p">[</span><span class="bp">ASIdentifierManager</span> <span class="n">sharedManager</span><span class="p">];</span>

<span class="k">if</span> <span class="p">([</span><span class="n">adManager</span> <span class="n">isAdvertisingTrackingEnabled</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">//使えるぜ</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,[[[</span><span class="bp">ASIdentifierManager</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="n">advertisingIdentifier</span><span class="p">]</span> <span class="n">UUIDString</span><span class="p">]);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//ユーザーによって使えないようになってるぜ</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"optout"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<p>これによってユーザーが拒否しなければアプリにまたがった共通のUUIDを取得できます。</p>

<h2>
<span id="google-analyticsでv30あたりからadsupportframeworkが必須になっていた" class="fragment"></span><a href="#google-analytics%E3%81%A7v30%E3%81%82%E3%81%9F%E3%82%8A%E3%81%8B%E3%82%89adsupportframework%E3%81%8C%E5%BF%85%E9%A0%88%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%9F"><i class="fa fa-link"></i></a>Google Analyticsでv3.0あたりからAdSupport.frameworkが必須になっていた</h2>

<p>v3.0からこのadvertisingIdentifierを取得するためなのかは分かりませんが、ターゲットをAdSupport.frameworkにリンクをすることが必須になっていました。</p>

<p>ただ、そうすると広告が表示されているアプリではリジェクトされないが、広告が表示されていないアプリではリジェクトされるという事があったようです。</p>

<h2>
<span id="しかし100リジェクトされるわけじゃない" class="fragment"></span><a href="#%E3%81%97%E3%81%8B%E3%81%97100%E3%83%AA%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%95%E3%82%8C%E3%82%8B%E3%82%8F%E3%81%91%E3%81%98%E3%82%83%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>しかし100%リジェクトされるわけじゃない</h2>

<p>ここまで書いててあれですが、自分の広告を表示しないアプリで、アクセス解析のためにGoogle Analytics v3.03組み込み1月にバージョンアップでリリースしていても実際はリジェクトされていませんでした。なので今年に入ってから100%リジェクトされるわけじゃないとは思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />39位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/4781d5d2712e34677db2">iOS 7.0.3からナビゲーションバーにtintColorを指定すると半透明じゃなくなった</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-25 18:12:00</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOS7からのUINavigationBarの自動半透明がiOS7.0.3からオフになっているようです。</p>

<p>追記:<br>
iOS7.0.4にしてみましたが半透明じゃないままですね。</p>

<h2>
<span id="facebookアプリで違いを見る" class="fragment"></span><a href="#facebook%E3%82%A2%E3%83%97%E3%83%AA%E3%81%A7%E9%81%95%E3%81%84%E3%82%92%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>Facebookアプリで違いを見る</h2>

<p>Facebookアプリ(v6.6)のスクリーンショットで比較してみるとこんな感じ。<br>
上がiOS7.0.2(iPhone5s)で、<br>
下がiOS7.0.3(iPhone5)です。</p>

<p><a href="https://camo.qiitausercontent.com/00344baf3944e9cac3f3da1edafd1e69f0e8a0b5/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f38343631623034646333373538663133626363313761643364623362646362352f74756d626c725f6d7637753437704d315331717a7a616f376f315f3530302e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/00344baf3944e9cac3f3da1edafd1e69f0e8a0b5/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f38343631623034646333373538663133626363313761643364623362646362352f74756d626c725f6d7637753437704d315331717a7a616f376f315f3530302e6a7067" alt="" data-canonical-src="http://24.media.tumblr.com/8461b04dc3758f13bcc17ad3db3bdcb5/tumblr_mv7u47pM1S1qzzao7o1_500.jpg"></a></p>

<p>いろいろ調べてみると、標準の写真アプリなどの白背景のナビゲーションバーは半透明になっていて、FacebookやInstagramなどのアプリは半透明がオフになっています。</p>

<h2>
<span id="自分でコードを書いて確認してみる" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E3%81%A7%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>自分でコードを書いて確認してみる</h2>

<p>UINavigationBarの新しいプロパティbarTintColrを使って色を変更するコードを書いてみます。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">[</span><span class="bp">UINavigationBar</span> <span class="n">appearance</span><span class="p">].</span><span class="n">barTintColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">0.077</span> <span class="nl">green</span><span class="p">:</span><span class="mf">0.411</span> <span class="nl">blue</span><span class="p">:</span><span class="mf">0.672</span> <span class="nl">alpha</span><span class="p">:</span><span class="mf">1.000</span><span class="p">];</span>
</pre></div></div>

<p>実機で試しました。<br>
上がiOS7.0.2(iPhone5s)で、<br>
下がiOS7.0.3(iPhone5)です。</p>

<p><a href="https://camo.qiitausercontent.com/87b866b57b3668107a20915503da81abd474c2df/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f66353335343836633932343731383336613964646437313932653637613861642f74756d626c725f6d763775793438656a5931717a7a616f376f315f3530302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/87b866b57b3668107a20915503da81abd474c2df/687474703a2f2f32352e6d656469612e74756d626c722e636f6d2f66353335343836633932343731383336613964646437313932653637613861642f74756d626c725f6d763775793438656a5931717a7a616f376f315f3530302e706e67" alt="" data-canonical-src="http://25.media.tumblr.com/f535486c92471836a9ddd7192e67a8ad/tumblr_mv7uy48ejY1qzzao7o1_500.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/acdc398adb987d99eb944e72904307689772b4a6/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f33393232643665646564646135656535326630353466613539393532346638352f74756d626c725f6d76377573304c33554831717a7a616f376f315f3530302e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/acdc398adb987d99eb944e72904307689772b4a6/687474703a2f2f32342e6d656469612e74756d626c722e636f6d2f33393232643665646564646135656535326630353466613539393532346638352f74756d626c725f6d76377573304c33554831717a7a616f376f315f3530302e6a7067" alt="" data-canonical-src="http://24.media.tumblr.com/3922d6ededda5ee52f054fa599524f85/tumblr_mv7us0L3UH1qzzao7o1_500.jpg"></a></p>

<p>自分でコードを書いて確認してみても再現しますね。どうやらbarTintColorへの設定はiOS7.0.3では半透明処理が行われなくなっています。iPhone4などの旧機種でこのような処理が行われないのは既知の仕様でしたが、iOS7.0.3以降はこのような仕様になったんでしょうか？</p>

<h2>
<span id="おまけ超超暫定の対応オススメしない" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E8%B6%85%E8%B6%85%E6%9A%AB%E5%AE%9A%E3%81%AE%E5%AF%BE%E5%BF%9C%E3%82%AA%E3%82%B9%E3%82%B9%E3%83%A1%E3%81%97%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>おまけ：超超暫定の対応（オススメしない）</h2>

<p>デザインが変わってしまうとデザイナさんやディレクターの意図しないものになってしまうので、iOS7.0.3でもなるべく併せてあげなければしょうがないという時のために、暫定処理を書いておきます。</p>

<p>次のように、Appearanceを使わず、navigationBarのbarTintColorにカラーを設定し、アルファの値を0から1までの値に調整することで半透明にすることが出来ます。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="c1">//UINavigationControllerを継承しているクラスのViewDidLoadなどで設定</span>
<span class="nb">self</span><span class="p">.</span><span class="n">navigationBar</span><span class="p">.</span><span class="n">barTintColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">0.077</span> <span class="nl">green</span><span class="p">:</span><span class="mf">0.411</span> <span class="nl">blue</span><span class="p">:</span><span class="mf">0.672</span> <span class="nl">alpha</span><span class="p">:</span><span class="mf">0.200</span><span class="p">]</span>
</pre></div></div>

<p>アルファを0.2にするととりあえず半透明にはなりますので、ここからRGBを微調整をしていけば同じようになるかもしれません。</p>

<p><a href="https://camo.qiitausercontent.com/96b462f240b5428e25e40590eea86c89d833df05/687474703a2f2f33312e6d656469612e74756d626c722e636f6d2f64363633333736616637663634643435343662306565376566376466633363312f74756d626c725f6d7637766e73734d567a31717a7a616f376f315f3530302e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/96b462f240b5428e25e40590eea86c89d833df05/687474703a2f2f33312e6d656469612e74756d626c722e636f6d2f64363633333736616637663634643435343662306565376566376466633363312f74756d626c725f6d7637766e73734d567a31717a7a616f376f315f3530302e6a7067" alt="" data-canonical-src="http://31.media.tumblr.com/d663376af7f64d4546b0ee7ef7dfc3c1/tumblr_mv7vnssMVz1qzzao7o1_500.jpg"></a></p>

<p>この場合、iOS7.0.2もアルファが反映されてしまうのでiOS7.0.3のみもしくはiOS7.0.3からのような条件が必要になります。若干手間もかかるしiOS7.0.3のバグなのか仕様なのかわからない状態での対応なので全然オススメしませんが...</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />40位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>32</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/752f69bba344a68a5f9a">iOSアプリ開発者だったら試してみたい！アプリ専用解析サービスFlurryのiOS SDKの導入と設定</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-22 10:42:39</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> <b>[flurry]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://dev.flurry.com/" rel="nofollow noopener" target="_blank">Flurry</a>というモバイル端末用のアクセス解析サービスがあり、そのiOS SDKを導入するときのメモです。タイトルは釣りになります。また、<a href="http://qiita.com/yimajo/items/44e55fc3ef1c553213fb" id="reference-8ca06f92e149f622a005">MixpanelのiOS SDK導入と設定についての記事</a>もまとめているのでそちらと比較してみるのもいいかもしれません。</p>

<h1>
<span id="sdkのダウンロード" class="fragment"></span><a href="#sdk%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>SDKのダウンロード</h1>

<p><a href="https://dev.flurry.com/" rel="nofollow noopener" target="_blank">Flurryのサイト</a>からアカウント登録後、"Add a new application"からアプリケーションの登録を行う。"Choose this if your app is a universal iOS app"を選択しアプリ名やカテゴリーを設定し登録されるとアプリケーションキーとダウンロードリンクが手に入る。</p>

<h1>
<span id="インストール方法" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>インストール方法</h1>

<p>ダウンロードリンクからFlurry-iOS-4.3.2を展開し、その中のFlurryディレクトリにあるFlurry.h、libFlurry_4.3.2.aをプロジェクトに追加する。</p>

<p>また、下記のフレームワークも必要になる</p>

<ul>
<li>SystemConfiguration.framework</li>
<li>Security.framework </li>
</ul>

<h1>
<span id="ライブラリの初期化" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>ライブラリの初期化</h1>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#import "Flurry.h"</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span> <span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span> 
<span class="p">{</span>
     <span class="p">[</span><span class="n">Flurry</span> <span class="nl">setCrashReportingEnabled</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
     <span class="c1">//note: iOS only allows one crash reporting tool per app; if using another, set to: NO</span>
     <span class="p">[</span><span class="n">Flurry</span> <span class="nl">startSession</span><span class="p">:</span><span class="s">@"YOUR_API_KEY"</span><span class="p">];</span>    
     <span class="c1">//your code</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="イベントのトラッキング" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>イベントのトラッキング</h1>

<h2>
<span id="通常のトラッキング" class="fragment"></span><a href="#%E9%80%9A%E5%B8%B8%E3%81%AE%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>通常のトラッキング</h2>

<p>通常のイベントトラッキングはイベント名を指定する</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Flurry</span> <span class="nl">logEvent</span><span class="p">:</span><span class="s">@"Article_Read"</span><span class="p">];</span>
</pre></div></div>

<p>任意のDicrionaryを渡すこともできる。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">articleParams</span> <span class="o">=</span>
   <span class="p">[</span><span class="bp">NSDictionary</span> <span class="nl">dictionaryWithObjectsAndKeys</span><span class="p">:</span>
      <span class="s">@"John Q"</span><span class="p">,</span> <span class="s">@"Author"</span><span class="p">,</span> <span class="c1">// Capture author info</span>
      <span class="s">@"Registered"</span><span class="p">,</span> <span class="s">@"User_Status"</span><span class="p">,</span> <span class="c1">// Capture user status</span>
      <span class="nb">nil</span><span class="p">];</span>

<span class="p">[</span><span class="n">Flurry</span> <span class="nl">logEvent</span><span class="p">:</span><span class="s">@"Article_Read"</span> <span class="nl">withParameters</span><span class="p">:</span><span class="n">articleParams</span><span class="p">];</span>
</pre></div></div>

<p>トラッキング出来る上限は300。</p>

<h2>
<span id="イベントの時間を取得する" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E6%99%82%E9%96%93%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>イベントの時間を取得する？</h2>

<p>logEvent:withParameters:timed:メソッドを使い、あらかじめ登録したイベント名のパラメータをセットしておきendTimedEvent:withParameters:でイベントの終了を検知させることでその間の時間を取得することが出来る様子。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">articleParams</span> <span class="o">=</span>
   <span class="p">[</span><span class="bp">NSDictionary</span> <span class="nl">dictionaryWithObjectsAndKeys</span><span class="p">:</span>
      <span class="s">@"John Q"</span><span class="p">,</span> <span class="s">@"Author"</span><span class="p">,</span> <span class="c1">// Capture author info</span>
      <span class="s">@"Registered"</span><span class="p">,</span> <span class="s">@"User_Status"</span><span class="p">,</span> <span class="c1">// Capture user status</span>
      <span class="nb">nil</span><span class="p">];</span>

<span class="p">[</span><span class="n">Flurry</span> <span class="nl">logEvent</span><span class="p">:</span><span class="s">@"Article_Read"</span> <span class="nl">withParameters</span><span class="p">:</span><span class="n">articleParams</span> <span class="nl">timed</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>

<span class="c1">// In a function that captures when a user navigates away from article</span>
<span class="p">[</span><span class="n">Flurry</span> <span class="nl">endTimedEvent</span><span class="p">:</span><span class="s">@"Article_Read"</span> <span class="nl">withParameters</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span> <span class="c1">// You can pass in additional </span>
   <span class="c1">//params or update existing ones here as well</span>

</pre></div></div>

<p>注意点は２つのメソッドで共通のイベント名を使うこと。</p>

<h1>
<span id="ユーザーの情報" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E6%83%85%E5%A0%B1"><i class="fa fa-link"></i></a>ユーザーの情報</h1>

<h2>
<span id="idを指定する" class="fragment"></span><a href="#id%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>idを指定する</h2>

<p>解析のため明示的にIDを指定することも出来る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>[Flurry setUserID:@"USER_ID"];
</pre></div></div>

<p>例えば自分が運営しているWebサービスのユーザーIDなど、他プラットフォームでも共通のIDを割り当てられるなら解析のために指定すべきだろう。</p>

<h2>
<span id="年齢を指定する" class="fragment"></span><a href="#%E5%B9%B4%E9%BD%A2%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>年齢を指定する</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>[Flurry setAge:21];
</pre></div></div>

<h2>
<span id="性別を指定する" class="fragment"></span><a href="#%E6%80%A7%E5%88%A5%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>性別を指定する</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>[Flurry setGender:@"m"];
</pre></div></div>

<p>mでmale<br>
fでfemale</p>

<h1>
<span id="アプリケーションのエラーや例外のトラッキング" class="fragment"></span><a href="#%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%84%E4%BE%8B%E5%A4%96%E3%81%AE%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>アプリケーションのエラーや例外のトラッキング</h1>

<p>アプリケーションのエラーや例外を送ることも出来る。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Flurry</span> <span class="nl">logError</span><span class="p">:</span><span class="s">@"ERROR_NAME"</span> <span class="nl">message</span><span class="p">:</span><span class="s">@"ERROR_MESSAGE"</span> <span class="nl">exception</span><span class="p">:</span><span class="n">e</span><span class="p">];</span>
</pre></div></div>

<p>例外自体を引数で渡しているのにエラー名とメッセージも渡すのか、どちらかがあればいいのかイマイチ分かりづらい。おそらくNSErrorが発生しそれを送りたい場合はエラー名とメッセージを渡し、例外を送りたい場合は例外のみ渡せば良い気がする。</p>

<p>両方渡すと管理画面上で解析がどうなるか等も気になってしまうし、もしこのように似たもののどちらかを渡せばいいのであれば、メソッドを分けるかメソッド名が長くなってもいいので分かりやすくすべきではないかと思う。</p>

<h1>
<span id="ページのトラッキング" class="fragment"></span><a href="#%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E3%83%88%E3%83%A9%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>ページのトラッキング</h1>

<p>これは何をしていてどこで使うべきか不明。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Flurry</span> <span class="nl">logAllPageViews</span><span class="p">:</span><span class="n">navigationController</span><span class="p">];</span>
</pre></div></div>

<p>logPageViewメソッドはviewWillAppear:時に仕込めばいいような気はする。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Flurry</span> <span class="n">logPageView</span><span class="p">];</span>
</pre></div></div>

<p>このメソッド名はFlurryの他プラットフォームに合わせてしまっているためで、メソッド名や引数で何をしているかが分からないし説明を見てもよく分からなかった。</p>

<h1>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h1>

<p>iOSアプリ開発者は知らなきゃヤバイ！Mixpanel iOS SDKの導入と設定<br>
<a href="http://qiita.com/yimajo/items/44e55fc3ef1c553213fb" class="autolink">http://qiita.com/yimajo/items/44e55fc3ef1c553213fb</a></p>

<p>Flurry公式<br>
<a href="http://support.flurry.com/index.php?title=Analytics/GettingStarted" class="autolink" rel="nofollow noopener" target="_blank">http://support.flurry.com/index.php?title=Analytics/GettingStarted</a></p>

<h1>
<span id="雑感" class="fragment"></span><a href="#%E9%9B%91%E6%84%9F"><i class="fa fa-link"></i></a>雑感</h1>

<p>Mixpanelと似ている部分は多いがSDKでイベントの経過時間を測れる機能があるのは大きな特徴。</p>

<p>気になる点としてはドキュメントの説明が足らずメソッド名から機能が分かりづらい。導入についてはcocoapods経由ではないので古い印象を受けてしまう。欲を言えばサンプルプロジェクトなどが欲しい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />41位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>31</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/bf17d56bfa02b0be6bce">KVOのメソッドの憶え方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-22 16:41:46</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>KVOはたまに使うのでいつもメソッドを忘れてしまう。リファレンスや技術サイトを検索してもKVOについての技術側面の説明が多くメソッドを素早く思い出したいときのサイトがないので、そのメモ。</p>

<p>念のため、Xcodeのスニペットに登録できるように変数部分をテンプレート化している。</p>

<h2>
<span id="監視の登録と解除" class="fragment"></span><a href="#%E7%9B%A3%E8%A6%96%E3%81%AE%E7%99%BB%E9%8C%B2%E3%81%A8%E8%A7%A3%E9%99%A4"><i class="fa fa-link"></i></a>監視の登録と解除</h2>

<p>登録</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//KVOの登録</span>
<span class="p">[</span><span class="o">&lt;</span><span class="err">#監視対象#</span><span class="o">&gt;</span> <span class="nl">addObserver</span><span class="p">:</span><span class="o">&lt;</span><span class="err">#監視するオブザーバ#</span><span class="o">&gt;</span>
              <span class="nl">forKeyPath</span><span class="p">:</span><span class="o">&lt;</span><span class="err">#監視対象のプロパティ名#</span><span class="o">&gt;</span>
                 <span class="nl">options</span><span class="p">:</span><span class="o">&lt;</span><span class="err">#監視するデータにどのような物を含めるか#</span><span class="o">&gt;</span>
                 <span class="nl">context</span><span class="p">:</span><span class="o">&lt;</span><span class="err">#任意のインスタンス#</span><span class="o">&gt;</span><span class="p">];</span>
</pre></div></div>

<p>解除</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">//KVOの解除</span>
<span class="p">[</span><span class="o">&lt;</span><span class="err">#監視対象#</span><span class="o">&gt;</span> <span class="nl">removeObserver</span><span class="p">:</span><span class="o">&lt;</span><span class="err">#監視するオブザーバ#</span><span class="o">&gt;</span>
                 <span class="nl">orKeyPath</span><span class="p">:</span><span class="o">&lt;</span><span class="err">#監視対象のプロパティ名#</span><span class="o">&gt;</span><span class="p">];</span>

</pre></div></div>

<p>登録、解除もまず監視対象有りきなので、メッセージは監視対象へと送るようにadd/removeすると憶えてコーディングを進めるとメッセージ呼び出しが自動補完される。</p>

<h2>
<span id="オブザーバのメソッド" class="fragment"></span><a href="#%E3%82%AA%E3%83%96%E3%82%B6%E3%83%BC%E3%83%90%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"><i class="fa fa-link"></i></a>オブザーバのメソッド</h2>

<p>監視するオブザーバには次のようなメソッドを実装する。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">observeValueForKeyPath:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">keyPath</span> <span class="nf">ofObject:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">object</span> <span class="nf">change:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">change</span> <span class="nf">context:</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">context</span>
<span class="p">{</span>
    <span class="c1">//MEMO:場合によっては任意のcontextで先に条件を分ける</span>

    <span class="k">if</span><span class="p">(</span> <span class="p">[</span><span class="n">keyPath</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="o">&lt;</span><span class="err">#監視対象のプロパティ名#</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">){</span>
         <span class="c1">//MEMO:changeのキーと値により判断。</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>監視した結果実行されるだけなのでメソッドに戻り値はなく、監視なのでobserveから始めると憶えとくとあとは楽。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />42位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>30</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/e89749079d7d5f6cd481">CocoaPodsがインストール出来ない時</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-13 12:56:02</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[Mac]</b> <b>[OSX]</b> <b>[iOS]</b> <b>[CocoaPods]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>結論から言うとRubyGemsが古い場合があるのでアップデートすればいい。以下はCocoaPodsのインストールが出来なかった時のメモ。</p>

<p>まずはとにかくCocoaPodsのinstallを行ってみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo gem install cocoapods
</pre></div></div>

<p>しかし10分たってもターミナルに反応なし。<br>
Vオプションで進捗を表示させてみる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo gem install cocoapods -V
</pre></div></div>

<p>表示は次のようになる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo gem install cocoapods -V
GET http://rubygems.org/latest_specs.4.8.gz
302 Moved Temporarily
GET http://production.s3.rubygems.org/latest_specs.4.8.gz
200 OK
GET http://rubygems.org/specs.4.8.gz
302 Moved Temporarily
GET http://production.s3.rubygems.org/specs.4.8.gz
200 OK

</pre></div></div>

<p>ここで５分経過。成功する気配がないのでContrl-Cで中止。</p>

<p>これを見る限りどうもアクセスしているサーバーが正しくないのではないかという気がするのでRubyGemsをアップデートすることに。</p>

<p>今インストールされているRubyGemsのバージョンを調べるにはvオプションでいい</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ gem -v
1.3.6
</pre></div></div>

<p>インストールされているのは1.3.6らしい。</p>

<p>RubyGemsのアップデートはgemでアップデートの用のプログラムをインストールするところから</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo gem install rubygems-update
</pre></div></div>

<p>念のためインストールしたリストを表示してみる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ gem list

*** LOCAL GEMS ***

rubygems-update (2.1.8)
</pre></div></div>

<p>正しくrubygems-updateがインストールされているのでこれを実行</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo update_rubygems
</pre></div></div>

<p>また念のためRubyGemsのバージョンを確認。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ gem -v
2.1.8
</pre></div></div>

<p>バージョンが2.1.8になったので改めてCocoaPodsをインストールし直し</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo gem install cocoapods
</pre></div></div>

<p>1分とかからず終了した。やっぱりRubyGemのバージョンが古かったみたいで余分に時間がかかってたんだろう。  </p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />43位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>23</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/b2afd85513ea7c47b66a">アーカイブ済みバイナリのプロビジョニングを確認する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-06 00:41:33</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>XcodeからAdHocビルドしてアーカイブした際にiPhone実機にアプリをインストール出来ないことがあった（実機上で＜アプリ名＞はインストール出来ません、というアラートが出てiTunesからのインストールが出来ない）。そういう時は大抵プロビジョニングプロファイルが間違っているとは思うけど、実際にアーカイブされたipaファイルのプロビジョニングを確認する方法をメモしておく。</p>

<p>まずipaファイルをunzipする。HogeApp_adhocというファイル名の場合は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>unzip HogeApp_adhoc.ipa
</pre></div></div>

<p><a href="http://s.iwire.jp/news/2011/05/17/002/index.html" rel="nofollow noopener" target="_blank">ipaファイルはzip圧縮されたファイルでDRMにより保護された書庫ファイル、unzipコマンドでなくてもファイル拡張子を.zipなどにすればFinderから展開できるらしい</a>。しらんけど。</p>

<p>unzipするとPayloadディレクトリの下にappファイルがある。</p>

<p>Payload/HogeApp_adhoc.app</p>

<p>appファイルはアプリケーションパッケージなので、その下には画像などのリソースがあり、その中にあるembedded.mobileprovisionを開くとプロビジョニングが指定されている。例えばデバッグ用のプロビジョニングHogeApp_Debugを指定してビルドしていれば以下のようにXMLにより記述されている</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;string&gt;HogeApp_Debug&lt;/string&gt;
&lt;key&gt;ProvisionedDevices&lt;/key&gt;
</pre></div></div>

<p>非開発者端末にAdHocビルドしてアプリをインストールしたかったので、プロビジョニングはDevelopmentのHogeApp_DebugではなくDistributionのものを選ぶべきだった事に気づいてビルドしなおしたら解決。</p>

<p>Apple公式のリファレンス「iOS Code Signing Troubleshooting」が一番詳しく書いてた<br>
<a href="http://developer.apple.com/library/ios/#technotes/tn2250/_index.html" class="autolink" rel="nofollow noopener" target="_blank">http://developer.apple.com/library/ios/#technotes/tn2250/_index.html</a></p>

<p>上記これがどういう時に役立つかというと、自分以外の誰かにAdHocビルドをお願いしてipaファイルが送られてきた場合、それが正しいプロビジョニングプロファイル（具体的には証明書、AppID、デバイスの組み合わせ）であるかどうかを確認するのに役立つと思う。いや、そこまで出来るならソースコードもらってXcodeでビルドし直そうよと思わないでもない。しらんけど。</p>

<h2>
<span id="参考url" class="fragment"></span><a href="#%E5%8F%82%E8%80%83url"><i class="fa fa-link"></i></a>参考URL</h2>

<p>“The executable was signed with invalid entitlements.” の対処方法<br>
<a href="http://blog.fenrir-inc.com/jp/2012/02/the-executable-was-signed-with-invalid-entitlements.html" class="autolink" rel="nofollow noopener" target="_blank">http://blog.fenrir-inc.com/jp/2012/02/the-executable-was-signed-with-invalid-entitlements.html</a></p>

<p>φ(.. )ﾒﾓｼﾃｵｺｳ　iOS、Androidバイナリに対してコード署名<br>
<a href="http://kernhack.hatenablog.com/entry/2013/05/21/233009" class="autolink" rel="nofollow noopener" target="_blank">http://kernhack.hatenablog.com/entry/2013/05/21/233009</a></p>

<p>iOS アプリのprovisioning profile差し替え方法<br>
<a href="http://labs.septeni.co.jp/?p=815" class="autolink" rel="nofollow noopener" target="_blank">http://labs.septeni.co.jp/?p=815</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />44位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>20</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/b111fd3bcfd453e6e0ab">CorePlotで円グラフを描画する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-03 19:04:10</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOSで円グラフを描画する際、ライブラリは<a href="https://github.com/core-plot/core-plot" rel="nofollow noopener" target="_blank">CorePlot</a>一択だと思うのでそのメモ。</p>

<p>なぜCorePlotかというと、Githubでさくっと調べた感じ、他に円グラフを描画するために実用的なものはなさそうだったのと、円グラフ以外の描画も出来るのでこのライブラリの使い方を憶えるだけでいいから。</p>

<h1>
<span id="クラス概要" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>クラス概要</h1>

<p>CorePlotを使って円グラフを描画する際に、主に利用するクラスは次の通り。</p>

<ul>
<li>CPTGraphHostingView

<ul>
<li>グラフのコンテナの役割をするView</li>
</ul>
</li>
<li>CPTXYGraph

<ul>
<li>コンテナにグラフ描画するためのGraphのLayer。CPTGraphHostingViewにホストさせる。</li>
</ul>
</li>
<li>CPTPieChart

<ul>
<li>円グラフを描画するためのLayer。CPTXYGraphにaddPlotする</li>
</ul>
</li>
<li>CPTMutableShadow

<ul>
<li>影の設定を保持するインスタンス。CPTPieChartのshadowプロパティにセット</li>
</ul>
</li>
</ul>

<p>CPTXYGraphは軸や目盛りのLayer。<br>
CPTPieChartはグラフの方式が円グラフなど表示用Layerになっている。</p>

<p><a href="https://camo.qiitausercontent.com/57b620e34371e5a0c663ae73a682d8f840620b39/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f32353737396465652d336262342d653962372d636266662d6431396563643132616438632e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/57b620e34371e5a0c663ae73a682d8f840620b39/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f32353737396465652d336262342d653962372d636266662d6431396563643132616438632e6a706567" alt="スクリーンショット 2014-02-03 18.38.37.jpg" title="スクリーンショット 2014-02-03 18.38.37.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/25779dee-3bb4-e9b7-cbff-d19ecd12ad8c.jpeg"></a></p>

<p>クラス名で気づいたけど、海外では軸や目盛りなどをグラフと呼び、その中でデータを比較したり表現したりするデータそのものをチャートと呼び分けているのかもしれない。日本人が円グラフや棒グラフと言っているものはチャートであり、そのチャートの下に目盛りとしてグラフがあると。</p>

<p>今回の円グラフ（パイチャート）では縦横の目盛りが存在しないのでCPTXYGraphはほとんど設定がいらない。そのためCorePlotを理解する上で一番簡単かもしれない。</p>

<h1>
<span id="描画" class="fragment"></span><a href="#%E6%8F%8F%E7%94%BB"><i class="fa fa-link"></i></a>描画</h1>

<h2>
<span id="データのグラフ描画のためのデリゲート" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%B0%E3%83%A9%E3%83%95%E6%8F%8F%E7%94%BB%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>データのグラフ描画のためのデリゲート</h2>

<p>UITableViewと同じで描画と管理のためにデータソースのデリゲートパターンを使う。</p>

<p>まずデータソースであるCPTPieChartDataSourceプロトコルはCPTPieChartインスタンスのdataSourceプロパティにdelegateを渡し、下記2つだけをまず実装する。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@protocol</span> <span class="nc">CPTPlotDataSource</span><span class="o">&lt;</span><span class="bp">NSObject</span><span class="o">&gt;</span>

<span class="c1">//プロットのためのデータ数を返すように実装する。必須。</span>
<span class="o">-</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nl">numberOfRecordsForPlot</span><span class="p">:(</span><span class="n">CPTPlot</span> <span class="o">*</span><span class="p">)</span><span class="n">plot</span><span class="p">;</span>

<span class="k">@optional</span>

<span class="c1">//描画するための値をNSNumberで返すように実装する。</span>
<span class="o">-</span><span class="p">(</span><span class="bp">NSNumber</span> <span class="o">*</span><span class="p">)</span><span class="nl">numberForPlot</span><span class="p">:(</span><span class="n">CPTPlot</span> <span class="o">*</span><span class="p">)</span><span class="n">plot</span> <span class="nl">field</span><span class="p">:(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">fieldEnum</span> <span class="nl">recordIndex</span><span class="p">:(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">idx</span><span class="p">;</span>

<span class="k">@end</span>
</pre></div></div>

<p>CPTPieChartを使っているので、円グラフ専用に下記のメソッドも実装する。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@protocol</span> <span class="nc">CPTPieChartDataSource</span><span class="o">&lt;</span><span class="n">CPTPlotDataSource</span><span class="o">&gt;</span>
<span class="k">@optional</span>
<span class="c1">//1データ毎に表示をCPTFillというインスタンスで返すように実装する。</span>
<span class="o">-</span><span class="p">(</span><span class="n">CPTFill</span> <span class="o">*</span><span class="p">)</span><span class="nl">sliceFillForPieChart</span><span class="p">:(</span><span class="n">CPTPieChart</span> <span class="o">*</span><span class="p">)</span><span class="n">pieChart</span> <span class="nl">recordIndex</span><span class="p">:(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">idx</span><span class="p">;</span>

</pre></div></div>

<p>CorePlotによる円グラフでは描画したい領域をCPTFillインスタンスとして返す。これはUITableViewなどでUITableViewCellを返すようなものと思って構わない。</p>

<p>描画する領域は上記のdelegateでCorePlot側が自動で分割してくれるので気にしないでいい。</p>

<h3>
<span id="cptpiechartdelegateプロトコルのデリゲートについて" class="fragment"></span><a href="#cptpiechartdelegate%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E3%81%AE%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>CPTPieChartDelegateプロトコルのデリゲートについて</h3>

<p>ViewControllerにCPTPieChartDelegateプロトコルを採用だけしているサンプルコードがネット上にあるが、これは円グラフが選択された時のイベントのデリゲートなので必要がない場合がほとんどじゃないかと思う。</p>

<h1>
<span id="設定" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>設定</h1>

<h2>
<span id="真ん中が空いた円グラフにする" class="fragment"></span><a href="#%E7%9C%9F%E3%82%93%E4%B8%AD%E3%81%8C%E7%A9%BA%E3%81%84%E3%81%9F%E5%86%86%E3%82%B0%E3%83%A9%E3%83%95%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>真ん中が空いた円グラフにする</h2>

<p>pieInnerRadiusというプロパティを持っていて、これは円グラフを中心として真ん中の円の半径になる。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span>    <span class="c1">//円グラフのインスタンスを生成</span>
    <span class="n">CPTPieChart</span> <span class="o">*</span><span class="n">pieChart</span> <span class="o">=</span> <span class="p">[[</span><span class="n">CPTPieChart</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="c1">//円グラフの半径を設定</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">pieRadius</span> <span class="o">=</span> <span class="mf">52.0</span><span class="p">;</span>
    <span class="c1">//内側の円形の半径</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">pieInnerRadius</span> <span class="o">=</span> <span class="n">pieChart</span><span class="p">.</span><span class="n">pieRadius</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span>
</pre></div></div>

<h1>
<span id="完成" class="fragment"></span><a href="#%E5%AE%8C%E6%88%90"><i class="fa fa-link"></i></a>完成</h1>

<p>カレンダーと組み合わせるとライフログっぽくできる。</p>

<p><a href="https://camo.qiitausercontent.com/055f586bd8d32bf05ec5353adce49da38e3713b2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38303437626430312d333330332d343331612d333634652d3435653836356138316536652e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/055f586bd8d32bf05ec5353adce49da38e3713b2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f38303437626430312d333330332d343331612d333634652d3435653836356138316536652e6a706567" alt="円グラフ.jpg" title="円グラフ.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/8047bd01-3303-431a-364e-45e865a81e6e.jpeg"></a></p>

<p>実際の動作を確認したい人は「理想的な集中と休憩のサイクルを維持する為のタイマーアプリ。集中作業タイマー」をAppStoreでダウンロードしたら良いのではないかと思います。</p>

<p>集中作業タイマー<br>
<a href="https://itunes.apple.com/jp/app/ji-zhong-zuo-yetaima/id547092863?mt=8" class="autolink" rel="nofollow noopener" target="_blank">https://itunes.apple.com/jp/app/ji-zhong-zuo-yetaima/id547092863?mt=8</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />45位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/66404f7c20e28d786329">Objective-Cでprivateなメソッドをオーバーライドする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-14 18:01:59</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>superクラスのメソッドがprivateでどうしてもそれを継承先で上書きしたい場合、カテゴリで該当のメソッドを宣言しておいて実装することは可能。</p>

<p>具体的には、privateなメソッドhogeを持つSクラスに対して、Sを継承したクラスAの実装ファイルで次のようにする</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="c1">//Sのカテゴリを記述</span>
<span class="k">@interface</span> <span class="nc">S</span> <span class="nl">(Hoge)</span>

<span class="c1">//カテゴリとしてhogeメソッドを宣言</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">hoge</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">A</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">hoge</span>
<span class="p">{</span>
    <span class="c1">//カテゴリで宣言されてないとsuper hogeはエラーになる</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">hoge</span><span class="p">];</span>

    <span class="c1">//ここで何かオリジナルなことをやる</span>
    <span class="c1">//....</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div></div>

<h2>
<span id="どういう時に使うか" class="fragment"></span><a href="#%E3%81%A9%E3%81%86%E3%81%84%E3%81%86%E6%99%82%E3%81%AB%E4%BD%BF%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>どういう時に使うか</h2>

<p>privateメソッドをオーバーライドしているので、この方法を積極的に使って良いとは言えないけど、例えば人が書いたソースコードなどでGitHubに上がってるわけでもなくforkできないし、記述をどうしても変更したくない(or変更できない)場合に本当に仕方なくやるならしょうがないかなと思うんですけどどうでしょうね…。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />46位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/7fea5b2d880bf05e7a80">RubyでUUIDを生成する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-07 20:58:59</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="nb">p</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">uuid</span> <span class="c1">#=&gt; 73f57385-7c80-49f2-b636-28b0e7bea67d</span>
</pre></div></div>

<p>参考<br>
<a href="http://doc.okkez.net/1.9.3/view/method/SecureRandom/s/uuid" class="autolink" rel="nofollow noopener" target="_blank">http://doc.okkez.net/1.9.3/view/method/SecureRandom/s/uuid</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />47位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/7c7372e284e13827c989">iOS7で動的にステータスバーを消すとviewが移動してしまう</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-01 18:57:08</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="結論" class="fragment"></span><a href="#%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>結論</h2>

<p>UIViewControllerのautomaticallyAdjustsScrollViewInsetsプロパティをNOにして解決した。</p>

<p>追記：iOS7のナビゲーションバーやステータスバーについては下記内容が包括的<br>
<a href="http://qiita.com/yimajo/items/254c7cebab7864678246" class="autolink" id="reference-3f681e02b863b4f249c8">http://qiita.com/yimajo/items/254c7cebab7864678246</a></p>

<h2>
<span id="説明" class="fragment"></span><a href="#%E8%AA%AC%E6%98%8E"><i class="fa fa-link"></i></a>説明</h2>

<p>iOS7になってステータスバーの取り扱いが変わったため、画像のフルスクリーン時にステータスバーを表示/非表示の切り替えをするのにしばらくやり方が分からなかった。</p>

<p>次の3つの条件が揃っていたので嵌ってしまった。</p>

<ul>
<li>ステータスバーを動的に非表示非表示を繰り返す</li>
<li>ナビゲーションバーを表示する</li>
</ul>

<p>何も考えず、動的ににステータスバーを非表示にした場合、次のように中央においているつもりの画像用Viewがステータスバーぶん上にずれる。</p>

<p>左がステータスバー有り。右がステータスバーを非表示にした。</p>

<p><a href="https://camo.qiitausercontent.com/4879e38d72230300915d0d8cad20f5fa00a08584/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37343232643636322d333130652d313265312d326134662d3866646563623466666663312e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4879e38d72230300915d0d8cad20f5fa00a08584/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f37343232643636322d333130652d313265312d326134662d3866646563623466666663312e6a706567" alt="yes_st_on_of.jpeg" title="yes_st_on_of.jpeg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/7422d662-310e-12e1-2a4f-8fdecb4fffc1.jpeg"></a></p>

<p>左右共に、青いViewの開始位置はナビゲーションバーに潜り込んでおらず、ナビゲーションバーがステータスバーのY位置下に配置されているため、ステータスバーを消すとナビゲーションバーと共にViewが移動してしまう。</p>

<p>原因は、iOS7からナビゲーションバーに配慮してViewのinsetsを自動で設定されるためらしい。</p>

<p>これをステータスバーやナビゲーションバーを無視するようにして表示非表示を切り替えても違和感なくするためにViewControllerのプロパティautomaticallyAdjustsScrollViewInsetsをNOにすることで解決。</p>

<p><a href="https://camo.qiitausercontent.com/444fe7573a7048ed2a7e2666a0db294be0a83fdb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f39306566323161662d666237612d646334622d323634622d6331616339303435313132382e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/444fe7573a7048ed2a7e2666a0db294be0a83fdb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f39306566323161662d666237612d646334622d323634622d6331616339303435313132382e6a706567" alt="no_st_on_of.jpg" title="no_st_on_of.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/90ef21af-fb7a-dc4b-264b-c1ac90451128.jpeg"></a></p>

<p>インターフェースビルダー上にAdjust Scroll View Insetsのチェックボックスがあるのでこれをチェック外してもいい。自動でスクロールバーのInsetsを調整するフラグだと憶えておこう。</p>

<p><a href="https://camo.qiitausercontent.com/cff16d2ebc62cae93f7084999b24e86047abd5a9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61316139656261312d303764392d333636352d653737322d3838363630666332313163652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/cff16d2ebc62cae93f7084999b24e86047abd5a9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f61316139656261312d303764392d333636352d653737322d3838363630666332313163652e706e67" alt="スクリーンショット 2013-11-01 18.42.55.png" title="スクリーンショット 2013-11-01 18.42.55.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/a1a9eba1-07d9-3665-e772-88660fc211ce.png"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />48位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/4735078cb9696405f32f">UIScrollViewで写真閲覧スクロール表示を実装するなら「ATPagingView」が使える</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-08 00:10:54</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> <b>[UIScrollView]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>（iOS6からはUICollectionViewを使ったほうがいいとは思いますが、ATPagingViewの説明としてこの記事は残しておきます）</p>

<p>UIScrollViewで写真閲覧スクロール表示を実装するとき、再利用や先読みが必要であればATPagingView(<a href="https://github.com/andreyvit/SoloComponents-iOS" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/andreyvit/SoloComponents-iOS</a>) クラスの設計が参考になる。</p>

<p>また、ATPagingViewではスクロールのために必要になるUIScrollViewDelegateをページングのみ特化するプロトコルを定義することで処理をわかりやすくもしている。</p>

<p>ATPagingViewDelegateに定義されているプロトコルは次の通り</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@protocol</span> <span class="nc">ATPagingViewDelegate</span> <span class="o">&lt;</span><span class="bp">NSObject</span><span class="o">&gt;</span>

<span class="k">@required</span>

<span class="c1">//ページ数を返すようにする。UITableViewのtableView:numberOfRowsInSection:と同じようなメソッド</span>
<span class="o">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nl">numberOfPagesInPagingView</span><span class="p">:(</span><span class="n">ATPagingView</span> <span class="o">*</span><span class="p">)</span><span class="n">pagingView</span><span class="p">;</span>

<span class="c1">//必要になったページviewを生成。UITableViewのtableView:cellForRowAtIndexPath:と同じようなメソッド</span>
<span class="p">-</span> <span class="p">(</span><span class="bp">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nf">viewForPageInPagingView:</span><span class="p">(</span><span class="n">ATPagingView</span> <span class="o">*</span><span class="p">)</span><span class="nv">pagingView</span> <span class="nf">atIndex:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">index</span><span class="p">;</span>

<span class="k">@optional</span>
<span class="c1">//optionalなメソッドはスクロールのために必要になるUIScrollViewDelegateを直接使う必要がないようにしている</span>

<span class="c1">//ページ番号が切り替わった時（表示は前のページの状態）</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">currentPageDidChangeInPagingView</span><span class="p">:(</span><span class="n">ATPagingView</span> <span class="o">*</span><span class="p">)</span><span class="n">pagingView</span><span class="p">;</span>
<span class="c1">//ページ番号が切り替わった時2度呼ばれる（必要性は不明）</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">pagesDidChangeInPagingView:</span><span class="p">(</span><span class="n">ATPagingView</span> <span class="o">*</span><span class="p">)</span><span class="nv">pagingView</span><span class="p">;</span>

<span class="c1">//スクロール開始時に呼ばれる</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">pagingViewWillBeginMoving:</span><span class="p">(</span><span class="n">ATPagingView</span> <span class="o">*</span><span class="p">)</span><span class="nv">pagingView</span><span class="p">;</span>
<span class="c1">//スクロールが終了した際に呼ばれる</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">pagingViewDidEndMoving:</span><span class="p">(</span><span class="n">ATPagingView</span> <span class="o">*</span><span class="p">)</span><span class="nv">pagingView</span><span class="p">;</span>

<span class="k">@end</span>
</pre></div></div>

<h2>
<span id="atpagingviewでのページの先読み" class="fragment"></span><a href="#atpagingview%E3%81%A7%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E5%85%88%E8%AA%AD%E3%81%BF"><i class="fa fa-link"></i></a>ATPagingViewでのページの先読み</h2>

<p>ページの先読みはATPagingViewのpagesToPreloadプロパティに指定することで先読みを行うことが出来る。<br>
この先読みは表示されているページの前後の数を指定することになり、2を指定した場合は*2の合計4ページの先読みとなる。</p>

<h2>
<span id="atpagingviewでのビューの生成と再利用" class="fragment"></span><a href="#atpagingview%E3%81%A7%E3%81%AE%E3%83%93%E3%83%A5%E3%83%BC%E3%81%AE%E7%94%9F%E6%88%90%E3%81%A8%E5%86%8D%E5%88%A9%E7%94%A8"><i class="fa fa-link"></i></a>ATPagingViewでのビューの生成と再利用</h2>

<p>requiredな2つのメソッドの1つ、numberOfPagesInPagingView:で指定するのは全てのページ数。これによりUIScrollViewのcontentsSizeが決定しスクロールできる範囲が決まる。</p>

<p>次に先述したviewForPageInPagingView:atIndex:メソッドにより表示しようとするページのViewを生成する。このメソッドを実装する場合、dequeueReusablePageメソッドにより再利用queueからUIViewを取り出す</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="bp">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nf">viewForPageInPagingView:</span><span class="p">(</span><span class="n">ATPagingView</span> <span class="o">*</span><span class="p">)</span><span class="nv">pagingView</span> <span class="nf">atIndex:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">index</span>
<span class="p">{</span>
    <span class="bp">UIView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="p">(</span><span class="bp">UIView</span> <span class="o">*</span><span class="p">)[</span><span class="n">pagingView</span> <span class="n">dequeueReusablePage</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">view</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//再利用できなければ生成する</span>
        <span class="n">view</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">].</span><span class="n">bounds</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="cm">/*…ここでUIImageViewなどをセットする...*/</span>
    <span class="k">return</span> <span class="n">view</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="atpagingviewでのページ切り替え" class="fragment"></span><a href="#atpagingview%E3%81%A7%E3%81%AE%E3%83%9A%E3%83%BC%E3%82%B8%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88"><i class="fa fa-link"></i></a>ATPagingViewでのページ切り替え</h2>

<p>UIScrollViewDelegateではドラッグし始めたかどうかや減速しているかどうかのフラグがあるが、ページングにはそういった情報は必要がない場合が多いため機能として最低限のものを用意し処理をわかりやすくしている。</p>

<p>スクロール開始時に呼ばれるpagingViewWillBeginMoving:メソッドはスクロール中にツールバーやナビゲーションバーのボタンを非活性にしたい場合などに使え、pagingViewDidEndMoving:は非活性化したボタンの活性化や各ページのスケールリセット等を行うのに役に立つ。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />49位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/d66a1af1c66489407330">NSJSONSerializationの落とし穴</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-15 15:27:29</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>落とし穴、というかパースする前にはnilチェックしましょうと言う話。</p>

<p>iOS5からJSONを便利に扱えるNSJSONSerializationクラスだが、JSONをパースするためのJSONObjectWithData:options:error:メソッドは、引数として渡すNSDataがnilだと例外を発生させる。</p>

<div class="code-frame" data-lang="objective-c"><div class="highlight"><pre><span></span><span class="c1">//パースさせたいNSDataがnilの場合例外が発生する</span>
<span class="kt">id</span> <span class="n">jsonObject</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSJSONSerialization</span> <span class="nl">JSONObjectWithData</span><span class="p">:</span><span class="nb">nil</span>
                                                <span class="nl">options</span><span class="p">:</span><span class="n">NSJSONReadingAllowFragments</span>
                                                  <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>

</pre></div></div>

<p>引数にNSErrorのアドレスを渡すことでエラーがセットされるが、これはあくまでパースエラーが起こった場合であり、パースさせたい対象がnilだとパースエラーではなく例外が発生するためにこのエラーでは判断できない。</p>

<p>例外が発生するのならばtry catchで囲むことを考える</p>

<div class="code-frame" data-lang="objective-c"><div class="highlight"><pre><span></span><span class="kt">id</span> <span class="n">jsonObject</span><span class="p">;</span>
<span class="k">@try</span> <span class="p">{</span>
    <span class="n">jsonObject</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSJSONSerialization</span> <span class="nl">JSONObjectWithData</span><span class="p">:</span><span class="nb">nil</span>
                                                    <span class="nl">options</span><span class="p">:</span><span class="n">NSJSONReadingAllowFragments</span>
                                                      <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="k">@catch</span> <span class="p">(</span><span class="bp">NSException</span> <span class="o">*</span><span class="n">exception</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*…*/</span>
<span class="p">}</span>
</pre></div></div>

<p>try catchにより例外発生時に強制終了することはなくなったが、nilの場合に例外が発生していると原因が特定されていて防げるのであれば、下記のようにnilチェックをするだけでよいのではないか</p>

<div class="code-frame" data-lang="objective-c"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">id</span> <span class="n">jsonObject</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSJSONSerialization</span> <span class="nl">JSONObjectWithData</span><span class="p">:</span><span class="n">data</span>
                                                    <span class="nl">options</span><span class="p">:</span><span class="n">NSJSONReadingAllowFragments</span>
                                                      <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
  <span class="cm">/*…*/</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="cm">/*…*/</span>
<span class="p">}</span>
</pre></div></div>

<p>また、try catchをあまり使いたくない理由としては、例外発生時にcatchできようが、tryのコードブロック（スコープ）を抜けてしまうことでコード末尾に辿りつけず、ARC使用時に自動で挿入されたreleaseが実行されないためメモリリークしてしまうため（そのような状況を防ぐにはLLVM コンパイラーのオプションとして "-fobjc-arc-exceptions" につけると良いらしい）。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>EZ-NET: 例外発生時の ARC 制御<br>
<a href="http://program.station.ez-net.jp/special/objective-c/llvm/arc/exception.asp" class="autolink" rel="nofollow noopener" target="_blank">http://program.station.ez-net.jp/special/objective-c/llvm/arc/exception.asp</a></p>

<p>Google Objective-Cスタイルガイド 日本語訳<br>
<a href="http://www.textdrop.net/google-styleguide-ja/objcguide.xml#Avoid_Throwing_Exceptions" class="autolink" rel="nofollow noopener" target="_blank">http://www.textdrop.net/google-styleguide-ja/objcguide.xml#Avoid_Throwing_Exceptions</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />50位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/5866195ba4b696dae228">画像処理ライブラリGPUImageを使った3x3のフィルタリングで理解するプログラマブルシェーダ言語</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-22 14:35:59</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> <b>[GLSL]</b> <b>[gpuimage]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>すでに投稿してある<a href="http://qiita.com/yimajo/items/e38e8bafc17144b7af79" id="reference-e1a6b9809bd4eb9b1764">画像処理のデファクトスタンダードライブラリGPUImageの基本と応用</a>のプログラマブルシェーダについてを分けて投稿する。</p>

<p><a href="https://github.com/BradLarson/GPUImage" rel="nofollow noopener" target="_blank">GPUImageライブラリ</a>では3x3のカーネル（オペレータ、重み）を変更することで画像処理を行うためのクラスGPUImage3x3ConvolutionFilterが用意されている。このクラスの説明と、コードを読むことで頂点シェーダとフラグメントシェーダの理解を深めるためのメモ。画像処理プログラミングの基礎として、カーネルを用いた積和演算（畳み込み）についての知識がないと理解できないと思う。</p>

<h2>
<span id="gpuimage3x3convolutionfilterクラスを読む" class="fragment"></span><a href="#gpuimage3x3convolutionfilter%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E8%AA%AD%E3%82%80"><i class="fa fa-link"></i></a>GPUImage3x3ConvolutionFilterクラスを読む</h2>

<h3>
<span id="関連するソースコード" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E3%81%99%E3%82%8B%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>関連するソースコード</h3>

<h3>
<span id="カーネルの設定について" class="fragment"></span><a href="#%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>カーネルの設定について</h3>

<p><a href="https://github.com/BradLarson/GPUImage/blob/master/framework/Source/GPUImage3x3ConvolutionFilter.h" rel="nofollow noopener" target="_blank">GPUImage3x3ConvolutionFilter.h</a>には、3x3のカーネルを保持するプロパティがあり、これに3x3のカネールを渡すことで画像をフィルタリングすることが出来る。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="k">@property</span><span class="p">(</span><span class="k">readwrite</span><span class="p">,</span> <span class="k">nonatomic</span><span class="p">)</span> <span class="n">GPUMatrix3x3</span> <span class="n">convolutionKernel</span><span class="p">;</span>
</pre></div></div>

<p>GPUMatrix3x3は構造体になっており次のように設定できる。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">GPUImage3x3ConvolutionFilter</span> <span class="o">*</span><span class="p">)</span><span class="n">filter</span> <span class="nl">setConvolutionKernel</span><span class="p">:(</span><span class="n">GPUMatrix3x3</span><span class="p">){</span>
    <span class="p">{</span> <span class="mf">0.11f</span><span class="p">,</span>  <span class="mf">0.11f</span><span class="p">,</span> <span class="mf">0.11f</span><span class="p">},</span>
    <span class="p">{</span> <span class="mf">0.11f</span><span class="p">,</span>  <span class="mf">0.11f</span><span class="p">,</span> <span class="mf">0.11f</span><span class="p">},</span>
    <span class="p">{</span> <span class="mf">0.11f</span><span class="p">,</span>  <span class="mf">0.11f</span><span class="p">,</span> <span class="mf">0.11f</span><span class="p">}</span>
<span class="p">}];</span>
</pre></div></div>

<p>設定している0.11fは1/9（3x3=9の値の平均値を取り出すための設定値）であり移動平均の値となる（移動平均について: <a href="http://imagingsolution.blog107.fc2.com/blog-entry-88.html" class="autolink" rel="nofollow noopener" target="_blank">http://imagingsolution.blog107.fc2.com/blog-entry-88.html</a> ）。</p>

<p>この書式は<a href="https://github.com/BradLarson/GPUImage/blob/master/framework/Source/GPUImageFilter.h" rel="nofollow noopener" target="_blank">GPUMatrix3x3</a>構造体の中にGPUVector3構造体が3つあり、データを設定しやすいようにしている。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">GPUMatrix3x3</span> <span class="p">{</span>
    <span class="n">GPUVector3</span> <span class="n">one</span><span class="p">;</span>
    <span class="n">GPUVector3</span> <span class="n">two</span><span class="p">;</span>
    <span class="n">GPUVector3</span> <span class="n">three</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">GPUMatrix3x3</span> <span class="n">GPUMatrix3x3</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">GPUVector3</span> <span class="p">{</span>
    <span class="n">GLfloat</span> <span class="n">one</span><span class="p">;</span>
    <span class="n">GLfloat</span> <span class="n">two</span><span class="p">;</span>
    <span class="n">GLfloat</span> <span class="n">three</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">GPUVector3</span> <span class="n">GPUVector3</span><span class="p">;</span>
</pre></div></div>

<p>設定するカーネルの値はconvolutionMatrixという変数としてシェーダに渡される。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithFragmentShaderFromString:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fragmentShaderString</span><span class="p">;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">initWithFragmentShaderFromString</span><span class="p">:</span><span class="n">fragmentShaderString</span><span class="p">]))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//シェーダに渡すindexを保持</span>
    <span class="n">convolutionMatrixUniform</span> <span class="o">=</span> <span class="p">[</span><span class="n">filterProgram</span> <span class="nl">uniformIndex</span><span class="p">:</span><span class="s">@"convolutionMatrix"</span><span class="p">];</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark -</span>
<span class="cp">#pragma mark Accessors</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">setConvolutionKernel</span><span class="p">:(</span><span class="n">GPUMatrix3x3</span><span class="p">)</span><span class="n">newValue</span><span class="p">;</span>
<span class="p">{</span>
    <span class="n">_convolutionKernel</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">;</span>
    <span class="c1">//setterをオーバーライドしシェーダに渡す設定を行う</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">setMatrix3f</span><span class="p">:</span><span class="n">_convolutionKernel</span> <span class="nl">forUniform</span><span class="p">:</span><span class="n">convolutionMatrixUniform</span> <span class="nl">program</span><span class="p">:</span><span class="n">filterProgram</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<h3>
<span id="3x3カーネルを渡したフラグメントシェーダ" class="fragment"></span><a href="#3x3%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%82%92%E6%B8%A1%E3%81%97%E3%81%9F%E3%83%95%E3%83%A9%E3%82%B0%E3%83%A1%E3%83%B3%E3%83%88%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80"><i class="fa fa-link"></i></a>3x3カーネルを渡したフラグメントシェーダ</h3>

<p><a href="https://github.com/BradLarson/GPUImage/blob/master/framework/Source/GPUImage3x3ConvolutionFilter.m" rel="nofollow noopener" target="_blank">フラグメントシェーダ側</a>にはObjective-Cのコードからグローバルな定数として渡される。そのためuniformとなる。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="bp">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">kGPUImage3x3ConvolutionFragmentShaderString</span> <span class="o">=</span> <span class="n">SHADER_STRING</span>
<span class="p">(</span>
 <span class="n">precision</span> <span class="n">highp</span> <span class="kt">float</span><span class="p">;</span>

 <span class="n">uniform</span> <span class="n">sampler2D</span> <span class="n">inputImageTexture</span><span class="p">;</span>
 <span class="c1">//uniformはシステムから渡されることを示す定数。カーネルを定数として渡している。</span>
 <span class="n">uniform</span> <span class="n">mediump</span> <span class="n">mat3</span> <span class="n">convolutionMatrix</span><span class="p">;</span>

 <span class="c1">//varyingは頂点シェーダから渡される値なのでここでは気にしない</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">textureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">leftTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">rightTextureCoordinate</span><span class="p">;</span>

 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">topTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">topLeftTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">topRightTextureCoordinate</span><span class="p">;</span>

 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">bottomTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">bottomLeftTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">bottomRightTextureCoordinate</span><span class="p">;</span>

 <span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
 <span class="p">{</span>
     <span class="c1">//まず近傍画像３行目の色を取得</span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">bottomColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">bottomTextureCoordinate</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">bottomLeftColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">bottomLeftTextureCoordinate</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">bottomRightColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">bottomRightTextureCoordinate</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
     <span class="c1">//センターの色を取得</span>
     <span class="n">mediump</span> <span class="n">vec4</span> <span class="n">centerColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">textureCoordinate</span><span class="p">);</span>
     <span class="c1">//センター左のピクセルの色を取得</span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">leftColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">leftTextureCoordinate</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
     <span class="c1">//センター左のピクセルの色を取得      </span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">rightColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">rightTextureCoordinate</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
     <span class="c1">//近傍画像１行目の色を取得</span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">topColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">topTextureCoordinate</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">topRightColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">topRightTextureCoordinate</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">topLeftColor</span> <span class="o">=</span> <span class="n">texture2D</span><span class="p">(</span><span class="n">inputImageTexture</span><span class="p">,</span> <span class="n">topLeftTextureCoordinate</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>

     <span class="c1">//まず１行目をカーネルと畳み込む</span>
     <span class="n">mediump</span> <span class="n">vec3</span> <span class="n">resultColor</span> <span class="o">=</span> <span class="n">topLeftColor</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">topColor</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">topRightColor</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
     <span class="c1">//２行目をカーネルと畳み込む</span>
     <span class="n">resultColor</span> <span class="o">+=</span> <span class="n">leftColor</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">centerColor</span><span class="p">.</span><span class="n">rgb</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rightColor</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
     <span class="c1">//３行目をカーネルと畳み込む</span>
     <span class="n">resultColor</span> <span class="o">+=</span> <span class="n">bottomLeftColor</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bottomColor</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bottomRightColor</span> <span class="o">*</span> <span class="n">convolutionMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>

     <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">resultColor</span><span class="p">,</span> <span class="n">centerColor</span><span class="p">.</span><span class="n">a</span><span class="p">);</span>
 <span class="p">}</span>
<span class="p">);</span>
</pre></div></div>

<p>フラグメントシェーダは3x3のフィルタリングのため畳み込み（積和演算）を行っているだけなのが分かる。varyingなグローバル変数が近傍画像の座標値となっており、これは頂点シェーダで設定された値となる。</p>

<h3>
<span id="3x3フィルタのための頂点シェーダ" class="fragment"></span><a href="#3x3%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E9%A0%82%E7%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80"><i class="fa fa-link"></i></a>3x3フィルタのための頂点シェーダ</h3>

<p>頂点シェーダはGPUImage3x3ConvolutionFilterが継承する<a href="https://github.com/BradLarson/GPUImage/blob/master/framework/Source/GPUImage3x3TextureSamplingFilter.m" rel="nofollow noopener" target="_blank">GPUImage3x3TextureSamplingFilterに実装されている</a>。</p>

<p>頂点シェーダのコードを読む前に、知って置かなければいけない前提知識は</p>

<ul>
<li>attribute変数は頂点ごとに設定できる変数（頂点シェーダのみ使用可）</li>
<li>画像の縦横サイズは0〜1に正規化される</li>
</ul>

<p>attribute変数はuniformと同じようにGPUImageが渡している変数で、大抵の場合GPUImageが渡しているのは頂点の座標値となる。</p>

<p>画像の縦横サイズはOpenGLでは0から1までの座標値として扱われる。そのため、頂点シェーダでは1/サイズとして計算される。より具体的には例えば320pxの横画像であれば、横10pxの位置を示す場合1/320 * 10 = 0.3125となる。</p>

<p>頂点シェーダではフラグメントシェーダで処理する3x3の近傍領域の値が欲しいので、この縦横サイズから1px分ずらした座標値を取得しグローバルなvarying変数に保持する。</p>

<div class="code-frame" data-lang="objectivec"><div class="highlight"><pre><span></span><span class="bp">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">kGPUImageNearbyTexelSamplingVertexShaderString</span> <span class="o">=</span> <span class="n">SHADER_STRING</span>
<span class="p">(</span>
 <span class="c1">//GPUImageの内部で設定されている座標値</span>
 <span class="n">attribute</span> <span class="n">vec4</span> <span class="n">position</span><span class="p">;</span>
 <span class="n">attribute</span> <span class="n">vec4</span> <span class="n">inputTextureCoordinate</span><span class="p">;</span>

 <span class="c1">//画像の横と縦サイズ。これはGPUImage3x3TextureSamplingFilterで設定される</span>
 <span class="n">uniform</span> <span class="kt">float</span> <span class="n">texelWidth</span><span class="p">;</span>
 <span class="n">uniform</span> <span class="kt">float</span> <span class="n">texelHeight</span><span class="p">;</span> 

 <span class="c1">//フラグメントシェーダと共用する座標</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">textureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">leftTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">rightTextureCoordinate</span><span class="p">;</span>

 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">topTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">topLeftTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">topRightTextureCoordinate</span><span class="p">;</span>

 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">bottomTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">bottomLeftTextureCoordinate</span><span class="p">;</span>
 <span class="n">varying</span> <span class="n">vec2</span> <span class="n">bottomRightTextureCoordinate</span><span class="p">;</span>

 <span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
 <span class="p">{</span>
     <span class="c1">//頂点シェーダはお約束のようにgl_Positionにpositionを渡す</span>
     <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">position</span><span class="p">;</span>

     <span class="c1">//近傍領域3x3の計算のためにあらかじめ変数化しておく</span>
     <span class="c1">//横1px分だけ（縦は0）の値</span>
     <span class="n">vec2</span> <span class="n">widthStep</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="n">texelWidth</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
     <span class="c1">//縦1px分だけ（横は0）の値</span>
     <span class="n">vec2</span> <span class="n">heightStep</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">texelHeight</span><span class="p">);</span>
     <span class="c1">//縦横1pxの値</span>
     <span class="n">vec2</span> <span class="n">widthHeightStep</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="n">texelWidth</span><span class="p">,</span> <span class="n">texelHeight</span><span class="p">);</span>
     <span class="c1">//縦1px横-1pxの値</span>
     <span class="n">vec2</span> <span class="n">widthNegativeHeightStep</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="n">texelWidth</span><span class="p">,</span> <span class="o">-</span><span class="n">texelHeight</span><span class="p">);</span>

     <span class="c1">//フラグメントシェーダの中央になる</span>
     <span class="n">textureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
     <span class="c1">//左の点になる</span>
     <span class="n">leftTextureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="n">widthStep</span><span class="p">;</span>
     <span class="c1">//右の点</span>
     <span class="n">rightTextureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span> <span class="o">+</span> <span class="n">widthStep</span><span class="p">;</span>
     <span class="c1">//上の点</span>
     <span class="n">topTextureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="n">heightStep</span><span class="p">;</span>
     <span class="c1">//左上の点</span>
     <span class="n">topLeftTextureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="n">widthHeightStep</span><span class="p">;</span>
     <span class="c1">//右上の点</span>
     <span class="n">topRightTextureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span> <span class="o">+</span> <span class="n">widthNegativeHeightStep</span><span class="p">;</span>
     <span class="c1">//下の点</span>
     <span class="n">bottomTextureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span> <span class="o">+</span> <span class="n">heightStep</span><span class="p">;</span>
     <span class="c1">//左下の点</span>
     <span class="n">bottomLeftTextureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="n">widthNegativeHeightStep</span><span class="p">;</span>
     <span class="c1">//右下の点</span>
     <span class="n">bottomRightTextureCoordinate</span> <span class="o">=</span> <span class="n">inputTextureCoordinate</span><span class="p">.</span><span class="n">xy</span> <span class="o">+</span> <span class="n">widthHeightStep</span><span class="p">;</span>
 <span class="p">}</span>
<span class="p">);</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />51位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/edbb37ab9b3238a454fb">gitでsvn exportのような事をする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-28 01:03:15</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>gitでsvn exportのようなブランチから特定のパスへのデプロイをしたいときは、git archiveを使うのが良さそう。</p>

<p>git archiveはフォーマットを指定しない場合はtarになるので、パイプで出力をtarに渡す。例えばmasterブランチから/var/www/html/に配置したい場合は次のようにする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git archive master | tar -x -C /var/www/html/
</pre></div></div>

<p>tarコマンドのオプションは<br>
-xはファイルの取り出し<br>
-Cでパスを指定</p>

<p>tarコマンドのオプションを工夫したり、ここには書いてないけど.gitattributesで細かく指定できそう</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>【 tar 】 ファイルを書庫化・展開する（拡張子.tarなど） <br>
<a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20060227/230896/" class="autolink" rel="nofollow noopener" target="_blank">http://itpro.nikkeibp.co.jp/article/COLUMN/20060227/230896/</a></p>

<p>git archive で指定ファイルを除外する<br>
<a href="http://attonblog.blogspot.jp/2012/11/git-archive.html" class="autolink" rel="nofollow noopener" target="_blank">http://attonblog.blogspot.jp/2012/11/git-archive.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />52位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/485ce54e4eb3341688e2">UIActionSheetのボタンを動的に変化させるならaddButtonWithTitle:とbuttonTitleAtIndex:を使う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-15 09:51:48</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>UIActionSheetでボタンの表示を切り替えたい場合、ボタンはaddButtonWithTitle:メソッドにより表示順に追加し、クリック処理時はbuttonTitleAtIndex:メソッドでボタンタイトルにより分岐させればindexを気にしなくて良くなります。</p>

<p><a href="https://camo.qiitausercontent.com/744194a03f6efd1ea5e8042c87bbce99a4d9771b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f30326530376263632d633865632d343364652d666165372d6434336564653834623838302e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/744194a03f6efd1ea5e8042c87bbce99a4d9771b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31363430302f30326530376263632d633865632d343364652d666165372d6434336564653834623838302e6a706567" alt="actionsheet.001.jpg" title="actionsheet.001.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/16400/02e07bcc-c8ec-43de-fae7-d43ede84b880.jpeg"></a></p>

<p>大抵の場合、UIActionSheetのボタンが押された時の処理は、UIActionSheetDelegateのactionSheet: clickedButtonAtIndex:メソッドを実装し、引数で渡されるクリックされたボタンのindexによって処理を実行すると思います（iPhoneアプリ開発の虎の巻:<a href="http://iphone-tora.sakura.ne.jp/uiactionSheet.html" class="autolink" rel="nofollow noopener" target="_blank">http://iphone-tora.sakura.ne.jp/uiactionSheet.html</a> ）。</p>

<p>ただ、UIActionSheetのボタンの表示を動的に変化させる場合は、ボタンの表示順が変わるため当然indexが変わり、それを考慮する必要が出てきます。つまりUIActionSheetの生成時とそのクリック処理の条件分岐にindexを共通で変化させる必要が出てきてしまいます。</p>

<p>しかし、UIActionSheetの生成時は条件によって追加するボタンを変更し、クリック処理時はボタンが押されたタイトルによって条件を分岐することによって、indexの整合性を取る必要がなくなります。</p>

<h2>
<span id="例とサンプルコード" class="fragment"></span><a href="#%E4%BE%8B%E3%81%A8%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>例とサンプルコード</h2>

<p>例をあげます。UIActionSheetによりお気に入りに追加する画面があるとします。お気に入りに追加済みかどうかを示すフラグself.favがYES、そうでなければNOを返し、そのフラグによってお気に入りに既に追加済みであれば「お気に入りに追加」ボタンを表示しないというケースが有るとします。</p>

<p>まずUIActionSheetの生成は、addButtonWithTitleメソッドで条件によって表示する/しないを決定します。</p>

<div class="code-frame" data-lang="objective-c"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">showActionSheet:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>   
    <span class="c1">// アクションシートの作成。タイトルを設定しない</span>
    <span class="bp">UIActionSheet</span> <span class="o">*</span><span class="n">actionSheet</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIActionSheet</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle</span><span class="p">:</span><span class="nb">nil</span>
                                                             <span class="nl">delegate</span><span class="p">:</span><span class="nb">self</span>
                                                    <span class="nl">cancelButtonTitle</span><span class="p">:</span><span class="nb">nil</span>
                                               <span class="nl">destructiveButtonTitle</span><span class="p">:</span><span class="nb">nil</span>
                                                    <span class="nl">otherButtonTitles</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">fav</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//すでにお気に入りに追加済みなのでお気に入りに追加という選択はない</span>
        <span class="c1">//ツイートするボタンのみ</span>
        <span class="p">[</span><span class="n">actionSheet</span> <span class="nl">addButtonWithTitle</span><span class="p">:</span><span class="s">@"ツイートする"</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">//お気に入りに登録していないのでお気に入りに追加という選択がある</span>
        <span class="p">[</span><span class="n">actionSheet</span> <span class="nl">addButtonWithTitle</span><span class="p">:</span><span class="s">@"お気に入りに追加する"</span><span class="p">];</span>
        <span class="p">[</span><span class="n">actionSheet</span> <span class="nl">addButtonWithTitle</span><span class="p">:</span><span class="s">@"ツイートする"</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">//最後にcancelボタンを追加しボタン総数から1減らした数をindexにする</span>
    <span class="p">[</span><span class="n">actionSheet</span> <span class="nl">addButtonWithTitle</span><span class="p">:</span><span class="s">@"キャンセル"</span><span class="p">];</span>
    <span class="n">actionSheet</span><span class="p">.</span><span class="n">cancelButtonIndex</span> <span class="o">=</span> <span class="n">actionSheet</span><span class="p">.</span><span class="n">numberOfButtons</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// アクションシートの表示</span>
    <span class="p">[</span><span class="n">actionSheet</span> <span class="nl">showInView</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>次に処理を行うメソッドでは、buttonTitleAtIndex:メソッドを使いUIActionSheetからクリックされたボタンのタイトルを取得、そのタイトルによって処理を分岐します。</p>

<div class="code-frame" data-lang="objective-c"><div class="highlight"><pre><span></span><span class="c1">//UIActionSheetDelegateによるクリック時処理</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">actionSheet:</span><span class="p">(</span><span class="bp">UIActionSheet</span> <span class="o">*</span><span class="p">)</span><span class="nv">actionSheet</span> <span class="nf">clickedButtonAtIndex:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">buttonIndex</span>
<span class="p">{</span>
    <span class="bp">NSString</span> <span class="o">*</span><span class="n">clieckedButtonTitle</span> <span class="o">=</span> <span class="p">[</span><span class="n">actionSheet</span> <span class="nl">buttonTitleAtIndex</span><span class="p">:</span><span class="n">buttonIndex</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">clieckedButtonTitle</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"お気に入りに追加する"</span><span class="p">])</span> <span class="p">{</span>
        <span class="c1">//お気に入りに登録する処理実行</span>
        <span class="cm">/*…*/</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">clieckedButtonTitle</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"ツイートする"</span><span class="p">])</span> <span class="p">{</span>
        <span class="c1">//ツイートする処理実行</span>
        <span class="cm">/*…*/</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>（上記の例ではタイトルの文字列をハードコーディングしていますが、状況によって定数やプロパティを使えばよいでしょう）</p>

<p>これによって、順番を気にするのは生成時のみで、処理を行うメソッドでは動的に変化するindexやお気に入りに追加済みフラグを加味しなくてもよくなっているのがわかると思います。</p>

<h2>
<span id="メリットデメリット" class="fragment"></span><a href="#%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%83%87%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>メリットデメリット</h2>

<p>メリット<br>
・クリック時にボタン表示順による分岐処理が不要になる<br>
・クリック時にボタン表示/非表示フラグによる分岐処理が不要になる</p>

<p>デメリット<br>
・Viewであるボタンのタイトルの文字列で処理を分けるのが若干気持ち悪い</p>

<p>何か他にも良い方法があればコメントにお願いします。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />53位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/5471ee9b86e433602544">iOS7からcachesディレクトリ自体を消す事が出来なくなった</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-12 12:21:04</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iOS7から実機でcachesディレクトリ自体を削除しようとするとパーミッションエラーになる。</p>

<p>cachesディレクトリ直下にそのまま画像などをキャッシュしていた場合は列挙させて削除していくようにした（そもそもcachesディレクトリ自体を消すのが間違っていた）。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
    <span class="bp">NSArray</span> <span class="o">*</span><span class="n">cacheDirPaths</span> <span class="o">=</span> <span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSCachesDirectory</span><span class="p">,</span> <span class="n">NSUserDomainMask</span><span class="p">,</span> <span class="nb">YES</span><span class="p">);</span>
    <span class="c1">//複数のファイルを返すメソッドのためArrayで返ってくるが、特定のディレクトリなため0コ目しか存在しない</span>
    <span class="bp">NSString</span> <span class="o">*</span><span class="n">cacheDirPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">cacheDirPaths</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>

    <span class="bp">NSDirectoryEnumerator</span> <span class="o">*</span><span class="n">fileEnumerator</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSFileManager</span> <span class="n">defaultManager</span><span class="p">]</span> <span class="nl">enumeratorAtPath</span><span class="p">:</span><span class="n">cacheDirPath</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="n">fileName</span> <span class="k">in</span> <span class="n">fileEnumerator</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//jpgやgifなら削除</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">fileName</span> <span class="nl">hasSuffix</span><span class="p">:</span><span class="s">@".jpg"</span><span class="p">]</span>
            <span class="o">||</span> <span class="p">[</span><span class="n">fileName</span> <span class="nl">hasSuffix</span><span class="p">:</span><span class="s">@".jpeg"</span><span class="p">]</span>
            <span class="o">||</span> <span class="p">[</span><span class="n">fileName</span> <span class="nl">hasSuffix</span><span class="p">:</span><span class="s">@".gif"</span><span class="p">])</span> <span class="p">{</span>

            <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span> <span class="p">;</span>
            <span class="bp">NSString</span> <span class="o">*</span><span class="n">removeFilePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">cacheDirPath</span> <span class="nl">stringByAppendingPathComponent</span><span class="p">:</span><span class="n">fileName</span><span class="p">];</span>
            <span class="kt">BOOL</span> <span class="n">remove</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSFileManager</span> <span class="n">defaultManager</span><span class="p">]</span> <span class="nl">removeItemAtPath</span><span class="p">:</span><span class="n">removeFilePath</span>
                                                                     <span class="nl">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>

            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"remove %d"</span><span class="p">,</span> <span class="n">remove</span><span class="p">);</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"error %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div></div>

<p>SDWebImageなどのライブラリを見るとcachesディレクトリの下に専用の画像キャッシュディレクトリを作り、ディスクキャッシュをクリアする場合はそのディレクトリを消すようにしていてシンプルにできてる。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />54位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>10</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/e146604fd87c2d77e40b">AFNetworking 1.xのUIImageView+AFNetworkingを使っている場合は画像キャッシュに注意してほしい</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-23 20:14:24</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>UIImageView+AFNetworkingのNSCacheをクリアしないとクラッシュします。</p>

<h1>
<span id="uiimageviewafnetworkingを使うと画像の読み込みに便利" class="fragment"></span><a href="#uiimageviewafnetworking%E3%82%92%E4%BD%BF%E3%81%86%E3%81%A8%E7%94%BB%E5%83%8F%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E3%81%AB%E4%BE%BF%E5%88%A9"><i class="fa fa-link"></i></a>UIImageView+AFNetworkingを使うと画像の読み込みに便利</h1>

<p>最近ではかなり色んな所で使われているであろう通信ライブラリAFNetworkingでは、<a href="https://github.com/AFNetworking/AFNetworking/blob/1.x/AFNetworking/UIImageView%2BAFNetworking.m" rel="nofollow noopener" target="_blank">UIImageView+AFNetworking</a>を使ってUIImageViewに対して次のような画像ロードのメソッドを追加しています。</p>

<div class="code-frame" data-lang="objc">
<div class="code-lang"><span class="bold">UIImageView+AFNetworking.h</span></div>
<div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setImageWithURL:</span><span class="p">(</span><span class="bp">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">url</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setImageWithURL:</span><span class="p">(</span><span class="bp">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">url</span>
       <span class="nf">placeholderImage:</span><span class="p">(</span><span class="bp">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">placeholderImage</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setImageWithURLRequest:</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="p">)</span><span class="nv">urlRequest</span>
              <span class="nf">placeholderImage:</span><span class="p">(</span><span class="bp">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">placeholderImage</span>
                       <span class="nf">success:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">,</span> <span class="bp">NSHTTPURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span><span class="p">))</span><span class="nv">success</span>
                       <span class="nf">failure:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">,</span> <span class="bp">NSHTTPURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">failure</span><span class="p">;</span>
</pre></div>
</div>

<h2>
<span id="nscacheが使われているがクリアしていないのでクラッシュする" class="fragment"></span><a href="#nscache%E3%81%8C%E4%BD%BF%E3%82%8F%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8C%E3%82%AF%E3%83%AA%E3%82%A2%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A7%E3%82%AF%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>NSCacheが使われているがクリアしていないのでクラッシュする</h2>

<p>これらメソッドにより通信処理やプレースホルダーのセットなどが簡単になっているのですが、このメソッドで読み込まれた画像はNSCacheによってメモリキャッシュされていて、さらにprivateな変数としてstaticで定義されているためメモリが解放されるタイミングはコントロールできません。最悪の場合、メモリ警告が起きたあとも使い続けているとアプリケーションはクラッシュしてしまいます。</p>

<h2>
<span id="解決法" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%95"><i class="fa fa-link"></i></a>解決法</h2>

<p>サクッと考えられる解決法をいくつか</p>

<h3>
<span id="解決法1-afnetworking-2を使う" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%951-afnetworking-2%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>解決法1. AFNetworking 2を使う</h3>

<p>iOS7以降だけが対象であれば、AFNetworking 2を使えば解決します。AFNetworking 2の<a href="https://github.com/AFNetworking/AFNetworking/blob/master/UIKit%2BAFNetworking/UIImageView%2BAFNetworking.m" rel="nofollow noopener" target="_blank">UIImageView+AFNetworking</a>はメモリ警告をNSNotificationで監視し、キャッシュをクリアしています。</p>

<div class="code-frame" data-lang="objc">
<div class="code-lang"><span class="bold">UIImageView+AFNetworking.m</span></div>
<div class="highlight"><pre><span></span><span class="p">[[</span><span class="bp">NSNotificationCenter</span> <span class="n">defaultCenter</span><span class="p">]</span> <span class="nl">addObserverForName</span><span class="p">:</span><span class="n">UIApplicationDidReceiveMemoryWarningNotification</span> <span class="nl">object</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">queue</span><span class="p">:[</span><span class="bp">NSOperationQueue</span> <span class="n">mainQueue</span><span class="p">]</span> <span class="nl">usingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSNotification</span> <span class="o">*</span> <span class="n">__unused</span> <span class="n">notification</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">_af_defaultImageCache</span> <span class="n">removeAllObjects</span><span class="p">];</span>
 <span class="p">}];</span>
</pre></div>
</div>

<h3>
<span id="解決法2-自分のリポジトリにforkしてfork先のコードを使う" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%952-%E8%87%AA%E5%88%86%E3%81%AE%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%ABfork%E3%81%97%E3%81%A6fork%E5%85%88%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>解決法2. 自分のリポジトリにforkしてfork先のコードを使う</h3>

<p>iOS6も対象にしないといけない場合かつgit submoduleやCocoaPodsを使っているならAFNetworking 1.x系のリポジトリをforkして自分のリポジトリでAFNetworking 2のような処理を追加するのが良いと思います。</p>

<h3>
<span id="解決法3-カテゴリでnscacheのオブジェクトをpublicにする" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%953-%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%81%A7nscache%E3%81%AE%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92public%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>解決法3. カテゴリでNSCacheのオブジェクトをpublicにする</h3>

<p>iOS6も対象にしないといけないし、git submoduleやCocoaPodsは使っているものの何らかの理由によって自分のリポジトリを使うことが憚られる場合、カテゴリでgetterを記載することでキャッシュを取り出すことが出来ます。</p>

<div class="code-frame" data-lang="objc">
<div class="code-lang"><span class="bold">UIImageView+AFNetworkingImageCache.h</span></div>
<div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="bp">UIImageView</span> <span class="nl">(AFNetworkingImageCache)</span>

<span class="p">+</span> <span class="p">(</span><span class="bp">NSCache</span> <span class="o">*</span><span class="p">)</span><span class="nf">af_sharedImageCache</span><span class="p">;</span>

<span class="k">@end</span>
</pre></div>
</div>

<p>カテゴリを使ってUIKitを拡張しているライブラリに対してカテゴリでメソッドを追加するということに違和感がなければ、NSCacheはキャッシュする上限も決められるのでこの方法もありかもしれません。</p>

<h3>
<span id="解決法4--開発プロジェクトのコードと同じように修正してコミットする" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%954--%E9%96%8B%E7%99%BA%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A8%E5%90%8C%E3%81%98%E3%82%88%E3%81%86%E3%81%AB%E4%BF%AE%E6%AD%A3%E3%81%97%E3%81%A6%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>解決法4.  開発プロジェクトのコードと同じように修正してコミットする</h3>

<p>一番オススメしない方法ですが、ライセンスが緩い外部のOSSなライブラリは開発プロジェクトと同じリポジトリにぶっこんで修正してしまえば当然好きにできます。ですがそんなことしたらライブラリが改善された場合、都度手動でファイル置き換えていくの面倒じゃないでしょうかね？とりあえず正常に動くことは大事とは思いますが、引き継いだ人にダサイっすねとか言われかねないしgit submodlueやCocoaPodsで保持されてない外部ライブラリがあると引継ぎたくないですね！</p>

<h3>
<span id="解決法5-uiimageviewafnetworkingを使わない" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E6%B3%955-uiimageviewafnetworking%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>解決法5. UIImageView+AFNetworkingを使わない</h3>

<p>最後に、使わないので済むならそれが一番かもしれないですね…</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />55位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/6c850610b8c4a4df9d96">Method Swizzlingをしたくなった時用の最小限のメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-25 11:39:00</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Method Swizzlingの話をする時、みんないきなり具体例だしててそのロジック興味ないし最小限の使い方が知りたいだけなのでっていう時のメモ。</p>

<h1>
<span id="利用する関数について" class="fragment"></span><a href="#%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E9%96%A2%E6%95%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>利用する関数について</h1>

<p>メソッドを置き換える関数は次の通り</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="o">&lt;</span><span class="err">#置き換えられるメソッド#</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="err">#新しく置き換えるメソッド#</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div></div>

<p>上記関数のための引数はMethod構造体であり、SELから取得するには下記の関数とその戻り値を利用する</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="o">&lt;</span><span class="err">#メソッドを取り出すクラス#</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="err">#</span><span class="kt">SEL</span><span class="err">#</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div></div>

<p>例</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">switchInstanceMethodFromSelector:</span><span class="p">(</span><span class="kt">SEL</span><span class="p">)</span><span class="nv">fromSelector</span>
                              <span class="nf">toSelector:</span><span class="p">(</span><span class="kt">SEL</span><span class="p">)</span><span class="nv">toSelector</span>
<span class="p">{</span>
    <span class="n">Method</span> <span class="n">fromMethod</span> <span class="o">=</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">fromSelector</span><span class="p">);</span>
    <span class="n">Method</span> <span class="n">toMethod</span>   <span class="o">=</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">toSelector</span><span class="p">);</span>
    <span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">fromMethod</span><span class="p">,</span> <span class="n">toMethod</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h2>

<p>objc/runtime.hが必要となる</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#import &lt;objc/runtime.h&gt;</span>
</pre></div></div>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>AppDelegateに手を加えずPush通知を実装する<br>
<a href="http://qiita.com/s1140227/items/233264f1ce2bf45d11f7" class="autolink" id="reference-4dc3860fcd1f545be92d">http://qiita.com/s1140227/items/233264f1ce2bf45d11f7</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />56位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/a191c76088008153d660">ARCではオブジェクトのスタック変数がnil初期化される</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-21 19:23:52</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ARCの場合ローカルで宣言したオブジェクトのスタック変数はnil初期化される（環境はXcode4.6.3デフォルトのApple LLVM compliler 4.2）。</p>

<p>調べてみるとAppleの日本語リファレンス<a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/ProgrammingWithObjectiveC.pdf" rel="nofollow noopener" target="_blank">Objective-Cによるプログラミング</a>のp41"nilの取り扱い"では、ローカル変数のオブジェクトがnil初期化されると記述されている。</p>

<blockquote>
<p>初期値を指定しなければ、コンパイラが自動的に、nilに初期化するからです。<br>
XYZPerson *somePerson;<br>
//somePersonの値は自動的にnilになる</p>
</blockquote>

<p>また、<a href="http://developer.apple.com/library/ios/#releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html" rel="nofollow noopener" target="_blank">Transitioning to ARC Release Notes</a>のStack Variables Are Initialized with nilの項目にはstrong,weak, autoreleaseingを使用した場合にnil初期化されるとある。</p>

<blockquote>
<p>Using ARC, strong, weak, and autoreleasing stack variables are now implicitly initialized with nil. For example:</p>
</blockquote>

<p>ローカルで宣言されるオブジェクトは暗黙的にstrongなのでnil初期化されるのは仕様通りとなるが、下記のように__unsafe_unretainedにして試してみると</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>- (void)myMethod {
    NSString __unsafe_unretained *name ;
    NSLog(@"name %@",name); //nil初期化されている
}
</pre></div></div>

<p>やはりこれもnil初期化される。__unsafe_unretainedにした場合、仕様に明記されていないがコンパイラが自動的にnil初期化してくれるということなんだろうか。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />57位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/d039645f706c35719552">なぜObjective-Cでは変数の定義時に*を変数側に寄せるのか</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-20 01:16:09</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iOS]</b> <b>[ポエム]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>Objective-Cでは変数の定義時に*をクラス（型）ではなく変数に寄せる慣習がある</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">NSObject</span> <span class="o">*</span><span class="n">object</span><span class="p">;</span>
</pre></div></div>

<p>次のようにクラスに寄せるようなコードは最近では滅多に見ることがない</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">NSObject</span><span class="o">*</span> <span class="n">object</span><span class="p">;</span>
</pre></div></div>

<p>C/C++ではObjective-Cとは逆で、後者のようにクラス（型）側に寄せられることが多いのではないかと思う。</p>

<h2>
<span id="想像" class="fragment"></span><a href="#%E6%83%B3%E5%83%8F"><i class="fa fa-link"></i></a>想像</h2>

<p>なんでこんなになってるのか</p>

<h3>
<span id="objective-cではポインタを宣言時にあまり意識しない" class="fragment"></span><a href="#objective-c%E3%81%A7%E3%81%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%82%BF%E3%82%92%E5%AE%A3%E8%A8%80%E6%99%82%E3%81%AB%E3%81%82%E3%81%BE%E3%82%8A%E6%84%8F%E8%AD%98%E3%81%97%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>Objective-Cではポインタを宣言時にあまり意識しない</h3>

<p>この理由として想像するのは、Objective-Cのオブジェクトについてはポインタを意識することを最小限にしており、インスタンスとプリミティブな変数または構造体を宣言時に見分けやすくなっている</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">ABRect</span> <span class="o">*</span><span class="n">abRect</span><span class="p">;</span>  <span class="c1">//何かしらのインスタンスだろうなと推測する</span>
<span class="bp">CGRect</span> <span class="n">rect</span><span class="p">;</span>     <span class="c1">//プリミティブな型か構造体だろうなと推測する</span>
</pre></div></div>

<p>Objective-Cでポインタ（というかアドレス）を意識する場面は最小限とは言うものの、関数の引数にインスタンスのアドレスを渡し、関数内の処理によりそのインスタンスをどうにかする場面はある。</p>

<p>ちなみに、上記の例のABRectクラスに*を付けない場合はコンパイルエラーとなる。</p>

<blockquote>
<p>Interface type cannot be statically allocated</p>
</blockquote>

<p>Objective-Cではクラスのインスタンスは*を付け、ヒープ領域に作られる方法でしか利用できない。</p>

<h3>
<span id="cのメソッド定義などの事情" class="fragment"></span><a href="#c%E3%81%AE%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E5%AE%9A%E7%BE%A9%E3%81%AA%E3%81%A9%E3%81%AE%E4%BA%8B%E6%83%85"><i class="fa fa-link"></i></a>C++のメソッド定義などの事情</h3>

<p>C++ではメンバ関数の宣言にクラス名自体を含み、関数名を::で繋ぐため、*を付ける位置がクラスでないと違和感が生じてしまう。</p>

<p>具体例を挙げると、C++のDropクラスの関数createがCCObjectを返す場合を考える</p>

<div class="code-frame" data-lang="cpp"><div class="highlight"><pre><span></span><span class="n">CCObject</span> <span class="o">*</span><span class="n">Drop</span><span class="o">::</span><span class="n">create</span><span class="p">();</span> <span class="c1">//ポインタがDropに対して影響を及ぼすように見える</span>
<span class="n">CCObject</span><span class="o">*</span> <span class="n">Drop</span><span class="o">::</span><span class="n">create</span><span class="p">();</span> <span class="c1">//CCObjectのポインタを返すことが伝わる</span>
</pre></div></div>

<p>よってメンバ関数において*はクラス名に付いている方が自然であり、変数の定義時も同じように統一されているように理解できる。</p>

<h2>
<span id="objective-cの内部でcのコードを書くときのtips" class="fragment"></span><a href="#objective-c%E3%81%AE%E5%86%85%E9%83%A8%E3%81%A7c%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%A8%E3%81%8D%E3%81%AEtips"><i class="fa fa-link"></i></a>Objective-C++の内部でC++のコードを書くときのTips</h2>

<p>あくまで自分のTipsですが、Objective-C++にC++が混在するソースコード中では次の自己満足ルールが良さそう</p>

<ul>
<li>Objective-Cのインスタンスを定義する際には*を変数側に寄せ</li>
<li>C++のインスタンスを定義する際にはクラス側に寄せる</li>
</ul>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">example</span>
<span class="p">{</span>
    <span class="bp">NSObject</span> <span class="o">*</span><span class="n">hoge</span><span class="p">;</span>      <span class="c1">// Objective-Cでhogeの定義</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">*</span> <span class="n">piyo</span><span class="p">;</span>   <span class="c1">// C++でpiyoの定義</span>
<span class="p">}</span>
</pre></div></div>

<p>とか思ってみたがFacebookのC++を利用したライブラリ<a href="https://github.com/facebook/pop/blob/master/pop/POPVector.mm" rel="nofollow noopener" target="_blank">pop</a>ではObjective-Cのような*の位置になっていますな...</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">Vector</span> <span class="o">*</span><span class="n">Vector</span><span class="o">::</span><span class="n">new_vector</span><span class="p">(</span><span class="n">NSUInteger</span> <span class="n">count</span><span class="p">,</span> <span class="k">const</span> <span class="n">CGFloat</span> <span class="o">*</span><span class="n">values</span><span class="p">)</span>
</pre></div></div>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<ul>
<li>Objective-Cでは*の位置でそれ自体がObjectかどうかを見分け易い（型の情報ではないということを示したい）</li>
<li>C++ではメソッド定義などの関係上、クラス（型）のすぐ後ろに*が付いているほうが自然に見える</li>
<li>Objective-C++でC++が混在した環境ではそれぞれの形にしたら見分けがつけやすそうだがFacebook社はそのようにしていない</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />58位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/2e1744fd377c4ca13854">iOS7移行ガイドの公式日本語訳が面白い</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-11 13:48:35</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Apple公式の日本語訳がかなりひどいので面白い。訳した人がテクニカルタームと気付かず想像で書いてしまっている。<br>
他にもあるだろうから見つけ次第追記していきたい。</p>

<h1>
<span id="ios7から追加されたviewcontrollerのプロパティの説明がひどい" class="fragment"></span><a href="#ios7%E3%81%8B%E3%82%89%E8%BF%BD%E5%8A%A0%E3%81%95%E3%82%8C%E3%81%9Fviewcontroller%E3%81%AE%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E8%AA%AC%E6%98%8E%E3%81%8C%E3%81%B2%E3%81%A9%E3%81%84"><i class="fa fa-link"></i></a>iOS7から追加されたViewControllerのプロパティの説明がひどい</h1>

<p><a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/UserExperience/Conceptual/TransitionGuide/AppearanceCustomization/AppearanceCustomization.html#//apple_ref/doc/uid/TP40013174-CH15-SW2" rel="nofollow noopener" target="_blank">外観および動作</a>の項目でUIViewControllerのautomaticallyAdjustsScrollViewInsetsプロパティの説明が面白い</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>automaticallyAdjustsScrollViewInsets

スクロールビューの装飾（立体的にくぼんだような表示）は自動調整されますが、これが望ましくない場合は、automaticallyAdjustsScrollViewInsetsをNOと設定してください（automaticallyAdjustsScrollViewInsetsのデフォルト値はYES）。
</pre></div></div>

<p><a href="https://developer.apple.com/library/ios/documentation/userexperience/conceptual/transitionguide/AppearanceCustomization.html#//apple_ref/doc/uid/TP40013174-CH15-SW1" rel="nofollow noopener" target="_blank">訳される前のiOS 7 UI Transition Guide</a>は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span> automaticallyAdjustsScrollViewInsets

If you don’t want a scroll view’s content insets to be automatically adjusted, set automaticallyAdjustsScrollViewInsets to NO. (The default value of automaticallyAdjustsScrollViewInsets is YES.)
</pre></div></div>

<p>これ普通に読むと「スクロールビューのcontent insetsが自動的に調整されるのが嫌ならNOにしたらいい（デフォルトはYES）」としか書いてない。</p>

<p>content insetsはUIScrollViewのcontentInsetsのことなんだけど、意味を理解しないまでもそのまま「コンテンツの余白」と訳してもらったほうがまだ分かりやすい。それを「装飾（立体的にくぼんだような表示）」とか実際のiOS7とは違う訳者の勝手な想像が混じってて混乱させられる。あれ立体的にどこがくぼんでんのかなーとか思ってしまった。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>yimajoさんの<br />59位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/yimajo/items/05bd7bbcba545070e75b">Qiita APIへの要望</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-30 17:21:49</center>
	</td>
	<td style="width:200px;">
		@yimajo<br />(株式会社キュリオシティソフトウェア 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/16400/profile-images/1473681849">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> <b>[api]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Qiita APIを使ったiOSアプリ作ろうかと思いましたが、下記3つのAPIが追加されればいいなと思います</p>

<ul>
<li>ページネーションの取得範囲条件に記事id指定を増やして欲しい</li>
<li>ユーザーのストックされた回数</li>
<li>フィード取得API</li>
</ul>

<h2>
<span id="ページネーションの取得範囲条件に記事id指定を増やして欲しい" class="fragment"></span><a href="#%E3%83%9A%E3%83%BC%E3%82%B8%E3%83%8D%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8F%96%E5%BE%97%E7%AF%84%E5%9B%B2%E6%9D%A1%E4%BB%B6%E3%81%AB%E8%A8%98%E4%BA%8Bid%E6%8C%87%E5%AE%9A%E3%82%92%E5%A2%97%E3%82%84%E3%81%97%E3%81%A6%E6%AC%B2%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>ページネーションの取得範囲条件に記事id指定を増やして欲しい</h2>

<p>iOS端末ローカルに記事一覧を保存しておこうとすると、保存している記事より過去の一覧を取得しようとしてもpageパラメータだけでは取得したいものを特定できません。また、保存している記事から無駄なく最新だけを取得しようとすることも同じように特定できないんですよね。</p>

<p>なので、例えばTwitter APIのmax_idやsince_idのように指定するid以前の記事を取得、以後の記事を取得するような条件を付けられればいいかなと思います。</p>

<h2>
<span id="ユーザーのストックされた回数" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E3%82%B9%E3%83%88%E3%83%83%E3%82%AF%E3%81%95%E3%82%8C%E3%81%9F%E5%9B%9E%E6%95%B0"><i class="fa fa-link"></i></a>ユーザーのストックされた回数</h2>

<p>記事単体のストック数ではなく、ユーザーあたりのストックされた回数が意外とユーザーのモチベーションになります。特定ユーザーの情報取得APIで取得したいですね。</p>

<h2>
<span id="フィード取得api" class="fragment"></span><a href="#%E3%83%95%E3%82%A3%E3%83%BC%E3%83%89%E5%8F%96%E5%BE%97api"><i class="fa fa-link"></i></a>フィード取得API</h2>

<p>自分のフィードを見ることが出来れば嬉しいんですが</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
