<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (awakia)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (awakia さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>741</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/d880250adc8cdbe7a32f">RSpecのshouldはもう古い！新しい記法expectを使おう！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-25 02:57:50</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[RSpec]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>RspecのVersion2.11から</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">old_spec.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">foo</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
<span class="n">foo</span><span class="o">.</span><span class="n">should_not</span> <span class="n">eq</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
</pre></div>
</div>

<p>を</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">new_spec.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">eq</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
</pre></div>
</div>

<p>というように書くようになりました。</p>

<p>別にshouldを使った記法がなくなったわけではありませんが、<br>
<a href="https://github.com/rspec/rspec-expectations" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/rspec/rspec-expectations</a><br>
のREADME.mdには、もう新しいSyntaxの説明しか載っていないし、今後はexpectの方を使っていくほうがいいでしょう。</p>

<p><a href="http://myronmars.to/n/dev-blog/2012/06/rspecs-new-expectation-syntax" class="autolink" rel="nofollow noopener" target="_blank">http://myronmars.to/n/dev-blog/2012/06/rspecs-new-expectation-syntax</a><br>
には、新しいSyntaxを導入した背景が説明されています。<br>
簡潔に書くと、shouldだとBasicObjectを継承したクラスのテストを書くときに不具合が起こるみたいですね。</p>

<h2>
<span id="移行方法" class="fragment"></span><a href="#%E7%A7%BB%E8%A1%8C%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>移行方法</h2>

<h3>
<span id="基本" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC"><i class="fa fa-link"></i></a>基本</h3>

<p>基本的には、上に書いたように、</p>

<ul>
<li>
<code>foo.should</code> を <code>expect(foo).to</code> に</li>
<li>
<code>foo.should_not</code> を <code>expect(foo).not_to</code> に</li>
</ul>

<p>置き換えるだけです。</p>

<h3>
<span id="比較演算子をとる" class="fragment"></span><a href="#%E6%AF%94%E8%BC%83%E6%BC%94%E7%AE%97%E5%AD%90%E3%82%92%E3%81%A8%E3%82%8B"><i class="fa fa-link"></i></a>比較演算子をとる</h3>

<p>ただし、    shouldの後に直接オペレータをとる記法は使えなくなりました。<br>
具体的には、</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">old_operator_expectations.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">foo</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="n">bar</span>
<span class="s2">"a string"</span><span class="o">.</span><span class="n">should_not</span> <span class="o">=~</span> <span class="sr">/a regex/</span>
<span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">should</span> <span class="o">=~</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span>

<span class="n">foo</span><span class="o">.</span><span class="n">should</span> <span class="o">&lt;</span> <span class="n">bar</span>  <span class="c1"># &lt;=, &gt;, &gt;= も同様</span>
</pre></div>
</div>

<p>を</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">new_operator_expectations.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="n">bar</span>
<span class="n">expect</span><span class="p">(</span><span class="s2">"a string"</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">match</span> <span class="sr">/a regex/</span>
<span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">match_array</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span>

<span class="n">expect</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&lt;</span> <span class="n">bar</span>  <span class="c1"># &lt;=, &gt;, &gt;= も同様</span>
</pre></div>
</div>

<p>のように変えます。<br>
つまり、</p>

<ul>
<li>
<code>==</code>の代わりに<code>eq</code>
</li>
<li>正規表現関係の<code>=~</code>の代わりに<code>match</code>
</li>
<li>配列の<code>=~</code>の代わりに<code>match_array</code>
</li>
</ul>

<p>を使えばいいんですね。</p>

<p>shouldの後に比較演算子<code>&lt;</code>をとる記法の代わりは、<code>be &lt;</code>というように<code>be</code>を入れれば解決します。<br>
<code>should(to) less than</code>より<code>should(to) be less than</code>の方が英語的に正しいので、これはこれでOKですね。</p>

<h3>
<span id="ブロックをとる" class="fragment"></span><a href="#%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%82%92%E3%81%A8%E3%82%8B"><i class="fa fa-link"></i></a>ブロックをとる</h3>

<p>また、このexpect記法だと、ブロックをとることができるので、</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">old_block_expectations.rb</span></div>
<div class="highlight"><pre><span></span><span class="nb">lambda</span> <span class="p">{</span> <span class="n">do_something</span> <span class="p">}</span><span class="o">.</span><span class="n">should</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">SomeError</span><span class="p">)</span>
</pre></div>
</div>

<p>を</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">new_block_expectations.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">expect</span> <span class="p">{</span> <span class="n">something</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">SomeError</span><span class="p">)</span>
</pre></div>
</div>

<p>と書けるので、統一感があっていいですね。</p>

<h2>
<span id="移行が終わったら" class="fragment"></span><a href="#%E7%A7%BB%E8%A1%8C%E3%81%8C%E7%B5%82%E3%82%8F%E3%81%A3%E3%81%9F%E3%82%89"><i class="fa fa-link"></i></a>移行が終わったら</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/initializers/rspec.rb</span></div>
<div class="highlight"><pre><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">expect_with</span> <span class="ss">:rspec</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="n">c</span><span class="o">.</span><span class="n">syntax</span> <span class="o">=</span> <span class="ss">:expect</span>    <span class="c1"># disables `should`</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>とすると、今後shouldを使った書き方ができなくなります。</p>

<p>ちなみにデフォルトでは</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span>    <span class="n">c</span><span class="o">.</span><span class="n">syntax</span> <span class="o">=</span> <span class="o">[</span><span class="ss">:should</span><span class="p">,</span> <span class="ss">:expect</span><span class="o">]</span>  <span class="c1"># enables both `should` and `expect`</span>
</pre></div></div>

<p>と設定したのと同じになっています。</p>

<h2>
<span id="他のシチュエーションの書き方一覧" class="fragment"></span><a href="#%E4%BB%96%E3%81%AE%E3%82%B7%E3%83%81%E3%83%A5%E3%82%A8%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>他のシチュエーションの書き方一覧</h2>

<p>基本的に置き換えは上記の通り行うと済みますが、参照用に<br>
<a href="https://github.com/rspec/rspec-expectations" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/rspec/rspec-expectations</a><br>
に載っている他の書き方をそのまま転載しておきます。</p>

<h3>
<span id="equivalence" class="fragment"></span><a href="#equivalence"><i class="fa fa-link"></i></a>Equivalence</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>  <span class="c1"># passes if actual == expected</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span> <span class="c1"># passes if actual.eql?(expected)</span>
</pre></div></div>

<p>Note: The new <code>expect</code> syntax no longer supports <code>==</code> matcher.</p>

<h3>
<span id="identity" class="fragment"></span><a href="#identity"><i class="fa fa-link"></i></a>Identity</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>    <span class="c1"># passes if actual.equal?(expected)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">equal</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span> <span class="c1"># passes if actual.equal?(expected)</span>
</pre></div></div>

<h3>
<span id="comparisons" class="fragment"></span><a href="#comparisons"><i class="fa fa-link"></i></a>Comparisons</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&gt;</span>  <span class="n">expected</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&gt;=</span> <span class="n">expected</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&lt;=</span> <span class="n">expected</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&lt;</span>  <span class="n">expected</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_within</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
</pre></div></div>

<h3>
<span id="regular-expressions" class="fragment"></span><a href="#regular-expressions"><i class="fa fa-link"></i></a>Regular expressions</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">match</span><span class="p">(</span><span class="sr">/expression/</span><span class="p">)</span>
</pre></div></div>

<p>Note: The new <code>expect</code> syntax no longer supports <code>=~</code> matcher.</p>

<h3>
<span id="typesclasses" class="fragment"></span><a href="#typesclasses"><i class="fa fa-link"></i></a>Types/classes</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_an_instance_of</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_a_kind_of</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
</pre></div></div>

<h3>
<span id="truthiness" class="fragment"></span><a href="#truthiness"><i class="fa fa-link"></i></a>Truthiness</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_true</span>  <span class="c1"># passes if actual is truthy (not nil or false)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_false</span> <span class="c1"># passes if actual is falsy (nil or false)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_nil</span>   <span class="c1"># passes if actual is nil</span>
</pre></div></div>

<h3>
<span id="expecting-errors" class="fragment"></span><a href="#expecting-errors"><i class="fa fa-link"></i></a>Expecting errors</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span>
<span class="n">expect</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ErrorClass</span><span class="p">)</span>
<span class="n">expect</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="s2">"message"</span><span class="p">)</span>
<span class="n">expect</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ErrorClass</span><span class="p">,</span> <span class="s2">"message"</span><span class="p">)</span>
</pre></div></div>

<h3>
<span id="expecting-throws" class="fragment"></span><a href="#expecting-throws"><i class="fa fa-link"></i></a>Expecting throws</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">throw_symbol</span>
<span class="n">expect</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">throw_symbol</span><span class="p">(</span><span class="ss">:symbol</span><span class="p">)</span>
<span class="n">expect</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">throw_symbol</span><span class="p">(</span><span class="ss">:symbol</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">)</span>
</pre></div></div>

<h3>
<span id="yielding" class="fragment"></span><a href="#yielding"><i class="fa fa-link"></i></a>Yielding</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="mi">5</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">yield_control</span> <span class="c1"># passes regardless of yielded args</span>

<span class="n">expect</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="n">yield_if_true</span><span class="p">(</span><span class="kp">true</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">yield_with_no_args</span> <span class="c1"># passes only if no args are yielded</span>

<span class="n">expect</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="mi">5</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">yield_with_args</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">expect</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="mi">5</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">yield_with_args</span><span class="p">(</span><span class="no">Fixnum</span><span class="p">)</span>
<span class="n">expect</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="s2">"a string"</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">yield_with_args</span><span class="p">(</span><span class="sr">/str/</span><span class="p">)</span>

<span class="n">expect</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">each</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">yield_successive_args</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">expect</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="p">{</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:b</span> <span class="o">=&gt;</span> <span class="mi">2</span> <span class="p">}</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">yield_successive_args</span><span class="p">(</span><span class="o">[</span><span class="ss">:a</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="ss">:b</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">)</span>
</pre></div></div>

<h3>
<span id="predicate-matchers" class="fragment"></span><a href="#predicate-matchers"><i class="fa fa-link"></i></a>Predicate matchers</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_xxx</span>         <span class="c1"># passes if actual.xxx?</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_xxx</span><span class="p">(</span><span class="ss">:arg</span><span class="p">)</span> <span class="c1"># passes if actual.has_xxx?(:arg)</span>
</pre></div></div>

<h3>
<span id="ranges-ruby--19-only" class="fragment"></span><a href="#ranges-ruby--19-only"><i class="fa fa-link"></i></a>Ranges (Ruby &gt;= 1.9 only)</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">cover</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div></div>

<h3>
<span id="collection-membership" class="fragment"></span><a href="#collection-membership"><i class="fa fa-link"></i></a>Collection membership</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">start_with</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">end_with</span><span class="p">(</span><span class="n">expected</span><span class="p">)</span>
</pre></div></div>

<h4>
<span id="examples" class="fragment"></span><a href="#examples"><i class="fa fa-link"></i></a>Examples</h4>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">start_with</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">start_with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">end_with</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">end_with</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">expect</span><span class="p">({</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="s1">'b'</span><span class="p">})</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="s1">'b'</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="s2">"this string"</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"is str"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="s2">"this string"</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">start_with</span><span class="p">(</span><span class="s2">"this"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="s2">"this string"</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">end_with</span><span class="p">(</span><span class="s2">"ring"</span><span class="p">)</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>682</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/8ff451ca5f8ae0122be7">Javascriptでオブジェクト指向するときに覚えておくべきこと</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-30 15:59:36</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Javascriptはブラウザのクライアントサイドで動く唯一の言語と言ってもいいので、普段書かなくてもちょいちょい書くことになる。そんな時用に、他の言語使っていると忘れてしまうJavascriptの重要な法則をまとめておく。</p>

<p>基本的にリファレンスにしているのはMozilla Developer Network (MDN)のドキュメントの以下のページ。MDNはJavascript関連では一番ちゃんとしたドキュメントだと信じている。</p>

<ul>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Working_with_Objects" rel="nofollow noopener" target="_blank">Working with Objects - MDN</a></li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Inheritance_and_the_prototype_chain" rel="nofollow noopener" target="_blank">継承とプロトタイプチェーン - MDN</a></li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/this" rel="nofollow noopener" target="_blank">this - MDN</a></li>
<li><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Details_of_the_Object_Model" rel="nofollow noopener" target="_blank">オブジェクトモデルの詳細 - MDN</a></li>
</ul>

<h2>
<span id="プロトタイプベース言語" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%83%88%E3%82%BF%E3%82%A4%E3%83%97%E3%83%99%E3%83%BC%E3%82%B9%E8%A8%80%E8%AA%9E"><i class="fa fa-link"></i></a>プロトタイプベース言語</h2>

<p>Javascriptはプロトタイプベースのオブジェクト指向言語で、クラスベースのオブジェクト指向言語(例: C++, Java)とは異なる部分が多々ある。<br>
例えば、クラスベース言語はクラスとインスタンスという概念があるのに対し、プロトタイプベース言語はPrototypical Objectというオブジェクトがあるだけ。</p>

<blockquote>
<p>表8.1 クラスベース (Java) のオブジェクトシステムとプロトタイプベース (JavaScript) のオブジェクトシステムとの比較</p>

<table>
<thead>
<tr>
<th style="text-align: left">クラスベース (Java)</th>
<th style="text-align: left">プロトタイプベース (JavaScript)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">クラスとインスタンスは異なる実体です 。</td>
<td style="text-align: left">すべてのオブジェクトはインスタンスです。</td>
</tr>
<tr>
<td style="text-align: left">クラス定義を用いてクラスを定義します。また、コンストラクタメソッドを用いてクラスをインスタンス化します。</td>
<td style="text-align: left">コンストラクタ関数を用いてオブジェクトのセットを定義および作成します。</td>
</tr>
<tr>
<td style="text-align: left">new 演算子を用いて単一のオブジェクトを作成します。</td>
<td style="text-align: left">同じです。</td>
</tr>
<tr>
<td style="text-align: left">既存のクラスのサブクラスを定義するクラス定義を用いて、オブジェクト階層を構築します。</td>
<td style="text-align: left">コンストラクタ関数に結びつけられたプロトタイプとしてオブジェクトを割り当てることで、オブジェクト階層を構築します。</td>
</tr>
<tr>
<td style="text-align: left">クラスチェーンに従ってプロパティを継承します。</td>
<td style="text-align: left">プロトタイプチェーンに従ってプロパティを継承します。</td>
</tr>
<tr>
<td style="text-align: left">クラス定義が、クラスの全インスタンスの全プロパティを定義します。実行時に動的にプロパティを追加することはできません。</td>
<td style="text-align: left">コンストラクタ関数またはプロトタイプがプロパティの初期セットを指定します。個々のオブジェクトやオブジェクトのセット全体へ動的にプロパティを追加したり、それらからプロパティを削除したりできます。</td>
</tr>
</tbody>
</table>

<p><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Details_of_the_Object_Model" rel="nofollow noopener" target="_blank">クラスベース言語とプロトタイプベース言語 - オブジェクトモデルの詳細 - MDN</a></p>
</blockquote>

<h2>
<span id="全てはオブジェクト" class="fragment"></span><a href="#%E5%85%A8%E3%81%A6%E3%81%AF%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a>全てはオブジェクト</h2>

<p>Javascriptで全てはオブジェクトで、クラスベース言語でいうところのインスタンスのみだと思えば良い。</p>

<blockquote>
<p>JavaScript では、ほぼあらゆるものがオブジェクトです。<br>
null と undefined 以外のすべてのプリミティブ型はオブジェクトとして扱われます。<br>
 <a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Working_with_Objects/#Object_everything" rel="nofollow noopener" target="_blank">すべてはオブジェクト - Working with Objects - MDN</a></p>
</blockquote>

<h2>
<span id="オブジェクトはプロパティを持つ" class="fragment"></span><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AF%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%82%92%E6%8C%81%E3%81%A4"><i class="fa fa-link"></i></a>オブジェクトはプロパティを持つ</h2>

<p>オブジェクトは、変数や関数をプロパティとして持つことができる。</p>

<blockquote>
<p>JavaScript のオブジェクトは、自身に関連付けられたプロパティを持ちます。オブジェクトのプロパティは、オブジェクトに関連付けられている変数と捉える事ができます。オブジェクトのプロパティは基本的に、オブジェクトに属するものという点を除いて通常の JavaScript 変数と同じようなものです。<br>
<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Working_with_Objects#Objects_and_properties" rel="nofollow noopener" target="_blank">オブジェクトとそのプロパティ - Working with Objects -  MDN</a></p>
</blockquote>

<h2>
<span id="オブジェクトの実装は結局hashmap連想配列" class="fragment"></span><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E5%AE%9F%E8%A3%85%E3%81%AF%E7%B5%90%E5%B1%80hashmap%E9%80%A3%E6%83%B3%E9%85%8D%E5%88%97"><i class="fa fa-link"></i></a>オブジェクトの実装は、結局、HashMap（連想配列）</h2>

<p>オブジェクトはHashMapなので、簡単な例としては、プロパティを配列の要素アクセスのように呼び出せる。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="s2">"hoge"</span><span class="p">.</span><span class="nx">length</span>
<span class="mi">4</span>
<span class="o">&gt;</span> <span class="s2">"hoge"</span><span class="p">[</span><span class="s1">'length'</span><span class="p">]</span>
<span class="mi">4</span>
</pre></div></div>

<blockquote>
<p>JavaScript オブジェクトのプロパティは、ブラケット表記法でもアクセスや設定ができます。オブジェクトは連想配列と呼ばれることがあります。<br>
<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Working_with_Objects#Objects_and_properties" rel="nofollow noopener" target="_blank">オブジェクトとそのプロパティ - Working with Objects -  MDN</a></p>
</blockquote>

<p>例えば、オブジェクトの宣言方法は、オブジェクト初期化子などと言われているが、結局よくあるHashMapの宣言と同じ。</p>

<blockquote>
<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">myHonda</span> <span class="o">=</span> <span class="p">{</span><span class="nx">color</span><span class="o">:</span> <span class="s2">"red"</span><span class="p">,</span> <span class="nx">wheels</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">engine</span><span class="o">:</span> <span class="p">{</span><span class="nx">cylinders</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">size</span><span class="o">:</span> <span class="mf">2.2</span><span class="p">}};</span>
</pre></div></div>

<p><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Working_with_Objects#Using_object_initializers" rel="nofollow noopener" target="_blank">オブジェクト初期化子の利用 - Working with Objects - MDN</a></p>
</blockquote>

<h2>
<span id="メソッドと関数" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%A8%E9%96%A2%E6%95%B0"><i class="fa fa-link"></i></a>メソッドと関数</h2>

<p>オブジェクトのプロパティになっている関数がメソッド。</p>

<blockquote>
<p>メソッドはオブジェクトに関連付けられた関数です。簡単に言えば、オブジェクトのプロパティのうち関数であるものがメソッドです。<br>
<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Working_with_Objects#Defining_methods" rel="nofollow noopener" target="_blank">メソッドの定義 - Working with Objects -  MDN</a></p>
</blockquote>

<p>ただし、メソッドはオブジェクトから参照されているだけで束縛されているわけではない。<br>
よって、オブジェクトのプロパティとして宣言された関数（つまりメソッド）を、グローバルな環境で使えば通常の関数として振る舞う。</p>

<blockquote>
<p>this は関数に「渡される」のであって、関数に固定されている訳ではありません。言い換えると、メソッドはそれをメソッドとして持つオブジェクトに束縛されているのではなく、オブジェクトによって参照されているだけです。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">Car</span><span class="p">(</span><span class="nx">brand</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">this</span><span class="p">.</span><span class="nx">brand</span> <span class="o">=</span> <span class="nx">brand</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">Car</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getBrand</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">brand</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Car</span><span class="p">(</span><span class="s2">"toyota"</span><span class="p">);</span>
<span class="nx">println</span><span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">getBrand</span><span class="p">());</span>  <span class="c1">// "toyota"</span>
<span class="kd">var</span> <span class="nx">brand</span> <span class="o">=</span> <span class="s2">"not a car"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">getBrand</span><span class="p">;</span>
<span class="nx">println</span><span class="p">(</span><span class="nx">bar</span><span class="p">());</span>  <span class="c1">// "not a car"</span>
</pre></div></div>

<p><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/this#.E3.83.A1.E3.82.BD.E3.83.83.E3.83.89.E3.81.AE.E6.9D.9F.E7.B8.9B" rel="nofollow noopener" target="_blank">メソッドの束縛 - this - MDN</a></p>
</blockquote>

<h2>
<span id="コンストラクタと関数" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E3%81%A8%E9%96%A2%E6%95%B0"><i class="fa fa-link"></i></a>コンストラクタと関数</h2>

<p>どの関数でもコンストラクタとして使用でき、new演算子とともに使用することでオブジェクトを作成する。</p>

<blockquote>
<p>どの JavaScript 関数もコンストラクタとして使用できます。new 演算子をコンストラクタ関数とともに使用することで、新しいオブジェクトを作成します。<br>
<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Details_of_the_Object_Model#Defining_a_class" rel="nofollow noopener" target="_blank">クラスの定義 - オブジェクトモデルの詳細 - MDN</a></p>
</blockquote>

<p>なお、慣習として、コンストラクタとして使う関数は、通常の関数と区別するため、大文字で始める。</p>

<h2>
<span id="継承とプロトタイプチェーン" class="fragment"></span><a href="#%E7%B6%99%E6%89%BF%E3%81%A8%E3%83%97%E3%83%AD%E3%83%88%E3%82%BF%E3%82%A4%E3%83%97%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>継承とプロトタイプチェーン</h2>

<p>クラスの継承はプロトタイプチェーンという概念によって実現される。</p>

<blockquote>
<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="c1">// Object.prototype のプロトタイプは null です。</span>
<span class="c1">// o ---&gt; Object.prototype ---&gt; null</span>
<span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">};</span>

<span class="c1">// 配列は Array.prototype（indexOf、forEachなどのようなメソッドを持っている）から継承します。 </span>
<span class="c1">// a ---&gt; Array.prototype ---&gt; Object.prototype ---&gt; null</span>
<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"yo"</span><span class="p">,</span> <span class="s2">"whadup"</span><span class="p">,</span> <span class="s2">"?"</span><span class="p">];</span>

<span class="c1">// 関数は Function.prototype（call、bindなどのようなメソッドを持つ）から継承します。</span>
<span class="c1">// f ---&gt; Function.prototype ---&gt; Object.prototype ---&gt; null</span>
<span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Inheritance_and_the_prototype_chain" rel="nofollow noopener" target="_blank">継承とプロトタイプチェーン - MDN</a></p>
</blockquote>

<h2>
<span id="this-について" class="fragment"></span><a href="#this-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>this について</h2>

<p>プロトタイプベースだということで、問題になりやすいのがthisが何を指すか。<br>
Qiita上でお二方が、thisは4種類あるよと書いてくれている。それぞれ比較するとわかりやすかった。</p>

<ul>
<li><a href="http://qiita.com/Haru39/items/9935ce476a17d6258e27" id="reference-6a94fb63dfa78053b934">JavaScriptの「this」は「4種類」？？ by Haru39</a></li>
<li><a href="http://qiita.com/vvakame/items/74005adacc0e8e2a3cab" id="reference-864c48773dd272448d97">JavaScriptのthisの覚え方 by vvakame</a></li>
</ul>

<p>完全におんなじことを書いているわけではないが、だいたい同じことを書いている。せっかくなので対応表を書いておく。</p>

<table>
<thead>
<tr>
<th style="text-align: center">Haru39流</th>
<th style="text-align: center">vvakame流</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">メソッド呼び出しパターン</td>
<td style="text-align: center">何かに所属している時のthis</td>
</tr>
<tr>
<td style="text-align: center">関数呼び出しパターン</td>
<td style="text-align: center">トップレベルのthis</td>
</tr>
<tr>
<td style="text-align: center">コンストラクタ呼び出しパターン</td>
<td style="text-align: center">コンストラクタ内のthis</td>
</tr>
<tr>
<td style="text-align: center">apply,call呼び出しパターン</td>
<td style="text-align: center">function#apply とか function#call とかで無理矢理変えられた時のthis</td>
</tr>
</tbody>
</table>

<p>このあと、<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/this" rel="nofollow noopener" target="_blank">MDNのthisの説明</a>も読むといいかも。</p>

<ul>
<li>apply, callの時(4つ目)は明示的にObject、</li>
<li>メソッドの時(1つ目)は暗黙的にObjectを指して、</li>
<li>それ以外(2つ目)はグローバルオブジェクトになる。</li>
<li>newを使ったコンストラクタのthis(3つ目)については触れられてない
(thisではなく<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/new" rel="nofollow noopener" target="_blank">newの説明</a>に書いてある)。</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>399</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/5fad0c454ddc7b478ff1">GitでMerge CommitをRevertする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-27 17:28:32</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>何個もCommitがあるような一つのPull Requestを全てRevertしたいようなときに使えます。</p>

<h2>
<span id="そもそもrevertとは" class="fragment"></span><a href="#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82revert%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>そもそもRevertとは</h2>

<p>あるコミットを打ち消すような、全く逆のコミットを作ることです。<br>
追加した部分を削除して、削除した部分を追加して、変更した部分を変更前の状態にするコミットを作成します。</p>

<p>取り消したいコミットがあるのだけれど、既にリモートにコミットしてしまって、<code>git reset</code>, <code>git rebase -i</code>, <code>git reflog</code>などを使っての取り消しが不可能なときに使います。</p>

<h2>
<span id="通常のrevert" class="fragment"></span><a href="#%E9%80%9A%E5%B8%B8%E3%81%AErevert"><i class="fa fa-link"></i></a>通常のRevert</h2>

<p>普通のcommitなら、revertは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git revert f60f24d
</pre></div></div>

<p>てな感じで、revertしたいcommit(今回は<code>f60f24d</code>)を指定すれば、実現出来ます。</p>

<h2>
<span id="merge-commitの場合" class="fragment"></span><a href="#merge-commit%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Merge Commitの場合</h2>

<p>ただ、もし<code>f60f24d</code>がMerge Commitだった場合</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git revert f60f24d
fatal: Commit f60f24d34845fba4e038b3e165f74973b3a19580 is a merge but no -m option was given.
</pre></div></div>

<p>というエラーメッセージが出ます。</p>

<p>これを解決するには</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git revert -m 1 f60f24d
</pre></div></div>

<p>という風に<code>-m 1</code>と付けるだけです。</p>

<h2>
<span id="念のため確認" class="fragment"></span><a href="#%E5%BF%B5%E3%81%AE%E3%81%9F%E3%82%81%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>念のため確認</h2>

<p>念のため、ちゃんと目的のものがrevertされているか確認しましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git show
</pre></div></div>

<p>あれ、思っている方と違う方がRevertコミットされている！だめじゃん！！と思ったら、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git reset --hard HEAD~
</pre></div></div>

<p>で元の状態に戻して、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git revert -m 2 f60f24d
</pre></div></div>

<p>という風に<code>-m 2</code>に変えて試してみましょう。</p>

<h2>
<span id="ちょっと解説" class="fragment"></span><a href="#%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>ちょっと解説</h2>

<p>ちなみにこの<code>-m</code>は<code>--mainline</code>の略で<code>parent-number</code>を指定します。</p>

<p>この<code>parent-number</code>には基本的に1か2を指定すれば良く、<code>git show</code>をした時に</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git show f60f24d                              
commit f60f24d34845fba4e038b3e165f74973b3a19580
Merge: 049d32b ebbcb6a
...
</pre></div></div>

<p>と出たとしたら、1は<code>049d32b</code>, 2は<code>ebbcb6a</code>を指します。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<ul>
<li><a href="http://git-scm.com/docs/git-revert" class="autolink" rel="nofollow noopener" target="_blank">http://git-scm.com/docs/git-revert</a></li>
<li><a href="http://schacon.github.com/git/howto/revert-a-faulty-merge.txt" class="autolink" rel="nofollow noopener" target="_blank">http://schacon.github.com/git/howto/revert-a-faulty-merge.txt</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>375</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/e204fd483ff7508bcf8d">Ruby力を一段アップするために読んだほうが良い公式ドキュメント集</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-04 23:34:20</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Rubyの言語仕様で重要なものをピックアップ。</p>

<h2>
<span id="class" class="fragment"></span><a href="#class"><i class="fa fa-link"></i></a>Class</h2>

<p><a href="http://www.ruby-doc.org/core-1.9.3/Class.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Class.html</a></p>

<p>RubyではClassはClassオブジェクトとして定義されている。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">methods</span></div>
<div class="highlight"><pre><span></span>::new #allocate #inherited #new #superclass
</pre></div>
</div>

<p>インスタンス化に関係する</p>

<blockquote>
<p>::new, #new, #allocate</p>
</blockquote>

<p>と継承に関係する</p>

<blockquote>
<p>#superclass, #inhereted</p>
</blockquote>

<p>しか定義されていない。</p>

<p>その他のメソッドはすべてスーパークラスであるModuleに定義されている。Classはインスタンス化できるModuleと考えれば良い。</p>

<h3>
<span id="superclassの関係" class="fragment"></span><a href="#superclass%E3%81%AE%E9%96%A2%E4%BF%82"><i class="fa fa-link"></i></a>SuperClassの関係</h3>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="o">[</span><span class="m">1</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Class.superclass
<span class="o">=</span>&gt; Module
<span class="o">[</span><span class="m">2</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Module.superclass
<span class="o">=</span>&gt; Object
<span class="o">[</span><span class="m">3</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Object.superclass
<span class="o">=</span>&gt; BasicObject
<span class="o">[</span><span class="m">4</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; BasicObject.superclass
<span class="o">=</span>&gt; nil
<span class="o">[</span><span class="m">5</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; nil.superclass
NoMethodError: undefined method <span class="sb">`</span>superclass<span class="err">'</span> <span class="k">for</span> nil:NilClass
<span class="o">[</span><span class="m">6</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; NilClass.superclass
<span class="o">=</span>&gt; Object
</pre></div></div>

<h3>
<span id="classの関係" class="fragment"></span><a href="#class%E3%81%AE%E9%96%A2%E4%BF%82"><i class="fa fa-link"></i></a>Classの関係</h3>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="o">[</span><span class="m">1</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Class.class
<span class="o">=</span>&gt; Class
<span class="o">[</span><span class="m">2</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Module.class
<span class="o">=</span>&gt; Class
<span class="o">[</span><span class="m">3</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Object.class
<span class="o">=</span>&gt; Class
<span class="o">[</span><span class="m">4</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; BasicObject.class
<span class="o">=</span>&gt; Class
<span class="o">[</span><span class="m">5</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; nil.class
<span class="o">=</span>&gt; NilClass
<span class="o">[</span><span class="m">6</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; NilClass.class
<span class="o">=</span>&gt; Class
</pre></div></div>

<h3>
<span id="moduleも含めた祖先" class="fragment"></span><a href="#module%E3%82%82%E5%90%AB%E3%82%81%E3%81%9F%E7%A5%96%E5%85%88"><i class="fa fa-link"></i></a>Moduleも含めた祖先</h3>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="o">[</span><span class="m">1</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; Class.ancestors
<span class="o">=</span>&gt; <span class="o">[</span>Class, Module, Object, PP::ObjectMixin, Kernel, BasicObject<span class="o">]</span>
</pre></div></div>

<p>ここで、<code>PP::ObjectMixin</code>は<code>pry</code>が出力の整形用に勝手に突っ込んだもの。通常は入っていない。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>irb<span class="o">(</span>main<span class="o">)</span>:001:0&gt; Class.ancestors
<span class="o">=</span>&gt; <span class="o">[</span>Class, Module, Object, Kernel, BasicObject<span class="o">]</span>
</pre></div></div>

<h2>
<span id="module" class="fragment"></span><a href="#module"><i class="fa fa-link"></i></a>Module</h2>

<p><a href="http://www.ruby-doc.org/core-1.9.3/Module.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Module.html</a></p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">methods</span></div>
<div class="highlight"><pre><span></span>::constants ::nesting ::new #&lt; #&lt;= #&lt;=&gt; #== #=== #&gt; #&gt;= #alias_method #ancestors #append_features #attr #attr_accessor #attr_reader #attr_writer #autoload #autoload? #class_eval #class_exec #class_variable_defined? #class_variable_get #class_variable_set #class_variables #const_defined? #const_get #const_missing #const_set #constants #define_method #extend_object #extended #freeze #include #include? #included #included_modules #instance_method #instance_methods #method_added #method_defined? #method_removed #method_undefined #module_eval #module_exec #module_function #name #private #private_class_method #private_instance_methods #private_method_defined? #protected #protected_instance_methods #protected_method_defined? #public #public_class_method #public_instance_method #public_instance_methods #public_method_defined? #remove_class_variable #remove_const #remove_method #to_s #undef_method
</pre></div>
</div>

<p>基本機能</p>

<ul>
<li>比較関係</li>
</ul>

<blockquote>
<p>#&lt; #&lt;= #&lt;=&gt; #== #=== #&gt; #&gt;= </p>
</blockquote>

<ul>
<li>文字列化</li>
</ul>

<blockquote>
<p>#name #to_s</p>
</blockquote>

<ul>
<li>freeze</li>
</ul>

<blockquote>
<p>#freeze</p>
</blockquote>

<p>Constants関係</p>

<blockquote>
<p>::constants ::nesting #const_defined? #const_get #const_missing #const_set #constants #remove_const</p>
</blockquote>

<p>Module機能</p>

<blockquote>
<p>::new　#ancestors</p>
</blockquote>

<ul>
<li>autoload</li>
</ul>

<blockquote>
<p>#autoload #autoload?</p>
</blockquote>

<ul>
<li>include</li>
</ul>

<blockquote>
<p>#append_features #include #include? #included #included_modules</p>
</blockquote>

<ul>
<li>extend</li>
</ul>

<blockquote>
<p>#extend_object #extended</p>
</blockquote>

<p>Class関係</p>

<ul>
<li>class_variables (<code>@@foo</code> etc.)</li>
</ul>

<blockquote>
<p>#class_variable_defined? #class_variable_get #class_variable_set #class_variables #remove_class_variable</p>
</blockquote>

<ul>
<li>methods</li>
</ul>

<blockquote>
<p>#alias_method #define_method #method_added #method_defined? #method_removed #method_undefined #remove_method #undef_method</p>

<p>#instance_methods</p>

<p>#module_function</p>
</blockquote>

<ul>
<li>attr</li>
</ul>

<blockquote>
<p>#attr #attr_accessor #attr_reader #attr_writer</p>
</blockquote>

<ul>
<li>eval, exec</li>
</ul>

<blockquote>
<p>#class_eval #class_exec #module_eval #module_exec</p>
</blockquote>

<p>private,protected,publicのスコープ概念の導入</p>

<blockquote>
<p>#private #private_class_method #private_instance_methods #private_method_defined?</p>

<p>#protected #protected_instance_methods #protected_method_defined?</p>

<p>#public #public_class_method #public_instance_method #public_instance_methods #public_method_defined?</p>
</blockquote>

<h2>
<span id="object" class="fragment"></span><a href="#object"><i class="fa fa-link"></i></a>Object</h2>

<p><a href="http://www.ruby-doc.org/core-1.9.3/Object.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Object.html</a></p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">methods</span></div>
<div class="highlight"><pre><span></span>#!~ #&lt;=&gt; #=== #=~ #class #clone #define_singleton_method #display #dup #enum_for #eql? #extend #freeze #frozen? #hash #inspect #instance_of? #instance_variable_defined? #instance_variable_get #instance_variable_set #instance_variables #is_a? #kind_of? #method #nil? #object_id #public_method #public_send #remove_instance_variable #respond_to? #respond_to_missing? #send #singleton_class #singleton_methods #taint #tainted? #tap #to_enum #to_s #trust #untaint #untrust #untrusted?
</pre></div>
</div>

<p>基本機能</p>

<ul>
<li>比較関係</li>
</ul>

<blockquote>
<p>#!~ #&lt;=&gt; #=== #=~ #eql? #nil?</p>
</blockquote>

<ul>
<li>文字列化</li>
</ul>

<blockquote>
<p>#to_s #inspect</p>
</blockquote>

<ul>
<li>Enum関係</li>
</ul>

<blockquote>
<p>#enum_for #to_enum #tap</p>
</blockquote>

<ul>
<li>copy</li>
</ul>

<blockquote>
<p>#clone #dup</p>
</blockquote>

<ul>
<li>Hash値, Object値</li>
</ul>

<blockquote>
<p>#hash #object_id</p>
</blockquote>

<ul>
<li>display</li>
</ul>

<blockquote>
<p>#display</p>
</blockquote>

<ul>
<li>freeze</li>
</ul>

<blockquote>
<p>#freeze #frozen?</p>
</blockquote>

<ul>
<li>マーク付け</li>
</ul>

<blockquote>
<p>#taint #tainted? #untaint<br>
 #trust  #untrust #untrusted?</p>
</blockquote>

<p>Instance機能</p>

<ul>
<li>classとの関係性チェック</li>
</ul>

<blockquote>
<p>#instance_of? #is_a? #kind_of? #class</p>
</blockquote>

<ul>
<li>instance_valiable (<code>@foo</code> etc.)</li>
</ul>

<blockquote>
<p>#instance_variable_defined? #instance_variable_get #instance_variable_set #instance_variables #remove_instance_variable</p>
</blockquote>

<ul>
<li>method check</li>
</ul>

<blockquote>
<p>#method #public_method<br>
 #respond_to? #respond_to_missing?</p>
</blockquote>

<ul>
<li>method call</li>
</ul>

<blockquote>
<p>#send #public_send</p>
</blockquote>

<ul>
<li>extend</li>
</ul>

<blockquote>
<p>#extend</p>
</blockquote>

<ul>
<li>singleton_method、singleton_class</li>
</ul>

<blockquote>
<p>#define_singleton_method #singleton_class #singleton_methods</p>
</blockquote>

<p>これは日本語では特異メソッド、特異クラスと呼ばれている。これの解説は以下がわかり易かった。<br>
<a href="http://blog.livedoor.jp/sasata299/archives/51497378.html" rel="nofollow noopener" target="_blank">結局、Rubyの特異メソッドって何なの？ - (ﾟ∀ﾟ)o彡 sasata299's blog</a><br>
これを読めば、<code>class &lt;&lt; self</code>とかの意味もわかるはず！</p>

<h2>
<span id="basicobject" class="fragment"></span><a href="#basicobject"><i class="fa fa-link"></i></a>BasicObject</h2>

<p><a href="http://www.ruby-doc.org/core-1.9.3/BasicObject.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/BasicObject.html</a></p>

<p>すべてオブジェクトで共通で使える、Objectの親に当たるクラス。Kernelモジュールがincludeされていないのが特徴。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">methods</span></div>
<div class="highlight"><pre><span></span>::new #! #!= #== #__id__ #__send__ #equal? #instance_eval #instance_exec #method_missing #singleton_method_added #singleton_method_removed #singleton_method_undefined
</pre></div>
</div>

<ul>
<li>比較関係</li>
</ul>

<blockquote>
<p>#! #!= #== #equal? </p>
</blockquote>

<ul>
<li>eval, exec</li>
</ul>

<blockquote>
<p>#instance_eval #instance_exec</p>
</blockquote>

<ul>
<li>method_missing</li>
</ul>

<blockquote>
<p>#method_missing</p>
</blockquote>

<ul>
<li>singleton_methodのチェック関係</li>
</ul>

<blockquote>
<p>#singleton_method_added #singleton_method_removed #singleton_method_undefined</p>
</blockquote>

<ul>
<li>その他</li>
</ul>

<blockquote>
<p>#  ::new <code>#__id__</code> <code>#__send__</code></p>
</blockquote>

<h2>
<span id="kernel" class="fragment"></span><a href="#kernel"><i class="fa fa-link"></i></a>Kernel</h2>

<p><a href="http://www.ruby-doc.org/core-1.9.3/Kernel.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Kernel.html</a></p>

<p>open, system, eval, exit, raise, putsなどのprint系関数, Array, Integer, Stringなどのキャストのような関数など、一般的な言語でメソッドではなく関数として定義されているような、基本的な動作が定義されているモジュール。</p>

<p>ここに定義されているすべてのメソッドは一度見ておくと良さそう。</p>

<h2>
<span id="procmethod" class="fragment"></span><a href="#procmethod"><i class="fa fa-link"></i></a>Proc/Method</h2>

<p><a href="http://www.ruby-doc.org/core-1.9.3/Proc.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Proc.html</a><br>
<a href="http://www.ruby-doc.org/core-1.9.3/Method.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Method.html</a></p>

<p><code>binding</code>(束縛変数)を持つProcと、<code>receiver</code>を持つMethod。Blockを使う時なんかにも必要なので、理解しておくと良い。<br>
Proc/Method, block/proc/lambdaの違いについては以下がわかり易かった。<br>
<a href="http://d.hatena.ne.jp/vividcode/20100813/1281709854" rel="nofollow noopener" target="_blank">Ruby の Proc オブジェクトと Method オブジェクトの違い (proc, lambda, ブロック, メソッドについて) - vivid memo</a></p>

<h2>
<span id="その他基本型" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E5%9F%BA%E6%9C%AC%E5%9E%8B"><i class="fa fa-link"></i></a>その他、基本型</h2>

<p>String/Symbol</p>

<ul>
<li><a href="http://www.ruby-doc.org/core-1.9.3/String.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/String.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Symbol.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Symbol.html</a></li>
</ul>

<p>Number/Math</p>

<ul>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Fixnum.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Fixnum.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Bignum.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Bignum.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Integer.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Integer.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Float.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Float.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Rational.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Rational.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Complex.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Complex.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Numeric.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Numeric.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Math.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Math.html</a></li>
</ul>

<p>Boolean</p>

<ul>
<li><a href="http://www.ruby-doc.org/core-1.9.3/TrueClass.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/TrueClass.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/FalseClass.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/FalseClass.html</a></li>
</ul>

<p>集合関係</p>

<ul>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Enumerable.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Enumerable.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Range.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Range.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Array.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Array.html</a></li>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Hash.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Hash.html</a></li>
<li><a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/set/rdoc/Set.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/stdlib-1.9.3/libdoc/set/rdoc/Set.html</a></li>
</ul>

<p>Time/Date</p>

<ul>
<li><a href="http://www.ruby-doc.org/core-1.9.3/Time.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/core-1.9.3/Time.html</a></li>
<li><a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/date/rdoc/Date.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/stdlib-1.9.3/libdoc/date/rdoc/Date.html</a></li>
<li><a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/date/rdoc/DateTime.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.ruby-doc.org/stdlib-1.9.3/libdoc/date/rdoc/DateTime.html</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>255</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/5745938c192ca1139c63">セマンティック・バージョニングと、Gemfileのバージョン指定方法 - Gemfileでよく見る`~&gt;`を使いこなす</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-03 02:21:32</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ライブラリを使う時、バージョンが合わなくてうまく動かないという問題は、<code>Ruby</code>に限らず、どのプログラミング言語でも常に悩みの種である。特にDepedencyの多いライブラリをインストール/インクルードするときは、大体この問題で躓く。<code>C++</code>とかでGUI関係のライブラリを入れるときは何度も挫折したし、特に、進化が速く変更の多い<code>Perl</code>,<code>PHP</code>をはじめとしたスクリプト言語では普通にそういう問題に出くわす。</p>

<p>もちろん<code>Ruby</code>もその例外ではないのだが、より個人がライブラリ(gem)を作って、githubなどに上げ、公開していくという文化がある割に、あまりこの問題に悩まされないので、<code>Ruby(on Rails)</code>は比較的うまくやっていると思う。</p>

<p>これは、<code>Bundler</code>というツール自体の功績でもあるけれど、ライブラリを作る個人個人が、ちゃんと一定の規則に従ってバージョン付けして、依存関係を正しく<code>Gemfile</code>に書くという文化によるものが大きいと思う。なので、<code>Bundler</code>を支える文化のセマンティック・バージョニングと、<code>Gemfile</code>の書き方について紹介しようと思う。</p>

<p>今回は、AdventCalendarということで、あんまりRubyを使わない人にも参考になるテーマで書いてみたつもり。<br>
他言語プログラマでも、特に、自分でライブラリを作ってみようかなと思っている人は絶対に知っておくべき。</p>

<h2>
<span id="semantic-versioningバージョン付けの規則" class="fragment"></span><a href="#semantic-versioning%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E4%BB%98%E3%81%91%E3%81%AE%E8%A6%8F%E5%89%87"><i class="fa fa-link"></i></a>Semantic Versioning　(バージョン付けの規則)</h2>

<p>バージョンには付け方があり、基本的にはこの法則に従うべきというガイドラインが存在する。<br>
ちゃんと意味のあるバージョン付けをしましょうということなのだが、それが、Semantic Versioningという名前で以下のURLで公開されている。<br>
<a href="http://semver.org/" class="autolink" rel="nofollow noopener" target="_blank">http://semver.org/</a><br>
<a href="http://shijimiii.info/technical-memo/semver/" class="autolink" rel="nofollow noopener" target="_blank">http://shijimiii.info/technical-memo/semver/</a> (日本語訳)</p>

<p>ここでは、<code>3.2.8</code>のように、バージョンを常に3つの数字を<code>.</code>で区切った方法(<code>X.Y.Z</code>形式)で、指定する方法のみ説明する。なお、上のURLには<code>1.0.0-alpha.1</code>や<code>1.3.7+build.11.e0f985a</code>などのより細かい規則も載っている。</p>

<h3>
<span id="semantic-versioningの大原則" class="fragment"></span><a href="#semantic-versioning%E3%81%AE%E5%A4%A7%E5%8E%9F%E5%89%87"><i class="fa fa-link"></i></a>Semantic Versioningの大原則</h3>

<p>まず、大原則として以下のルールに則る。</p>

<blockquote>
<p><em>公開APIを定め、それを基にバージョンを付ける。</em></p>
</blockquote>

<h3>
<span id="semantic-versioningの詳細ルール" class="fragment"></span><a href="#semantic-versioning%E3%81%AE%E8%A9%B3%E7%B4%B0%E3%83%AB%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Semantic Versioningの詳細ルール</h3>

<p>あとは、3桁それぞれに意味を持たせ、以下のルールに従ってバージョン付けする。</p>

<ul>
<li>すべての公開される変更でバージョンを上げる</li>
<li>3つの数字<code>X.Y.Z</code>の意味はそれぞれ<code>Major.Minor.Patch</code>
</li>
<li>
<code>Major</code>をあげるときは後方互換のない変更

<ul>
<li> 新しいAPIの公開など</li>
</ul>
</li>
<li>
<code>Minor</code>をあげるときは後方互換のある変更

<ul>
<li>APIの追加、サポートを外そうとしているAPIに警告を出すなど</li>
</ul>
</li>
<li>
<code>Patch</code>をあげるときはバグ修正

<ul>
<li>バグ修正の定義は、正しくない挙動を直すこと</li>
</ul>
</li>
<li>安定した公式APIが定まるまでは、<code>0.y.z</code>形式にしておき、この状況では例外的にいつAPIを変えても良い</li>
</ul>

<p>ちなみにバージョンは少数ではないので、<code>1.10</code>と<code>1.9</code>は<code>1.10</code>の方が新しいバージョンである。</p>

<h3>
<span id="具体例" class="fragment"></span><a href="#%E5%85%B7%E4%BD%93%E4%BE%8B"><i class="fa fa-link"></i></a>具体例</h3>

<p>バージョン付けの例としては、以下のような流れになる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>0.0.1  # Initial Version
0.0.2
0.1.0  # 0.0.2と比べて機能が大きく変わった。

1.0.0  # 多分Stableであろう、公式APIを定めた！

1.0.1
1.0.2
1.0.3
…
1.0.9
1.0.10
1.0.11
…
1.0.17  # バグだらけでいろいろ修正

1.1.0   # 追加APIを導入。ついでにバグも修正(Minorをあげるのと同時にバグ修正してもOK)

2.0.0   # 過去のしがらみを断ち切り、リニューアルしたAPIを公開
</pre></div></div>

<h2>
<span id="gemfileでのversion指定の仕方" class="fragment"></span><a href="#gemfile%E3%81%A7%E3%81%AEversion%E6%8C%87%E5%AE%9A%E3%81%AE%E4%BB%95%E6%96%B9"><i class="fa fa-link"></i></a>GemfileでのVersion指定の仕方</h2>

<p>例えば<code>hoge</code>という名前のgemがあったとする</p>

<h3>
<span id="安全に今のバージョンのみ使いたい場合" class="fragment"></span><a href="#%E5%AE%89%E5%85%A8%E3%81%AB%E4%BB%8A%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%AE%E3%81%BF%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>安全に今のバージョンのみ使いたい場合</h3>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s2">"hoge"</span><span class="p">,</span> <span class="s2">"2.1.8"</span>  <span class="c1"># 2.1.8のみ使う</span>
</pre></div>
</div>

<h3>
<span id="今後のバグ修正のみ受け入れたい場合" class="fragment"></span><a href="#%E4%BB%8A%E5%BE%8C%E3%81%AE%E3%83%90%E3%82%B0%E4%BF%AE%E6%AD%A3%E3%81%AE%E3%81%BF%E5%8F%97%E3%81%91%E5%85%A5%E3%82%8C%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>今後のバグ修正のみ受け入れたい場合</h3>

<p>基本は、後方互換のある修正はすべて受け入れればよいので数字を2つだけ書いて指定する。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s2">"hoge"</span><span class="p">,</span> <span class="s2">"~&gt; 2.1"</span>  <span class="c1"># 2.1.0以上3.0.0未満の最新のものを使用</span>
</pre></div>
</div>

<p>例えば<code>devise</code>などの大き目のgemだったり、なんだかんだでバグ修正以外の機能追加が入ると動かなくなりそうというようなものは数字３つで指定しておく。ちゃんとガイドラインにしたがって運用されていて、公開APIが変わってなくても、推奨されるディレクトリ構成だったり、設定の仕方だったりが変わるというのもありえる。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s2">"hoge"</span><span class="p">,</span> <span class="s2">"~&gt; 2.1.8"</span>   <span class="c1"># 2.1.8以上2.2.0未満の最新のものを使用</span>
</pre></div>
</div>

<h3>
<span id="今後の変更は全て受け入れ最新に追従したい場合" class="fragment"></span><a href="#%E4%BB%8A%E5%BE%8C%E3%81%AE%E5%A4%89%E6%9B%B4%E3%81%AF%E5%85%A8%E3%81%A6%E5%8F%97%E3%81%91%E5%85%A5%E3%82%8C%E6%9C%80%E6%96%B0%E3%81%AB%E8%BF%BD%E5%BE%93%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>今後の変更は全て受け入れ最新に追従したい場合</h3>

<p>基本は、以下のように何も指定しないでOK</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s2">"hoge"</span>
</pre></div>
</div>

<p>公開するgemなどを作っていて、見知らぬユーザーの環境に古い<code>hoge</code>gemが入っていると困るなどという場合は以下のように<code>&gt;=</code>を使う。</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s2">"hoge"</span><span class="p">,</span> <span class="s2">"&gt;= 2.1.3"</span>  <span class="c1"># 2.1.3以上の最新のものを使う</span>
</pre></div>
</div>

<p><code>2.1.3</code>の部分は頑張って自分の書いたものが<code>hoge</code>gemのどのバージョンからなら動くかを調べて埋める。<code>"&gt;= 2.1"</code>かもしれないし、<code>"&gt;= 1"</code>かもしれない。</p>

<h3>
<span id="参照" class="fragment"></span><a href="#%E5%8F%82%E7%85%A7"><i class="fa fa-link"></i></a>参照</h3>

<p><a href="http://gembundler.com/gemfile.html" class="autolink" rel="nofollow noopener" target="_blank">http://gembundler.com/gemfile.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>254</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/6aaea1ffecba725be601">gitのpush.defaultに関するノウハウ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-30 19:42:48</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>gitのpush.defaultの設定に関して、他人のを設定してあげることもあり、毎回迷うのでまとめました。</p>

<p>push.defaultは、今までは<code>matching</code>というのがデフォルトでしたが、Git2.0から<code>simple</code>っていうのがデフォルトになります。なので、何らかの設定をしないと、以下の様な警告が出たりします。</p>

<blockquote>
<p>warning: push.default is unset; its implicit value is changing in<br>
Git 2.0 from 'matching' to 'simple'. To squelch this message<br>
and maintain the current behavior after the default changes, use:</p>

<p>git config --global push.default matching</p>

<p>To squelch this message and adopt the new behavior now, use:</p>

<p>git config --global push.default simple</p>

<p>See 'git help config' and search for 'push.default' for further information.<br>
(the 'simple' mode was introduced in Git 1.7.11. Use the similar mode<br>
'current' instead of 'simple' if you sometimes use older versions of Git)</p>
</blockquote>

<p>ちなみに、設定できるオプションの詳しい説明については<a href="http://git-scm.com/docs/git-config" rel="nofollow noopener" target="_blank">git help config</a>に書いてあります。</p>

<blockquote>
<p>Defines the action git push should take if no refspec is given on the command line, no refspec is configured in the remote, and no refspec is implied by any of the options given on the command line. Possible values are:</p>

<ul>
<li><p>nothing - do not push anything.</p></li>
<li><p>matching - push all branches having the same name in both ends. This is for those who prepare all the branches into a publishable shape and then push them out with a single command. It is not appropriate for pushing into a repository shared by multiple users, since locally stalled branches will attempt a non-fast forward push if other users updated the branch. + This is currently the default, but Git 2.0 will change the default to simple.</p></li>
<li><p>upstream - push the current branch to its upstream branch. With this, git push will update the same remote ref as the one which is merged by git pull, making push and pull symmetrical. See "branch.&lt;name&gt;.merge" for how to configure the upstream branch.</p></li>
<li><p>simple - like upstream, but refuses to push if the upstream branch's name is different from the local one. This is the safest option and is well-suited for beginners. It will become the default in Git 2.0.</p></li>
<li><p>current - push the current branch to a branch of the same name.</p></li>
</ul>

<p>The simple, current and upstream modes are for those who want to push out a single branch after finishing work, even when the other branches are not yet ready to be pushed out. If you are working with other people to push into the same shared repository, you would want to use one of these.</p>
</blockquote>

<h2>
<span id="性格別おすすめpushdefault設定" class="fragment"></span><a href="#%E6%80%A7%E6%A0%BC%E5%88%A5%E3%81%8A%E3%81%99%E3%81%99%E3%82%81pushdefault%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>性格別おすすめpush.default設定</h2>

<p>ただ訳してもつまらないので、どういう人が使うべきか解釈してみました。</p>

<h3>
<span id="nothing" class="fragment"></span><a href="#nothing"><i class="fa fa-link"></i></a>nothing</h3>

<p>何もしない。<code>git push</code>なんて省略形使わないで常に<code>git push origin master</code>みたいに指定するぜ！という堅実なあなた向き。</p>

<h3>
<span id="matching" class="fragment"></span><a href="#matching"><i class="fa fa-link"></i></a>matching</h3>

<p>今までのデフォルト。ローカルとリモートで同一の名前のリポジトリがあれば全てpushする。gitがgithubのような使い方じゃなくてP2Pのように完全分散型バージョン管理を目指した頃の、古き良き時代を愛すあなた向き。</p>

<h3>
<span id="upstream" class="fragment"></span><a href="#upstream"><i class="fa fa-link"></i></a>upstream</h3>

<p>現在のブランチにupstreamが設定されている場合、そこにpushする。これを指定すると<code>git push</code>が完全に<code>git pull</code>と逆の意味を表すようになる。規律や規則性を大事にするあなた向き。</p>

<h3>
<span id="simple" class="fragment"></span><a href="#simple"><i class="fa fa-link"></i></a>simple</h3>

<p>これからのデフォルト。upstreamが設定されていて、それが同名のブランチ名であるときのみpushする。初心者でも安心して使える。初心を忘れないあなたと、デフォルトを愛するあなた向き。</p>

<h3>
<span id="current" class="fragment"></span><a href="#current"><i class="fa fa-link"></i></a>current</h3>

<p>現在のブランチをリモートに同名でpushする。例えupstreamを設定していなくてもpushされるので、めんどくさがりで効率重視なあなた向き。</p>

<h3>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h3>

<p>結局どれ使えばいいかわからないという人は、次世代のデフォルトの<code>simple</code>か、<code>current</code>を使うといいと思います。<code>current</code>はかなり楽なので、僕はこれを使っています。</p>

<h2>
<span id="おまけ1-upstreamの設定" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%911-upstream%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>おまけ1: upstreamの設定</h2>

<p>上の記述に何回か登場したupstreamは以下の2つの方法で設定できます。</p>

<h3>
<span id="pushするときについでに設定" class="fragment"></span><a href="#push%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A7%E3%81%AB%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>pushするときについでに設定</h3>

<p><code>git push</code>する際に<code>-u</code>オプションを付けると、push時に同時に設定できます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push -u origin master
</pre></div></div>

<h3>
<span id="明示的に設定" class="fragment"></span><a href="#%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AB%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>明示的に設定</h3>

<p>今いるブランチのupstreamを設定したい時：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git branch -u origin/current-branch-name
</pre></div></div>

<p>別ブランチの設定したい時：</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git branch -u origin/different-branch-name different-branch-name
</pre></div></div>

<p>　</p>

<p>なお、設定の確認は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git branch -vv
</pre></div></div>

<p>で出来ます。</p>

<h2>
<span id="おまけ2-git-push-のおさらい" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%912-git-push-%E3%81%AE%E3%81%8A%E3%81%95%E3%82%89%E3%81%84"><i class="fa fa-link"></i></a>おまけ2: git push のおさらい</h2>

<p>git pushは略さないで書くと以下のように指定することになっています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push &lt;リモートのレポジトリ名&gt; &lt;ローカルのブランチ名&gt;:&lt;リモートのブランチ名&gt;
</pre></div></div>

<ul>
<li>&lt;リモートのレポジトリ名&gt;: <code>git remote</code>/<code>git remote -v</code>で確認可能。</li>
<li>&lt;ローカルのブランチ名&gt;: <code>git branch</code>で確認可能。</li>
<li>&lt;リモートのブランチ名&gt;: <code>git branch -r</code>で確認可能。</li>
</ul>

<p>　<br>
例えば、ステージング用のHeroku<code>heroku_staging</code>に、新たに機能を追加したブランチ<code>experiment</code>をデプロイしたい時は以下のようにします。<br>
(Herokuは<code>master</code>にpushすればデプロイされます)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push heroku_staging experiment:master
</pre></div></div>

<p>　<br>
リモートのブランチ名がローカルと同じ場合は省略できます。例えば、よく使う</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push origin master
</pre></div></div>

<p>は、以下のように指定したのと同じ意味になります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push origin master:master
</pre></div></div>

<p>　<br>
さらにもっと省略して、</p>

<ul>
<li>リモートリポジトリ名だけを指定</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push origin
</pre></div></div>

<ul>
<li>全て省略</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push
</pre></div></div>

<p>と記述しても、何らかの操作を行うことが可能で、その挙動を指定するのが今回の<code>push.default</code>の設定です。</p>

<h2>
<span id="おまけ3-git-pushの挙動を実験したい" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%913-git-push%E3%81%AE%E6%8C%99%E5%8B%95%E3%82%92%E5%AE%9F%E9%A8%93%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>おまけ3: git pushの挙動を実験したい</h2>

<p>いろいろ実験して確認したい人は、<code>git push</code>は<code>-n</code>(<code>--dry-run</code>)オプションを付けることで、何が起こるかだけを出力することができます。<br>
お試しあれ。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>253</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/6233eeac21fb895fa58d">Githubさん,ごめんなさい！複数リポジトリを一つにまとめる方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-13 01:38:33</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[GitHub]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>複数のリポジトリがあった時に、それをまとめた親レポジトリを作り、各レポジトリをサブディレクトリとしてまとめてしまう方法。</p>

<p>ファイルとして保存するだけじゃなく、ちゃんとコミットHistoryも保存される。一つにまとめたものを後で切り出すこともできる。</p>

<p>これでリポジトリ数の削減が可能になるので、GithubのPrivateリポジトリ数の上限などにお悩みの人は是非お試しを。現在、頻繁に使っているものをまとめてしまうのはおすすめしないが、古い使われてないものを歴史ごとアーカイブするのには持ってこいだと思う。</p>

<p>以下では、</p>

<ul>
<li>$ACCOUNT = githubのアカウント名</li>
<li>$REPO = サブディレクトリに移したいレポジトリ名</li>
<li>$ARCHIVE = 複数リポジトリをまとめておくアーカイブ用親リポジトリの名前</li>
</ul>

<p>とする。</p>

<h2>
<span id="複数リポジトリをまとめたアーカイブ用gitリポジトリをローカルに作成" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%9F%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E7%94%A8git%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%AB%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>複数リポジトリをまとめたアーカイブ用gitリポジトリをローカルに作成</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir $ARCHIVE
cd $ARCHIVE
git init
touch .gitignore README.md  # 適当に編集
git add .
git commit -m "Add .gitignore and README.md"
</pre></div></div>

<p>ここで、とりあえず一つ何かCommitしておくのは、失敗しても<code>git reset --hard HEAD~</code>で戻れたりと何かと都合がいいから。</p>

<h2>
<span id="既存リポジトリをarchiveのサブディレクトリとして保存" class="fragment"></span><a href="#%E6%97%A2%E5%AD%98%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92archive%E3%81%AE%E3%82%B5%E3%83%96%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%A8%E3%81%97%E3%81%A6%E4%BF%9D%E5%AD%98"><i class="fa fa-link"></i></a>既存リポジトリをARCHIVEのサブディレクトリとして保存</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git remote add $REPO git@github.com:$ACCOUNT/$REPO.git
git fetch $REPO
git checkout -b $REPO $REPO/master
git filter-branch -f --tree-filter "mkdir $REPO &amp;&amp; git mv -k {,.[\!.],..[\!.]}* $REPO/"
git checkout master
git merge $REPO
</pre></div></div>

<p>うまくいってそうだったら、github上のREPOリポジトリを消す。</p>

<p>これをまとめたい各リポジトリに対して行う。</p>

<h3>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h3>

<p><a href="http://stackoverflow.com/questions/13337877/what-is-the-opposite-of-git-filter-branch-subdirectory-filter" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/13337877/what-is-the-opposite-of-git-filter-branch-subdirectory-filter</a></p>

<h2>
<span id="複数リポジトリをまとめたアーカイブをgithubにpush" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%9F%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E3%82%92github%E3%81%ABpush"><i class="fa fa-link"></i></a>複数リポジトリをまとめたアーカイブをGithubにPush</h2>

<p>Github上にARCHIVEという名前のリポジトリを作成する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git remote add origin git@github.com:$ACCOUNT/$ARCHIVE.git
git push -u origin master
</pre></div></div>

<p>この順番でやれば、Githubのprivateリポジトリ数の上限に達していても、ちゃんと複数リポジトリをサブディレクトリとしてまとめたアーカイブを作ることができる。</p>

<h2>
<span id="おまけもう一度切り出したい時" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E3%82%82%E3%81%86%E4%B8%80%E5%BA%A6%E5%88%87%E3%82%8A%E5%87%BA%E3%81%97%E3%81%9F%E3%81%84%E6%99%82"><i class="fa fa-link"></i></a>おまけ：もう一度切り出したい時</h2>

<p>逆にまとめてしまったものをもう一度切り出したいときは以下のようにする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git clone git@github.com:$ACCOUNT/$ARCHIVE.git $REPO
cd $REPO
git filter-branch --subdirectory-filter $REPO
git remote add origin git@github.com:$ACCOUNT/$REPO.git
git push -u origin master
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>201</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/bd8c1385115df27c15fa">RubyでJSON形式の結果が返ってくるURLをParseする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-19 03:21:41</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>HTTPリクエストでJSONが返ってくるAPIを処理するとかよくあるケースだけど、意外と書き方忘れるのでメモ</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">'net/http'</span>
<span class="nb">require</span> <span class="s1">'uri'</span>
<span class="nb">require</span> <span class="s1">'json'</span>

<span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">'http://www.example.com/sample.json'</span><span class="p">)</span>
<span class="n">json</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">result</span>
</pre></div></div>

<h2>
<span id="redirectとかtimeoutとかエラー処理とかちゃんとやりたい時用" class="fragment"></span><a href="#redirect%E3%81%A8%E3%81%8Btimeout%E3%81%A8%E3%81%8B%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86%E3%81%A8%E3%81%8B%E3%81%A1%E3%82%83%E3%82%93%E3%81%A8%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E6%99%82%E7%94%A8"><i class="fa fa-link"></i></a>RedirectとかTimeoutとかエラー処理とかちゃんとやりたい時用</h2>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">'net/http'</span>
<span class="nb">require</span> <span class="s1">'uri'</span>
<span class="nb">require</span> <span class="s1">'json'</span>

<span class="k">def</span> <span class="nf">get_json</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
  <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s1">'too many HTTP redirects'</span> <span class="k">if</span> <span class="n">limit</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
  <span class="k">begin</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">uri</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="ss">use_ssl</span><span class="p">:</span> <span class="n">uri</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s1">'https'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
      <span class="n">http</span><span class="o">.</span><span class="n">open_timeout</span> <span class="o">=</span> <span class="mi">5</span>
      <span class="n">http</span><span class="o">.</span><span class="n">read_timeout</span> <span class="o">=</span> <span class="mi">10</span>
      <span class="n">http</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">request_uri</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">case</span> <span class="n">response</span>
    <span class="k">when</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPSuccess</span>
      <span class="n">json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
      <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
    <span class="k">when</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPRedirection</span>
      <span class="n">location</span> <span class="o">=</span> <span class="n">response</span><span class="o">[</span><span class="s1">'location'</span><span class="o">]</span>
      <span class="nb">warn</span> <span class="s2">"redirected to </span><span class="si">#{</span><span class="n">location</span><span class="si">}</span><span class="s2">"</span>
      <span class="n">get_json</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">limit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nb">puts</span> <span class="o">[</span><span class="n">uri</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">value</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s2">" : "</span><span class="p">)</span>
      <span class="c1"># handle error</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">puts</span> <span class="o">[</span><span class="n">uri</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">e</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s2">" : "</span><span class="p">)</span>
    <span class="c1"># handle error</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">get_json</span><span class="p">(</span><span class="s1">'http://www.example.com/sample.json'</span><span class="p">)</span>
</pre></div></div>

<h2>
<span id="公式ドキュメント" class="fragment"></span><a href="#%E5%85%AC%E5%BC%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>公式ドキュメント</h2>

<ul>
<li><a href="http://ruby-doc.org/stdlib-2.0/libdoc/net/http/rdoc/Net/HTTP.html" class="autolink" rel="nofollow noopener" target="_blank">http://ruby-doc.org/stdlib-2.0/libdoc/net/http/rdoc/Net/HTTP.html</a></li>
<li><a href="http://ruby-doc.org/stdlib-2.0/libdoc/uri/rdoc/URI.html" class="autolink" rel="nofollow noopener" target="_blank">http://ruby-doc.org/stdlib-2.0/libdoc/uri/rdoc/URI.html</a></li>
<li><a href="http://ruby-doc.org/stdlib-2.0/libdoc/json/rdoc/JSON.html" class="autolink" rel="nofollow noopener" target="_blank">http://ruby-doc.org/stdlib-2.0/libdoc/json/rdoc/JSON.html</a></li>
</ul>

<h2>
<span id="日本語版ドキュメント" class="fragment"></span><a href="#%E6%97%A5%E6%9C%AC%E8%AA%9E%E7%89%88%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>日本語版ドキュメント</h2>

<ul>
<li><a href="http://doc.ruby-lang.org/ja/2.0.0/library/net=2fhttp.html" class="autolink" rel="nofollow noopener" target="_blank">http://doc.ruby-lang.org/ja/2.0.0/library/net=2fhttp.html</a></li>
<li><a href="http://doc.ruby-lang.org/ja/2.0.0/class/URI.html" class="autolink" rel="nofollow noopener" target="_blank">http://doc.ruby-lang.org/ja/2.0.0/class/URI.html</a></li>
<li><a href="http://doc.ruby-lang.org/ja/2.0.0/class/JSON.html" class="autolink" rel="nofollow noopener" target="_blank">http://doc.ruby-lang.org/ja/2.0.0/class/JSON.html</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>185</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/6a7028aa46928e376f32">Githubで空白を無視してdiffを見る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-05 19:56:05</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[GitHub]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>インデントを変えた時のDiffってめっちゃ見にくいですよね。インデントを変えただけなのか、実は内容も変わっているのかGithub上で判断したい！</p>

<p>そんな時はURLパラメーターに</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>?w=
</pre></div></div>

<p>をつければ、githubが空白を無視した上でdiffのある部分だけを表示してくれます。</p>

<p>例<br>
<a href="https://github.com/sixthsense/sixthsense/pull/16/files" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sixthsense/sixthsense/pull/16/files</a></p>

<p><a href="https://github.com/sixthsense/sixthsense/pull/16/files?w=" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sixthsense/sixthsense/pull/16/files?w=</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>163</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/54503f309216c840765e">PostgreSQLのチューニング事例</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-28 03:26:27</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PostgreSQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="事前情報" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%83%85%E5%A0%B1"><i class="fa fa-link"></i></a>事前情報</h2>

<p>m3.xlargeインスタンス</p>

<blockquote>
<p>15GB メモリ<br>
13 ECU = 3.25ECU(2.6GHz) * 仮想4コア</p>
</blockquote>

<p>DBサイズ</p>

<blockquote>
<p>3.38 GB</p>
</blockquote>

<h2>
<span id="設定値" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E5%80%A4"><i class="fa fa-link"></i></a>設定値</h2>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/postgresql/9.1/main/postgresql.conf</span></div>
<div class="highlight"><pre><span></span>max_connections = 100
shared_buffers = 3GB # 実メモリの20%

# ここらへんのはとりあえずこのくらいで。小さすぎる分にはlog_temp_filesの設定で書き出されるので後で気づいて調整できる。
temp_buffers = 32MB
work_mem = 32MB
maintenance_work_mem = 128MB

wal_buffers = 16MB  # 迷いどころもなく16MB

checkpoint_segments = 16  # HDへのフラッシュ回数を減らす
effective_cache_size = 7GB  # planerのため。実メモリの半分ぐらいがいいらしい
</pre></div>
</div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/sysctl.conf</span></div>
<div class="highlight"><pre><span></span># 7GB max shared mamory
kernel.shmall=1835008
kernel.shmmax=7516192768
</pre></div>
</div>

<p>して<code>sudo sysctl -p</code>, <code>sudo /etc/init.d/postgresql restart</code></p>

<p>メモ</p>

<ul>
<li>shared_buffersの経験則は実メモリの20%-30%、もしくは頻繁にアクセスするテーブルのデータが載る程度</li>
<li>shared_bufferを50%以上にするとカーネルのキャッシュが溢れスワップする</li>
<li>work_memの最大は<code>(実メモリ-shared_buffers)/max_connections</code>。そうでないと確実にスワップする</li>
<li>work_memの経験は<code>実メモリ/max_connections/[4-16]</code>
</li>
<li>log_temp_filesの設定により、一時ファイルを使った場合Logに書き出すことが出来る</li>
<li>wal_buffersは-1でshared_bufferの1/32になる。

<ul>
<li>通常のWALセグメントの大きさである16MBを超えることはないため、大きすぎる場合は設定しなおしたほうが良い。</li>
</ul>
</li>
</ul>

<h2>
<span id="ログ書き出しの設定" class="fragment"></span><a href="#%E3%83%AD%E3%82%B0%E6%9B%B8%E3%81%8D%E5%87%BA%E3%81%97%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ログ書き出しの設定</h2>

<p><a href="http://www.postgresql.jp/document/9.2/html/runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHERE" class="autolink" rel="nofollow noopener" target="_blank">http://www.postgresql.jp/document/9.2/html/runtime-config-logging.html#RUNTIME-CONFIG-LOGGING-WHERE</a></p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/postgresql/9.1/main/postgresql.conf</span></div>
<div class="highlight"><pre><span></span>#log_destination = 'stderr'
logging_collector = on
log_rotation_size = 1GB
#log_min_messages = warning
log_min_error_statement = warning  # log_min_messages似合わせる
log_line_prefix='[%t][%p][%c-%l][%x][%e]%q (%u, %d, %r, %a) ' #とりあえず全部の情報を出しておけば良いのではという発想 
log_min_duration_statement = 500  # 0.5秒以上かかった問い合わせを記録
log_temp_files = 1MB  # 1MB以上の一時ファイルを作ったらログに書き出す
</pre></div>
</div>

<h2>
<span id="残存プロセスの除去" class="fragment"></span><a href="#%E6%AE%8B%E5%AD%98%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AE%E9%99%A4%E5%8E%BB"><i class="fa fa-link"></i></a>残存プロセスの除去</h2>

<p>AP側が落ちたり、APとのNWが断絶された際、APからの応答をずっと待ってしまうDB側のプロセスが残ってしまう。こうなるとConnection数がMaxに達したり、ロングトランザクション化したりする問題が起こる。タイムアウトを短めにしてこれを防ぐ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>tcp_keepalives_idle = 60  # keep alive パケット送出までの待機時間(デフォルト7200秒)
tcp_keepalives_interval = 5  # KeepAliveパケット送出に応答がなかった場合の再送間隔(デフォルト75秒)
tcp_keepalives_count = 6  # KeepAliveパケット送出回数の上限(デフォルト9)
</pre></div></div>

<p>この設定では1分半で残存プロセスを除去</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考:</h2>

<ul>
<li><a href="http://www.mindcircus.jp/archives/2734" class="autolink" rel="nofollow noopener" target="_blank">http://www.mindcircus.jp/archives/2734</a></li>
<li><a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20090703/333173/" class="autolink" rel="nofollow noopener" target="_blank">http://itpro.nikkeibp.co.jp/article/COLUMN/20090703/333173/</a></li>
<li><a href="http://www.postgresql.jp/events/event_sozai/Summer_seminar2011_Operation_technique.pdf" class="autolink" rel="nofollow noopener" target="_blank">http://www.postgresql.jp/events/event_sozai/Summer_seminar2011_Operation_technique.pdf</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>156</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/3265f91768bcfd582bd7">Application Layoutを整理する3つの方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-31 04:04:35</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>サービスを運営していると、</p>

<ul>
<li>Admin以下のページだけちょっとヘッダーを変えたい</li>
<li>ABテストのために2種類のレイアウトを試してみたい</li>
<li>キャンペーン用にある期間だけ別のロゴを使いたい</li>
<li>ユーザー登録ページだけ簡易レイアウトにしたい</li>
</ul>

<p>などなどの理由で、<code>app/views/layouts/application.html.erb</code>と大体同じだけど、ちょっと違うというレイアウトが欲しくなります。ただ、コピペでいろんなレイアウトを作ってしまうと後の変更が困難になります。Layoutでもデフォルト値や継承を使って再利用性の高いものを作りましょう。</p>

<h2>
<span id="方法1-default-content_for" class="fragment"></span><a href="#%E6%96%B9%E6%B3%951-default-content_for"><i class="fa fa-link"></i></a>方法1 Default content_for</h2>

<p>あるyieldに対応するcontent_forがセットされなかった時のデフォルト値を定める方法です。</p>

<p>yieldは普通の文字列を返す関数で、値がセットされていなければ<code>""</code>が返ります。なので<code>empty?</code>を使って値がセットされているか調べることができます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/layouts/application.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">header</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="sx">% if </span><span class="k">yield</span><span class="p">(</span><span class="ss">:header</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span> <span class="sx">%&gt;</span>
<span class="sx">    &lt;%= render 'header' %&gt;</span>
  <span class="o">&lt;</span><span class="sx">% else %&gt;</span>
<span class="sx">    &lt;%= yield :header %&gt;</span>
  <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
<span class="sx">&lt;/header&gt;</span>
</pre></div>
</div>

<h2>
<span id="方法2-template-inheritance" class="fragment"></span><a href="#%E6%96%B9%E6%B3%952-template-inheritance"><i class="fa fa-link"></i></a>方法2 Template Inheritance</h2>

<p>Controllerの継承関係がViewのTemplateでも使えるという話です。</p>

<p>とりあえず以下のRails Castを見るのがいいと思います。<br>
<a href="http://railscasts.com/episodes/269-template-inheritance" class="autolink" rel="nofollow noopener" target="_blank">http://railscasts.com/episodes/269-template-inheritance</a></p>

<p>要約すると、共有したいpartial templateは<code>app/views/shared</code>等ではなく<code>app/views/application</code>下に置きます。例えば<code>_header.rb</code>という名前のpartialだとすると、以下のようになります。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/layouts/application.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;%=</span> <span class="n">render</span> <span class="s1">'header'</span> <span class="o">%&gt;</span>
</pre></div>
</div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/application/_header.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">"head"</span><span class="o">&gt;</span><span class="no">Normal</span> <span class="no">Page</span><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</pre></div>
</div>

<p>ここでproducts以下のページだけheader部分の内容を変えたいとしたら、以下のように<code>products</code>ディレクトリの下に同名の<code>_header.html.erb</code>を作り内容を上書きます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/products/_header.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">"head"</span><span class="o">&gt;</span><span class="no">Production</span> <span class="no">Page</span><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</pre></div>
</div>

<p>お分かりかと思いますが、これは、以下のようにProductsControllerがApplicationControllerを継承している事を利用しています。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/products_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</pre></div>
</div>

<p>この方法は綺麗ですが、LayoutをControllerごとにしか変えられないという問題があります。</p>

<h2>
<span id="方法3-parent-layout" class="fragment"></span><a href="#%E6%96%B9%E6%B3%953-parent-layout"><i class="fa fa-link"></i></a>方法3 Parent Layout</h2>

<p>layoutのテンプレートを親layoutを使って設定する方法です。各yieldの値が設定済みのlayoutを作れます。</p>

<p>基本的には以下のリンクを参照するといいです。<br>
<a href="http://m.onkey.org/nested-layouts-in-rails-3" class="autolink" rel="nofollow noopener" target="_blank">http://m.onkey.org/nested-layouts-in-rails-3</a></p>

<p>ただこれはrails3.0の方法を示していて、rails3.2では動きません。これを、<a href="http://stackoverflow.com/questions/9185344/" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/9185344/</a> を参照して直したのが以下です。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/helpers/application_helper.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">module</span> <span class="nn">ApplicationHelper</span>
  <span class="k">def</span> <span class="nf">parent_layout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
    <span class="vi">@view_flow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="ss">:layout</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">output_buffer</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">output_buffer</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="ss">file</span><span class="p">:</span> <span class="s2">"layouts/</span><span class="si">#{</span><span class="n">layout</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>これを使って、</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/layouts/admin.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="no">Admin</span> <span class="no">Panel</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
<span class="sr">&lt;div class="admin_navigation"&gt;Home | Posts | Users | Assets&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sx">%= yield %&gt;</span>

<span class="sx">&lt;% content_for :header do %&gt;</span>
<span class="sx">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s1">'logo.png'</span><span class="p">),</span> <span class="n">admin_root_path</span> <span class="sx">%&gt;</span>
<span class="sx">&lt;% end %&gt;</span>

<span class="o">&lt;</span><span class="sx">% parent_layout </span><span class="s1">'application'</span> <span class="o">%&gt;</span>
</pre></div>
</div>

<p>のようにすれば、<code>layout/application.html.erb</code>をベースに<code>layout/admin.html.erb</code>を作れます。</p>

<h2>
<span id="3つを併用した使用例" class="fragment"></span><a href="#3%E3%81%A4%E3%82%92%E4%BD%B5%E7%94%A8%E3%81%97%E3%81%9F%E4%BD%BF%E7%94%A8%E4%BE%8B"><i class="fa fa-link"></i></a>3つを併用した使用例</h2>

<p>これらの方法はどれかを選ぶというよりかは併用すると良いです。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/layouts/application.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;!</span><span class="no">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="no">App</span> <span class="no">Title</span><span class="o">&lt;</span><span class="sr">/title&gt;</span>
<span class="sr">  &lt;%= stylesheet_link_tag    "application", :media =&gt; "all" %&gt;</span>
<span class="sr">  &lt;%= javascript_include_tag "application" %&gt;</span>
<span class="sr">  &lt;%= csrf_meta_tags %&gt;</span>
<span class="sr">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"wrapper"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">header</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="sx">% if </span><span class="k">yield</span><span class="p">(</span><span class="ss">:header</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span> <span class="sx">%&gt;</span>
<span class="sx">        &lt;%= render 'header' %&gt;</span>
      <span class="o">&lt;</span><span class="sx">% else %&gt;</span>
<span class="sx">        &lt;%= yield :header %&gt;</span>
      <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
<span class="sx">    &lt;/header&gt;</span>
    <span class="o">&lt;</span><span class="n">article</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="sx">%= yield %&gt;</span>
<span class="sx">    &lt;/article&gt;</span>
<span class="sx">    &lt;footer&gt;</span>
<span class="sx">      &lt;% if yield(:footer).empty? %&gt;</span>
<span class="sx">        &lt;%=</span> <span class="n">render</span> <span class="s1">'footer'</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;% else %&gt;</span>
        <span class="o">&lt;%=</span> <span class="k">yield</span> <span class="ss">:footer</span> <span class="sx">%&gt;</span>
<span class="sx">      &lt;% end %&gt;</span>
    <span class="o">&lt;</span><span class="sr">/footer&gt;</span>
<span class="sr">  &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sr">/body&gt;</span>
<span class="sr">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/application/_header.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s1">'logo.png'</span><span class="p">),</span> <span class="n">root_path</span> <span class="o">%&gt;</span>
</pre></div>
</div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/admin/base/_header.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s1">'logo.png'</span><span class="p">),</span> <span class="n">admin_root_path</span> <span class="o">%&gt;</span>
</pre></div>
</div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/application/_footer.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&amp;</span><span class="n">copy</span><span class="p">;</span> <span class="o">&lt;%=</span> <span class="no">Date</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">year</span> <span class="o">%&gt;</span> <span class="no">Company</span> <span class="no">Name</span><span class="o">.</span> <span class="no">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="o">.</span>
</pre></div>
</div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/layout/no_header_footer.html.erb</span></div>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="sx">% content_for </span><span class="ss">:header</span> <span class="k">do</span> <span class="sx">%&gt; &lt;% end %&gt;</span>
<span class="o">&lt;</span><span class="sx">% content_for </span><span class="ss">:footer</span> <span class="k">do</span> <span class="sx">%&gt; &lt;% end %&gt;</span>
<span class="o">&lt;</span><span class="sx">% parent_layout </span><span class="s1">'application'</span> <span class="o">%&gt;</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>146</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/17457d6b1809dd803413">テキストフィールドがEnterキーでサブミットされるのを防ぐ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-12 10:25:59</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[HTML]</b> <b>[JavaScript]</b> <b>[jQuery]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>※コメントの指摘を修正済みです。</p>

<p>HTMLではForm内にテキスト一行入力系のフィールドが一つだった場合、そこでEnterキーを押すとSubmitされる仕様になっている。</p>

<p>詳しい仕様に関しては以下を参照：</p>

<ul>
<li>HTML5の仕様: <a href="http://www.w3.org/TR/html5/forms.html#implicit-submission" class="autolink" rel="nofollow noopener" target="_blank">http://www.w3.org/TR/html5/forms.html#implicit-submission</a>
</li>
<li>古くからの仕様: <a href="http://www.w3.org/MarkUp/html-spec/html-spec_8.html#SEC8.2" class="autolink" rel="nofollow noopener" target="_blank">http://www.w3.org/MarkUp/html-spec/html-spec_8.html#SEC8.2</a> </li>
</ul>

<p>具体的には、inputのtypeが<br>
<code>text, search, url, tel, email, password, datetime, date, month, week, time, datetime-local, number</code><br>
のどれかだと、この挙動になる。</p>

<p>これが厄介なのは、Form内にチェックボックスやテキストエリアなどの他のフィールドがあってもテキストフィールドが一つだったらサブミットしてしまう事。意外とそういう風になっていることに気づかないのでデフォルトでオフにしておくことをオススメする。<br>
逆に、検索Boxなどsubmitして欲しい場合もあるので、<code>allow_submit</code>というクラスを明示的につけるとデフォルトの挙動に戻るように設計する。</p>

<h2>
<span id="デフォルトでこの挙動を解除する方法" class="fragment"></span><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7%E3%81%93%E3%81%AE%E6%8C%99%E5%8B%95%E3%82%92%E8%A7%A3%E9%99%A4%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>デフォルトでこの挙動を解除する方法</h2>

<p>常にロードされるJavascriptファイルないで以下のように記述する。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"keypress"</span><span class="p">,</span> <span class="s2">"input:not(.allow_submit)"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">!==</span> <span class="mi">13</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div></div>

<p>自分のためにCoffeeScriptバージョンも書いておく。</p>

<div class="code-frame" data-lang="coffee"><div class="highlight"><pre><span></span><span class="nx">$</span> <span class="nf">-&gt;</span>
  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span> <span class="s">"keypress"</span><span class="p">,</span> <span class="s">"input:not(.allow_submit)"</span><span class="p">,</span> <span class="nf">(event) -&gt;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">!=</span> <span class="mi">13</span>
</pre></div></div>

<p>こうすることで、allow_submitを明示的にクラス名に付けない限り、Enterキーでサブミットされることを防ぐことが出来る用になる。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>135</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/4316de553742cac856c1">ABテストのための有意性検定</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-09 02:35:21</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[R]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>こんにちは、<a href="http://qiita.com/users/awakia">awakia</a>です。今回のアドベントカレンダー、結構、機械学習ガチなメンツが揃ったみたいなので、俺も対抗してやる！！とも思ったのですが、研究を離れて2年が経とうとしているので、真っ向勝負とか今更無理なことに気づきました...ｗ<br>
なので、開発者の皆も知っておくと便利なデータサイエンスの話をすることにします。</p>

<h2>
<span id="abテストと検定の必要性" class="fragment"></span><a href="#ab%E3%83%86%E3%82%B9%E3%83%88%E3%81%A8%E6%A4%9C%E5%AE%9A%E3%81%AE%E5%BF%85%E8%A6%81%E6%80%A7"><i class="fa fa-link"></i></a>ABテストと検定の必要性</h2>

<p><a href="https://www.wantedly.com/" rel="nofollow noopener" target="_blank">Webサービスを運営</a>していると、見た目の問題だけでも結構悩みます。ボタンの色や文言などの小さなところから、トップページに盛り込む内容をどうするかまで、いろいろです。</p>

<p>今回、「ABテスト」と呼ぶものは、画面に占める大きさ等にかかわらず、パターンAとパターンBを作って、そのどちらがいいかを判断するための実験と定義することにします。<br>
なお、ABテストの呼び名には結構流派があるので別の名前で聞いたことがあるかもしれません。例えば、Googleのマット・カッツ先生は、Googleが行なっているという少数のユーザーグループに対するテストを「バケットテスト」「クッキーテスト」と呼んでいます。(<a href="http://www.suzukikenichi.com/blog/are-google-serps-the-same-on-all-browsers/" class="autolink" rel="nofollow noopener" target="_blank">http://www.suzukikenichi.com/blog/are-google-serps-the-same-on-all-browsers/</a>)</p>

<p>それでは、ABテストを行う際の具体例として、ユーザー登録のボタンの色を赤/青どっちにした方がいいのか迷っているという状況を考えてみます。これを判断するために、半分のユーザーには赤を、もう半分のユーザーには青を見せるという実験をしてみた結果、</p>

<blockquote>
<p>赤：120人 vs 青：100人</p>
</blockquote>

<p>というデータが得られたとしましょう。</p>

<p>この瞬間、あ、「赤」の方がいいのね。「赤」に決定！ データ主義バンザイ！！</p>

<p>となったあなたは幸せです。もう赤いボタンにするといいと思います。<br>
実際、赤いボタンの方がいい可能性は、統計的にどう解釈しても高いです。</p>

<p>でも、もし</p>

<ul>
<li>自分もしくはチームの誰かが統計的に意味のあるデータしか信じない</li>
<li>実は自分は青の方が好きで、出来れば赤にしたくない</li>
</ul>

<p>といった状況に置かれてしまった場合、もう少し粘って考えてみましょう。</p>

<p>ちなみに裏話として、こういったデータ主義は、とてもデザイナー泣かせです。一生懸命、全体のバランスを考えてサイトデザインをし、色も選んでいるのに、「データが他の色がいいことを示している( ｰ`дｰ´)ｷﾘｯ」などと言われて、センスの無いエンジニアに色を変えられたのでは、プライドもズタボロでしょう。<br>
でも、実際、この場合エンジニアの方が正しくない？と言う意見もありですが、例えば、楽天市場のホームページってなんかごちゃごちゃ（ごめんなさい、ごめんなさい、悪気は無いんです）していますが、実は、あれ、すっきりしたデザインに変えてみたら急激にクリック率、購入率が下がったので、ごちゃごちゃしたのに戻したという、まことしやかな都市伝説が流れています。</p>

<h2>
<span id="統計的に検証してみる" class="fragment"></span><a href="#%E7%B5%B1%E8%A8%88%E7%9A%84%E3%81%AB%E6%A4%9C%E8%A8%BC%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>統計的に検証してみる</h2>

<p>さて、話を戻しましょう。</p>

<p>先ほど得られた、赤が120人、青が100人という結果を用いて、赤いボタンの方が良いと結論付けるためには、この結果が「たまたま起こったわけじゃない！」と言い切る必要があります。</p>

<p>これを言い切れるようにしてくれる方法が、統計学の(有意性)検定と呼ばれもので、これが分かれば「結果に有意差がある/はない！」などと言うことが出来るようになります。</p>

<p>じゃぁ、実際に検定をやってみようと思っても、統計検定のWikipediaカテゴリには、網羅率の低い<a href="http://ja.wikipedia.org/wiki/Category:%E7%B5%B1%E8%A8%88%E6%A4%9C%E5%AE%9A" rel="nofollow noopener" target="_blank">Wikipedia日本語版</a>でも28項目（すべてが統計検定の手法なわけではないですが）、<a href="http://en.wikipedia.org/wiki/Category:Statistical_tests" rel="nofollow noopener" target="_blank">Wikipedia英語版</a>では約100項目と、正直どれ使えばいいんだ！！状態になっています。<br>
有名なものをとってみてもT,Z,F,U,G検定という英語一文字のものや、χ2検定などというギリシャ文字を使ったものまであり、もう世の中の人を惑わすために名付けたとしか思えない惨状を目のあたりにするはずです。</p>

<p>でも大丈夫！<br>
ABテストの結果の検証するためには、<strong><code>符号検定</code></strong>だけ知っていればOKです。</p>

<p>符号検定は、<a href="http://aoki2.si.gunma-u.ac.jp/lecture/Average/sign-test.html" class="autolink" rel="nofollow noopener" target="_blank">http://aoki2.si.gunma-u.ac.jp/lecture/Average/sign-test.html</a> に</p>

<blockquote>
<p>対応のある 2変数の組について，母代表値に差があるか検定する。<br>
2変数の組で単に，いずれが優れているか劣っているかあるいは同等であるかしかわからないときに適用する</p>
</blockquote>

<p>と書かれているように、ABテストにピッタリで、パターンAの方が良かったら+、悪かったら-という符号を付けてカウントし、それぞれの個数の差に意味があるかを検証する検定法なんだなと考えれば、"符号"検定というのも思い出しやすいのではないかと思います。</p>

<h3>
<span id="蛇足検定の一般論" class="fragment"></span><a href="#%E8%9B%87%E8%B6%B3%E6%A4%9C%E5%AE%9A%E3%81%AE%E4%B8%80%E8%88%AC%E8%AB%96"><i class="fa fa-link"></i></a>蛇足：検定の一般論</h3>

<p>一般に検定を行うためには、以下の2つを定める必要があります。</p>

<ol>
<li>検証したい仮説がどんな分布に従うか</li>
<li>確率何％をあり得ないかとみなすか</li>
</ol>

<p>1.については、例えば、PCのハードディスクが壊れてしまう現象は<a href="http://ja.wikipedia.org/wiki/%E3%83%9D%E3%82%A2%E3%82%BD%E3%83%B3%E5%88%86%E5%B8%83" rel="nofollow noopener" target="_blank">ポアソン分布</a>に従うと言われています。<br>
今回のABテストに関しては、パターンAとパターンBに違いが無いとみなした場合、コインを投げて表と裏が出る回数を記録していった時の分布と同じとみなせるので、それは(成功確率<code>p=0.5</code>の)<a href="http://ja.wikipedia.org/wiki/%E4%BA%8C%E9%A0%85%E5%88%86%E5%B8%83" rel="nofollow noopener" target="_blank">二項分布</a>と呼ばれる分布です。</p>

<p>2.は有意水準と呼ばれ、慣習として<code>5%</code>か<code>1%</code>が使われます。あくまで慣習で、科学的根拠はありません。更にABテストでは、間違った結論を出しても大して困らないので、<code>1%</code>を使うことはあまりなく、<code>5%</code>の方が使われることが多い気がしています。</p>

<p>なので、「検定結果に有意差があります」と言われたら、「パターンAとパターンBは同等だとみなしたら、5%以下の確率でしか起きないことが起きてしまってるんだよね。これってもうパターンAとパターンBに明確な違いがあるって言ったほうが自然じゃない？」と言われたと思えばいいことになります。</p>

<h2>
<span id="符号検定をしてみる" class="fragment"></span><a href="#%E7%AC%A6%E5%8F%B7%E6%A4%9C%E5%AE%9A%E3%82%92%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>符号検定をしてみる</h2>

<p>さて、</p>

<blockquote>
<p>赤：120人 vs 青：100人</p>
</blockquote>

<p>という結果で、赤ボタンの方が本当に良いと言えるか検定してみましょう。それには<a href="http://www.r-project.org/" rel="nofollow noopener" target="_blank">R言語</a>の<code>pbinom</code>を使って、以下のように計算します。</p>

<div class="code-frame" data-lang="r">
<div class="code-lang"><span class="bold">R</span></div>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> pbinom<span class="p">(</span><span class="m">120-1</span><span class="p">,</span> <span class="m">120+100</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0.9</span>
</pre></div>
</div>

<p>この<code>0.9</code>と言う数字は、青ボタンでも赤ボタンでもユーザー登録率は同じだとした時に、赤ボタンを押される回数が220回中、120未満(0-119回）でありえる確率を表しています。<br>
この時、有意水準を5%としても、<code>1 - 0.05 = 0.95</code>に達していないので、有意に赤ボタンの方が良いとは言えないということになります。残念でした。</p>

<p>ちなみに、220人中何人が赤ボタンをクリックしていたら有意と言えたかというのは、<code>qbinom</code>を使うとわかって</p>

<div class="code-frame" data-lang="r">
<div class="code-lang"><span class="bold">R</span></div>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> qbinom<span class="p">(</span><span class="m">0.95</span><span class="p">,</span> <span class="m">120+100</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">122</span>
</pre></div>
</div>

<p><code>122+1</code>の123人であれば有意であったということになります。<br>
このRの結果は、220回中、赤ボタンが0回押される確率から122回押される確率まで全て足し合わせると全体の95%に到達するということを表します。なので赤ボタンが123回以上押される確率は、5%に満たない(=ありえない)事が言えます。ありえないことが起こったら、赤と青の効果が等しいという前提が間違ってたということなので、123回であれば有意だったんですね。</p>

<p>実際に、足し合わせる関数である<code>pbinom</code>を用いて確かめると、</p>

<div class="code-frame" data-lang="r">
<div class="code-lang"><span class="bold">R</span></div>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> pbinom<span class="p">(</span><span class="m">121</span><span class="p">,</span> <span class="m">120+100</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0.9396072</span>
<span class="o">&gt;</span> pbinom<span class="p">(</span><span class="m">122</span><span class="p">,</span> <span class="m">120+100</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0.9541673</span>
</pre></div>
</div>

<p>なので、<code>122</code>ではじめて0.95を超えてますね。</p>

<p>有意水準1%だとどうなるかというと、</p>

<div class="code-frame" data-lang="r">
<div class="code-lang"><span class="bold">R</span></div>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> qbinom<span class="p">(</span><span class="m">0.99</span><span class="p">,</span> <span class="m">120+100</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">127</span>
</pre></div>
</div>

<p>128人必要です。</p>

<p>更に、この二項分布がどういう形をしているのか見てみるには、<code>plot</code>と<code>dbinom</code>を使って</p>

<div class="code-frame" data-lang="r">
<div class="code-lang"><span class="bold">R</span></div>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> plot<span class="p">(</span>dbinom<span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">220</span><span class="p">,</span> <span class="m">220</span><span class="p">,</span> <span class="m">0.5</span><span class="p">),</span> type<span class="o">=</span><span class="s">"h"</span><span class="p">,</span> xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">70</span><span class="p">,</span><span class="m">150</span><span class="p">))</span>
</pre></div>
</div>

<p>と入力すれば、</p>

<p><a href="https://camo.qiitausercontent.com/37aced52f248c84ea9856cc7f7f417f798645c80/68747470733a2f2f7777772e657665726e6f74652e636f6d2f73686172642f7332302f73682f37636634663637312d346263322d346261632d616566652d6430616261303831373765622f30343662663431376262613635386132663063653338316132336531663033652f7265732f38393263613165362d363761312d343933352d623862652d3134373031313864343931302f62696e6f6d2e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/37aced52f248c84ea9856cc7f7f417f798645c80/68747470733a2f2f7777772e657665726e6f74652e636f6d2f73686172642f7332302f73682f37636634663637312d346263322d346261632d616566652d6430616261303831373765622f30343662663431376262613635386132663063653338316132336531663033652f7265732f38393263613165362d363761312d343933352d623862652d3134373031313864343931302f62696e6f6d2e706e67" alt="二項分布" data-canonical-src="https://www.evernote.com/shard/s20/sh/7cf4f671-4bc2-4bac-aefe-d0aba08177eb/046bf417bba658a2f0ce381a23e1f03e/res/892ca1e6-67a1-4935-b8be-1470118d4910/binom.png"></a></p>

<p>と表示され、120のあたりがどのくらいありえそうか可視化することができます。</p>

<p>Rに関して話をすれば、検定を直接行なってくれる関数<code>binom.test</code>も存在して、以下のように使うことができます。</p>

<div class="code-frame" data-lang="r">
<div class="code-lang"><span class="bold">R</span></div>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> binom.test<span class="p">(</span><span class="m">120</span><span class="p">,</span> <span class="m">220</span><span class="p">,</span> <span class="m">0.5</span><span class="p">,</span> <span class="s">"greater"</span><span class="p">)</span>

    Exact binomial test

data<span class="o">:</span>  <span class="m">120</span> and <span class="m">220</span> 
number of successes <span class="o">=</span> <span class="m">120</span><span class="p">,</span> number of trials <span class="o">=</span> <span class="m">220</span><span class="p">,</span> p<span class="o">-</span>value <span class="o">=</span> <span class="m">0.1</span>
alternative hypothesis<span class="o">:</span> true probability of success is greater than <span class="m">0.5</span> 
<span class="m">95</span> percent confidence interval<span class="o">:</span>
 <span class="m">0.4878</span> <span class="m">1.0000</span> 
sample estimates<span class="o">:</span>
probability of success 
                <span class="m">0.5455</span> 
</pre></div>
</div>

<p><code>p-value = 0.1</code>と言う部分が、先ほどの<code>0.9</code>と言う値を、全体の<code>1</code>から引いた値に対応していますね。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>ABテストでの有意性検定には<strong>符号検定</strong> (半々で実験しない場合は、より一般に<strong>二項検定</strong>と呼ぶ)を用いるとよい。<br>
具体的には、以下の(クリック、ユーザー登録等の)アクションがあったとき、</p>

<table>
<thead>
<tr>
<th style="text-align: center"></th>
<th style="text-align: center">アクション数(回)</th>
<th style="text-align: center">実験対象の割合</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center"><strong>パターンA</strong></td>
<td style="text-align: center">a</td>
<td style="text-align: center">p (0.5, 0.01等)</td>
</tr>
<tr>
<td style="text-align: center"><strong>パターンB</strong></td>
<td style="text-align: center">b</td>
<td style="text-align: center">1-p</td>
</tr>
</tbody>
</table>

<p>二項分布を用い、以下のように検定する。</p>

<div class="code-frame" data-lang="r">
<div class="code-lang"><span class="bold">R</span></div>
<div class="highlight"><pre><span></span>significance <span class="o">=</span> <span class="m">1</span> <span class="o">-</span> pbinom<span class="p">(</span>a<span class="m">-1</span><span class="p">,</span> a<span class="o">+</span>b<span class="p">,</span> p<span class="p">)</span> <span class="o">&gt;=</span> <span class="m">0.95</span>
</pre></div>
</div>

<p>注) <code>a+b</code>が大きすぎる場合、教科書的には、二項分布だとnCkの計算が必要なため計算できなくなる＆正規分布に高精度で近似できるので、正規分布を用い検定するとあるが、Rを用いると、別に二項分布でもかなりの大きい数に対して計算が可能なので常に二項分布を使っておけば良い。</p>

<div class="code-frame" data-lang="r">
<div class="code-lang"><span class="bold">R</span></div>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> pbinom<span class="p">(</span><span class="m">110000020</span><span class="p">,</span> <span class="m">220000000</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">0.5011028</span>
</pre></div>
</div>

<h2>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h2>

<p>ABテストはとても実用的で強力なツールです。でも、ABテストに頼りすぎて、データに踊らされることのないように注意して欲しいと思います。</p>

<ul>
<li>ユーザー獲得は決してコインの裏表の回数と同一ではありません。仮にあるデザインの方がユーザー数は獲得できるとしても、もう一方のデザインの方が質の良いユーザーを獲得出来る可能性があることを忘れてはいけません。</li>
<li>統計的に有意などと言っても、結局は仮定と解釈の産物です。都合のいいデータが出た時に使って、自分の主張を有利にしましょう。</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>118</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/fc5c0283040ac780dc13">iOS7対策にとりあえず見ておいたらよさそうなリンク一覧</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-11 10:52:43</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="ios7のデモビデオとギャラリー" class="fragment"></span><a href="#ios7%E3%81%AE%E3%83%87%E3%83%A2%E3%83%93%E3%83%87%E3%82%AA%E3%81%A8%E3%82%AE%E3%83%A3%E3%83%A9%E3%83%AA%E3%83%BC"><i class="fa fa-link"></i></a>ios7のデモビデオとギャラリー</h2>

<p><a href="http://www.apple.com/ios/ios7/" class="autolink" rel="nofollow noopener" target="_blank">http://www.apple.com/ios/ios7/</a></p>

<p>まずは衝撃をうけるために。<br>
既存アプリとかで存在価値が無くなりそうなのがありそう...</p>

<h2>
<span id="iosデザインリソース" class="fragment"></span><a href="#ios%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>iosデザインリソース</h2>

<p><a href="https://developer.apple.com/library/prerelease/ios/design/index.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/prerelease/ios/design/index.html</a></p>

<ul>
<li>UI移行ガイド</li>
<li>ヒューマンインターフェースガイドライン</li>
<li>UIKitユーザーインターフェースカタログ</li>
</ul>

<p>へのリンクがある。</p>

<p>下の2つは長いので、移行ガイドだけ読めばとりあえず良さそう。</p>

<h2>
<span id="ios7-ui移行ガイド" class="fragment"></span><a href="#ios7-ui%E7%A7%BB%E8%A1%8C%E3%82%AC%E3%82%A4%E3%83%89"><i class="fa fa-link"></i></a>ios7 UI移行ガイド</h2>

<p><a href="https://developer.apple.com/library/prerelease/ios/documentation/UserExperience/Conceptual/TransitionGuide/index.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/prerelease/ios/documentation/UserExperience/Conceptual/TransitionGuide/index.html</a></p>

<p>とりあえず移行するには何をすればいいかを知ることで、エンジニアは今後の対応策が多少は練れるはず。</p>

<p>クリックしなくても、スクロールで全部が見れるPDF版のほうがいいかも。<br>
<a href="https://developer.apple.com/library/prerelease/ios/documentation/UserExperience/Conceptual/MobileHIG/MobileHIG.pdf" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/library/prerelease/ios/documentation/UserExperience/Conceptual/MobileHIG/MobileHIG.pdf</a></p>

<h2>
<span id="ios7-ディベロッパー用サイト" class="fragment"></span><a href="#ios7-%E3%83%87%E3%82%A3%E3%83%99%E3%83%AD%E3%83%83%E3%83%91%E3%83%BC%E7%94%A8%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>ios7 ディベロッパー用サイト</h2>

<p><a href="https://developer.apple.com/ios7/" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/ios7/</a></p>

<p>新しくなった各機能へのリンクがある</p>

<ul>
<li>とりあえずxcode5はダウンロードする

<ul>
<li>まずはiOS7のシミュレータを動かすとちょっと勝った気になれる</li>
</ul>
</li>
<li>勇気ある人はもう元には戻せないのを覚悟の上で自分のiPhoneをios7 betaにする

<ul>
<li>バックアップ使えば元に戻せるみたいです。完璧に戻るのかよくわかりませんが。とりあえずアップグレードする前にバックアップを取りましょう</li>
<li>うちの人柱によると、かっこいいけど重くなる、既存アプリのレイアウトが崩れたり動かなくなったりがあるらしいです</li>
<li>僕はまだ自分の携帯をこれにしようとは思えませんが、ただ、隣で使ってるのを見るとカッコいいので誘惑されます</li>
</ul>
</li>
</ul>

<p>をやったらいいのでは？</p>

<h2>
<span id="xcode5の新機能" class="fragment"></span><a href="#xcode5%E3%81%AE%E6%96%B0%E6%A9%9F%E8%83%BD"><i class="fa fa-link"></i></a>Xcode5の新機能</h2>

<p><a href="https://developer.apple.com/technologies/tools/whats-new.html" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/technologies/tools/whats-new.html</a></p>

<p>iOSもテストに力を入れ始めたらしいw</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>108</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/cab830238bbfaa924f02">Railsで日本語サービスを作るときのテンプレート</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-30 19:43:30</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="appricationrbの設定" class="fragment"></span><a href="#appricationrb%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>apprication.rbの設定</h2>

<p>日本メインで、英語でも読めるようにする設定</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/application.rb</span></div>
<div class="highlight"><pre><span></span>    <span class="n">config</span><span class="o">.</span><span class="n">i18n</span><span class="o">.</span><span class="n">load_path</span> <span class="o">+=</span> <span class="no">Dir</span><span class="o">[</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'config'</span><span class="p">,</span> <span class="s1">'locales'</span><span class="p">,</span> <span class="s1">'**'</span><span class="p">,</span> <span class="s1">'*.{rb,yml}'</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span><span class="o">]</span>
    <span class="n">config</span><span class="o">.</span><span class="n">i18n</span><span class="o">.</span><span class="n">default_locale</span> <span class="o">=</span> <span class="ss">:ja</span>
    <span class="n">config</span><span class="o">.</span><span class="n">i18n</span><span class="o">.</span><span class="n">available_locales</span> <span class="o">=</span> <span class="o">[</span><span class="ss">:ja</span><span class="p">,</span> <span class="ss">:en</span><span class="o">]</span>
    <span class="n">config</span><span class="o">.</span><span class="n">time_zone</span> <span class="o">=</span> <span class="s1">'Tokyo'</span>
</pre></div>
</div>

<h2>
<span id="activerecordの日本語化用テンプレート" class="fragment"></span><a href="#activerecord%E3%81%AE%E6%97%A5%E6%9C%AC%E8%AA%9E%E5%8C%96%E7%94%A8%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>ActiveRecordの日本語化用テンプレート</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/locales/01_model/ja.yml</span></div>
<div class="highlight"><pre><span></span><span class="ss">ja</span><span class="p">:</span>
  <span class="ss">activerecord</span><span class="p">:</span>
    <span class="ss">errors</span><span class="p">:</span>
      <span class="ss">template</span><span class="p">:</span>
        <span class="ss">header</span><span class="p">:</span>
          <span class="ss">one</span><span class="p">:</span>   <span class="s2">"%{model}にエラーが発生しました。"</span>
          <span class="ss">other</span><span class="p">:</span> <span class="s2">"%{model}に%{count}つのエラーが発生しました。"</span>
        <span class="ss">body</span><span class="p">:</span> <span class="s2">"次の項目を確認してください。"</span>
      <span class="ss">messages</span><span class="p">:</span>
        <span class="ss">taken</span><span class="p">:</span> <span class="s2">"はすでに存在します。"</span>
        <span class="ss">record_invalid</span><span class="p">:</span> <span class="s2">"バリデーションに失敗しました。 %{errors}"</span>
      <span class="ss">full_messages</span><span class="p">:</span>
        <span class="nb">format</span><span class="p">:</span> <span class="s2">"[%{attribute}]%{message}"</span>
      <span class="ss">models</span><span class="p">:</span>
        <span class="ss">user</span><span class="p">:</span>
          <span class="ss">attributes</span><span class="p">:</span>
            <span class="ss">base</span><span class="p">:</span>
              <span class="ss">restricted</span><span class="p">:</span>  <span class="s2">"制限付きユーザーには許可されていない動作です"</span>
            <span class="ss">company_id</span><span class="p">:</span>
              <span class="ss">user_not_working_for</span><span class="p">:</span> <span class="s2">"ユーザが所属していない会社です"</span>
    <span class="ss">models</span><span class="p">:</span>
      <span class="ss">user</span><span class="p">:</span> <span class="err">ユーザー</span>
      <span class="ss">company</span><span class="p">:</span> <span class="err">会社</span>
    <span class="ss">attributes</span><span class="p">:</span>
      <span class="ss">user</span><span class="p">:</span>
        <span class="nb">name</span><span class="p">:</span> <span class="err">名前</span>
        <span class="ss">age</span><span class="p">:</span> <span class="err">年齢</span>
      <span class="ss">company</span><span class="p">:</span>
        <span class="nb">name</span><span class="p">:</span> <span class="err">会社名</span>
    <span class="n">attribute_values</span>
       <span class="c1">#...</span>
    <span class="n">enum</span>
       <span class="c1">#...</span>
</pre></div>
</div>

<h2>
<span id="解説" class="fragment"></span><a href="#%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>解説</h2>

<p><code>config.i18n.load_path</code>の設定でconfig/locales以下のどの階層のディレクトリも読み込ませるようにしておくのがミソ。<br>
こうすることで、ディレクトリを分けることでカテゴリごとにi18nのデータを管理することができる様になる。</p>

<p>各言語用ymlファイルは、<code>01_model</code>というように数値のprefixをつけたディレクトリに入れ、以下の様な構成にする。</p>

<ul>
<li>config/locales/00_base/ja.yml</li>
<li>config/locales/01_model/ja.yml</li>
<li>config/locales/02_mailer/ja.yml</li>
<li>config/locales/99_adhoc/ja.yml</li>
</ul>

<p>YAMLは同じキーがあった場合は内容を上書きするので、00などをつけて順番を選べるようにしておくと都合が良い。<br>
辞書順に上から読み込まれて行くので、内容がコンフリクトした場合は数値が大きいほうの設定が使われる様になる。</p>

<p>ちなみに、00_base/ja.ymlは<a href="https://github.com/svenfuchs/rails-i18n" rel="nofollow noopener" target="_blank">rails-i18n</a>のデータを丸コピーしたものを使う、もしくは<code>gem install</code>する。<br>
( <a href="https://github.com/svenfuchs/rails-i18n/blob/master/rails/locale/ja.yml" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/svenfuchs/rails-i18n/blob/master/rails/locale/ja.yml</a> )</p>

<p>enの設定もする際は、完全にja.ymlと1対1対応するように<code>config/locales/01_model/en.yml</code>を記述しておいたほうが無難。これは(i18n-spec)[<a href="https://github.com/tigrish/i18n-spec%5D%E3%81%A7%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%93%E3%81%A8%E3%81%A7%E4%BF%9D%E8%A8%BC%E3%81%A7%E3%81%8D%E3%82%8B%E3%80%82" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/tigrish/i18n-spec]でテストを書くことで保証できる。</a><br>
実際、英語の場合、Localeファイルをちゃんと設定しなくてもモデル名や属性名そのままでいいみたいなことが多いので、特に設定しなくてもあまり困らない。しかし、</p>

<ul>
<li>後々メンテナンスする時、各言語でキーが同じ順、同じ行数でないとミスが起こりやすくなる。</li>
<li>
<a href="https://github.com/fnando/i18n-js" rel="nofollow noopener" target="_blank">i18n-js</a>などを使ってJavascript連携するとき、en.ymlに対応する英語が無いとうまくいかない。</li>
</ul>

<p>といった理由で、少々手間でも、はじめから全てを書いておくことを推奨する。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>96</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/8d2192fa842ae3079589">D3.jsを学習する際に見ると良いドキュメント</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-01-08 18:23:46</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[d3]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="1-examples" class="fragment"></span><a href="#1-examples"><i class="fa fa-link"></i></a>1. Examples</h2>

<p>まず見るべきなは、実際に動かせる例がたくさん存在するギャラリーページ<br>
<a href="https://github.com/mbostock/d3/wiki/Gallery" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mbostock/d3/wiki/Gallery</a></p>

<p>最初は、上の方にあるのを幾つかクリックして「すごーい」と思えばいい。ただ、実際はちょっと下にある"Basic Charts", "Techniques, Interaction &amp; Animation"という部分のほうが自分で使うとなった場合、参考になるはず。</p>

<h2>
<span id="2-introduction" class="fragment"></span><a href="#2-introduction"><i class="fa fa-link"></i></a>2. Introduction</h2>

<p>次に見るのはIntroductionページ<br>
<a href="http://d3js.org/" class="autolink" rel="nofollow noopener" target="_blank">http://d3js.org/</a></p>

<p>ここはd3jsのトップページでありながらドキュメントのIntroductionも兼ねている。<br>
...が、ここを読んでも全く使えるようになった気がしない。</p>

<p>ただ、</p>

<ul>
<li>Selections</li>
<li>Dynamic Properties</li>
<li>Enter and Exit</li>
<li>Transformation not Representation</li>
<li>Transitions</li>
</ul>

<p>という５項目のみがセクション名になるほど大事で、これさえわかってしまえば使えるんだろうなという感覚を持っておくと気が遠くならずに済む。</p>

<h2>
<span id="3-documentation" class="fragment"></span><a href="#3-documentation"><i class="fa fa-link"></i></a>3. Documentation</h2>

<p>次に、Documentationページをチェック<br>
<a href="https://github.com/mbostock/d3/wiki" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mbostock/d3/wiki</a></p>

<p>ただ、ここはリンク集みたいになっていて、コンテンツではないことが分かる。<br>
なにか疑問に思った時に、ぱっと自分でコード書いて動かせるようにここでd3.jsのInstallだけしておこう。</p>

<h2>
<span id="4-tutorial--api-reference" class="fragment"></span><a href="#4-tutorial--api-reference"><i class="fa fa-link"></i></a>4. Tutorial &amp; API Reference</h2>

<p>次に見るのは、</p>

<p>チュートリアル一覧ページ<br>
<a href="https://github.com/mbostock/d3/wiki/Tutorials" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mbostock/d3/wiki/Tutorials</a></p>

<p>APIリファレンス<br>
<a href="https://github.com/mbostock/d3/wiki/API-Reference" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mbostock/d3/wiki/API-Reference</a></p>

<p>のどちらか、というか併用。</p>

<p>チュートリアルは理解しやすいけれど、網羅的に理解するのは不向き。こういうのしか読まないと、ある程度使えるようにはなるけれど、同じ事を行うより良い方法を見逃してしまったりする。</p>

<p>逆にAPIリファレンスは、出来ることの全てが書かれているのでこれさえ把握すれば出来ることを理解しきったと言えるけれども、普通の人間であればこれをそのまま読むのは苦痛なはず。</p>

<p>なのでチュートリアルを読み進めつつ、その時出てきた部分のAPIリファレンスを参照するという。こうすることで、網羅性も確保しつつ、重要なAPIの部分から読んでいくことが可能になる。</p>

<h3>
<span id="selections--enter-and-exit" class="fragment"></span><a href="#selections--enter-and-exit"><i class="fa fa-link"></i></a>Selections / Enter and Exit</h3>

<p>D3を使う上で特に大事な、データに追従して要素を作ったり更新したり削除したりする仕組みのチュートリアル<br>
<a href="http://bost.ocks.org/mike/join/" class="autolink" rel="nofollow noopener" target="_blank">http://bost.ocks.org/mike/join/</a></p>

<p>重要な部分は、<code>enter</code>、<code>update</code>、<code>exit</code>という名前のvirtual selectorが作成され、それぞれ新規要素、既存要素、削除された要素が入っているという部分</p>

<blockquote>
<p>The data method binds data to elements, producing three virtual selections: enter, update and exit. The enter selection contains placeholders for any missing elements. The update selection contains existing elements, bound to data. Any remaining elements end up in the exit selection for removal.</p>
</blockquote>

<p>これに伴い、selection.dataのAPIリファレンスを読んでおくと理解も深まる<br>
<a href="https://github.com/mbostock/d3/wiki/Selections#wiki-data" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mbostock/d3/wiki/Selections#wiki-data</a></p>

<p><a href="https://github.com/mbostock/d3/wiki/SVG-Shapes" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mbostock/d3/wiki/SVG-Shapes</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>93</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/d53ab583f214703f6afa">RailsアプリでPDFを出力する (Heroku対応)</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-07 08:31:25</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> <b>[PDF]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>wicked_pdf</code>というGemを使うとHTMLを元にPDFを生成できるのでこれを使う。</p>

<h2>
<span id="gem" class="fragment"></span><a href="#gem"><i class="fa fa-link"></i></a>Gem</h2>

<p><code>wicked_pdf</code>は、<code>wkhtmltopdf</code>コマンドを叩くという実装になっているので、まずはそのバイナリをインストールする必要がある。<br>
普通にインストールしてもいいのだが、<code>wkhtmltopdf-binary</code> gemで入れることをお薦めする。これで、<code>wkhtmltopdf</code>をインストールする必要があることを知らない他のメンバーのPCでも動き、Herokuでも動くアプリになる。</p>

<p>結果Gemfileは以下のようになる。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s1">'wkhtmltopdf-binary'</span>
<span class="n">gem</span> <span class="s1">'wicked_pdf'</span>
</pre></div>
</div>

<p>やらなくてもいいのかもしれないが、本家ドキュメントに書かれているので、PDFのMimeタイプも設定しておく。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/initializers/mime_types.rb</span></div>
<div class="highlight"><pre><span></span><span class="no">Mime</span><span class="o">::</span><span class="no">Type</span><span class="o">.</span><span class="n">register</span> <span class="s2">"application/pdf"</span><span class="p">,</span> <span class="ss">:pdf</span>
</pre></div>
</div>

<p>後は表示用にroutes, controller, view, layoutを作成していく。</p>

<h2>
<span id="controller" class="fragment"></span><a href="#controller"><i class="fa fa-link"></i></a>Controller</h2>

<p>ここでは<code>http://localhost:3000/pdf/sample.pdf</code>でアクセスできるようなページを作る。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<div class="highlight"><pre><span></span><span class="no">Your</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:pdf</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[]</span> <span class="k">do</span>
    <span class="n">get</span> <span class="ss">:sample</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/pdfs_controller</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PdfsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">sample</span>
    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">sample_pdf_path</span><span class="p">(</span><span class="nb">format</span><span class="p">:</span> <span class="ss">:pdf</span><span class="p">,</span> <span class="ss">debug</span><span class="p">:</span> <span class="mi">1</span><span class="p">)}</span>
      <span class="nb">format</span><span class="o">.</span><span class="n">pdf</span> <span class="k">do</span>
        <span class="n">render</span> <span class="ss">pdf</span><span class="p">:</span> <span class="s1">'sample'</span><span class="p">,</span>
               <span class="ss">encoding</span><span class="p">:</span> <span class="s1">'UTF-8'</span><span class="p">,</span>
               <span class="ss">layout</span><span class="p">:</span> <span class="s1">'pdf.html'</span><span class="p">,</span>
               <span class="ss">show_as_html</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:debug</span><span class="o">].</span><span class="n">present?</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>Contllorの注意点：</p>

<ul>
<li>layoutはControllerにつけるlayoutは効かないので、個別に設定してあげる。</li>
<li>
<code>debug=1</code>でアクセスした時HTML表示できるようにしておく。そうするとうまくPDFが生成されない時、HTML出力の時点で失敗しているのか、<code>wkhtmltopdf</code>でPDFを生成するときに失敗しているのかが区別できる。</li>
<li>
<code>.pdf</code>をつけずにhtmlでアクセスした場合はdebug用のhtml表示するようにしておく。PDF出力したい場合、そのURLでHTMLも、JSONも、PDFもなんてことはなかなかないと思うので、これが一番いい気がする。</li>
</ul>

<h2>
<span id="view" class="fragment"></span><a href="#view"><i class="fa fa-link"></i></a>View</h2>

<div class="code-frame" data-lang="haml">
<div class="code-lang"><span class="bold">app/views/layout/pdf.html.haml</span></div>
<div class="highlight"><pre><span></span><span class="nn">!!!</span>
<span class="nt">%html</span>
  <span class="nt">%head</span>
    <span class="nt">%meta</span><span class="p">{</span> <span class="ss">charset</span><span class="p">:</span> <span class="s2">"utf-8"</span> <span class="p">}</span>
    <span class="p">=</span> <span class="n">wicked_pdf_stylesheet_link_tag</span> <span class="s1">'pdf'</span>
  <span class="nt">%body</span>
    <span class="p">=</span> <span class="k">yield</span>
</pre></div>
</div>

<div class="code-frame" data-lang="haml">
<div class="code-lang"><span class="bold">app/views/pdfs/sample.pdf.haml</span></div>
<div class="highlight"><pre><span></span><span class="nt">%h1</span> hoge
<span class="nt">%h2</span> あいうえお
<span class="nt">%h3</span> 愛上尾
<span class="p">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:debug</span><span class="o">].</span><span class="n">present?</span> <span class="p">?</span> <span class="n">image_tag</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span> <span class="p">:</span> <span class="n">wicked_pdf_image_tag</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span>
</pre></div>
</div>

<p>個別viewの拡張子はデフォルトで<code>.pdf</code>を見に行くので注意。<br>
変えたい場合は、<code>pdf</code>オプションではなく、<code>templete</code>や<code>file</code>オプションで指定することによって対象のテンプレートファイルを変更できる。</p>

<div class="code-frame" data-lang="css">
<div class="code-lang"><span class="bold">app/assets/stylesheets/pdf.css.scss</span></div>
<div class="highlight"><pre><span></span><span class="nt">html</span> <span class="p">{</span>
  <span class="k">font-family</span><span class="p">:</span> <span class="s1">'IPAexゴシック'</span><span class="p">,</span> <span class="s1">'IPA Pゴシック'</span><span class="p">,</span> <span class="s1">'ヒラギノ角ゴ ProN W3'</span><span class="p">,</span> <span class="s1">'Hiragino Kaku Gothic ProN'</span><span class="p">,</span> <span class="s1">'メイリオ'</span><span class="p">,</span> <span class="n">Meiryo</span><span class="p">,</span> <span class="s1">'MS Pゴシック'</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="font" class="fragment"></span><a href="#font"><i class="fa fa-link"></i></a>Font</h2>

<p>Herokuだと日本語フォントが存在しなくて出力されないなどということがあるので、世の中にあるTrue Typeフォントを取ってこないといけない。<br>
フリーでダウンロードできる普通っぽいフォントだとIPAフォントがいい気がした。</p>

<ul>
<li><a href="http://ipafont.ipa.go.jp/" class="autolink" rel="nofollow noopener" target="_blank">http://ipafont.ipa.go.jp/</a></li>
</ul>

<p>今回はこの中のIPAexゴシックのみ使ってみる。Herokuの場合<code>.fonts</code>ディレクトリを作成し、その中に<code>.ttf</code>ファイルを放り込めば良い。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">bash</span></div>
<div class="highlight"><pre><span></span>$ tree .fonts/
.fonts/
└── ipaexg.ttf
</pre></div>
</div>

<p>後は生成したいPDFのHTMLとCSSを書くだけ！！(これが一番大変だけど・・・)</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<ul>
<li><a href="https://github.com/mileszs/wicked_pdf" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mileszs/wicked_pdf</a></li>
<li><a href="http://d.hatena.ne.jp/deeeki/20120902/heroku_wkhtmltopdf_fonts" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/deeeki/20120902/heroku_wkhtmltopdf_fonts</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>93</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/846038c47f51c6b90c64">RailsでActiveRecordとMongoidの共存のさせ方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-24 00:49:52</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> <b>[MongoDB]</b> <b>[Heroku]</b> <b>[mongoid]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="背景" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF"><i class="fa fa-link"></i></a>背景</h2>

<p>Herokuで適当にスキーマレスなデータをOutput出来る場所がほしい！でも、Herokuはディスクが自由に使えないので、text書き出しができない！！<br>
こんな要求の解決法としては、textタイプのフィールドを作って<code>serialize</code>や<code>store</code>を使うのが一つの手。ただ、割と書き込みが多い事が想定され、無駄に大切なPostgreSQLサーバーに負荷をかけてしまう。<br>
そんなこんなでスキーマレスな出力場所としてMongoDBを使うというアイデアが持ち上がった。HerokuではMongoHQなら16M、MongoLabなら0.5Gが無料で使える。<br>
なお、基本的に、MongoDBをサブとして使うので<code>rails g model</code>などをした時に<code>mongoid</code>がinvokeされるのは避けたい。</p>

<h2>
<span id="実践" class="fragment"></span><a href="#%E5%AE%9F%E8%B7%B5"><i class="fa fa-link"></i></a>実践</h2>

<div class="code-frame" data-lang="Gemfile"><div class="highlight"><pre><span></span>gem 'mongoid'
gem 'bson_ext' # accelerate BSON serialization
</pre></div></div>

<p>して、<code>bundle install</code></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rails generate mongoid:config
</pre></div></div>

<p>すると、<code>config/mongoid.yml</code>にdevelopmentとtestの設定が生成されるので、ここにconfigurationを書く。基本的には変更する必要がないが、<code>database</code>, <code>username</code>, <code>password</code>あたりの書き換え、書き足しだけチェックしてみればいいのではないだろうか？</p>

<p><code>production</code>の設定はHerokuのAdd-onのドキュメント通りにすれば良いと思う。MongoHQのドキュメントの方が詳しく書かれていたのでこっちを参照した。使ったのはMongoLabだけど(笑)</p>

<p><a href="http://mongoid.org/en/mongoid/docs/installation.html" class="autolink" rel="nofollow noopener" target="_blank">http://mongoid.org/en/mongoid/docs/installation.html</a><br>
にそれぞれオプションが詳しく載っている。</p>

<p>mongoidのモデルは<code>rails generate model</code>でできるようになっている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rails generate model user_mongo name:string
    invoke  mongoid
    create    app/models/user_mongo.rb
</pre></div></div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/user_mongo.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserMongo</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>
</pre></div>
</div>

<p>ということは、ActiveRecordのmodelを作るとき、<code>active_record:</code>とprefixをつける必要がある。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rails generate acrive_record:model
</pre></div></div>

<p>これは<code>migration</code>コマンドやgemの<code>devise</code>などでも同様。</p>

<p>これが困る場合、<code>application.rb</code>に</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/application.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">generators</span> <span class="k">do</span> <span class="o">|</span><span class="n">g</span><span class="o">|</span>
  <span class="n">g</span><span class="o">.</span><span class="n">orm</span> <span class="ss">:active_record</span>
<span class="k">end</span>
</pre></div>
</div>

<p>と追加すれば良い。このときmongoidのモデルを作るときは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rails generate mongoid:model
</pre></div></div>

<p>とする。</p>

<p>最後に、Mongoidの使い方は、適当に自分で調べて使ってみれば意外と簡単に使えると思うが、<a href="http://mongoid.org/en/mongoid/docs/relations.html" class="autolink" rel="nofollow noopener" target="_blank">http://mongoid.org/en/mongoid/docs/relations.html</a> は読んでおくと良いと思う。多分ActiveRecordとはちょっと違っていて難しいであろう、Relation/Associationのあたりの話がちゃんと書いてある。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/6372626/using-active-record-generators-after-mongoid-installation" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/6372626/using-active-record-generators-after-mongoid-installation</a></li>
<li><a href="http://mongoid.org/en/mongoid/" class="autolink" rel="nofollow noopener" target="_blank">http://mongoid.org/en/mongoid/</a></li>
<li><a href="https://devcenter.heroku.com/articles/mongohq" class="autolink" rel="nofollow noopener" target="_blank">https://devcenter.heroku.com/articles/mongohq</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>90</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/9a0dec41d91c997c74b4">Mecabに人名辞書を追加</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-04 23:10:13</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[mecab]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Mecabに新しい単語を追加したくなることは多々あるはず。<br>
今回は人名の例で解説する。</p>

<h2>
<span id="人名追加に必要となる知識" class="fragment"></span><a href="#%E4%BA%BA%E5%90%8D%E8%BF%BD%E5%8A%A0%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%A8%E3%81%AA%E3%82%8B%E7%9F%A5%E8%AD%98"><i class="fa fa-link"></i></a>人名追加に必要となる知識</h2>

<h3>
<span id="重要なリンク" class="fragment"></span><a href="#%E9%87%8D%E8%A6%81%E3%81%AA%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>重要なリンク</h3>

<p>Mecab公式「単語の追加方法」<br>
<a href="http://mecab.googlecode.com/svn/trunk/mecab/doc/dic.html" class="autolink" rel="nofollow noopener" target="_blank">http://mecab.googlecode.com/svn/trunk/mecab/doc/dic.html</a></p>

<p>人名辞書一覧<br>
<a href="http://www.mwsoft.jp/programming/munou/ime_dictionary_link.html#person" class="autolink" rel="nofollow noopener" target="_blank">http://www.mwsoft.jp/programming/munou/ime_dictionary_link.html#person</a></p>

<h3>
<span id="辞書の追加先" class="fragment"></span><a href="#%E8%BE%9E%E6%9B%B8%E3%81%AE%E8%BF%BD%E5%8A%A0%E5%85%88"><i class="fa fa-link"></i></a>辞書の追加先</h3>

<p>まず、システム辞書として追加するか、ユーザー辞書として追加するかが問題となる。<br>
人名辞書の項目は大抵万を超えるので、解析速度のことを考え、システム辞書に追加するのが妥当と考えられる。</p>

<blockquote>
<p>辞書更新が頻繁でないときや, 解析速度を落としたくない時は, 直接 システム辞書を変更するのがよいでしょう.</p>

<p>mecab-ipadic があるディレクトリに移動<br>
foo.csv というファイルを作成 (拡張子が .csv なら何でも可)<br>
foo.csv に単語を追加<br>
辞書の再コンパイル + インストール</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% /usr/local/libexec/mecab/mecab-dict-index -f euc-jp -t euc-jp
% su
# make install 
</pre></div></div>

<ul>
<li>f charset: CSVの文字コード</li>
<li>t charset: バイナリ辞書の文字コード</li>
</ul>

<p>例: utf-8の辞書を作成する例</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% /usr/local/libexec/mecab/mecab-dict-index -f euc-jp -t utf8
</pre></div></div>
</blockquote>

<h3>
<span id="エントリのフォーマット" class="fragment"></span><a href="#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>エントリのフォーマット</h3>

<p>公式サイトには以下のように書いてある。</p>

<blockquote>
<p>システム辞書, ユーザ辞書, ともにエントリのフォーマットは同一です.</p>

<p>エントリは, 以下のような CSV で追加します. 名詞などの活用しない語だと, 登録は簡単です.</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>工藤,1223,1223,6058,名詞,固有名詞,人名,名,*,*,くどう,クドウ,クドウ
</pre></div></div>

<p>左から,</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>表層形,左文脈ID,右文脈ID,コスト,品詞,品詞細分類1,品詞細分類2,品詞細分3,活用形,活用型,原形,読み,発音
</pre></div></div>

<p>です.</p>

<p>左文脈IDは, その単語を左から見たときの内部状態IDです. 通常システム 辞書と同一場所にある left-id.def から該当する ID を選択します. 空にしておくと mecab-dict-index が自動的に ID を付与します.</p>

<p>右文脈IDは, その単語を右から見たときの内部状態IDです. 通常システム 辞書と同一場所にある right-id.def から該当する ID を選択します. 空にしておくと, mecab-dict-index が自動的に ID を付与します.</p>

<p>コストは,その単語がどれだけ出現しやすいかを示しています. 小さいほど, 出現しやすいという意味になります. 似たような単語と 同じスコアを割り振り, その単位で切り出せない場合は, 徐々に小さくしていけばいいと思います.</p>
</blockquote>

<p>人名の品詞分類としては、以下の3通りあるのでどれかを選ぶ。<br>
自分の持っている辞書が名前か姓かわからないとしたら一般を選べばいいのだろう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>名詞,固有名詞,人名,一般
名詞,固有名詞,人名,姓
名詞,固有名詞,人名,名
</pre></div></div>

<p>ちなみに、例の<code>工藤</code>は<code>名詞,固有名詞,人名,名</code>ではなく<code>"名詞,固有名詞,人名,性</code>な気がして仕方がない。まぁシステム的には姓でも名でもあんまり関係ないんだろうけれど。</p>

<p>とりあえず、テンプレとして以下のものを用意した。</p>

<p><code>kanji</code>,<code>hiragana</code>,<code>katakana</code>がスクリプト等で入力すべき部分。大体の辞書は、読みはカタカナかひらがなかどちらか一つで記載されているので、<code>nkf --hiragana</code>, <code>nkf --katakana</code>を使って変換すると良いだろう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>${kanji},,,10000,名詞,固有名詞,人名,一般,*,*,${hiragana},${katakana},${katakana}
</pre></div></div>

<p>ここで、難しいのは<code>左文脈ID,右文脈ID,コスト</code>の部分。</p>

<h3>
<span id="左右文脈id" class="fragment"></span><a href="#%E5%B7%A6%E5%8F%B3%E6%96%87%E8%84%88id"><i class="fa fa-link"></i></a>左右文脈ID</h3>

<p>まず、<code>左文脈ID,右文脈ID</code>は空けておけば自動で埋めてくれるとある。<br>
昔は空じゃなくて<code>-1</code>を入れていると良かったみたいだが変わっているので注意。</p>

<p>もしくは、<code>Noun.name.csv</code>や<code>left-id.def</code>/<code>right-id.def</code>を見ると人名に関しては、idは以下のようになっているとわかるので直接記述しても良い。<br>
(注：left-idやright-idは辞書のバージョンによって違うので気をつけること。)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>1289,1289,?,名詞,固有名詞,人名,一般
1290,1290,?,名詞,固有名詞,人名,姓
1291,1291,?,名詞,固有名詞,人名,名
</pre></div></div>

<h3>
<span id="コスト" class="fragment"></span><a href="#%E3%82%B3%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>コスト</h3>

<p>次はコスト。<br>
モデルデータがあれば自動推定も出来る。</p>

<p>モデルデータは<br>
<a href="https://code.google.com/p/mecab/downloads/detail?name=mecab-ipadic-2.7.0-20070801.model.bz2" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/mecab/downloads/detail?name=mecab-ipadic-2.7.0-20070801.model.bz2</a><br>
からダウンロードでき、<br>
<code>mecab-dict-index</code>コマンドに<code>-m model_file</code>とオプションを渡し、<br>
コストの部分を空白にしたまま解析させる。</p>

<p>ただ、学習データのスパースネスを考えると、再学習させてホントにいい結果が得られるとも限らないけれど。</p>

<p>手動で設定する場合は、「はてなキーワード」カテゴリをMecab辞書に追加している例( <a href="http://d.hatena.ne.jp/code46/20090531/p1" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/code46/20090531/p1</a> )とこれが参考にしている公式ケーススタディー( <a href="http://mecab.googlecode.com/svn/trunk/mecab/doc/dic-detail.html" class="autolink" rel="nofollow noopener" target="_blank">http://mecab.googlecode.com/svn/trunk/mecab/doc/dic-detail.html</a> )が参考になる。<br>
ここでは、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cost = (int)max(-36000, -400 * (length^1.5)) 
</pre></div></div>

<p>とコストが負の値までぶっ飛んでいるが、今回の場合は、既存カテゴリに追加するので、ここまでぶっ飛ぶと困るはず。<br>
ここでは、短い文字ほど高めにして、長い文字ほど低めにしたら良いということだけ分かれば良さそう。<br>
<code>Noun.name.csv</code>を見ると大体2文字の名前で7000から9000前後なので、まぁ少し自信無さげに10000を入れている。<br>
本来、長い名前ほど低いコストにしないといけないので、適当に<code>10000 - length * 500</code>みたいにしても良いかも。</p>

<h2>
<span id="macの場合で実践" class="fragment"></span><a href="#mac%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%A7%E5%AE%9F%E8%B7%B5"><i class="fa fa-link"></i></a>Macの場合で実践</h2>

<p>mecabとipadicのインストール。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>brew install mecab mecab-ipadic
</pre></div></div>

<p>こうすると執筆現在で以下のバージョンが入る。</p>

<ul>
<li>mecab-0.996</li>
<li>mecab-ipadic-2.7.0-20070801</li>
</ul>

<p>ちなみに、Macではデフォルトで、<code>--with-charset=utf8</code>が付いているので辞書の文字コードは<code>euc-jp</code>でなく<code>utf-8</code>だと思って大丈夫。<br>
<a href="https://github.com/mxcl/homebrew/blob/master/Library/Formula/mecab-ipadic.rb" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mxcl/homebrew/blob/master/Library/Formula/mecab-ipadic.rb</a></p>

<p>こういう風に入れると、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/usr/local/Cellar/mecab/0.996/lib/mecab/dic/ipadic
</pre></div></div>

<p>にmecab-ipadic-2.7.0-20070801が入るのだが、csvファイルなどが無い最小限の構成になってしまっている。なので</p>

<ul>
<li><a href="http://sourceforge.net/projects/mecab/files/mecab-ipadic/2.7.0-20070801/" class="autolink" rel="nofollow noopener" target="_blank">http://sourceforge.net/projects/mecab/files/mecab-ipadic/2.7.0-20070801/</a></li>
</ul>

<p>からオリジナルをダウンロードしてきて内容を置き換える。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>cp Download/mecab-ipadic-2.7.0-20070801/* /usr/local/Cellar/mecab/0.996/lib/mecab/dic/ipadic/
</pre></div></div>

<p>(まぁそもそもこれをダウンロードして直接インストールしてもいいのだが、環境をbrewに統一したままだと色々と楽な気がする。)</p>

<p>辞書データを他のcsvファイルに合わせEUC-JPで作成する。</p>

<div class="code-frame" data-lang="csv">
<div class="code-lang"><span class="bold">example.csv</span></div>
<div class="highlight"><pre><span></span>直視,,,10000,名詞,固有名詞,人名,名,*,*,なおよし,ナオヨシ,ナオヨシ
</pre></div>
</div>

<p>これを基に、UTF-8の辞書を出力する。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>/usr/local/Cellar/mecab/0.996/libexec/mecab/mecab-dict-index -f euc-jp -t utf-8 
</pre></div></div>

<p>これだけで、今まで参照していた辞書が新しく生成された辞書に置き換わる。</p>

<p>ちゃんと置き換わったか実験。(<code>-N</code>オプションをつけると解析の候補を優先度順に出してくれるので、コスト等の調整に参考になる。)</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ mecab -N3                                                                      
相川直視
相川  名詞,固有名詞,人名,姓,*,*,相川,アイカワ,アイカワ
直視  名詞,固有名詞,人名,名,*,*,なおよし,ナオヨシ,ナオヨシ
EOS
相川  名詞,固有名詞,人名,姓,*,*,相川,アイカワ,アイカワ
直視  名詞,サ変接続,*,*,*,*,直視,チョクシ,チョクシ
EOS
相川  名詞,固有名詞,人名,姓,*,*,相川,アイカワ,アイカワ
直 名詞,固有名詞,人名,名,*,*,直,タダシ,タダシ
視 名詞,接尾,サ変接続,*,*,*,視,シ,シ
EOS
</pre></div></div>

<p>ちゃんと、普通には読めないはずの僕の名前がちゃんと解析されるようになっている。</p>

<p>はい、自己満足でした！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>89</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/f7c7e3cc38b90994c783">Railsでmemcacheを使ってobjectをキャッシュ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-18 17:49:28</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><ul>
<li>Page Cache</li>
<li>Action Cache</li>
<li>Fragment Cache</li>
</ul>

<p>とかじゃなくて普通にObjectをStoreしたいんだよって時に。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s1">'dalli'</span>
</pre></div>
</div>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">config/environments/production.rb</span></div>
<div class="highlight"><pre><span></span>config.cache_store = :dalli_store
</pre></div>
</div>

<p>として以下のように使う。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"key"</span><span class="p">)</span>   <span class="c1"># =&gt; nil</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"key"</span><span class="p">,</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="ss">expires_in</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>  <span class="c1"># １時間で消える。</span>
<span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"key"</span><span class="p">)</span>   <span class="c1"># =&gt; [1, 2, 3]</span>
</pre></div></div>

<p>キーはシンボル(i.e. <code>:key</code>)にしてもOK</p>

<p>実際使うときは</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">"hoge_key"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">hoge</span><span class="o">.</span><span class="n">nil?</span>
  <span class="n">hoge</span> <span class="o">=</span> <span class="n">get_hoge_value</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span>
  <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"hoge_key"</span><span class="p">,</span> <span class="n">hoge</span><span class="p">,</span> <span class="ss">expires_in</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div>

<p>ってな感じになるはず。<br>
これは<code>fetch</code>を使って、以下のようにも書ける。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s2">"hoge_key"</span><span class="p">,</span> <span class="ss">expires_in</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">get_hoge_value</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div>

<p>基本はこっちしか使わないはず。</p>

<p>writeやfetchのオプションに<code>compress: true</code>を渡すとデータを圧縮してくれる。encode/decodeの時間はかかるだろうけど、通信量が削減されるので結果速くなることも。<br>
実際、デフォルトで16Kの<code>:compress_threshold</code>が設定されてるらしいので、元データが圧縮済みのデータじゃない限り、つけておけばいい気がする。</p>

<h2>
<span id="参照" class="fragment"></span><a href="#%E5%8F%82%E7%85%A7"><i class="fa fa-link"></i></a>参照</h2>

<p><a href="http://api.rubyonrails.org/classes/ActiveSupport/Cache/Store.html" class="autolink" rel="nofollow noopener" target="_blank">http://api.rubyonrails.org/classes/ActiveSupport/Cache/Store.html</a><br>
<a href="http://guides.rubyonrails.org/caching_with_rails.html" class="autolink" rel="nofollow noopener" target="_blank">http://guides.rubyonrails.org/caching_with_rails.html</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>78</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/d417c735b869a4db5abc">with_indexが便利だという話とstable_sort_by</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-11 10:49:47</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Rubyはいろんなことがone lineで書けて便利ですよね。</p>

<p>いろんなことを1行に書けるようにするには</p>

<p><a href="http://ruby-doc.org/core-2.0.0/String.html" rel="nofollow noopener" target="_blank">String</a>, <a href="http://ruby-doc.org/core-2.0.0/Array.html" rel="nofollow noopener" target="_blank">Array</a>, <a href="http://ruby-doc.org/core-2.0.0/Hash.html" rel="nofollow noopener" target="_blank">Hash</a>, <a href="http://ruby-doc.org/core-2.0.0/Enumerable.html" rel="nofollow noopener" target="_blank">Enumerable</a></p>

<p>あたりの、リスト系の構造になったものにどういうメソッドがあるかを覚えておけば、たいていのことは1行で書けます。</p>

<p>今回の話は、これに加えて、</p>

<p><a href="http://ruby-doc.org/core-2.0.0/Enumerator.html" rel="nofollow noopener" target="_blank">Enumerator</a></p>

<p>のメソッドも知っておくともっと世界が広がるよという話です。</p>

<h2>
<span id="map_with_indexが欲しい" class="fragment"></span><a href="#map_with_index%E3%81%8C%E6%AC%B2%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>map_with_indexが欲しい！</h2>

<p>例えば、あるユーザーのリストに対して、名前の前に通し番号をふった文字列を出力したい（あんまり無さそうな例でごめんなさい）という要求があったとしましょう。</p>

<p>それをただ出力すれば良いのであれば、<code>each_with_index</code>を使って</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div></div>

<p>とすれば実現できます。</p>

<p>ですが、この結果が配列として欲しいとなると、<code>map</code>を使いたいところですが、<code>map_with_index</code>なんて関数ないしなぁとなります。</p>

<p>これを解決する一つの方法としては、<code>each_with_index</code>の結果を<code>map</code>して</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">each_with_index</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</pre></div></div>

<p>とやる方法があります。</p>

<p>でも、これ、カッコ悪いですよね？</p>

<p>で、調べてみると、ありました！<a href="http://ruby-doc.org/core-2.0.0/Enumerator.html" rel="nofollow noopener" target="_blank">Enumerator</a>の中に<code>with_index</code>というメソッドが！<br>
これを使うと、</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">with_index</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</pre></div></div>

<p>と書くことができ、とても読みやすくなります。<br>
めでたしめでたし。</p>

<p>ちなみに、<code>with_index</code>は何の数値からはじめるかを引数にとることができます。なので、</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">with_index</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</pre></div></div>

<p>として、1-originにすることで<code>i+1</code>と毎回しなくてよくなり、少し綺麗に書くことができます。</p>

<h2>
<span id="with_indexを使って安定ソートを1行で" class="fragment"></span><a href="#with_index%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%AE%89%E5%AE%9A%E3%82%BD%E3%83%BC%E3%83%88%E3%82%921%E8%A1%8C%E3%81%A7"><i class="fa fa-link"></i></a>with_indexを使って安定ソートを1行で</h2>

<p>with_indexにはかなり使える応用があって、それが安定ソート(Stable Sort)です。<br>
何故かRubyはデフォルトで安定ソートが提供されてないんですよね。</p>

<p>例えばFacebookの投稿のようなモデルがあって、それの配列をLike数が多い順、Like数が同じ場合は作られた順でソートしようと思った場合、もし<code>sort_by</code>がstableであれば以下の様なコードでうまくいくはず。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">posts</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:created_at</span><span class="p">)</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:like_count</span><span class="p">)</span>
</pre></div></div>

<p>ですが、多分ソートの内部実装がQuick Sortなため、値が等しい時の順番が崩れてしまいます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>posts.sort_by(&amp;:created_at).sort_by.with_index{ |x,i| x.like_count }
</pre></div></div>

<p>と書いて、2回目のソートをstable sort風にすればone lineで書くことができるようになります。</p>

<h2>
<span id="普通にstable_sort_byを使えるようにする" class="fragment"></span><a href="#%E6%99%AE%E9%80%9A%E3%81%ABstable_sort_by%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>普通にstable_sort_byを使えるようにする</h2>

<p>上でもコマンド上でやるときはいいですが、通常は</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">enumerable.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">module</span> <span class="nn">Enumerable</span>
  <span class="k">def</span> <span class="nf">stable_sort_by</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">sort_by</span><span class="o">.</span><span class="n">with_index</span><span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span> <span class="o">[</span><span class="k">yield</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">index</span><span class="o">]</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>とやった上で、</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">posts</span><span class="o">.</span><span class="n">stable_sort_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:created_at</span><span class="p">)</span><span class="o">.</span><span class="n">stable_sort_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:like_count</span><span class="p">)</span>
</pre></div></div>

<p>のほうが綺麗ですね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />22位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>74</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/d7d9b2ca006b51210ce9">よく使うscaffoldコマンドのオプション</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-25 17:35:58</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h2>

<p>Railsアプリケーション自体は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>rails new App -T
</pre></div></div>

<p>でTest::Unitをスキップして作成して、代わりに<code>rspec</code>と<code>factory-girl</code>を入れた状態を想定。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">Gemfile</span></div>
<div class="highlight"><pre><span></span><span class="n">gem</span> <span class="s1">'rspec-rails'</span>
<span class="n">gem</span> <span class="s1">'factory_girl_rails'</span>
</pre></div>
</div>

<p>railsのバージョンは3.2でも4.0系列でも試している。</p>

<h2>
<span id="使用コマンド" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>使用コマンド</h2>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ rails g scaffold ModelName user:references name description:text amount:integer weight:float active:boolean born_on:date deleted_at:datetime --skip-assets --skip-helper --skip-stylesheets --skip-view-specs --skip-controller-specs --skip-routing-specs --skip-request-specs
</pre></div></div>

<p>jbuilderがいらない場合は以下も</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span> --skip-jbuilder
</pre></div></div>

<h3>
<span id="方針" class="fragment"></span><a href="#%E6%96%B9%E9%87%9D"><i class="fa fa-link"></i></a>方針</h3>

<ul>
<li>Model, View, Controller, Routeは追加</li>
<li>Javascript, CSS用のファイルは無駄に作らない</li>
<li>Helperも大抵いらないので作らない</li>
<li>テストに関してはModelのテストだけを作ってもらう</li>
</ul>

<p>controller-specsに関してはskipしなくてもいいかと思うけど、他のテストは本当に必要なときに自分で作ったんでいいと思う。・・・実際。</p>

<h2>
<span id="結果" class="fragment"></span><a href="#%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>結果</h2>

<div class="code-frame" data-lang="groff">
<div class="code-lang"><span class="bold">rails3.2</span></div>
<div class="highlight"><pre><span></span>      invoke  active_record
      create    db/migrate/20131225083227_create_model_names.rb
      create    app/models/model_name.rb
      invoke    rspec
      create      spec/models/model_name_spec.rb
      invoke      factory_girl
      create        spec/factories/model_names.rb
      invoke  resource_route
       route    resources :model_names
      invoke  scaffold_controller
      create    app/controllers/model_names_controller.rb
      invoke    erb
      create      app/views/model_names
      create      app/views/model_names/index.html.erb
      create      app/views/model_names/edit.html.erb
      create      app/views/model_names/show.html.erb
      create      app/views/model_names/new.html.erb
      create      app/views/model_names/_form.html.erb
      invoke    rspec
      invoke      rspec
      invoke  scss
</pre></div>
</div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">rails4.0</span></div>
<div class="highlight"><pre><span></span>      invoke  active_record
      create    db/migrate/20131225082800_create_model_names.rb
      create    app/models/model_name.rb
      invoke    rspec
      create      spec/models/model_name_spec.rb
      invoke      factory_girl
      create        spec/factories/model_names.rb
      invoke  resource_route
       route    resources :model_names
      invoke  scaffold_controller
      create    app/controllers/model_names_controller.rb
      invoke    erb
      create      app/views/model_names
      create      app/views/model_names/index.html.erb
      create      app/views/model_names/edit.html.erb
      create      app/views/model_names/show.html.erb
      create      app/views/model_names/new.html.erb
      create      app/views/model_names/_form.html.erb
      invoke    rspec
      invoke      rspec
      invoke    jbuilder
      create      app/views/model_names/index.json.jbuilder
      create      app/views/model_names/show.json.jbuilder
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />23位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>73</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/895b3d61311b19737237">VagrantでUbuntuをインストール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-16 16:51:11</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[vagrant]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>まずは以下のURLのDownloadリンクからVirtualBoxをインストール</p>

<blockquote>
<p><a href="https://www.virtualbox.org/" class="autolink" rel="nofollow noopener" target="_blank">https://www.virtualbox.org/</a></p>
</blockquote>

<p>次にvagrantをインストール</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>gem install vagrant
</pre></div></div>

<p>次に入れたいOSを以下のURLから探す。</p>

<p><a href="http://www.vagrantbox.es/" class="autolink" rel="nofollow noopener" target="_blank">http://www.vagrantbox.es/</a></p>

<p>ここから入れたいOSを選んだら、そこに書いてあるurlをコピーして</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant box add {title} {url}
vagrant init {title}
vagrant up
</pre></div></div>

<p>で立てる。<code>{title}</code>は勝手につけて良い名前みたい。</p>

<p>自分は<code>Official Ubuntu 12.10 daily Cloud Image amd64 (Guest Additions)</code>を入れてみた。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant box add ubuntu http://cloud-images.ubuntu.com/quantal/current/quantal-server-cloudimg-vagrant-amd64-disk1.box
</pre></div></div>

<p>ちなみに、Guest Additionsってなんだろうって思って調べると、VirtualBoxのホストOSとゲストOS間でマウスカーソルをうまい感じに移動させるものらしい。入れておいてくれてありがとうってことで深入りしないことに。</p>

<p>この後、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant init ubuntu                                                                          
vagrant up
</pre></div></div>

<p>とやるだけで、LocalにUbuntuが立ち上がる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant ssh
</pre></div></div>

<p>でUbuntuにsshで入れる。後は自由に。</p>

<p>使い終わって立ち上げっぱなしが気になる場合は、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant halt
</pre></div></div>

<p>で終了。</p>

<p>また使うときは、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant up
vagrant ssh
</pre></div></div>

<p>で。</p>

<h2>
<span id="sandbox化" class="fragment"></span><a href="#sandbox%E5%8C%96"><i class="fa fa-link"></i></a>Sandbox化</h2>

<p>Sandbox化して使いたい場合は、<br>
<a href="https://github.com/jedi4ever/sahara" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/jedi4ever/sahara</a><br>
を使うと良い。</p>

<p>ほぼドキュメントのコピペだが、何かするときは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant sandbox on &amp;&amp; vagrant ssh 
</pre></div></div>

<p>終わったら、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant sandbox rollback &amp;&amp; vagrant sandbox off
</pre></div></div>

<p>とするとsshで行った内容は全て無効になる。<br>
内容を反映させる場合は、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>vagrant sandbox commit &amp;&amp; vagrant sandbox off
</pre></div></div>

<p>とすること。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />24位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>71</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/b7cd789f5b30a4e90eaf">Gitで既にmasterにマージされている使用済みブランチを消す方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-20 13:35:43</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ブランチいっぱい作っているとどれがマージ済みで削除していいかわからなくなったりしますよね。そんな時のためのTipsです。</p>

<h2>
<span id="使用済みブランチの削除関係tips" class="fragment"></span><a href="#%E4%BD%BF%E7%94%A8%E6%B8%88%E3%81%BF%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AE%E5%89%8A%E9%99%A4%E9%96%A2%E4%BF%82tips"><i class="fa fa-link"></i></a>使用済みブランチの削除関係Tips</h2>

<p>リモートリポジトリ名を<code>origin</code>とする。</p>

<ul>
<li>ローカルのマージ済みブランチを(currentとmaster以外)消す</li>
</ul>

<p>(現在のブランチにマージ済みなものを消すので通常<code>git checkout master</code>後に使う）</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git branch -d $(git branch --merged | grep -v master | grep -v '*')
</pre></div></div>

<ul>
<li>リモートのマージ済みブランチを消す</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push origin $(git branch -r --merged | grep origin/ | grep -v master | sed s~origin/~:~)
</pre></div></div>

<ul>
<li>リモートで消されたブランチをローカルに反映</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git remote prune origin
</pre></div></div>

<ul>
<li>fetchする時についでに反映（<code>-p</code>は<code>--prune</code>)</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git fetch -p origin
</pre></div></div>

<h2>
<span id="合わせ技" class="fragment"></span><a href="#%E5%90%88%E3%82%8F%E3%81%9B%E6%8A%80"><i class="fa fa-link"></i></a>合わせ技</h2>

<p>ローカルのmasterをリモートのマスターに同期するのと同時に、既にmasterにマージされたブランチをローカル、リモート共に消す。<br>
自分はmasterを同期させたいタイミングではいつもこのコマンドを使っています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git checkout master &amp;&amp; git pull origin master &amp;&amp; git fetch -p origin &amp;&amp; git branch -d $(git branch --merged | grep -v master | grep -v '*') &amp;&amp; git push origin $(git branch -r --merged | grep origin/ | grep -v master | sed s~origin/~:~)
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />25位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>59</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/52b5900e801c3bfbab04">Githubで間違えてgit push -f origin masterしてしまった時の対応</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-20 11:05:57</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[GitHub]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>origin</code>が<code>https://github.com/[username]/[reponame]</code>というgithub上で管理しているリモートリポジトリだとする。</p>

<p>ここで誰かが間違えて、必要な変更を失ってしまうような<code>git push -f origin master</code>をやってしまった場合の話。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>force-pushed branch master of [username]/[reponame] from 1e6753 to 8cec0c
</pre></div></div>

<p><code>8cec0c</code>ではなく<code>1e6753</code>の状態に戻したいが、<code>1e6753</code>は誰のローカルにも存在しなく、github上でもタグや名前が付けられてないのでfetchしてくることが出来ないとする。</p>

<p><a href="https://github.com/%5Busername%5D/%5Breponame%5D/commit/1e6753" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/[username]/[reponame]/commit/1e6753</a><br>
にアクセスすれば、<code>1e6753</code>がどんなコミットであったか分かる。</p>

<p>ここでは、<code>1e6753</code>が255番目のMerge Pull Requestだと分かったとする。<br>
直接、masterにpushするというような運用をしていななければ、たいてい最新のmasterは何らかのMerge Pull Request後であると思う。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git ls-remote origin
</pre></div></div>

<p>でremote originにある全てのreferenceがわかり、Github上には<code>ref/pull/番号/merge</code>と<code>ref/pull/番号/head</code>が全てのpull requestに対してあるというのがわかる。<br>
これらは全てローカルにfetchしてくることが出来るので、あとは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git fetch origin refs/pull/255/merge
From github.com:[username]/[reponame]
 * branch            refs/pull/255/merge -&gt; FETCH_HEAD
$ git checkout FEACH_HEAD
$ git checkout -b old_master
$ git log (確認)
$ git push -f origin old_master:master
</pre></div></div>

<p>とやれば<code>1e6753</code>と同じ内容にmasterが戻る。</p>

<p>実例で説明できない分ちょっとわかりにくくなってしまったが、これは実際に起った問題で、意外とWeb上に情報がない問題だったりする。実際にこうやることで直せたので誰かの役に立つことを期待。<code>push -f</code>はたまに必要だったりするけど怖い・・・。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />26位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>57</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/ed53f4aada688f7f19a9">2つのブランチの分岐点をみつけるgit show-branch --merge-base</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-05 20:39:12</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>master</code>と<code>HEAD</code>の分岐点をみつける例で。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git show-branch --merge-base master HEAD
</pre></div></div>

<p>diffと一緒に使うとこのありがたみが分かる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git diff `git show-branch --merge-base master HEAD` HEAD
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />27位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>56</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/c2c790dc51e5b084af10">Railsで、URLにIDでなく名前を入力して、アクセスする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-09 11:51:16</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>showやeditなど、member系のアクションに、数値のIDなどではなく、TwitterIDのような一意の文字列でアクセスする方法。</p>

<p>例えば、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>http://your.app.com/users/400
</pre></div></div>

<p>でなく</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>http://your.app.com/users/bob-smith
</pre></div></div>

<p>でアクセスできるようにする。</p>

<p>単純にURLのかっこ良さが上がる気がするし、文字列でのアクセスのみ受け入れるようにしたら、サイトの持っている情報のスクレイピング対策にもなる。</p>

<p>例として、適用するモデル名を<code>User</code>、urlに使用するカラム名を<code>canonical_name</code>とする。ここでは<code>id</code>と<code>canonical_name</code>のどちらでもアクセスできるようにする例を書く。</p>

<h2>
<span id="モデル側のコード" class="fragment"></span><a href="#%E3%83%A2%E3%83%87%E3%83%AB%E5%81%B4%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>モデル側のコード</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/user.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:canonical_name</span><span class="p">,</span>
    <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">},</span>
    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="sr">/^[A-Za-z][\w-]*$/</span> <span class="p">},</span>
    <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">25</span> <span class="p">}</span>

  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="n">canonical_name</span> <span class="p">?</span> <span class="n">canonical_name</span> <span class="p">:</span> <span class="nb">id</span><span class="o">.</span><span class="n">to_s</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find_by_canonical_name_or_id</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">find_by_canonical_name</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">||</span> <span class="n">find</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p><code>to_param</code>というActiveRecordのメソッドが肝。これで通常の表示が<code>id</code>から<code>canonical_name</code>に切り替わる。<br>
validationは大体こんな感じにすると良いと思う。ここでは大文字小文字が違うだけの<code>canonical_name</code>は許さないようにしているが、そもそも大文字を禁止するのもありだと思う。<br>
なお、ここでは<code>canonical_name</code>が設定されていない<code>User</code>もいることを前提としている。</p>

<h2>
<span id="コントローラー側のコード" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC%E5%81%B4%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>コントローラー側のコード</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/users_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">before_filter</span> <span class="ss">:load_user</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
  <span class="c1">## if you use cancan</span>
  <span class="c1"># load_and_authorize_resource :user, find_by: 'find_by_canonical_name_or_id'</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">load_user</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_canonical_name_or_id</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>数字でなくてもidの情報は<code>params[:id]</code>に入って渡される。<br>
<code>canonical_name</code>でしかアクセスできないようにしたい時は<code>load_user</code>で<code>User.find_by_canonical_name</code>を使えば良い。</p>

<h2>
<span id="別案" class="fragment"></span><a href="#%E5%88%A5%E6%A1%88"><i class="fa fa-link"></i></a>別案</h2>

<p>探すときに、<code>find_by_canonical_name_or_id</code>というのを使うとto_paramを変更しているクラスだけ、<code>find</code>でModelを探せなくなってしまう。これだと困る場合は、</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/user.rb</span></div>
<div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">find_by_canonical_name</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">||</span> <span class="k">super</span>
  <span class="k">end</span>
</pre></div>
</div>

<p>とfindを上書きしてしまえばいいかもしれない。</p>

<h2>
<span id="追記" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>追記</h2>

<p><a href="https://gist.github.com/agnellvj/1209733" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/agnellvj/1209733</a> にもっといろんな方法が載っているのを発見。興味ある人は見てみるべし。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />28位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>52</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/6a0418777943cb739a6e">Gemを作って、自動テストを回して、公開してみる方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-28 13:31:23</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>rubyでstable_sortをできるようにするgemを作ったので、作った課程のメモ。<br>
Gemを公開し、Rspecでテストを書いてTravis CIで回すところまでやっている。</p>

<h2>
<span id="実際に出来たもの" class="fragment"></span><a href="#%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%87%BA%E6%9D%A5%E3%81%9F%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>実際に出来たもの</h2>

<ul>
<li><a href="https://github.com/awakia/ruby_stable_sort" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/awakia/ruby_stable_sort</a></li>
<li><a href="http://rubygems.org/gems/stable_sort" class="autolink" rel="nofollow noopener" target="_blank">http://rubygems.org/gems/stable_sort</a></li>
</ul>

<h2>
<span id="gemのテンプレートを生成" class="fragment"></span><a href="#gem%E3%81%AE%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>gemのテンプレートを生成</h2>

<p><code>bundle gem</code>コマンドを使う。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>% bundle gem stable_sort -t                   
      create  stable_sort/Gemfile
      create  stable_sort/Rakefile
      create  stable_sort/LICENSE.txt
      create  stable_sort/README.md
      create  stable_sort/.gitignore
      create  stable_sort/stable_sort.gemspec
      create  stable_sort/lib/stable_sort.rb
      create  stable_sort/lib/stable_sort/version.rb
      create  stable_sort/.rspec
      create  stable_sort/spec/spec_helper.rb
      create  stable_sort/spec/stable_sort_spec.rb
      create  stable_sort/.travis.yml
Initializating git repo in /Users/aikawa/work/stable_sort
</pre></div></div>

<p><code>-t</code>オプションでRSpecのテストも生成してくれる。</p>

<h2>
<span id="中身を作る" class="fragment"></span><a href="#%E4%B8%AD%E8%BA%AB%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>中身を作る</h2>

<p>StableSortの場合ArrayやEnemeratorにモンキーパッチするだけなのでモジュールの中身は空で良い。</p>

<p><a href="https://github.com/awakia/ruby_stable_sort/blob/master/lib/stable_sort.rb" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/awakia/ruby_stable_sort/blob/master/lib/stable_sort.rb</a></p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">lib/stable_sort.rb</span></div>
<div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s2">"stable_sort/version"</span>
<span class="nb">require</span> <span class="s2">"stable_sort/extension/enumerator"</span>
<span class="nb">require</span> <span class="s2">"stable_sort/extension/array"</span>

<span class="k">module</span> <span class="nn">StableSort</span>
<span class="k">end</span>
</pre></div>
</div>

<p>例えばEnemeratorクラスの中身はこんな感じ。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">stable_sort/extension/enumerator.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Enumerator</span>
  <span class="k">def</span> <span class="nf">stable_sort_by</span>
    <span class="n">sort_by</span><span class="o">.</span><span class="n">with_index</span><span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span> <span class="o">[</span><span class="k">yield</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">index</span><span class="o">]</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">stable_sort</span>
    <span class="n">stable_sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="gemファイルを作る" class="fragment"></span><a href="#gem%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>.gemファイルを作る</h2>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>% gem build stable_sort.gemspec
  Successfully built RubyGem
  Name: stable_sort
  Version: <span class="m">0</span>.0.1
  File: stable_sort-0.0.1.gem
</pre></div></div>

<h2>
<span id="stable_sort-gemの公開" class="fragment"></span><a href="#stable_sort-gem%E3%81%AE%E5%85%AC%E9%96%8B"><i class="fa fa-link"></i></a>stable_sort gemの公開</h2>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>% gem push stable_sort-0.0.1.gem 
Pushing gem to https://rubygems.org...
Successfully registered gem: stable_sort <span class="o">(</span><span class="m">0</span>.0.1<span class="o">)</span>
</pre></div></div>

<p><code>stable_sort</code>とか言う名前取れないかと思ったらまさかとれてしまったw</p>

<p><a href="http://rubygems.org/gems/stable_sort" class="autolink" rel="nofollow noopener" target="_blank">http://rubygems.org/gems/stable_sort</a></p>

<h2>
<span id="テストを書く" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>テストを書く</h2>

<p>デフォルトで1つFailするテストが作られているので、とりえあず<code>bundle exec rspec</code>で動かしてみる。</p>

<p>Failしてることを確認したら、それを消して後は適当にテストを書く。<br>
<a href="https://github.com/awakia/ruby_stable_sort/commit/6c276352ef7ef9b1b6f55d85fb1d2d1223e7d374" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/awakia/ruby_stable_sort/commit/6c276352ef7ef9b1b6f55d85fb1d2d1223e7d374</a></p>

<h2>
<span id="travis-ciで動かす" class="fragment"></span><a href="#travis-ci%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%99"><i class="fa fa-link"></i></a>Travis CIで動かす</h2>

<p><a href="https://travis-ci.org/" class="autolink" rel="nofollow noopener" target="_blank">https://travis-ci.org/</a> にてGithubアカウントでログイン。</p>

<p>プロフィールページに行って (<a href="https://travis-ci.org/profile" class="autolink" rel="nofollow noopener" target="_blank">https://travis-ci.org/profile</a>) 連携をON</p>

<p><a href="https://camo.qiitausercontent.com/d209a35981f522741dfaef6d2d7d5f81362d8f49/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f363636342f63623733386336642d366530662d663662642d363462652d3063396236643032316465382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d209a35981f522741dfaef6d2d7d5f81362d8f49/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f363636342f63623733386336642d366530662d663662642d363462652d3063396236643032316465382e706e67" alt="travis_on.png" title="travis_on.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/6664/cb738c6d-6e0f-f6bd-64be-0c9b6d021de8.png"></a></p>

<h2>
<span id="テスト結果をreadmeに表示" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E7%B5%90%E6%9E%9C%E3%82%92readme%E3%81%AB%E8%A1%A8%E7%A4%BA"><i class="fa fa-link"></i></a>テスト結果をREADMEに表示</h2>

<p>ドキュメント: <a href="http://about.travis-ci.org/docs/user/status-images/" class="autolink" rel="nofollow noopener" target="_blank">http://about.travis-ci.org/docs/user/status-images/</a></p>

<p>マークダウンで言えば、以下のものを書けばいいみたい。</p>

<div class="code-frame" data-lang="gcc-machine-description">
<div class="code-lang"><span class="bold">README.md</span></div>
<div class="highlight"><pre><span></span>[![Build Status](https://travis-ci.org/[YOUR_GITHUB_USERNAME]/[YOUR_PROJECT_NAME].png)](https://travis-ci.org/[YOUR_GITHUB_USERNAME]/[YOUR_PROJECT_NAME])
</pre></div>
</div>

<p>こんな感じ -&gt; <a href="https://travis-ci.org/awakia/ruby_stable_sort" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/49fc2987b665f91c57c505000910d914290f17a5/68747470733a2f2f7472617669732d63692e6f72672f6177616b69612f727562795f737461626c655f736f72742e706e67" alt="Build Status" data-canonical-src="https://travis-ci.org/awakia/ruby_stable_sort.png"></a></p>

<h2>
<span id="テストカバレッジも出してみる" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%82%AB%E3%83%90%E3%83%AC%E3%83%83%E3%82%B8%E3%82%82%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>テストカバレッジも出してみる</h2>

<p><a href="https://coveralls.io" rel="nofollow noopener" target="_blank">COVERALLS</a>を使う。</p>

<p>gemspecのdevelopment dependencyにcoverallsを追加。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">stable_sort.gemspec</span></div>
<div class="highlight"><pre><span></span>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">"coveralls"</span>
</pre></div>
</div>

<p>その上で、spec_helperの最初でrequireする。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">spec_helper.rb</span></div>
<div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">'coveralls'</span>
<span class="no">Coveralls</span><span class="o">.</span><span class="n">wear!</span>

<span class="c1"># ...</span>
</pre></div>
</div>

<p>バッジもつける -&gt; <a href="https://coveralls.io/r/awakia/ruby_stable_sort?branch=master" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/ddb10b73867a4c4f9bde0b13e6d5a7f8f4606ec9/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f6177616b69612f727562795f737461626c655f736f72742f62616467652e706e673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/awakia/ruby_stable_sort/badge.png?branch=master"></a></p>

<div class="code-frame" data-lang="gcc-machine-description">
<div class="code-lang"><span class="bold">README.md</span></div>
<div class="highlight"><pre><span></span>[![Coverage Status](https://coveralls.io/repos/awakia/ruby_stable_sort/badge.png?branch=master)](https://coveralls.io/r/awakia/ruby_stable_sort?branch=master)
</pre></div>
</div>

<h2>
<span id="バージョンを上げてみる" class="fragment"></span><a href="#%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E4%B8%8A%E3%81%92%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>バージョンを上げてみる</h2>

<p><code>0.0.1</code>だと使えないGemみたいに見えるので、<code>1.0.0</code>に上げてみる。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">lib/stable_sort/version.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">module</span> <span class="nn">StableSort</span>
  <span class="no">VERSION</span> <span class="o">=</span> <span class="s2">"1.0.0"</span>
<span class="k">end</span>
</pre></div>
</div>

<p>あとは</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>gem build stable_sort.gemspec
</pre></div></div>

<p>して</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>gem push stable_sort-1.0.0.gem
</pre></div></div>

<p>する。</p>

<h2>
<span id="リリースにタグを付けておく" class="fragment"></span><a href="#%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%81%AB%E3%82%BF%E3%82%B0%E3%82%92%E4%BB%98%E3%81%91%E3%81%A6%E3%81%8A%E3%81%8F"><i class="fa fa-link"></i></a>リリースにタグを付けておく</h2>

<p>ちゃんとしたgemでは、gitでタグを付けておくことにより、Githubのreleasesにそれぞれバージョンがどのコミットまでの部分だったかがわかるようになっている。それに習って自分でもタグを付けておく</p>

<p>まずは古いバージョンのコミット位置で</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>git tag v0.0.1 
</pre></div></div>

<p>とし、<br>
次に新しいバージョンのコミット位置で</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>git tag v1.0.0
</pre></div></div>

<p>とする。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>git push origin --tags
</pre></div></div>

<p>とすることでリモートのGithubにもタグが反映される。</p>

<p><a href="https://github.com/awakia/ruby_stable_sort/releases" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/awakia/ruby_stable_sort/releases</a></p>

<h2>
<span id="参考にした資料" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E8%B3%87%E6%96%99"><i class="fa fa-link"></i></a>参考にした資料</h2>

<p>RubyGemsに登録するところの参考文献：</p>

<ul>
<li><a href="http://www.ownway.info/Ruby/index.php?bundler%2Fgem" class="autolink" rel="nofollow noopener" target="_blank">http://www.ownway.info/Ruby/index.php?bundler%2Fgem</a></li>
</ul>

<p>Gemを作って公開するところの参考文献：</p>

<ul>
<li><a href="http://ja.asciicasts.com/episodes/245-new-gem-with-bundler" class="autolink" rel="nofollow noopener" target="_blank">http://ja.asciicasts.com/episodes/245-new-gem-with-bundler</a></li>
</ul>

<h2>
<span id="ちなみに" class="fragment"></span><a href="#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB"><i class="fa fa-link"></i></a>ちなみに</h2>

<p>これは毎週木曜Wantedlyでやっているもくもく会で作りました。<br>
興味がある方は一度<a href="https://www.wantedly.com/projects/5106" rel="nofollow noopener" target="_blank">こちら</a>からどうぞ</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />29位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>44</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/744df4677b291cb38081">RailsにCMS機能を付け加えられる、LocomotiveCMS！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-30 19:22:27</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ちなみにLocomotiveCMSは<code>rails cms</code>でググって最初に見つかったもの。<br>
Railsでアプリを作ってあげて、後は使う人に任せるという運用をしたくて探していた。<br>
WordPressでもいいけど、PHPよりRubyがいいなぁみたいな時は選択肢の一つになると思う。</p>

<p>LocomotiveCMSにはLocomotiveCMS Engineというものの他に、簡単にブログが作れるLocomotive Wagonというコマンドラインツールがついているけれど、こちらはRailsとして動くわけではないので注意。</p>

<p>参考サイトとしては、以下の2つがとても役立った。</p>

<ul>
<li>LocomotiveCMS本家

<ul>
<li><a href="http://www.locomotivecms.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.locomotivecms.com/</a></li>
<li><a href="http://doc.locomotivecms.com/guides/get-started/install-engine" class="autolink" rel="nofollow noopener" target="_blank">http://doc.locomotivecms.com/guides/get-started/install-engine</a></li>
</ul>
</li>
<li>管理ページを日本語化してくれた神のブログ

<ul>
<li><a href="http://xxxcaqui.hatenablog.com/entries/2013/04/12" class="autolink" rel="nofollow noopener" target="_blank">http://xxxcaqui.hatenablog.com/entries/2013/04/12</a></li>
</ul>
</li>
</ul>

<p>ローカルの環境構築Mac、サーバーはHerokuを想定。</p>

<h2>
<span id="事前準備mongodbの設定" class="fragment"></span><a href="#%E4%BA%8B%E5%89%8D%E6%BA%96%E5%82%99mongodb%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>事前準備:MongoDBの設定</h2>

<p>まずはインストール。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ brew install mongodb
</pre></div></div>

<p>次に起動設定。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ mkdir -p ~/Library/LaunchAgents
$ cp /usr/local/Cellar/mongodb/2.2.3-x86_64/homebrew.mxcl.mongodb.plist ~/Library/LaunchAgents/
$ launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.mongodb.plist
</pre></div></div>

<p>きちんと立ち上がったか確認する。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ ps x <span class="p">|</span> grep mongodb
 <span class="m">14968</span>   ??  S      <span class="m">0</span>:00.41 /usr/local/opt/mongodb/mongod run --config /usr/local/etc/mongod.conf
 <span class="m">14983</span> s004  R+     <span class="m">0</span>:00.00 grep --color<span class="o">=</span>auto mongodb
</pre></div></div>

<h2>
<span id="新規railsプロジェクト作成" class="fragment"></span><a href="#%E6%96%B0%E8%A6%8Frails%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>新規Railsプロジェクト作成</h2>

<ul>
<li>現状railsは3.2系列で無いと動かない。4.0系列で作られると困る</li>
<li>DBはactive_recordじゃなく、mongodbを使う</li>
<li>テストはrspecを使いたい。</li>
</ul>

<p>ので、以下のように作製する。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ rails _3.2.13_ new loco_site --skip-active-record --skip-test-unit --skip-bundle
</pre></div></div>

<p>もしくは、</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ rails _3.2.13_ new loco_site -O -T -B
</pre></div></div>

<h2>
<span id="locomotivecmsをローカルで動かす" class="fragment"></span><a href="#locomotivecms%E3%82%92%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%99"><i class="fa fa-link"></i></a>LocomotiveCMSをローカルで動かす</h2>

<p>Gemfileをちょっと書き換える。</p>

<ul>
<li>rubyのバージョンを指定。(しないと後々HerokuでWarningが出る。)</li>
<li>
<code>locomotive_cms</code>, <code>unicorn</code>, <code>rspec-rails</code>を追加。</li>
<li>locomotive_cmsに従ってassets groupに<code>compass-rails</code>を追加。

<ul>
<li>本当は<code>pry</code>とか<code>better-errors</code>とかも追加するけどまぁいいや。</li>
</ul>
</li>
</ul>

<p>コメントを取った後のGemfileは以下のようになる。</p>

<div class="code-frame" data-lang="Gemfile"><div class="highlight"><pre><span></span>source 'https://rubygems.org'
ruby '2.0.0'

gem 'rails', '3.2.13'

gem 'locomotive_cms', require: 'locomotive/engine'
gem 'thin'
gem 'rspec-rails'

group :assets do
  gem 'compass-rails',  '~&gt; 1.0.2'
  gem 'sass-rails',     '~&gt; 3.2.4'
  gem 'coffee-rails',   '~&gt; 3.2.2'
  gem 'uglifier',       '~&gt; 1.2.4'
end

gem 'jquery-rails'
</pre></div></div>

<p>書き換えたら、</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ bundle install
</pre></div></div>

<p>Rspecの設定と</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ rails g rspec:install
      create  .rspec
      create  spec
      create  spec/spec_helper.rb
</pre></div></div>

<p>LocomotiveCMSの設定もgenerate。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ rails g locomotive:install
      create  config/initializers/locomotive.rb
      create  config/initializers/carrierwave.rb
      create  config/initializers/dragonfly.rb
      create  config/mongoid.yml
       route  
  mount Locomotive::Engine <span class="o">=</span>&gt; <span class="s1">'/locomotive'</span>, as: <span class="s1">'locomotive'</span> <span class="c1"># you can change the value of the path, by default set to "/locomotive"</span>

      remove  public/index.html
<span class="o">===============================================================================</span>

The Locomotive Engine has been correctly installed in your Rails application.

  <span class="m">1</span>. Edit the main config files:

    - config/initializers/locomotive.rb
    - config/initializers/carrierwave.rb
    - config/initializers/dragonfly.rb
    - config/mongoid.yml
    - config/devise.yml
    - config/routes.rb

  <span class="m">2</span>. Launch the server

    &gt; bundle <span class="nb">exec</span> unicorn_rails

  <span class="m">3</span>. Open your browser

    &gt; open localhost:8080

  <span class="m">4</span>. Follow the installation wizard steps

  <span class="m">5</span>. Enjoy !

<span class="o">===============================================================================</span>
</pre></div></div>

<p>とりあえず何の設定もいじる必要ないだろと起動してみると、</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ bundle <span class="nb">exec</span> unicorn_rails
I, <span class="o">[</span><span class="m">2013</span>-07-07T14:49:13.214872 <span class="c1">#62661]  INFO -- : listening on addr=0.0.0.0:8080 fd=9</span>
I, <span class="o">[</span><span class="m">2013</span>-07-07T14:49:13.215010 <span class="c1">#62661]  INFO -- : worker=0 spawning...</span>
I, <span class="o">[</span><span class="m">2013</span>-07-07T14:49:13.216376 <span class="c1">#62661]  INFO -- : master process ready</span>
I, <span class="o">[</span><span class="m">2013</span>-07-07T14:49:13.217791 <span class="c1">#62681]  INFO -- : worker=0 spawned pid=62681</span>
I, <span class="o">[</span><span class="m">2013</span>-07-07T14:49:13.218408 <span class="c1">#62681]  INFO -- : Refreshing Gem list</span>
There is a configuration error with the current mongoid.yml.

Problem:
  No sessions configuration provided.
Summary:
  Mongoid<span class="err">'</span>s configuration requires that you provide details about each session that can be connected to, and requires in the sessions config at least <span class="m">1</span> default session to exist.
Resolution:
  Double check your mongoid.yml to make sure that you have a top-level sessions key with at least <span class="m">1</span> default session configuration <span class="k">for</span> it. You can regenerate a new mongoid.yml <span class="k">for</span> assistance via <span class="sb">`</span>rails g mongoid:config<span class="sb">`</span>.

 Example:
   development:
     sessions:
       default:
         database: mongoid_dev
         hosts:
           - localhost:27017
</pre></div></div>

<p>と言ったエラーが出る。全くEnjoy出来ない。mongoid.ymlの設定の仕方が昔と変わったみたい。</p>

<p>とりあえずエラーが親切なので、</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>rails g mongoid:config
</pre></div></div>

<p>とやって<code>config/mongoid.yml</code>を上書きしてやれば問題は解消。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open localhost:8080
</pre></div></div>

<p>とやってブラウザで<code>localhost:8080</code>を見ればウィザード画面が出ているはず！</p>

<p>おしまい！！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />30位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>43</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/991d4a35aabcdf4c4990">AWSでPostgreSQLサーバーを作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-29 15:23:37</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[PostgreSQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>最新情報：2013年11月よりAmazonRDSがPostgreSQLに対応しました。<br>
<a href="http://aws.typepad.com/aws_japan/2013/11/amazon-rds-for-postgresql-now-available.html" class="autolink" rel="nofollow noopener" target="_blank">http://aws.typepad.com/aws_japan/2013/11/amazon-rds-for-postgresql-now-available.html</a><br>
以下の情報はそれでも自分で構築して、勉強したい、一円でも安くしたいなどという人のみに有用な情報になります。</p>

<p>AWS EC2を利用してPostgreSQLサーバーを立てる。RDS含め、MySQL情報はあるけどPostgreSQL情報はなかなか見つからなかったので作成。規模感としてはm2.xlarge,m3.xlargeあたりで使用する人を想定。</p>

<h1>
<span id="ec2をpostgresqlサーバーとして動かす" class="fragment"></span><a href="#ec2%E3%82%92postgresql%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A8%E3%81%97%E3%81%A6%E5%8B%95%E3%81%8B%E3%81%99"><i class="fa fa-link"></i></a>EC2をPostgreSQLサーバーとして動かす</h1>

<h2>
<span id="ec2-ebsのセットアップ" class="fragment"></span><a href="#ec2-ebs%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>EC2, EBSのセットアップ</h2>

<p>AWSのClassic Wizardで作成。各項目について以下の様に設定。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>サーバー：Ubuntuの64ビット (CentOSが好きならAmazonLinuxを選ぶ)
Availability Zone：好きなのを選ぶ (最悪AMIを通して移動できる)
EBS: データ用、WALログ用、LOG用をスタンダードボリュームで３つ作っておく 
    (サイズの拡大は頑張ればできるが、料金は10Gで1ヶ月1$ほどなので、すぐには満杯にならない程度の大きさで作る)
Tag：後から付けられるので無視。区別する名前が必要なら付ける感じ
KeyPair：必要なら新しく作る
SecurityGroup：新しくDB用のを作る（後から付け替えられない）
</pre></div></div>

<p>EBSは、確保しているディスク量と、IOの量で課金されるので、書き込み先が違う部分は分ければ分けるほどお得。なのでDBの書き込み先に応じて3つEBSを作っている。<br>
データ用は現状のDBサイズの数倍、その他は5Gもあれば十分な印象。</p>

<p>作り終わったら、</p>

<ul>
<li>間違ってTerminateしないように、Termination ProtectionをOnにしておくと良い。</li>
<li>ElasticIPでIPを指定しておくと、インスタンスを立ち上げ直した時に同じIPでssh等することが出来て良い。無料。(<a href="http://aws.amazon.com/jp/ec2/#elastic-ip" class="autolink" rel="nofollow noopener" target="_blank">http://aws.amazon.com/jp/ec2/#elastic-ip</a>)</li>
<li>CloudWatchも、とりあえずディスクがいっぱいになりそうな部分の指定だけしておくと良い。基本指標の5分毎のチェックなら無料。(<a href="http://aws.amazon.com/jp/cloudwatch/" class="autolink" rel="nofollow noopener" target="_blank">http://aws.amazon.com/jp/cloudwatch/</a>)</li>
</ul>

<h3>
<span id="補足ebsのスタンダードとiopsプロビジョンドどっちを使えばいいか" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3ebs%E3%81%AE%E3%82%B9%E3%82%BF%E3%83%B3%E3%83%80%E3%83%BC%E3%83%89%E3%81%A8iops%E3%83%97%E3%83%AD%E3%83%93%E3%82%B8%E3%83%A7%E3%83%B3%E3%83%89%E3%81%A9%E3%81%A3%E3%81%A1%E3%82%92%E4%BD%BF%E3%81%88%E3%81%B0%E3%81%84%E3%81%84%E3%81%8B"><i class="fa fa-link"></i></a>補足：EBSのスタンダードとIOPSプロビジョンドどっちを使えばいいか</h3>

<p><a href="http://aws.amazon.com/jp/ebs/" class="autolink" rel="nofollow noopener" target="_blank">http://aws.amazon.com/jp/ebs/</a></p>

<ul>
<li>スタンダードのIOPSは平均100</li>
<li>ボリューム課金：Standardは10Gで1$、IOPSプロビジョンドは8Gで1$</li>
<li>IO課金：Standardは月間1000万IOにつき1$、IOPSプロビジョンドは100IOPSで1月使って10$</li>
</ul>

<p>同じ100IOPSの場合standardだと月間1億回IO(書き込み)が起きて初めてIOPSより高くなる。相当秒間アクセスが多くないサービスの場合スタンダードで十分。</p>

<h2>
<span id="作成したec2にsshでログインしてみる" class="fragment"></span><a href="#%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9Fec2%E3%81%ABssh%E3%81%A7%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>作成したEC2にsshでログインしてみる</h2>

<p>ユーザー名<code>ubuntu</code>でKeyPairのとこで指定したpemを使ってログイン</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>ssh -i ~/.ssh/hogehoge.pem ubuntu@ec2-1-234-56-78.compute-1.amazonaws.com
</pre></div></div>

<h2>
<span id="ec2サーバーの環境設定" class="fragment"></span><a href="#ec2%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>EC2サーバーの環境設定</h2>

<p>色々好みがあると思うので、好きにやればいいと思うが以下の項目はとりあえずやっておけばいいのではないだろうか。</p>

<h3>
<span id="表示言語の設定" class="fragment"></span><a href="#%E8%A1%A8%E7%A4%BA%E8%A8%80%E8%AA%9E%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>表示言語の設定</h3>

<p>とりあえず日本語化してみる。英語でもいいのだけどその場合でも、それぞれに対して<code>en_US.UTF-8</code>と直接指定しておいたほうが無難。</p>

<div class="code-frame" data-lang="/etc/environment"><div class="highlight"><pre><span></span>LANGUAGE="ja_JP:ja"
LC_ALL="ja_JP.UTF-8"
LC_CTYPE="ja_JP.UTF-8"
LANG="ja_JP.UTF-8"
</pre></div></div>

<p>環境によってはこの設定をする前に</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apt-get install --reinstall locales
sudo apt-get install language-pack-ja-base
</pre></div></div>

<p>が必要かもしれない。</p>

<h3>
<span id="timezoneの変更" class="fragment"></span><a href="#timezone%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fa fa-link"></i></a>Timezoneの変更</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ date
2013年 2月 20日 水曜日 11:31:36 UTC
$ sudo mv /etc/localtime /etc/localtime.default
$ sudo ln -s /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
$  date
2013年 2月 20日 水曜日 20:31:51 JST
</pre></div></div>

<h3>
<span id="個人用userを作る" class="fragment"></span><a href="#%E5%80%8B%E4%BA%BA%E7%94%A8user%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>個人用userを作る</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo adduser hoge
sudo passwd hoge
sudo visudo  # hogeユーザーでsudo可能に
su - hoge
</pre></div></div>

<p>sshでいきなりログイン出来るようにするために、id_rsa.pubをauthorize_keyとして入れておくといい。詳しくは<a href="http://d.hatena.ne.jp/torazuka/20110420/ssh" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/torazuka/20110420/ssh</a> 参照</p>

<h3>
<span id="apt-getで必要なものをインストール" class="fragment"></span><a href="#apt-get%E3%81%A7%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>apt-getで必要なものをインストール</h3>

<p>まずはaptを最新に。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apt-get upgrade
sudo apt-get update
</pre></div></div>

<p>後は好きなものを入れればいいと思うが、自分はとりあえずこれだけ入れるようにしている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apt-get install build-essential emacs git screen zsh
</pre></div></div>

<p>サーバーで動かすにはscreenかtmuxは必須だと思う。</p>

<h2>
<span id="postgresqlのインストール" class="fragment"></span><a href="#postgresql%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>postgresqlのインストール</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apt-get install postgresql
sudo apt-get install libpq-dev  # rubyやpython等から使うときに必要になるだろうから入れておく
sudo apt-get install sysv-rc-conf  # chkconfigの代わり
sudo sysv-rc-conf postgresql on  # 起動時にpostgresqlサーバーが起動するようにする
</pre></div></div>

<h2>
<span id="postgresqlにつないでみる" class="fragment"></span><a href="#postgresql%E3%81%AB%E3%81%A4%E3%81%AA%E3%81%84%E3%81%A7%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>Postgresqlにつないでみる</h2>

<p>postgresqlをinstallすると、postgresユーザーが勝手に作られる。このユーザーでログインするには以下のようにする</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo su - postgres
</pre></div></div>

<p>postgresユーザーになったついでにtest用DBも作っておこう</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>createdb testdb
</pre></div></div>

<p>これで<code>psql</code>でDBを</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>psql testdb
</pre></div></div>

<p>後はcreate tableするなり、pg_shadowやpg_userを見るなり、ご自由に。</p>

<h3>
<span id="おまけ別ユーザーからpostgresとしてpsqlアクセス" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E5%88%A5%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%8B%E3%82%89postgres%E3%81%A8%E3%81%97%E3%81%A6psql%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9"><i class="fa fa-link"></i></a>おまけ：別ユーザーからpostgresとしてpsqlアクセス</h3>

<p><code>ph_hba.conf</code>を以下のように変更する</p>

<div class="code-frame" data-lang="diff">
<div class="code-lang"><span class="bold">/etc/postgresql/9.1/main/pg_hba.conf</span></div>
<div class="highlight"><pre><span></span><span class="gd">- local     all     postgres     peer</span>
<span class="gi">+ local     all     postgres     trust</span>
</pre></div>
</div>

<p><a href="http://www.postgresql.org/docs/9.1/static/auth-pg-hba-conf.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.postgresql.org/docs/9.1/static/auth-pg-hba-conf.html</a><br>
<a href="http://www.hizlab.net/app/pgsec.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.hizlab.net/app/pgsec.html</a></p>

<p>こうすることで、自分のアカウントから</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>psql -U postgres testdb
</pre></div></div>

<p>のようにすることが可能になる。<br>
ちなみにここの内容はやらないほうが安全なので、localhostが安全＆めんどくさがり屋さんのみすること。ただ、<code>pg_hba.conf</code>で色々なアクセス法を設定できることを知っておくことは大事。</p>

<h2>
<span id="postgresqlに外部からアクセス出来るように設定する" class="fragment"></span><a href="#postgresql%E3%81%AB%E5%A4%96%E9%83%A8%E3%81%8B%E3%82%89%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E5%87%BA%E6%9D%A5%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Postgresqlに外部からアクセス出来るように設定する</h2>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/postgresql/9.1/main/pg_hba.conf</span></div>
<div class="highlight"><pre><span></span>host all all 0.0.0.0/0 md5
</pre></div>
</div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/postgresql/9.1/main/postgresql.conf</span></div>
<div class="highlight"><pre><span></span>listen_addresses = '*'
</pre></div>
</div>

<p>して、</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/postgresql/9.1/main/postgresql.conf</span></div>
<div class="highlight"><pre><span></span>sudo /etc/init.d/postgresql restart
</pre></div>
</div>

<p>さらにセキュリティーグループの設定でFireWallを設定する必要がある。<br>
AWSのコンソールでポート番号5432(Postgres用のデフォルトポート番号)を<code>0.0.0.0/0</code>で設定追加する。</p>

<p>もちろん、よりセキュアにする場合は、以下のことをするべき。</p>

<ul>
<li>
<code>0.0.0.0/0</code>を事前にわかっているアクセス元のIPアドレスに変更する。</li>
<li>ポート番号をデフォルトの5432から変える。</li>
</ul>

<h3>
<span id="おまけherokuのdbとして使ってみる" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91heroku%E3%81%AEdb%E3%81%A8%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>おまけ：HerokuのDBとして使ってみる</h3>

<p>HerokuのDATABASE_URLは</p>

<blockquote>
<p>postgres://ユーザ名:パスワード@DBサーバURL/データベース名</p>
</blockquote>

<p>として構成されている。なのでデータベースを作成して、この通りに設定してあげれば普通に使うことができる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku config:set DATABASE_URL=postgres://user:pass@hogehoge-xxx.amazonaws.com/dbname
</pre></div></div>

<h2>
<span id="postgresqlのチューニング" class="fragment"></span><a href="#postgresql%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>Postgresqlのチューニング</h2>

<p>自分が<a href="http://qiita.com/items/54503f309216c840765e">m3.xlargeの時にやったチューニング情報</a>を載せておくので参照して下さい。<br>
<code>/etc/sysctl.conf</code>の設定は必須だと思う。</p>

<h1>
<span id="データの書き込み先を役割に応じて分割" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E5%85%88%E3%82%92%E5%BD%B9%E5%89%B2%E3%81%AB%E5%BF%9C%E3%81%98%E3%81%A6%E5%88%86%E5%89%B2"><i class="fa fa-link"></i></a>データの書き込み先を役割に応じて分割</h1>

<p>ここまでで、既にAWSをPostgresサーバーとして使うことは出来ているはず。ここからさきは、DBの書き込み先を役割に応じて分割して、速度や、障害耐性をあげる。</p>

<h2>
<span id="最終構成" class="fragment"></span><a href="#%E6%9C%80%E7%B5%82%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>最終構成</h2>

<p>最終的には以下のように設定する。</p>

<table>
<thead>
<tr>
<th style="text-align: left">マウント先</th>
<th style="text-align: left">FileSystem</th>
<th style="text-align: left">用途</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">/</td>
<td style="text-align: left">/dev/xvda1</td>
<td style="text-align: left">EC2のデフォルト</td>
</tr>
<tr>
<td style="text-align: left">/ebs</td>
<td style="text-align: left">/dev/xvdb</td>
<td style="text-align: left">PostgresのData用</td>
</tr>
<tr>
<td style="text-align: left">/ebs2</td>
<td style="text-align: left">/dev/xvdc</td>
<td style="text-align: left">PostgresのWALログ用(pg_xlog)</td>
</tr>
<tr>
<td style="text-align: left">/ebs3</td>
<td style="text-align: left">/dev/xvdd</td>
<td style="text-align: left">Postgresのsyslog用(pg_log)</td>
</tr>
</tbody>
</table>

<p>また、それぞれのボリュームで<code>posgres</code>ユーザーで以下のようにディレクトリを作成しておく。ディレクトリ名に特に意味はないので好きに変更してOK。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo su - postgres
umask u=rwx,g=,o=
mkdir -p /ebs/postgresql/data
mkdir -p /ebs2/postgresql/wal/pg_xlog
mkdir -p /ebs3/postgresql/log/pg_log
</pre></div></div>

<h2>
<span id="ebsのフォーマットとマウント" class="fragment"></span><a href="#ebs%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E3%81%A8%E3%83%9E%E3%82%A6%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>EBSのフォーマットとマウント</h2>

<p>まずEBSをディスクとして使うためには、ちゃんとフォーマットしてマウントしてあげなければならない。</p>

<p>まずは、EBSのディスクが認識されているか確認。ちゃんとEBSと接続できていたら<code>/dev/xvdb</code>などが存在するはず。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo fdisk -l
</pre></div></div>

<p>パーティションを設定。エンターを押し続けて最後にwを押して設定を書き込めばいいはず。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo fdisk /dev/xvdb
</pre></div></div>

<p>ext4でファイルフォーマット。ext3やxfsも調べたが結局ext4が良さそう。EC2にもともと付いているEBSもext4でフォーマットされている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo mkfs.ext4 /dev/xvdb
mke2fs 1.42.5 (29-Jul-2012)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
655360 inodes, 2621440 blocks
131072 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2684354560
80 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done 
</pre></div></div>

<p>マウントする。ここでは<code>/ebs</code>以下にマウントすることにする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo mkdir /ebs
sudo chmod 777 /ebs
sudo mount /dev/xvdb /ebs
mount (マウント状況を確認)
</pre></div></div>

<p>ちなみにこれだけだと、再起動時にMountされなくなる。<br>
起動時に自動的にMountしたい場合は、</p>

<div class="code-frame" data-lang="etc/fstab"><div class="highlight"><pre><span></span>LABEL=cloudimg-rootfs / ext4 defaults 0 0
/dev/xvda3 none swap sw,comment=cloudconfig 0 0
/dev/xvdb /ebs ext4 defaults 0 0
</pre></div></div>

<p>での<code>/dev/xvdb/</code>の欄を書いて、設定を反映。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo mount -a
</pre></div></div>

<p>他の2つのEBSボリュームについても同様にすること。</p>

<h2>
<span id="postgresのデータディレクトリを移す" class="fragment"></span><a href="#postgres%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E7%A7%BB%E3%81%99"><i class="fa fa-link"></i></a>Postgresのデータディレクトリを移す</h2>

<p>DBを止める</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo /etc/init.d/postgresql stop
</pre></div></div>

<p>元のDataの内容を<code>/ebs</code>以下の新しい場所にコピー</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo su - postgres
cp -r /var/lib/postgresql/9.1/main /ebs/postgresql/data
</pre></div></div>

<p><code>postgresql.conf</code>を以下のように変更</p>

<div class="code-frame" data-lang="diff">
<div class="code-lang"><span class="bold">/etc/postgresql/9.1/main/postgresql.conf</span></div>
<div class="highlight"><pre><span></span><span class="gd">- data_directory = '/var/lib/postgresql/9.1/main' # use data in another directory</span>
<span class="gi">+ data_directory = '/ebs/postgresql/data' # use data in another directory</span>
</pre></div>
</div>

<p>DBを起動</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo /etc/init.d/postgresql start
</pre></div></div>

<h2>
<span id="walログpg_xlogシステムログpg_logの書き込み先を変える" class="fragment"></span><a href="#wal%E3%83%AD%E3%82%B0pg_xlog%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%83%AD%E3%82%B0pg_log%E3%81%AE%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%81%BF%E5%85%88%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>WALログ(pg_xlog)、システムログ(pg_log)の書き込み先を変える</h2>

<p>ログ系の書き込み先は、configで変えられたりしないので、シンボリックリンクで対応する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo /etc/init.d/postgresql stop
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mv /ebs/postgresql/data/pg_xlog /ebs2/postgresql/wal/
ln -s /ebs2/postgresql/wal/pg_xlog /ebs/postgresql/data/pg_xlog

mv /ebs/postgresql/data/pg_log /ebs3/postgresql/log/
ln -s /ebs3/postgresql/log/pg_log /ebs/postgresql/data/pg_log
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo /etc/init.d/postgresql start
</pre></div></div>

<p>これだけ。</p>

<p>システムログは正直どうでもいいが、WALログの書き込み先を変更するのはやるべき、WALログ(+アーカイブログ)さえ残っていれば、Data用ディレクトリが壊れても、ログが残っている限りの最新状態や、指定したポイントや時間に復旧することが出来る。<br>
<a href="http://www.postgresql.jp/document/9.1/html/recovery-config.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.postgresql.jp/document/9.1/html/recovery-config.html</a></p>

<h1>
<span id="バックアップ環境を整える" class="fragment"></span><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97%E7%92%B0%E5%A2%83%E3%82%92%E6%95%B4%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>バックアップ環境を整える</h1>

<p>DBが壊れた時の復元方法として以下の2つが考えられる。</p>

<ol>
<li>PostgreSQLのリカバリ機能を利用して、復元ポイント、アーカイブログ、WALログから復元</li>
<li>DBのdumpから復元</li>
</ol>

<p>前者は、手順が煩雑だが、壊れた直前に近い状態で再現することが可能。後者は、単純だが、バックアップを取った時間にしか復元出来ない(DB負荷の少ない深夜に1日に1回とるのが普通なので最大1日分のデータロスがある)といった違いがある。</p>

<p>以下、1.,2.を可能にする方法をそれぞれ書いておく。<br>
バックアップデータの保存先に関してはAmazon S3を想定する。</p>

<h2>
<span id="1-復元ポイントアーカイブログをs3上に作成" class="fragment"></span><a href="#1-%E5%BE%A9%E5%85%83%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E3%83%AD%E3%82%B0%E3%82%92s3%E4%B8%8A%E3%81%AB%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1. 復元ポイント、アーカイブログをS3上に作成</h2>

<p>Herokuの作ったWAL-Eを使うのが簡単。長くなるので、別エントリにまとめてある。<br>
<a href="http://qiita.com/items/0f36c051a1df8f0b6c6a">Herokuが開発したWAL-Eを使って、AWSでPostgreSQLのバックアップを取る</a></p>

<p>ちなみに、アーカイブログというのはS3上にバックアップが取られたWALログのことで、pg_xlog上からは削除してOKなもののことをいう。</p>

<h2>
<span id="2-dbのdumpをs3に送る" class="fragment"></span><a href="#2-db%E3%81%AEdump%E3%82%92s3%E3%81%AB%E9%80%81%E3%82%8B"><i class="fa fa-link"></i></a>2. DBのdumpをS3に送る</h2>

<p>コマンドラインからs3にアクセスできるように<a href="http://s3tools.org/s3cmd" rel="nofollow noopener" target="_blank">s3cmd</a>をインストールする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apt-get install s3cmd
</pre></div></div>

<p>アクセスキー、シークレットキーなどを設定。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>s3cmd --configure
</pre></div></div>

<p><code>.s3cfg</code>がホームディレクトリに作成されていればOK。</p>

<p>次に<code>s3cmd</code>を使ったバックアップ用スクリプトを作成。<br>
dumps/ディレクトリ以下に、過去のdumpすべてを保存、dumb/db.dumpに最新のdumpを保存するようにしている。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">usr/local/bin/s3backup.sh</span></div>
<div class="highlight"><pre><span></span><span class="nv">DUMPTIME</span><span class="o">=</span><span class="sb">`</span>date +%Y%m%d_%H%M%S<span class="sb">`</span>
pg_dump -Fc --no-acl --no-owner your-db-name &gt; /data/db.dump
s3cmd put /data/db.dump s3://your-s3-bucket/dumps/db_<span class="si">${</span><span class="nv">DUMPTIME</span><span class="si">}</span>.dump
s3cmd cp s3://your-s3-bucket/dumps/db_<span class="si">${</span><span class="nv">DUMPTIME</span><span class="si">}</span>.dump s3://your-s3-bucket/dump/db.dump
</pre></div>
</div>

<p><code>postgres</code>ユーザーで<code>crontab -e</code>を打ってcron jobを設定。</p>

<div class="code-frame" data-lang="crontab"><div class="highlight"><pre><span></span>30 3 * * * /usr/local/bin/s3pgbackup.sh &gt; /dev/null
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />31位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>42</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/1d5cd440ce58ef4fb8ae">.zshrc.localのススメ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-12 01:25:05</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Zsh]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>すごく環境依存なコードを<code>.zshrc</code>に書かなければならないことってありますよね。<br>
そういう時は、<code>.zshrc</code>に直接書くのではなく、例えば、<code>.zshrc.local</code>というファイルを作り、</p>

<div class="code-frame" data-lang="Bash">
<div class="code-lang"><span class="bold">.zshrc.local</span></div>
<div class="highlight"><pre><span></span><span class="c1"># 今使っているマシンでのみ有効にしたい設定を書く</span>

<span class="c1">## 例1：heroku toolbeltを有効にするためのパス</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">"/usr/local/heroku/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>

<span class="c1">## 例2：Treasure Dataのtdコマンドを使うためのAPI_KEYの設定</span>
<span class="nb">export</span> <span class="nv">TREASURE_DATA_API_KEY</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</pre></div>
</div>

<p><code>.zshrc</code>ファイルの最後で、以下のように読み込むようにすると良いです。</p>

<div class="code-frame" data-lang="Bash">
<div class="code-lang"><span class="bold">.zshrc</span></div>
<div class="highlight"><pre><span></span><span class="c1"># どのマシンでも共通に使いたい設定を書く</span>
<span class="c1"># ...</span>
<span class="c1"># ...</span>

<span class="o">[</span> -f ~/.zshrc.local <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">source</span> ~/.zshrc.local
</pre></div>
</div>

<p>こうすると、<code>.zshrc.local</code>というファイルがない場合は読み込みが起こらないので、<code>.zshrc</code>をそのまま他人にあげたり、他のPCに持っていったりしても不具合が起こらない状態を維持できます。<br>
ファイルの最後で読み込むのは、<code>.zshrc.local</code>で<code>.zshrc</code>の設定を上書きすることを出来るようにするためです。</p>

<p><code>[ -f hoge ]</code>の意味の詳細は、<code>man test</code>と打って調べてください。(<a href="http://www.manpagez.com/man/1/test/" class="autolink" rel="nofollow noopener" target="_blank">http://www.manpagez.com/man/1/test/</a>)</p>

<h2>
<span id="応用" class="fragment"></span><a href="#%E5%BF%9C%E7%94%A8"><i class="fa fa-link"></i></a>応用</h2>

<p>自分は、<code>.zshrc.local</code>の他に<code>.zshrc.mac</code>も作っていて</p>

<div class="code-frame" data-lang="Bash">
<div class="code-lang"><span class="bold">.zshrc.mac</span></div>
<div class="highlight"><pre><span></span><span class="c1"># open new tab in same working directory on osx lion.</span>
precmd <span class="o">()</span> <span class="o">{</span>print -Pn <span class="s2">"\e]2; %~/ \a"</span><span class="o">}</span>
preexec <span class="o">()</span> <span class="o">{</span>print -Pn <span class="s2">"\e]2; %~/ \a"</span><span class="o">}</span>

<span class="nb">alias</span> <span class="nv">emacs</span><span class="o">=</span><span class="s1">'/Applications/Emacs.app/Contents/MacOS/Emacs -nw'</span>
</pre></div>
</div>

<p>というようになっています。</p>

<p>他にも、どのPCでも使うけれど、個人用の設定があるという場合は、<code>.zsh.personal</code>を作って、その中に入れておくと良いのではないでしょうか。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />32位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>41</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/b79188f1cc710bae4b8d">pryでのデバッグ中にnextがstepの様な挙動をしてしまう問題の解決法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-16 11:47:27</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Ruby2.0に置き換えた人はこの問題にぶち当たっているみたいです。</p>

<p>debuggerがruby2.0に対応できていないのが問題らしいので、対処法としては、</p>

<ul>
<li>
<a href="https://github.com/cldwalker/debugger" rel="nofollow noopener" target="_blank">debugger</a>を<a href="https://github.com/deivid-rodriguez/byebug" rel="nofollow noopener" target="_blank">byebug</a>に</li>
<li>
<a href="https://github.com/nixme/pry-debugger" rel="nofollow noopener" target="_blank">pry-debugger</a>を<a href="https://github.com/deivid-rodriguez/pry-byebug" rel="nofollow noopener" target="_blank">pry-byebug</a>に</li>
</ul>

<p>置き換えればいいみたいです。</p>

<h2>
<span id="情報源" class="fragment"></span><a href="#%E6%83%85%E5%A0%B1%E6%BA%90"><i class="fa fa-link"></i></a>情報源</h2>

<p><a href="https://github.com/nixme/pry-debugger/issues/34" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/nixme/pry-debugger/issues/34</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />33位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>40</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/049791daca69120d7035">RubyでBase64URLエンコーディング</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-29 00:42:24</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Base64は<code>A–Z</code>, <code>a–z</code>, <code>0–9</code>, <code>+</code>, <code>/</code>の64文字を使って文字列をエンコードする方式で、<code>+</code>と<code>/</code>がURLパラメータとして使うにはふさわしくないので、それを<code>-</code>と<code>_</code>に置き換えたものをBase64URLエンコーディングと言います。</p>

<p>参考：<a href="http://ja.wikipedia.org/wiki/Base64" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/Base64</a></p>

<p>この方式でエンコード/デコードするには、Base64クラスの<code>urlsafe_encode64</code>と<code>urlsafe_decode64</code>を使えば出来ます。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">encode_decode.rb</span></div>
<div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s2">"base64"</span>

<span class="n">basic_enc</span>   <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="s1">'ab?cd~'</span><span class="p">)</span>         <span class="c1"># =&gt; "YWI/Y2R+ZQ==\n"</span>
<span class="n">original</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">decode64</span><span class="p">(</span><span class="n">basic_enc</span><span class="p">)</span>           <span class="c1"># =&gt; "ab?cd~e"</span>

<span class="n">urlsafe_enc</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">urlsafe_encode64</span><span class="p">(</span><span class="s1">'ab?cd~'</span><span class="p">)</span> <span class="c1"># =&gt; "YWI_Y2R-ZQ=="</span>
<span class="n">original</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">urlsafe_decode64</span><span class="p">(</span><span class="n">urlsafe_enc</span><span class="p">)</span> <span class="c1"># =&gt; "ab?cd~e"</span>
</pre></div>
</div>

<p><a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/base64/rdoc/Base64.html" class="autolink" rel="nofollow noopener" target="_blank">http://ruby-doc.org/stdlib-1.9.3/libdoc/base64/rdoc/Base64.html</a></p>

<h2>
<span id="おまけパディングのをなくして少し短くする" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91%E3%83%91%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%92%E3%81%AA%E3%81%8F%E3%81%97%E3%81%A6%E5%B0%91%E3%81%97%E7%9F%AD%E3%81%8F%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>おまけ：パディングの'='をなくして、少し短くする</h2>

<p>base64エンコードは4文字区切りなので、エンコード結果が4の倍数にならなかったときはパディングと言って'='が入ります。<br>
これは別に削除してしまってもデコード時に4の倍数になるように'='を追加してあげられるので</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">base64.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">module</span> <span class="nn">Base64</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">short_urlsafe_encode64</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="n">urlsafe_encode64</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'='</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">short_urlsafe_decode64</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="n">urlsafe_decode64</span><span class="p">(</span><span class="n">str</span> <span class="o">+</span> <span class="s1">'='</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">str</span><span class="o">.</span><span class="n">size</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">encode_decode.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">enc</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">short_urlsafe_encode64</span><span class="p">(</span><span class="s1">'ab?bc~e'</span><span class="p">)</span>  <span class="c1"># =&gt; "YWI_YmN-ZQ"</span>
<span class="n">original</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">short_urlsafe_decode64</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>   <span class="c1"># =&gt; "ab?cd~e"</span>
</pre></div>
</div>

<p>のような関数を作り、使うことができます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />34位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>37</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/a07416d5b5957ff96165">git mergetoolでマージする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-31 13:11:20</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Conflictの解消とかわかりにくいから、そこはGUIでMergeしたいという方へ。</p>

<p><a href="https://camo.qiitausercontent.com/9b08c909030c8ffa50fc55679caf70186f4087c3/687474703a2f2f7777772e736f75726365676561722e636f6d2f696d616765732f73637265656e73686f74732f646966666d657267652f6d61635f66696c655f77696e646f775f6d657267652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9b08c909030c8ffa50fc55679caf70186f4087c3/687474703a2f2f7777772e736f75726365676561722e636f6d2f696d616765732f73637265656e73686f74732f646966666d657267652f6d61635f66696c655f77696e646f775f6d657267652e706e67" alt="ScreenShot of DiffMerge" data-canonical-src="http://www.sourcegear.com/images/screenshots/diffmerge/mac_file_window_merge.png"></a></p>

<p>自分の知っている中で一番優秀なFreeのmargetoolはdiffmerge(<a href="http://www.sourcegear.com/diffmerge/" class="autolink" rel="nofollow noopener" target="_blank">http://www.sourcegear.com/diffmerge/</a>)</p>

<p>3-way-mergeに対応していて、左右で自分と相手の変更を見ながら、真ん中のViewでEditできる！さらに、真ん中のViewでは初期状態としてMerge元の状態が表示されているので、それも確認しながら最終バージョンを作成できる！！<br>
とりあえずダウンロードしよう！(注：ダウンロード時のEmailアドレス登録はスキップできる。)</p>

<h3>
<span id="mergegit-mergetool用の設定" class="fragment"></span><a href="#mergegit-mergetool%E7%94%A8%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>Merge(<code>git mergetool</code>)用の設定</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git config --global merge.tool diffmerge
git config --global mergetool.keepBackup false
git config --global mergetool.diffmerge.cmd "diffmerge --merge --result=\$MERGED \$LOCAL \$BASE \$REMOTE"
git config --global mergetool.diffmerge.trustExitCode true
</pre></div></div>

<h3>
<span id="diffgit-difftool用の設定" class="fragment"></span><a href="#diffgit-difftool%E7%94%A8%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>Diff(<code>git difftool</code>)用の設定</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git config --global diff.tool diffmerge
git config --global difftool.diffmerge.cmd "diffmerge \$LOCAL \$REMOTE"
</pre></div></div>

<p>参考：</p>

<ul>
<li><a href="http://gitguru.com/2009/02/22/integrating-git-with-a-visual-merge-tool/" class="autolink" rel="nofollow noopener" target="_blank">http://gitguru.com/2009/02/22/integrating-git-with-a-visual-merge-tool/</a></li>
<li><a href="http://adventuresincoding.com/2010/04/how-to-setup-git-to-use-diffmerge/" class="autolink" rel="nofollow noopener" target="_blank">http://adventuresincoding.com/2010/04/how-to-setup-git-to-use-diffmerge/</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />35位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>34</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/3c5f6c536cb75ef20149">`r`コマンドと言えば、統計だよねという全ての人のために - zshデフォルトの`r`コマンドをオフにする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-05 00:37:00</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Zsh]</b> <b>[R]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>他のshと比べ、いろいろ素晴らしい機能を提供してくれるzsh先生ですが、実は一つだけお節介挙動をします。</p>

<p>それは、以前に実行したコマンドを入力するという<code>r</code>というコマンドをデフォルトで定義してくれちゃっているということです。<br>
具体的には、</p>

<ul>
<li>
<code>r</code>で最後に実行したコマンドを実行(= <code>!!</code>)</li>
<li>
<code>r vi</code>で最後に実行した<code>vi</code>コマンドを実行(= <code>!vi</code>)</li>
</ul>

<p>ということをしてくれます。</p>

<p>でもこれ本当に必要ですか？？</p>

<ul>
<li>最後に実行したコマンド: <code>↑</code> → <code>Enter</code>
</li>
<li>最後に実行した<code>vi</code>コマンド: <code>Ctrl+r</code> → <code>vi</code>と入力 → <code>Enter</code>
</li>
</ul>

<p>で十分だし、もし、shスクリプトに書くならbashでも動くように<code>!</code>を使った記法を使ったほうがいいように思えます。</p>

<p>そして何より、<code>brew</code>(<code>apt-get</code>, <code>yum</code>)等で<a href="http://www.r-project.org/" rel="nofollow noopener" target="_blank">R</a>をインストール</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install homebrew/science/r
</pre></div></div>

<p>しても、統計ソフトのRが起動しなくなってしまいます！！<br>
（しかも、意図せずに、以前のコマンドが実行されると、何が起こったのか分からなくて焦ります...）</p>

<p>この挙動の必要無さに共感してくれた人は、いますぐ<code>.zshrc</code>に</p>

<div class="code-frame" data-lang="zshrc"><div class="highlight"><pre><span></span>disable r
</pre></div></div>

<p>と書いてください。これだけで、この挙動をオフにできます。</p>

<p>それでは<code>r</code>と打ったら<a href="http://www.atmarkit.co.jp/fcoding/articles/stat/01/stat01a.html" rel="nofollow noopener" target="_blank">統計処理言語R</a>が起動する世界をお楽しみください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />36位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/7c6899a7c42cd93ba218">git blameを再帰的に行う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-31 12:42:34</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ある行の変更がどういう経緯でなされたか知りたい時に。<br>
リファクタリング等々の原因で<code>git blame</code>一発では知りたいChangeに辿りつけないことありますよね。</p>

<h2>
<span id="-tig-blame" class="fragment"></span><a href="#-tig-blame"><i class="fa fa-link"></i></a>$ tig blame</h2>

<p><code>git</code>コマンドだけではさすがに厳しいので、vim風インターフェースの<code>tig</code>を使って</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>tig blame &lt;filename&gt;
</pre></div></div>

<p>とする。</p>

<p>この画面上で、以下の操作を繰り返すことで、コミット履歴をたどっていける。</p>

<ul>
<li>
<code>Enter</code>: カーソル行のコミット内容を表示</li>
<li>
<code>,</code>: カーソル行のコミットの親のコミットにblameを適用</li>
</ul>

<p>他に使いそうな<code>tig</code>コマンドとしては</p>

<ul>
<li>
<code>h</code>: <code>tig</code>で使えるコマンド一覧を表示</li>
<li>
<code>Tab</code>:ビューのフォーカスを切り替え</li>
<li>
<code>q</code>: 現在のビューを閉じる</li>
</ul>

<p>ちなみに一度、<code>,</code>を押してしまうと、前の画面に戻る方法はないらしい。そんな時は<code>q</code>または<code>Q</code>で一から閉じてやり直し。<br>
まぁ、これ以上求めるなら、GUIツールを使ってください。</p>

<h2>
<span id="-git-log--s-g" class="fragment"></span><a href="#-git-log--s-g"><i class="fa fa-link"></i></a>$ git log -S/-G</h2>

<p>ちょっと違うけれど、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git log -p -S'search keyword'
</pre></div></div>

<p>もおすすめ。<code>search keyword</code>が含まれる変更をすべて出してくれる。実はこっちのほうが使えるかも。</p>

<p>ちなみに、<code>-p</code>はlogをパッチ形式出だしてくれるオプションで、これをつけることで、どういうdiffだったかが見られる。</p>

<p>正規表現も以下のどちらかのようにすれば使える。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git log -p -G'regex search keyword'
git log -p -S'regex search keyword' --pickaxe-regex
</pre></div></div>

<p>2つの違い？気にするな。<code>-G</code>の方が打ちやすい。それでいいじゃないか。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<ul>
<li><a href="http://git.661346.n2.nabble.com/In-depth-git-blame-td6082521.html" class="autolink" rel="nofollow noopener" target="_blank">http://git.661346.n2.nabble.com/In-depth-git-blame-td6082521.html</a></li>
<li><a href="http://qiita.com/items/94d62f3678e9abcac82a" class="autolink">http://qiita.com/items/94d62f3678e9abcac82a</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />37位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>27</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/6480438e23c2bc28bb61">Rubyで使えるGoogle API一覧</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-23 18:52:27</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[google]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Googleのサービス使って色々やりたいですよね！Rubyで何ができるのかちょっと調べてみました。</p>

<p>まずAPIクライアントとして、</p>

<p><a href="https://github.com/google/google-api-ruby-client" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/google/google-api-ruby-client</a></p>

<p>というのがあります。</p>

<p>これは、</p>

<p><a href="https://developers.google.com/apis-explorer/#p/" class="autolink" rel="nofollow noopener" target="_blank">https://developers.google.com/apis-explorer/#p/</a></p>

<p>に書いているAPIに対応しているgemみたいです。</p>

<p>ただ、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>client.discovered_api('plus')
client.discovered_api('calendar', 'v3')
</pre></div></div>

<p>とすれば、目的のapiが使えると書いてあるけれど、実際どういう名前で叩けばいいのか全然書いてない不親切ドキュメントです。</p>

<p>ソースコードみてみると、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>client.discovered_apis
</pre></div></div>

<p>と打てば、使えるの全部出てくるということがわかりました。</p>

<p>出てきた結果を表にまとめて書いておくと以下のようになります。(2013/05/23現在)</p>

<table>
<thead>
<tr>
<th style="text-align: left">servise name</th>
<th style="text-align: left">version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">adexchangebuyer</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">adexchangebuyer</td>
<td style="text-align: left">v1.1</td>
</tr>
<tr>
<td style="text-align: left">adexchangebuyer</td>
<td style="text-align: left">v1.2</td>
</tr>
<tr>
<td style="text-align: left">adexchangeseller</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">admin</td>
<td style="text-align: left">directory_v1</td>
</tr>
<tr>
<td style="text-align: left">admin</td>
<td style="text-align: left">reports_v1</td>
</tr>
<tr>
<td style="text-align: left">adsense</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">adsense</td>
<td style="text-align: left">v1.1</td>
</tr>
<tr>
<td style="text-align: left">adsense</td>
<td style="text-align: left">v1.2</td>
</tr>
<tr>
<td style="text-align: left">adsensehost</td>
<td style="text-align: left">v4.1</td>
</tr>
<tr>
<td style="text-align: left">analytics</td>
<td style="text-align: left">v2.4</td>
</tr>
<tr>
<td style="text-align: left">analytics</td>
<td style="text-align: left">v3</td>
</tr>
<tr>
<td style="text-align: left">androidpublisher</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">audit</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">bigquery</td>
<td style="text-align: left">v2</td>
</tr>
<tr>
<td style="text-align: left">blogger</td>
<td style="text-align: left">v2</td>
</tr>
<tr>
<td style="text-align: left">blogger</td>
<td style="text-align: left">v3</td>
</tr>
<tr>
<td style="text-align: left">books</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">calendar</td>
<td style="text-align: left">v3</td>
</tr>
<tr>
<td style="text-align: left">civicinfo</td>
<td style="text-align: left">us_v1</td>
</tr>
<tr>
<td style="text-align: left">compute</td>
<td style="text-align: left">v1beta13</td>
</tr>
<tr>
<td style="text-align: left">compute</td>
<td style="text-align: left">v1beta14</td>
</tr>
<tr>
<td style="text-align: left">compute</td>
<td style="text-align: left">v1beta15</td>
</tr>
<tr>
<td style="text-align: left">coordinate</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">customsearch</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">datastore</td>
<td style="text-align: left">v1beta1</td>
</tr>
<tr>
<td style="text-align: left">dfareporting</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">dfareporting</td>
<td style="text-align: left">v1.1</td>
</tr>
<tr>
<td style="text-align: left">discovery</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">drive</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">drive</td>
<td style="text-align: left">v2</td>
</tr>
<tr>
<td style="text-align: left">freebase</td>
<td style="text-align: left">v1sandbox</td>
</tr>
<tr>
<td style="text-align: left">freebase</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">fusiontables</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">gan</td>
<td style="text-align: left">v1beta1</td>
</tr>
<tr>
<td style="text-align: left">groupsmigration</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">groupssettings</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">latitude</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">licensing</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">mirror</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">oauth2</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">oauth2</td>
<td style="text-align: left">v2</td>
</tr>
<tr>
<td style="text-align: left">orkut</td>
<td style="text-align: left">v2</td>
</tr>
<tr>
<td style="text-align: left">pagespeedonline</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">plus</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">prediction</td>
<td style="text-align: left">v1.2</td>
</tr>
<tr>
<td style="text-align: left">prediction</td>
<td style="text-align: left">v1.3</td>
</tr>
<tr>
<td style="text-align: left">prediction</td>
<td style="text-align: left">v1.4</td>
</tr>
<tr>
<td style="text-align: left">prediction</td>
<td style="text-align: left">v1.5</td>
</tr>
<tr>
<td style="text-align: left">reseller</td>
<td style="text-align: left">v1sandbox</td>
</tr>
<tr>
<td style="text-align: left">reseller</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">shopping</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">siteVerification</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">storage</td>
<td style="text-align: left">v1beta1</td>
</tr>
<tr>
<td style="text-align: left">storage</td>
<td style="text-align: left">v1beta2</td>
</tr>
<tr>
<td style="text-align: left">taskqueue</td>
<td style="text-align: left">v1beta1</td>
</tr>
<tr>
<td style="text-align: left">taskqueue</td>
<td style="text-align: left">v1beta2</td>
</tr>
<tr>
<td style="text-align: left">tasks</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">translate</td>
<td style="text-align: left">v2</td>
</tr>
<tr>
<td style="text-align: left">urlshortener</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">webfonts</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">youtube</td>
<td style="text-align: left">v3</td>
</tr>
<tr>
<td style="text-align: left">youtubeAnalytics</td>
<td style="text-align: left">v1</td>
</tr>
<tr>
<td style="text-align: left">youtubeAnalytics</td>
<td style="text-align: left">v1beta1</td>
</tr>
</tbody>
</table>

<p>ただ、これが全部なのかとおもいきや、これでは叩けないAPIも存在するみたいです・・・。</p>

<p>例えば、Google Contactsの情報をいじるものがあります。<br>
<a href="https://developers.google.com/google-apps/contacts/v3/" class="autolink" rel="nofollow noopener" target="_blank">https://developers.google.com/google-apps/contacts/v3/</a></p>

<p><code>contacts</code>なんて文字上には全く出てこないですよね。なんかGDataを使ってアクセスするみたいで、探してみたら以下のgdata gemが見つかりました。</p>

<ul>
<li><a href="https://github.com/dwaite/gdata" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/dwaite/gdata</a></li>
<li><a href="https://code.google.com/p/gdata-ruby-util/" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/gdata-ruby-util/</a></li>
</ul>

<p>これは、以下のサービスが使えるようです。</p>

<table>
<thead>
<tr>
<th style="text-align: left">servise name</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">base</td>
</tr>
<tr>
<td style="text-align: left">apps</td>
</tr>
<tr>
<td style="text-align: left">blogger</td>
</tr>
<tr>
<td style="text-align: left">booksearch</td>
</tr>
<tr>
<td style="text-align: left">calendar</td>
</tr>
<tr>
<td style="text-align: left">contacts</td>
</tr>
<tr>
<td style="text-align: left">doclist</td>
</tr>
<tr>
<td style="text-align: left">finance</td>
</tr>
<tr>
<td style="text-align: left">gbase</td>
</tr>
<tr>
<td style="text-align: left">gmail</td>
</tr>
<tr>
<td style="text-align: left">health</td>
</tr>
<tr>
<td style="text-align: left">notebook</td>
</tr>
<tr>
<td style="text-align: left">photos</td>
</tr>
<tr>
<td style="text-align: left">spreadsheets</td>
</tr>
<tr>
<td style="text-align: left">webmaster_tools</td>
</tr>
<tr>
<td style="text-align: left">youtube</td>
</tr>
</tbody>
</table>

<p>が、4年間ぐらいメンテされて無くて、ちゃんと使えるのか不安です・・・。誰か検証して下さい。</p>

<p>追記：<br>
やっぱり、Ruby1.9以降なくなった<code>jcode</code>を使ったりしていて、使えなかった。まぁ大して難しいRequest送らなくていいので、自分でHTTPリクエスト送って書けばいいのかもしれない・・・。<br>
上記の、Contactsに関しては、<a href="https://github.com/Placester/google-contacts" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/Placester/google-contacts</a> があったので、それぞれ固有のgemを探せば見つかるのかもしれない。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />38位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>25</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/4b2c0d43a21a98d6e96f">別ブランチの一部の変更のみをmasterに取り込みたい時</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-26 14:48:26</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><ul>
<li>
<code>&lt;begin&gt;</code>を別ブランチ内の取り込みたい部分の根本となるhash</li>
<li>
<code>&lt;end&gt;</code>を別ブランチ内の取り込みたい部分の終端となるhash</li>
</ul>

<p>として、以下のように打てば良い。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git rebase --onto master &lt;begin&gt; &lt;end&gt;
</pre></div></div>

<p>もちろん、安全のためにも、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git checkout -b &lt;topic-name&gt;
git rebase --onto master &lt;begin&gt; &lt;end&gt;
</pre></div></div>

<p>と新しいブランチを作ってからやると、やりたいことが定まったブランチ名でpull requestが送れるしとても良い。</p>

<p>ちなみに、このやり方は<code>git help rebase</code>の以下の部分を見て学んだ。よく出来たマニュアルで助かる。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">git-rebase</span></div>
<div class="highlight"><pre><span></span>First let<span class="s1">'s assume your topic is based on branch next. For example, a feature developed in topic depends on some functionality which is found in</span>
<span class="s1">       next.</span>

<span class="s1">               o---o---o---o---o  master</span>
<span class="s1">                    \</span>
<span class="s1">                     o---o---o---o---o  next</span>
<span class="s1">                                      \</span>
<span class="s1">                                       o---o---o  topic</span>


<span class="s1">       We want to make topic forked from branch master; for example, because the functionality on which topic depends was merged into the more stable</span>
<span class="s1">       master branch. We want our tree to look like this:</span>

<span class="s1">               o---o---o---o---o  master</span>
<span class="s1">                   |            \</span>
<span class="s1">                   |             o'</span>--o<span class="s1">'--o'</span>  topic
                    <span class="se">\</span>
                     o---o---o---o---o  next


       We can get this using the following command:

           git rebase --onto master next topic
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />39位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>25</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/e1adf03bbd32dd8bfcf6">RailsでActiveRecordとMongoidの共存のさせ方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-13 17:52:21</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> <b>[MongoDB]</b> <b>[Heroku]</b> <b>[mongoid]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="背景" class="fragment"></span><a href="#%E8%83%8C%E6%99%AF"><i class="fa fa-link"></i></a>背景</h2>

<p>Herokuで適当にスキーマレスなデータをOutput出来る場所がほしい！でも、Herokuはディスクが自由に使えないので、text書き出しができない！！<br>
こんな要求の解決法としては、textタイプのフィールドを作って<code>serialize</code>や<code>store</code>を使うのが一つの手。ただ、割と書き込みが多い事が想定され、無駄に大切なPostgreSQLサーバーに負荷をかけてしまう。<br>
そんなこんなでスキーマレスな出力場所としてMongoDBを使うというアイデアが持ち上がった。HerokuではMongoHQなら16M、MongoLabなら0.5Gが無料で使える。<br>
なお、基本的に、MongoDBをサブとして使うので<code>rails g model</code>などをした時に<code>mongoid</code>がinvokeされるのは避けたい。</p>

<h2>
<span id="実践" class="fragment"></span><a href="#%E5%AE%9F%E8%B7%B5"><i class="fa fa-link"></i></a>実践</h2>

<div class="code-frame" data-lang="Gemfile"><div class="highlight"><pre><span></span>gem 'mongoid'
</pre></div></div>

<p>して、<code>bundle install</code></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rails generate mongoid:config
</pre></div></div>

<p>すると、<code>config/mongoid.yml</code>にdevelopmentとtestの設定が生成されるので、ここにconfigurationを書く。基本的には変更する必要がないが、<code>database</code>, <code>username</code>, <code>password</code>あたりの書き換え、書き足しだけチェックしてみればいいのではないだろうか？</p>

<p><code>production</code>の設定はHerokuのAdd-onのドキュメント通りにすれば良いと思う。<a href="https://devcenter.heroku.com/articles/mongohq" rel="nofollow noopener" target="_blank">MongoHQ</a>のドキュメントの方が詳しく書かれていたのでこっちを参照した。使ったのは<a href="https://devcenter.heroku.com/articles/mongolab" rel="nofollow noopener" target="_blank">MongoLab</a>だけど(笑)</p>

<p>ちゃんと設定したければ、<br>
<a href="http://mongoid.org/en/mongoid/docs/installation.html" class="autolink" rel="nofollow noopener" target="_blank">http://mongoid.org/en/mongoid/docs/installation.html</a><br>
にそれぞれオプションが詳しく載っている。</p>

<p>mongoidのモデルは<code>rails generate model</code>でできるようになっている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rails generate model user_mongo name:string
    invoke  mongoid
    create    app/models/user_mongo.rb
</pre></div></div>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/user_mongo.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserMongo</span>
  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
<span class="k">end</span>
</pre></div>
</div>

<p>ということは、ActiveRecordのmodelを作るとき、<code>active_record:</code>とprefixをつける必要がある。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rails generate acrive_record:model
</pre></div></div>

<p>これは<code>migration</code>コマンドやgemの<code>devise</code>などでも同様。</p>

<p>これが困る場合、<code>application.rb</code>に</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/application.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">generators</span> <span class="k">do</span> <span class="o">|</span><span class="n">g</span><span class="o">|</span>
  <span class="n">g</span><span class="o">.</span><span class="n">orm</span> <span class="ss">:active_record</span>
<span class="k">end</span>
</pre></div>
</div>

<p>と追加すれば良い。このときmongoidのモデルを作るときは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rails generate mongoid:model
</pre></div></div>

<p>とする。</p>

<p>最後に、Mongoidの使い方は、適当に自分で調べて使ってみれば意外と簡単に使えると思うが、<a href="http://mongoid.org/en/mongoid/docs/relations.html" class="autolink" rel="nofollow noopener" target="_blank">http://mongoid.org/en/mongoid/docs/relations.html</a> は読んでおくと良いと思う。多分ActiveRecordとはちょっと違っていて難しいであろう、Relation/Associationのあたりの話がちゃんと書いてある。</p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/6372626/using-active-record-generators-after-mongoid-installation" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/6372626/using-active-record-generators-after-mongoid-installation</a></li>
<li><a href="http://mongoid.org/en/mongoid/" class="autolink" rel="nofollow noopener" target="_blank">http://mongoid.org/en/mongoid/</a></li>
<li><a href="https://devcenter.heroku.com/articles/mongohq" class="autolink" rel="nofollow noopener" target="_blank">https://devcenter.heroku.com/articles/mongohq</a></li>
</ul>

<h2>
<span id="追記-ロードするclassの設定" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98-%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8Bclass%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>追記: ロードするclassの設定</h2>

<p>mongoidのgemを見ると設定なしでは<code>apps/model</code>以下の全てのRubyファイルをロードしてしまう設定になっていた。</p>

<p>これを防ぐためには、<code>options</code>の<code>preload_models</code>にMongoid::DocumentをIncludeしているクラスを全て指定すれば良い。<br>
例えば、<code>data_mongo.rb</code>と<code>user_monbo.rb</code>を作った場合は、</p>

<div class="code-frame" data-lang="yaml">
<div class="code-lang"><span class="bold">mongoid.yml</span></div>
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">production</span><span class="p p-Indicator">:</span>
  <span class="c1"># ...</span>
  <span class="l l-Scalar l-Scalar-Plain">options</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">preload_models</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data_mongo</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">user_mongo</span>
</pre></div>
</div>

<p>というように設定する。</p>

<p>一応、今後解決する可能性もあるので、mongoidの問題となっている部分のを載せておく</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">mongoid3.0.22/lib/rails/mongoid.rb</span></div>
<div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">load_models</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
      <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">[</span><span class="s2">"app/models"</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
        <span class="n">preload</span> <span class="o">=</span> <span class="o">::</span><span class="no">Mongoid</span><span class="o">.</span><span class="n">preload_models</span>
        <span class="k">if</span> <span class="n">preload</span><span class="o">.</span><span class="n">resizable?</span>
          <span class="n">files</span> <span class="o">=</span> <span class="n">preload</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">model</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">model</span><span class="si">}</span><span class="s2">.rb"</span> <span class="p">}</span>
        <span class="k">else</span>
            <span class="n">files</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">/**/*.rb"</span><span class="p">)</span>
        <span class="k">end</span>

        <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
          <span class="n">load_model</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2">/"</span> <span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">".rb"</span><span class="p">,</span> <span class="s2">""</span><span class="p">))</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />40位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/923f93d0610f2bb8086a">HerokuのDBプランをあげる流れ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-13 16:59:34</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Heroku]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Heroku Postgresの<br>
Plan: Kappa (HEROKU_POSTGRESQL_BRONZE) から<br>
Plan: Ronin (HEROKU_POSTGRESQL_COPPER) に<br>
あげる例で書きます。適宜読み替えて下さい。</p>

<h2>
<span id="まずは現状の確認" class="fragment"></span><a href="#%E3%81%BE%E3%81%9A%E3%81%AF%E7%8F%BE%E7%8A%B6%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>まずは現状の確認</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ heroku pg:info
=== HEROKU_POSTGRESQL_BRONZE (DATABASE_URL)
Plan:        Kappa
Status:      available
Data Size:   10.00 GB
Tables:      50
PG Version:  9.1.4
Connections: 10
Fork/Follow: Available
Created:     2013-01-01 12:34 UTC
Maintenance: not required
</pre></div></div>

<p>これでデータサイズやテーブル数、コネクション数はわかる。<br>
なお、dbnameやpasswordなども知りたい場合は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ heroku pg:credentials HEROKU_POSTGRESQL_BRONZE
</pre></div></div>

<p>を叩けばOK。</p>

<p>ただ、Herokuはプランをあげてもキャッシュ用メモリやCPU性能しか上がらないので、本当に必要な情報はキャッシュヒット率だったりする。</p>

<p>それを調べるには</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ heroku pg:psql
</pre></div></div>

<p>と打ってから</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>SELECT 
  sum(heap_blks_read) as heap_read,
  sum(heap_blks_hit)  as heap_hit,
  (sum(heap_blks_hit) - sum(heap_blks_read)) / sum(heap_blks_hit) as ratio
FROM 
  pg_statio_user_tables;
</pre></div></div>

<p>と打てば、テーブルのキャッシュヒット率</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>SELECT 
  sum(idx_blks_read) as idx_read,
  sum(idx_blks_hit)  as idx_hit,
  (sum(idx_blks_hit) - sum(idx_blks_read)) / sum(idx_blks_hit) as ratio
FROM 
  pg_statio_user_indexes;
</pre></div></div>

<p>と打てば、Indexのキャッシュヒット率がわかる。</p>

<p>このことは以下のページに書いてある。<br>
<a href="https://devcenter.heroku.com/articles/heroku-postgres-plans#determining-required-cachesize" class="autolink" rel="nofollow noopener" target="_blank">https://devcenter.heroku.com/articles/heroku-postgres-plans#determining-required-cachesize</a></p>

<h2>
<span id="dbプランをあげる一連の流れ" class="fragment"></span><a href="#db%E3%83%97%E3%83%A9%E3%83%B3%E3%82%92%E3%81%82%E3%81%92%E3%82%8B%E4%B8%80%E9%80%A3%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>DBプランをあげる一連の流れ</h2>

<p>DBプランをあげることを決断したら、後は以下の流れでUpgradeできる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku maintenance:on
heroku pgbackups:capture --expire (最新のDBの状態をバックアップとして取得）
heroku addons:add heroku-postgresql:ronin (新しいDBはHEROKU_POSTGRESQL_COPPERだと取得）
heroku pg:wait (新しいDBができるまで待つ)
heroku pg:info (DBができているか確認）
heroku pgbackups:restore HEROKU_POSTGRESQL_COPPER (バックアップからDB状態をコピー)
heroku pg:promote HEROKU_POSTGRESQL_COPPER (新しいDBに繋ぎ変え)
heroku restart
--- 確認作業 ---
heroku maintenance:off
</pre></div></div>

<p>確認作業の部分はStagingを持っている人の場合、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku config | grep DATABASE_URL (DATABASE_URLをstaging用にコピー)
heroku config:set DATABASE_URL=postgres://xxxxxx --app your-staging-app
heroku restart --app your-staging-app
</pre></div></div>

<p>とやって、Staging環境から本番DBにつなぐことで行える。</p>

<p>数日運用してもう問題が無いと自信がついた頃、以下のコマンドで元のDBを削除する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku addons:remove HEROKU_POSTGRESQL_BRONZE
</pre></div></div>

<h2>
<span id="公式ドキュメント" class="fragment"></span><a href="#%E5%85%AC%E5%BC%8F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>公式ドキュメント</h2>

<ul>
<li><a href="https://devcenter.heroku.com/articles/heroku-postgresql" class="autolink" rel="nofollow noopener" target="_blank">https://devcenter.heroku.com/articles/heroku-postgresql</a></li>
<li><a href="https://addons.heroku.com/heroku-postgresql" class="autolink" rel="nofollow noopener" target="_blank">https://addons.heroku.com/heroku-postgresql</a></li>
<li><a href="https://postgres.heroku.com/" class="autolink" rel="nofollow noopener" target="_blank">https://postgres.heroku.com/</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />41位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>22</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/998bdc1e4254da0fb29e">RailsにおけるMassAssignmentのセキュリティー対策</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-23 12:30:42</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>これがどういう問題なのか知らない人は、</p>

<p>このブログ<br>
<a href="http://blog.sorah.jp/2012/03/05/mass-assignment-vulnerability-in-github" class="autolink" rel="nofollow noopener" target="_blank">http://blog.sorah.jp/2012/03/05/mass-assignment-vulnerability-in-github</a></p>

<p>か</p>

<p>Rails Cast - Hackers Love Mass Assignment<br>
<a href="http://railscasts.com/episodes/26-hackers-love-mass-assignment-revised" class="autolink" rel="nofollow noopener" target="_blank">http://railscasts.com/episodes/26-hackers-love-mass-assignment-revised</a><br>
(プロを見れない人：<a href="http://railscasts.com/episodes/26-hackers-love-mass-assignment" class="autolink" rel="nofollow noopener" target="_blank">http://railscasts.com/episodes/26-hackers-love-mass-assignment</a>)</p>

<p>を見ると良い。Rails Castの方では実際にAttackする方法が動画で見られるのでわかりやすい。</p>

<p>公式ドキュメントとしては、以下のページにその内容が書かれている。<br>
<a href="http://guides.rubyonrails.org/security.html#mass-assignment" class="autolink" rel="nofollow noopener" target="_blank">http://guides.rubyonrails.org/security.html#mass-assignment</a></p>

<p>基本的にはattr_accessibleに書いてあるフィールドは、たとえFormで隠していようとも、何らかの方法でうまくパラメータをセットしてリクエストを送ってあげれば、書き換える事が可能ですよという話。</p>

<p>ここまでは気をつけましょうという話でいいのだけれど、じゃぁどういう風に解決すればいいのかが問題。これぞって言うベスト・プラクティスがまだない感じ。</p>

<h2>
<span id="対策1-mass_assignmentを最低限にし後は自前で代入" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%961-mass_assignment%E3%82%92%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AB%E3%81%97%E5%BE%8C%E3%81%AF%E8%87%AA%E5%89%8D%E3%81%A7%E4%BB%A3%E5%85%A5"><i class="fa fa-link"></i></a>対策1: mass_assignmentを最低限にし、後は自前で代入</h2>

<p>基本中の基本。</p>

<ul>
<li>attr_accessibleは悪意を持って変更されてしまっても困らないものにする</li>
<li>Association関係はなるべくActiveRecord::Relationから生成</li>
<li>adminのみできる操作はuserがadminであるかチェックしてから直代入</li>
<li>findするときに、current_userに紐付いているものだけから探す</li>
</ul>

<p>といったことをして、対策する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>class ArticleController &lt; ApplicationController
  def create
    @article = current_user.articles.new(params[:article])
    @article.pick_up = true if current_user.adimn? &amp;&amp; params[:pick_up]
    if @article.save
      redirect_to action: :index, notice: "Created"
    else
      render :new
    end
  end

  def update
    @article = current_user.articles.find(params[:id])
    show_access_denied_page unless @article
    @article.pick_up = true if current_user.adimn? &amp;&amp; params[:pick_up]
    @article.assign_attributes(params[:article])
    if @article.save
      redirect_to action: :index, notice: "Updated"
    else
      render :edit
    end
  end
end
</pre></div></div>

<p>基本はこれでいい気もするんだけど、Railsに置いてめんどくさいのは悪なのでどうしようかと言う話が出てくる。</p>

<h2>
<span id="対策2-asを使う" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%962-as%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>対策2: asを使う</h2>

<p>attr_accessibleにはasが付けられ、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>class Product &lt; ActiveRecord::Base
  attr_accessible :name, as: :user 
  attr_accessible :name, :pick_up, as: :admin
end
</pre></div></div>

<p>newやupdate_attributesの時にasを指定することが出来る。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>class ProductController &lt; ApplicationController
  def create
    @product = Product.new(params[:product], as: current_user.try(:admin?) ? :admin : :user)
    if @product.save
      redirect_to action: :index, notice: "Created"
    else
      render :new
    end
  end

  def update
    @product = Product.find(params[:id])
    if @product.update_attributes(params[:product], as: current_user.try(:admin?) ? :admin : :user)
      redirect_to action: :index, notice: "Updated"
    else
      render :edit
    end
  end
end
</pre></div></div>

<p>attr_accessibleの定義をuser/adminで分ける方法の他にも、new/editで分けるなどすればある程度応用が効きそう。</p>

<h2>
<span id="対策3-mass_assignment_authorizerを使う" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%963-mass_assignment_authorizer%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>対策3: mass_assignment_authorizerを使う</h2>

<p><a href="http://railscasts.com/episodes/237-dynamic-attr-accessible" class="autolink" rel="nofollow noopener" target="_blank">http://railscasts.com/episodes/237-dynamic-attr-accessible</a></p>

<p>mass_assignment_authorizer(<a href="http://api.rubyonrails.org/classes/ActiveModel/MassAssignmentSecurity.html#method-i-mass_assignment_authorizer" rel="nofollow noopener" target="_blank">公式ドキュメント</a>)を使ってattr_accessibleをControllerで動的に書き換える方法。</p>

<p>Rails Castのコードスニペットをそのまま持ってくると、</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">config/initializers/accessible_attributes.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">attr_accessible</span>
  <span class="kp">attr_accessor</span> <span class="ss">:accessible</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">mass_assignment_authorizer</span>
    <span class="k">if</span> <span class="n">accessible</span> <span class="o">==</span> <span class="ss">:all</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">protected_attributes</span>
    <span class="k">else</span>
      <span class="k">super</span> <span class="o">+</span> <span class="p">(</span><span class="n">accessible</span> <span class="o">||</span> <span class="o">[]</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>と設定しておいて、adminだけなんでも設定できるようにする例では</p>

<div class="code-frame" data-lang="rb">
<div class="code-lang"><span class="bold">app/controllers/articles_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">new</span>
  <span class="vi">@article</span><span class="o">.</span><span class="n">accessible</span> <span class="o">=</span> <span class="ss">:all</span> <span class="k">if</span> <span class="n">admin?</span>
  <span class="vi">@article</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:article</span><span class="o">]</span>
  <span class="sr">//</span> <span class="o">...</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">update</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
  <span class="vi">@article</span><span class="o">.</span><span class="n">accessible</span> <span class="o">=</span> <span class="ss">:all</span> <span class="k">if</span> <span class="n">admin?</span>  <span class="c1"># &lt;- here</span>
  <span class="sr">//</span> <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>

<p>のようにする。</p>

<h2>
<span id="対策4-strong-parameters-gemを使う" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%964-strong-parameters-gem%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>対策4: strong-parameters gemを使う</h2>

<p><a href="https://github.com/rails/strong_parameters" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/rails/strong_parameters</a><br>
<a href="http://railscasts.com/episodes/371-strong-parameters" class="autolink" rel="nofollow noopener" target="_blank">http://railscasts.com/episodes/371-strong-parameters</a></p>

<p>Rails4.0からはデフォルトになるらしい。<br>
詳しくは上の2のドキュメントを見るほうが良いと思うので、ここではコードスニペットを書かないが、許可(<code>permit</code>)するattributeをテンプレート化しておき、その場その場で適用するイメージ。</p>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>他にもこうするといいよというのがあったら教えて下さい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />42位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>22</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/b68acc78afad68a9dc8b">HerokuでとりあえずDBのバックアップをとっておく方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-01-11 11:28:25</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Heroku]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="バックアップを取るまで" class="fragment"></span><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97%E3%82%92%E5%8F%96%E3%82%8B%E3%81%BE%E3%81%A7"><i class="fa fa-link"></i></a>バックアップを取るまで</h2>

<p>バックアップを取れるAdd Onを入れる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku addons:add pgbackups
</pre></div></div>

<p>バックアップを取得</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku pgbackups:capture
</pre></div></div>

<h2>
<span id="ローカルにdumpファイルを保存するまで" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%ABdump%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B%E3%81%BE%E3%81%A7"><i class="fa fa-link"></i></a>ローカルにdumpファイルを保存するまで</h2>

<p>バックアップ一覧を見る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku pgbackups
</pre></div></div>

<p>バックアップ先のURLを取得</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku pgbackups:url
</pre></div></div>

<p>リビジョン(<code>heroku pgbackups</code>で出てくるID)を引数に取ることも可能</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>heroku pgbackups:url b001
</pre></div></div>

<p>これはdumpファイルのURLなので<code>wget</code>,<code>curl</code>などで取得して、<code>pg_restore</code>で復元できる</p>

<p>一例としては、以下のようにする</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>curl heroku pgbackups:url | pg_restore --verbose --clean --no-acl -O -h ${host} -U ${user} -d ${database}
</pre></div></div>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p><a href="https://devcenter.heroku.com/articles/pgbackups" class="autolink" rel="nofollow noopener" target="_blank">https://devcenter.heroku.com/articles/pgbackups</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />43位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>22</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/7bb38a73ec6153d01e05">Git/Githubで、プロダクションと最新のmasterとの差分を表示する - Wantedlyのデプロイプロセスより</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-04 14:50:17</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[GitHub]</b> <b>[Heroku]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Git AdventCalendar 1日目で<a href="/yaotti" class="user-mention js-hovercard" title="yaotti" data-hovercard-target-type="user" data-hovercard-target-name="yaotti">@yaotti</a>がQiitaでよく使うgitコマンドを紹介してくれたので、僕も、僕の勤めている<a href="https://www.wantedly.com/" rel="nofollow noopener" target="_blank">Wantedly</a>で、新しいバージョンのプロダクトをデプロイするときに使っているgitコマンドを紹介しようと思います。</p>

<p>ちなみにWantedlyは最近<a href="http://qiita.com/teams/wantedly/stats">Qiitaチームアカウント</a>を作ってもらいました！皆さん見てみてくださいね。</p>

<h2>
<span id="wantedlyの開発運用体制の概略-なぜこの差分表示が必要か" class="fragment"></span><a href="#wantedly%E3%81%AE%E9%96%8B%E7%99%BA%E9%81%8B%E7%94%A8%E4%BD%93%E5%88%B6%E3%81%AE%E6%A6%82%E7%95%A5-%E3%81%AA%E3%81%9C%E3%81%93%E3%81%AE%E5%B7%AE%E5%88%86%E8%A1%A8%E7%A4%BA%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%8B"><i class="fa fa-link"></i></a>Wantedlyの開発運用体制の概略 (なぜ、この差分表示が必要か)</h2>

<p>Wantedlyは<code>Ruby on Rails</code>で開発を行い、プロダクションサーバーは<code>Heroku</code>でホスティングしています。</p>

<p>開発者は全員(5-10人程度)が、ひとつの<code>Github</code>レポジトリを共有した上で、</p>

<ul>
<li><p>新しい変更は、<code>&lt;開発者のgithub-id&gt;/&lt;機能名&gt;</code> (例：<code>awakia/add-awesome-feature</code>) のブランチを作って、<code>master</code>に対してPull Requestを送る。</p></li>
<li><p>送られたPull Requestのコードレビューをして、よさそうであればマージ</p></li>
<li><p>ある程度変更が溜まったら、適当なタイミングで最新のmasterをherokuにデプロイ</p></li>
</ul>

<p>というフローで開発・運用しています。もう少し規模が大きくなってきたら、次にデプロイするstableなブランチと、最新のブランチの２つを用意する必要があるかもしれませんが、現状では最新のmasterをそのままデプロイしたいことが多いので、こうしています。</p>

<p>Wantedlyは、「全員が責任をもって開発・保守しよう！」という思いもあって、エンジニア全員が、マージ、デプロイを行っています。</p>

<p>そのため、前の人がどこまでデプロイしていて、今回どのような変更が入るのか確認する必要が出てきます。<br>
今回はそんな時のためのgitコマンドを紹介します。</p>

<h2>
<span id="ブランチ名の仮定" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E5%90%8D%E3%81%AE%E4%BB%AE%E5%AE%9A"><i class="fa fa-link"></i></a>ブランチ名の仮定</h2>

<p>以下では</p>

<ul>
<li>Github上のリモートリポジトリ名が<code>origin</code>
</li>
<li>Heroku(プロダクションサーバー)上のリモートリポジトリ名が<code>heroku</code>
</li>
</ul>

<p>であることを仮定します。別の名前を使っている人は適宜置き換えてください。</p>

<h2>
<span id="コマンドライン上で見る" class="fragment"></span><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E4%B8%8A%E3%81%A7%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>コマンドライン上で見る</h2>

<h3>
<span id="どのファイルに変更を加えたか知る" class="fragment"></span><a href="#%E3%81%A9%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E5%A4%89%E6%9B%B4%E3%82%92%E5%8A%A0%E3%81%88%E3%81%9F%E3%81%8B%E7%9F%A5%E3%82%8B"><i class="fa fa-link"></i></a>どのファイルに変更を加えたか知る</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git fetch heroku master &amp;&amp; git fetch origin master &amp;&amp; git diff --name-only heroku/master..origin/master
</pre></div></div>

<p>ここでは特にDBのスキーマをいじる変更が無いかチェックします。DBをいじる変更があると、一度サーバーを止めてデプロイしないといけない可能性があります。</p>

<h3>
<span id="どんなコミットがあったか知る" class="fragment"></span><a href="#%E3%81%A9%E3%82%93%E3%81%AA%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%8C%E3%81%82%E3%81%A3%E3%81%9F%E3%81%8B%E7%9F%A5%E3%82%8B"><i class="fa fa-link"></i></a>どんなコミットがあったか知る</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git fetch heroku master &amp;&amp; git fetch origin master &amp;&amp; git log heroku/master..origin/master
</pre></div></div>

<p>ちなみに自分は<code>git log</code>を使うときは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git log --stat --pretty=format:'%C(yellow)%h %Cgreen%cr %Cblue%cn %Cred%d %Creset%s'
</pre></div></div>

<p>のオプション付きで使います。(エイリアスを作ってます。)</p>

<h2>
<span id="github上で見る" class="fragment"></span><a href="#github%E4%B8%8A%E3%81%A7%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>Github上で見る</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git fetch heroku master &amp;&amp; open https://github.com/&lt;ユーザー名&gt;/&lt;リポジトリ名&gt;/compare/`git rev-parse --short heroku/master`...master
</pre></div></div>

<p>コミットが多くなるとGithubの方が見やすいので、こっちを使ったりします。</p>

<h2>
<span id="解説-gitgithubで２点間の変更を見る" class="fragment"></span><a href="#%E8%A7%A3%E8%AA%AC-gitgithub%E3%81%A7%EF%BC%92%E7%82%B9%E9%96%93%E3%81%AE%E5%A4%89%E6%9B%B4%E3%82%92%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>解説 (Git/Githubで２点間の変更を見る)</h2>

<p>実運用では、間違えて過去の情報を参照しないように<code>git fetch</code>して最新の情報に更新することを保証しています。<br>
しかし、ポイントは、gitで2点間の<code>diff</code>を取る部分だけで、それは以下のように実現できます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git diff &lt;ブランチ1&gt;..&lt;ブランチ2&gt;
</pre></div></div>

<p>この<code>diff</code>の部分を目的に応じて<code>diff --name-only</code>だったり<code>log</code>だったりに変えると良いです。</p>

<p>そして、これと同じ部分をGithubで見るには</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>https://github.com/&lt;ユーザー名&gt;/&lt;リポジトリ名&gt;/compare/&lt;ブランチ1&gt;...&lt;ブランチ2&gt;
</pre></div></div>

<p>をブラウザで開けばいいだけです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />44位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>21</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/8ddafed7b01c109ab179">Ruby(Motion)でmethodsを使ってメソッド検索</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-03 14:28:17</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[RubyMotion]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Rubyはirbで<code>methods</code>メソッドを使うことで、それぞれのオブジェクトに定義されているメソッドをインタラクティブに検索できて便利ですよね。</p>

<h2>
<span id="メソッド検索用メソッド一覧" class="fragment"></span><a href="#%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E6%A4%9C%E7%B4%A2%E7%94%A8%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>メソッド検索用メソッド一覧</h2>

<p><a href="http://ruby-doc.org/core-2.0/" class="autolink" rel="nofollow noopener" target="_blank">http://ruby-doc.org/core-2.0/</a></p>

<p>で<code>methods</code>という単語を含むメソッドは以下の通りです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#instance_methods (Module)
#methods (Object)
#private_instance_methods (Module)
#private_methods (Object)
#protected_instance_methods (Module)
#protected_methods (Object)
#public_instance_methods (Module)
#public_methods (Object)
#singleton_methods (Object)
</pre></div></div>

<p>private, public等のスコープやインスタンスメソッドや特異メソッドのみ取り出すものがあるようですね。</p>

<p>ちなみに変数を検索するのもあります。(<code>variables</code>で検索)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#class_variables (Module)
#global_variables (Kernel)
#instance_variables (Object)
#local_variables (Kernel)
#thread_variables (Thread)
</pre></div></div>

<p><code>constants</code>はクラスメソッドとインスタンスメソッドだけ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>::constants (Module)
#constants (Module)
</pre></div></div>

<p>以下の例では基本的に<code>methods</code>を使いますが、目的に応じて<code>public_methods</code>、<code>instance_methods</code>等に適宜置き換えてください。</p>

<h2>
<span id="とりあえずアルファベット順にメソッド一覧をみてみる" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%A2%E3%83%AB%E3%83%95%E3%82%A1%E3%83%99%E3%83%83%E3%83%88%E9%A0%86%E3%81%AB%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E4%B8%80%E8%A6%A7%E3%82%92%E3%81%BF%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>とりあえずアルファベット順にメソッド一覧をみてみる</h2>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">sort</span>
</pre></div></div>

<p>めちゃくちゃいっぱいメソッドが出てくるがアルファベット順にソートしておくことで、こんなメソッドないかなーというのが探しやすくなります。</p>

<h2>
<span id="grepしてみる" class="fragment"></span><a href="#grep%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>grepしてみる</h2>

<p>例えば<code>target</code>という文字を含むメソッドを探すには以下のようにします。<br>
ここでは念のため<code>i</code>オプションを付けて大文字小文字を無視しています。CamelCaseを使うRubyMotionでは必須です。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span><span class="o">.</span><span class="n">methods</span><span class="o">.</span><span class="n">grep</span> <span class="sr">/target/i</span>
</pre></div></div>

<h2>
<span id="object等の基底クラスで定義されているメソッドを取り除く" class="fragment"></span><a href="#object%E7%AD%89%E3%81%AE%E5%9F%BA%E5%BA%95%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%8F%96%E3%82%8A%E9%99%A4%E3%81%8F"><i class="fa fa-link"></i></a>Object等の基底クラスで定義されているメソッドを取り除く</h2>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span><span class="o">.</span><span class="n">methods</span> <span class="o">-</span> <span class="no">Object</span><span class="o">.</span><span class="n">methods</span>
</pre></div></div>

<p><code>Object</code>は<code>ActiveRecord::Base</code>等、場合に応じて適当に変えてみて下さい。</p>

<p>ちなみに<code>instance_methods</code>の検索だったら、</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span><span class="o">.</span><span class="n">instance_methods</span> <span class="o">-</span> <span class="no">Module</span><span class="o">.</span><span class="n">instance_methods</span>
</pre></div></div>

<h2>
<span id="スーパークラスに定義されているメソッドを取り除く" class="fragment"></span><a href="#%E3%82%B9%E3%83%BC%E3%83%91%E3%83%BC%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AB%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%8F%96%E3%82%8A%E9%99%A4%E3%81%8F"><i class="fa fa-link"></i></a>スーパークラスに定義されているメソッドを取り除く</h2>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span><span class="o">.</span><span class="n">methods</span> <span class="o">-</span> <span class="n">hoge</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">instance_methods</span>
</pre></div></div>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">methods</span> <span class="o">-</span> <span class="n">hoge</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">superclass</span><span class="o">.</span><span class="n">methods</span>
</pre></div></div>

<p><code>instance_methods</code>だったら、第二引数がinclude_superなので実は普通にできます。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">hoge</span><span class="o">.</span><span class="n">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
</pre></div></div>

<h2>
<span id="ちなみにpryが使える場合" class="fragment"></span><a href="#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%ABpry%E3%81%8C%E4%BD%BF%E3%81%88%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>ちなみに：pryが使える場合</h2>

<p>pryの<code>ls</code>を使えばやりたいことは多分解決します。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="o">[</span><span class="m">1</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; ls hoge
</pre></div></div>

<p>RubyMotionではpryが使えないので上の方法を組み合わせることで、メソッドをうまく探すと幸せになれるかもしれません。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />45位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>21</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/f0da6ee705494f319143">RubyMotionのAppDelegateに書くべき基本的なViewのテンプレート</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-08 17:04:45</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[RubyMotion]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="viewcontrollerのサンプル" class="fragment"></span><a href="#viewcontroller%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB"><i class="fa fa-link"></i></a>ViewControllerのサンプル</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">main_view_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MainViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>
  <span class="k">def</span> <span class="nf">viewDidLoad</span>
    <span class="k">super</span>

    <span class="vi">@label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@label</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">320</span><span class="p">,</span> <span class="mi">20</span><span class="o">]]</span>
    <span class="vi">@label</span><span class="o">.</span><span class="n">font</span>  <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">boldSystemFontOfSize</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
    <span class="vi">@label</span><span class="o">.</span><span class="n">text</span>  <span class="o">=</span> <span class="s2">"Hello World"</span>

    <span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">whiteColor</span>
    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@label</span><span class="p">)</span>

    <span class="c1"># for navigation bar</span>
    <span class="n">navigationItem</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">"Navigation Title"</span>

    <span class="c1"># for tab bar</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">tabBarItem</span> <span class="o">=</span> <span class="no">UITabBarItem</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithTitle</span><span class="p">(</span><span class="s2">"Tab1"</span><span class="p">,</span> <span class="ss">image</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">tag</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="single-view" class="fragment"></span><a href="#single-view"><i class="fa fa-link"></i></a>Single View</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app_delegate.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AppDelegate</span>
  <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="ss">didFinishLaunchingWithOptions</span><span class="p">:</span><span class="n">launchOptions</span><span class="p">)</span>
    <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
    <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="no">MainViewController</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="navigation-bar-view" class="fragment"></span><a href="#navigation-bar-view"><i class="fa fa-link"></i></a>Navigation Bar View</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app_delegate.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AppDelegate</span>
  <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="ss">didFinishLaunchingWithOptions</span><span class="p">:</span><span class="n">launchOptions</span><span class="p">)</span>
    <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

    <span class="n">nav_controller</span> <span class="o">=</span> <span class="no">UINavigationController</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithRootViewController</span><span class="p">(</span><span class="no">MainViewController</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
    <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">nav_controller</span>

    <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="tab-bar-view" class="fragment"></span><a href="#tab-bar-view"><i class="fa fa-link"></i></a>Tab Bar View</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app_delegate.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AppDelegate</span>
  <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="ss">didFinishLaunchingWithOptions</span><span class="p">:</span><span class="n">launchOptions</span><span class="p">)</span>
    <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

    <span class="n">tab1</span> <span class="o">=</span> <span class="no">MainViewController</span><span class="o">.</span><span class="n">new</span>
    <span class="c1"># tab2 = OtherViewController.new</span>
    <span class="n">tab_controller</span> <span class="o">=</span> <span class="no">UITabBarController</span><span class="o">.</span><span class="n">new</span>
    <span class="n">tab_controller</span><span class="o">.</span><span class="n">viewControllers</span> <span class="o">=</span> <span class="o">[</span><span class="n">tab1</span><span class="o">]</span>

    <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">tab_controller</span>
    <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="補足" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>補足</h2>

<h3>
<span id="newはallocinitと同じ意味" class="fragment"></span><a href="#new%E3%81%AFallocinit%E3%81%A8%E5%90%8C%E3%81%98%E6%84%8F%E5%91%B3"><i class="fa fa-link"></i></a>newはalloc.initと同じ意味</h3>

<p><code>MainViewController.new</code> = <code>MainViewController.alloc.init</code></p>

<h3>
<span id="tap好きな人用" class="fragment"></span><a href="#tap%E5%A5%BD%E3%81%8D%E3%81%AA%E4%BA%BA%E7%94%A8"><i class="fa fa-link"></i></a>tap好きな人用</h3>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span><span class="o">.</span><span class="n">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">window</span><span class="o">|</span>
  <span class="n">window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="no">MainViewController</span><span class="o">.</span><span class="n">new</span>
  <span class="n">window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>
<span class="k">end</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />46位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>21</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/f6582d4b40aba85ba69b">RailsでContentをgzip配信する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-16 17:02:33</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Rack::Deflaterを使えば一瞬でできる。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/application.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">module</span> <span class="nn">YourApp</span>
  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
    <span class="n">config</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Deflater</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />47位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/d0a8912e105f5c8f6c5d">VCR/WebMock/RSpecで外部と通信を行うテストを書く</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-30 19:24:00</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[RSpec]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="vcrのインストール" class="fragment"></span><a href="#vcr%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>VCRのインストール</h2>

<p>Gemfileに以下を追加して<code>bundle install</code></p>

<div class="code-frame" data-lang="Gemfile"><div class="highlight"><pre><span></span>group :test do
  gem 'vcr'
  gem 'webmock', "&gt;= 1.8.0", "&lt; 1.12"
end
</pre></div></div>

<h2>
<span id="rspec用設定" class="fragment"></span><a href="#rspec%E7%94%A8%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>RSpec用設定</h2>

<p><code>spec/spec_helper.rb</code>に以下の内容を追加</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">spec/spec_helper.rb</span></div>
<div class="highlight"><pre><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1">#  some other codes… #</span>

  <span class="no">VCR</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
    <span class="n">c</span><span class="o">.</span><span class="n">cassette_library_dir</span> <span class="o">=</span> <span class="s1">'spec/vcr_cassettes'</span>
    <span class="n">c</span><span class="o">.</span><span class="n">hook_into</span> <span class="ss">:webmock</span>
  <span class="k">end</span>

  <span class="c1"># SpecのDescriptionを元にVCRのファイル名を生成する</span>
  <span class="n">config</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="ss">:each</span><span class="p">,</span> <span class="ss">:vcr</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="ss">:full_description</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">underscore</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[^\w\/]+/</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="ss">:record</span><span class="p">,</span> <span class="ss">:match_requests_on</span><span class="p">)</span><span class="o">.</span><span class="n">except</span><span class="p">(</span><span class="ss">:example_group</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">reverse_merge!</span><span class="p">(</span><span class="ss">record</span><span class="p">:</span> <span class="ss">:new_episodes</span><span class="p">)</span>
    <span class="no">VCR</span><span class="o">.</span><span class="n">use_cassette</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="p">{</span> <span class="n">example</span><span class="o">.</span><span class="n">call</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p><code>c.cassette_library_dir</code>の場所は色々流儀があるようだが、通常FactoryGirlのfactoryデータが<code>spec/factories</code>下に入っているはずなので、それに合わせる形で、<code>spec/vcr_cassettes</code>と指定している。</p>

<h3>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考:</h3>

<ul>
<li><a href="https://github.com/vcr/vcr" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/vcr/vcr</a></li>
<li><a href="http://natashatherobot.com/vcr-gem-rails-rspec/" class="autolink" rel="nofollow noopener" target="_blank">http://natashatherobot.com/vcr-gem-rails-rspec/</a></li>
<li><a href="http://morizyun.github.io/blog/webmock-vcr-gem-rails/" class="autolink" rel="nofollow noopener" target="_blank">http://morizyun.github.io/blog/webmock-vcr-gem-rails/</a></li>
<li><a href="http://qiita.com/sawamur@github/items/e6fa877e35b383903e2e" class="autolink" id="reference-79aee4b39e2523eddc78">http://qiita.com/sawamur@github/items/e6fa877e35b383903e2e</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />48位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/0f36c051a1df8f0b6c6a">Herokuが開発したWAL-Eを使って、AWSでPostgreSQLのバックアップを取る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-25 14:47:24</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[PostgreSQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>今回はEC2インスタンスのOSとしてUbuntuを選択。<br>
CentOS系のAmazon Linuxだとデフォルトで入るバージョンが色々古くてめんどくさいからね。でも<code>apt-get</code>を<code>yum</code>に変えたらだいたい動くんじゃないかと期待。</p>

<p><a href="https://github.com/wal-e/wal-e" rel="nofollow noopener" target="_blank">wal-e</a>とはもともとHerokuがAWS上でpostgresqlのバックアップを取るために開発していたPythonスクリプト。EC2上で走っているPostgreSQLのデータをS3に保存してくれる。<br>
S3にデータ送信すること自体が<code>scp</code>などを使えず厄介なので、そこを解決してくれているところもあるのだが、単に<code>s3cmd</code>等でバックアップを取るのと違ってデータを圧縮して送ってくれていたり、今あるバックアップ一覧をコマンド一発で見れたりする部分が良いと思う。それ以上には詳しく調べてないけど、HerokuはAWS上でPostgreSQLを動かすノウハウは一番あるのではないかと言うようなサービスなので、なんとなく良さそうに思えるｗ</p>

<h2>
<span id="wal-eのインストール" class="fragment"></span><a href="#wal-e%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>wal-eのインストール</h2>

<p>最新を入れたい人は、gitのソースコードから入れる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git clone https://github.com/wal-e/wal-e.git
cd wal-e
sudo python setup.py install
</pre></div></div>

<p>ちょっと古くてもいい人は、以下のようにやると良い。(pip派はpip使って下さい)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apt-get install python-setuptools
sudo apt-get install python-dev libevent-dev
sudo easy_install wal-e
</pre></div></div>

<p>ちなみに、<code>postgresql</code>も<code>apt-get</code>で入れた。そしたらVersion9.1.8が入った。最新の9.2が使いたかったら自分でやること。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo apt-get install postgresql
$ psql --version
psql (PostgreSQL) 9.1.8
</pre></div></div>

<h2>
<span id="wal-e用設定" class="fragment"></span><a href="#wal-e%E7%94%A8%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>wal-e用設定</h2>

<p><a href="https://github.com/wal-e/wal-e" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/wal-e/wal-e</a> にそのまま従って設定</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo su -
umask u=rwx,g=rx,o=
mkdir -p /etc/wal-e.d/env
echo XXXXXXXXX &gt; /etc/wal-e.d/env/AWS_ACCESS_KEY_ID
echo xxxxxxxxxxxxxxxxxxxxx &gt; /etc/wal-e.d/env/AWS_SECRET_ACCESS_KEY
echo 's3://your-bucket-name/backups' &gt; /etc/wal-e.d/env/WALE_S3_PREFIX
chown -R root:postgres /etc/wal-e.d
</pre></div></div>

<p>ここyour-bucket-nameはs3のUS Standardに作る。(wal-eは現状us-eastでしか動かない。<a href="https://github.com/wal-e/wal-e/pull/3" rel="nofollow noopener" target="_blank">Issue</a>は出来ているのでもうすぐ出来るようになるかもしれないけれど。)<br>
さらに以下のブログによると悪意のあるデータ削除対策としてVersioningを有効にすると良いらしい。<br>
<a href="http://blog.opbeat.com/2013/01/07/postgresql-backup-to-s3-part-one/" class="autolink" rel="nofollow noopener" target="_blank">http://blog.opbeat.com/2013/01/07/postgresql-backup-to-s3-part-one/</a></p>

<h2>
<span id="wal-eでバックアップを取る" class="fragment"></span><a href="#wal-e%E3%81%A7%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97%E3%82%92%E5%8F%96%E3%82%8B"><i class="fa fa-link"></i></a>wal-eでバックアップを取る</h2>

<p>まず必要な環境をInstall</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apt-get install daemontools pv lzop mbuffer
</pre></div></div>

<p>wal-eでログを取るためにはwal_levelがarchive以上が必要。<br>
wal_levelはminimal(デフォルト), archive, hot_standbyの順に上がっていく。<br>
<a href="http://www.postgresql.jp/document/9.1/html/runtime-config-wal.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.postgresql.jp/document/9.1/html/runtime-config-wal.html</a></p>

<p>今回はarchiveでやるが、hot_standbyにするときは、<br>
<a href="http://blog.gomiso.com/2012/02/13/adventures-in-scaling-part-3-postgresql-streaming-replication/" class="autolink" rel="nofollow noopener" target="_blank">http://blog.gomiso.com/2012/02/13/adventures-in-scaling-part-3-postgresql-streaming-replication/</a><br>
を参考にすると良さそう。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/9.1/main/postgresql.conf</span></div>
<div class="highlight"><pre><span></span>#------------------------------------------------------------------------------
# WRITE AHEAD LOG
#------------------------------------------------------------------------------

wal_level = archive # hot_standby in 9.0 is also acceptable
archive_mode = on
archive_command = '/usr/bin/envdir /etc/wal-e.d/env /usr/local/bin/wal-e wal-push %p'
archive_timeout = 300
</pre></div>
</div>

<p>と設定して、リスタート！</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo /etc/init.d/postgresql restart
</pre></div></div>

<p>なお、<code>archive_timeout</code>は少し大きめの5分間隔にした。本当にデータを失いたくないなら、hot_stanbyにするべきだし、archive-modeで1分は短すぎてパフォーマンス的に嬉しくない気がする。詳しくは<a href="http://www.postgresql.jp/document/9.1/html/runtime-config-wal.html#GUC-ARCHIVE-TIMEOUT" rel="nofollow noopener" target="_blank">postgresqlのドキュメント</a>参照。</p>

<p><code>archive_command</code>では念のため、<code>envdir</code>や<code>wal-e</code>コマンドをfull pathで指定しておくと良いと思う。自分はこのコマンドが走るときだけ、<code>/usr/local/bin</code>がPATHに入ってないことに気づかずにだいぶハマった。なお、<code>archive_command</code>における<code>%p</code>は格納されるファイルの絶対パスを表す。<br>
<a href="http://www.postgresql.jp/document/9.1/html/runtime-config-wal.html#GUC-ARCHIVE-COMMAND" class="autolink" rel="nofollow noopener" target="_blank">http://www.postgresql.jp/document/9.1/html/runtime-config-wal.html#GUC-ARCHIVE-COMMAND</a></p>

<p>一応<code>archive_command</code>に設定した<code>wal-push</code>がちゃんと動くか確かめておこう。(<code>0000000100000000000000B4</code>の部分は各自の環境で、<code>ls /var/lib/postgresql/9.1/main/pg_xlog</code>した結果の中から一つ選ぶ。)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo su - postgres
envdir /etc/wal-e.d/env wal-e wal-push /var/lib/postgresql/9.1/main/pg_xlog/0000000100000000000000B4
</pre></div></div>

<p>うまくいってそうだったら<code>backup-push</code>してみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo su - postgres
envdir /etc/wal-e.d/env wal-e backup-push /var/lib/postgresql/9.1/main/
envdir /etc/wal-e.d/env wal-e backup-list  # ちゃんととれたか確認
</pre></div></div>

<p>ここで、<code>/var/lib/postgresql/9.1/main/</code>はPostgreSQLのデータが入ったディレクトリのこと。<code>postgresql.conf</code>に以下の様な記述があるはず。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/postgresql/9.1/main/postgresql.conf</span></div>
<div class="highlight"><pre><span></span>data_directory = '/var/lib/postgresql/9.1/main' 
</pre></div>
</div>

<p>ちなみに自分たちは、これを追加したEBS上に設定しなおしている。</p>

<h2>
<span id="バックアップタスクをcronに登録" class="fragment"></span><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97%E3%82%BF%E3%82%B9%E3%82%AF%E3%82%92cron%E3%81%AB%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>バックアップタスクをcronに登録</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo su - postgres
crontab -e
</pre></div></div>

<p>とし、以下のように打つ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>0 4 * * * /usr/bin/envdir /etc/wal-e.d/env /usr/local/bin/wal-e backup-push /var/lib/postgresql/9.1/main/
</pre></div></div>

<p>これで毎日午前4時にバックアップがとられる。<br>
(dateコマンドを打ってTimezoneがJSTになっていることを確認すること)</p>

<p>JSTにするには以下のようにすれば良い。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo mv /etc/localtime /etc/localtime.default
sudo ln -s /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
</pre></div></div>

<h2>
<span id="バックアップからのリカバリ" class="fragment"></span><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97%E3%81%8B%E3%82%89%E3%81%AE%E3%83%AA%E3%82%AB%E3%83%90%E3%83%AA"><i class="fa fa-link"></i></a>バックアップからのリカバリ</h2>

<p>バックアップからのリカバリはこれが参考になる。<br>
<a href="https://gist.github.com/ruckus/2293434" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/ruckus/2293434</a></p>

<p>とりあえずリカバリ実験用に無理やりpostgresをkillする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo pkill -9 postgres
</pre></div></div>

<p>ここからリカバリするには、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo su - postgres
cp /usr/share/postgresql/9.1/recovery.conf.sample /var/lib/postgresql/9.1/main/recovery.conf
emacs /var/lib/postgresql/9.1/main/recovery.conf
</pre></div></div>

<p>で<code>restore_command</code>にwal-fetchを設定する。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">recovery.conf</span></div>
<div class="highlight"><pre><span></span>restore_command  = '/usr/bin/envdir /etc/wal-e.d/env /usr/local/bin/wal-e wal-fetch %f %p'
</pre></div>
</div>

<p>これで、<code>sudo /etc/init.d/postgresql start</code>や<code>pg_ctl start</code>などでPostgreSQLを再起動させたらWALが残っているところまで(ほぼ全部)復元され、サービスが再開される。</p>

<p>なお、DBがrecoveryされたら、<code>recovery.conf</code>は<code>recovery.done</code>という名前になる。</p>

<h3>
<span id="データそのものが失われてしまっていた場合" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%9D%E3%81%AE%E3%82%82%E3%81%AE%E3%81%8C%E5%A4%B1%E3%82%8F%E3%82%8C%E3%81%A6%E3%81%97%E3%81%BE%E3%81%A3%E3%81%A6%E3%81%84%E3%81%9F%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>データそのものが失われてしまっていた場合</h3>

<p>ハードディスクが飛んでデータも消えちゃったことを想定し、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>rm -rf　/var/lib/postgresql/9.1/main/
</pre></div></div>

<p>する。<br>
これは、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>umask u=rwx,g=,o=
envdir /etc/wal-e.d/env wal-e backup-fetch /var/lib/postgresql/9.1/main/ LATEST
</pre></div></div>

<p>として<code>backup-push</code>したデータから基本的な構成を復元した後、先ほどの手順に従って<code>recovery.conf</code>を作成してpostgresqlを再起動したら、<code>wal_push</code>されs3にアーカイブが残っている部分まで復元できる。</p>

<h2>
<span id="不要なアーカイブログとチェックポイントのクリーンアップ" class="fragment"></span><a href="#%E4%B8%8D%E8%A6%81%E3%81%AA%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E3%83%AD%E3%82%B0%E3%81%A8%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AE%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>不要なアーカイブログとチェックポイントのクリーンアップ</h2>

<p>過去の<code>backup-push</code>のデータや、<code>wal-push</code>で送られたアーカイブログは際限なく溜まっていく。S3なのでこれらのファイルを削除しないという方針でいいかもしれないが、DBを復元する際に必要のない、直前の<code>backup-push</code>より前のものは削除してしまっても問題ない。</p>

<p>これを行うためには、以下のコマンドを叩けば良い。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>envdir /etc/wal-e.d/env wal-e backup-list | tail -n1 | cut -f1 | xargs envdir /etc/wal-e.d/env wal-e delete --confirm before
</pre></div></div>

<p>もう少し慎重に、例えば、3つ前まで残しておきたいというときは、<code>tail -n1</code>を<code>tail -n3 | head -n1</code>に変えればよい。</p>

<h2>
<span id="ハマったポイント" class="fragment"></span><a href="#%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>ハマったポイント</h2>

<p>設定に書くときは、<code>wal-e</code>を<code>/usr/local/bin/wal-e</code>にしないとダメだったという話。エラーから検索してたどり着く人もいるかもと思って書いておく。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>NOTICE:  pg_stop_backup cleanup done, waiting for required WAL segments to be archived
WARNING:  pg_stop_backup still waiting for all required WAL segments to be archived (60 seconds elapsed)
HINT:  Check that your archive_command is executing properly.  pg_stop_backup can be canceled safely, but the database backup will not be usable without all the WAL segments.
WARNING:  pg_stop_backup still waiting for all required WAL segments to be archived (120 seconds elapsed)
HINT:  Check that your archive_command is executing properly.  pg_stop_backup can be canceled safely, but the database backup will not be usable without all the WAL segments.
</pre></div></div>

<p>これは調べても、ディスク容量が足りないことやpermissionの設定が間違っているのではといった情報しか出てこないのだが、どれも当てはまらなかった。ここで、走らせる<code>archive_command</code>を</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>archive_command = 'date &gt;&gt; test.txt &amp;&amp; echo %p &gt;&gt; test.txt &amp;&amp; envdir /etc/wal-e.d/env wal-e wal-push %p || echo $? &gt;&gt; test.txt'
</pre></div></div>

<p>とし、<code>/var/lib/postgresql/9.1/main/test.txt</code>を確認することで、エラーが出た時の終了コードが111となっていることがわかり、<a href="http://www.emaillab.org/djb/tools/daemontools/envdir.html" rel="nofollow noopener" target="_blank">daemontoolsのenvdirの項目</a>を見ると、envdirはエラーコード111で死ぬことがわかり、原因を特定できた。</p>

<p>実際は以下の様なエラーが出ていたみたい。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>envdir: fatal: unable to run wal-e: file does not exist
</pre></div></div>

<p>これで、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>envdir /etc/wal-e.d/env wal-e wal-push %p
</pre></div></div>

<p>を</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>envdir /etc/wal-e.d/env /usr/local/bin/wal-e wal-push %p
</pre></div></div>

<p>に変えればいいことがわかった。</p>

<p>bashrc的なものはshを読み込んだ時しか動かないので、手元で走らせても動くけど、postgresが走らせるときには動かないみたいなことが起こるんだなと思った。気づけば当たり前なんだけど・・・。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />49位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/443697d429b8eeb1fe90">redirect_toのレスポンスコードをデフォルトで302 Foundではなく301 Moved Permanentlyにする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-15 10:11:04</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>302じゃなくて301を使う理由は、<a href="http://www.suzukikenichi.com/blog/difference-between-301-redirect-and-302-redirect/" rel="nofollow noopener" target="_blank">301リダイレクトと302リダイレクトの違い</a>参照。</p>

<p>重要なところを抜き出すと、</p>

<blockquote>
<p>301リダイレクトは、”Permanent Redirect”で「恒久的な転送」、一方、302リダイレクトは、”Temporary Redirect”で「一時的な転送」を表します。</p>
</blockquote>

<p>検索エンジンのインデックスに関して：</p>

<blockquote>
<ul>
<li>302リダイレクト：旧URLのまま</li>
<li>301リダイレクト：新URLへ</li>
</ul>
</blockquote>

<p>というようになっている。</p>

<p>ちなみにRailsでは、デフォルトで302が返るようになっている。<br>
これを変えるには、</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:moved_permanently</span>
<span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="mi">301</span>
</pre></div></div>

<p>とすれば良いのだが、自分が通常redirectしているところでは、新しいURLに移動などが多いので、移動先のURLを検索エンジンがインデックスしてくれて構わない。なので301をデフォルトにする用に書き換えておきたい。</p>

<p>そのためには、アプリケーションコントローラーに以下のコードを書けばOK。<br>
(alias_method_chainの枠組みに乗ったため、ちょっと関数名が変だが、どうせredirect_toしか使わないので気にしない。)</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/controllers/application_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">redirect_to_with_moved_permanently</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">response_status</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="n">response_status</span><span class="o">.</span><span class="n">reverse_merge!</span><span class="p">(</span><span class="ss">status</span><span class="p">:</span> <span class="ss">:moved_permanently</span><span class="p">)</span>
    <span class="n">redirect_to_without_moved_permanently</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">response_status</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">alias_method_chain</span> <span class="ss">:redirect_to</span><span class="p">,</span> <span class="ss">:moved_permanently</span>
<span class="k">end</span>
</pre></div>
</div>

<p>これで、デフォルトで301になり、</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:found</span>
<span class="n">redirect_to</span> <span class="n">root_path</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="mi">302</span>
</pre></div></div>

<p>等と書いた時だけ302を返すようになる。</p>

<p>ちなみに、元の<code>redirect_to</code>のコード以下にあるので、ご参照あれ。<br>
<a href="https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/redirecting.rb" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/rails/rails/blob/master/actionpack/lib/action_controller/metal/redirecting.rb</a></p>

<h3>
<span id="ちなみに" class="fragment"></span><a href="#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB"><i class="fa fa-link"></i></a>ちなみに</h3>

<p>301 のリダイレクトは、Rails的にはrouterを使うことを推奨している模様。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<div class="highlight"><pre><span></span>  <span class="n">get</span> <span class="s2">"/hoge"</span> <span class="o">=&gt;</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">"/fuga"</span><span class="p">)</span>
</pre></div>
</div>

<p>これだと、デフォルトで301になる。</p>

<p>自分の考えたケースだと、controllerの<code>redirect_to</code>も301デフォルトの方が良いと思ったけれど、それで良いかは自己責任でお願いします。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />50位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/2b0bfec7cc8ab75281db">Rubyで`raise_if_conflicts`というエラーが出たら`gem cleanup`を試して見ればいいんじゃないかという話</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-13 15:30:24</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Gem]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>開発をしていると、いろんなプロジェクトで<code>bundle install</code>や<code>bundle update</code>したり、直接<code>gem install</code>したりで、実に様々なバージョンのgemが入って、そのせいでコンフリクトが起こったりします。その時に、そのエラーを直すにはどうすればいいか実例で説明します。</p>

<p>今回は<code>td</code>が動かなくなった例で説明するし、自分はMacで<code>awakia</code>というユーザー名で、rubyの<code>1.9.3-p194</code>を使い、<code>rvm</code>じゃなくて<code>rbenv</code>をバージョン管理に使っているなど、細かい設定の違いはあると思いますが適宜自分の環境置き換えて読んでみてください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ td tables
/Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/1.9.1/rubygems/specification.rb:1625:in `raise_if_conflicts': can't activate td-client-0.8.25, already activated td-client-0.8.39 (Gem::LoadError)
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/1.9.1/rubygems/specification.rb:746:in `activate'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/1.9.1/rubygems/custom_require.rb:51:in `block in require'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/1.9.1/rubygems/custom_require.rb:50:in `each'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/1.9.1/rubygems/custom_require.rb:50:in `require'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-client-0.8.39/lib/td/client/api.rb:20:in `initialize'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-client-0.8.39/lib/td/client.rb:21:in `new'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-client-0.8.39/lib/td/client.rb:21:in `initialize'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-0.10.64/lib/td/command/common.rb:23:in `new'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-0.10.64/lib/td/command/common.rb:23:in `get_client'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-0.10.64/lib/td/command/table.rb:195:in `table_tail'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-0.10.64/lib/td/command/list.rb:161:in `call'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-0.10.64/lib/td/command/list.rb:161:in `block in get_method'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-0.10.64/lib/td/command/runner.rb:122:in `call'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-0.10.64/lib/td/command/runner.rb:122:in `run'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/gems/td-0.10.64/bin/td:9:in `&lt;top (required)&gt;'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/bin/td:23:in `load'
    from /Users/awakia/.rbenv/versions/1.9.3-p194/bin/td:23:in `&lt;main&gt;'
</pre></div></div>

<p>というようになった場合の対処です。</p>

<p>一つの方法は、頭に<code>bundle exec</code>を付ければ良いです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ bundle exec td tables
</pre></div></div>

<p>ただ、<code>bundle exec</code>なしでも動かしたいですよね。</p>

<p>今回の場合、調べてみると<code>td-0.10.64</code>の<code>td-client</code>のバージョン指定が<code>~&gt; 0.8.39</code>となっていて、それをrequireした後、<code>custom_require.rb</code>が過去のバージョンのものまでrequireしていたのでコンフリクトしているようだということがわかりました。</p>

<p>過去インストールしたバージョンのgemはすべて以下のディレクトリに入っています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/Users/awakia/.rbenv/versions/1.9.3-p194/lib/ruby/gems/1.9.1/specifications
</pre></div></div>

<p>この中に　<code>td-client-0.8.24.gemspec</code> があったので、これを消してみます。<br>
そうすると、今度は <code>td-client-0.8.25.gemspec</code> があって入らないみたいなエラーに変わりました。</p>

<p>ここまでで、この調子でどんどん以前のバージョンを消していけばよさそうということはわかりました。</p>

<p>過去のバージョンを一個一個手で消してもいいんだけど、めんどくさいなぁと思っていたら、ちょうどいいコマンドがありました。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>gem cleanup
</pre></div></div>

<p>これは、古いバージョンのgemだけを削除するコマンドで、正式には以下のように書かれています。</p>

<blockquote>
<p>Clean up old versions of installed gems in the local repository</p>
</blockquote>

<p>ちなみに、ある環境は古いのを使っていた場合に、消しすぎちゃう場合があるんじゃないかという心配もあるけれど、結局動かなくなっても<code>bundle install</code>,<code>gem install</code>すれば、またそれはインストールされるので気にせずcleanupしちゃえばいいのではないかと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />51位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/8aad7b57aead3cf9720d">Macでnginxを使う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-28 15:55:01</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[nginx]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="まずは使ってみる" class="fragment"></span><a href="#%E3%81%BE%E3%81%9A%E3%81%AF%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>まずは使ってみる</h2>

<p>基本は</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>brew install nginx
</pre></div></div>

<p>でインストールしたら</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>nginx
</pre></div></div>

<p>で起動して</p>

<p><a href="http://localhost:8080" class="autolink" rel="nofollow noopener" target="_blank">http://localhost:8080</a></p>

<p>を開けばいいだけ。</p>

<p>設定は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/usr/local/etc/nginx/nginx.conf
</pre></div></div>

<p>においてあり、ここを変えて変更する。</p>

<ul>
<li>ストップ: <code>nginx -s stop</code>
</li>
<li>リロード: <code>nginx -s reload</code>
</li>
</ul>

<p>のようにできるので、設定を変えたらリロードを忘れないこと。</p>

<p>localhost:8080のルートは、デフォルトで</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/usr/local/www
</pre></div></div>

<p>に設定されており、このディレクトリ下の<code>index.html</code>を書き換えれば内容が変わる。</p>

<h2>
<span id="モジュールをいろいろ使いたいとき" class="fragment"></span><a href="#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%92%E3%81%84%E3%82%8D%E3%81%84%E3%82%8D%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E3%81%A8%E3%81%8D"><i class="fa fa-link"></i></a>モジュールをいろいろ使いたいとき</h2>

<p><code>marcqualie/nginx</code>に管理されている<code>nginx-full</code>を使うのが良いらしい。</p>

<p>ちなみにnginxはモジュールとか言いつつ毎回ビルドし直さないといけないから、インストール時に何を入れるか指定しないといけない。なので<code>brew nginx-full</code>で一から入れ直すという方法が簡単。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>brew options marcqualie/nginx/nginx-full
</pre></div></div>

<p>とすれば、インストールできるモジュール一覧が確認できる。</p>

<p>とりあえず、image-filterと、使えるという噂のLua モジュールを入れてみる。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>brew install marcqualie/nginx/nginx-full --with-lua-module --with-image-filter
</pre></div></div>

<p><code>--with-image-filter</code>はGD Libraryが必要なので、<code>brew install libgd</code>をした後にやらないとダメなので注意。</p>

<p><code>brew install nginx</code>をしちゃってる人は、<code>brew uninstall nginx</code>をしてからやったほうが無難。まぁ<code>brew link nginx-full</code>とか使えば後からでもなんとかなる。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />52位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/b836e7792be0a7c65fd4">Emacsで1行の文字数が指定値をオーバーしていたらハイライトする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-02 05:22:43</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>具体的なコード例を示します。</p>

<div class="code-frame" data-lang="lisp">
<div class="code-lang"><span class="bold">.emacs</span></div>
<div class="highlight"><pre><span></span><span class="c1">;;; C系統,Pythonにて1行80文字を超えるとハイライト</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'c-mode-hook</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">font-lock-add-keywords</span> <span class="no">nil</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"^[^\n]\\{80\\}\\(.*\\)$"</span> <span class="mi">1</span> <span class="nv">font-lock-warning-face</span> <span class="no">t</span><span class="p">)))))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'c++-mode-hook</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">font-lock-add-keywords</span> <span class="no">nil</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"^[^\n]\\{80\\}\\(.*\\)$"</span> <span class="mi">1</span> <span class="nv">font-lock-warning-face</span> <span class="no">t</span><span class="p">)))))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'python-mode-hook</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">font-lock-add-keywords</span> <span class="no">nil</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"^[^\n]\\{80\\}\\(.*\\)$"</span> <span class="mi">1</span> <span class="nv">font-lock-warning-face</span> <span class="no">t</span><span class="p">)))))</span>

<span class="c1">;;; Javaで1行100文字を超えるとハイライト</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'java-mode-hook</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">font-lock-add-keywords</span> <span class="no">nil</span>
      <span class="o">'</span><span class="p">((</span><span class="s">"^[^\n]\\{100\\}\\(.*\\)$"</span> <span class="mi">1</span> <span class="nv">font-lock-warning-face</span> <span class="no">t</span><span class="p">)))))</span>
</pre></div>
</div>

<p>ちなみに、C++, Pythonで1行80文字、Javaで1行100文字までというのはGoogleで使われているスタイルガイドに即しています。</p>

<ul>
<li><a href="http://code.google.com/p/google-styleguide/" class="autolink" rel="nofollow noopener" target="_blank">http://code.google.com/p/google-styleguide/</a></li>
<li><a href="http://source.android.com/source/code-style.html" class="autolink" rel="nofollow noopener" target="_blank">http://source.android.com/source/code-style.html</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />53位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/a91ae79548ce21f5eb91">Admin用ページを作るのに使えそうなjavascript(主にjQuery)ライブラリ集 - WrapBootstrapより</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-29 04:16:48</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[jQuery]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="inlineグラフ描画" class="fragment"></span><a href="#inline%E3%82%B0%E3%83%A9%E3%83%95%E6%8F%8F%E7%94%BB"><i class="fa fa-link"></i></a>Inlineグラフ描画</h2>

<h3>
<span id="sparkline" class="fragment"></span><a href="#sparkline"><i class="fa fa-link"></i></a>sparkline</h3>

<ul>
<li><a href="http://omnipotent.net/jquery.sparkline/#s-about" class="autolink" rel="nofollow noopener" target="_blank">http://omnipotent.net/jquery.sparkline/#s-about</a></li>
</ul>

<h3>
<span id="peity" class="fragment"></span><a href="#peity"><i class="fa fa-link"></i></a>Peity</h3>

<ul>
<li><a href="http://benpickles.github.io/peity/" class="autolink" rel="nofollow noopener" target="_blank">http://benpickles.github.io/peity/</a></li>
</ul>

<h2>
<span id="グラフ描画" class="fragment"></span><a href="#%E3%82%B0%E3%83%A9%E3%83%95%E6%8F%8F%E7%94%BB"><i class="fa fa-link"></i></a>グラフ描画</h2>

<h3>
<span id="flot" class="fragment"></span><a href="#flot"><i class="fa fa-link"></i></a>Flot</h3>

<ul>
<li><a href="http://www.flotcharts.org/" class="autolink" rel="nofollow noopener" target="_blank">http://www.flotcharts.org/</a></li>
</ul>

<h3>
<span id="knob" class="fragment"></span><a href="#knob"><i class="fa fa-link"></i></a>Knob</h3>

<ul>
<li><a href="http://anthonyterrien.com/knob/" class="autolink" rel="nofollow noopener" target="_blank">http://anthonyterrien.com/knob/</a></li>
</ul>

<h2>
<span id="notification" class="fragment"></span><a href="#notification"><i class="fa fa-link"></i></a>Notification</h2>

<h3>
<span id="glitter" class="fragment"></span><a href="#glitter"><i class="fa fa-link"></i></a>Glitter</h3>

<p><a href="http://boedesign.com/demos/gritter/" class="autolink" rel="nofollow noopener" target="_blank">http://boedesign.com/demos/gritter/</a></p>

<h3>
<span id="pnotify" class="fragment"></span><a href="#pnotify"><i class="fa fa-link"></i></a>pnotify</h3>

<p><a href="http://pinesframework.org/pnotify/" class="autolink" rel="nofollow noopener" target="_blank">http://pinesframework.org/pnotify/</a></p>

<h2>
<span id="code-editor" class="fragment"></span><a href="#code-editor"><i class="fa fa-link"></i></a>Code Editor</h2>

<h3>
<span id="ace-editor" class="fragment"></span><a href="#ace-editor"><i class="fa fa-link"></i></a>Ace Editor</h3>

<ul>
<li><a href="http://ajaxorg.github.io/ace/#nav=about" class="autolink" rel="nofollow noopener" target="_blank">http://ajaxorg.github.io/ace/#nav=about</a></li>
</ul>

<h2>
<span id="rich-text-editor" class="fragment"></span><a href="#rich-text-editor"><i class="fa fa-link"></i></a>Rich-text Editor</h2>

<h3>
<span id="wysihtml5" class="fragment"></span><a href="#wysihtml5"><i class="fa fa-link"></i></a>wysihtml5</h3>

<ul>
<li><a href="http://xing.github.io/wysihtml5/" class="autolink" rel="nofollow noopener" target="_blank">http://xing.github.io/wysihtml5/</a></li>
</ul>

<h2>
<span id="modern-form-element" class="fragment"></span><a href="#modern-form-element"><i class="fa fa-link"></i></a>Modern Form Element</h2>

<h3>
<span id="select2" class="fragment"></span><a href="#select2"><i class="fa fa-link"></i></a>select2</h3>

<ul>
<li><a href="https://github.com/ivaynberg/select2" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ivaynberg/select2</a></li>
</ul>

<h3>
<span id="uniform" class="fragment"></span><a href="#uniform"><i class="fa fa-link"></i></a>uniform</h3>

<ul>
<li><a href="http://uniformjs.com/" class="autolink" rel="nofollow noopener" target="_blank">http://uniformjs.com/</a></li>
</ul>

<h3>
<span id="colorpicker" class="fragment"></span><a href="#colorpicker"><i class="fa fa-link"></i></a>colorpicker</h3>

<ul>
<li><a href="http://www.eyecon.ro/colorpicker/" class="autolink" rel="nofollow noopener" target="_blank">http://www.eyecon.ro/colorpicker/</a></li>
<li><a href="http://bgrins.github.io/spectrum/" class="autolink" rel="nofollow noopener" target="_blank">http://bgrins.github.io/spectrum/</a></li>
</ul>

<h3>
<span id="datepicker" class="fragment"></span><a href="#datepicker"><i class="fa fa-link"></i></a>datepicker</h3>

<ul>
<li><a href="http://jqueryui.com/datepicker/" class="autolink" rel="nofollow noopener" target="_blank">http://jqueryui.com/datepicker/</a></li>
</ul>

<h3>
<span id="validation" class="fragment"></span><a href="#validation"><i class="fa fa-link"></i></a>validation</h3>

<ul>
<li><a href="http://bassistance.de/jquery-plugins/jquery-plugin-validation/" class="autolink" rel="nofollow noopener" target="_blank">http://bassistance.de/jquery-plugins/jquery-plugin-validation/</a></li>
</ul>

<h3>
<span id="wizard" class="fragment"></span><a href="#wizard"><i class="fa fa-link"></i></a>wizard</h3>

<ul>
<li><a href="https://github.com/thecodemine/formwizard" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/thecodemine/formwizard</a></li>
<li><a href="https://github.com/kflorence/jquery-wizard" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/kflorence/jquery-wizard</a></li>
</ul>

<h3>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h3>

<p><a href="https://wrapbootstrap.com/themes/admin" class="autolink" rel="nofollow noopener" target="_blank">https://wrapbootstrap.com/themes/admin</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />54位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/3b7d7035ae54cc48319c">Mac上で、自分のサイトがiPhoneでどう見えるかを確認する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-04 13:25:40</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[Mac]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>XCodeをインストール。</p>

<p>後は、シェルで</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">Terminal</span></div>
<div class="highlight"><pre><span></span>$ open /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/Applications/iPhone<span class="se">\ </span>Simulator.app/
</pre></div>
</div>

<p>と叩くだけ。iPhoneSimulatorが起動する。</p>

<p>Safariを開いて、<code>localhost:3000</code>などと適当に挙動を確認したいURLを入れる。</p>

<p>iPhoneシミュレーターはあくまでシミュレーターでたまに実際と挙動が異なることがあるので注意。ただ、localhostにアクセスできるし、簡単に確認したい時には役立つはず！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />55位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/68ad74c5b66aa36df625">nvd3.jsが使っているライブラリ集</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-01-10 13:24:39</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[d3]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://nvd3.org/" rel="nofollow noopener" target="_blank">nvd3.js</a>のソースコードのlib<br>
<a href="https://github.com/novus/nvd3/tree/master/lib" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/novus/nvd3/tree/master/lib</a><br>
より。</p>

<p>基本的にソースコードではなく、デモへのリンク</p>

<h2>
<span id="ciejs" class="fragment"></span><a href="#ciejs"><i class="fa fa-link"></i></a>cie.js</h2>

<p>色空間の変換<br>
<a href="http://bl.ocks.org/3014589" class="autolink" rel="nofollow noopener" target="_blank">http://bl.ocks.org/3014589</a></p>

<h2>
<span id="clossfilterjs" class="fragment"></span><a href="#clossfilterjs"><i class="fa fa-link"></i></a>clossfilter.js</h2>

<p>データセットに対し、slice,sum,top-k等の処理を高速に適用<br>
<a href="http://square.github.com/crossfilter/" class="autolink" rel="nofollow noopener" target="_blank">http://square.github.com/crossfilter/</a></p>

<h2>
<span id="d3js" class="fragment"></span><a href="#d3js"><i class="fa fa-link"></i></a>d3.js</h2>

<p>d3本体<br>
<a href="http://d3js.org/" class="autolink" rel="nofollow noopener" target="_blank">http://d3js.org/</a></p>

<h2>
<span id="fisheyejs" class="fragment"></span><a href="#fisheyejs"><i class="fa fa-link"></i></a>fisheye.js</h2>

<p>2種類の拡大鏡<br>
<a href="http://bost.ocks.org/mike/fisheye/" class="autolink" rel="nofollow noopener" target="_blank">http://bost.ocks.org/mike/fisheye/</a></p>

<h2>
<span id="hivejs" class="fragment"></span><a href="#hivejs"><i class="fa fa-link"></i></a>hive.js</h2>

<p>リンク構造の可視化<br>
<a href="http://bost.ocks.org/mike/hive/" class="autolink" rel="nofollow noopener" target="_blank">http://bost.ocks.org/mike/hive/</a></p>

<h2>
<span id="horizonjs" class="fragment"></span><a href="#horizonjs"><i class="fa fa-link"></i></a>horizon.js</h2>

<p>高さが違いすぎる累積グラフを重ることで省スペース可視化<br>
<a href="http://bl.ocks.org/1483226" class="autolink" rel="nofollow noopener" target="_blank">http://bl.ocks.org/1483226</a></p>

<h2>
<span id="spankeyjs" class="fragment"></span><a href="#spankeyjs"><i class="fa fa-link"></i></a>spankey.js</h2>

<p>流入と流出の可視化<br>
<a href="http://bost.ocks.org/mike/sankey/" class="autolink" rel="nofollow noopener" target="_blank">http://bost.ocks.org/mike/sankey/</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />56位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/5c97b02dcc3c7fd20279">C++でプログラミングコンテストをする時用のflymakeの設定</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-02 12:54:38</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Emacs]</b> <b>[C++]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>出来るようになること</p>

<ul>
<li>タイプしている途中にエラーを表示してハイライトしてくれる(flymakeの機能)</li>
<li>flymakeに通常必要なMakefileを用意しなくて良くなる</li>
<li>next-error(<code>\C-e</code>にバインド), prev-error(<code>\M-e</code>にバインド)でミニバッファにエラーを表示</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>;;;flymake
(require 'flymake)

;;エラーメッセージをミニバッファで表示させる
(global-set-key "\C-e" 'flymake-goto-next-error)
(global-set-key "\M-e" 'flymake-goto-prev-error)

;; gotoした際にエラーメッセージをminibufferに表示する
(defun display-error-message ()
  (message (get-char-property (point) 'help-echo)))
(defadvice flymake-goto-prev-error (after flymake-goto-prev-error-display-message)
  (display-error-message))
(defadvice flymake-goto-next-error (after flymake-goto-next-error-display-message)
  (display-error-message))
(ad-activate 'flymake-goto-prev-error 'flymake-goto-prev-error-display-message)
(ad-activate 'flymake-goto-next-error 'flymake-goto-next-error-display-message)

;;c++のflymakeでmakefileを不要にする
(defun flymake-cc-init ()
  (let* ((temp-file   (flymake-init-create-temp-buffer-copy
               'flymake-create-temp-inplace))
         (local-file  (file-relative-name
               temp-file
               (file-name-directory buffer-file-name))))
    (list "g++" (list "-Wall" "-Wextra" "-fsyntax-only" local-file))))

(push '("\\.cc$" flymake-cc-init) flymake-allowed-file-name-masks)
(push '("\\.cpp$" flymake-cc-init) flymake-allowed-file-name-masks)
(push '("\\.h$" flymake-cc-init) flymake-allowed-file-name-masks)
(push '("\\.hpp$" flymake-cc-init) flymake-allowed-file-name-masks)

(add-hook 'c++-mode-hook '(lambda ()
  (flymake-mode t)
))
</pre></div></div>

<p>昔2箇所ぐらいからとってきて合体したんだけどソースがわからない。ごめんなさい。。。</p>

<h2>
<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h2>

<p>Flymake以外のC++の記述の際に関係する部分の設定</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>;;; 各種キーバインド
(global-unset-key "\C-l")
(global-set-key "\C-l" 'goto-line)  ;; \C-lは元来'recenter
(global-unset-key "\C-t")  ;; 文字のトグルは押し間違えしかないのでoffに
(global-set-key "\C-m" 'newline-and-indent)  ;; Returnキーを押したあとindentもするように

;;; 表示まわり
(transient-mark-mode t)
(show-paren-mode t)
(line-number-mode t)
(column-number-mode t)

;;; インデントポリシー
(setq c-default-style "stroustrup")
(setq-default indent-tabs-mode nil)  ;; タブを使わずにスペースを使う
(setq-default tab-width 2)

;;; 保存時の設定
(add-hook 'before-save-hook 'delete-trailing-whitespace)

;;; その他基本設定
(setq kill-whole-line t)  ;; 行頭でのC-kで行全体を削除
(setq backup-inhibited t)  ;; バックアップファイルを作らない
(setq delete-auto-save-files t)  ;; 終了時にオートセーブファイルを消す

;;; c-mode-common
(add-hook 'c-mode-common-hook
          '(lambda ()
             (progn
               (setq c-basic-offset 2)
             )))
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />57位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/0b322e45d249806dd5eb">今使用しているgemのコードをエディタで開く</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-20 18:13:40</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> <b>[SublimeText2]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>コマンドラインで以下のように入力</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>subl `bundle show [gem-name]`
</pre></div></div>

<p><code>subl</code>はディレクトリを開けるエディタであれば置き換え可能。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />58位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>10</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/1040d0b1b910d7ffbe52">JavaでAR.Droneを動かす</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-14 23:37:08</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[ARDrone]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>調べた限り、AR.Drone2.0にも対応しているライブラリではjavadroneが良さそう。New BSDライセンス。</p>

<p><a href="https://code.google.com/p/javadrone/" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/javadrone/</a></p>

<p>Java用APIとAndroidでAR.Droneを動かすサンプルが入っている。</p>

<p>動かすためには以下のものをインストールして</p>

<ul>
<li>Apache Maven (<a href="http://maven.apache.org/" class="autolink" rel="nofollow noopener" target="_blank">http://maven.apache.org/</a>)

<ul>
<li>EClips用プラグイン:m2eclipse (<a href="http://eclipse.org/m2e/" class="autolink" rel="nofollow noopener" target="_blank">http://eclipse.org/m2e/</a>)</li>
</ul>
</li>
<li>Android SDK (<a href="http://developer.android.com/sdk/index.html" class="autolink" rel="nofollow noopener" target="_blank">http://developer.android.com/sdk/index.html</a>)

<ul>
<li>Eclipse用プラグイン:eclipse-adt (<a href="http://developer.android.com/tools/sdk/eclipse-adt.html" class="autolink" rel="nofollow noopener" target="_blank">http://developer.android.com/tools/sdk/eclipse-adt.html</a>)</li>
</ul>
</li>
</ul>

<p>後は、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mvn install
mvn eclipse:eclipse
</pre></div></div>

<p>をし、Eclipse用プロジェクトファイルを作成。<br>
Eclipseで生成したProjectを開き、ControlTowerクラスを実行するとサンプルプログラムが動く。</p>

<p>この時、ビルド用に<code>M2_REPO=~/.m2/repository</code>とパスを設定する必要がある。</p>

<p>参考: <a href="https://code.google.com/p/javadrone/wiki/BuildInstructions" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/javadrone/wiki/BuildInstructions</a></p>

<h2>
<span id="opencvとともに使う" class="fragment"></span><a href="#opencv%E3%81%A8%E3%81%A8%E3%82%82%E3%81%AB%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>OpenCVとともに使う</h2>

<p>まずはOpenCVをインストールして、それをJava用にWrapしてくれているJavaCVを使う。</p>

<ul>
<li>OpenCV (<a href="http://opencv.willowgarage.com/wiki/" class="autolink" rel="nofollow noopener" target="_blank">http://opencv.willowgarage.com/wiki/</a>)</li>
<li>JavaCV (<a href="http://code.google.com/p/javacv/" class="autolink" rel="nofollow noopener" target="_blank">http://code.google.com/p/javacv/</a>)</li>
</ul>

<p>ちなみにJavaCVはOpenCVだけでなく、FFmpeg, libdc1394, PGR FlyCapture, OpenKinect, videoInput, ARToolKitPlusのラップもしてくれるので、これらを使いたい人は各ライブラリをインストールした状態であればJavaから使えるようになる。</p>

<h3>
<span id="参考facedetectionして顔を追わせるサンプル" class="fragment"></span><a href="#%E5%8F%82%E8%80%83facedetection%E3%81%97%E3%81%A6%E9%A1%94%E3%82%92%E8%BF%BD%E3%82%8F%E3%81%9B%E3%82%8B%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB"><i class="fa fa-link"></i></a>参考:FaceDetectionして、顔を追わせるサンプル</h3>

<p><a href="http://projects.collide.info/projects/drone/repository/revisions/3/entry/javadrone2/src/main/java/info/collide/javadrone/facetracker/FollowFaceDemo.java" class="autolink" rel="nofollow noopener" target="_blank">http://projects.collide.info/projects/drone/repository/revisions/3/entry/javadrone2/src/main/java/info/collide/javadrone/facetracker/FollowFaceDemo.java</a></p>

<h2>
<span id="補足何でjava" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3%E4%BD%95%E3%81%A7java"><i class="fa fa-link"></i></a>補足：何でJava?</h2>

<p>まず、C++のSDKそのままは使うの苦労しすぎる。</p>

<p>SDKを少し使いやすくしたC++用ライブラリも複数あるのだが、Visual C++を前提にしていてMacでどうするよ？となったり、makeしてもインストール出来なく、ユーザーも少ないせいで簡単には解決法が見つからないということが起きる。</p>

<p>ちょっと飛ばすだけなら、Processing(ARDroneForP5)が簡単だが、ProcessingはOpenCVのラッパが基本的な部分だけしかラップされてないのでOpenCV連携がきつい。</p>

<p>Python(python-ardrone)もホントに飛ばすことしか出来ない。しかも依存しているライブラリが結構古く、pipなどで入らなくてめんどくさい。</p>

<p>などなど色々試しているうちにJavaに落ち着いた。特に、複数人で開発するなら、皆がある程度の労力で動かせるところまで持ってけるっていうのはとても大切だと思う。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />59位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/db80b6af5fe6928a08ca">gemをupdateする時に確かめるべきこと</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-27 17:17:48</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>bundle update</code>とかしてgemのバージョンが上がっていると、特にメジャーバージョンとか上がっちゃったりしてた場合、自分たちのテストが通ったとしてもちょっと大丈夫か不安ですよね？<br>
そういう時により安心感を増すために必要なテクニックです。</p>

<h2>
<span id="アップデートしたgemのgithubページに行く" class="fragment"></span><a href="#%E3%82%A2%E3%83%83%E3%83%97%E3%83%87%E3%83%BC%E3%83%88%E3%81%97%E3%81%9Fgem%E3%81%AEgithub%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E8%A1%8C%E3%81%8F"><i class="fa fa-link"></i></a>アップデートしたgemのGithubページに行く</h2>

<p>基本的にはこれだけです。<br>
<code>github &lt;gem名&gt;</code>や<code>gem &lt;gem名&gt;</code>でググってgemのGithubページに行きましょう。<br>
rubygems.orgのページが先に見つかったらLinksのHomepageやSourceCodeをクリックすると、たどり着けるはずです。</p>

<p>ここですることは以下の3つです。</p>

<h3>
<span id="1-readmeの部分にupdateに関しての記述がないか見てみる" class="fragment"></span><a href="#1-readme%E3%81%AE%E9%83%A8%E5%88%86%E3%81%ABupdate%E3%81%AB%E9%96%A2%E3%81%97%E3%81%A6%E3%81%AE%E8%A8%98%E8%BF%B0%E3%81%8C%E3%81%AA%E3%81%84%E3%81%8B%E8%A6%8B%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>1. READMEの部分にUpdateに関しての記述がないか見てみる</h3>

<p>GithubではREADME系のファイルがドキュメントとして表示されるようになっているので、そこでUpdateなどについての記述がないか探してみましょう。</p>

<p>例：</p>

<ul>
<li><a href="https://github.com/sferik/twitter#whats-new-in-version-5" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sferik/twitter#whats-new-in-version-5</a></li>
<li><a href="https://github.com/mbleigh/acts-as-taggable-on#compatibility" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mbleigh/acts-as-taggable-on#compatibility</a></li>
</ul>

<h3>
<span id="2-releasesを確認してどのくらい上がっているのかなどを見る" class="fragment"></span><a href="#2-releases%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%A9%E3%81%AE%E3%81%8F%E3%82%89%E3%81%84%E4%B8%8A%E3%81%8C%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%8B%E3%81%AA%E3%81%A9%E3%82%92%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>2. Releasesを確認してどのくらい上がっているのかなどを見る</h3>

<p>バージョンが少し上がってるのか大きく上がっているのかでもだいぶ安心感が違います。どのくらい上がったのかを確認しましょう。</p>

<p>githubページのサブヘッダーの右から3個目にrelesesというのがあるのでそこをクリックします。</p>

<p><a href="https://camo.qiitausercontent.com/5f25911e85414cfc7be0f3324e3217d88a1eeb75/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f363636342f65666463336633372d343666392d633663322d376632332d3732313262646530396238662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5f25911e85414cfc7be0f3324e3217d88a1eeb75/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f363636342f65666463336633372d343666392d633663322d376632332d3732313262646530396238662e706e67" alt="subheader-github.png" title="subheader-github.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/6664/efdc3f37-46f9-c6c2-7f23-7212bde09b8f.png"></a></p>

<p>たまに、どういうふうに上がったかの詳細まで書いてあることがある</p>

<p>例：<a href="https://github.com/lostisland/faraday/releases" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/lostisland/faraday/releases</a></p>

<h3>
<span id="3-バージョンが上がる前と後とのコードの変更を確認" class="fragment"></span><a href="#3-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%81%8C%E4%B8%8A%E3%81%8C%E3%82%8B%E5%89%8D%E3%81%A8%E5%BE%8C%E3%81%A8%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E5%A4%89%E6%9B%B4%E3%82%92%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>3. バージョンが上がる前と後とのコードの変更を確認</h3>

<p>エンジニアだったら最後はコードで確認したいですよね。<br>
そういう場合は2.のreleasesのページで見たタグを以下のフォーマットで入れてURLを叩けばdiffが見れます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>https://github.com/&lt;username&gt;/&lt;gemname&gt;/compare/&lt;tagname1&gt;...&lt;tagname2&gt;
</pre></div></div>

<p>例：<a href="https://github.com/arsduo/koala/compare/v1.6.0...v1.9.0" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/arsduo/koala/compare/v1.6.0...v1.9.0</a></p>

<p>見るべきポイントとしては、 README や CHANGELOG の変更を中心にファイルの変更をざっと見る他、もしテストが壊れたりしていてエラーがgem内部だった場合、このViewの中から検索すると原因がわかりやすいかと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />60位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/ad5eb7e3163c1465bd7d">`git init`直後の`git reset .`</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-13 01:48:54</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>通常、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git add .
</pre></div></div>

<p>の反対は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git reset .
</pre></div></div>

<p>で良い。</p>

<p>ただ、それが<code>git init</code>の直後で、まだ一つもコミットがない状態だと</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git add .
$ git reset .
fatal: Failed to resolve 'HEAD' as a valid ref.
</pre></div></div>

<p>とHEADがないよと怒られてしまう。</p>

<p>そんな時は、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git rm --cached -r .
</pre></div></div>

<p>とすると解決する。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />61位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/3f97904738448fd7c6cd">スクリプト言語で実行可能なファイルを作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-10 19:44:08</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Python]</b> <b>[Perl]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下のように、<code>#!</code>から始まる行をファイルの1行目に記述する。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">hoge.rb</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env ruby</span>

<span class="p">(</span><span class="err">プログラムの内容</span><span class="p">)</span>
</pre></div>
</div>

<p><code>#!</code>は、シェバングと言って、これ以下に書いてあるコマンドで、自分自身を実行し直してくれる。<br>
<code>/usr/bin/env</code>を使うことで<code>which ruby</code>で出てくるような環境依存のPATHを書かなくて良くなる。<code>/usr/bin/env</code>も環境依存っちゃ環境依存だけど、ほとんど共通で入ってるし、もしデフォルトで入ってなくてもこのPATHでenvを実行できるようにしちゃえば、それ以降は困ることが無いからいいんじゃないかな。</p>

<p>後は、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ chmod +x hoge.rb
</pre></div></div>

<p>とやって実行権限をつけてあげれば、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ./hoge.rb
</pre></div></div>

<p>のように実行できる。</p>

<p>他の言語でも、<code>ruby</code>の部分を<code>perl</code>,<code>python</code>などに置き換えれば良い。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">hoge.py</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
</pre></div>
</div>

<h3>
<span id="補足" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>補足</h3>

<p>文字コードを指定するのに使う、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># coding: utf-8
</pre></div></div>

<p>等は2行目に持ってきたのでOK。</p>

<h3>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h3>

<p><a href="http://x68000.q-e-d.net/~68user/unix/pickup?%A5%B7%A5%A7%A5%D0%A5%F3%A5%B0" class="autolink" rel="nofollow noopener" target="_blank">http://x68000.q-e-d.net/~68user/unix/pickup?%A5%B7%A5%A7%A5%D0%A5%F3%A5%B0</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />62位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/75652e67b5c665df5bf0">Rails ConsoleからRails Runnerで走らせるスクリプトを呼ぶ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-25 16:58:56</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>rails r lib/util/some_script.rb</code>を<code>rails c</code>の中で呼ぶ方法：</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ rails c
<span class="o">[</span><span class="m">1</span><span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; load ‘lib/util/some_script.rb’
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />63位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/c81bb0824189cc481913">REPLでAppDelegateの中身を見る - メソッド検索やデバッグに便利！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-09 15:04:04</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[RubyMotion]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>RubyMotionのREPL便利ですよね。そう、あのirb的なやつです。</p>

<p>シミュレーターでCommand+Clickでクリックしたところで色々な変数やメソッド見られるのはいいんですが、実際思っているクラス(ViewControllerとか)にいかなくて苦労したりしませんか？</p>

<p>そんな時はREPLで以下のコマンドを打ってAppDelegateからたどっちゃいましょう！</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="no">UIApplication</span><span class="o">.</span><span class="n">sharedApplication</span>
<span class="n">repl</span> <span class="n">app</span><span class="o">.</span><span class="n">delegate</span> 
</pre></div></div>

<p>実際にはこんな感じで使います。<br>
TabBarViewの、1つ目のタブにあるボタンで、'target'という文字列を含むメソッドを探す例。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rake
     Build ./build/iPhoneSimulator-6.1-Development
  Simulate ./build/iPhoneSimulator-6.1-Development/Sample.app
(main)&gt; app = UIApplication.sharedApplication
=&gt; #&lt;UIApplication:0x9475190&gt;
(main)&gt; app.delegate
=&gt; #&lt;AppDelegate:0x76711c0 @window=#&lt;UIWindow:0x76aa640&gt;&gt;
(main)&gt; repl app.delegate
=&gt; #&lt;AppDelegate:0x76711c0 @window=#&lt;UIWindow:0x76aa640&gt;&gt;
(#&lt;AppDelegate:0x76711c0 @windo...)&gt; @window
=&gt; #&lt;UIWindow:0x76aa640&gt;
(#&lt;AppDelegate:0x76711c0 @windo...)&gt; @window.rootViewController
=&gt; #&lt;UITabBarController:0xd174850&gt;
(#&lt;AppDelegate:0x76711c0 @windo...)&gt; @window.rootViewController.viewControllers
=&gt; [#&lt;TagBasedIBViewController:0xd174590&gt;]
(#&lt;AppDelegate:0x76711c0 @windo...)&gt; @window.rootViewController.viewControllers[0]
=&gt; #&lt;TagBasedIBViewController:0xd174590&gt;
(#&lt;AppDelegate:0x76711c0 @windo...)&gt; repl @window.rootViewController.viewControllers[0]
=&gt; #&lt;TagBasedIBViewController:0xd174590&gt;
(#&lt;TagBasedIBViewController:0xd...)&gt; @button
=&gt; #&lt;UIRoundedRectButton:0x96871c0&gt;
(#&lt;TagBasedIBViewController:0xd...)&gt; @button.methods.grep /target/i
=&gt; [:"addTarget:action:forControlEvents:", :"removeTarget:action:forControlEvents:", :"actionsForTarget:forControlEvent:", :"sendAction:toTarget:forEvent:", :hasOneOrMoreTargets, :"addTarget:action:forEvents:", :allTargets, :"removeTarget:forEvents:", :"forwardingTargetForSelector:"]
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />64位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/bb9fb6e02a17013ef9c9">configで設定可能なRails用gemを作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-16 12:23:31</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ActiveSupport::Configurableを使えばできる。<br>
Class Methods, Instance Methodsどっちもある。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">'active_support/configurable'</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Configurable</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>

<span class="no">User</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">default_level</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">user</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">allowed_access</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">user</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">1</span>

<span class="no">User</span><span class="o">.</span><span class="n">config</span>  <span class="c1"># =&gt; {:default_level=&gt;3}</span>
<span class="n">user</span><span class="o">.</span><span class="n">config</span>  <span class="c1"># =&gt; {:allowed_access=&gt;true, :level=&gt;1}</span>
</pre></div></div>

<h3>
<span id="参照" class="fragment"></span><a href="#%E5%8F%82%E7%85%A7"><i class="fa fa-link"></i></a>参照</h3>

<ul>
<li><a href="http://api.rubyonrails.org/classes/ActiveSupport/Configurable/ClassMethods.html" class="autolink" rel="nofollow noopener" target="_blank">http://api.rubyonrails.org/classes/ActiveSupport/Configurable/ClassMethods.html</a></li>
<li><a href="http://api.rubyonrails.org/classes/ActiveSupport/Configurable.html" class="autolink" rel="nofollow noopener" target="_blank">http://api.rubyonrails.org/classes/ActiveSupport/Configurable.html</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />65位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/d09194fbbf93b9c49178">Railsで、どんなモデルに対してもメモを取れるようにする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-19 11:08:15</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[JavaScript]</b> <b>[Rails]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>今回は営業の人が顧客だったり、商品だったり、会社だったりのモデルに対して共有できるメモを取るというニーズを想定し、SalesNoteというモデル名を使うことにする。</p>

<h2>
<span id="モデル生成" class="fragment"></span><a href="#%E3%83%A2%E3%83%87%E3%83%AB%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>モデル生成</h2>

<p>どのモデルにでも紐付けられるようにPolymorphic Associationで作る。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">bash</span></div>
<div class="highlight"><pre><span></span>rails g model SalesNote target_id:integer target_type:string content:text
</pre></div>
</div>

<p>して、生成したMigrationファイルにインデックスを張る命令だけ付け加える。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">add_index</span> <span class="ss">:sales_notes</span><span class="p">,</span> <span class="o">[</span><span class="ss">:target_id</span><span class="p">,</span> <span class="ss">:target_type</span><span class="o">]</span>
</pre></div></div>

<p>結果、以下のMigrationファイルが出来上がる。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">db/migrate/201301234543_create_sales_notes.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CreateSalesNotes</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:sales_notes</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:target_id</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:target_type</span>
      <span class="n">t</span><span class="o">.</span><span class="n">text</span> <span class="ss">:content</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
    <span class="k">end</span>
    <span class="n">add_index</span> <span class="ss">:sales_notes</span><span class="p">,</span> <span class="o">[</span><span class="ss">:target_id</span><span class="p">,</span> <span class="ss">:target_type</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="モデル" class="fragment"></span><a href="#%E3%83%A2%E3%83%87%E3%83%AB"><i class="fa fa-link"></i></a>モデル</h2>

<p>モデルは自動で生成されるはずだが、ここではvalidationだけ軽くつけておくことにする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>class SalesNote &lt; ActiveRecord::Base
  belongs_to :target, polymorphic: true, inverse_of: :notes
  attr_accessible :content
  validates_presence_of :target_id, :target_type
end
</pre></div></div>

<h2>
<span id="noteをつける側のモデル" class="fragment"></span><a href="#note%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B%E5%81%B4%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB"><i class="fa fa-link"></i></a>Noteをつける側のモデル</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/concerns/sales_note_takable_concern.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">module</span> <span class="nn">SalesNoteTakableConcern</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
  <span class="n">included</span> <span class="k">do</span>
    <span class="n">has_one</span> <span class="ss">:sales_note</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:target</span><span class="p">,</span> <span class="ss">inverse_of</span><span class="p">:</span> <span class="ss">:target</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>を作って、</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/user.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">SalesNoteTakableConcern</span>
<span class="k">end</span>
</pre></div>
</div>

<p>というように使う。</p>

<h2>
<span id="ルート" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>ルート</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">config/routes.rb</span></div>
<div class="highlight"><pre><span></span><span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:sales_notes</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:create</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="コントローラー" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%83%BC"><i class="fa fa-link"></i></a>コントローラー</h2>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/cntrollers/admin/sales_notes_controller.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Admin</span><span class="o">::</span><span class="no">SalesNotesController</span> <span class="o">&lt;</span> <span class="no">Admin</span><span class="o">::</span><span class="no">BaseController</span>
  <span class="n">before_filter</span> <span class="ss">:find_note</span>  <span class="c1"># before_action</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">create_or_update</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="n">create_or_update</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="k">def</span> <span class="nf">find_note</span>
    <span class="vi">@sales_note</span> <span class="o">=</span> <span class="no">SalesNote</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">target_id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:sales_note</span><span class="o">][</span><span class="ss">:target_id</span><span class="o">]</span><span class="p">,</span> <span class="ss">target_type</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:sales_note</span><span class="o">][</span><span class="ss">:target_type</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">first_or_initialize</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create_or_update</span>
    <span class="n">params</span><span class="o">[</span><span class="ss">:sales_note</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="ss">:target_id</span><span class="p">)</span>
    <span class="n">params</span><span class="o">[</span><span class="ss">:sales_note</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="ss">:target_type</span><span class="p">)</span>
    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="k">if</span> <span class="vi">@sales_note</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:sales_note</span><span class="o">]</span><span class="p">)</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="ss">:back</span><span class="p">,</span> <span class="ss">notice</span><span class="p">:</span> <span class="s2">"ノートが更新されました"</span> <span class="p">}</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">js</span> <span class="p">{</span> <span class="n">head</span> <span class="ss">:ok</span> <span class="p">}</span>
      <span class="k">else</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="ss">:back</span><span class="p">,</span> <span class="ss">alert</span><span class="p">:</span> <span class="s2">"ノートの更新に失敗しました"</span> <span class="p">}</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">js</span> <span class="p">{</span> <span class="n">head</span> <span class="ss">:not_acceptable</span> <span class="p">}</span>  <span class="c1"># 406</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<h2>
<span id="ビュー" class="fragment"></span><a href="#%E3%83%93%E3%83%A5%E3%83%BC"><i class="fa fa-link"></i></a>ビュー</h2>

<p>一般ユーザーには見えないようにAdmin用のViewで行う。<br>
<code>Admin::BaseController</code>にUserがAdminかの判定がある想定。</p>

<div class="code-frame" data-lang="haml">
<div class="code-lang"><span class="bold">app/views/admin/base/_sales_note_form.html.haml</span></div>
<div class="highlight"><pre><span></span><span class="nc">.sales_memo</span>
  <span class="nt">%h3</span> メモ
  <span class="p">-</span> <span class="n">sales_note</span> <span class="o">=</span> <span class="n">target_model</span><span class="o">.</span><span class="n">sales_note</span> <span class="o">||</span> <span class="n">target_model</span><span class="o">.</span><span class="n">build_sales_note</span>
  <span class="p">=</span> <span class="n">form_for</span> <span class="o">[</span><span class="ss">:admin</span><span class="p">,</span> <span class="n">sales_note</span><span class="o">]</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">html</span><span class="p">:</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">"sales_note_form"</span> <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
    <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">hidden_field</span> <span class="ss">:target_id</span>
    <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">hidden_field</span> <span class="ss">:target_type</span>
    <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_area</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">style</span><span class="p">:</span> <span class="s2">"height: 60px; width: 290px;"</span>
    <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s1">'save'</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'sales_note_save'</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="s2">"btn blue"</span><span class="p">,</span> <span class="ss">style</span><span class="p">:</span> <span class="s2">"width: 100px; height: 30px; padding: 0"</span><span class="p">,</span> <span class="ss">disabled</span><span class="p">:</span> <span class="ss">:disabled</span>
    <span class="nt">%span</span><span class="nf">#sales_note_save_notification</span><span class="p">{</span> <span class="ss">style</span><span class="p">:</span> <span class="s2">"margin: 0 10px; font-size: 20px; display: hidden; color: red;"</span><span class="p">}</span> saved!

<span class="nd">:javascript</span>
  <span class="nd">var memoContent = $('#sales_note_content').val();</span>
  <span class="nd">$('#sales_note_content').on('input propertychange', function() {</span>
    <span class="nd">if ($(this).val() == memoContent) $('#sales_note_save').attr('disabled', 'disabled');</span>
    <span class="nd">else $('#sales_note_save').attr('disabled', null);</span>
  <span class="nd">});</span>
  <span class="nd">$('#sales_note_form').on('ajax:success', function(event, data, status, xhr) {</span>
    <span class="nd">memoContent = $('#sales_note_content').val();</span>
    <span class="nd">$('#sales_note_save').attr('disabled', 'disabled');</span>
    <span class="nd">$('#sales_note_save_notification').show('slow').delay(1000).hide('fast');</span>
  <span class="nd">});</span>

  <span class="nd">$(function(){</span>
    <span class="nd">$('#sales_note_content').autosize();</span>
  <span class="nd">});</span>
</pre></div>
</div>

<p>とPartialViewを作っておいて、</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/admin/user/show.html.haml</span></div>
<div class="highlight"><pre><span></span><span class="o">=</span> <span class="n">render</span> <span class="s1">'sales_note_form'</span><span class="p">,</span> <span class="ss">target_model</span><span class="p">:</span> <span class="vi">@user</span>
</pre></div>
</div>

<p>や</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/views/user/show.html.haml</span></div>
<div class="highlight"><pre><span></span><span class="o">=</span> <span class="n">render</span> <span class="s1">'admin/base/sales_note_form'</span><span class="p">,</span> <span class="ss">target_model</span><span class="p">:</span> <span class="vi">@user</span> <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">admin?</span>
</pre></div>
</div>

<p>の用に使う。</p>

<p>Javascriptの部分は、メモが編集されている時のみ、ボタンがEnableされて保存することができるようにしているコードが大半。ココらへんは最悪必要ないし、適当でいいと思う。<br>
テキストは適宜大きくなるように、jqueryのautosizeをつけている。(<a href="http://www.jacklmoore.com/autosize/" class="autolink" rel="nofollow noopener" target="_blank">http://www.jacklmoore.com/autosize/</a>)<br>
autosizeはもともと有名だったAutoResizeがメンテされなくなって使われるようになった。AutoResizeよりちょっと英語が変だけど気にしない。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />66位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/a7f2439173b7805ae427">LinkedInで自分のプロフィールURLを設定する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-04 17:03:15</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>自分のLinkedInのプロフィールURLを<code>www.linkedin.com/pub/…</code>じゃなくて<code>www.linkedin.com/in/…</code>にする方法。</p>

<p>Qiitaでプロフィール入力のlinkedinのアドレスを入れる部分に、<code>https://www.linkedin.com/in/</code>まで入力されていて困ったので、変える方法をメモ。</p>

<p>自分の場合は、もともと</p>

<ul>
<li><a href="https://www.linkedin.com/pub/naoyoshi-aikawa/38/1ba/313" class="autolink" rel="nofollow noopener" target="_blank">https://www.linkedin.com/pub/naoyoshi-aikawa/38/1ba/313</a></li>
</ul>

<p>だったけれど、設定後は</p>

<ul>
<li><a href="https://www.linkedin.com/in/awakia" class="autolink" rel="nofollow noopener" target="_blank">https://www.linkedin.com/in/awakia</a></li>
</ul>

<p>になっていて、上のURLは、下のURLにリダイレクトされるように変更された。</p>

<h2>
<span id="方法" class="fragment"></span><a href="#%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>方法</h2>

<p><a href="https://ja.help.linkedin.com/app/answers/detail/a_id/6472" rel="nofollow noopener" target="_blank">公開プロフィールの URL をカスタマイズする | LinkedIn ヘルプセンター</a>の指示通りにやればよい。</p>

<p>英語で使ってる人はこっち。<a href="https://help.linkedin.com/app/answers/detail/a_id/87" rel="nofollow noopener" target="_blank">Customizing Your Public Profile URL | LinkedIn Help Center</a></p>

<p>ただ、LinkedInはよくわからないタイミングでページ遷移してしまって困ったけれど、何回かチャレンジしたら変更できた。</p>

<p>使えるのは英数字のみなようで、<code>-</code>,<code>_</code>も含めて記号は一切使えなかった。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />67位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/e113fb26319d9c1957e0">RailsのHashを新スタイルに置き換えるシェルスクリプト</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-20 18:08:49</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> <b>[sh]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>つまり<code>:hash =&gt;</code>を<code>hash:</code>にする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sed -i '' -E 's/:([^: ]*) *=&gt;/\1:/g' hoge.rb
</pre></div></div>

<ul>
<li>
<code>-i</code>はファイルを直接置き換えるという意味で、引数の<code>''</code>はバックアップを作らないことを意味する。</li>
<li>
<code>-E</code>はよりModernな正規表現を使うという意味。通常のshの正規表現はかなり貧弱。この指定をしても<code>*?</code>といったlazyマッチングができないから困るけれど。</li>
</ul>

<h2>
<span id="応用" class="fragment"></span><a href="#%E5%BF%9C%E7%94%A8"><i class="fa fa-link"></i></a>応用</h2>

<p>一気に置き換えたい時は、これを使って、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sed -i '' -E 's/:([^: ]*) *=&gt;/\1:/g' `find . -name \*.rb`
</pre></div></div>

<p>とか、xargs好きな方は</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>find . \*.rb | xargs sed -i '' -E 's/:([^: ]*) *=&gt;/\1:/g'
</pre></div></div>

<p>とかやるといいのではないでしょうか。</p>

<p>確認は、もちろん<code>git diff</code>で。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>awakiaさんの<br />68位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/awakia/items/9c7ec0aea45e16ce4c76">ParseResourceでモデル名と異なるテーブル名をつける</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-18 15:47:37</center>
	</td>
	<td style="width:200px;">
		@awakia<br />(Wantedly, Inc. 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/6664/profile-images/1473683079">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Rails]</b> <b>[iOS]</b> <b>[Parse]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>ActiveRecord</code>であれば<code>table_name=</code>を使うことで、モデル名の複数形とは違うテーブル名を使用することができるが、それを<code>ParseResource</code>でやる方法。<br>
ちなみに、Parse.comではこれは本当はテーブルじゃなくてクラスと呼ばれている。</p>

<p>parse_resourceのソースコードを読むと<code>model_name_url</code>というのがテーブル名を決定していることが分かるので、これを変えてあげれば良い。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">lib/parse_resource/base.rb</span></div>
<div class="highlight"><pre><span></span><span class="c1"># Gets the current class's model name for the URI</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">model_name_uri</span>
  <span class="k">if</span> <span class="nb">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">==</span> <span class="s2">"User"</span>
    <span class="s2">"users"</span>
  <span class="k">elsif</span> <span class="nb">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">==</span> <span class="s2">"Installation"</span>
    <span class="s2">"installations"</span>
  <span class="k">else</span>
    <span class="s2">"classes/</span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Gets the current class's Parse.com base_uri</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">model_base_uri</span>
  <span class="s2">"https://api.parse.com/1/</span><span class="si">#{</span><span class="n">model_name_uri</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div>
</div>

<p>実際には以下のようにする。</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/mdels/product_parse.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ProductParse</span> <span class="o">&lt;</span> <span class="no">ParseResource</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">model_name_uri</span>
    <span class="s2">"classes/Product"</span>
    <span class="c1"># or "classes/products"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>

<p>こうすることで、</p>

<div class="code-frame" data-lang="ruby">
<div class="code-lang"><span class="bold">app/models/product.rb</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</pre></div>
</div>

<p>というようにProductモデルが既に存在していてもParse用のProductモデルを作ることが出来る。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
