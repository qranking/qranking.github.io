<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (akameco)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (akameco さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />1位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>165</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/519f7e4d5442b2a9d2da">idやclassを使ってテストを書くのは、もはやアンチパターンである</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-19 03:46:34</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[test]</b> <b>[e2e]</b> <b>[jest]</b> <b>[React]</b> <b>[enzyme]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><strong>いきなり結論を書くと、<code>id</code>や<code>class</code>はスタイルのためのものなので、テストでそれを使うのはやめましょう。そして、カスタムデータ属性を使いましょう。</strong>(<code>id</code>や<code>class</code>はスタイルのためだけではないという意見はごもっともです！しかし、主にとしてスタイルに使われるということでご了承頂いて以下の駄文に付き合って頂けると幸いです🙇)</p>

<p>先に断っておくと主にreactについての話で、JSXを前提とします。(手法はReactに限りませんが理由は後述)</p>

<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>ご存知の通り、ロジックとスタイルは別物です。<br>
もしスタイルの変更のためにclass名を変えて、ロジックのテストが落ちるなんてことはあってはならないのです。</p>

<blockquote>
<p>cssに手を入れたいのだけど、このクラス名は変えていいのか？取り除いていいのか？あれ？スタイルの変更のためにクラス名を変更したらテストが落ちた。テストで取得するクラス名を変えなくては！</p>
</blockquote>

<p>全く、これは最悪な状況です。同じクラス名をスタイルでもテストでも使ってしまっているパターンです。ロジックとスタイルが完全に密結合になっています。あまりに、あまりに、脆い。脆弱なテストであります。</p>

<p>さて、問題を共有したところで、実例を踏まえて、これを解決する方法を検討していきましょう。</p>

<h2>
<span id="修正困難なクラス名" class="fragment"></span><a href="#%E4%BF%AE%E6%AD%A3%E5%9B%B0%E9%9B%A3%E3%81%AA%E3%82%AF%E3%83%A9%E3%82%B9%E5%90%8D"><i class="fa fa-link"></i></a>修正困難なクラス名</h2>

<p>以下のようなフォームがあるとしましょう(なお、ニュアンスだけ伝わればいいので、以下のコードそのままでは動作しません)</p>

<p><a href="https://camo.qiitausercontent.com/8ad5508e977f754ffe3808046ad933f78f848903/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f61613833653336372d303166622d343134392d333336632d3238366266323534663664642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8ad5508e977f754ffe3808046ad933f78f848903/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f61613833653336372d303166622d343134392d333336632d3238366266323534663664642e706e67" alt="スクリーンショット 2017-11-19 02.20.07.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/aa83e367-01fb-4149-336c-286bf254f6dd.png"></a></p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"field"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"control"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"input email-field"</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">"Email"</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"field"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"control"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">input</span>
          <span class="nx">type</span><span class="o">=</span><span class="s2">"password"</span>
          <span class="nx">className</span><span class="o">=</span><span class="s2">"input password-field"</span>
          <span class="nx">placeholder</span><span class="o">=</span><span class="s2">"Password"</span>
        <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>

    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"field is-grouped"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"control"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"button is-primary"</span><span class="o">&gt;</span>
          <span class="nx">Sign</span> <span class="k">in</span>
        <span class="o">&lt;</span><span class="err">/button&gt;</span>
      <span class="o">&lt;</span><span class="err">/p&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="p">)</span>
</pre></div></div>

<p>enzymeでテストするには以下のように<code>find</code>を使って要素を特定していきます。ここでは、クラス名を用いて要素を特定します。<br>
この時点では、問題はありません。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">mount</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'enzyme'</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">'Sign in'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">mount</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Login</span> <span class="o">/&gt;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">emailField</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.email-field'</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">passwordField</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.password-field'</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">submit</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.button'</span><span class="p">)</span>

    <span class="c1">// ...</span>
<span class="p">})</span>
</pre></div></div>

<p>さて、ここで、新しく<code>Sign Up</code>ボタンを追加したいとしましょう。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span>      <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"control"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"button is-primary"</span><span class="o">&gt;</span>
          <span class="nx">Sign</span> <span class="nx">Up</span>
        <span class="o">&lt;</span><span class="err">/button&gt;</span>
      <span class="o">&lt;</span><span class="err">/p&gt;</span>

      <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"control"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"button"</span><span class="o">&gt;</span>
          <span class="nx">Sign</span> <span class="k">in</span>
        <span class="o">&lt;</span><span class="err">/button&gt;</span>
      <span class="o">&lt;</span><span class="err">/p&gt;</span>
</pre></div></div>

<p><strong>only meant to be run on a single node. 2 found instead.</strong><br>
<code>.button</code>が2つになりNodeを特定できず、テストが落ちました。</p>

<p>では、以下のように順番に要素を取得しますか？</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span>  <span class="kr">const</span> <span class="nx">signIn</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.button'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">signUp</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.button'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div></div>

<p>まさかです。ちなみにすでにバグがあります。signInとsignUpが逆です。ここで、<strong>テストのために</strong>classNameに<code>sign-btn</code>でも加えますか？ですが、それに対してスタイルが当たってしまったらもうがんじがらめです。cssやクラス名を容易に変更することは出来なくなりました。新しいCSSのアーキテクチャを導入することもスタイルとテストが密結合なので難しく、そして<code>CSS in JS</code>に移行したくとも、スタイルのためのclassNameがどれで、テストのためのclassNameがどれか判断するのは困難です。</p>

<p>この問題は、<strong>ソースコードとテストの関係があまりに暗黙的に過ぎる</strong>のです。<br>
この<strong>関係を明快にする</strong>ことで、問題を解決しましょう。</p>

<h2>
<span id="data-test属性" class="fragment"></span><a href="#data-test%E5%B1%9E%E6%80%A7"><i class="fa fa-link"></i></a>data-test属性</h2>

<p>カスタムデータ属性を使います。<br>
これによって、何をテストすべきかが明確になります。</p>

<div class="code-frame" data-lang="diff"><div class="highlight"><pre><span></span>  &lt;form onSubmit={this.handleSubmit}&gt;
    &lt;div className="field"&gt;
      &lt;div className="control"&gt;
        &lt;input
<span class="gi">+         data-test="email"</span>
          type="text"
          className="input"
          placeholder="Email"
        /&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div className="field"&gt;
      &lt;div className="control"&gt;
        &lt;input
<span class="gi">+         data-test="password"</span>
          type="password"
          className="input"
          placeholder="Password"
        /&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div className="field is-grouped"&gt;
      &lt;p className="control"&gt;
<span class="gi">+        &lt;button type="submit" className="button" data-test="sign-in"&gt;</span>
          Sign in
        &lt;/button&gt;
      &lt;/p&gt;

      &lt;p className="control"&gt;
<span class="gi">+        &lt;button type="submit" className="button is-primary" data-test="sign-up"&gt;</span>
          Sign Up
        &lt;/button&gt;
      &lt;/p&gt;
    &lt;/div&gt;
  &lt;/form&gt;
</pre></div></div>

<p>どうテストを書けばいいのかが非常にスッキリします。<br>
また、<code>sel</code>というユーティリティ関数を用意しましょう。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">sel</span> <span class="o">=</span> <span class="nx">id</span> <span class="o">=&gt;</span> <span class="sb">`[data-test="</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">"]`</span>


<span class="kr">const</span> <span class="nx">emailField</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">sel</span><span class="p">(</span><span class="s1">'email'</span><span class="p">))</span>
<span class="kr">const</span> <span class="nx">passwordField</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">sel</span><span class="p">(</span><span class="s1">'password'</span><span class="p">))</span>
<span class="kr">const</span> <span class="nx">signIn</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">sel</span><span class="p">(</span><span class="s1">'sign-in'</span><span class="p">))</span>
<span class="kr">const</span> <span class="nx">signUp</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">sel</span><span class="p">(</span><span class="s1">'sign-up'</span><span class="p">))</span>
</pre></div></div>

<p>🎉🎉🎉</p>

<p><code>data-test</code>というテストのための属性を使うことで、<strong>何をテストするのか非常に明確</strong>になりました。<br>
そして、テストからクラスを扱わないことで、自由にスタイルのためにクラス名を変更したり、また、いつでも<code>CSS in JS</code>に切り替えられます。</p>

<p>ここではclassで取得して、ここではタグで取得して、ここではidで、ここでは...ここでは...ここでは......うんざりです。全くもってうんざりなのです。人により違う書き方。複数のやり方があるというのは。h2をh3と変えるだけで意味もなく落ちるロジックのテスト。そんなテストは開発の邪魔でしかありません。(また、h2とh3に変えたときに落としたいなら、スナップショットテストを利用すべき状況です。クラス名同様タグに依存すべきではありません)</p>

<p>しかし、それは過去の話です。<strong>テストのためのカスタムデータ属性を使う</strong>ことで、綺麗に分離ができます。(なお、htmlの機能の一つでしかないので、上記のようなコンポーネント単位でもE2Eテストでも有効な手法です)</p>

<h2>
<span id="プロダクションビルドではカスタムデータ属性を取り除く" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%93%E3%83%AB%E3%83%89%E3%81%A7%E3%81%AF%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%87%E3%83%BC%E3%82%BF%E5%B1%9E%E6%80%A7%E3%82%92%E5%8F%96%E3%82%8A%E9%99%A4%E3%81%8F"><i class="fa fa-link"></i></a>プロダクションビルドではカスタムデータ属性を取り除く</h2>

<p>プロダクションに<code>data-test</code>の属性は残す必要はありません。(まあ残しても問題はないですが)<br>
御存知の通り、<strong>JSXはhtmlではなく、JavaScriptのシンタックスの一つに過ぎません。</strong>(<em>要らぬツッコミを避けるために言及するとBabel環境を前提とします。ですので何がJavaScriptだとかの議論は不要でありますので別の場所でやって頂けると嬉しいです</em>)<br>
つまり、ASTの操作でいくらでも消すことが可能です。<br>
具体的には、以下のプラグインをproductionビルドで有効にすれば跡形もなく消えます。</p>

<p><a href="https://github.com/oliviertassinari/babel-plugin-react-remove-properties" rel="nofollow noopener" target="_blank"><strong>babel-plugin-react-remove-properties</strong></a></p>

<div class="code-frame" data-lang="babelrc"><div class="highlight"><pre><span></span>{
  "env": {
    "production": {
      "plugins": ["react-remove-properties"]
    }
  }
}
</pre></div></div>

<p>In:</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Foo</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"bar"</span> <span class="nx">data</span><span class="o">-</span><span class="nx">test</span><span class="o">=</span><span class="s2">"thisIsASelectorForSelenium"</span><span class="o">&gt;</span>
        <span class="nx">Hello</span> <span class="nx">Wold</span><span class="o">!</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>Out:</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Foo</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"bar"</span><span class="o">&gt;</span>
        <span class="nx">Hello</span> <span class="nx">Wold</span><span class="o">!</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="誰が使っているか" class="fragment"></span><a href="#%E8%AA%B0%E3%81%8C%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>誰が使っているか？</h2>

<p>この方法を推奨しているのがpaypalのエンジニアであり、tc39のメンバーでもあるkentcdaddsです。<br>
最も勢いのあるCSSinJSのライブラリの一つである<a href="https://github.com/paypal/glamorous" rel="nofollow noopener" target="_blank">glamorous</a>の作者でもあります。glamorousはstorybookの内部でも使われているので、知らずのうちにあなたのプロジェクトの依存にいるかも知れません。</p>

<p>なぜidを使わないか、listなどの複数要素はどうするか等含め、以下の記事に詳しくまとまっています。</p>

<p><a href="https://blog.kentcdodds.com/making-your-ui-tests-resilient-to-change-d37a6ee37269" rel="nofollow noopener" target="_blank">Making your UI tests resilient to change – kentcdodds</a></p>

<p>ちなみに<code>data-test</code>属性を取り除くプラグインの作者は、material-uiの作者のoliviertassinariです。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p><code>data-test</code>属性を使うことで、reactにおけるテストの見通しを上げる方法を紹介しました。<br>
テストを書くのは当然として、メンテしやすく、よりよいテストを書いていきましょう。</p>

<p>もっといい方法やうちではこう書いてる等、何かあればコメント欄、twitterで是非議論しましょう。<br>
また、Reactのテストのベストプラクティスについて何かよい考えがあれば教えて頂けるとうれしいです。</p>

<blockquote class="twitter-tweet">
<p>mountを使ったらそれはインテグレーションテストという認識。とゆうか、テストのベストプラクティスが知りたい <a href="https://t.co/1iPNE06rkb" rel="nofollow noopener" target="_blank">pic.twitter.com/1iPNE06rkb</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/931860728088104960?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 18, 2017</a>
</blockquote>



<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p><a href="https://blog.kentcdodds.com/making-your-ui-tests-resilient-to-change-d37a6ee37269" rel="nofollow noopener" target="_blank">Making your UI tests resilient to change – kentcdodds</a></p>

<h2>
<span id="ツイッターやはてブのコメントの反映" class="fragment"></span><a href="#%E3%83%84%E3%82%A4%E3%83%83%E3%82%BF%E3%83%BC%E3%82%84%E3%81%AF%E3%81%A6%E3%83%96%E3%81%AE%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AE%E5%8F%8D%E6%98%A0"><i class="fa fa-link"></i></a>ツイッターやはてブのコメントの反映</h2>

<p>ツイッターやはてブの意見を反映してより中身のある記事にしたいので反応を見かけ次第記事に反映していきます。</p>

<h3>
<span id="-こういう動機に至らせてしまうreactがそもそも開発プラットフォームとしては微妙な気がしている" class="fragment"></span><a href="#-%E3%81%93%E3%81%86%E3%81%84%E3%81%86%E5%8B%95%E6%A9%9F%E3%81%AB%E8%87%B3%E3%82%89%E3%81%9B%E3%81%A6%E3%81%97%E3%81%BE%E3%81%86react%E3%81%8C%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82%E9%96%8B%E7%99%BA%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AF%E5%BE%AE%E5%A6%99%E3%81%AA%E6%B0%97%E3%81%8C%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>🤔 こういう動機に至らせてしまうReactがそもそも開発プラットフォームとしては微妙な気がしている</h3>

<p>いいえ。それは誤解です。この問題はReactに限りません。どのようなフロントエンド環境でも同じ問題は起こります。むしろ、JSXによる属性の削除が簡単な分、利点と言えるでしょう。</p>

<h3>
<span id="-idやclassはスタイルのためだけではない" class="fragment"></span><a href="#-id%E3%82%84class%E3%81%AF%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%81%AE%E3%81%9F%E3%82%81%E3%81%A0%E3%81%91%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>🤔 idやclassはスタイルのためだけではない</h3>

<blockquote class="twitter-tweet">
<p>HTMLのidもclassもある文書の中で固有の物、既存の要素とは別の分類でmarkupをしたい時に使うものでCSSでもそれらがセレクタに使用できるというだけである。文書全体の趣旨には全く文句はないが、idやclassはスタイルのためだけの物ではない</p>— KIMATA RobertHisasi (@robert_KIMATA) <a href="https://twitter.com/robert_KIMATA/status/932175540403843072?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">2017年11月19日</a>
</blockquote>



<p>全く仰るとおりです。ですが、そこまで言及すると、無駄に説明が伸びてしまうので、この引用をもって、代わりとさせてください。</p>

<h3>
<span id="-うちはjs用のclass名の命名規則があるのでデザインを変えてもそのclass名は変わらない" class="fragment"></span><a href="#-%E3%81%86%E3%81%A1%E3%81%AFjs%E7%94%A8%E3%81%AEclass%E5%90%8D%E3%81%AE%E5%91%BD%E5%90%8D%E8%A6%8F%E5%89%87%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AE%E3%81%A7%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%92%E5%A4%89%E3%81%88%E3%81%A6%E3%82%82%E3%81%9D%E3%81%AEclass%E5%90%8D%E3%81%AF%E5%A4%89%E3%82%8F%E3%82%89%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>🤔 うちはjs用のclass名の命名規則があるので、デザインを変えてもそのclass名は変わらない</h3>

<p>チームで共通のルールがあれば、それでよいと思います。<s>ただ、もしご覧になっていたらコメントして頂きたいのですが、プロダクションではそのクラス名は残していますか？</s></p>

<p>取り除くためのプラグインを作りました🎉</p>

<p><a href="https://qiita.com/akameco/items/c540693df312a4274791" id="reference-ee3231d5a8498ad3f2ab"><strong>テストのためのクラス名をプロダクションビルドで除去する</strong></a></p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"test-a hello test-b"</span><span class="o">&gt;</span><span class="nx">hello</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>

      <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span>

<span class="kr">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"hello"</span><span class="o">&gt;</span><span class="nx">hello</span><span class="o">&lt;</span><span class="err">/div&gt;;</span>
<span class="p">)</span>
</pre></div></div>

<h3>
<span id="-テスト書いてない" class="fragment"></span><a href="#-%E3%83%86%E3%82%B9%E3%83%88%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>😇 テスト書いてない</h3>

<p><a href="https://camo.qiitausercontent.com/6bdb9c4f5b13c0243ba67aba901bad7cb0362dd2/68747470733a2f2f636f6e6e706173732d746f6b796f2e73332e616d617a6f6e6177732e636f6d2f6576656e742f32373534302f34316438346366306536343934653265393165353161643865396338353331302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6bdb9c4f5b13c0243ba67aba901bad7cb0362dd2/68747470733a2f2f636f6e6e706173732d746f6b796f2e73332e616d617a6f6e6177732e636f6d2f6576656e742f32373534302f34316438346366306536343934653265393165353161643865396338353331302e706e67"></a></p>

<h2>
<span id="α-デモ" class="fragment"></span><a href="#%CE%B1-%E3%83%87%E3%83%A2"><i class="fa fa-link"></i></a>+α デモ</h2>

<p>ちょっとコードが少なすぎた感じがあるので、入力後、エンターが押されたら画面に反映するデモのテストを簡単に用意しました。テスト対象に、<code>data-test</code>を書くのでDOMの構造が変わってもテストは変わりません。ええ、<code>h2</code>を<code>h3</code>にしても、<code>&lt;Title/&gt;</code>というコンポーネントに切り出しても、他の<code>div</code>でラップしても<code>CSSinJS</code>にしても変わることはないのです。また、<code>changeInputValue</code>などのいくつかのユーティリティをいくつか用意してあげるとわかりやすくてよいです。</p>

<p><a href="https://gyazo.com/32196226db3a69d9aff0921b3105cc69" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/a3d2cc6032b6126c04388fb2df01e2afbffe5a6f/68747470733a2f2f692e6779617a6f2e636f6d2f33323139363232366462336136396439616666303932316233313035636336392e676966" alt="https://gyazo.com/32196226db3a69d9aff0921b3105cc69" data-canonical-src="https://i.gyazo.com/32196226db3a69d9aff0921b3105cc69.gif"></a></p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span>      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h2</span> <span class="nx">data</span><span class="o">-</span><span class="nx">test</span><span class="o">=</span><span class="s2">"title"</span><span class="o">&gt;</span><span class="nx">Welcome</span> <span class="nx">to</span> <span class="p">{</span><span class="nx">title</span><span class="p">}.</span><span class="nx">js</span><span class="o">!&lt;</span><span class="err">/h2&gt;</span>
        <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleSubmit</span><span class="p">)}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">fieldset</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">input</span>
              <span class="nx">data</span><span class="o">-</span><span class="nx">test</span><span class="o">=</span><span class="s2">"name"</span>
              <span class="nx">placeholder</span><span class="o">=</span><span class="s2">"name"</span>
              <span class="nx">type</span><span class="o">=</span><span class="s2">"text"</span>
              <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">name</span><span class="p">}</span>
              <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>
              <span class="nx">onKeyUp</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">watchForEnter</span><span class="p">}</span>
            <span class="o">/&gt;</span>
          <span class="o">&lt;</span><span class="err">/fieldset&gt;</span>
        <span class="o">&lt;</span><span class="err">/form&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">mount</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'enzyme'</span>
<span class="kr">import</span> <span class="nx">Component</span> <span class="nx">from</span> <span class="s1">'.'</span>

<span class="kd">function</span> <span class="nx">sel</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sb">`[data-test="</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">"]`</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">changeInputValue</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">input</span><span class="p">.</span><span class="nx">simulate</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">target</span><span class="o">:</span> <span class="p">{</span> <span class="nx">value</span> <span class="p">}</span> <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">keyUpInput</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">input</span><span class="p">.</span><span class="nx">simulate</span><span class="p">(</span><span class="s1">'keyup'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">key</span> <span class="p">})</span>
<span class="p">}</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">'エンターが押されたとき、nameフィールドに入力された文字列をタイトルに設定する'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">mount</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Component</span> <span class="o">/&gt;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">nameField</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">sel</span><span class="p">(</span><span class="s1">'name'</span><span class="p">))</span>
  <span class="nx">changeInputValue</span><span class="p">(</span><span class="nx">nameField</span><span class="p">,</span> <span class="s1">'無職'</span><span class="p">)</span>
  <span class="nx">keyUpInput</span><span class="p">(</span><span class="nx">nameField</span><span class="p">,</span> <span class="s1">'Enter'</span><span class="p">)</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">sel</span><span class="p">(</span><span class="s1">'title'</span><span class="p">)).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">'Welcome to 無職.js!'</span><span class="p">)</span>
<span class="p">})</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />2位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>152</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4">さよならボイラープレート。s2sによる高速reduxアプリケーション構築</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-24 03:47:07</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[flow]</b> <b>[React]</b> <b>[S2S]</b> <b>[redux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="まだアクションクリエイターを自分で書いているの" class="fragment"></span><a href="#%E3%81%BE%E3%81%A0%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%AF%E3%83%AA%E3%82%A8%E3%82%A4%E3%82%BF%E3%83%BC%E3%82%92%E8%87%AA%E5%88%86%E3%81%A7%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE"><i class="fa fa-link"></i></a>まだアクションクリエイターを自分で書いているの？</h2>

<p>reduxとflowtypeを使ってフロントエンドアプリケーションを構築していると、ボイラープレートが多く、面倒だと感じることがありませんか？<br>
しかし、もはや、このAST時代の前には過去の悩みでしかありません。</p>

<p><a href="https://camo.qiitausercontent.com/17aaa035f67e5077867c92c64ea32eee53c42338/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f616b616d65636f2f7332732d6578616d706c65732f6d61737465722f6d656469612f64656d6f2e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/17aaa035f67e5077867c92c64ea32eee53c42338/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f616b616d65636f2f7332732d6578616d706c65732f6d61737465722f6d656469612f64656d6f2e676966" alt="demo.gif (1072×586)" data-canonical-src="https://raw.githubusercontent.com/akameco/s2s-examples/master/media/demo.gif"></a></p>

<p>型を書く。それが全てです。<br>
型を書いて、定数を書いて、アクションクリエイターを書いて、一つ変更したら全て変更して、もしくはなんらかのハックを行って型付けして、なんてものは過去のことです。<br>
これからは、アクションクリエイターの作成に5秒以上時間をかけたら<strong>怠惰</strong>でありましょう。そして、これはs2sの1プラグインでしかありません。</p>

<p>プラグインを組み合わせると以下のようなこともできます。</p>

<p><a href="https://camo.qiitausercontent.com/2b3fc744eda2c6e569f437d8006c765c78bc9f20/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f37306239386664642d373338622d646464322d663866352d3932343435353763643734322e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2b3fc744eda2c6e569f437d8006c765c78bc9f20/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f37306239386664642d373338622d646464322d663866352d3932343435353763643734322e676966" alt="last.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/70b98fdd-738b-ddd2-f8f5-9244557cd742.gif"></a></p>

<h2>
<span id="s2s-source-to-source" class="fragment"></span><a href="#s2s-source-to-source"><i class="fa fa-link"></i></a>s2s (Source to Source)</h2>

<p>これを実現している仕組みを<strong>Source to Source</strong>(<strong>s2s</strong>)といいます。</p>

<p><strong>ソースコード</strong>から<strong>ソースコード</strong>への<strong>コーディングタイムコンパイル</strong>です。</p>

<p><a href="https://camo.qiitausercontent.com/ef173c95462bdb477f42a2f6513f67067ad79c92/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f36316162613065322d316161612d343365662d626531312d6566326334613631303561392e706e67" target="_blank" rel="nofollow noopener"><img width="712" alt="スクリーンショット 2017-09-23 23.48.04.png" src="https://camo.qiitausercontent.com/ef173c95462bdb477f42a2f6513f67067ad79c92/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f36316162613065322d316161612d343365662d626531312d6566326334613631303561392e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/61aba0e2-1aaa-43ef-be11-ef2c4a6105a9.png"></a></p>

<p>仕組み自体は非常に単純です。プロジェクトをs2sが監視し、条件にマッチしたファイルを引数にBabelを実行します。<br>
Babelに代表されるトランスパイラとs2sの違いは、言葉の通り<strong>出力がソースコードへ返ってくる</strong>点しか違いません。</p>

<p>s2sは概念でありますから、先程のreduxの例のみならず、人が記述可能なものは全て自動で記述できます。例えば、コーディング時にASTに従ってテストコードを自動生成してもいいですし、flowの型定義を書きながらGraphQLのクエリを生成し続けるのもいいでしょう。何より、ボイラープレートだと思われるものは例外なく自動生成可能でしょう。ボイラープレートが忌み嫌われる時代は終わりました。自動生成されるボイラープレートこそが開発に速度とコードの明快さをもたらす福音足り得るでしょう。</p>

<p>また、s2sはエディタにロックインされません。AtomでもVSCodeでも好きなエディタを使うことが出来ます。ただ、実行するだけです。</p>

<h2>
<span id="s2sの構成とconfigについて" class="fragment"></span><a href="#s2s%E3%81%AE%E6%A7%8B%E6%88%90%E3%81%A8config%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>s2sの構成とConfigについて</h2>

<p>s2sの実装はGitHubにあります。実は6ヶ月前からスクリプトとしてずっと使っていたんですが、無職ゆえ自分と知人以外使われてきませんでした。</p>

<p><a href="https://github.com/akameco/s2s" rel="nofollow noopener" target="_blank"><strong>akameco/s2s</strong><br>Source to Source</a></p>

<p>さて、ライブラリとしてのs2sの機能は大きく2つあります。<br>
1つはもう何度も登場しているs2sそのもの。<br>
もう1つは<strong>テンプレート展開</strong>です。<br>
ところでみなさん、Scaffoldやスニペットは好きですか？<br>
ええ、もちろん大嫌いです。アタマが悪いので覚えれないんですよねコマンド。<br>
テンプレート展開は、ファイルを生成する際にテンプレートで上書きします。特に手間がかからないわりに言葉以上に有効です。</p>

<p><a href="https://gyazo.com/91e13497dfe9692a37d397d6db413826" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/3d63107a63427d8553ea0930bec7d7fdc3234404/68747470733a2f2f692e6779617a6f2e636f6d2f39316531333439376466653936393261333764333937643664623431333832362e676966" alt="https://gyazo.com/91e13497dfe9692a37d397d6db413826" data-canonical-src="https://i.gyazo.com/91e13497dfe9692a37d397d6db413826.gif"></a></p>

<p>上記の例では、reducer.jsが生成された瞬間にテンプレートで上書きしています。また、reducer.jsが生成されたことによりs2sもトリガーし、<strong>type/state.js</strong>以下に<strong>State</strong>の型を追加し、ルートの<strong>reducer.js</strong>の<strong>combineReducers</strong>に追記します。これでStateの型とreducerがずれるなんてことはありませんね。もちろん、ファイルを削除すれば消えるので、そもそもルートのreducerやstateなどの型定義は開く必要も、意識する必要もないです。</p>

<p>機能の説明はこれで終わりです。</p>

<p>次に、設定ファイルの説明に入ります。<br>
s2sはルートに配置された<strong>s2s.config.js</strong>を設定ファイルとして扱います。webpack.config.jsのようなものだと思ってください。<br>
しかし設定する項目は非常に少ないです。</p>

<div class="code-frame" data-lang="js">
<div class="code-lang"><span class="bold">s2s.config.js</span></div>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">rootDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s1">'src'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">rootReducerPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">rootDir</span><span class="p">,</span> <span class="s1">'reducer.js'</span><span class="p">)</span>


<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">watch</span><span class="o">:</span> <span class="s1">'./**/*.js'</span><span class="p">,</span>
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">test</span><span class="o">:</span> <span class="sr">/actionTypes.js$/</span><span class="p">,</span>
      <span class="nx">plugin</span><span class="o">:</span> <span class="p">[</span><span class="s1">'s2s-action-types'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">removePrefix</span><span class="o">:</span> <span class="s1">'src/containers'</span> <span class="p">}],</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">test</span><span class="o">:</span> <span class="sr">/actionTypes.js$/</span><span class="p">,</span>
      <span class="nx">output</span><span class="o">:</span> <span class="s1">'actions.js'</span><span class="p">,</span>
      <span class="nx">plugin</span><span class="o">:</span> <span class="p">[</span><span class="s1">'s2s-action-creater'</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nx">test</span><span class="o">:</span> <span class="sr">/reducer.js/</span><span class="p">,</span>
      <span class="nx">input</span><span class="o">:</span> <span class="nx">rootReducerPath</span><span class="p">,</span>
      <span class="nx">output</span><span class="o">:</span> <span class="nx">rootReducerPath</span><span class="p">,</span>
      <span class="nx">plugin</span><span class="o">:</span> <span class="p">[</span>
        <span class="s1">'s2s-reducer-root'</span><span class="p">,</span>
        <span class="p">{</span> <span class="nx">input</span><span class="o">:</span> <span class="s1">'src/containers/**/reducer.js'</span><span class="p">,</span> <span class="nx">output</span><span class="o">:</span> <span class="nx">rootReducerPath</span> <span class="p">},</span>
      <span class="p">],</span>
    <span class="p">},</span>
  <span class="p">],</span>
  <span class="nx">templates</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="nx">test</span><span class="o">:</span> <span class="sr">/reducer.js/</span><span class="p">,</span> <span class="nx">input</span><span class="o">:</span> <span class="s1">'reducer.js'</span> <span class="p">},</span>
  <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>

<h4>
<span id="watch" class="fragment"></span><a href="#watch"><i class="fa fa-link"></i></a>watch</h4>

<p>監視するファイルです。globパターンで指定します。</p>

<h4>
<span id="plugins" class="fragment"></span><a href="#plugins"><i class="fa fa-link"></i></a>plugins</h4>

<p>プラグインの配列です。いくつかの引数を取ります。</p>

<ul>
<li><p><strong>test</strong> トリガーとなるファイルを正規表現で指定します。他にオプションがなければそのままこのパスに出力されます。actionの型定義がこのパターンです。</p></li>
<li><p><strong>plugin</strong> バベルのプラグインを指定します。.babelrcの書き方と全く同じです。.babelrcと同様に引数を与えることも可能です。このプラグインにs2s特有の概念はありません。全ての<strong>BabelPlugin</strong>をそのまま使え、新し機能を追加したければ、単にBabelPluginを書けだけです。</p></li>
<li><p><strong>output</strong> トリガーと出力するパスが異なる場合に、このオプションを使います。相対パスを渡した場合、トリガーとなったファイルが起点の相対パスになります。root集約などは絶対パスで指定しています。</p></li>
<li><p><strong>input</strong> トリガーとなるファイルと異なるファイルを対象として変換を実行したい場合に指定します。reducerやStateのルート集約などに利用します。</p></li>
</ul>

<h4>
<span id="templates" class="fragment"></span><a href="#templates"><i class="fa fa-link"></i></a>templates</h4>

<p>テンプレートの配列です。いくつかの引数を取ります。</p>

<ul>
<li>
<strong>test</strong> トリガーなるパターンです。Pluginのオプションと同じです。</li>
<li>
<strong>input</strong> 配置したファイル名を指定します。デフォルトでは、ルートの<strong>templates</strong>以下に配置されたファイルを指定します</li>
</ul>

<h4>
<span id="templatesdir" class="fragment"></span><a href="#templatesdir"><i class="fa fa-link"></i></a>templatesDir</h4>

<p>テンプレートの起点を変更する際に指定します。例えば、<code>config/templates</code>以下にテンプレートを配置したいときなどです。</p>

<p>見たとおり、設定する項目は少ないです。また、単に<strong>Babel Plugin</strong>を使うため一切のロックインはありません。</p>

<p>新しくBabel Pluginを書いてみたい場合、以下の記事が参考になります。</p>

<p><strong>Babel Pluginを作成するときに有効な情報まとめ</strong><br>
<a href="https://qiita.com/akameco/items/af81882fabf2728f2567" class="autolink" id="reference-a7f388d78223260a5819">https://qiita.com/akameco/items/af81882fabf2728f2567</a></p>

<h2>
<span id="サンプルとreduxについて" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%A8redux%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>サンプルとreduxについて</h2>

<p>はじめましょう。<br>
以下のサンプルを<em>git clone</em>してください。</p>

<p><a href="https://github.com/akameco/s2s" rel="nofollow noopener" target="_blank"><strong>akameco/s2s:exmaple</strong></a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone git@github.com:akameco/s2s.git
</pre></div></div>

<p>よくあるショッピングカートのサンプルがあります。create-react-appを使っています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd examples/shopping-cart
$ yarn
$ yarn start
</pre></div></div>

<p>s2sを起動しましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ yarn run s2s
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/0b6a78c5d376b0d0552c2915038b9b319782e249/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f64633161643837362d353763302d613866342d376364352d6465356532303533376634612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0b6a78c5d376b0d0552c2915038b9b319782e249/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f64633161643837362d353763302d613866342d376364352d6465356532303533376634612e706e67" alt="スクリーンショット 2017-09-24 00.30.36.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/dc1ad876-57c0-a8f4-7cd5-de5e20537f4a.png"></a></p>

<p>さて、実際もう説明することはありません。<br>
好きなように変更して<code>s2s</code>の動きを確認してみてください。<br>
例えば、App以下にActionTypes.jsを新規作成し、Addアクションを追加してみてください。</p>

<p><a href="https://gyazo.com/70b365152ef53158f9720298d35db4bb" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/9fb72019a8b19ab139387a4d1aa342dc182818ff/68747470733a2f2f692e6779617a6f2e636f6d2f37306233363531353265663533313538663937323032393864333564623462622e676966" alt="https://gyazo.com/70b365152ef53158f9720298d35db4bb" width="1078" data-canonical-src="https://i.gyazo.com/70b365152ef53158f9720298d35db4bb.gif"></a></p>

<p>コマンドラインには以下のように出力されます。イベントのパスと出力先のパスが表示されます。MacならCmd+クリックで対象のファイルがエディタで開けるので便利かもしれません。</p>

<p><a href="https://camo.qiitausercontent.com/fd5ceb5820e7bd658cd90d66e417f0e97716691e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f62626532353461662d383734322d623366372d363965372d3331393030633833663635362e706e67" target="_blank" rel="nofollow noopener"><img width="742" alt="スクリーンショット 2017-09-24 02.18.06.png" src="https://camo.qiitausercontent.com/fd5ceb5820e7bd658cd90d66e417f0e97716691e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f62626532353461662d383734322d623366372d363965372d3331393030633833663635362e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/bbe254af-8742-b3f7-69e7-31900c83f656.png"></a></p>

<p>さて、この変換を行っているのは、<a href="https://github.com/akameco/s2s/tree/master/packages/babel-plugin-s2s-initial-state-creater" rel="nofollow noopener" target="_blank"><strong>babel-plugin-s2s-action-creater</strong></a>というプラグインです。s2sの責務は、変換の対象とプラグインを接続しイベントをトリガーするだけなので、変換の責務は全てBabelPluginにあります。このプラグインのreadmeを見てましょう。</p>

<p><a href="https://camo.qiitausercontent.com/d84d1f097436937c59bef13aa3ec68ea0a680ec6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f36666438623837352d666537342d326162302d303733372d3234383534366133343432632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d84d1f097436937c59bef13aa3ec68ea0a680ec6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f36666438623837352d666537342d326162302d303733372d3234383534366133343432632e706e67" alt="スクリーンショット 2017-09-24 02.24.43.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/6fd8b875-fe74-2ab0-0737-248546a3442c.png"></a></p>

<p>一つ一つ分解すると単純ですね。<br>
このサンプルでは、6つのバベルプラグインを使っています。s2sはプラグイン含めて、モノレポで運用しているので、よかったら確認してみてください。</p>

<p><a href="https://github.com/akameco/s2s/tree/master/packages" rel="nofollow noopener" target="_blank"><strong>akameco/s2s-plugins</strong></a></p>

<p>また、reducerのテストケースの自動生成も可能です。<br>
詳しくは、以下のリンクを読んでください。</p>

<p><a href="https://qiita.com/akameco/items/66a2232df0e95e5bfe31" id="reference-9ad14c81c2d75fbb0c12"><strong>s2s: reduxにおけるreducerのテスト。あなたがテストを書く必要はないかも知れない</strong></a></p>

<p><a href="https://camo.qiitausercontent.com/7608c257a9f2502f162232498d612029186e94a5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30336234386264642d626137652d643561612d656366382d3032653364366330373037662e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7608c257a9f2502f162232498d612029186e94a5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30336234386264642d626137652d643561612d656366382d3032653364366330373037662e676966" alt="reducer-test.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/03b48bdd-ba7e-d5aa-ecf8-02e3d6c0707f.gif"></a></p>

<h3>
<span id="サンプルのreduxの構成について" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AEredux%E3%81%AE%E6%A7%8B%E6%88%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>サンプルのreduxの構成について</h3>

<p>話はかわりますが、この生成されるflowの型付け方法やreduxの構成は、個人的なベストプラクティスでもあります。基本的な構成はコンテナベースで、action、reducer含め全てをコンテナに閉じ、同一ディレクトリに<strong>reducer.test.js</strong>のような形式でテストを書きます。Actionはディレクトリ名のプレフィックスを付けます。これで完全に一意なアクションになるので、取り違えは起こりえません。またstring型ではなくstring literal型を使います。これについては以下の記事を読んでください。本来であれば書くのが面倒でありますが、s2sがある現在ボイラープレートは味方です。<br>
<strong>flowtypeのactionの型付け。String Literal型とString型について</strong><br>
<a href="https://qiita.com/akameco/items/e7021e22da4c9e14463a" class="autolink" id="reference-ac162e0df63cdef91c0c">https://qiita.com/akameco/items/e7021e22da4c9e14463a</a></p>

<p>テンプレートより生成されるreducerは<strong>T &amp; $Shape</strong>型で型を付けます。詳しくは、以下の記事を確認してください。<br>
<strong>Flowtype+reduxにおけるreducerの正しい型付け</strong><br>
<a href="https://qiita.com/akameco/items/fe7ba22c158a2593b077" class="autolink" id="reference-b718b2e077dd7c7d1bf3">https://qiita.com/akameco/items/fe7ba22c158a2593b077</a></p>

<p>また、reduxのミドルウェアはredux-thunkです。これだけ先に記事を書いておくのを忘れました。なぜredux-sagaを使うことを辞めたのかを含め、後でこの選択をした理由の記事を上げる予定です。</p>

<h2>
<span id="予想される質問とその回答" class="fragment"></span><a href="#%E4%BA%88%E6%83%B3%E3%81%95%E3%82%8C%E3%82%8B%E8%B3%AA%E5%95%8F%E3%81%A8%E3%81%9D%E3%81%AE%E5%9B%9E%E7%AD%94"><i class="fa fa-link"></i></a>予想される質問とその回答</h2>

<h3>
<span id="typescriptのサポートは" class="fragment"></span><a href="#typescript%E3%81%AE%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AF"><i class="fa fa-link"></i></a>TypeScriptのサポートは？</h3>

<hr>

<p>11/8 追記<br>
デフォルトでサポートしました。設定なしで、pluginを指定すればtypescriptに対して動きます。</p>

<p>11/06 追記<br>
Yeｓ. サポートしました 🎉<br>
</p><blockquote class="twitter-tweet">
<p>s2sのTypeScript対応完了した。ts-handlerを渡すとTSに対してs2sが発動する <a href="https://t.co/giXFcYTFrb" rel="nofollow noopener" target="_blank">pic.twitter.com/giXFcYTFrb</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/927225088658698240?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 5, 2017</a>
</blockquote><br>


<p>が、まだプラグインがありません。<br>
もし、TS用のプラグインを作成した方がいれば、教えて頂けると嬉しいです。<br>
それと上記のツイートでは、<code>s2s-ts-handler</code>ですが、<code>s2s-handler-typescript</code>にリネームしました。</p>

<p>追記終わり</p>

<hr>

<p><s>No. Just Use FlowType.</s></p>

<p><a href="http://thejameskyle.com/adopting-flow-and-typescript.html" rel="nofollow noopener" target="_blank">Adopting Flow &amp; TypeScript – @thejameskyle</a></p>

<p><s>冗談はさておき、Babel6だとTypeScriptは解釈されません。TypeScriptユーザは、Babel7のリリースを待つことになります。</s></p>

<h3>
<span id="issueやプルリク" class="fragment"></span><a href="#issue%E3%82%84%E3%83%97%E3%83%AB%E3%83%AA%E3%82%AF"><i class="fa fa-link"></i></a>Issueやプルリク</h3>

<p>日本語だと嬉しいです。英語でもいいですが、Google翻訳アシストの謎い英文を返すマシーンとなります。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>s2sについて、概念や使い方についてまとめました。<br>
s2sがあなたのプロジェクトの力になることがあれば嬉しいです。<br>
もし気にいってくだされば、スターを貰えると励みになります。</p>

<p><a href="https://github.com/akameco/s2s" rel="nofollow noopener" target="_blank"><strong>akameco/s2s</strong><br>Source to Source</a></p>

<p>兎にも角にもASTの時代です。人間のやることや書くことがどんどん減っていけば最高ですね。<br>
何かあれば、コメント欄またはツイッターにて議論しましょう。</p>

<blockquote class="twitter-tweet">
<p>今この一瞬日本で一番高速にflow+reduxのアクションを書ける自信がある</p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/910379500759801856" rel="nofollow noopener" target="_blank">September 20, 2017</a>
</blockquote>



<blockquote class="twitter-tweet">
<p>僕が辿りついた最高のflowtype+reduxです <a href="https://t.co/FISlpW9OpE" rel="nofollow noopener" target="_blank">https://t.co/FISlpW9OpE</a> <a href="https://twitter.com/hashtag/redux?src=hash" rel="nofollow noopener" target="_blank">#redux</a> <a href="https://t.co/YXujSJawsC" rel="nofollow noopener" target="_blank">pic.twitter.com/YXujSJawsC</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/911566655641182208" rel="nofollow noopener" target="_blank">September 23, 2017</a>
</blockquote>

<blockquote class="twitter-tweet">
<p>ほとんど理想のreduxになってきた。もう少し自動生成できる部分があるけど <a href="https://t.co/hedRGsTkIM" rel="nofollow noopener" target="_blank">pic.twitter.com/hedRGsTkIM</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/916479997744889856?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 7, 2017</a>
</blockquote>

<h2>
<span id="お知らせ-html5カンファレンス" class="fragment"></span><a href="#%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B-html5%E3%82%AB%E3%83%B3%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>お知らせ HTML5カンファレンス</h2>

<p>本日9/24にあるHTML5カンファレンスでデモ展示をする予定です。一応、一日中いる予定ですので、気軽に声をかけてくださると嬉しいです。自分のデモの内容は一番上に貼ってあるGIFの無限リピートとこの記事へのリンクを張っておくだけなので面白みはないですが、他のメンバーが何か面白い展示をしてくれるはずですのでよろしくお願いします。</p>

<p>10/2 追記 デモに来てくれたみなさん。本当にありがとうございました。非常に勉強になりました。出来る限りフォローを返したつもりですが、もしフォロー返されてないなどありましたら、一声かけてくれると嬉しいです。</p>

<p><a href="https://github.com/akameco/s2s" rel="nofollow noopener" target="_blank"><br>
<img width="388" alt="スクリーンショット 2017-09-24 00.05.28.png" src="https://camo.qiitausercontent.com/ad8bc9210bbc005c89c548fae28ada89046f6e75/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f35616238613530332d343565392d323530662d633238362d3561646663356365653732632e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/5ab8a503-45e9-250f-c286-5adfc5cee72c.png"><br>
</a></p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p><a href="https://github.com/akameco/s2s" rel="nofollow noopener" target="_blank"><strong>akameco/s2s</strong> - Source to Source</a></p>

<p><strong>flowtypeのactionの型付け。String Literal型とString型について</strong><br>
<a href="https://qiita.com/akameco/items/e7021e22da4c9e14463a" class="autolink">https://qiita.com/akameco/items/e7021e22da4c9e14463a</a></p>

<p><strong>Flowtype+reduxにおけるreducerの正しい型付け</strong><br>
<a href="https://qiita.com/akameco/items/fe7ba22c158a2593b077" class="autolink">https://qiita.com/akameco/items/fe7ba22c158a2593b077</a></p>

<p><strong>s2s: reduxにおけるreducerのテスト。あなたがテストを書く必要はないかも知れない</strong><br>
<a href="https://qiita.com/akameco/items/66a2232df0e95e5bfe31">https://qiita.com/akameco/items/66a2232df0e95e5bfe31</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />3位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>25</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/ccf32dedb3630f774358">コンポーネント時代のi18n</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-01 04:49:51</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[I18n]</b> <b>[React]</b> <b>[babel]</b> <b>[react-intl]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote>
<p>グローバルからコンポーネントベースのid管理へ</p>
</blockquote>

<p><a href="https://camo.qiitausercontent.com/ad4b20c5aac9ff6793d0629bd4cfc4af6e750a66/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f323030302f312a714a4e62567373734671566a4f6659335047416871672e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ad4b20c5aac9ff6793d0629bd4cfc4af6e750a66/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f323030302f312a714a4e62567373734671566a4f6659335047416871672e706e67" data-canonical-src="https://cdn-images-1.medium.com/max/2000/1*qJNbVsssFqVjOfY3PGAhqg.png"></a></p>

<p>サービスを海外展開したい場合、国際化対応を行う必要性があります。これをi18n対応と呼びます。Reactでフロントエンドを構築する場合、i18nのための多くのライブラリがありますが、ダウンロード数的にyahoo製のreact-intl が最も使われているライブラリです。react-intlを実際に使っている例としては、スター15000を超えるReactボイラープレートであるreact-boilerplate やSNSの マストドンがあります。</p>

<p><a href="https://github.com/react-boilerplate/react-boilerplate" rel="nofollow noopener" target="_blank">react-boilerplate/react-boilerplate: A highly scalable, offline-first foundation with the best developer experience and a focus on performance and best practices.</a><br>
<a href="https://github.com/tootsuite/mastodon" rel="nofollow noopener" target="_blank">tootsuite/mastodon: Your self-hosted, globally interconnected microblogging community</a></p>

<p>しかし、実際にreact-intlを使うとidの管理が非常に面倒です。(他すべてのi18nライブラリも同様ですが)。<br>
ここでは、react-boilerplateを参考にidの管理を見てみます。</p>

<p>まず前提としてreact-boilerplateでは、ディレクトリベースでコンポーネントを管理しています。その中で、messages.jsにdefineMessagesを使いidとデフォルトメッセージを定義し、それをindex.jsでimportしてFomattedMessageコンポーネントに渡しています。</p>

<p><a href="https://camo.qiitausercontent.com/09a9312f6c38969a159831566e85e407e7220e9a/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a336976745254784e676b71655a7243553352394253772e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/09a9312f6c38969a159831566e85e407e7220e9a/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a336976745254784e676b71655a7243553352394253772e706e67" data-canonical-src="https://cdn-images-1.medium.com/max/800/1*3ivtRTxNgkqeZrCU3R9BSw.png"></a><br>
<a href="https://camo.qiitausercontent.com/6ba1a93bdd9331dbb5000302bb2651709c8144cd/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a6c6b686b2d79304b6f68703967564f41674851545a772e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6ba1a93bdd9331dbb5000302bb2651709c8144cd/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a6c6b686b2d79304b6f68703967564f41674851545a772e706e67" data-canonical-src="https://cdn-images-1.medium.com/max/800/1*lkhk-y0Kohp9gVOAgHQTZw.png"></a></p>

<p>他の言語の翻訳はフラットなjsonに書き出しています。(例: de.json)</p>

<p><a href="https://camo.qiitausercontent.com/6a8e488d162cae7cf76340f0e04c3e4e1c1e5cce/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a7970414c6642735261374346466f76444c744f4130412e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6a8e488d162cae7cf76340f0e04c3e4e1c1e5cce/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a7970414c6642735261374346466f76444c744f4130412e706e67" alt="" data-canonical-src="https://cdn-images-1.medium.com/max/800/1*ypALfBsRa7CFFovDLtOA0A.png"></a></p>

<p>ここでのポイントは、キーの管理にコンポーネントベースのプレフィックスを用いている点です。これによってidの管理コストを抑えています。しかし、これは非常に面倒であるし、重複やタイポも検知できません😩 実質、グローバル変数と同じでもあるとも言えます。<br>
そこで、<code>babel-plugin-react-intl-auto</code>を使ってこの問題を解決します。</p>

<p><a href="https://github.com/akameco/babel-plugin-react-intl-auto" rel="nofollow noopener" target="_blank"><strong>akameco/babel-plugin-react-intl-auto</strong> <br> i18n for the component age. Auto management react-intl ID.</a></p>

<h2>
<span id="babel-plugin-react-intl-auto" class="fragment"></span><a href="#babel-plugin-react-intl-auto"><i class="fa fa-link"></i></a>babel-plugin-react-intl-auto</h2>

<p>このバベルプラグインは、その名の通りidを自動生成します。</p>

<p><code>app/components/Greeting/messages.js</code>というファイルの場合以下のように変換されます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">defineMessages</span><span class="p">({</span>
  <span class="nx">hello</span><span class="o">:</span> <span class="s1">'hello {name}'</span><span class="p">,</span>
  <span class="nx">welcome</span><span class="o">:</span> <span class="s1">'Welcome!'</span><span class="p">,</span>
<span class="p">})</span>


<span class="c1">// ↓ ↓ ↓</span>


<span class="kr">export</span> <span class="k">default</span> <span class="nx">defineMessages</span><span class="p">({</span>
  <span class="nx">hello</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s1">'app.components.Greeting.hello'</span><span class="p">,</span>
    <span class="nx">defaultMessage</span><span class="o">:</span> <span class="s1">'hello {name}'</span>
  <span class="p">},</span>
  <span class="nx">welcome</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s1">'app.components.Greeting.welcome'</span><span class="p">,</span>
    <span class="nx">defaultMessage</span><span class="o">:</span> <span class="s1">'Welcome!'</span>
  <span class="p">},</span>
<span class="p">})</span>
</pre></div></div>

<p><strong>もはや<code>id</code>と<code>defaultMessage</code>なんて書く必要はありません。純粋に文字列を書くだけ</strong>です。</p>

<p>このプラグインは、<strong>ファイルパスとオブジェクトのキー</strong>を使ってバベル時にidを生成し、また、文字列をdefulatMessageの値へと置き換える変換を行います。これによって、記述がシンプルになります。よって、<strong>手動でidを決めてグローバルで管理なんてする必要はなくなりました。</strong></p>

<p>いくつかの便利なオプションがあります。提案や実装をしてくれた全てのコントリビューターに感謝します。<br>
詳しくはreadmeを読んでください。</p>

<h4>
<span id="例-コメントを説明に変換するオプション-extractcomments" class="fragment"></span><a href="#%E4%BE%8B-%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E8%AA%AC%E6%98%8E%E3%81%AB%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-extractcomments"><i class="fa fa-link"></i></a>例: コメントを説明に変換するオプション <code>extractComments</code>
</h4>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">defineMessages</span><span class="p">({</span>
  <span class="c1">// Message used to greet the user</span>
  <span class="nx">hello</span><span class="o">:</span> <span class="s1">'hello {name}'</span><span class="p">,</span>
<span class="p">})</span>

      <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">defineMessages</span><span class="p">({</span>
  <span class="nx">hello</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s1">'path.to.file.test.hello'</span><span class="p">,</span>
    <span class="nx">defaultMessage</span><span class="o">:</span> <span class="s1">'hello {name}'</span><span class="p">,</span>
    <span class="nx">description</span><span class="o">:</span> <span class="s1">'Message used to greet the user'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">})</span>
</pre></div></div>

<h2>
<span id="抽出-extract-react-intl-messages" class="fragment"></span><a href="#%E6%8A%BD%E5%87%BA-extract-react-intl-messages"><i class="fa fa-link"></i></a>抽出 ~extract-react-intl-messages~</h2>

<blockquote>
<p>「idを生成できるのはわかった。でも、結局jsonに自分でidを書く必要があるでしょう？」</p>
</blockquote>

<p>まさか！まさかです！i18nのキーの管理を手動でやるなんて前時代的すぎます。コードから自動生成しましょう。 <code>extract-react-intl-messages</code> をインストールしてください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ yarn add --dev extract-react-intl-messages
</pre></div></div>

<p><a href="https://github.com/akameco/extract-react-intl-messages" rel="nofollow noopener" target="_blank"><strong>akameco/extract-react-intl-messages</strong> <br> extract react intl messages</a></p>

<p>いくつかのオプションを取ります。詳しくは、readmeを読んで下さい。<br>
もちろん、愚直に上書きなんてせず、すでにファイルがあれば適切にマージしてキーをソートします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ yarn run extract-messages -d en -l=en,ja -o translations 'src/**/*.js'
</pre></div></div>

<p>デフォルトの出力ではフラットなJSONです。オプションによりネストしたJSONやYAMLの出力も可能です。</p>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">en.json</span></div>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"components.App.hello"</span><span class="p">:</span> <span class="s2">"hello {name}"</span><span class="p">,</span>
  <span class="nt">"components.App.welcome"</span><span class="p">:</span> <span class="s2">"Welcome"</span>
<span class="p">}</span>
</pre></div>
</div>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">ja.json</span></div>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"components.App.hello"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
  <span class="nt">"components.App.welcome"</span><span class="p">:</span> <span class="s2">""</span>
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="翻訳ファイルの可読性-json-to-yaml" class="fragment"></span><a href="#%E7%BF%BB%E8%A8%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%8F%AF%E8%AA%AD%E6%80%A7-json-to-yaml"><i class="fa fa-link"></i></a>翻訳ファイルの可読性 (json to yaml)</h2>

<p><a href="https://camo.qiitausercontent.com/35aff2ee1bd86bb5dec5171965c600f14c01d870/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a4146335137644968567243697a4533674337425442672e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/35aff2ee1bd86bb5dec5171965c600f14c01d870/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a4146335137644968567243697a4533674337425442672e706e67" alt="" data-canonical-src="https://cdn-images-1.medium.com/max/800/1*AF3Q7dIhVrCizE3gC7BTBg.png"></a></p>

<p>フラットでキーが長いJSONより、ネストしたJSONのほうが読みやすいことに異論はないでしょう。しかし、react-intlでネストしたJSONを使う場合は、実行時にflatのようなライブラリを使用しする必要があります。ここで、webpackのローダーを使えば、ビルド時にフラットなJSONに変換可能です。<br>
さらに進んで、JSONより可読性の高いYAMLを使うこともできます。YAMLをビルド時にフラットにしたい場合は、yaml-flat-loaderを使うと便利です。<br>
詳しい使い方はREADMEを参照してください。</p>

<div class="code-frame" data-lang="yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hello</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">world</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">webpack</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">hello</span> <span class="nx">from</span> <span class="s1">'./hello.yml'</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hello</span><span class="p">)</span>
<span class="c1">// =&gt; { 'hello.world': 'webpack' }</span>
</pre></div></div>

<p><a href="https://github.com/akameco/yaml-flat-loader" rel="nofollow noopener" target="_blank">akameco/yaml-flat-loader</a></p>

<h2>
<span id="型-flowtype" class="fragment"></span><a href="#%E5%9E%8B-flowtype"><i class="fa fa-link"></i></a>型 (flowtype)</h2>

<p>グローバルなid管理で困ることの一つは、補完が効かないこと。また、タイポを防ぐ仕組みがないことです。これは、Flowtypeの力を借りて解決出来ます。Flowtypeの機能の一つである$ObjMapによって型の補完を試みます。</p>

<p>flow-typedにある型定義を少し変更します。これで引数のオブジェクトのkeyでなければ型レベルでエラーが起きます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">declare</span> <span class="kd">function</span> <span class="nx">defineMessages</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">:</span> <span class="p">{</span> <span class="p">[</span><span class="nx">key</span><span class="o">:</span> <span class="nx">string</span><span class="p">]</span><span class="o">:</span> <span class="nx">MessageDescriptor</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nx">messageDescriptors</span><span class="o">:</span> <span class="nx">T</span><span class="p">,</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">T</span><span class="p">;</span>

<span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span>

<span class="nx">declare</span> <span class="kd">function</span> <span class="nx">defineMessages</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">:</span> <span class="p">{[</span><span class="nx">key</span><span class="o">:</span> <span class="nx">string</span><span class="p">]</span><span class="o">:</span> <span class="nx">string</span><span class="p">}</span><span class="o">&gt;</span><span class="p">(</span>
   <span class="nx">messageDescriptors</span><span class="o">:</span> <span class="nx">T</span>
<span class="p">)</span><span class="o">:</span> <span class="nx">$ObjMap</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">string</span> <span class="o">=&gt;</span> <span class="nx">MessageDescriptor</span><span class="o">&gt;</span>
</pre></div></div>

<p>OK！型は偉大です！さよならタイポ！ようこそ補完！</p>

<p><a href="https://camo.qiitausercontent.com/c9832179ce6779c01936517773c84e3f1e331a5d/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a4e4756465553666970576a727a6b7765755f573264512e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c9832179ce6779c01936517773c84e3f1e331a5d/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a4e4756465553666970576a727a6b7765755f573264512e676966" alt="" data-canonical-src="https://cdn-images-1.medium.com/max/800/1*NGVFUSfipWjrzkweu_W2dQ.gif"></a></p>

<h2>
<span id="i18nのテスト-スナップショットテスト" class="fragment"></span><a href="#i18n%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88-%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>i18nのテスト (スナップショットテスト)</h2>

<p>自動生成によりキーはあるが、翻訳を入れ忘れるということが大いに有り得ます。ええ、マーフィーの法則です。失敗する可能性のあるものは、必ず失敗するものです。<br>
つまるところ、入力忘れなんて人間が意識する必要なんてないのでテストによって検知しましょう。また、変更があればそれもテストしたいですよね。喜ばしいことに我々にはJestのsnapshotテストがあります。基本的にはオブジェクトのスナップショットを行えばいいですね。<br>
ここでもし、YAMLを使っているならJestにそれをJSONと認識させるためにjest-yaml-flat-transfromが必要になります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span> <span class="c1">// @flow</span>
<span class="kr">import</span> <span class="nx">ja</span> <span class="nx">from</span> <span class="s1">'./ja.yml'</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">'snapshot'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">ja</span><span class="p">).</span><span class="nx">toMatchSnapshot</span><span class="p">()</span>
<span class="p">})</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/7ca14ca1e9eab6c6f7161faf070b257c836c8439/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a3756544d4b693675535f4947715946507141737a32672e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7ca14ca1e9eab6c6f7161faf070b257c836c8439/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a3756544d4b693675535f4947715946507141737a32672e706e67" alt="" data-canonical-src="https://cdn-images-1.medium.com/max/800/1*7VTMKi6uS_IGqYFPqAsz2g.png"></a></p>

<p>入力忘れは、オブジェクトのそれぞれの値が<code>""</code>でないかを確認するだけでいい場合が多いでしょう。しかし、ライセンス表記などあえてデフォルトと同じ値にしたい状況が存在します。これは、キーのホワイトリストをスナップショットテストすることで解決しましょう。従来であれば、テストコードに列挙する必要がありました(もしくはテストしない)が、スナップショットテストの登場でそれは過去の話です。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="c1">// @flow</span>
<span class="kr">import</span> <span class="nx">ja</span> <span class="nx">from</span> <span class="s1">'./ja.yml'</span>

<span class="kr">const</span> <span class="nx">getBlanks</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="o">:</span> <span class="nb">Object</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">===</span> <span class="s1">''</span><span class="p">)</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">'check whitelist [ja]'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">blanks</span> <span class="o">=</span> <span class="nx">getBlanks</span><span class="p">(</span><span class="nx">en</span><span class="p">)</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">blanks</span><span class="p">).</span><span class="nx">toMatchSnapshot</span><span class="p">()</span>
<span class="p">})</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/0fa6b958dfeb8be17db1fd978cf7fffd7db4d863/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a6e75754b346c7a787850793335364a333959585634412e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0fa6b958dfeb8be17db1fd978cf7fffd7db4d863/68747470733a2f2f63646e2d696d616765732d312e6d656469756d2e636f6d2f6d61782f3830302f312a6e75754b346c7a787850793335364a333959585634412e706e67" alt="" data-canonical-src="https://cdn-images-1.medium.com/max/800/1*nuuK4lzxxPy356J39YXV4A.png"></a></p>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>Reactのi18n対策をreact-inlt-autoを使ってコンポーネントベースで行う方法、default messageの自動抽出、Flowtypeによる補完、i18nのテストなどについて述べました。これらが、あなたのアプリケーションの国際化について役に立てば嬉しいです。<br>
何か議論があれば、この記事のコメントまたはTwitter(akameco)までお気軽にどうぞ。また、GitHubでスターを頂けるとモチベーションの維持に繋がるのでよろしくお願いします。</p>

<p><a href="https://github.com/akameco/babel-plugin-react-intl-auto" rel="nofollow noopener" target="_blank"><strong>akameco/babel-plugin-react-intl-auto</strong><br> i18n for the component age. Auto management react-intl ID.</a></p>

<blockquote class="twitter-tweet">
<p>publish babel-plugin-react-intl-auto v0.12 🎉 New Feature:Using leading comments as the message description. <a href="https://t.co/oumnRihGBd" rel="nofollow noopener" target="_blank">https://t.co/oumnRihGBd</a> <a href="https://t.co/d6OReGZ1nD" rel="nofollow noopener" target="_blank">pic.twitter.com/d6OReGZ1nD</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/924952146272907266?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 30, 2017</a>
</blockquote>



<hr>

<p>この記事は、mediumからの転載です。<br>
事実として、mediumよりQiitaの方が現状10倍のPVが見込めるので時間をおいてこちらでも公開しようと思った次第であります。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />4位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>23</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/66a2232df0e95e5bfe31">s2s: reduxにおけるreducerのテスト。あなたがテストを書く必要はないかも知れない</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-02 21:44:30</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[flow]</b> <b>[S2S]</b> <b>[babel]</b> <b>[redux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/06999ddc3b5005011050ac0afc7945e161218dac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30333234346162362d666231612d653865362d306635362d3934633931303266316539372e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/06999ddc3b5005011050ac0afc7945e161218dac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30333234346162362d666231612d653865362d306635362d3934633931303266316539372e676966" alt="reducer-test-2.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/03244ab6-fb1a-e8e6-0f56-94c9102f1e97.gif"></a></p>

<h2>
<span id="なぜreducerのテストが重要か" class="fragment"></span><a href="#%E3%81%AA%E3%81%9Creducer%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%81%8C%E9%87%8D%E8%A6%81%E3%81%8B"><i class="fa fa-link"></i></a>なぜreducerのテストが重要か？</h2>

<p>flow環境で型によって返るStateが担保されていたとしても、依然としてreducerのテストは重要です。<br>
簡単な例をあげると、<code>INCREMENT</code>でcountが+1されるロジックがあるとき、number型であると保証されていたとしても、+1されているのか-1されているのか、はたまた+100000されているのかについては保証されていないからです。<br>
そのロジックを担保するのがテストの役割です。</p>

<h2>
<span id="reducerのテストの書き方" class="fragment"></span><a href="#reducer%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-link"></i></a>reducerのテストの書き方</h2>

<p>flow環境とそれ以外でテストの書き方が違います。<br>
トラディショナルなテストだと<code>{type: ACTION}</code>の形式でテストを書くことが多いと思いますが、flow環境だとActionが型で担保されているためアクションクリエイターをそのまま実行して書きます。<br>
トラディショナルな書き方でもいいですが、この方が補完も効くのでオススメします。</p>

<p><a href="https://camo.qiitausercontent.com/186aedd8d74ee54d74058c9a5d344712b458bf51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f65653965316335372d626436612d356433392d383831642d3031333062356261353134662e706e67" target="_blank" rel="nofollow noopener"><img width="994" alt="スクリーンショット 2017-10-02 21.06.59.png" src="https://camo.qiitausercontent.com/186aedd8d74ee54d74058c9a5d344712b458bf51/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f65653965316335372d626436612d356433392d383831642d3031333062356261353134662e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/ee9e1c57-bd6a-5d39-881d-0130b5ba514f.png"></a></p>

<p>この書き方は、redux公式<br>
のflowのサンプルにある書き方と同じなので、気になる人は確認するとよいと思います。</p>

<p><a href="https://github.com/reactjs/redux/blob/c9ad6a40fe501919d359b910ea7c7f34532e11d9/examples/todos-flow/src/__tests__/reducers/todos.test.js" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/reactjs/redux/blob/c9ad6a40fe501919d359b910ea7c7f34532e11d9/examples/todos-flow/src/__tests__/reducers/todos.test.js</a></p>

<h2>
<span id="テストケースの自動生成" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%AE%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>テストケースの自動生成</h2>

<p>そろそろ冒頭の動画の説明をします。<br>
はっきり言って、テストを書くのは面倒です。<br>
そして、テストを書き忘れる可能性についても考える必要があります。<br>
だからこそ、<strong>コードを書いた瞬間にテストがそこにある</strong>のがベストです。<br>
そして、これは<strong>s2s</strong>によって簡単に実現できます。<br>
s2sについては以下の記事を読んでください。<br>
<strong>Source to Source</strong>という概念とその使い方をまとめています。</p>

<p><a href="https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4" id="reference-9fcb9cf9ca0711de6c76"><strong>さよならボイラープレート。s2sによる高速reduxアプリケーション構築</strong></a></p>

<p>GitHubはこちらです。</p>

<p><a href="https://github.com/akameco/s2s" rel="nofollow noopener" target="_blank"><strong>akameco/s2s</strong><br>Source to Source</a></p>

<p>上記の記事を読んだ前提を話を進めると、<code>babel-plugin-s2s-reducer-test-case</code>をs2sに加えることによって動画のようにテストケースを生成できます。<br>
<code>s2s.config.js</code>に以下を加えてください。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span>    <span class="p">{</span>
      <span class="nx">test</span><span class="o">:</span> <span class="sr">/containers\/.+reducer.js/</span><span class="p">,</span>
      <span class="nx">input</span><span class="o">:</span> <span class="s1">'reducer.test.js'</span><span class="p">,</span>
      <span class="nx">output</span><span class="o">:</span> <span class="s1">'reducer.test.js'</span><span class="p">,</span>
      <span class="nx">plugin</span><span class="o">:</span> <span class="p">[</span><span class="s1">'s2s-reducer-test-case'</span><span class="p">],</span>
    <span class="p">},</span>
</pre></div></div>

<p>このプラグインは、switch/caseのアクションを取得し、<code>test('handle ACTION_NAME')</code>がすでにあれば生成をスキップし、なければ以下の形式のテストケースを生成します。INITIAL_STATEはreducerにinitialStateを書かれていればそれをINITIAL_STATEとして扱います。(v0.3から)</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">test</span><span class="p">(</span><span class="s1">'handle ACTION_NAME'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">actions</span><span class="p">.</span><span class="nx">ACTION_CREATER</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">INITIAL_STATE</span><span class="p">);</span>
<span class="p">});</span>
</pre></div></div>

<p>これによって、人間が書くのは、toEqualに与えるオブジェクトと引数だけになります。<br>
これを使ったサンプルは以下にあるので、s2s.config.jsの書き方含めて参考にしてください。とはいえ、オプションなんてほとんどないんですが。</p>

<p><a href="https://github.com/akameco/s2s-examples/tree/master/shopping-cart" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/akameco/s2s-examples/tree/master/shopping-cart</a></p>

<p><a href="https://camo.qiitausercontent.com/06999ddc3b5005011050ac0afc7945e161218dac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30333234346162362d666231612d653865362d306635362d3934633931303266316539372e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/06999ddc3b5005011050ac0afc7945e161218dac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30333234346162362d666231612d653865362d306635362d3934633931303266316539372e676966" alt="reducer-test-2.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/03244ab6-fb1a-e8e6-0f56-94c9102f1e97.gif"></a></p>

<p>また、全てのs2sのプラグインはlernaとyarn workspaceによるモノレポで運用しています。イシューやプルリクお待ちしています。</p>

<p><a href="https://github.com/akameco/s2s-plugins" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/akameco/s2s-plugins</a></p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>flow環境におけるreducerのテスト、s2sによるreducerのテストケースの自動記述について書きました。<br>
上記の通り、あなた<strong>が</strong>テストを書く必要はありません。<strong>そこにテストはあります</strong>。</p>

<p>なにかあれば、コメント欄、またはtwitterで議論しましょう。</p>

<blockquote class="twitter-tweet">
<p>s2sを使ったreducerのテストケースの生成。コードを書くとき、そこにテストはある <a href="https://t.co/FISlpWrpOe" rel="nofollow noopener" target="_blank">https://t.co/FISlpWrpOe</a> <a href="https://t.co/8CNWHhOQwL" rel="nofollow noopener" target="_blank">pic.twitter.com/8CNWHhOQwL</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/914804233395896320?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 2, 2017</a>
</blockquote>



<blockquote class="twitter-tweet">
<p>reduxのreducerのテスト完全に思考停止しながらできるようになってきた<a href="https://t.co/9f7P6LmW2a" rel="nofollow noopener" target="_blank">https://t.co/9f7P6LmW2a</a> <a href="https://t.co/tmuWXojY5C" rel="nofollow noopener" target="_blank">pic.twitter.com/tmuWXojY5C</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/915127901648855040?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 3, 2017</a>
</blockquote>



<h2>
<span id="変更履歴" class="fragment"></span><a href="#%E5%A4%89%E6%9B%B4%E5%B1%A5%E6%AD%B4"><i class="fa fa-link"></i></a>変更履歴</h2>

<h3>
<span id="v02" class="fragment"></span><a href="#v02"><i class="fa fa-link"></i></a>v0.2</h3>

<p>initialStateを使わずnullを挿入する。v0.3でもinitialStateがなければ、nullを挿入する。</p>

<p><a href="https://camo.qiitausercontent.com/7608c257a9f2502f162232498d612029186e94a5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30336234386264642d626137652d643561612d656366382d3032653364366330373037662e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7608c257a9f2502f162232498d612029186e94a5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30336234386264642d626137652d643561612d656366382d3032653364366330373037662e676966" alt="reducer-test.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/03b48bdd-ba7e-d5aa-ecf8-02e3d6c0707f.gif"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />5位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/7459ec053b6fda2d5a84">twitterが280字になったので、ツイートをライブラリとしてバベって使う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-11 19:44:58</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[Twitter]</b> <b>[ネタ]</b> <b>[babel]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ツイッターが英語で280文字書けるようになりました🎉<br>
つまり、ツイッター上でコードを書くのが現実的になったということですね。</p>

<p>せっかくなので、ツイートをライブラリとして使ってみましょう。適当に呟いて、<code>import hello from 'twitter:あなたのツイート'</code>と書いたら、Babelをつかってツイートをコンパイルして実行です。</p>

<p><a href="https://gyazo.com/e3851ff3d1cdee3acd8bef2a777b2dc3" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/c57ce98539c3369a1dd45cb6348d3b94f9330827/68747470733a2f2f692e6779617a6f2e636f6d2f65333835316666336431636465653361636438626566326137373762326463332e676966" alt="https://gyazo.com/e3851ff3d1cdee3acd8bef2a777b2dc3" data-canonical-src="https://i.gyazo.com/e3851ff3d1cdee3acd8bef2a777b2dc3.gif"></a></p>

<h2>
<span id="how-to-use" class="fragment"></span><a href="#how-to-use"><i class="fa fa-link"></i></a>How to Use</h2>

<p><code>babel-plugin-twitter</code>をインストールして、<code>create-babelrc</code>で.babelrcを生成します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ yarn add --dev babel-{cli,preset-env,plugin-twitter}
$ npx create-babelrc -o
Created .babelrc

{ presets: [ 'env' ], plugins: [ 'twitter' ] }
</pre></div></div>

<p>あとは適当にコードを書いて実行します。<br>
もちろん280文字で出来るのはハローワールドだけじゃありません。</p>

<div class="code-frame" data-lang="js">
<div class="code-lang"><span class="bold">index.js</span></div>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">leftPad</span> <span class="nx">from</span> <span class="s1">'twitter:712799807073419264'</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">leftPad</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1">// '00001'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">leftPad</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1">// '01234'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">leftPad</span><span class="p">(</span><span class="mi">12345</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1">// '12345'</span>
</pre></div>
</div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ yarn run babel-node index.js
00001
01234
12345
</pre></div></div>

<p>🎉</p>

<p>これで、<strong>ツイッター = コーディング</strong> という関係が成り立ちました。<br>
これからは堂々とツイッターという<strong>エディタ</strong>でコードを書くことが出来ますね。</p>

<h2>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h2>

<p>同期的にツイートを取得して、それを<code>node_modules/.chace</code>以下にキャッシュします。なので、リクエストは最初の1回だけで2回目からは不要なリクエストもせず高速で動きます。<code>node_modules/.cache</code>へのキャッシュは<code>ava</code>や<code>babel-loader</code>でも使われている手法です。</p>

<p>後はASTを適当にいじれば以下のように変換されます。簡単ですね。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">leftPad</span> <span class="nx">from</span> <span class="s1">'twitter:712799807073419264'</span>

      <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span>

<span class="kr">const</span> <span class="nx">leftPad</span> <span class="o">=</span> <span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">c</span> <span class="o">=</span> <span class="s1">'0'</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">String</span><span class="p">(</span><span class="nx">v</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">n</span> <span class="o">?</span> <span class="s1">''</span> <span class="o">+</span> <span class="nx">v</span> <span class="o">:</span> <span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">+</span> <span class="nx">v</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="nx">n</span><span class="p">);</span>
</pre></div></div>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p><strong>絶対に</strong>プロダクションで使わないで下さい。<strong>ツイートが削除された瞬間</strong>あなたのプロダクトは<strong>終了</strong>です。</p>

<p><a href="https://github.com/akameco/babel-plugin-twitter" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/akameco/babel-plugin-twitter</a></p>

<blockquote class="twitter-tweet">
<p>twitterはエディタなので、ツイートをバベるとコードを実行できる<a href="https://t.co/GlEDNmG8TY" rel="nofollow noopener" target="_blank">https://t.co/GlEDNmG8TY</a> <a href="https://t.co/VRQ8fAac23" rel="nofollow noopener" target="_blank">pic.twitter.com/VRQ8fAac23</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/928545495319851008?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 9, 2017</a>
</blockquote>



<blockquote class="twitter-tweet">
<p>例のアレ<br> <a href="https://t.co/GlEDNmG8TY" rel="nofollow noopener" target="_blank">https://t.co/GlEDNmG8TY</a> <a href="https://t.co/xEgjohhdR7" rel="nofollow noopener" target="_blank">pic.twitter.com/xEgjohhdR7</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/929277391179988992?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">2017年11月11日</a>
</blockquote>

<p>Babel Pluginについて興味が出たなら他の記事もどうぞ。</p>

<p><a href="https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4" id="reference-007a13518e8c2850115f"><strong>さよならボイラープレート。s2sによる高速reduxアプリケーション構築</strong></a></p>

<p><a href="https://qiita.com/akameco/items/d2851fd4868f833c8040" id="reference-23e4e7949a934c918cc9">面接でFizzBuzzを書けと言われたときにすべきこと - Qiita</a></p>

<p><a href="https://qiita.com/akameco/items/019e1a0875ad236e859c" id="reference-67d9866cedd2a8225311">JavaScriptのfloatで正確な比較を行う - Qiita</a></p>

<h2>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h2>

<p>ツイートをローカルで実行するの元ネタはrauchg氏の<code>requireFromTwitter</code>です。</p>

<p><a href="https://gist.github.com/rauchg/5b032c2c2166e4e36713" class="autolink" rel="nofollow noopener" target="_blank">https://gist.github.com/rauchg/5b032c2c2166e4e36713</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />6位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/d2851fd4868f833c8040">面接でFizzBuzzを書けと言われたときにすべきこと</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-02 19:01:48</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[FizzBuzz]</b> <b>[AST]</b> <b>[babel]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>こんなツイートを見つけました。</p>

<blockquote class="twitter-tweet">
<p>IT会社面接官：「数字を列挙し、3の倍数ならfizz、5の倍数ならbuzz、15の倍数ならfizzbuzzを出力するプログラムを書いてください。」<br>面接を受けている人：「では、まずTensorFlowをインポートします…」<a href="https://t.co/UNk2jH5rfn" rel="nofollow noopener" target="_blank">https://t.co/UNk2jH5rfn</a></p>— Graham Neubig (@neubig) <a href="https://twitter.com/neubig/status/734946340292067328?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">May 24, 2016</a>
</blockquote>



<p>FizzBuzzにTensorFlowが必要？<br>
ウケる。<br>
もちろんFizzBuzzに必要なのは、<code>Babel</code>ですよね。</p>

<p>では、まずBabelをインストールします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ yarn add --dev babel-cli babel-plugin-fizzbuzz
$ echo '{"plugins": ["fizzbuzz"]}' &gt; .babelrc
</pre></div></div>

<p>REPLで実行します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ yarn run babel-node
&gt;  for(var i = 1; i &lt; 100; i++) { console.log(i) }
1
2
Fizz
4
Buzz
Fizz
7
8
Fizz
Buzz
11
Fizz
13
14
FizzBuzz
16
...
</pre></div></div>

<p><a href="https://gyazo.com/f2340f77fa9668181cba42c8e19132c1" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/9765f5d8a4d649e1cac459437987f7ba191bd316/68747470733a2f2f692e6779617a6f2e636f6d2f66323334306637376661393636383138316362613432633865313931333263312e676966" alt="https://gyazo.com/f2340f77fa9668181cba42c8e19132c1" data-canonical-src="https://i.gyazo.com/f2340f77fa9668181cba42c8e19132c1.gif"></a></p>

<p>これで面接のFizzBuzz対策も完璧ですね。</p>

<h2>
<span id="何が起きていますか" class="fragment"></span><a href="#%E4%BD%95%E3%81%8C%E8%B5%B7%E3%81%8D%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8B"><i class="fa fa-link"></i></a>何が起きていますか？</h2>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="p">}</span>

      <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="nx">i</span> <span class="o">%</span> <span class="mi">15</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">'FizzBuzz'</span> <span class="o">:</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">'Fizz'</span> <span class="o">:</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">'Buzz'</span> <span class="o">:</span> <span class="nx">i</span>
  <span class="p">)</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="どうやっていますか" class="fragment"></span><a href="#%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%81%8B"><i class="fa fa-link"></i></a>どうやっていますか?</h2>

<p>console.logを問答無用でFizzBuzz出力マシーンに変換にします。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="c1">// @flow weak</span>
<span class="kr">import</span> <span class="nx">looksLike</span> <span class="nx">from</span> <span class="s1">'babel-looks-like'</span>
<span class="c1">// import blog from 'babel-log'</span>

<span class="kr">const</span> <span class="nx">consoleLogPath</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">node</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">callee</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">'MemberExpression'</span><span class="p">,</span>
      <span class="nx">object</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">'console'</span> <span class="p">},</span>
      <span class="nx">property</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">'log'</span> <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">CREATED</span> <span class="o">=</span> <span class="nx">Symbol</span><span class="p">(</span><span class="s1">'CREATED'</span><span class="p">)</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">({</span> <span class="nx">types</span><span class="o">:</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">template</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">template</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">  console.log(ID % 15 === 0 ? 'FizzBuzz' : ID % 3 === 0 ? 'Fizz' : ID % 5 === 0 ? 'Buzz' : ID)</span>
<span class="sb">  `</span><span class="p">)</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">'fizzbuzz'</span><span class="p">,</span>
    <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">CallExpression</span><span class="p">(</span><span class="nx">nodePath</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nodePath</span><span class="p">[</span><span class="nx">CREATED</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">looksLike</span><span class="p">(</span><span class="nx">nodePath</span><span class="p">,</span> <span class="nx">consoleLogPath</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span>
        <span class="p">}</span>

        <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span><span class="o">:</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">nodePath</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'arguments.0.name'</span><span class="p">)</span>
        <span class="nx">nodePath</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">builder</span><span class="p">({</span> <span class="nx">ID</span><span class="o">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">}))</span>
        <span class="nx">nodePath</span><span class="p">[</span><span class="nx">CREATED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>もしこれを面接でやって落ちても一切の責任は取りません。</p>

<p><a href="https://github.com/akameco/babel-plugin-fizzbuzz" rel="nofollow noopener" target="_blank"><strong>akameco/babel-plugin-fizzbuzz</strong><br>Babel Plugin for fizzbuzz</a></p>

<blockquote class="twitter-tweet">
<p>面接でFizzBuzzを聞かれたときのためにBabelPluginを用意しといたで！これで面接対策も完璧や！  <a href="https://t.co/nElT463Hig" rel="nofollow noopener" target="_blank">https://t.co/nElT463Hig</a> <a href="https://t.co/hCsrW0ldDY" rel="nofollow noopener" target="_blank">pic.twitter.com/hCsrW0ldDY</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/926024323432816640?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 2, 2017</a>
</blockquote>



<h3>
<span id="関連" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3"><i class="fa fa-link"></i></a>関連</h3>

<p><a href="https://qiita.com/akameco/items/019e1a0875ad236e859c" id="reference-9ad32efc058ec3ca470b">JavaScriptのfloatで正確な比較を行う - Qiita</a></p>

<p>もしより邪悪なBabelPluginについて知りたければ以下の記事もご覧ください。</p>

<p><a href="https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4" id="reference-f4b47340100963a68def"><strong>さよならボイラープレート。s2sによる高速reduxアプリケーション構築</strong><br>https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />7位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/019e1a0875ad236e859c">JavaScriptのfloatで正確な比較を行う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-30 21:46:01</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[AST]</b> <b>[babel]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>TLにこんなツイートが回ってきました</p>

<blockquote class="twitter-tweet">
<p>正確な実数計算をやらされるJavaScriptくん <a href="https://twitter.com/hashtag/%E6%93%AC%E7%AB%9C%E6%88%AF%E7%94%BB?src=hash&amp;ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">#擬竜戯画</a> <a href="https://t.co/ipE56C2YbV" rel="nofollow noopener" target="_blank">pic.twitter.com/ipE56C2YbV</a></p>— RAO(らお) (@RIORAO) <a href="https://twitter.com/RIORAO/status/923599110262874112?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 26, 2017</a>
</blockquote>



<p>Yep. JavaScriptに限らず浮動小数点数の丸め誤差の問題はあります。<br>
しかし、仕様通りですが、便利かと言えば便利ではありませんね？</p>

<h2>
<span id="こんにちはast" class="fragment"></span><a href="#%E3%81%93%E3%82%93%E3%81%AB%E3%81%A1%E3%81%AFast"><i class="fa fa-link"></i></a>こんにちはAST</h2>

<p>こんなときは、ASTで変換してやればいいです。<br>
Babelで仕様とか色々大切なものを歪めてあげましょう。</p>

<p><a href="https://github.com/akameco/babel-plugin-float-equal" rel="nofollow noopener" target="_blank">akameco/babel-plugin-float-equal: Babel plugin for float equal</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ npm install --save-dev babel-plugin-float-equal 
</pre></div></div>

<div class="code-frame" data-lang="babelrc"><div class="highlight"><pre><span></span>{
  plugins: ["float-equal"]
}
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="c1">// before</span>
<span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">===</span> <span class="mf">0.3</span>
<span class="c1">// =&gt; false</span>


<span class="c1">// after</span>
<span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">===</span> <span class="mf">0.3</span>
<span class="c1">// =&gt; true</span>
</pre></div></div>

<p>Babelを使って、<code>===</code>で比較されていた場合、問答無用で以下のコードへ変換してやります。<br>
Number.EPSILONは<code>2.220446049250313e-16</code>です。<br>
いわゆる許容する誤差です。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">===</span> <span class="mf">0.3</span>

      <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span>

<span class="k">typeof</span> <span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">===</span> <span class="s1">'number'</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="mf">0.3</span> <span class="o">===</span> <span class="s1">'number'</span>
  <span class="o">?</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">EPSILON</span>
  <span class="o">:</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">===</span> <span class="mf">0.3</span>
</pre></div></div>

<h2>
<span id="変数" class="fragment"></span><a href="#%E5%A4%89%E6%95%B0"><i class="fa fa-link"></i></a>変数</h2>

<p>もちろん変数に対応してなくては使い道がないですね。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">===</span> <span class="mf">0.3</span>
<span class="c1">// =&gt; true</span>
</pre></div></div>

<h2>
<span id="how-to-create-babel-plugin" class="fragment"></span><a href="#how-to-create-babel-plugin"><i class="fa fa-link"></i></a>How to create Babel Plugin?</h2>

<p>以下がプラグインの全コードです。<br>
<code>BinaryExpression</code>のときのオペレーターが<code>===</code>のときに、左右のnodeをtemplate関数を呼んで変換したものをpath.replaceWithを使って入れ替えてあげます。<br>
単純ですね。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="p">({</span> <span class="nx">template</span> <span class="p">}</span> <span class="cm">/*: {template: Function} */</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">template</span><span class="p">(</span><span class="sb">`</span>
<span class="sb">  (typeof LEFT === 'number' &amp;&amp; typeof RIGHT === 'number') ? Math.abs(LEFT - RIGHT) &lt; Number.EPSILON : LEFT === RIGHT</span>
<span class="sb">  `</span><span class="p">)</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s1">'float-equal'</span><span class="p">,</span>
    <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">BinaryExpression</span><span class="p">(</span><span class="nx">path</span> <span class="cm">/*: Object */</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'operator'</span><span class="p">).</span><span class="nx">node</span> <span class="o">!==</span> <span class="s1">'==='</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span>
        <span class="p">}</span>

        <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span><span class="o">:</span> <span class="nx">left</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'left'</span><span class="p">)</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span><span class="o">:</span> <span class="nx">right</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'right'</span><span class="p">)</span>

        <span class="kr">const</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">({</span> <span class="nx">LEFT</span><span class="o">:</span> <span class="nx">left</span><span class="p">,</span> <span class="nx">RIGHT</span><span class="o">:</span> <span class="nx">right</span> <span class="p">})</span>

        <span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">ast</span><span class="p">)</span>
        <span class="nx">path</span><span class="p">.</span><span class="nx">skip</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<h3>
<span id="プロダクションで使ってもいいですか" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%82%E3%81%84%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B"><i class="fa fa-link"></i></a>プロダクションで使ってもいいですか？</h3>

<p>いいえ、プロダクションで使ってはいけません。<br>
まあ、危険を犯すのが好きならば、どうぞご自由に。</p>

<p><a href="https://github.com/akameco/babel-plugin-float-equal" rel="nofollow noopener" target="_blank">akameco/babel-plugin-float-equal: Babel plugin for float equal</a></p>

<blockquote class="twitter-tweet">
<p>君のJavaScriptはそうなのか。僕のJavaScriptは計算出来るのだけど <a href="https://t.co/XSvTE4h8tu" rel="nofollow noopener" target="_blank">https://t.co/XSvTE4h8tu</a> <a href="https://t.co/6V5HskHExj" rel="nofollow noopener" target="_blank">pic.twitter.com/6V5HskHExj</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/924619407686385665?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 29, 2017</a>
</blockquote>



<blockquote class="twitter-tweet">
<p>インチキ臭くて草</p>— wreulicke (@wreulicke) <a href="https://twitter.com/wreulicke/status/924619578704932864?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 29, 2017</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />8位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/fe7ba22c158a2593b077">Flowtype+reduxにおけるreducerの正しい型付け</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-16 18:06:01</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[flow]</b> <b>[React]</b> <b>[flowtype]</b> <b>[redux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>よく以下のような型付けを見ます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="c1">// @flow</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Actions</span><span class="p">,</span> <span class="nx">type</span> <span class="nx">Action</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./actions'</span>

<span class="kr">export</span> <span class="nx">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">count</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span>
  <span class="nx">other</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">initialState</span><span class="o">:</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">other</span><span class="o">:</span> <span class="s1">'test'</span> <span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="o">:</span> <span class="nx">State</span> <span class="o">=</span> <span class="nx">initialState</span><span class="p">,</span> <span class="nx">action</span><span class="o">:</span> <span class="nx">Action</span><span class="p">)</span><span class="o">:</span> <span class="nx">State</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">Actions</span><span class="p">.</span><span class="nx">INCREMENT</span><span class="o">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">counter</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">return</span> <span class="nx">state</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>一見正しいように見えます。<br>
flowの型エラーはでません。<br>
しかし、よく見ると、<strong>count</strong>を<strong>counter</strong>とタイポしています。<br>
これでは型安全などと言えませんね。</p>

<h2>
<span id="shapetを使った改善" class="fragment"></span><a href="#shapet%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%94%B9%E5%96%84"><i class="fa fa-link"></i></a>$Shape&lt;T&gt;を使った改善</h2>

<p>この型のオブジェクトは、Tに記述されていないプロパティを含むことはできません。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">type</span> <span class="nx">T</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">foo</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="nx">bar</span><span class="o">:</span> <span class="nx">number</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">a</span><span class="o">:</span> <span class="nx">$Shape</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">foo</span><span class="o">:</span> <span class="s1">'121'</span><span class="p">,</span> <span class="c1">// no errors about not having bar </span>
  <span class="nx">baz</span><span class="o">:</span> <span class="kc">true</span>   <span class="c1">// error, baz is not in T type</span>
<span class="p">}</span>
</pre></div></div>

<p>これをreducerで使うと以下のようになります。<br>
reducerの戻り値の型を<code>$Shape&lt;State&gt;</code>に変更します。</p>

<p><a href="https://camo.qiitausercontent.com/575a939434d5d02e103276ed3695386415ce9213/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f66353730653833362d376462622d306339662d373261652d6563333038313837373332612e706e67" target="_blank" rel="nofollow noopener"><img width="459" alt="スクリーンショット 2017-09-16 17.18.05.png" src="https://camo.qiitausercontent.com/575a939434d5d02e103276ed3695386415ce9213/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f66353730653833362d376462622d306339662d373261652d6563333038313837373332612e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/f570e836-7dbb-0c9f-72ae-ec308187732a.png"></a></p>

<p>グレート！<br>
定義されてないcounterで型エラーが起きました。<br>
countに直しましょう。</p>

<p><a href="https://camo.qiitausercontent.com/adbef3a3f9c000f2166102855b982876c367b987/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f36616130633535332d376632622d663561662d393736382d3936616431656338316366642e706e67" target="_blank" rel="nofollow noopener"><img width="453" alt="スクリーンショット 2017-09-16 17.19.55.png" src="https://camo.qiitausercontent.com/adbef3a3f9c000f2166102855b982876c367b987/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f36616130633535332d376632622d663561662d393736382d3936616431656338316366642e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/6aa0c553-7f2b-f5af-9768-96ad1ec81cfd.png"></a></p>

<p>エラーが消えました。<br>
しかし、残念ながら、これではダメです。<br>
定義したStateの型は以下でした。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">count</span><span class="o">:</span> <span class="nx">number</span><span class="p">,</span>
  <span class="nx">other</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="p">}</span>
</pre></div></div>

<p>プロパティ<code>other</code>が消えているのに検知出来ていません。</p>

<h2>
<span id="t--shapet-を使う" class="fragment"></span><a href="#t--shapet-%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>T &amp; $Shape&lt;T&gt; を使う</h2>

<p>これを解決するには以下の型を定義します。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">type</span> <span class="nx">Exact</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="o">&amp;</span> <span class="nx">$Shape</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span>
</pre></div></div>

<p>これは、Tのプロパティ全てかつそれ以外のプロパティを許容しない型です。</p>

<p>するとプロパティが足りない場合正しくflowが検知します。</p>

<p><a href="https://camo.qiitausercontent.com/9510d8735da5628e10e7cd4a53ed3fe0f94ae9bb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f37353766343832362d353639322d393862662d623734322d6631383834353439626665392e706e67" target="_blank" rel="nofollow noopener"><img width="412" alt="スクリーンショット 2017-09-16 17.26.35.png" src="https://camo.qiitausercontent.com/9510d8735da5628e10e7cd4a53ed3fe0f94ae9bb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f37353766343832362d353639322d393862662d623734322d6631383834353439626665392e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/757f4826-5692-98bf-b742-f1884549bfe9.png"></a></p>

<p><code>...state</code>を追加しましょう。<br>
これで、reducerが型で守られるようになりました。</p>

<p><a href="https://camo.qiitausercontent.com/a6a38c2d8e67b546eaaf8a07d901454e20b9bcff/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f32396538633861632d643932342d343364332d396662372d6166646430386230326665642e706e67" target="_blank" rel="nofollow noopener"><img width="560" alt="スクリーンショット 2017-09-16 17.54.36.png" src="https://camo.qiitausercontent.com/a6a38c2d8e67b546eaaf8a07d901454e20b9bcff/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f32396538633861632d643932342d343364332d396662372d6166646430386230326665642e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/29e8c8ac-d924-43d3-9fb7-afdd08b02fed.png"></a></p>

<p>全体では、以下のようになります。もちろんExactはreducerごとに定義するのではなくimport typeした方がよいでしょう。</p>

<p><a href="https://camo.qiitausercontent.com/9767cb02f667afb93b9f719dd60a7b6267206666/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f62623337663762322d656339662d336662622d303637322d6637656363343539333565372e706e67" target="_blank" rel="nofollow noopener"><img width="616" alt="スクリーンショット 2017-09-16 18.08.03.png" src="https://camo.qiitausercontent.com/9767cb02f667afb93b9f719dd60a7b6267206666/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f62623337663762322d656339662d336662622d303637322d6637656363343539333565372e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/bb37f7b2-ec9f-3fbb-0672-f7ecc45935e7.png"></a></p>

<h2>
<span id="なぜexacttではダメなのか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9Cexactt%E3%81%A7%E3%81%AF%E3%83%80%E3%83%A1%E3%81%AA%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>なぜ$Exact&lt;T&gt;ではダメなのか？</h2>

<p>$Exact&lt;T&gt;だと全てのオブジェクトが正しくないとダメなので、<code>{...state}</code>を使うとその時点でエラーが起きてしまいます。<br>
なので<code>{ ...state, count: state.count + 1 }</code>で型エラーが発生してしまいます。</p>

<p><a href="https://camo.qiitausercontent.com/432268e187f3692e51c6173c3128f57708f8d621/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f37333162306235392d333733302d346433642d623732652d6563383231653937616632662e706e67" target="_blank" rel="nofollow noopener"><img width="671" alt="スクリーンショット 2017-09-16 18.17.35.png" src="https://camo.qiitausercontent.com/432268e187f3692e51c6173c3128f57708f8d621/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f37333162306235392d333733302d346433642d623732652d6563383231653937616632662e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/731b0b59-3730-4d3d-b72e-ec821e97af2f.png"></a></p>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>上記のスクリーンショットのエディタはAtom-IDEを使っています。</p>

<p><code>Exact&lt;T&gt;</code>ですが、それぞれの<code>reducer</code>に毎回<code>import type</code>するか悩みますね。<br>
どこでも使えるようにグローバルに定義してしまってもいいかもしれないとも思っています。<br>
何かあればコメント欄またはtwitterにて議論しましょう。</p>

<blockquote class="twitter-tweet">
<p>この型定義便利なのでflowのUtility Typesの仲間に入れてほしい。$Exact&lt;T&gt;と$Shape&lt;T&gt;の中間的な働きをする <a href="https://t.co/2DK4JA6w7A" rel="nofollow noopener" target="_blank">pic.twitter.com/2DK4JA6w7A</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/908973869741912064" rel="nofollow noopener" target="_blank">September 16, 2017</a>
</blockquote>



<h2>
<span id="関連記事" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B"><i class="fa fa-link"></i></a>関連記事</h2>

<p><strong>Flowtypeのactionの型付け。String Literal型とString型について</strong><br>
<a href="http://qiita.com/akameco/items/e7021e22da4c9e14463a" class="autolink" id="reference-97515301410f4f109d5d">http://qiita.com/akameco/items/e7021e22da4c9e14463a</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />9位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/44c7933525d4fa9d91c8">GitHubのレポジトリをアーカイブする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-09 06:13:05</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[GitHub]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote class="twitter-tweet">
<p>Hey OSS maintainers! You can now stop getting any new PRs/issues/comments on your deprecated/unmaintained repos: <a href="https://t.co/ZfajGVGZD4" rel="nofollow noopener" target="_blank">https://t.co/ZfajGVGZD4</a></p>— Mike McQuaid (@MikeMcQuaid) <a href="https://twitter.com/MikeMcQuaid/status/928286816112955392?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 8, 2017</a>
</blockquote>



<p>レポジトリをアーカイブすることで、新しいPRs/issues/commentsを作成出来なく出来ます。</p>

<p>自分の場合は、モノレポに移行し以前のレポジトリを管理する必要がなくなったので、このアーカイブを使いました。<br>
削除するのも手ですが、レポジトリへのリンクが記事などで使われている場合があり、404ではなく次のレポジトリへと導線として残すのは良い手段だと思います。</p>

<p>方法としては、<code>Archive this repository.</code>をクリックして、サブミットするだけです。</p>

<p><a href="https://camo.qiitausercontent.com/17de64f8c746be5d2293a17c787c9cb44292752c/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f3132353031312f33323237333131392d30666335353731652d626566392d313165372d393930392d6431333732363861316436642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/17de64f8c746be5d2293a17c787c9cb44292752c/68747470733a2f2f757365722d696d616765732e67697468756275736572636f6e74656e742e636f6d2f3132353031312f33323237333131392d30666335353731652d626566392d313165372d393930392d6431333732363861316436642e706e67" alt="" data-canonical-src="https://user-images.githubusercontent.com/125011/32273119-0fc5571e-bef9-11e7-9909-d137268a1d6d.png"></a></p>

<p><a href="https://github.com/blog/2460-archiving-repositories" rel="nofollow noopener" target="_blank">Archiving repositories</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />10位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/388875f61b407c1d6d34">スナップショットテストを使いPublicなAPIをテストする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-08 07:14:19</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[テスト]</b> <b>[jest]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ライブラリを書いていると、公開するAPIのスキーマをテストしたいことがあります。</p>

<p>例えば、以下のような非常に小さなライブラリ。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="s1">'hello'</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="sb">`</span><span class="si">${</span><span class="nx">hello</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">first</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">noop</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{}</span>
</pre></div></div>

<p>ここで、公開されているAPIは、module.exportsで公開した<code>Function</code>と<code>first</code>と<code>noop</code>です。<br>
しかし、APIを変更する必要が出て、firstを以下のようにnumberからfunctionへと変更したとします。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">first</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="mi">1</span>
</pre></div></div>

<p>もちろんそれぞれにユニットテストを書くのは重要ですが、スキーマがあると安心です。<br>
jestをインストールし、以下のようなコードを用意します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yarn add --dev jest
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">test</span><span class="p">(</span><span class="s1">'public API snapshot'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">schema</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">api</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">acc</span><span class="p">,</span> <span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="o">:</span> <span class="k">typeof</span> <span class="nx">api</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="p">}),</span>
    <span class="p">{</span> <span class="s1">'module.exports'</span><span class="o">:</span> <span class="k">typeof</span> <span class="nx">api</span> <span class="p">}</span>
  <span class="p">)</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">schema</span><span class="p">).</span><span class="nx">toMatchSnapshot</span><span class="p">()</span>
<span class="p">})</span>
</pre></div></div>

<p>これで、<code>module.exports</code>によって公開されたスキーマのスナップショットを取ることができます。<br>
例えば、上記のように<code>number</code>から<code>function</code>へと公開するAPIが変わったら以下のようにFailします。</p>

<p><a href="https://camo.qiitausercontent.com/15d4fb9810329f883a384c4fd5268639cdfc1b71/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f35653766333634342d303935652d313366632d353534662d3832393036323335343036622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/15d4fb9810329f883a384c4fd5268639cdfc1b71/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f35653766333634342d303935652d313366632d353534662d3832393036323335343036622e706e67" alt="スクリーンショット 2017-11-08 07.01.22.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/5e7f3644-095e-13fc-554f-82906235406b.png"></a></p>

<p>もちろん、新しいAPIを公開したときもFailします。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">second</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="mi">2</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/8c282f4c52b28ecf2354843c7c3b2a839de19ba4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f36313935396165352d313731632d346537372d323462322d6130616463306337313365642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8c282f4c52b28ecf2354843c7c3b2a839de19ba4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f36313935396165352d313731632d346537372d323462322d6130616463306337313365642e706e67" alt="スクリーンショット 2017-11-08 07.11.12.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/61959ae5-171c-4e77-24b2-a0adc0c713ed.png"></a></p>

<p>これによって、カバレッジを見るまでもなく、テストすべき関数がひと目でわかります。また、バージョニングの指標の一つになるでしょう。(コミットメッセージによるセマンティックリリースはあくまで人間の手よる手動管理という認識です)</p>

<h2>
<span id="終わりに" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>終わりに</h2>

<p>荒削りですが、以上です。<br>
何か議論があればコメント欄またはTwitterまでお願いします。</p>

<blockquote class="twitter-tweet">
<p>PublicなAPIのスキーマのスナップショットテスト。ちょっと面白いかも知れない。 <a href="https://t.co/i9vPAKJ9fz" rel="nofollow noopener" target="_blank">pic.twitter.com/i9vPAKJ9fz</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/928021633926807552?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 7, 2017</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />11位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/ada704a54d720c438966">s2s: reduxにおけるRequest/Sucess/Failureパターンを自動生成する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-05 02:46:23</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[S2S]</b> <b>[babel]</b> <b>[redux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/6d760d3889b1cf60807e0cbd24c76f8777f510ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f61313936373331642d393233312d613031612d663638642d3461386131653366393864312e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6d760d3889b1cf60807e0cbd24c76f8777f510ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f61313936373331642d393233312d613031612d663638642d3461386131653366393864312e676966" alt="9184b81a540f29860536de5a2e1c43ba.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/a196731d-9231-a01a-f68d-4a8a1e3f98d1.gif"></a></p>

<p>reduxで頻出するパターンとしてRequest/Sucess/Failureパターンがあります。<br>
これは、APIを叩く際に主に利用されるパターンです。<br>
具体的な流れとしては、Requestアクションを発火しStateをisLoadingに変更しローディングを表示し、APIリクエストを行います。データを取得できれば、Sucessアクションでデータを反映、失敗したらFailureアクションを発火しエラーを表示するのが主なパターンです。<br>
このパターンをライブラリなどで抽象することもありますが、flowtypeでアクションタイプを厳密に管理してると自分でアクションを定義する必要があります。もし、ライブラリ側で適切に型付けする方法を知っていればコメント欄またはtwitterにて教えてください。</p>

<h2>
<span id="自動生成" class="fragment"></span><a href="#%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>自動生成</h2>

<p>さて、先日s2sというライブラリを公開しました。<br>
詳しくは、以下の記事を読んでください。</p>

<p><a href="https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4" id="reference-4dfce0d12291714f6114"><strong>さよならボイラープレート。s2sによる高速reduxアプリケーション構築</strong><br>https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4</a></p>

<p>簡単に説明すると、ASTによるリアルタイムコーディングアシストです。<br>
これを使うと、型定義及びアクションの定数が一気に簡単になります。</p>

<p><a href="https://camo.qiitausercontent.com/6d760d3889b1cf60807e0cbd24c76f8777f510ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f61313936373331642d393233312d613031612d663638642d3461386131653366393864312e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6d760d3889b1cf60807e0cbd24c76f8777f510ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f61313936373331642d393233312d613031612d663638642d3461386131653366393864312e676966" alt="9184b81a540f29860536de5a2e1c43ba.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/a196731d-9231-a01a-f68d-4a8a1e3f98d1.gif"></a></p>

<p>これは、保存時に以下の変換を行っています。</p>

<p><a href="https://camo.qiitausercontent.com/3becf0ccd4fb89fc3202c97414c038c7513c3f25/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f39623238643066352d343637312d613132312d623235302d3936666631393766656664322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3becf0ccd4fb89fc3202c97414c038c7513c3f25/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f39623238643066352d343637312d613132312d623235302d3936666631393766656664322e706e67" alt="スクリーンショット 2017-10-05 02.40.11.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/9b28d0f5-4671-a121-b250-96ff197fefd2.png"></a></p>

<p>導入方法については、上記の記事を読んでください。<br>
また、興味があれば、他の記事も読んでいただけるとうれしいです。</p>

<p><strong>さよならボイラープレート。s2sによる高速reduxアプリケーション構築</strong><br>
<a href="https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4">https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4</a></p>

<p><strong>s2s: reduxにおけるreducerのテスト。あなたがテストを書く必要はないかも知れない</strong><br>
<a href="https://qiita.com/akameco/items/66a2232df0e95e5bfe31" id="reference-4036ff5cd6f06beb918e">https://qiita.com/akameco/items/66a2232df0e95e5bfe31</a></p>

<p><a href="https://github.com/akameco/s2s" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/akameco/s2s</a> に公開してるのでスターをいただけるとモチベーションになります。</p>

<p>何かあればコメント欄またはtwitterにて議論しましょう。</p>

<blockquote class="twitter-tweet">
<p>Request/Success/Failureパターンに対応した <a href="https://t.co/8H30LdTDQF" rel="nofollow noopener" target="_blank">https://t.co/8H30LdTDQF</a> <a href="https://t.co/w7Hqno7FKr" rel="nofollow noopener" target="_blank">pic.twitter.com/w7Hqno7FKr</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/915187137397403653?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">2017年10月3日</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />12位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/e7021e22da4c9e14463a">Flowtypeのactionの型付け。String Literal型とString型について</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-18 06:44:09</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[flow]</b> <b>[flowtype]</b> <b>[redux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>flowtypeでactionの型付けをする際に、定数として宣言したアクション名をtypeofを使いActionの型に変形するパターンを使うことが多いと思います。(スクショはAtom-IDE)</p>

<p><a href="https://camo.qiitausercontent.com/6298e01d49b163569752a7127ab7828b2284dd41/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f33333664336533312d303233352d643530662d653535312d3136666237663233363732342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6298e01d49b163569752a7127ab7828b2284dd41/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f33333664336533312d303233352d643530662d653535312d3136666237663233363732342e706e67" alt="スクリーンショット 2017-09-18 06.06.37.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/336d3e31-0235-d50f-e551-16fb7f236724.png"></a></p>

<p>この場合、<code>{type: string}</code>型として認識されています。</p>

<p>ここで、<code>const action: 'Action' = 'Action'</code>のように<strong>String Literal</strong>型にすると型が明確になります。</p>

<p><a href="https://camo.qiitausercontent.com/797d830868edb5c64644f2c3f1269a73fe976b53/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f62373337346239322d633131342d383936362d346261302d3465373735333535623834622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/797d830868edb5c64644f2c3f1269a73fe976b53/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f62373337346239322d633131342d383936362d346261302d3465373735333535623834622e706e67" alt="スクリーンショット 2017-09-18 06.08.07.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/b7374b92-c114-8966-4ba0-4e775355b84b.png"></a></p>

<p>これにすると、デバックが容易になるだけでなく、開発時においてアクションをディスパッチする際の型が明確なので迷うことがなくなります。(画像はAtom-IDE)</p>

<h4>
<span id="stringバージョン" class="fragment"></span><a href="#string%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>stringバージョン</h4>

<p><a href="https://camo.qiitausercontent.com/99d10ded4d172008be7fce14a385034102488641/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f66376538386634382d653765652d626337362d663438382d6538333065636361343864362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/99d10ded4d172008be7fce14a385034102488641/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f66376538386634382d653765652d626337362d663438382d6538333065636361343864362e706e67" alt="スクリーンショット 2017-09-18 06.26.57.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/f7e88f48-e7ee-bc76-f488-e830ecca48d6.png"></a></p>

<h4>
<span id="string-literalバージョン" class="fragment"></span><a href="#string-literal%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>string literalバージョン</h4>

<p><a href="https://camo.qiitausercontent.com/aec2fcfa4758f5891a149e4a9084bf12d20b17d4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f64383166383631652d373330342d333731322d326130332d6432616634353935383536642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/aec2fcfa4758f5891a149e4a9084bf12d20b17d4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f64383166383631652d373330342d333731322d326130332d6432616634353935383536642e706e67" alt="スクリーンショット 2017-09-18 06.15.55.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/d81f861e-7304-3712-2a03-d2af4595856d.png"></a></p>

<h2>
<span id="気持ち" class="fragment"></span><a href="#%E6%B0%97%E6%8C%81%E3%81%A1"><i class="fa fa-link"></i></a>気持ち</h2>

<p>コード量は増えるのでそのトレードオフを考える必要はあります。<br>
またそれを改善する記事を今週中には上げる予定です。</p>

<p>なにか議論あればコメント欄またはtwitterまでよろしくお願いします。</p>

<blockquote class="twitter-tweet">
<p>どちらが読みやすい？ <a href="https://t.co/TV0bCvsKIH" rel="nofollow noopener" target="_blank">pic.twitter.com/TV0bCvsKIH</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/909522344749686784" rel="nofollow noopener" target="_blank">September 17, 2017</a>
</blockquote>



<h2>
<span id="関連記事" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B"><i class="fa fa-link"></i></a>関連記事</h2>

<p><strong>flowtypeによるredux-thunkの型付け</strong><br>
<a href="http://qiita.com/akameco/items/c7e48e4666dc1b17350c" class="autolink" id="reference-475742eb101baaf10850">http://qiita.com/akameco/items/c7e48e4666dc1b17350c</a></p>

<p><strong>Flowtype+reduxにおけるreducerの正しい型付け</strong><br>
<a href="http://qiita.com/akameco/items/fe7ba22c158a2593b077" class="autolink" id="reference-7921ea0df6d243705d0e">http://qiita.com/akameco/items/fe7ba22c158a2593b077</a></p>

<p><strong>Atom-IDEについて</strong><br>
<a href="http://qiita.com/akameco/items/d883094c5c8152915cf2" class="autolink" id="reference-ece74665416329a7e2f8">http://qiita.com/akameco/items/d883094c5c8152915cf2</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />13位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/6c7890e8fa956430c585">npm-cdで一瞬でライブラリ間を移動する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-10 03:00:33</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[shell]</b> <b>[npm]</b> <b>[cd]</b> <b>[Ghq]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>コードリーディングをしたいとき、いちいちそのレポジトリを探しに行くのは手間です。例えば、reduxのコードをローカルで少し見たいと思ったときどうするでしょう。githubを検索してreduxを表示してgit clone？面倒です。</p>

<p>そこでnpm-cdを作ってみました。</p>

<p><a href="https://camo.qiitausercontent.com/d2ab39c390d61a7e8406974674f840c63aa41e7c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f64326632313365302d613338342d303732372d666436622d6566613664663136366632632e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d2ab39c390d61a7e8406974674f840c63aa41e7c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f64326632313365302d613338342d303732372d666436622d6566613664663136366632632e676966" alt="npm-cd.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/d2f213e0-a384-0727-fd6b-efa6df166f2c.gif"></a></p>

<p>GHQが事前にインストールされていることが条件です。</p>

<p>npm-cdはnpmのライブラリがGHQ以下にあれば移動し、なければcloneしてから移動します。</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<p>npmからインストールできます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ npm i -g npm-cd
</pre></div></div>

<p><a href="https://github.com/akameco/npm-cd" rel="nofollow noopener" target="_blank">akameco/npm-cd</a></p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>一度、GHQ環境下にインストールすればpecoで移動するのですが、そもそも持ってくる前の段階の探しに行く手間があるのを改善できたので満足です。</p>

<p>何かあればコマンド欄やtwitterまでお願いします。</p>

<blockquote class="twitter-tweet">
<p>npm-cd npmのパッケージ名でcdする。対象がインストールされてなければcloneしてから移動。要GHQ <a href="https://t.co/Jg00e23HTF" rel="nofollow noopener" target="_blank">https://t.co/Jg00e23HTF</a> <a href="https://t.co/9nI6hYY9Bm" rel="nofollow noopener" target="_blank">pic.twitter.com/9nI6hYY9Bm</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/917441505593221120?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 9, 2017</a>
</blockquote>



<blockquote class="twitter-tweet">
<p>pecoするにしても対象を一回インストールする必要あってそれが面倒すぎて、facebook/reactだっけ？reactjs/reactだっけ？reactjsの方はreduxだっけ？みたいになるのがあれなので最初の一回のためのツールという自分の中の位置づけ</p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/917452014635819008?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 9, 2017</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />14位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/107f03d0dd6437a1cd2d">自分自身をデフォルト引数に指定する。あるいはプログラムで詩を書く方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-26 23:22:14</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[Node.js]</b> <b>[ポエム]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>es6では、デフォルト引数が使えて便利です。<br>
そして、もちろん自分自身をデフォルト引数として指定できます。</p>

<p><a href="https://camo.qiitausercontent.com/27e7aa6384e0835a4e315a4fbc380017cef3ae95/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f444b7039436c715549416f307a32552e6a70673a736d616c6c" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/27e7aa6384e0835a4e315a4fbc380017cef3ae95/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f444b7039436c715549416f307a32552e6a70673a736d616c6c" data-canonical-src="https://pbs.twimg.com/media/DKp9ClqUIAo0z2U.jpg:small"></a></p>

<p>自分自身を再帰的に呼ぶ場合は、引数がなければ無限ループするのであまり出番はないかも知れませんが、プログラムで詩を書くときは便利です。</p>

<blockquote class="twitter-tweet">
<p>秋なので詩を書いてた <a href="https://t.co/7iKs9DEkjx" rel="nofollow noopener" target="_blank">pic.twitter.com/7iKs9DEkjx</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/912679670872662016" rel="nofollow noopener" target="_blank">September 26, 2017</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />15位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/5f5d7a86c71f160e11d2">ローディングコンポーネントのラップ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-20 07:31:08</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[reactjs]</b> <b>[React]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>よくあるパターンとして、3項間演算子を使った以下のようなパターンがあります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">?</span> <span class="o">&lt;</span><span class="nx">Loading</span> <span class="o">/&gt;</span> <span class="o">:</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">MyComponent1</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">MyComponent2</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">MyComponent3</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">MyComponent4</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>
</pre></div></div>

<p>しかし、どちらを先に書くか？等の不要な判断が入るスキマが残っています。<br>
例えば、以下の場合はローディング中にMyCompコンポーネントが表示されてしまうでしょう。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">?</span> <span class="o">&lt;</span><span class="nx">MyComp</span> <span class="o">/&gt;</span> <span class="o">:</span> <span class="o">&lt;</span><span class="nx">Loading</span> <span class="o">/&gt;</span>
</pre></div></div>

<p>このような場合、ローディングを抽象したコンポーネントを用意してあげると便利です。<br>
MyComponentは必ずローディング後にレンダリングされることが保証されます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">SwitchLoading</span> <span class="nx">isLoading</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isLoading</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">MyComponent</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/SwitchLoading&gt;</span>
</pre></div></div>

<p>やり方は色々ありますが、シンプルにこんな感じで用意して上げればいいと思います。<br>
ここでは、更にMaybeコンポーネントを用意しています。<br>
もちろん、flowを使わない理由はないですから、flowで型付けを行います。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="c1">// @flow</span>
<span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span>

<span class="kr">class</span> <span class="nx">Maybe</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="o">&lt;</span><span class="p">{</span>
  <span class="nx">flag</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">,</span>
  <span class="nx">children</span><span class="o">?:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span>
  <span class="k">else</span><span class="o">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span>
<span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">props</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span>

    <span class="k">return</span> <span class="nx">props</span><span class="p">.</span><span class="nx">flag</span> <span class="o">?</span> <span class="nx">props</span><span class="p">.</span><span class="nx">children</span> <span class="o">:</span> <span class="nx">props</span><span class="p">.</span><span class="k">else</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Loading</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Loading</span><span class="p">...</span><span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="kr">class</span> <span class="nx">SwitchLoading</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="o">&lt;</span><span class="p">{</span>
  <span class="nx">isLoading</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">,</span>
  <span class="nx">children</span><span class="o">?:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Node</span><span class="p">,</span>
<span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">props</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">Maybe</span> <span class="nx">flag</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">isLoading</span><span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Loading</span> <span class="o">/&gt;</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/Maybe&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">MyComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="nx">World</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>

<span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="o">&lt;</span><span class="p">{},</span> <span class="p">{</span> <span class="nx">isLoading</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span> <span class="p">}</span>

  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">finishLoading</span><span class="p">()</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">finishLoading</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">state</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"App"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">SwitchLoading</span> <span class="nx">isLoading</span><span class="o">=</span><span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">isLoading</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">MyComponent</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="err">/SwitchLoading&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">App</span>
</pre></div></div>

<h2>
<span id="" class="fragment"></span><a href="#"><i class="fa fa-link"></i></a>🤔</h2>

<h3>
<span id="vs-hoc" class="fragment"></span><a href="#vs-hoc"><i class="fa fa-link"></i></a>VS HoC</h3>

<p>withLoadingのようなHoCを用意してあげてもいいです。<br>
が、しかし、HoCは便利な反面、複雑で厄介です。<br>
個人的にはパフォーマンス上の理由がない限り、自分でHoCを作成するのは避けます。<br>
どちらかと言えば、コントロール可能なコンポーネントを作る場合、Comp as Funcスタイル(react-motion等)か、レンダラーpropスタイルを使う方が単純で便利だと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />16位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/5f3e5451ab48b65b00b4">VSCodeでflow環境でも正しくハイライトさせる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-06 17:37:12</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[VSCode]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>VSCodeでflowtypeを導入したjsファイルを編集していると、どうも正しくシンタックスハイライトが機能しません。下の画像だと、<code>const typesAst</code>などが白いままです。</p>

<p><a href="https://camo.qiitausercontent.com/33cfa81fb44a0e9566723bcbb465c6c6e412a3e5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30333231663165312d313439302d336266632d303431612d3139333663353062396663342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/33cfa81fb44a0e9566723bcbb465c6c6e412a3e5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30333231663165312d313439302d336266632d303431612d3139333663353062396663342e706e67" alt="スクリーンショット 2017-10-06 17.29.31.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/0321f1e1-1490-3bfc-041a-1936c50b9fc4.png"></a></p>

<p>これを修正するには、settings.jsonに以下を追加します。</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span>  <span class="s2">"files.associations"</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">"*.js"</span><span class="p">:</span> <span class="s2">"javascriptreact"</span>
  <span class="p">}</span>
</pre></div></div>

<p>すると以下の画像のようにハイライトされるようなりました。</p>

<p><a href="https://camo.qiitausercontent.com/e042a976919cddf5e7e890d0e8dc6f4b36180345/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f35376536643939662d626634382d653165342d323866372d6636313466396435373664312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e042a976919cddf5e7e890d0e8dc6f4b36180345/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f35376536643939662d626634382d653165342d323866372d6636313466396435373664312e706e67" alt="スクリーンショット 2017-10-06 17.29.46.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/57e6d99f-bf48-e1e4-28f7-f614f9d576d1.png"></a></p>

<p>しかし、NAMEやVALUEの緑のハイライトが消えてしまっています。<br>
このあたりを解消する方法を知っている方がいれば、コメント等で教えていただけると幸いです。しかし、画像を貼り付けるまでそれに気づかない感じだったので、const ~からはじまるシンタックスハイライトが機能している状態の方が違和感がないので、そちらを使っています。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />17位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/f4b89bcbb7c6e5b6fabc">gcd ターミナルでGitHubのレポジトリを便利に移動する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-05 05:42:10</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Zsh]</b> <b>[GitHub]</b> <b>[tips]</b> <b>[shell]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/415049a444854ecf8036958000e69bea0a0dc948/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f39653033633461382d346461632d623464352d663133652d3131363165316362353139392e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/415049a444854ecf8036958000e69bea0a0dc948/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f39653033633461382d346461632d623464352d663133652d3131363165316362353139392e676966" alt="tweet.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/9e03c4a8-4dac-b4d5-f13e-1161e1cb5199.gif"></a></p>

<p>基本的な動作は以下のとおりです。</p>

<p><code>gcd レポジトリ名</code>で自分のレポジトリへ移動。<br>
<code>gcd 組織/レポジトリ名</code>でそのレポジトリへ移動。<br>
もしローカルに無ければクローンしてから移動。</p>

<p>ghqを必要とします。</p>

<p><a href="https://github.com/motemen/ghq" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/motemen/ghq</a></p>

<p>ghqはとても素晴らしいツールです。詳しい導入方法は検索すると多くの記事が出てくるのでそちらに任せます。macならば<code>brew install ghq</code>でインストール可能です。</p>

<p>gcdは、以下のスクリプトを<code>.zshrc</code>などに追記するだけで動作します。</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span><span class="nv">GHQ</span><span class="o">=</span><span class="sb">`</span>ghq root<span class="sb">`</span>/github.com
<span class="nv">ME</span><span class="o">=</span><span class="sb">`</span>git config --get user.name<span class="sb">`</span>

gcd<span class="o">()</span> <span class="o">{</span>
    ghq get -p <span class="nv">$1</span>
    <span class="k">if</span> <span class="o">[</span> <span class="sb">`</span>dirname <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="sb">`</span> <span class="o">=</span> <span class="s2">"."</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">cd</span> <span class="nv">$GHQ</span>/<span class="nv">$ME</span>/<span class="nv">$1</span>
    <span class="k">else</span>
        <span class="nb">cd</span> <span class="nv">$GHQ</span>/<span class="nv">$1</span>
    <span class="k">fi</span>
<span class="o">}</span>
</pre></div></div>

<p><code>$GHQ</code>や<code>$ME</code>などの変数は、ハードコートしてもよいと思います。</p>

<p>自分で追記するのも面倒ならば、<code>npm i -g gcd-cli</code>でインストールできます。<br>
<a href="https://github.com/akameco/gcd-cli" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/akameco/gcd-cli</a></p>

<p>何かあればtwitterまたはコメント欄にて議論しましょう。<br>
</p><blockquote class="twitter-tweet">
<p>便利スクリプトgcd(GitHub cd)。<code>gcd レポジトリ名</code>で自分のレポジトリへ移動。<code>gcd 組織/レポジトリ名</code>でそのレポジトリへ移動。ローカルに無ければクローンしてから移動  <a href="https://t.co/q6YKO9G7LB" rel="nofollow noopener" target="_blank"></a><a href="https://t.co/q6YKO9G7LB" class="autolink" rel="nofollow noopener" target="_blank">https://t.co/q6YKO9G7LB</a>  要ghq <a href="https://t.co/SAnEXkCrnY" rel="nofollow noopener" target="_blank">pic.twitter.com/SAnEXkCrnY</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/915673362499649536?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">2017年10月4日</a>
</blockquote><br>

</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />18位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/443d6adfbeb364f8973e">GitHubでjsのレポジトリを見るときにhide-files-on-githubが便利</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-29 22:50:13</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[GitHub]</b> <b>[tips]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ずっと愛用しているんですが、hide-files-on-githubが本当に便利です。<br>
.gitignoreや.editorconfigなど邪魔なファイルを一行にまとめてくれます。<br>
もちろん展開して見ることもできます。</p>

<p><a href="https://camo.qiitausercontent.com/494f9ef2f5049f9728010d1edccde7cffb7cd8a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f31656565376464612d343539382d343765652d313334322d3064376536373561633030392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/494f9ef2f5049f9728010d1edccde7cffb7cd8a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f31656565376464612d343539382d343765652d313334322d3064376536373561633030392e706e67" alt="hide.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/1eee7dda-4598-47ee-1342-0d7e675ac009.png"></a></p>

<h2>
<span id="install" class="fragment"></span><a href="#install"><i class="fa fa-link"></i></a>Install</h2>

<p>Chrome ウェブストアからダウンロード出来ます。<br>
なお、作者はGitHubスター数世界一位のsindresorhus氏です。</p>

<p><a href="https://chrome.google.com/webstore/detail/hide-files-on-github/lpnakhpaodhdkleejaehlapdhbgjbddp" class="autolink" rel="nofollow noopener" target="_blank">https://chrome.google.com/webstore/detail/hide-files-on-github/lpnakhpaodhdkleejaehlapdhbgjbddp</a></p>

<p>GitHub <a href="https://github.com/sindresorhus/hide-files-on-github" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sindresorhus/hide-files-on-github</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />19位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/af81882fabf2728f2567">Babel Pluginを作成するときに有効な情報まとめ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-09-21 07:05:31</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[babel]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>まずは、thejameskyle先生のBabel Handbookに目を通すのがよいと思います。<br>
日本語訳は途中まで書かれているのがあります。<br>
<a href="https://github.com/thejameskyle/babel-handbook/blob/master/translations/en/plugin-handbook.md" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/thejameskyle/babel-handbook/blob/master/translations/en/plugin-handbook.md</a></p>

<p>ASTの確認はastexplorerを使うと非常に直感的に理解ができてよいです。<br>
<a href="https://astexplorer.net/" class="autolink" rel="nofollow noopener" target="_blank">https://astexplorer.net/</a></p>

<p>Babel Pluginのテストは、babel-plugin-testerを使うとよいです。<br>
snapshotテストで簡単にテストできます。<br>
<a href="https://github.com/babel-utils/babel-plugin-tester" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/babel-utils/babel-plugin-tester</a></p>

<p>また、consoleでASTを確認するのにbabel-logを使うと便利です。<br>
<a href="https://github.com/babel-utils/babel-log" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/babel-utils/babel-log</a></p>

<p>他の知見としては、BabelのレポジトリからFlowtypeの型定義ファイルを持ってくると開発がスムーズです。<br>
<a href="https://github.com/babel/babel/blob/7.0/lib/types.js" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/babel/babel/blob/7.0/lib/types.js</a></p>

<p>babel公式のAPIについてのドキュメントも必須です。<br>
こちらをにらめっこしながら書くことになると思います。<br>
しかし、コメントまわりなどの処理を書こうとするとここに載っていないAPIを使うことになり、Babelのコードの読みに行く必要があります。<br>
<a href="https://babeljs.io/docs/core-packages/babel-types/" class="autolink" rel="nofollow noopener" target="_blank">https://babeljs.io/docs/core-packages/babel-types/</a></p>

<h2>
<span id="tips" class="fragment"></span><a href="#tips"><i class="fa fa-link"></i></a>Tips</h2>

<p>Pluginを書いていてよくわからないエラーに遭遇した際、デバッカで追っても全然追えないことがあります。<br>
そのような場合は基本的にNodeとPathを取り違えているので、確認するとよいです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />20位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/da1bdcc1763f334ebeca">ramdaの関数合成によるデータとロジックの分離</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-10 08:53:59</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[ramda]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以下の記事を読みました。</p>

<p><strong><a href="https://qiita.com/tkynd/items/8ceb5c6461ac99a13908" id="reference-8826a35bc377e87c7bd9">Proxy "it": アローすら面倒な怠惰JavaScripterのための遅延評価</a></strong> </p>

<p><code>arg =&gt; arg</code>のアロー関数部分がスマートでないことをProxyで解決するのは非常に面白いです。</p>

<p>別のアプローチとして、同じ処理をramdaで関数合成を使って書いてみます。<br>
あまりramdaのヘビーユーザーではないので、間違っていたら教えて下さい。</p>

<p><a href="https://github.com/ramda/ramda" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ramda/ramda</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>yarn add ramda
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">R</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'ramda'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">R</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
  <span class="nx">R</span><span class="p">.</span><span class="nx">compose</span><span class="p">(</span>
    <span class="nx">R</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="nx">R</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">R</span><span class="p">.</span><span class="nx">compose</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">,</span> <span class="nx">R</span><span class="p">.</span><span class="nx">trim</span><span class="p">())),</span>
    <span class="nx">R</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">','</span><span class="p">),</span>
    <span class="nx">R</span><span class="p">.</span><span class="nx">prop</span><span class="p">(</span><span class="s1">'values'</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">values</span><span class="o">:</span> <span class="s1">'3,  1,   4, 1, 5'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">values</span><span class="o">:</span> <span class="s1">'2, 7, 1,   8, 2   '</span> <span class="p">},</span>
<span class="p">]</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="c1">// =&gt; [ 4, 1 ]</span>
</pre></div></div>

<p><code>args =&gt; args</code>のパターンはなく、データと処理も分離できました。<br>
型的にも扱いやすいです。<br>
少し冗長に感じるかも知れませんが、全てが関数で処理が分割可能なので、再利用性が高いです。<br>
まあ、ちょっと関数脳過ぎるので普段使いはしていませんけれど。</p>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>さらに他の手段としては、pipelineオペレータの仕様が入れば、こういったものをスマートに書くことができそうで楽しみです。</p>

<p><a href="https://github.com/tc39/proposal-pipeline-operator" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/tc39/proposal-pipeline-operator</a></p>

<blockquote class="twitter-tweet">
<p>ramdaのcomposeとpipeは言わずもがな便利で、R.pathや R.curryの便利さはわかるが、これをライブラリの依存にぶっこんでくるのはサイズ的に許しがたい <a href="https://t.co/8wUYV3S9Ad" rel="nofollow noopener" target="_blank">pic.twitter.com/8wUYV3S9Ad</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/905395683909263360?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">September 6, 2017</a>
</blockquote>



<blockquote class="twitter-tweet">
<p>coolではある。coolではあるが、混乱せず使えるユーザがいるかというと <a href="https://t.co/WNtTjYuxz0" rel="nofollow noopener" target="_blank">pic.twitter.com/WNtTjYuxz0</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/913723205759647745?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">September 29, 2017</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />21位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/da39c4ec15fa01a88a73">雑にJava9を試してみる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-26 14:10:31</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>適当にDockerを準備します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>FROM java:9
COPY . /usr/src/myapp
WORKDIR /usr/src/myapp
RUN javac Main.java
CMD ["java", "Main"]
</pre></div></div>

<p><code>takeWhile</code>が新しく導入されたようです。<br>
久々にJavaを触ったんですが、色々変わってて面白いですね。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.stream.Stream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
      <span class="o">.</span><span class="na">takeWhile</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">)</span>
      <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>実行します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ docker build -t my-java-app .
$ docker run -it --rm --name my-running-app my-java-app
1
2
3
4
</pre></div></div>

<p>よさそうですね。</p>

<p>jshellも試してみます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ docker run -it my-java-app jshell
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/a92e8fc963cb9501027ddf38f886b0a0dacb2a8d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30393461663262312d383232652d623161632d653431382d3338343438353230383839302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a92e8fc963cb9501027ddf38f886b0a0dacb2a8d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31353331392f30393461663262312d383232652d623161632d653431382d3338343438353230383839302e706e67" alt="スクリーンショット 2017-10-26 05.14.33.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/15319/094af2b1-822e-b1ac-e418-384485208890.png"></a></p>

<p>補完もされるし、すぐに試せていいですね。<br>
REPLがあるとやはり便利です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />22位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/33629ecd9740be1545a1">prettier環境に合ったeslint configを作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-19 19:42:19</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ESLint]</b> <b>[prettier]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="prettierとの組み合わせを考慮する" class="fragment"></span><a href="#prettier%E3%81%A8%E3%81%AE%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%82%92%E8%80%83%E6%85%AE%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>prettierとの組み合わせを考慮する</h2>

<p>現時点で、prettierを使わない理由がないので、スタイルに関するlintは全てprettierに寄せるのが基本方針です。</p>

<p>また、<code>prettier-eslint</code>を使う理由もないでしょう。<br>
以下は、<code>prettier-eslint</code>の作者のツイートですが、もう使っていないとのことです。</p>

<blockquote class="twitter-tweet">
<p>PSA: I'm no longer using prettier-eslint. I use raw prettier and disable all eslint style rules.<br><br>My life has been better ever since...</p>— Kent C. Dodds (@kentcdodds) <a href="https://twitter.com/kentcdodds/status/913760103118991361?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">2017年9月29日</a>
</blockquote>



<p>prettierのスタイルと重複しないようにするには、<code>eslint-config-prettier</code>に付属している<code>eslint-config-prettier-check</code>を使うとチェックできます。</p>

<p><a href="https://github.com/prettier/eslint-config-prettier#cli-helper-tool" rel="nofollow noopener" target="_blank">prettier/eslint-config-prettier: Turns off all rules that are unnecessary or might conflict with prettier.</a></p>

<p>上記のreadmeのように<code>package.json</code>に以下のように設定すると便利です。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span> <span class="s2">"eslint-check"</span><span class="o">:</span> <span class="s2">"eslint --print-config .eslintrc | eslint-config-prettier-check"</span><span class="p">,</span>
</pre></div></div>

<h2>
<span id="eslint-find-rulesで全てのlintのルールを網羅する" class="fragment"></span><a href="#eslint-find-rules%E3%81%A7%E5%85%A8%E3%81%A6%E3%81%AElint%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%AB%E3%82%92%E7%B6%B2%E7%BE%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>eslint-find-rulesで全てのlintのルールを網羅する</h2>

<p>eslintは開発が活発でどんどん新しいルールが追加されています。<br>
それは大変素晴らしいことですが、それ故に自分の知らないルールがいつの間にか追加されている可能性も高いです。<br>
この場合、eslint-find-rulesを使うと、設定してないルールが列挙されるので、便利です。</p>

<p><a href="https://github.com/sarbbottam/eslint-find-rules" rel="nofollow noopener" target="_blank">sarbbottam/eslint-find-rules: Find built-in ESLint rules you don't have in your custom config</a></p>

<h2>
<span id="参考レポ" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%83%AC%E3%83%9D"><i class="fa fa-link"></i></a>参考レポ</h2>

<p>自分のconfigは以下のようになっています。<br>
他のconfigをextendsせずに、全てのeslintの設定を全て確認して書いてます。<br>
この辺は、airbnbやstandard、xo、googleなどのconfigを継承して使ったほうが手軽で十分だと思います。</p>

<p><a href="https://github.com/akameco/eslint-config-precure" rel="nofollow noopener" target="_blank">akameco/eslint-config-precure</a></p>

<p>状況に応じてFlowやJest、Reactのconfigを切り替え可能にしています。<br>
デフォルトでは、一般的なconfigとimportに関する設定のみで、<code>precure/oss</code>とすれば<code>jest</code>と<code>flow</code>の設定が入ってきます。</p>

<div class="code-frame" data-lang="eslintrc"><div class="highlight"><pre><span></span>{
    "extends": "precure"
}
</pre></div></div>

<div class="code-frame" data-lang="eslintrc"><div class="highlight"><pre><span></span>{
    "extends": ["precure/oss"]
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />23位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/b78b11cea476cf642b75">reactv16のテストでWarning: React depends on requestAnimationFrameが出る場合</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-04 23:10:38</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[jest]</b> <b>[React]</b> <b>[create-react-app]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>react v16はrequestAnimationFrameを要求しますが、jestが使っているjsdom環境だとポイフィルが必要が必要です。<br>
まあ、一時的なハックで時間が解決すると思いますが。</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="err">Warning:</span> <span class="err">React</span> <span class="err">depends</span> <span class="err">on</span> <span class="err">requestAnimationFrame.</span> <span class="err">Make</span> <span class="err">sure</span> <span class="err">that</span> <span class="err">you</span> <span class="err">load</span> <span class="err">a</span> <span class="err">polyfill</span> <span class="err">in</span> <span class="err">older</span> <span class="err">browsers.</span> <span class="err">http://fb.me/react-polyfills</span>
</pre></div></div>

<h2>
<span id="jest" class="fragment"></span><a href="#jest"><i class="fa fa-link"></i></a>jest</h2>

<p>さて、素のjest環境だとjest.config.jsのsetupFileに以下を追加すればいいです。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">setupFiles</span><span class="o">:</span> <span class="p">[</span><span class="s1">'raf/polyfill'</span><span class="p">],</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="create-react-app環境" class="fragment"></span><a href="#create-react-app%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>create-react-app環境</h2>

<p>create-react-app(CRA)だと、jestの設定をそのままいじれないので少しハックは必要です。</p>

<p><code>src</code>以下に以下のような<code>setupTest.js</code>を配置します。<br>
どうせ使うと思うので、enzymeの設定も乗せておきます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">raf</span> <span class="nx">from</span> <span class="s1">'./tempPolyfills'</span>
<span class="kr">import</span> <span class="nx">Enzyme</span> <span class="nx">from</span> <span class="s1">'enzyme'</span>
<span class="kr">import</span> <span class="nx">Adapter</span> <span class="nx">from</span> <span class="s1">'enzyme-adapter-react-16'</span>

<span class="nx">Enzyme</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span> <span class="nx">adapter</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Adapter</span><span class="p">()</span> <span class="p">})</span>
</pre></div></div>

<p>同じ階層に<code>tempPolyfills.js</code>を容易します。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">raf</span> <span class="o">=</span> <span class="p">(</span><span class="nx">global</span><span class="p">.</span><span class="nx">requestAnimationFrame</span> <span class="o">=</span> <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">raf</span>
</pre></div></div>

<p>これでエラーが解消されるはずです。</p>

<h2>
<span id="関連" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3"><i class="fa fa-link"></i></a>関連</h2>

<p>Reactやreduxのアプリケーションを高速に構築する記事をいくつかあげているのでよかったら確認してください。</p>

<p><a href="https://qiita.com/akameco/items/e1489c6bbf3439ec6ca4" id="reference-f3993b539cd85d419196"><strong>さよならボイラープレート。s2sによる高速reduxアプリケーション構築</strong></a></p>

<p><a href="https://camo.qiitausercontent.com/17aaa035f67e5077867c92c64ea32eee53c42338/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f616b616d65636f2f7332732d6578616d706c65732f6d61737465722f6d656469612f64656d6f2e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/17aaa035f67e5077867c92c64ea32eee53c42338/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f616b616d65636f2f7332732d6578616d706c65732f6d61737465722f6d656469612f64656d6f2e676966" alt="demo.gif (1072×586)" data-canonical-src="https://raw.githubusercontent.com/akameco/s2s-examples/master/media/demo.gif"></a></p>

<p><strong>s2s: reduxにおけるreducerのテスト。あなたがテストを書く必要はないかも知れない</strong><br>
<a href="https://qiita.com/akameco/items/66a2232df0e95e5bfe31" id="reference-6c14322bc1cde6d5e682">https://qiita.com/akameco/items/66a2232df0e95e5bfe31</a></p>

<p><strong>flowtypeのactionの型付け。String Literal型とString型について</strong><br>
<a href="https://qiita.com/akameco/items/e7021e22da4c9e14463a" class="autolink" id="reference-de5b976d6973587d3740">https://qiita.com/akameco/items/e7021e22da4c9e14463a</a></p>

<p><strong>Flowtype+reduxにおけるreducerの正しい型付け</strong><br>
<a href="https://qiita.com/akameco/items/fe7ba22c158a2593b077" class="autolink" id="reference-880b3a68a2f56aad4fbb">https://qiita.com/akameco/items/fe7ba22c158a2593b077</a></p>

<p>なんかあればコメント欄またはtwitterまでどうぞ。</p>

<blockquote class="twitter-tweet">
<p>s2sを使ったreducerのテストケースの生成。コードを書くとき、そこにテストはある <a href="https://t.co/FISlpWrpOe" rel="nofollow noopener" target="_blank">https://t.co/FISlpWrpOe</a> <a href="https://t.co/8CNWHhOQwL" rel="nofollow noopener" target="_blank">pic.twitter.com/8CNWHhOQwL</a></p>— 無職.js (@akameco) <a href="https://twitter.com/akameco/status/914804233395896320?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">October 2, 2017</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />24位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/c540693df312a4274791">テストのためのクラス名をプロダクションビルドで除去する [react,jsx]</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-21 00:06:49</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[test]</b> <b>[JSX]</b> <b>[AST]</b> <b>[React]</b> <b>[babel]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="テストのためのクラス名をプロダクションビルドで除去する-reactjsx" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%B9%E5%90%8D%E3%82%92%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%93%E3%83%AB%E3%83%89%E3%81%A7%E9%99%A4%E5%8E%BB%E3%81%99%E3%82%8B-reactjsx"><i class="fa fa-link"></i></a>テストのためのクラス名をプロダクションビルドで除去する [react,jsx]</h2>

<p><a href="https://qiita.com/akameco/items/519f7e4d5442b2a9d2da" id="reference-faa9476f0f44eee1c8ad"><strong>idやclassを使ってテストを書くのは、もはやアンチパターンである</strong></a></p>

<p>上記の記事を書いたところ、様々な反応があり非常に勉強になりました。</p>

<p>中でも気になったのが、class名に規約を設け、<code>test-</code>というプレフィックスを付けるものです。<br>
個人的には、カスタムデータ属性の方が分離する際の見通しが良く、またCSSinJSにも適用できるのでこちらを推しますが、チーム内で共通の理解がある場合は、クラス名で制約を付けるのは良い解決作だと思います😆<br>
さらに言えば、この問題の本質は、いかにチーム内で同意が得られるかに尽きます(data-testを書いたところで共通認識がなければ意味がないですから)</p>

<p>さて、class名のよる<code>test-</code>プレフィックスについて、ちょっと見たところプロダクション時に取り除くプラグインはないようでした。</p>

<p>なのでちょっと作ってみました。</p>

<p><a href="https://github.com/akameco/babel-plugin-react-remove-classname" rel="nofollow noopener" target="_blank">akameco/babel-plugin-react-remove-classname</a></p>

<h3>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ yarn add --dev babel-plugin-react-remove-classname
</pre></div></div>

<p>以下にように<code>test-</code>と付いたクラスを削除します。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"test-a hello test-b"</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;</span>
<span class="p">)</span>

      <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span> <span class="err">↓</span>

<span class="kr">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"hello"</span><span class="o">&gt;&lt;</span><span class="err">/div&gt;;</span>
<span class="p">)</span>
</pre></div></div>

<p>data-testのプラグイン同様にプロダクション時に有効にするといいと思います。</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"env"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"production"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"plugins"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"react-remove-classname"</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>日々よりよい手法について考えを深めていきたいものです。<br>
何か議論があれば、コメント欄またはツイッターで議論しましょう。(ブコメでもいいですが、反応しずらいので、同時に呟いてくれると助かります🙆‍♂️)</p>

<p>なお、基本的にツイートには全て反応し、随時記事を更新したいと考えいますので、ご協力よろしくお願いします🙇また、前回の記事についてツイッターで議論して下さった方どうもありがとうございました。</p>

<h2>
<span id="おまけ" class="fragment"></span><a href="#%E3%81%8A%E3%81%BE%E3%81%91"><i class="fa fa-link"></i></a>おまけ</h2>

<p>上記のプラグインはAtomのteletypeを使ってライブコーディングで作りました。<br>
見てくださった方ありがとうございました🙇<br>
楽しかったです😆</p>

<blockquote class="twitter-tweet">
<p>今から30分ぐらいバベルプラグインを書こうと思うんですが、Atomのshare貼っておくので暇な人は入ってどうぞ。適当に書くので進捗なくてもご容赦を c7640696-4ec3-4d64-abe2-c23304d10e0f</p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/932545915516108800?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 20, 2017</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />25位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/b8552e02bb57b884fcea">...await: 配列の中でawaitを使い非同期処理をする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-11 21:01:51</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[非同期]</b> <b>[await]</b> <b>[...await]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>早速ですが、以下のコードを見てください。(LTSであるv8.9.1で動作確認済)</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="kr">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">await</span> <span class="nx">fn</span><span class="p">(),</span> <span class="p">...</span><span class="nx">await</span> <span class="nx">fn</span><span class="p">()]</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span>
  <span class="c1">// [1, 2, 3, 1, 2, 3]</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">()</span>
</pre></div></div>

<p>配列の中でawaitとして得た配列をを<code>...</code>で展開しています。<br>
<code>...await</code>なんて実際出番ないだろと思うかも知れませんが、<code>GoogleChrome/puppeteer</code>でも使われています。</p>

<p>さて、伝えたいことはこれだけですが、それではアレなので、async/catchと一緒に使ってみましょう。</p>

<p><code>async/catch</code>については、以下の記事を参照して下さい。</p>

<p><a href="https://qiita.com/akameco/items/cc73afcdb5ac5d0774bc" id="reference-06d86a4a939e5122ee56">async関数においてtry/catchではなくawait/catchパターンを活用する</a></p>

<p>さて、配列を返す関数をランダムでエラーを起こすようにしてみます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span>
  <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
    <span class="o">?</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="o">:</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'hello from array!!!'</span><span class="p">))</span>

<span class="kr">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">...(</span><span class="nx">await</span> <span class="nx">fn</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">[])),</span>
    <span class="p">...(</span><span class="nx">await</span> <span class="nx">fn</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">[]))</span>
  <span class="p">]</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span>
  <span class="c1">// =&gt; []</span>
  <span class="c1">// or =&gt; [1, 2, 3]</span>
  <span class="c1">// or =&gt; [1, 2, 3, 1, 2, 3]</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">()</span>
</pre></div></div>

<p><code>[]</code>か<code>[1,2,3]</code>か<code>[1,2,3,1,2,3]</code>と配列の中で非同期のエラー処理が出来ます。</p>

<p>少し邪悪にしてみます。awaitはthenも待てるので、普通に非同期な処理を配列の中で書くことが出来ます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span>
  <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
    <span class="o">?</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="o">:</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'hello from array!!!'</span><span class="p">))</span>

<span class="kr">const</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">add1</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="nx">fn</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span>

  <span class="kr">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">...(</span><span class="nx">await</span> <span class="nx">fn</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span> <span class="o">||</span> <span class="p">[])),</span>
    <span class="p">...(</span><span class="nx">await</span> <span class="nx">fn</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">map</span><span class="p">(</span><span class="nx">add1</span><span class="p">))</span>
      <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">[]))</span>
  <span class="p">]</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span>
  <span class="c1">// =&gt; hello from array!!!</span>
  <span class="c1">// =&gt; [ 2, 3, 4 ]</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">()</span>
</pre></div></div>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p><code>...await</code>の利用シーンは限られている気はしますが、何か面白い使い方ができたらいいですね。<br>
何かあればコメント欄またはツイッターまでお願いします。</p>

<blockquote class="twitter-tweet">
<p>...await <a href="https://t.co/ChYtTta1BX" rel="nofollow noopener" target="_blank">pic.twitter.com/ChYtTta1BX</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/928727301474234369?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 9, 2017</a>
</blockquote>

<blockquote class="twitter-tweet">
<p>...await/catch 🤔 <a href="https://t.co/yxKj5KLvmp" rel="nofollow noopener" target="_blank">pic.twitter.com/yxKj5KLvmp</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/928764816101056512?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 9, 2017</a>
</blockquote>

<blockquote class="twitter-tweet">
<p>とんでもない邪悪が産まれた ...await with async/catch <a href="https://t.co/W8ADwDNUq9" rel="nofollow noopener" target="_blank">pic.twitter.com/W8ADwDNUq9</a></p>— あかめ@無職.js (@akameco) <a href="https://twitter.com/akameco/status/928783476513312769?ref_src=twsrc%5Etfw" rel="nofollow noopener" target="_blank">November 10, 2017</a>
</blockquote>


</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />26位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/9f0d8b3ef1a4de4ba7bc">yeomanを使ってBabel Pluginを書く環境を1コマンドで構築する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-11-02 22:37:10</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[yeoman]</b> <b>[babel]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>個人的には、環境構築が一瞬で出来るのでyeoman好きなのだけど界隈ではすでに廃れてものとして扱われています。<br>
が、実際便利なので、今回はそのYeomanを使ってBabelPlugin環境構築を構築します。</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ npm install --global yo @akameco/generator-babel
</pre></div></div>

<p><a href="https://github.com/akameco/generator-babel" rel="nofollow noopener" target="_blank"><strong>akameco/generator-babel</strong><br> Scaffold out a Babel Plugin</a></p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir babel-plugin-for-me
$ cd babel-plugin-for-me
$ yo
</pre></div></div>

<p>yoを叩くと、インタラクティブにジェネレーターを選択できるので、<code>@akameco/babel</code>を選んでください。</p>

<p>これだけで、BabelPluginの雛形とテスト環境の完成です。<br>
他には、floweslint,flow,prettier,jestなどの設定やBabelのビルド設定も終わっているので、あとは、コードを書くだけです。</p>

<p>おっと、publishする際にはpackage.jsonから<a href="/akameco" class="user-mention js-hovercard" title="akameco" data-hovercard-target-type="user" data-hovercard-target-name="akameco">@akameco</a>から自分の名前に変更してくださいね。</p>

<h2>
<span id="フォーク" class="fragment"></span><a href="#%E3%83%95%E3%82%A9%E3%83%BC%E3%82%AF"><i class="fa fa-link"></i></a>フォーク</h2>

<p>もしかすると、構成が気に食わないかも知れません。<br>
その場合は、フォークして変更してください。</p>

<p><a href="https://github.com/akameco/generator-babel" rel="nofollow noopener" target="_blank"><strong>akameco/generator-babel</strong><br> Scaffold out a Babel Plugin</a></p>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>yoを使ってBabel Pluginの作成環境を構築する方法を紹介しました。<br>
Babel Pluginがもっと増えるといいですね。</p>

<p>簡単なプラグインはいくつかQiitaで紹介しています。<br>
参考にしてください。</p>

<p>面接でFizzBuzzを書けと言われたときにすべきこと<br>
<a href="https://qiita.com/akameco/items/d2851fd4868f833c8040" class="autolink" id="reference-009777d13139d0e7a9b7">https://qiita.com/akameco/items/d2851fd4868f833c8040</a></p>

<p>JavaScriptのfloatで正確な比較を行う<br>
<a href="https://qiita.com/akameco/items/019e1a0875ad236e859c" class="autolink" id="reference-4208489eb6715520e824">https://qiita.com/akameco/items/019e1a0875ad236e859c</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>akamecoさんの<br />27位</center></td>
	<td colspan="4">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/akameco/items/51ba5ed02b5d47128738">モノレポ運用時のexamplesの参照</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2017-10-22 22:25:41</center>
	</td>
	<td style="width:200px;">
		@akameco<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/15319/profile-images/1473684249">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[lerna]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>lernaを使い、モノレポを運用時にexamples以下もそれぞれのpackageのバージョンに縛られずに運用できると便利です。<br>
lernaの機能で何かできないかと思いましたが、ありませんでした。</p>

<p>しかし、よくよく考えてみるとpackage.jsonのdependencisは<code>file</code>という書き方で相対パスでパッケージを指定出来ます。</p>

<p><a href="https://docs.npmjs.com/files/package.json#dependencies" class="autolink" rel="nofollow noopener" target="_blank">https://docs.npmjs.com/files/package.json#dependencies</a></p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span> 
    <span class="nt">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"foo"</span><span class="p">:</span> <span class="s2">"file:../../pkgs/foo"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>ですので、examples以下が開発中のパッケージを参照するときは、上記のように対応することにしました。</p>

<p>参考までに、今開発しているs2sでは以下のように書いています。</p>

<p><a href="https://github.com/akameco/s2s-plugins/blob/master/examples/shopping-cart/package.json#L27" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/akameco/s2s-plugins/blob/master/examples/shopping-cart/package.json#L27</a></p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span>  <span class="s2">"devDependencies"</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">"enzyme"</span><span class="p">:</span> <span class="s2">"^3.0.0"</span><span class="p">,</span>
    <span class="nt">"enzyme-adapter-react-16"</span><span class="p">:</span> <span class="s2">"^1.0.2"</span><span class="p">,</span>
    <span class="nt">"enzyme-to-json"</span><span class="p">:</span> <span class="s2">"^3.1.4"</span><span class="p">,</span>
    <span class="nt">"flow-bin"</span><span class="p">:</span> <span class="s2">"^0.57.3"</span><span class="p">,</span>
    <span class="nt">"react-test-renderer"</span><span class="p">:</span> <span class="s2">"^16.0.0"</span><span class="p">,</span>
    <span class="nt">"s2s"</span><span class="p">:</span> <span class="s2">"*"</span><span class="p">,</span>
    <span class="nt">"s2s-plugins-redux"</span><span class="p">:</span> <span class="s2">"file:../../packages/s2s-plugins-redux"</span>
  <span class="p">}</span>
<span class="err">}</span>
</pre></div></div>

<p>ここまで書いて思いましたが、別にモノレポに限った話ではないですね。<br>
やや、モノレポそのものに惑わされた感じがします。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
