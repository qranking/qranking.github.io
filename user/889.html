<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (suin)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (suin さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4309</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/f570f057a0ff927b47dc">【まとめ】これ知らないプログラマって損してんなって思う汎用的なツール 100超</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-02-08 23:42:02</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Python]</b> <b>[PHP]</b> <b>[HTML]</b> <b>[JavaScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://qiita.com/puriketu99/items/f75d42f1ff669b924ec1" id="reference-9c1df87e823c122101fe">これ知らないプログラマって損してんなって思う汎用的なツール</a>のコメントに寄せられたツールを分類分けしてみました。</p>

<ul>
<li>解説は、ほぼコメントに寄せられた内容のコピペです。</li>
<li>URLのみの記述は公式サイト(か、ほぼ公式サイトと化しているサイト)</li>
<li>公式サイトとは別に、ページタイトルだけでツールを説明しきっているページへのリンクも付けておきました。類似ページが複数ある場合は、はてブのブックマーク数が多いものを選びました。</li>
<li>知らないツールもあるので、分類がいいかげんなところもあると思います。何か気づいたらコメントください。</li>
<li>解説が不十分なツールについても、補足（コピペで本文に取り込める体裁だとありがたい）を頂けると助かります！</li>
<li>元ネタの投稿は現在進行形なので、随時取り込んでいきたいと思います。</li>
</ul>

<hr>

<h1>
<span id="エディタ" class="fragment"></span><a href="#%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF"><i class="fa fa-link"></i></a>エディタ</h1>

<h3>
<span id="vim" class="fragment"></span><a href="#vim"><i class="fa fa-link"></i></a>vim</h3>

<p>自分はVimmerなんで、Vimを推しておきます。Vimがあれば大抵の事が出来ると思ってます。<br>
が、Vimは習得に時間がかかるという難点があります。</p>

<p>エディタプラグイン</p>

<ul>
<li>neocomplcache.vim</li>
<li>quickrun.vim</li>
<li>vimproc + quickrun</li>
<li>unite.vim</li>
</ul>

<h3>
<span id="macvim" class="fragment"></span><a href="#macvim"><i class="fa fa-link"></i></a>MacVim</h3>

<h3>
<span id="emacs" class="fragment"></span><a href="#emacs"><i class="fa fa-link"></i></a>Emacs</h3>

<p>VIM, Emacs は別格って感じですね・・・</p>

<p>エディタプラグイン</p>

<ul>
<li>anything.el</li>
</ul>

<h3>
<span id="cocoaemacs" class="fragment"></span><a href="#cocoaemacs"><i class="fa fa-link"></i></a>CocoaEmacs</h3>

<h3>
<span id="mou" class="fragment"></span><a href="#mou"><i class="fa fa-link"></i></a>Mou</h3>

<p>Markdownを書くためのエディタ。</p>

<ul>
<li><a href="http://mouapp.com/" class="autolink" rel="nofollow noopener" target="_blank">http://mouapp.com/</a></li>
<li><a href="http://veadardiary.blog29.fc2.com/blog-entry-3492.html" rel="nofollow noopener" target="_blank"> リアルタイムプレビューができるMarkdownエディタ『Mou』 | Macの手書き説明書</a></li>
</ul>

<h3>
<span id="sublime-text-3" class="fragment"></span><a href="#sublime-text-3"><i class="fa fa-link"></i></a>Sublime Text 3</h3>

<p><a href="https://sublimetext.com/3" class="autolink" rel="nofollow noopener" target="_blank">https://sublimetext.com/3</a></p>

<h3>
<span id="coteditor" class="fragment"></span><a href="#coteditor"><i class="fa fa-link"></i></a>CotEditor</h3>

<p>フリー。超軽量なエディター。<br>
簡単な文章修正とかに向いてる。</p>

<h3>
<span id="coda" class="fragment"></span><a href="#coda"><i class="fa fa-link"></i></a>Coda</h3>

<p><a href="https://panic.com/jp/coda/" class="autolink" rel="nofollow noopener" target="_blank">https://panic.com/jp/coda/</a><br>
シェア。エディター＋IDE的な感じ。デザインを確認しながら編集できる。FTPやSSHとかSVNとかも同梱されていてデザイナーはこれで十分。</p>

<h3>
<span id="textwrangler" class="fragment"></span><a href="#textwrangler"><i class="fa fa-link"></i></a>TextWrangler</h3>

<p><a href="https://itunes.apple.com/jp/app/textwrangler/id404010395" class="autolink" rel="nofollow noopener" target="_blank">https://itunes.apple.com/jp/app/textwrangler/id404010395</a></p>

<h3>
<span id="espresso" class="fragment"></span><a href="#espresso"><i class="fa fa-link"></i></a>Espresso</h3>

<p><a href="http://espressoapp.com/" class="autolink" rel="nofollow noopener" target="_blank">http://espressoapp.com/</a><br>
Espresso はリアルタイムでCSSをプレビューしながら書けたりするエディタ。</p>

<h3>
<span id="json-editor" class="fragment"></span><a href="#json-editor"><i class="fa fa-link"></i></a>JSON Editor</h3>

<p>サクっとJSONを整形してくれる</p>

<hr>

<h1>
<span id="ide統合開発環境" class="fragment"></span><a href="#ide%E7%B5%B1%E5%90%88%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>IDE(統合開発環境)</h1>

<h3>
<span id="xcode" class="fragment"></span><a href="#xcode"><i class="fa fa-link"></i></a>Xcode</h3>

<p>iPhoneアプリを開発する気がなくても入れておくと、差分を簡単に扱えるFileMergeアプリやopendiffコマンドなどおまけが付いてくるのでオススメ</p>

<ul>
<li><a href="https://developer.apple.com/xcode/" class="autolink" rel="nofollow noopener" target="_blank">https://developer.apple.com/xcode/</a></li>
</ul>

<h3>
<span id="eclipse" class="fragment"></span><a href="#eclipse"><i class="fa fa-link"></i></a>Eclipse</h3>

<p>Eclipse とか NetBeans とかもとりあえず使ってみる派。で、どっちがいいというのを決めるより「これは何が優れているか」をみて、シーンによって起動するのを変えてしまう。</p>

<ul>
<li><a href="http://www.eclipse.org/" class="autolink" rel="nofollow noopener" target="_blank">http://www.eclipse.org/</a></li>
</ul>

<h3>
<span id="netbeans" class="fragment"></span><a href="#netbeans"><i class="fa fa-link"></i></a>NetBeans</h3>

<p>Eclipse とか NetBeans とかもとりあえず使ってみる派。で、どっちがいいというのを決めるより「これは何が優れているか」をみて、シーンによって起動するのを変えてしまう。</p>

<ul>
<li><a href="http://ja.netbeans.org/" class="autolink" rel="nofollow noopener" target="_blank">http://ja.netbeans.org/</a></li>
</ul>

<h3>
<span id="phpstrom" class="fragment"></span><a href="#phpstrom"><i class="fa fa-link"></i></a>PhpStrom</h3>

<p>PHPやJavaScriptをはじめとしたウェブ向けのIDE。</p>

<ul>
<li><a href="http://www.jetbrains.com/phpstorm/" class="autolink" rel="nofollow noopener" target="_blank">http://www.jetbrains.com/phpstorm/</a></li>
<li><a href="http://havelog.ayumusato.com/computer/software/e173-phpstorm-best-ide.html" rel="nofollow noopener" target="_blank">最強のJavaScript IDE「WebStorm」の姉妹品「PhpStorm」はPHP IDEとして最高だった ::ハブろぐ</a></li>
</ul>

<h3>
<span id="cloud9" class="fragment"></span><a href="#cloud9"><i class="fa fa-link"></i></a>Cloud9</h3>

<p>まだ荒削りだけど、ブラウザで実行できるIDE。GitHubやBitbucketなんかと連動。</p>

<ul>
<li><a href="http://c9.io/" class="autolink" rel="nofollow noopener" target="_blank">http://c9.io/</a></li>
</ul>

<h3>
<span id="webstorm" class="fragment"></span><a href="#webstorm"><i class="fa fa-link"></i></a>WebStorm</h3>

<p>現行のIDEの中ではJavaScript回りの環境が最強。姉妹品のPHPStormも評判良いです。<br>
リファクタとか超簡単に出来たりします。が、有料です。その価値はあると思いますけど…。</p>

<ul>
<li><a href="http://www.jetbrains.com/webstorm/index.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.jetbrains.com/webstorm/index.html</a></li>
<li><a href="http://efcl.info/2010/1027/res2023/" rel="nofollow noopener" target="_blank">最強のJavaScript IDE 「WebStorm」を使ってみた</a></li>
</ul>

<h3>
<span id="nide" class="fragment"></span><a href="#nide"><i class="fa fa-link"></i></a>Nide</h3>

<p>node.jsのIDE</p>

<ul>
<li><a href="http://coreh.github.com/nide/" class="autolink" rel="nofollow noopener" target="_blank">http://coreh.github.com/nide/</a></li>
<li><a href="http://sourceforge.jp/magazine/12/01/17/080233" rel="nofollow noopener" target="_blank">Node.js向けのWebベースIDE「Nide 0.2」がリリース - SourceForge.JP Magazine : オープンソースの話題満載</a></li>
</ul>

<hr>

<h1>
<span id="sql-db" class="fragment"></span><a href="#sql-db"><i class="fa fa-link"></i></a>SQL, DB</h1>

<h3>
<span id="sequel-pro" class="fragment"></span><a href="#sequel-pro"><i class="fa fa-link"></i></a>Sequel Pro</h3>

<p>MySQLクライアント。phpMyAdminがいらなくなりました。</p>

<ul>
<li><a href="http://www.sequelpro.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.sequelpro.com/</a></li>
<li><a href="http://www.moongift.jp/2008/06/sequel_pro/" rel="nofollow noopener" target="_blank">高機能なMySQLフロントエンド「Sequel Pro」 - MOONGIFT</a></li>
</ul>

<h3>
<span id="navicat" class="fragment"></span><a href="#navicat"><i class="fa fa-link"></i></a>Navicat</h3>

<p>MySQLクライアント。</p>

<ul>
<li><a href="http://www.navicat.jp/" class="autolink" rel="nofollow noopener" target="_blank">http://www.navicat.jp/</a></li>
<li><a href="http://www.moongift.jp/2008/02/navicat_for_mysql_lite/" rel="nofollow noopener" target="_blank">便利なGUIのMySQLフロントエンド「Navicat for MySQL Lite」 - MOONGIFT</a></li>
</ul>

<h3>
<span id="mysqlworkbench" class="fragment"></span><a href="#mysqlworkbench"><i class="fa fa-link"></i></a>MySQLWorkbench</h3>

<p>MySQLのクライアントは MySQLWorkbench を使っています。<br>
EER図も描けるからデータベースの設計にも使える。</p>

<ul>
<li><a href="http://www-jp.mysql.com/products/workbench/" class="autolink" rel="nofollow noopener" target="_blank">http://www-jp.mysql.com/products/workbench/</a></li>
</ul>

<h3>
<span id="heidisql" class="fragment"></span><a href="#heidisql"><i class="fa fa-link"></i></a>HeidiSQL</h3>

<p>Windows向けMySQLのクライアントですが、HeidiSQL<br>
JDBC/ODBC等なしにこれ単体で接続でき、スプレッドシートを順次開いていくかたちでのブラウジングができる。<br>
そのため、「実際にDBのデータを見ながらデータをいじる」というのが直感的にでき、非常に便利。<br>
SSHトンネル接続や、サーバ間のデータダンプ＆リストアもできるため、運用作業はだいたいこれで完結できる。<br>
ただ、若干不安定なので、ミッションクリティカルな作業には向いてないかも。<br>
（そういうのはサーバ上でやれよ、と言われそうですが…）</p>

<ul>
<li><a href="http://www.heidisql.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.heidisql.com/</a></li>
</ul>

<h3>
<span id="adminer" class="fragment"></span><a href="#adminer"><i class="fa fa-link"></i></a>adminer</h3>

<p>phpMyAdminと同じくブラウザベースのDBクライアント。<br>
1ファイルでphpが動く環境ならOK、なにより軽いから重宝してる。<br>
MySQL,PostgreSQL, SQLite, MS SQL,Oracleと意外に相手を問わないのになぜかマイナーなんだよな～。</p>

<ul>
<li><a href="http://www.adminer.org/" class="autolink" rel="nofollow noopener" target="_blank">http://www.adminer.org/</a></li>
</ul>

<h3>
<span id="sqleditor" class="fragment"></span><a href="#sqleditor"><i class="fa fa-link"></i></a>SQLEditor</h3>

<p>ER図作成ツール。生SQLやActiveRecord Modelを書き出せる</p>

<h3>
<span id="baseapp" class="fragment"></span><a href="#baseapp"><i class="fa fa-link"></i></a>Base.app</h3>

<p>SQlite用GUI管理ツール</p>

<h3>
<span id="ermaster" class="fragment"></span><a href="#ermaster"><i class="fa fa-link"></i></a>ERMaster</h3>

<p>DB管理ツール。<br>
EclipseのプラグインですがDB管理＋ドキュメント化が非常に楽になります。</p>

<h3>
<span id="the-sqlite-sorcerer" class="fragment"></span><a href="#the-sqlite-sorcerer"><i class="fa fa-link"></i></a>The SQLite Sorcerer</h3>

<p>SQLite用のクライアント。AIR製。</p>

<ul>
<li><a href="http://afoucal.free.fr/index.php/applications/sqlite-sorcerer/" class="autolink" rel="nofollow noopener" target="_blank">http://afoucal.free.fr/index.php/applications/sqlite-sorcerer/</a></li>
</ul>

<hr>

<h1>
<span id="php" class="fragment"></span><a href="#php"><i class="fa fa-link"></i></a>PHP</h1>

<h3>
<span id="mamp" class="fragment"></span><a href="#mamp"><i class="fa fa-link"></i></a>MAMP</h3>

<ul>
<li><a href="http://www.mamp.info/en/index.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.mamp.info/en/index.html</a></li>
</ul>

<h3>
<span id="xhprof" class="fragment"></span><a href="#xhprof"><i class="fa fa-link"></i></a>xhprof</h3>

<p>php で書かれたWebアプリケーションのボトルネック調査に必須</p>

<h3>
<span id="xdebug" class="fragment"></span><a href="#xdebug"><i class="fa fa-link"></i></a>xdebug</h3>

<h3>
<span id="phpunit" class="fragment"></span><a href="#phpunit"><i class="fa fa-link"></i></a>PHPUnit</h3>

<p>使えるテストフレームワークがこれしかない…</p>

<h3>
<span id="phing" class="fragment"></span><a href="#phing"><i class="fa fa-link"></i></a>Phing</h3>

<p>php のビルドツール，テスト環境や本番などの環境ごとのブートストラップ指定や，結合テストの設定に</p>

<hr>

<h1>
<span id="ruby" class="fragment"></span><a href="#ruby"><i class="fa fa-link"></i></a>Ruby</h1>

<h3>
<span id="travisci" class="fragment"></span><a href="#travisci"><i class="fa fa-link"></i></a>travisCI</h3>

<p>継続インテグレーション</p>

<h3>
<span id="bundler" class="fragment"></span><a href="#bundler"><i class="fa fa-link"></i></a>bundler</h3>

<p>アプリケーション毎に必要な Gem を管理できる．デプロイ先の構築に便利</p>

<h3>
<span id="capistrano" class="fragment"></span><a href="#capistrano"><i class="fa fa-link"></i></a>Capistrano</h3>

<p>デプロイツール，PHP とか他の言語で書かれたアプリケーションも設定次第でこれでデプロイできる</p>

<h3>
<span id="pry" class="fragment"></span><a href="#pry"><i class="fa fa-link"></i></a>Pry</h3>

<p>irb から乗り換えた</p>

<h3>
<span id="watchr" class="fragment"></span><a href="#watchr"><i class="fa fa-link"></i></a>watchr</h3>

<h3>
<span id="guard" class="fragment"></span><a href="#guard"><i class="fa fa-link"></i></a>guard</h3>

<h3>
<span id="gist" class="fragment"></span><a href="#gist"><i class="fa fa-link"></i></a>gist</h3>

<hr>

<h1>
<span id="java" class="fragment"></span><a href="#java"><i class="fa fa-link"></i></a>Java</h1>

<p>JavaDecompiler</p>

<hr>

<h1>
<span id="javascript" class="fragment"></span><a href="#javascript"><i class="fa fa-link"></i></a>JavaScript</h1>

<h3>
<span id="nodejs" class="fragment"></span><a href="#nodejs"><i class="fa fa-link"></i></a>node.js</h3>

<p>JavaScriptの対話実行環境 とにかく速くJSの動作をチェックしたい時に便利</p>

<ul>
<li><a href="http://nodejs.org/" class="autolink" rel="nofollow noopener" target="_blank">http://nodejs.org/</a></li>
<li><a href="http://www.atmarkit.co.jp/fwcr/rensai2/nodejs01/01.html" rel="nofollow noopener" target="_blank">サーバサイドJavaScriptの本命「Node.js」の基礎知識（1/3）- ＠IT</a></li>
</ul>

<h3>
<span id="spidermonkey" class="fragment"></span><a href="#spidermonkey"><i class="fa fa-link"></i></a>SpiderMonkey</h3>

<p>JavaScriptの対話実行環境 とにかく速くJSの動作をチェックしたい時に便利</p>

<ul>
<li><a href="https://developer.mozilla.org/ja/SpiderMonkey" class="autolink" rel="nofollow noopener" target="_blank">https://developer.mozilla.org/ja/SpiderMonkey</a></li>
</ul>

<h3>
<span id="ringojs" class="fragment"></span><a href="#ringojs"><i class="fa fa-link"></i></a>ringo.js</h3>

<p>JavaScriptの対話実行環境 とにかく速くJSの動作をチェックしたい時に便利</p>

<ul>
<li><a href="http://ringojs.org/" class="autolink" rel="nofollow noopener" target="_blank">http://ringojs.org/</a></li>
</ul>

<h3>
<span id="jsperf" class="fragment"></span><a href="#jsperf"><i class="fa fa-link"></i></a>jsPerf</h3>

<p>JavaScriptのベンチマーク取れるサイト。jsのベンチマークをとって公開するのに便利。</p>

<ul>
<li><a href="http://jsperf.com/" class="autolink" rel="nofollow noopener" target="_blank">http://jsperf.com/</a></li>
</ul>

<h3>
<span id="jsfiddle" class="fragment"></span><a href="#jsfiddle"><i class="fa fa-link"></i></a>jsFiddle</h3>

<p>ブラウザ内でJavaScriptの実行・HTML/CSSのマークアップなんかが試せる</p>

<ul>
<li><a href="http://jsfiddle.net/" class="autolink" rel="nofollow noopener" target="_blank">http://jsfiddle.net/</a></li>
</ul>

<h3>
<span id="google-closure-compiler" class="fragment"></span><a href="#google-closure-compiler"><i class="fa fa-link"></i></a>Google Closure Compiler</h3>

<p>JavaScriptをミニファイすることがあれば、Google Closure Compiler</p>

<ul>
<li><a href="http://code.google.com/p/closure-compiler/" class="autolink" rel="nofollow noopener" target="_blank">http://code.google.com/p/closure-compiler/</a></li>
<li><a href="http://www.moongift.jp/2009/11/closure-compiler/" rel="nofollow noopener" target="_blank">Google製JavaScript最適化ツール「Closure Compiler」 - MOONGIFT</a></li>
</ul>

<h3>
<span id="yui-compressor" class="fragment"></span><a href="#yui-compressor"><i class="fa fa-link"></i></a>YUI Compressor</h3>

<p>JavaScriptもCSSもミニファイすることがあれば、YUI Compressor</p>

<ul>
<li><a href="http://developer.yahoo.com/yui/compressor/" class="autolink" rel="nofollow noopener" target="_blank">http://developer.yahoo.com/yui/compressor/</a></li>
<li><a href="http://d.hatena.ne.jp/cos31/20080116/1200504657" rel="nofollow noopener" target="_blank">YUI Compressorで簡単にjavascriptとCSSを圧縮 - Affirmative Way</a></li>
</ul>

<h3>
<span id="impressjs" class="fragment"></span><a href="#impressjs"><i class="fa fa-link"></i></a>impress.js</h3>

<ul>
<li><a href="http://bartaz.github.com/impress.js/" class="autolink" rel="nofollow noopener" target="_blank">http://bartaz.github.com/impress.js/</a></li>
<li><a href="http://kachibito.net/web-design/jmpress-js.html" rel="nofollow noopener" target="_blank">impress.jsライクなダイナミックなプレゼンテーションを作成するjQuery依存タイプのライブラリ・jmpress.js - かちびと. net</a></li>
</ul>

<h3>
<span id="enchantjs" class="fragment"></span><a href="#enchantjs"><i class="fa fa-link"></i></a>enchant.js</h3>

<ul>
<li><a href="http://enchantjs.com/ja/?s=ja" class="autolink" rel="nofollow noopener" target="_blank">http://enchantjs.com/ja/?s=ja</a></li>
<li><p><a href="http://blog.asial.co.jp/858" rel="nofollow noopener" target="_blank">Monaca + enchant.js でお手軽スマフォゲームアプリ開発 : アシアルブログ</a></p></li>
<li><p>gl.enchant.js</p></li>
<li><p><a href="http://wise9.jp/archives/6245" rel="nofollow noopener" target="_blank">wise9 › 3D野郎は寄ってたかれ!WebGLでグリグリ遊べるgl.enchant.jsがついにβ公開!</a></p></li>
</ul>

<h3>
<span id="npm" class="fragment"></span><a href="#npm"><i class="fa fa-link"></i></a>npm</h3>

<h3>
<span id="forever" class="fragment"></span><a href="#forever"><i class="fa fa-link"></i></a>forever</h3>

<h3>
<span id="coffee-script" class="fragment"></span><a href="#coffee-script"><i class="fa fa-link"></i></a>coffee-script</h3>

<h3>
<span id="rvm" class="fragment"></span><a href="#rvm"><i class="fa fa-link"></i></a>rvm</h3>

<h3>
<span id="nvm" class="fragment"></span><a href="#nvm"><i class="fa fa-link"></i></a>nvm</h3>

<h3>
<span id="nave" class="fragment"></span><a href="#nave"><i class="fa fa-link"></i></a>nave</h3>

<hr>

<h1>
<span id="python" class="fragment"></span><a href="#python"><i class="fa fa-link"></i></a>Python</h1>

<h3>
<span id="pypy" class="fragment"></span><a href="#pypy"><i class="fa fa-link"></i></a>pypy</h3>

<p>pythonで書いたプログラムがちょっと遅いなと思ったらとりあえず一回使ってみる(djangoが動くので関係してますよね？)。</p>

<ul>
<li><a href="http://pypy.org/" class="autolink" rel="nofollow noopener" target="_blank">http://pypy.org/</a></li>
</ul>

<h3>
<span id="virtualenv-virtualenvwrapper-pythonbrew" class="fragment"></span><a href="#virtualenv-virtualenvwrapper-pythonbrew"><i class="fa fa-link"></i></a>virtualenv, virtualenvwrapper, pythonbrew</h3>

<p>pythonだとvirtualenv, virtualenvwrapper。最近では代わりにpythonbrewは絶対入れる。</p>

<ul>
<li><a href="http://pypi.python.org/pypi/virtualenv" class="autolink" rel="nofollow noopener" target="_blank">http://pypi.python.org/pypi/virtualenv</a></li>
<li><a href="http://pypi.python.org/pypi/virtualenvwrapper" class="autolink" rel="nofollow noopener" target="_blank">http://pypi.python.org/pypi/virtualenvwrapper</a></li>
<li><a href="https://github.com/utahta/pythonbrew" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/utahta/pythonbrew</a></li>
<li><a href="http://www.ianlewis.org/jp/virtualenv-pip-fabric" rel="nofollow noopener" target="_blank">virtualenv, virtualenvwrapper, pip を使う方法 - Ian Lewis</a></li>
<li><a href="http://www.ninxit.com/blog/2010/10/04/python%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B%E3%83%84%E3%83%BC%E3%83%AB%E3%80%81pythonbrew%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF/" rel="nofollow noopener" target="_blank">Pythonのバージョンを管理するツール、pythonbrewを作ってみた | ninxit.blog</a></li>
</ul>

<h3>
<span id="simplehttpserver" class="fragment"></span><a href="#simplehttpserver"><i class="fa fa-link"></i></a>SimpleHTTPServer</h3>

<p>Pythonだと、SimpleHTTPServerが便利だと思います。</p>

<ul>
<li><a href="http://mojix.org/2009/03/05/python_one_line_fileserver" rel="nofollow noopener" target="_blank">Pythonを使って、１行でファイル共有Webサーバを立ち上げる - モジログ</a></li>
</ul>

<h3>
<span id="pip" class="fragment"></span><a href="#pip"><i class="fa fa-link"></i></a>pip</h3>

<h3>
<span id="ipython" class="fragment"></span><a href="#ipython"><i class="fa fa-link"></i></a>ipython</h3>

<h3>
<span id="scipy" class="fragment"></span><a href="#scipy"><i class="fa fa-link"></i></a>scipy</h3>

<h3>
<span id="werkzeug" class="fragment"></span><a href="#werkzeug"><i class="fa fa-link"></i></a>werkzeug</h3>

<hr>

<h1>
<span id="css-html-less" class="fragment"></span><a href="#css-html-less"><i class="fa fa-link"></i></a>CSS, HTML, LESS</h1>

<h3>
<span id="lessapp" class="fragment"></span><a href="#lessapp"><i class="fa fa-link"></i></a>Less.app</h3>

<p>LESSを書くことがあれば LESS.app も便利です。 </p>

<ul>
<li><a href="http://incident57.com/less/" class="autolink" rel="nofollow noopener" target="_blank">http://incident57.com/less/</a></li>
<li><a href="http://havelog.ayumusato.com/computer/software/e218-less_better_css.html" rel="nofollow noopener" target="_blank">Sassよりラクチン，LESS.appで簡単CSSコンパイル生活！（Mac限定） ::ハブろぐ</a></li>
</ul>

<h3>
<span id="twitter-bootstrap" class="fragment"></span><a href="#twitter-bootstrap"><i class="fa fa-link"></i></a>Twitter Bootstrap</h3>

<p>自分はプログラムに集中したい、でも見た目もそれなりになってたほうがいい、というときにはTwitter Bootstrapでテンプレートをサクっと作っておくといいかもです。</p>

<ul>
<li><a href="http://twitter.github.com/bootstrap/" class="autolink" rel="nofollow noopener" target="_blank">http://twitter.github.com/bootstrap/</a></li>
<li><a href="http://www.ideaxidea.com/archives/2012/02/twitter_bootstrap_v2.html" rel="nofollow noopener" target="_blank">Twitter Bootstrapが大幅バージョンアップ！して凄まじいことに・・・ | IDEA*IDEA</a></li>
</ul>

<h3>
<span id="zen-coding" class="fragment"></span><a href="#zen-coding"><i class="fa fa-link"></i></a>zen-coding</h3>

<p>HTML/CSSの入力支援。IDEがサポートしてたり、エディタにプラグインで組み込めたりする。</p>

<ul>
<li><a href="https://github.com/sergeche/zen-coding" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sergeche/zen-coding</a></li>
</ul>

<hr>

<h1>
<span id="テスト" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>テスト</h1>

<h3>
<span id="xunit-系" class="fragment"></span><a href="#xunit-%E7%B3%BB"><i class="fa fa-link"></i></a>xUnit 系</h3>

<p><a href="http://xunitpatterns.com/" rel="nofollow noopener" target="_blank">XUnitTestPatterns</a> とか読んでおくとどの言語の xUnit 系テストフレームワークへの理解が進む</p>

<h3>
<span id="xspec-系" class="fragment"></span><a href="#xspec-%E7%B3%BB"><i class="fa fa-link"></i></a>xSpec 系</h3>

<p>JBehave とか RSpec とか. PHP には無い．<a href="http://en.wikipedia.org/wiki/Behavior_Driven_Development" rel="nofollow noopener" target="_blank">Wikipedia英語版のBDDのページ</a>がわかりやすい</p>

<h3>
<span id="quickcheck-系" class="fragment"></span><a href="#quickcheck-%E7%B3%BB"><i class="fa fa-link"></i></a>QuickCheck 系</h3>

<p>プログラム仕様そのものを記述し，ランダムな引数を与えて検証するテストフレームワーク．<br>
オリジナルは Haskell からだが，<a href="http://en.wikipedia.org/wiki/QuickCheck" rel="nofollow noopener" target="_blank">メジャーな言語ではけっこう既に実装されている</a>．<br>
Haskell 以外の言語で意欲的に実装を開発している<a href="http://www.yellosoft.us/quickcheck" rel="nofollow noopener" target="_blank">YelloSoftのページ</a> がわかりやすいかと</p>

<hr>

<h1>
<span id="ネットワーク" class="fragment"></span><a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF"><i class="fa fa-link"></i></a>ネットワーク</h1>

<h3>
<span id="hoster" class="fragment"></span><a href="#hoster"><i class="fa fa-link"></i></a>Hoster</h3>

<p>hostsファイルをGUIで設定するアプリ。</p>

<ul>
<li><a href="http://www.redwinder.com/macapp/hoster/" class="autolink" rel="nofollow noopener" target="_blank">http://www.redwinder.com/macapp/hoster/</a></li>
</ul>

<h3>
<span id="wireshark" class="fragment"></span><a href="#wireshark"><i class="fa fa-link"></i></a>wireshark</h3>

<p>あと wireshark, tshark は使い方覚えると超強力ですよ。</p>

<ul>
<li><a href="http://www.wireshark.org/" class="autolink" rel="nofollow noopener" target="_blank">http://www.wireshark.org/</a></li>
<li><a href="http://www.itbook.info/study/wireshark1.html" rel="nofollow noopener" target="_blank">パケットキャプチャツール「Wireshark」 - Wiresharkって？ - ネットワークエンジニアを目指して</a></li>
<li><a href="http://homepage2.nifty.com/protocol/tshark/index.html" rel="nofollow noopener" target="_blank">Tshark（キャプチャツール）</a></li>
</ul>

<h3>
<span id="http-client" class="fragment"></span><a href="#http-client"><i class="fa fa-link"></i></a>HTTP Client</h3>

<ul>
<li><a href="http://ditchnet.org/httpclient/" class="autolink" rel="nofollow noopener" target="_blank">http://ditchnet.org/httpclient/</a></li>
<li><a href="http://www.moongift.jp/2008/12/http_client/" rel="nofollow noopener" target="_blank">Mac OSXのWeb開発のお供に「HTTP Client」 - MOONGIFT</a></li>
</ul>

<h3>
<span id="mocksmtp" class="fragment"></span><a href="#mocksmtp"><i class="fa fa-link"></i></a>MockSMTP</h3>

<p>仮想ローカルSMTP。ネットに繋がっていなくてもSMTPの挙動がチェックできる</p>

<hr>

<h1>
<span id="ftp-ssh-scp" class="fragment"></span><a href="#ftp-ssh-scp"><i class="fa fa-link"></i></a>FTP, SSH, SCP</h1>

<h3>
<span id="sshconfig-sshまわりの設定をまとめておくと大変便利" class="fragment"></span><a href="#sshconfig-ssh%E3%81%BE%E3%82%8F%E3%82%8A%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%A8%E5%A4%A7%E5%A4%89%E4%BE%BF%E5%88%A9"><i class="fa fa-link"></i></a>~/.ssh/config: SSHまわりの設定をまとめておくと大変便利</h3>

<ul>
<li><a href="http://d.hatena.ne.jp/superbrothers/20090730/1248971671" rel="nofollow noopener" target="_blank">~/.ssh/config で簡単に複数ホストへのSSH接続を管理する - すぱぶらの日記</a></li>
</ul>

<h3>
<span id="putty" class="fragment"></span><a href="#putty"><i class="fa fa-link"></i></a>PuTTY</h3>

<p>WindowsのSSHは PuTTY 派なんですが、人にすすめるのは Poderosa ですね。</p>

<ul>
<li><a href="http://yebisuya.dip.jp/Software/PuTTY/" class="autolink" rel="nofollow noopener" target="_blank">http://yebisuya.dip.jp/Software/PuTTY/</a></li>
</ul>

<h3>
<span id="poderosa" class="fragment"></span><a href="#poderosa"><i class="fa fa-link"></i></a>Poderosa</h3>

<p>WindowsのSSHは PuTTY 派なんですが、人にすすめるのは Poderosa ですね。</p>

<ul>
<li><a href="http://ja.poderosa.org/" class="autolink" rel="nofollow noopener" target="_blank">http://ja.poderosa.org/</a></li>
</ul>

<h3>
<span id="clusterssh" class="fragment"></span><a href="#clusterssh"><i class="fa fa-link"></i></a>ClusterSSH</h3>

<ul>
<li><a href="http://sourceforge.net/projects/clusterssh/" class="autolink" rel="nofollow noopener" target="_blank">http://sourceforge.net/projects/clusterssh/</a></li>
<li><a href="http://blog.livedoor.jp/hakin/archives/51564707.html" rel="nofollow noopener" target="_blank">しげふみメモ : Cluster SSHで複数ホストでコマンド同時実行</a></li>
</ul>

<h3>
<span id="transmit" class="fragment"></span><a href="#transmit"><i class="fa fa-link"></i></a>Transmit</h3>

<p>リモート上のファイルをダブルクリックでローカルに保存→開く、ファイル保存→自動的にアップロード なんてのが出来て、ちょっとした開発には結構便利。あと、接続先のディレクトリをFinderにマウント出来る恐怖の機能とかも。もちろんssh等にも対応。</p>

<hr>

<h1>
<span id="grep" class="fragment"></span><a href="#grep"><i class="fa fa-link"></i></a>grep</h1>

<h3>
<span id="rak" class="fragment"></span><a href="#rak"><i class="fa fa-link"></i></a>rak</h3>

<p>Ruby系のツールの rak コマンド。grep検索ツールです。</p>

<ul>
<li><a href="http://d.hatena.ne.jp/Seasons/20090615/1245091432" rel="nofollow noopener" target="_blank">コードスニペットを検索するのにとても便利な「rak」のご紹介 - Seasons.NET</a></li>
</ul>

<h3>
<span id="ack" class="fragment"></span><a href="#ack"><i class="fa fa-link"></i></a>ack</h3>

<p>better than grep</p>

<ul>
<li><a href="http://betterthangrep.com/" class="autolink" rel="nofollow noopener" target="_blank">http://betterthangrep.com/</a></li>
</ul>

<h3>
<span id="jvgrep" class="fragment"></span><a href="#jvgrep"><i class="fa fa-link"></i></a>jvgrep</h3>

<p>手前味噌ですがgrepでjvgrep。go言語で書かれているのでlinuxでもwindowsでも同じ動作。<br>
日本語のエンコーディングはだいたいサポートしてるので、いろんなエンコーディングのファイルが混じった時のgrepや、通称駄目文字を含んだ正規表現でも正しく動きます。</p>

<h3>
<span id="tips" class="fragment"></span><a href="#tips"><i class="fa fa-link"></i></a>Tips</h3>

<p><code>export GREP_OPTIONS='--color=auto'</code><br>
でfgrep/egrep/grepしたときにマッチしたとき単語がカラフルにハイライト表示されるようになる</p>

<p>grep/fgrep/egrepの-oオプション。マッチした単語のみ抽出出来る、これはワンライナー書くときに使える。egrepは拡張正規表現なのでPerlとかRubyみたいに便利な正規表現使える。fgrepは固定文字列検索するときに早い<br>
詳細: <a href="http://d.hatena.ne.jp/lurker/20070131/1170201200" rel="nofollow noopener" target="_blank">単語抽出するちょっとしたテクニック - 技術メモ帳</a></p>

<hr>

<h1>
<span id="統計処理" class="fragment"></span><a href="#%E7%B5%B1%E8%A8%88%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>統計処理</h1>

<p>数万件程度のちょっとしたログをさくっと処理したい時に便利<br>
中央値、標準偏差なんかも一発で出せる。データを元にヒストグラム、3Dのグラフ描画とかも</p>

<h3>
<span id="r" class="fragment"></span><a href="#r"><i class="fa fa-link"></i></a>R</h3>

<ul>
<li><a href="http://www.r-project.org/" class="autolink" rel="nofollow noopener" target="_blank">http://www.r-project.org/</a></li>
</ul>

<h3>
<span id="octave" class="fragment"></span><a href="#octave"><i class="fa fa-link"></i></a>Octave</h3>

<ul>
<li><a href="http://www.gnu.org/software/octave/" class="autolink" rel="nofollow noopener" target="_blank">http://www.gnu.org/software/octave/</a></li>
</ul>

<hr>

<h1>
<span id="ターミナル" class="fragment"></span><a href="#%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB"><i class="fa fa-link"></i></a>ターミナル</h1>

<h3>
<span id="totalterminal" class="fragment"></span><a href="#totalterminal"><i class="fa fa-link"></i></a>TotalTerminal</h3>

<p>Macのターミナルをショートカットキーですぐに呼び出せます。</p>

<ul>
<li><a href="http://totalterminal.binaryage.com/" class="autolink" rel="nofollow noopener" target="_blank">http://totalterminal.binaryage.com/</a></li>
<li><a href="http://veadardiary.blog29.fc2.com/blog-entry-3377.html" rel="nofollow noopener" target="_blank">ホットキーでターミナルを呼び出す『TotalTerminal』 | Macの手書き説明書</a></li>
</ul>

<h3>
<span id="iterm2" class="fragment"></span><a href="#iterm2"><i class="fa fa-link"></i></a>iTerm2</h3>

<ul>
<li><a href="http://www.iterm2.com/#/section/home" class="autolink" rel="nofollow noopener" target="_blank">http://www.iterm2.com/#/section/home</a></li>
<li><a href="http://www.lifehacker.jp/2011/11/111116maciterm2.html" rel="nofollow noopener" target="_blank">米LH編集部のイチオシのMacのターミナルエミュレータは『iTerm2』 : ライフハッカー［日本版］</a></li>
</ul>

<h3>
<span id="percol" class="fragment"></span><a href="#percol"><i class="fa fa-link"></i></a>percol</h3>

<p>percol がターミナルで使える汎用的で便利なツールです。どう使うかでこちらの知識/センスが試されている気分になります。</p>

<ul>
<li><a href="https://github.com/mooz/percol" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mooz/percol</a></li>
</ul>

<hr>

<h1>
<span id="subversion" class="fragment"></span><a href="#subversion"><i class="fa fa-link"></i></a>Subversion</h1>

<h3>
<span id="cornerstone" class="fragment"></span><a href="#cornerstone"><i class="fa fa-link"></i></a>Cornerstone</h3>

<p>SVNクライアント。</p>

<h3>
<span id="versions" class="fragment"></span><a href="#versions"><i class="fa fa-link"></i></a>Versions</h3>

<p>SVNクライアント。</p>

<hr>

<h1>
<span id="git" class="fragment"></span><a href="#git"><i class="fa fa-link"></i></a>git</h1>

<h3>
<span id="smartgit-windows" class="fragment"></span><a href="#smartgit-windows"><i class="fa fa-link"></i></a>SmartGit (Windows)</h3>

<p>Git クライアント</p>

<ul>
<li><a href="http://www.syntevo.com/smartgit/index.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.syntevo.com/smartgit/index.html</a></li>
</ul>

<h3>
<span id="sourcetree" class="fragment"></span><a href="#sourcetree"><i class="fa fa-link"></i></a>SourceTree</h3>

<p>Git クライアント</p>

<ul>
<li><a href="http://www.sourcetreeapp.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.sourcetreeapp.com/</a></li>
</ul>

<h3>
<span id="github" class="fragment"></span><a href="#github"><i class="fa fa-link"></i></a>GitHub</h3>

<p>自分の書いたソースコードを公開。</p>

<ul>
<li><a href="https://github.com/" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/</a></li>
<li><a href="http://d.hatena.ne.jp/keita_yamaguchi/20080409/1207752188" rel="nofollow noopener" target="_blank">とっても優しい github の使い方 - ￢￢日常日記</a></li>
</ul>

<h3>
<span id="tig" class="fragment"></span><a href="#tig"><i class="fa fa-link"></i></a>tig</h3>

<p>git使うならtigが無いと生きていけない。</p>

<ul>
<li><a href="http://subtech.g.hatena.ne.jp/secondlife/20101114/1289736508" rel="nofollow noopener" target="_blank">コンソールから使える git ブラウザ、tig が超便利 - #生存戦略 、それは - subtech</a></li>
</ul>

<h3>
<span id="gitx" class="fragment"></span><a href="#gitx"><i class="fa fa-link"></i></a>GitX</h3>

<ul>
<li><a href="http://gitx.frim.nl/" class="autolink" rel="nofollow noopener" target="_blank">http://gitx.frim.nl/</a></li>
<li><a href="http://d.hatena.ne.jp/kwatch/20081021/1224608591" rel="nofollow noopener" target="_blank">Git リポジトリを視覚化するツール「GitX」 - kなんとかの日記</a></li>
</ul>

<h3>
<span id="tower" class="fragment"></span><a href="#tower"><i class="fa fa-link"></i></a>Tower</h3>

<ul>
<li><a href="http://www.git-tower.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.git-tower.com/</a></li>
</ul>

<h3>
<span id="github-for-mac" class="fragment"></span><a href="#github-for-mac"><i class="fa fa-link"></i></a>github for mac</h3>

<ul>
<li><a href="http://mac.github.com/" class="autolink" rel="nofollow noopener" target="_blank">http://mac.github.com/</a></li>
</ul>

<hr>

<h1>
<span id="ブラウザ" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6"><i class="fa fa-link"></i></a>ブラウザ</h1>

<h3>
<span id="srware-iron" class="fragment"></span><a href="#srware-iron"><i class="fa fa-link"></i></a>SRWare Iron</h3>

<p>UserAgentが変えられるChrome的な使い方をしてます</p>

<hr>

<h1>
<span id="パッケージ管理" class="fragment"></span><a href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E7%AE%A1%E7%90%86"><i class="fa fa-link"></i></a>パッケージ管理</h1>

<h3>
<span id="macports" class="fragment"></span><a href="#macports"><i class="fa fa-link"></i></a>MacPorts</h3>

<p>フリー。パッケージ管理ツール。コンパイルに時間かかるけど昔から使ってるから手放せないツール。</p>

<h3>
<span id="homebrew" class="fragment"></span><a href="#homebrew"><i class="fa fa-link"></i></a>Homebrew</h3>

<p>UNIXのコマンドなどをサクっと入れられます。</p>

<ul>
<li><a href="http://mxcl.github.com/homebrew/" class="autolink" rel="nofollow noopener" target="_blank">http://mxcl.github.com/homebrew/</a></li>
<li><a href="http://tukaikta.blog135.fc2.com/blog-entry-183.html" rel="nofollow noopener" target="_blank">MacPortsより使いやすい！？パッケージ管理システムHomebrewの使い方 | Macとかの雑記帳</a></li>
</ul>

<hr>

<h1>
<span id="その他開発関係ツール" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E9%96%8B%E7%99%BA%E9%96%A2%E4%BF%82%E3%83%84%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>その他開発関係ツール</h1>

<h3>
<span id="codekit" class="fragment"></span><a href="#codekit"><i class="fa fa-link"></i></a>codekit</h3>

<p>CodeKit automatically compiles Less, Sass, Stylus, CoffeeScript &amp; Haml files.</p>

<ul>
<li><a href="http://incident57.com/codekit/" class="autolink" rel="nofollow noopener" target="_blank">http://incident57.com/codekit/</a></li>
<li><a href="http://blog.h2o-space.com/post/12365214600" rel="nofollow noopener" target="_blank">H2O Blog., 新世代Web構築には必須になりそうな『CodeKit』</a></li>
</ul>

<h3>
<span id="pandoc" class="fragment"></span><a href="#pandoc"><i class="fa fa-link"></i></a>pandoc</h3>

<p>書き溜めたmarkdownメモを<br>
ドキュメントつくるときにpandoc使ってhtml化してる</p>

<ul>
<li><a href="http://johnmacfarlane.net/pandoc/" class="autolink" rel="nofollow noopener" target="_blank">http://johnmacfarlane.net/pandoc/</a></li>
<li><a href="http://www.moongift.jp/2007/12/pandoc/" rel="nofollow noopener" target="_blank">Markdown/HTML/LaTexを相互変換「Pandoc」 - MOONGIFT</a></li>
</ul>

<h3>
<span id="integrity" class="fragment"></span><a href="#integrity"><i class="fa fa-link"></i></a>Integrity</h3>

<p>高速リンクチェッカー。デプロイ前の必須アイテム</p>

<ul>
<li><a href="http://peacockmedia.co.uk/integrity/" class="autolink" rel="nofollow noopener" target="_blank">http://peacockmedia.co.uk/integrity/</a></li>
<li><a href="http://www.kotalog.net/archives/2566" rel="nofollow noopener" target="_blank">MacでWebサイトのリンク切れをチェックできるアプリケーション『Integrity』 | kotaログ</a></li>
</ul>

<h3>
<span id="omnigraffle" class="fragment"></span><a href="#omnigraffle"><i class="fa fa-link"></i></a>Omnigraffle</h3>

<p>シェア。ドキュメント作成ツール。これで仕様書を作るとめちゃくちゃ捗る。</p>

<h3>
<span id="osx-gcc-installer" class="fragment"></span><a href="#osx-gcc-installer"><i class="fa fa-link"></i></a>osx-gcc-installer</h3>

<p>Macで「xcodeは要らないけど、gccだけ欲しいわー」ってなったときに死ぬほど有り難いツール。とりあえずWatchかブクマ。</p>

<ul>
<li><a href="https://github.com/kennethreitz/osx-gcc-installer" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/kennethreitz/osx-gcc-installer</a></li>
</ul>

<h3>
<span id="vmware--gentoo-or-ubuntu-debian-etc" class="fragment"></span><a href="#vmware--gentoo-or-ubuntu-debian-etc"><i class="fa fa-link"></i></a>VMware + Gentoo (or Ubuntu, Debian, etc)</h3>

<h3>
<span id="imageoptim" class="fragment"></span><a href="#imageoptim"><i class="fa fa-link"></i></a>ImageOptim</h3>

<p>画像ファイルを軽量化</p>

<h3>
<span id="htmlサーバとしてのdropbox" class="fragment"></span><a href="#html%E3%82%B5%E3%83%BC%E3%83%90%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AEdropbox"><i class="fa fa-link"></i></a>HTMLサーバとしてのDropbox</h3>

<p>HTML+CSS+JSをグローバルアクセスからデバッグしようと思ったら、結局DropboxのPublicフォルダが一番簡単なことに気がつきました（スマフォ向けサイトとかね）。</p>

<hr>

<h1>
<span id="その他作業効率化関係ツール" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E4%BD%9C%E6%A5%AD%E5%8A%B9%E7%8E%87%E5%8C%96%E9%96%A2%E4%BF%82%E3%83%84%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>その他作業効率化関係ツール</h1>

<h3>
<span id="caffeine" class="fragment"></span><a href="#caffeine"><i class="fa fa-link"></i></a>Caffeine</h3>

<ul>
<li><a href="http://lightheadsw.com/caffeine/" class="autolink" rel="nofollow noopener" target="_blank">http://lightheadsw.com/caffeine/</a></li>
<li><a href="http://moongift.jp/2007/10/caffeine/" rel="nofollow noopener" target="_blank">Mac OSXのスリープ防止に「Caffeine」 - MOONGIFT</a></li>
</ul>

<h3>
<span id="bettertouchtool" class="fragment"></span><a href="#bettertouchtool"><i class="fa fa-link"></i></a>BetterTouchTool</h3>

<ul>
<li><a href="http://blog.boastr.net/" class="autolink" rel="nofollow noopener" target="_blank">http://blog.boastr.net/</a></li>
<li><a href="http://d.hatena.ne.jp/RyoAnna/20110731/1312100591" rel="nofollow noopener" target="_blank">Macのトラックパッド操作を快適にするBetterTouchToolの設定 - #RyoAnnaBlog</a></li>
</ul>

<h3>
<span id="clipmenu" class="fragment"></span><a href="#clipmenu"><i class="fa fa-link"></i></a>ClipMenu</h3>

<ul>
<li><a href="http://www.clipmenu.com/ja/" class="autolink" rel="nofollow noopener" target="_blank">http://www.clipmenu.com/ja/</a></li>
<li><a href="http://www.moongift.jp/2010/01/clipmenu/" rel="nofollow noopener" target="_blank">クリップボードを履歴管理する「ClipMenu」 - MOONGIFT</a></li>
</ul>

<h3>
<span id="limechat-for-mac-osx" class="fragment"></span><a href="#limechat-for-mac-osx"><i class="fa fa-link"></i></a>Limechat for mac osx</h3>

<p>Preferences -&gt; Log -&gt; Show image links in inlineを有効にすると<br>
ユーザー名に対応した画像をTwitterから引っ張ってきてインラインで展開してくれる。<br>
もちろん間違ってるプロフィール画像が展開されることもあるけど、有名人多いIRCとかだとだいたいあってる。</p>

<ul>
<li><a href="http://limechat.net/mac/ja.html" class="autolink" rel="nofollow noopener" target="_blank">http://limechat.net/mac/ja.html</a></li>
<li><a href="http://veadardiary.blog29.fc2.com/blog-entry-2672.html" rel="nofollow noopener" target="_blank">軽くてシンプルなIRCクライアント『LimeChat』 | Macの手書き説明書</a></li>
</ul>

<h3>
<span id="quicksilver" class="fragment"></span><a href="#quicksilver"><i class="fa fa-link"></i></a>QuickSilver</h3>

<p>Quicksilverは、アプリケーションの立ち上げ、コンピューター・ファイルの操作、e-mailの下書きと送信といった作業を、キーボードにより、手早く処理できる。</p>

<ul>
<li><a href="http://www.blacktree.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.blacktree.com/</a></li>
<li><a href="http://ja.wikipedia.org/wiki/Quicksilver" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/Quicksilver</a></li>
</ul>

<h3>
<span id="quix" class="fragment"></span><a href="#quix"><i class="fa fa-link"></i></a>Quix</h3>

<p>quix便利やけど使ってる人見たことない</p>

<ul>
<li><a href="http://www.quixapp.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.quixapp.com/</a></li>
<li><a href="http://kachibito.net/web-service/quix.html" rel="nofollow noopener" target="_blank">ライフハッカーお勧めの多機能ブックマークレットQuixを試したら本当に便利だった - かちびと. net</a></li>
</ul>

<h3>
<span id="skitch" class="fragment"></span><a href="#skitch"><i class="fa fa-link"></i></a>Skitch</h3>

<ul>
<li><a href="http://skitch.com/jp/" class="autolink" rel="nofollow noopener" target="_blank">http://skitch.com/jp/</a></li>
<li><a href="http://bloggingfrom.tv/wp/2010/05/05/3668" rel="nofollow noopener" target="_blank">Macのキャプチャ・編集ソフト「Skitch」が大変便利 - カイ士伝</a></li>
</ul>

<h3>
<span id="lingon" class="fragment"></span><a href="#lingon"><i class="fa fa-link"></i></a>Lingon</h3>

<p>フリーorシェア。自動起動の管理ツール。OSXの自動起動プログラムを視覚的に編集したりできる。</p>

<ul>
<li><a href="http://www.peterborgapps.com/lingon/" class="autolink" rel="nofollow noopener" target="_blank">http://www.peterborgapps.com/lingon/</a></li>
<li><a href="http://www.moongift.jp/2008/04/lingon/" rel="nofollow noopener" target="_blank">launchdの設定をGUIで編集「Lingon」 - MOONGIFT</a></li>
</ul>

<h3>
<span id="growl" class="fragment"></span><a href="#growl"><i class="fa fa-link"></i></a>Growl</h3>

<p>基本的なところでMacだとGrowl</p>

<h3>
<span id="alfred" class="fragment"></span><a href="#alfred"><i class="fa fa-link"></i></a>Alfred</h3>

<p>QuickSilverみたいなfuzzyな文字列による、アプリケーション検索 &amp; 実行ランチャ。QuickSilverよりも良いのは、マッチするアプリケーションがなかったときはGoogleで検索してくれること。</p>

<h3>
<span id="reeder" class="fragment"></span><a href="#reeder"><i class="fa fa-link"></i></a>Reeder</h3>

<p>RSSリーダーは Reeder がおすすめ。</p>

<ul>
<li><a href="http://reederapp.com/mac/" class="autolink" rel="nofollow noopener" target="_blank">http://reederapp.com/mac/</a></li>
</ul>

<h3>
<span id="cinch" class="fragment"></span><a href="#cinch"><i class="fa fa-link"></i></a>Cinch</h3>

<p>Macで簡単に画面2分割（Win7のあれ）をやってくれるツール。同僚に教えてもらってアディクトしてしまった。</p>

<ul>
<li><a href="http://www.irradiatedsoftware.com/cinch/" class="autolink" rel="nofollow noopener" target="_blank">http://www.irradiatedsoftware.com/cinch/</a></li>
</ul>

<h3>
<span id="fluid" class="fragment"></span><a href="#fluid"><i class="fa fa-link"></i></a>Fluid</h3>

<p>Webアプリを簡単にローカルアプリ化出来るヤツ。Webアプリで簡単に開発して、クライアントをブラウザにしなくなかったり、常駐させたいときに便利。</p>

<h3>
<span id="divvy" class="fragment"></span><a href="#divvy"><i class="fa fa-link"></i></a>DIVVY</h3>

<p>画面をショートカットキー1発で分割できる</p>

<h3>
<span id="a-better-finder-rename" class="fragment"></span><a href="#a-better-finder-rename"><i class="fa fa-link"></i></a>A Better Finder Rename</h3>

<p>バッチリネームが超絶簡単</p>

<h3>
<span id="skim" class="fragment"></span><a href="#skim"><i class="fa fa-link"></i></a>Skim</h3>

<p>軽量PDFリーダ。Adobe Acrobatよりも気持ちいい</p>

<h3>
<span id="bean" class="fragment"></span><a href="#bean"><i class="fa fa-link"></i></a>Bean</h3>

<p>Microsoft Wordよりも快適</p>

<hr>

<h1>
<span id="unixlinuxmacコマンド" class="fragment"></span><a href="#unixlinuxmac%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>Unix/Linux/Macコマンド</h1>

<ul>
<li>gdb</li>
<li>lv</li>
<li>xargs</li>
<li>iotop</li>
<li>htop</li>
<li>iperf</li>
<li>htop</li>
<li>zsh</li>
<li>tree</li>
<li>make</li>
<li>bison</li>
<li>awk</li>
</ul>

<hr>

<ul>
<li>screen</li>
<li>byobu</li>
<li>tmux</li>
</ul>

<blockquote>
<p>これはサーバで長時間かかる作業を不安定な回線などで行うときに特に役立ちます。</p>
</blockquote>

<p>　</p>

<blockquote>
<p>screenは手軽にプロセスを長生きさせるのに便利です。<br>
sshで接続して何かしらの時間がかかるプロセスを実行しても、接続切ったらプロセスもカーネルに殺されてしまう。<br>
そこでscreenの中でプロセスを起動して、screenをデタッチしとくと、そのプロセスを生き長らえさせることができます。</p>
</blockquote>

<p>　</p>

<blockquote>
<p>最初にありがたいと思ったのはサーバー上で長い事作業する時<br>
通信がぶちっと切れてもscreenのプロセス自体は生き残るので、再度サーバーに接続して<br>
残ってるscreenのプロセスにアタッチすれば作業が即再開できる。<br>
vimの作業状態なんかもそのまま残っている<br>
byobuというのはscreenがいい感じにカスタマイズされた奴</p>
</blockquote>

<p>　</p>

<blockquote>
<p>screenは最近tmuxに置き換えました。まだ使いこなしてないけど。</p>
</blockquote>

<p>　</p>

<blockquote>
<p>screen/tmux がとっつきにくいという向けにはbyobu がお勧めです．<br>
とりあえず困らない設定になっています．</p>

<p>後は以下に沢山のtips が<br>
"ターミナルマルチプレクサ Advent Calendar 2011 : ATND" <a href="http://atnd.org/events/22320" class="autolink" rel="nofollow noopener" target="_blank">http://atnd.org/events/22320</a></p>
</blockquote>

<p>　</p>

<blockquote>
<p>ネイティブのバイナリ関連なら、od,file,nm,strings,strace,varglind</p>
</blockquote>

<p>　</p>

<blockquote>
<p>あと個人的にはvim/zsh/screen。この3つはどんな環境でも必ず入れる</p>
</blockquote>

<p>　</p>

<blockquote>
<p>find ./ -name *.php | xargs grep hoge とかはよく使いますね。Windowsは秀丸のgrepが強力です。</p>
</blockquote>

<h3>
<span id="git-よく使うコマンドとオプション-コマンド小ネタ-シェル小ネタ" class="fragment"></span><a href="#git-%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A8%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%B0%8F%E3%83%8D%E3%82%BF-%E3%82%B7%E3%82%A7%E3%83%AB%E5%B0%8F%E3%83%8D%E3%82%BF"><i class="fa fa-link"></i></a>git, よく使うコマンドとオプション, コマンド小ネタ, シェル小ネタ</h3>

<p><a href="http://qiita.com/items/2047#comment-2182" class="autolink">http://qiita.com/items/2047#comment-2182</a></p>

<h3>
<span id="寒い日にcpuが発熱してあったかくなるコマンド" class="fragment"></span><a href="#%E5%AF%92%E3%81%84%E6%97%A5%E3%81%ABcpu%E3%81%8C%E7%99%BA%E7%86%B1%E3%81%97%E3%81%A6%E3%81%82%E3%81%A3%E3%81%9F%E3%81%8B%E3%81%8F%E3%81%AA%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>寒い日にCPUが発熱してあったかくなるコマンド</h3>

<p>寒い日は充電中のMacBook上で<code>ruby -r digest/sha1 -e 'loop{Digest::SHA1.hexdigest(Time.now.to_f.to_s)}'</code><br>
とかしてしばらく放置すると勝手にCPUが発熱してあったかくなる</p>

<hr>

<h1>
<span id="ウェブサービス" class="fragment"></span><a href="#%E3%82%A6%E3%82%A7%E3%83%96%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9"><i class="fa fa-link"></i></a>ウェブサービス</h1>

<h3>
<span id="qiita" class="fragment"></span><a href="#qiita"><i class="fa fa-link"></i></a>Qiita</h3>

<p>ここ</p>

<ul>
<li><a href="http://qiita.com/" class="autolink">http://qiita.com/</a></li>
</ul>

<h1>
<span id="未分類" class="fragment"></span><a href="#%E6%9C%AA%E5%88%86%E9%A1%9E"><i class="fa fa-link"></i></a>未分類</h1>

<h3>
<span id="mscgen" class="fragment"></span><a href="#mscgen"><i class="fa fa-link"></i></a>mscgen</h3>

<p>シーケンス図を書くのであればmscgenをお勧めします。<br>
日本語もフォントを指定すれば問題なくうごきます。</p>

<ul>
<li><a href="http://www.mcternan.me.uk/mscgen/" class="autolink" rel="nofollow noopener" target="_blank">http://www.mcternan.me.uk/mscgen/</a></li>
</ul>

<h3>
<span id="cheat" class="fragment"></span><a href="#cheat"><i class="fa fa-link"></i></a>cheat</h3>

<ul>
<li><a href="https://github.com/defunkt/cheat" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/defunkt/cheat</a></li>
</ul>

<h3>
<span id="yuml" class="fragment"></span><a href="#yuml"><i class="fa fa-link"></i></a>yUML</h3>

<p>UMLを描いて出力できるWebサービスです。ユニークなURLが発行されるのでブログに貼り付けたり出来ます</p>

<p>クラス図 / アクティビティ図 / ユースケース図</p>

<ul>
<li><a href="http://yuml.me/" class="autolink" rel="nofollow noopener" target="_blank">http://yuml.me/</a></li>
</ul>

<h3>
<span id="websequencediagramscom" class="fragment"></span><a href="#websequencediagramscom"><i class="fa fa-link"></i></a>WebSequenceDiagrams.com</h3>

<p>UMLを描いて出力できるWebサービスです。ユニークなURLが発行されるのでブログに貼り付けたり出来ます</p>

<p>シーケンス図</p>

<p><a href="http://www.websequencediagrams.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.websequencediagrams.com/</a></p>

<h3>
<span id="cacoo" class="fragment"></span><a href="#cacoo"><i class="fa fa-link"></i></a>Cacoo</h3>

<h3>
<span id="applek-for-vmware" class="fragment"></span><a href="#applek-for-vmware"><i class="fa fa-link"></i></a>AppleK for VMware</h3>

<p>Macで仮想マシン上のWindowsを使う場合にキー操作がMacと同じになるように設定してくれるアプリ。有料だけどVM上での作業効率が大きく上がるのでおすすめ。</p>

<ul>
<li>VMWare用
<a href="http://www.trinityworks.co.jp/software/AppleKforVMware3/index.php" class="autolink" rel="nofollow noopener" target="_blank">http://www.trinityworks.co.jp/software/AppleKforVMware3/index.php</a>
</li>
<li>Parallels用
<a href="http://www.trinityworks.co.jp/software/AppleKforParallels3/index.php" class="autolink" rel="nofollow noopener" target="_blank">http://www.trinityworks.co.jp/software/AppleKforParallels3/index.php</a>
</li>
</ul>

<h3>
<span id="keyremap4macbook" class="fragment"></span><a href="#keyremap4macbook"><i class="fa fa-link"></i></a>KeyRemap4Macbook</h3>

<p>なぜかまだ挙げられていないKeyRemap4Macbook。キー割り当てを自在にカスタマイズできる他、キーリピートやキーウェイトを標準仕様より高速化できる。Mac使いのプログラマにとっては定番のアプリ<br>
<a href="http://pqrs.org/macosx/keyremap4macbook/index.html.ja" class="autolink" rel="nofollow noopener" target="_blank">http://pqrs.org/macosx/keyremap4macbook/index.html.ja</a></p>

<h3>
<span id="bitnami" class="fragment"></span><a href="#bitnami"><i class="fa fa-link"></i></a>BitNami</h3>

<p>様々なOSSプラットフォーム/アプリをインストーラを使って簡単に導入し試すことの出来るソフト<br>
<a href="http://bitnami.org/stacks" class="autolink" rel="nofollow noopener" target="_blank">http://bitnami.org/stacks</a></p>

<h3>
<span id="ampps" class="fragment"></span><a href="#ampps"><i class="fa fa-link"></i></a>AMPPS</h3>

<p>様々なOSSプラットフォーム/アプリをインストーラを使って簡単に導入し試すことの出来るソフト<br>
<a href="http://www.ampps.com/" class="autolink" rel="nofollow noopener" target="_blank">http://www.ampps.com/</a></p>

<h3>
<span id="tekico" class="fragment"></span><a href="#tekico"><i class="fa fa-link"></i></a>TEKICO</h3>

<p>日本語・欧文のダミーテキストを生成するAIR製ソフト。Webサイトのプロトタイプ作成時に活躍。</p>

<ul>
<li><a href="http://www.uniteair.co.jp/app/air/pid_001.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.uniteair.co.jp/app/air/pid_001.html</a></li>
</ul>

<hr>

<p>作業メモ <br>
2012/02/08 <br>
<a href="http://qiita.com/items/2047#comment-2159" class="autolink">http://qiita.com/items/2047#comment-2159</a> まで書き写した</p>

<p>2012/02/09 <br>
<a href="http://qiita.com/items/2047#comment-2215" class="autolink">http://qiita.com/items/2047#comment-2215</a> まで書き写した<br>
#comment-2219 まで取り込んだ<br>
Googleとかでタイトルの後ろがtruncateされて本家と区別つかないのでタイトル変更「これ知らないプログラマって損してんなって思う汎用的なツール 100超 まとめ」→「【まとめ】これ知らないプログラマって損してんなって思う汎用的なツール 100超」</p>

<p>2012/02/10<br>
<a href="http://qiita.com/items/2047#comment-2295" class="autolink">http://qiita.com/items/2047#comment-2295</a> まで書き写した<br>
未分類だったものをある程度分類した</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1541</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/22662f43b6a6e8728798">動的言語だけやってた僕が、38日間Go言語を書いて学んだこと</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-11 23:04:54</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[PHP]</b> <b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/dfcb4e20de11481fd3b6f9d8c3dc9e19741a6605/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35626331646430352d326439322d653462632d616661302d3763366366653165623664372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/dfcb4e20de11481fd3b6f9d8c3dc9e19741a6605/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35626331646430352d326439322d653462632d616661302d3763366366653165623664372e706e67" alt="golang" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/5bc1dd05-2d92-e4bc-afa0-7c6cfe1eb6d7.png"></a></p>

<p>Go言語を始めて38日たったので、これからGo言語を始めるプログラマにちょっとでもヒントになるように、どのようにGo言語を始めて、どのような手順で学んできたかまとめておきます。</p>

<h1>
<span id="筆者のバックグランド" class="fragment"></span><a href="#%E7%AD%86%E8%80%85%E3%81%AE%E3%83%90%E3%83%83%E3%82%AF%E3%82%B0%E3%83%A9%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>筆者のバックグランド</h1>

<ul>
<li>PHP歴、JavaScript歴10年~</li>
<li>Python 3ヶ月くらい</li>
<li>Ruby 1日</li>
<li>静的言語経験ほぼ皆無(Java 3日くらい、Scala 3日くらい、Objective-C 1週間くらい、Cそもそも挫折、C# 1日)</li>
</ul>

<p>静的言語というと、「コンパイルの一手間が面倒」だとか「環境を作るのが面倒」だとか先入観があり、ほぼ食わず嫌い状態でした。</p>

<h1>
<span id="go言語とは" class="fragment"></span><a href="#go%E8%A8%80%E8%AA%9E%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Go言語とは?</h1>

<p>Go言語は2009年にGoogleによって作られたオープンソースの静的言語で、Linux・Mac・WindowsやAndroidで動作します。最近ではGoogle App Engineで使うこともできます。</p>

<p><a href="http://golang.jp/about_go" rel="nofollow noopener" target="_blank">golang.jpの解説</a>によると次のような特徴があります。</p>

<ul>
<li>シンプルな言語である。</li>
<li>コンパイル・実行速度が早い。</li>
<li>安全性が高い。</li>
<li>同期処理が容易に行える。</li>
<li>なにより楽しい。</li>
<li>オープンソースである。</li>
</ul>

<h1>
<span id="なぜgo言語を学んだか" class="fragment"></span><a href="#%E3%81%AA%E3%81%9Cgo%E8%A8%80%E8%AA%9E%E3%82%92%E5%AD%A6%E3%82%93%E3%81%A0%E3%81%8B"><i class="fa fa-link"></i></a>なぜGo言語を学んだか?</h1>

<p>ひとことで言うと並行処理を簡単に書きたかったからです。Go言語にはGoルーチンというシンプルな並行処理の仕組みがあります。たまたま業務で、同時に複数台のHTTPサーバーにリクエストを出して大量の命令と大量のデータを並行処理するプログラムを実装する必要が出てきて、得意なPHPでは難しいのでGo言語を学ぶことにしました。言語にはそれぞれ特徴があって、適材適所だと思っています。</p>

<h1>
<span id="読んだ本" class="fragment"></span><a href="#%E8%AA%AD%E3%82%93%E3%81%A0%E6%9C%AC"><i class="fa fa-link"></i></a>読んだ本</h1>

<p><a href="https://camo.qiitausercontent.com/f298964aec6ca5da2ead26520bea2da70ff69e40/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65613966336165332d626539632d393333662d373336322d6464626533643362373738312e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f298964aec6ca5da2ead26520bea2da70ff69e40/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65613966336165332d626539632d393333662d373336322d6464626533643362373738312e6a706567" alt="51lLHJuR4-L._SS500_.jpg" title="51lLHJuR4-L._SS500_.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/ea9f3ae3-be9c-933f-7362-ddbe3d3b7781.jpeg"></a></p>

<p>Go言語を始める前に、『<a href="http://www.amazon.co.jp/gp/product/4777515591?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=4777515591&amp;linkCode=shr&amp;tag=suinyeze-22&amp;f_rd_p=466449256&amp;pf_rd_s=lpo-top-stripe&amp;pf_rd_t=201&amp;pf_rd_i=4863541171&amp;pf_rd_m=AN1VRQENFRJN5&amp;pf_rd_r=0WA4QMWKHBWB1PVGQH0X" rel="nofollow noopener" target="_blank">はじめての「Go言語」</a>』をパラパラと読みました。じっくり読むというよりは最低限必要なこと、例えば、基本的な<code>if</code>や<code>for</code>などの構文の書き方、私のやったことある言語にないGoルーチン(並行処理ができる)の概念などを読んで学びました。</p>

<h1>
<span id="参考にしたドキュメント" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>参考にしたドキュメント</h1>

<p>ドキュメント英語版: <a href="http://golang.org/doc/" class="autolink" rel="nofollow noopener" target="_blank">http://golang.org/doc/</a><br>
ドキュメント日本語版: <a href="http://golang.jp/go_spec" class="autolink" rel="nofollow noopener" target="_blank">http://golang.jp/go_spec</a></p>

<h1>
<span id="go関連情報のググり方" class="fragment"></span><a href="#go%E9%96%A2%E9%80%A3%E6%83%85%E5%A0%B1%E3%81%AE%E3%82%B0%E3%82%B0%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>Go関連情報のググり方</h1>

<p>「go」だけで検索するとGo言語の情報がヒットしにくい問題があります。英語の情報を探すときは「golang」、日本語の情報を探すときは「Go言語」といったキーワードで探すと情報を見つけやすくなります。</p>

<h1>
<span id="どのようなことを学んだか" class="fragment"></span><a href="#%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E3%81%93%E3%81%A8%E3%82%92%E5%AD%A6%E3%82%93%E3%81%A0%E3%81%8B"><i class="fa fa-link"></i></a>どのようなことを学んだか?</h1>

<p>ここからは、38日間にどのようなことを学んできたか、Qiitaに投稿した記事を振り返りながら、概ね時系列でご紹介します。</p>

<h2>
<span id="go言語の実行環境を作る入門以前の段階" class="fragment"></span><a href="#go%E8%A8%80%E8%AA%9E%E3%81%AE%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83%E3%82%92%E4%BD%9C%E3%82%8B%E5%85%A5%E9%96%80%E4%BB%A5%E5%89%8D%E3%81%AE%E6%AE%B5%E9%9A%8E"><i class="fa fa-link"></i></a>Go言語の実行環境を作る入門以前の段階</h2>

<ul>
<li>MacにGoをどうやってインストールするのか?</li>
<li>そもそもどうやって実行するのか?</li>
<li>コンパイルはどうするのか?</li>
<li>Macで作った実行形式がLinuxで使えるのか?</li>
</ul>

<p>このような疑問を解決するために調べた内容をまとめた最初の記事です。</p>

<p>2013-12-04 <a href="http://qiita.com/suin/items/a0b7eb585eeb6bda4174" id="reference-21d8990091b6674e3e4d">PHPerだが今日初めてGo言語に手を出してみる試み</a></p>

<h2>
<span id="ひとつのファイルにガリガリ書くだけの段階" class="fragment"></span><a href="#%E3%81%B2%E3%81%A8%E3%81%A4%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E3%82%AC%E3%83%AA%E3%82%AC%E3%83%AA%E6%9B%B8%E3%81%8F%E3%81%A0%E3%81%91%E3%81%AE%E6%AE%B5%E9%9A%8E"><i class="fa fa-link"></i></a>ひとつのファイルにガリガリ書くだけの段階</h2>

<p>さすがに1ファイルに収まらない量になってきたので、複数のファイルにコードを分けることについて学ぶ。</p>

<p>2013-12-05 <a href="http://qiita.com/suin/items/f4ad02e4123c8a3c75eb" id="reference-d30e0a594a62f140efa3">Go言語のpackageの作り方: 長くなったコードを別ファイルに切り出す方法</a></p>

<h2>
<span id="試行錯誤の段階" class="fragment"></span><a href="#%E8%A9%A6%E8%A1%8C%E9%8C%AF%E8%AA%A4%E3%81%AE%E6%AE%B5%E9%9A%8E"><i class="fa fa-link"></i></a>試行錯誤の段階</h2>

<p>学んでいく過程でstackoverflowやQiitaに出てくるスニペットを試してみたくなりました。そこで、スニペットをさくっと実行できる環境を構築することにしました。</p>

<p>2013-12-05 <a href="http://qiita.com/suin/items/599057e5e30627d2ed10" id="reference-ad2b5269b10934850f8c">ワンクリックでGoのスニペットを試せる環境を作る!: CodeRunnerの設定方法</a></p>

<h2>
<span id="言語仕様の理解を深める段階" class="fragment"></span><a href="#%E8%A8%80%E8%AA%9E%E4%BB%95%E6%A7%98%E3%81%AE%E7%90%86%E8%A7%A3%E3%82%92%E6%B7%B1%E3%82%81%E3%82%8B%E6%AE%B5%E9%9A%8E"><i class="fa fa-link"></i></a>言語仕様の理解を深める段階</h2>

<p>Go言語を使うモチベーションが並行処理にあったので、真っ先にGoルーチンについて学びました。また、オブジェクト指向プログラミングを実践するにあたって、オブジェクトの作り方といった基礎的な言語仕様について学びました。</p>

<p>2013-12-05 <a href="http://qiita.com/suin/items/82ecb6f63ff4104d4f5d" id="reference-5fffe9722a48a59ef8af">Goルーチンで並列化する方法: 6秒かかる処理を3秒にしよう</a><br>
2013-12-10 <a href="http://qiita.com/suin/items/b2a81227c75c51579c04" id="reference-b28ccc92bf641eb98a8a">Go言語でオブジェクトを作ってみる: オブジェクト・メソッド・コンストラクタなど</a></p>

<h2>
<span id="実際にアプリを開発する段階" class="fragment"></span><a href="#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E9%96%8B%E7%99%BA%E3%81%99%E3%82%8B%E6%AE%B5%E9%9A%8E"><i class="fa fa-link"></i></a>実際にアプリを開発する段階</h2>

<p>アプリの開発に着手した段階です。ライブラリ・モジュールの具体的な使い方について調べていました。</p>

<p>2013-12-07 <a href="http://qiita.com/suin/items/f32fa82d6c35a34e8d16" id="reference-9af29ece0a377a9f079a">こんなに簡単! Goで作るRESTサーバー</a><br>
2013-12-10 <a href="http://qiita.com/suin/items/af8f306dc6b38a293ef5" id="reference-a2a9a94813496a24f15d">Go言語でファイル操作: ディレクトリの作り方</a><br>
2013-12-10 <a href="http://qiita.com/suin/items/7eb4fc405ac73846a9b1" id="reference-b397219cc7ed56de8800">Go言語でファイル操作: ファイルを作って書き込む</a><br>
2013-12-10 <a href="http://qiita.com/suin/items/2724f15fff9c1948c5b3" id="reference-b1a51bbfb380b2c23b7b">Go言語でコマンドが実行可能かチェックする</a></p>

<blockquote>
<p>この頃、PHPerでGo言語はじめたての僕が「型の宣言めんどくさい」とか「ポインタなんてなんで用意したし」とか不満を言っていたら、僕より先にGoを始めてた同僚に「Goに入ればGoに従えと言うじゃないですか」と言われる(笑)</p>
</blockquote>

<p>2013-12-11 <a href="http://qiita.com/suin/items/7ddfcbc708c8863ea76a" id="reference-596b45b6fe89b44df367">Go言語のクロスコンパイル設定値 $GOOS, $GOARCH 一覧リスト</a><br>
2013-12-11 <a href="http://qiita.com/suin/items/9f9bdaa0cb9cb80cf752" id="reference-911cad8b07db276f6dd8">Go言語: ディレクトリ内の全ファイルをフォーマットする方法</a> (コードスタイルがぐちゃぐちゃになって気持ち悪くなってきた頃)<br>
2013-12-11 <a href="http://qiita.com/suin/items/2a38f3e072523fa49a5b" id="reference-e8601aa804687a00e566">Go言語でRESTful APIクライアント: Qiita APIを叩いてみよう!</a><br>
2013-12-11 <a href="http://qiita.com/suin/items/d952fb963956ac31b243" id="reference-c7a1fd6eb8b1d30d68b7">Go言語でPHPのvar_dumpやJavaScriptのconsole.log的なもの</a> (そろそろデバッグを覚えたいと思った頃)<br>
2013-12-12 <a href="http://qiita.com/suin/items/062dab1e6dc82c81c320" id="reference-6cf58efb417cdfbf7a7d">Go言語でランダムな文字列を生成する</a><br>
2013-12-12 <a href="http://qiita.com/suin/items/d0deb76ff03373b22a0b" id="reference-fa3240711a249fee01bf">Go言語でPHPのarray_chunkのようなことをする</a><br>
2013-12-12 <a href="http://qiita.com/suin/items/bb9d817af5ccedb18be9" id="reference-e2813fcefa83f3036e58">Go言語でCSVを書き出す!エクセル用のSJIS版も!</a><br>
2013-12-18 <a href="http://qiita.com/suin/items/23b2c2e7cb7c80ca857e" id="reference-56835e9d4070e22c1640">Go言語:SJISのCSVファイルを読み込む!</a><br>
2013-12-18 <a href="http://qiita.com/suin/items/347ecda071a6999e5d22" id="reference-6050296b94ac95609c55">Go言語: SJISのCSVを読み込みながら1行毎に処理を実行する</a><br>
2013-12-18 <a href="http://qiita.com/suin/items/3e978caa0c7f4ffcdd97" id="reference-a1d46ce16d0145503d1c">Go言語: PHPのarray_combine()のような処理をする関数</a><br>
2014-01-06 <a href="http://qiita.com/suin/items/68ed7020d21dca047a73" id="reference-a4825c387e337a311bfe">[教えて]Go言語:なぜインターフェイスはポインタにできない?</a> (このあたりからやっとポインタを意識し始める)<br>
2014-01-07 <a href="http://qiita.com/suin/items/468108496cd0dc002f64" id="reference-d6c0718d83c94634baad">Go言語:変数が関数かどうかを返す関数</a><br>
2014-01-07 <a href="http://qiita.com/suin/items/ec2070fde6700ffc4a7f" id="reference-1cb223903fbbc7283b31">Go言語:メソッドの引数の型を調べる方法</a><br>
2014-01-10 <a href="http://qiita.com/suin/items/942773fd059272825eb8" id="reference-5f36e8d7a8f77f1b9862">Go言語:Riakに書き込む</a></p>

<h2>
<span id="そろそろテストを書かなきゃと思い始めた段階" class="fragment"></span><a href="#%E3%81%9D%E3%82%8D%E3%81%9D%E3%82%8D%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E6%9B%B8%E3%81%8B%E3%81%AA%E3%81%8D%E3%82%83%E3%81%A8%E6%80%9D%E3%81%84%E5%A7%8B%E3%82%81%E3%81%9F%E6%AE%B5%E9%9A%8E"><i class="fa fa-link"></i></a>「そろそろテストを書かなきゃ」と思い始めた段階</h2>

<p>モジュール化やオブジェクト指向プログラミングをGo言語でできるようになってきて、一ファイルの一枚岩コードから脱却していました。テストも書きやすい状態になっていたので、単体テストのやり方について学びました。また、切り出したコードをオープンソースとして公開したり、継続的インテグレーションのやり方について学びました。</p>

<p>2013-12-27 <a href="http://qiita.com/suin/items/71f28f06e7a49414cc93" id="reference-f7272097c0e210563d1e">Go言語: 単体テストの始め方！Gospelを使ってBDDをやってみよう</a><br>
2014-01-06 <a href="http://qiita.com/suin/items/850b39625c92437d2362" id="reference-e44e3bd070ee24c3586f">Go言語：単体テストを複数のパッケージに対して実行する</a><br>
2014-01-08 <a href="http://qiita.com/suin/items/1237f210ef9e81b6475d" id="reference-ee666565656ade437a10">Go言語:自分のライブラリをGitHubで公開する方法+drone.ioで継続的インテグレーション</a></p>

<h1>
<span id="マスコット-gopher" class="fragment"></span><a href="#%E3%83%9E%E3%82%B9%E3%82%B3%E3%83%83%E3%83%88-gopher"><i class="fa fa-link"></i></a>マスコット Gopher</h1>

<p>このかわいいマスコットは、Go言語のマスコットです。Gopherと言います。日本語ではホリネズミというそうです。</p>

<p></p>Gopherのフィギュア

<p><a href="https://camo.qiitausercontent.com/961175a8a44f3f9c5bec7e5f40e5000924b14855/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33306335353061642d613064612d623638392d386439382d6236326137373539663135362e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/961175a8a44f3f9c5bec7e5f40e5000924b14855/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33306335353061642d613064612d623638392d386439382d6236326137373539663135362e6a706567" alt="IMAG0129.jpg" title="IMAG0129.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/30c550ad-a0da-b689-8d98-b62a7759f156.jpeg"></a><br>
</p>

<h1>
<span id="使ってみて気づいたgo言語の魅力" class="fragment"></span><a href="#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%A6%E6%B0%97%E3%81%A5%E3%81%84%E3%81%9Fgo%E8%A8%80%E8%AA%9E%E3%81%AE%E9%AD%85%E5%8A%9B"><i class="fa fa-link"></i></a>使ってみて気づいたGo言語の魅力</h1>

<p>Goを始めて3日目たったころにGoの魅力を感じ始めました。下記はそのときに書いた感想です。</p>

<blockquote>
<ul>
<li>クロスコンパイルが超カンタン。Macで開発しててもLinux、Windows用のバイナリが作れる</li>
<li>コンパイル時にポカミスが洗い出される。動的言語にはない安心感</li>
<li>まるでスクリプト言語を書いてる感覚。いつコンパイルしてるの? 型推論すごすぎ!</li>
<li>並行処理たったそれだけでできるの!?</li>
<li>ビルドすると一つの実行形式バイナリファイルになる! このポータビリティは気持ちいい</li>
<li>パッケージ管理システムがビルトインなので、"import github.com/user/project" って書くだけでパッケージがすぐ使える! 神!</li>
<li>defer。finallyがない言語はやってらんないと思ってたけど、deferのほうがいいじゃん!</li>
<li>どんな汚いコードを書いてもGoが整頓(format)してくれる。コーディング規約じゃなくて、自動フォーマットでコードの個人差を吸収するほうが健全な気がしてきた</li>
<li>ドキュメントがしっかりしてる。</li>
<li>タブインデントがデフォ! 俺得</li>
</ul>
</blockquote>

<h1>
<span id="go言語はこれからどこで役立つ" class="fragment"></span><a href="#go%E8%A8%80%E8%AA%9E%E3%81%AF%E3%81%93%E3%82%8C%E3%81%8B%E3%82%89%E3%81%A9%E3%81%93%E3%81%A7%E5%BD%B9%E7%AB%8B%E3%81%A4"><i class="fa fa-link"></i></a>Go言語はこれからどこで役立つ?</h1>

<p>DevOpsやImmutable Infrastructureなどインフラ構築では今後欠かせなくなりそうな <a href="https://www.docker.io/" rel="nofollow noopener" target="_blank">Docker</a>、<a href="http://www.packer.io/" rel="nofollow noopener" target="_blank">Packer</a>、<a href="http://www.serfdom.io/" rel="nofollow noopener" target="_blank">Serf</a>といったオープンソースはGoで書かれています。これらのプロダクトは既に注目されていますが、今後ますます標準的なものになっていくだろうと予想します。そうした中でDevOpsを中心にGoで書かれるプロダクトも増えていくのではないでしょうか。</p>

<p></p>Go言語のトレンド <a href="http://www.google.com/trends/explore#q=golang&amp;date=1%2F2009%2061m&amp;cmpt=q" rel="nofollow noopener" target="_blank">Google Trands</a> より

<p><a href="https://camo.qiitausercontent.com/9e42c484c8eb315b25790ba1c63b738c45544f8d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65663530336230662d333661652d356238372d323966632d3037376639313531313533382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9e42c484c8eb315b25790ba1c63b738c45544f8d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65663530336230662d333661652d356238372d323966632d3037376639313531313533382e706e67" alt="Screen Shot 2014-01-11 at 22.57.11.png" title="Screen Shot 2014-01-11 at 22.57.11.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/ef503b0f-36ae-5b87-29fc-077f91511538.png"></a><br>
</p>

<h1>
<span id="go言語を学んで変わったこと" class="fragment"></span><a href="#go%E8%A8%80%E8%AA%9E%E3%82%92%E5%AD%A6%E3%82%93%E3%81%A7%E5%A4%89%E3%82%8F%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>Go言語を学んで変わったこと</h1>

<p>僕は15歳から22歳までずっと趣味のアマチュアプログラマでした。当時は好きなコードを好きなように書いていて、ストレスフリーでコーディングそのものが楽しいと感じていました。</p>

<p>趣味のコーディングと業務のコーディングの決定的な違いは、「品質に責任を負うかどうか」という点だと思います。品質を担保するために、ドメイン駆動設計やDevOps、テスト駆動開発、リーンソフトウェア開発、オブジェクト指向、アジャイル、デザインパターン、継続的デリバリーといった言語を超えた上位レイヤにばかり注目していて、コーディングは単なる作業になっていました。</p>

<p>Goは「プログラミングは楽しくあるべき」という考えから生まれた言語らしいです。その思想はいろんなかたちで現れてて、書けるようになればなるほど楽しくなる言語だと思います。ひさしぶりにコーディングそのものの「楽しさ」を思い出すことができました。</p>

<hr>

<p>もしGoをやっていて困ったときは、suinがチャットで相談に乗ります。もちろん、無償です(๑•̀ㅂ•́)و✧ <a href="https://help.suin.io/" rel="nofollow noopener" target="_blank">suinのプログラミング相談室</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1038</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/5c4e21fa284497782f71">俺史上最強のiptablesをさらす</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-08-20 19:44:40</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[CentOS]</b> <b>[Ubuntu]</b> <b>[iptables]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iptablesを改めて勉強しなおしました。ツッコミ歓迎です^-^</p>

<p>GitHub: <a href="https://github.com/suin/iptables/blob/master/iptables.sh" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/suin/iptables/blob/master/iptables.sh</a></p>

<div class="code-frame" data-lang="sh">
<div class="code-lang"><span class="bold">iptables.sh</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">###########################################################</span>
<span class="c1"># このスクリプトの特徴</span>
<span class="c1">#</span>
<span class="c1"># 受信・通過については基本的に破棄し、ホワイトリストで許可するものを指定する。</span>
<span class="c1"># 送信については基本的に許可する。ただし、サーバが踏み台になり外部のサーバに迷惑をかける可能性があるので、</span>
<span class="c1"># 心配な場合は、送信も受信同様に基本破棄・ホワイトリストで許可するように書き換えると良い。</span>
<span class="c1">###########################################################</span>

<span class="c1">###########################################################</span>
<span class="c1"># 用語の統一</span>
<span class="c1"># わかりやすさのためルールとコメントの用語を以下に統一する</span>
<span class="c1"># ACCEPT : 許可</span>
<span class="c1"># DROP   : 破棄</span>
<span class="c1"># REJECT : 拒否</span>
<span class="c1">###########################################################</span>

<span class="c1">###########################################################</span>
<span class="c1"># チートシート</span>
<span class="c1">#</span>
<span class="c1"># -A, --append       指定チェインに1つ以上の新しいルールを追加</span>
<span class="c1"># -D, --delete       指定チェインから1つ以上のルールを削除</span>
<span class="c1"># -P, --policy       指定チェインのポリシーを指定したターゲットに設定</span>
<span class="c1"># -N, --new-chain    新しいユーザー定義チェインを作成</span>
<span class="c1"># -X, --delete-chain 指定ユーザー定義チェインを削除</span>
<span class="c1"># -F                 テーブル初期化</span>
<span class="c1">#</span>
<span class="c1"># -p, --protocol      プロコトル         プロトコル(tcp、udp、icmp、all)を指定</span>
<span class="c1"># -s, --source        IPアドレス[/mask]  送信元のアドレス。IPアドレスorホスト名を記述</span>
<span class="c1"># -d, --destination   IPアドレス[/mask]  送信先のアドレス。IPアドレスorホスト名を記述</span>
<span class="c1"># -i, --in-interface  デバイス           パケットが入ってくるインターフェイスを指定</span>
<span class="c1"># -o, --out-interface デバイス           パケットが出ていくインターフェイスを指定</span>
<span class="c1"># -j, --jump          ターゲット         条件に合ったときのアクションを指定</span>
<span class="c1"># -t, --table         テーブル           テーブルを指定</span>
<span class="c1"># -m state --state    状態              パケットの状態を条件として指定</span>
<span class="c1">#                                       stateは、 NEW、ESTABLISHED、RELATED、INVALIDが指定できる</span>
<span class="c1"># !                   条件を反転（～以外となる）</span>
<span class="c1">###########################################################</span>

<span class="c1"># パス</span>
<span class="nv">PATH</span><span class="o">=</span>/sbin:/usr/sbin:/bin:/usr/bin

<span class="c1">###########################################################</span>
<span class="c1"># IPの定義</span>
<span class="c1"># 必要に応じて定義する。定義しなくても動作する。</span>
<span class="c1">###########################################################</span>

<span class="c1"># 内部ネットワークとして許可する範囲</span>
<span class="c1"># LOCAL_NET="xxx.xxx.xxx.xxx/xx"</span>

<span class="c1"># 内部ネットワークとして一部制限付きで許可する範囲</span>
<span class="c1"># LIMITED_LOCAL_NET="xxx.xxx.xxx.xxx/xx"</span>

<span class="c1"># ZabbixサーバーIP</span>
<span class="c1"># ZABBIX_IP="xxx.xxx.xxx.xxx"</span>

<span class="c1"># 全てのIPを表す設定を定義</span>
<span class="c1"># ANY="0.0.0.0/0"</span>

<span class="c1"># 信頼可能ホスト(配列)</span>
<span class="c1"># ALLOW_HOSTS=(</span>
<span class="c1">#   "xxx.xxx.xxx.xxx"</span>
<span class="c1">#   "xxx.xxx.xxx.xxx"</span>
<span class="c1">#   "xxx.xxx.xxx.xxx"</span>
<span class="c1"># )</span>

<span class="c1"># 無条件破棄するリスト(配列)</span>
<span class="c1"># DENY_HOSTS=(</span>
<span class="c1">#   "xxx.xxx.xxx.xxx"</span>
<span class="c1">#   "xxx.xxx.xxx.xxx"</span>
<span class="c1">#   "xxx.xxx.xxx.xxx"</span>
<span class="c1"># )</span>

<span class="c1">###########################################################</span>
<span class="c1"># ポート定義</span>
<span class="c1">###########################################################</span>

<span class="nv">SSH</span><span class="o">=</span><span class="m">22</span>
<span class="nv">FTP</span><span class="o">=</span><span class="m">20</span>,21
<span class="nv">DNS</span><span class="o">=</span><span class="m">53</span>
<span class="nv">SMTP</span><span class="o">=</span><span class="m">25</span>,465,587
<span class="nv">POP3</span><span class="o">=</span><span class="m">110</span>,995
<span class="nv">IMAP</span><span class="o">=</span><span class="m">143</span>,993
<span class="nv">HTTP</span><span class="o">=</span><span class="m">80</span>,443
<span class="nv">IDENT</span><span class="o">=</span><span class="m">113</span>
<span class="nv">NTP</span><span class="o">=</span><span class="m">123</span>
<span class="nv">MYSQL</span><span class="o">=</span><span class="m">3306</span>
<span class="nv">NET_BIOS</span><span class="o">=</span><span class="m">135</span>,137,138,139,445
<span class="nv">DHCP</span><span class="o">=</span><span class="m">67</span>,68

<span class="c1">###########################################################</span>
<span class="c1"># 関数</span>
<span class="c1">###########################################################</span>

<span class="c1"># iptablesの初期化, すべてのルールを削除</span>
initialize<span class="o">()</span> 
<span class="o">{</span>
    iptables -F <span class="c1"># テーブル初期化</span>
    iptables -X <span class="c1"># チェーンを削除</span>
    iptables -Z <span class="c1"># パケットカウンタ・バイトカウンタをクリア</span>
    iptables -P INPUT   ACCEPT
    iptables -P OUTPUT  ACCEPT
    iptables -P FORWARD ACCEPT
<span class="o">}</span>

<span class="c1"># ルール適用後の処理</span>
finailize<span class="o">()</span>
<span class="o">{</span>
    /etc/init.d/iptables save <span class="o">&amp;&amp;</span> <span class="c1"># 設定の保存</span>
    /etc/init.d/iptables restart <span class="o">&amp;&amp;</span> <span class="c1"># 保存したもので再起動してみる</span>
    <span class="k">return</span> <span class="m">0</span>
    <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># 開発用</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"dev"</span> <span class="o">]</span>
<span class="k">then</span>
    iptables<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"iptables </span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="o">}</span>
    finailize<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"finailize"</span><span class="p">;</span> <span class="o">}</span>
<span class="k">fi</span>

<span class="c1">###########################################################</span>
<span class="c1"># iptablesの初期化</span>
<span class="c1">###########################################################</span>
initialize

<span class="c1">###########################################################</span>
<span class="c1"># ポリシーの決定</span>
<span class="c1">###########################################################</span>
iptables -P INPUT   DROP <span class="c1"># すべてDROP。すべての穴をふさいでから必要なポートを空けていくのが良い。</span>
iptables -P OUTPUT  ACCEPT
iptables -P FORWARD DROP

<span class="c1">###########################################################</span>
<span class="c1"># 信頼可能なホストは許可</span>
<span class="c1">###########################################################</span>

<span class="c1"># ローカルホスト</span>
<span class="c1"># lo はローカルループバックのことで自分自身のホストを指す</span>
iptables -A INPUT -i lo -j ACCEPT <span class="c1"># SELF -&gt; SELF</span>

<span class="c1"># ローカルネットワーク</span>
<span class="c1"># $LOCAL_NET が設定されていれば LAN上の他のサーバとのやり取りを許可する</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$LOCAL_NET</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
    iptables -A INPUT -p tcp -s <span class="nv">$LOCAL_NET</span> -j ACCEPT <span class="c1"># LOCAL_NET -&gt; SELF</span>
<span class="k">fi</span>

<span class="c1"># 信頼可能ホスト</span>
<span class="c1"># $ALLOW_HOSTS が設定されていれば そのホストとのやり取りを許可する</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="si">${</span><span class="nv">ALLOW_HOSTS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
    <span class="k">for</span> allow_host in <span class="si">${</span><span class="nv">ALLOW_HOSTS</span><span class="p">[@]</span><span class="si">}</span>
    <span class="k">do</span>
        iptables -A INPUT -p tcp -s <span class="nv">$allow_host</span> -j ACCEPT <span class="c1"># allow_host -&gt; SELF</span>
    <span class="k">done</span>
<span class="k">fi</span>

<span class="c1">###########################################################</span>
<span class="c1"># $DENY_HOSTSからのアクセスは破棄</span>
<span class="c1">###########################################################</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="si">${</span><span class="nv">DENY_HOSTS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
    <span class="k">for</span> host in <span class="si">${</span><span class="nv">DENY_HOSTS</span><span class="p">[@]</span><span class="si">}</span>
    <span class="k">do</span>
        iptables -A INPUT -s <span class="nv">$ip</span> -m limit --limit <span class="m">1</span>/s -j LOG --log-prefix <span class="s2">"deny_host: "</span>
        iptables -A INPUT -s <span class="nv">$ip</span> -j DROP
    <span class="k">done</span>
<span class="k">fi</span>

<span class="c1">###########################################################</span>
<span class="c1"># セッション確立後のパケット疎通は許可</span>
<span class="c1">###########################################################</span>
iptables -A INPUT  -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT

<span class="c1">###########################################################</span>
<span class="c1"># 攻撃対策: Stealth Scan</span>
<span class="c1">###########################################################</span>
iptables -N STEALTH_SCAN <span class="c1"># "STEALTH_SCAN" という名前でチェーンを作る</span>
iptables -A STEALTH_SCAN -j LOG --log-prefix <span class="s2">"stealth_scan_attack: "</span>
iptables -A STEALTH_SCAN -j DROP

<span class="c1"># ステルススキャンらしきパケットは "STEALTH_SCAN" チェーンへジャンプする</span>
iptables -A INPUT -p tcp --tcp-flags SYN,ACK SYN,ACK -m state --state NEW -j STEALTH_SCAN
iptables -A INPUT -p tcp --tcp-flags ALL NONE -j STEALTH_SCAN

iptables -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN         -j STEALTH_SCAN
iptables -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST         -j STEALTH_SCAN
iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -j STEALTH_SCAN

iptables -A INPUT -p tcp --tcp-flags FIN,RST FIN,RST -j STEALTH_SCAN
iptables -A INPUT -p tcp --tcp-flags ACK,FIN FIN     -j STEALTH_SCAN
iptables -A INPUT -p tcp --tcp-flags ACK,PSH PSH     -j STEALTH_SCAN
iptables -A INPUT -p tcp --tcp-flags ACK,URG URG     -j STEALTH_SCAN

<span class="c1">###########################################################</span>
<span class="c1"># 攻撃対策: フラグメントパケットによるポートスキャン,DOS攻撃</span>
<span class="c1"># namap -v -sF などの対策</span>
<span class="c1">###########################################################</span>
iptables -A INPUT -f -j LOG --log-prefix <span class="s1">'fragment_packet:'</span>
iptables -A INPUT -f -j DROP

<span class="c1">###########################################################</span>
<span class="c1"># 攻撃対策: Ping of Death</span>
<span class="c1">###########################################################</span>
<span class="c1"># 毎秒1回を超えるpingが10回続いたら破棄</span>
iptables -N PING_OF_DEATH <span class="c1"># "PING_OF_DEATH" という名前でチェーンを作る</span>
iptables -A PING_OF_DEATH -p icmp --icmp-type echo-request <span class="se">\</span>
         -m hashlimit <span class="se">\</span>
         --hashlimit <span class="m">1</span>/s <span class="se">\</span>
         --hashlimit-burst <span class="m">10</span> <span class="se">\</span>
         --hashlimit-htable-expire <span class="m">300000</span> <span class="se">\</span>
         --hashlimit-mode srcip <span class="se">\</span>
         --hashlimit-name t_PING_OF_DEATH <span class="se">\</span>
         -j RETURN

<span class="c1"># 制限を超えたICMPを破棄</span>
iptables -A PING_OF_DEATH -j LOG --log-prefix <span class="s2">"ping_of_death_attack: "</span>
iptables -A PING_OF_DEATH -j DROP

<span class="c1"># ICMP は "PING_OF_DEATH" チェーンへジャンプ</span>
iptables -A INPUT -p icmp --icmp-type echo-request -j PING_OF_DEATH

<span class="c1">###########################################################</span>
<span class="c1"># 攻撃対策: SYN Flood Attack</span>
<span class="c1"># この対策に加えて Syn Cookie を有効にすべし。</span>
<span class="c1">###########################################################</span>
iptables -N SYN_FLOOD <span class="c1"># "SYN_FLOOD" という名前でチェーンを作る</span>
iptables -A SYN_FLOOD -p tcp --syn <span class="se">\</span>
         -m hashlimit <span class="se">\</span>
         --hashlimit <span class="m">200</span>/s <span class="se">\</span>
         --hashlimit-burst <span class="m">3</span> <span class="se">\</span>
         --hashlimit-htable-expire <span class="m">300000</span> <span class="se">\</span>
         --hashlimit-mode srcip <span class="se">\</span>
         --hashlimit-name t_SYN_FLOOD <span class="se">\</span>
         -j RETURN

<span class="c1"># 解説</span>
<span class="c1"># -m hashlimit                       ホストごとに制限するため limit ではなく hashlimit を利用する</span>
<span class="c1"># --hashlimit 200/s                  秒間に200接続を上限にする</span>
<span class="c1"># --hashlimit-burst 3                上記の上限を超えた接続が3回連続であれば制限がかかる</span>
<span class="c1"># --hashlimit-htable-expire 300000   管理テーブル中のレコードの有効期間（単位：ms</span>
<span class="c1"># --hashlimit-mode srcip             送信元アドレスでリクエスト数を管理する</span>
<span class="c1"># --hashlimit-name t_SYN_FLOOD       /proc/net/ipt_hashlimit に保存されるハッシュテーブル名</span>
<span class="c1"># -j RETURN                          制限以内であれば、親チェーンに戻る</span>

<span class="c1"># 制限を超えたSYNパケットを破棄</span>
iptables -A SYN_FLOOD -j LOG --log-prefix <span class="s2">"syn_flood_attack: "</span>
iptables -A SYN_FLOOD -j DROP

<span class="c1"># SYNパケットは "SYN_FLOOD" チェーンへジャンプ</span>
iptables -A INPUT -p tcp --syn -j SYN_FLOOD

<span class="c1">###########################################################</span>
<span class="c1"># 攻撃対策: HTTP DoS/DDoS Attack</span>
<span class="c1">###########################################################</span>
iptables -N HTTP_DOS <span class="c1"># "HTTP_DOS" という名前でチェーンを作る</span>
iptables -A HTTP_DOS -p tcp -m multiport --dports <span class="nv">$HTTP</span> <span class="se">\</span>
         -m hashlimit <span class="se">\</span>
         --hashlimit <span class="m">1</span>/s <span class="se">\</span>
         --hashlimit-burst <span class="m">100</span> <span class="se">\</span>
         --hashlimit-htable-expire <span class="m">300000</span> <span class="se">\</span>
         --hashlimit-mode srcip <span class="se">\</span>
         --hashlimit-name t_HTTP_DOS <span class="se">\</span>
         -j RETURN

<span class="c1"># 解説</span>
<span class="c1"># -m hashlimit                       ホストごとに制限するため limit ではなく hashlimit を利用する</span>
<span class="c1"># --hashlimit 1/s                    秒間1接続を上限とする</span>
<span class="c1"># --hashlimit-burst 100              上記の上限を100回連続で超えると制限がかかる</span>
<span class="c1"># --hashlimit-htable-expire 300000   管理テーブル中のレコードの有効期間（単位：ms</span>
<span class="c1"># --hashlimit-mode srcip             送信元アドレスでリクエスト数を管理する</span>
<span class="c1"># --hashlimit-name t_HTTP_DOS        /proc/net/ipt_hashlimit に保存されるハッシュテーブル名</span>
<span class="c1"># -j RETURN                          制限以内であれば、親チェーンに戻る</span>

<span class="c1"># 制限を超えた接続を破棄</span>
iptables -A HTTP_DOS -j LOG --log-prefix <span class="s2">"http_dos_attack: "</span>
iptables -A HTTP_DOS -j DROP

<span class="c1"># HTTPへのパケットは "HTTP_DOS" チェーンへジャンプ</span>
iptables -A INPUT -p tcp -m multiport --dports <span class="nv">$HTTP</span> -j HTTP_DOS

<span class="c1">###########################################################</span>
<span class="c1"># 攻撃対策: IDENT port probe</span>
<span class="c1"># identを利用し攻撃者が将来の攻撃に備えるため、あるいはユーザーの</span>
<span class="c1"># システムが攻撃しやすいかどうかを確認するために、ポート調査を実行</span>
<span class="c1"># する可能性があります。</span>
<span class="c1"># DROP ではメールサーバ等のレスポンス低下になるため REJECTする</span>
<span class="c1">###########################################################</span>
iptables -A INPUT -p tcp -m multiport --dports <span class="nv">$IDENT</span> -j REJECT --reject-with tcp-reset

<span class="c1">###########################################################</span>
<span class="c1"># 攻撃対策: SSH Brute Force</span>
<span class="c1"># SSHはパスワード認証を利用しているサーバの場合、パスワード総当り攻撃に備える。</span>
<span class="c1"># 1分間に5回しか接続トライをできないようにする。</span>
<span class="c1"># SSHクライアント側が再接続を繰り返すのを防ぐためDROPではなくREJECTにする。</span>
<span class="c1"># SSHサーバがパスワード認証ONの場合、以下をアンコメントアウトする</span>
<span class="c1">###########################################################</span>
<span class="c1"># iptables -A INPUT -p tcp --syn -m multiport --dports $SSH -m recent --name ssh_attack --set</span>
<span class="c1"># iptables -A INPUT -p tcp --syn -m multiport --dports $SSH -m recent --name ssh_attack --rcheck --seconds 60 --hitcount 5 -j LOG --log-prefix "ssh_brute_force: "</span>
<span class="c1"># iptables -A INPUT -p tcp --syn -m multiport --dports $SSH -m recent --name ssh_attack --rcheck --seconds 60 --hitcount 5 -j REJECT --reject-with tcp-reset</span>

<span class="c1">###########################################################</span>
<span class="c1"># 攻撃対策: FTP Brute Force</span>
<span class="c1"># FTPはパスワード認証のため、パスワード総当り攻撃に備える。</span>
<span class="c1"># 1分間に5回しか接続トライをできないようにする。</span>
<span class="c1"># FTPクライアント側が再接続を繰り返すのを防ぐためDROPではなくREJECTにする。</span>
<span class="c1"># FTPサーバを立ち上げている場合、以下をアンコメントアウトする</span>
<span class="c1">###########################################################</span>
<span class="c1"># iptables -A INPUT -p tcp --syn -m multiport --dports $FTP -m recent --name ftp_attack --set</span>
<span class="c1"># iptables -A INPUT -p tcp --syn -m multiport --dports $FTP -m recent --name ftp_attack --rcheck --seconds 60 --hitcount 5 -j LOG --log-prefix "ftp_brute_force: "</span>
<span class="c1"># iptables -A INPUT -p tcp --syn -m multiport --dports $FTP -m recent --name ftp_attack --rcheck --seconds 60 --hitcount 5 -j REJECT --reject-with tcp-reset</span>

<span class="c1">###########################################################</span>
<span class="c1"># 全ホスト(ブロードキャストアドレス、マルチキャストアドレス)宛パケットは破棄</span>
<span class="c1">###########################################################</span>
iptables -A INPUT -d <span class="m">192</span>.168.1.255   -j LOG --log-prefix <span class="s2">"drop_broadcast: "</span>
iptables -A INPUT -d <span class="m">192</span>.168.1.255   -j DROP
iptables -A INPUT -d <span class="m">255</span>.255.255.255 -j LOG --log-prefix <span class="s2">"drop_broadcast: "</span>
iptables -A INPUT -d <span class="m">255</span>.255.255.255 -j DROP
iptables -A INPUT -d <span class="m">224</span>.0.0.1       -j LOG --log-prefix <span class="s2">"drop_broadcast: "</span>
iptables -A INPUT -d <span class="m">224</span>.0.0.1       -j DROP

<span class="c1">###########################################################</span>
<span class="c1"># 全ホスト(ANY)からの入力許可</span>
<span class="c1">###########################################################</span>

<span class="c1"># ICMP: ping に応答する設定</span>
iptables -A INPUT -p icmp -j ACCEPT <span class="c1"># ANY -&gt; SELF</span>

<span class="c1"># HTTP, HTTPS</span>
iptables -A INPUT -p tcp -m multiport --dports <span class="nv">$HTTP</span> -j ACCEPT <span class="c1"># ANY -&gt; SELF</span>

<span class="c1"># SSH: ホストを制限する場合は TRUST_HOSTS に信頼ホストを書き下記をコメントアウトする</span>
iptables -A INPUT -p tcp -m multiport --dports <span class="nv">$SSH</span> -j ACCEPT <span class="c1"># ANY -&gt; SEL</span>

<span class="c1"># FTP</span>
<span class="c1"># iptables -A INPUT -p tcp -m multiport --dports $FTP -j ACCEPT # ANY -&gt; SELF</span>

<span class="c1"># DNS</span>
<span class="c1"># iptables -A INPUT -p tcp -m multiport --sports $DNS -j ACCEPT # ANY -&gt; SELF</span>
<span class="c1"># iptables -A INPUT -p udp -m multiport --sports $DNS -j ACCEPT # ANY -&gt; SELF</span>

<span class="c1"># SMTP</span>
<span class="c1"># iptables -A INPUT -p tcp -m multiport --sports $SMTP -j ACCEPT # ANY -&gt; SELF</span>

<span class="c1"># POP3</span>
<span class="c1"># iptables -A INPUT -p tcp -m multiport --sports $POP3 -j ACCEPT # ANY -&gt; SELF</span>

<span class="c1"># IMAP</span>
<span class="c1"># iptables -A INPUT -p tcp -m multiport --sports $IMAP -j ACCEPT # ANY -&gt; SELF</span>

<span class="c1">###########################################################</span>
<span class="c1"># ローカルネットワーク(制限付き)からの入力許可</span>
<span class="c1">###########################################################</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$LIMITED_LOCAL_NET</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
    <span class="c1"># SSH</span>
    iptables -A INPUT -p tcp -s <span class="nv">$LIMITED_LOCAL_NET</span> -m multiport --dports <span class="nv">$SSH</span> -j ACCEPT <span class="c1"># LIMITED_LOCAL_NET -&gt; SELF</span>

    <span class="c1"># FTP</span>
    iptables -A INPUT -p tcp -s <span class="nv">$LIMITED_LOCAL_NET</span> -m multiport --dports <span class="nv">$FTP</span> -j ACCEPT <span class="c1"># LIMITED_LOCAL_NET -&gt; SELF</span>

    <span class="c1"># MySQL</span>
    iptables -A INPUT -p tcp -s <span class="nv">$LIMITED_LOCAL_NET</span> -m multiport --dports <span class="nv">$MYSQL</span> -j ACCEPT <span class="c1"># LIMITED_LOCAL_NET -&gt; SELF</span>
<span class="k">fi</span>

<span class="c1">###########################################################</span>
<span class="c1"># 特定ホストからの入力許可</span>
<span class="c1">###########################################################</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$ZABBIX_IP</span><span class="s2">"</span> <span class="o">]</span>
<span class="k">then</span>
    <span class="c1"># Zabbix関連を許可</span>
    iptables -A INPUT -p tcp -s <span class="nv">$ZABBIX_IP</span> --dport <span class="m">10050</span> -j ACCEPT <span class="c1"># Zabbix -&gt; SELF</span>
<span class="k">fi</span>

<span class="c1">###########################################################</span>
<span class="c1"># それ以外</span>
<span class="c1"># 上記のルールにも当てはまらなかったものはロギングして破棄</span>
<span class="c1">###########################################################</span>
iptables -A INPUT  -j LOG --log-prefix <span class="s2">"drop: "</span>
iptables -A INPUT  -j DROP

<span class="c1">###########################################################</span>
<span class="c1"># SSH 締め出し回避策</span>
<span class="c1"># 30秒間スリープしてその後 iptables をリセットする。</span>
<span class="c1"># SSH が締め出されていなければ、 Ctrl-C を押せるはず。</span>
<span class="c1">###########################################################</span>
<span class="nb">trap</span> <span class="s1">'finailize &amp;&amp; exit 0'</span> <span class="m">2</span> <span class="c1"># Ctrl-C をトラップする</span>
<span class="nb">echo</span> <span class="s2">"In 30 seconds iptables will be automatically reset."</span>
<span class="nb">echo</span> <span class="s2">"Don't forget to test new SSH connection!"</span>
<span class="nb">echo</span> <span class="s2">"If there is no problem then press Ctrl-C to finish."</span>
sleep <span class="m">30</span>
<span class="nb">echo</span> <span class="s2">"rollback..."</span>
initialize
</pre></div>
</div>

<p>ツッコミをうけての変更:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git log-graph 
* 65e8249 2012-08-23 Hidehito Nozawa aka Suin fix: -m multiport --dport"s"
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>628</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/8de26866a8ab6ca65ba4">【図解】CSSだけで画像の縦横比を維持したサムネイルを表示する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-20 03:14:35</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[HTML]</b> <b>[CSS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>サムネイルを表示するときに、サーバサイドプログラムで画像の縦横を計算してサムネイル画像を作ることがあります。しかし、場合によってはCSS3でサムネイル画像を描画したほうが実装コストが低い場合があります。ここでは、CSS3を使ってサムネイル画像をキレイに描画する方法を紹介します。</p>

<h1>
<span id="1-内接外接とは" class="fragment"></span><a href="#1-%E5%86%85%E6%8E%A5%E5%A4%96%E6%8E%A5%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>1. 内接・外接とは？</h1>

<p>画像の変形方法はいろいろありますが、ここでは内接リサイズ・外接リサイズについてのみ紹介します。内接リサイズ・外接リサイズとは、画像の縦横比を維持したまま、枠のサイズにフィットするように画像のサイズを変更する描画方法です。印刷出版系の用語だそうです。</p>

<table>
<thead>
<tr>
<th style="text-align: center">内接リサイズ</th>
<th style="text-align: center">外接リサイズ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center">画像の長辺を枠に合わせ画像全体が枠内に収まるようにリサイズする。</td>
<td style="text-align: center">画像の短辺を枠に合わせてリサイズする。枠からはみ出す部分はカットされる。</td>
</tr>
<tr>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/16f8a1f83031c4f950d4256a7f8fe57a72be844e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62396433326635622d363230362d343134342d343463642d6232313639393863373862322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/16f8a1f83031c4f950d4256a7f8fe57a72be844e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62396433326635622d363230362d343134342d343463642d6232313639393863373862322e706e67" alt="inside" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/b9d32f5b-6206-4144-44cd-b216998c78b2.png"></a></td>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/3089db7c054a6b0a74e31687ef96117f8d26ba3b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33353663376634372d326537392d633531312d643039632d3865653562613439393035662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3089db7c054a6b0a74e31687ef96117f8d26ba3b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33353663376634372d326537392d633531312d643039632d3865653562613439393035662e706e67" alt="outside" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/356c7f47-2e79-c511-d09c-8ee5ba49905f.png"></a></td>
</tr>
</tbody>
</table>

<p>以下は、横長と縦長のサンプル画像です。これらをCSSでリサイズしてみます。</p>

<table>
<thead>
<tr>
<th style="text-align: center">横長.jpeg</th>
<th style="text-align: center">縦長.jpeg</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/7ddf8c55ae27d9ed6fe71b2af5b1213d517e023e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39663662353338622d386332332d396263652d386433652d3739656363313837613164392e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7ddf8c55ae27d9ed6fe71b2af5b1213d517e023e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39663662353338622d386332332d396263652d386433652d3739656363313837613164392e6a706567" alt="horizontal long" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/9f6b538b-8c23-9bce-8d3e-79ecc187a1d9.jpeg"></a></td>
<td style="text-align: center"><a href="https://camo.qiitausercontent.com/e50dd6c87673db3c4b055ad59cebb9f353a3c66e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64313565396438392d373362662d353834312d396231612d6531343738336664666561382e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e50dd6c87673db3c4b055ad59cebb9f353a3c66e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64313565396438392d373362662d353834312d396231612d6531343738336664666561382e6a706567" alt="vertically long" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/d15e9d89-73bf-5841-9b1a-e14783fdfea8.jpeg"></a></td>
</tr>
</tbody>
</table>

<h1>
<span id="2-background-sizeを使った実装" class="fragment"></span><a href="#2-background-size%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>2. <code>background-size</code>を使った実装</h1>

<p>CSS3で追加された <code>background-size</code> プロパティを使います。このプロパティは、IE9+, Firefox 4+, Opera, Chrome, Safari 5+で動作します。</p>

<p><em>background-sizeのブラウザ対応状況 <a href="http://caniuse.com/#feat=background-img-opts" rel="nofollow noopener" target="_blank">Can I use... Support tables for HTML5, CSS3, etc</a>より</em></p>

<p><a href="https://camo.qiitausercontent.com/2d85f466f6921864715ba8491b815005b7d51ff8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f66353234633538332d363131372d616535302d376530302d3332326662306436373233612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2d85f466f6921864715ba8491b815005b7d51ff8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f66353234633538332d363131372d616535302d376530302d3332326662306436373233612e706e67" alt="can-i-use-background-size" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/f524c583-6117-ae50-7e00-322fb0d6723a.png"></a></p>

<h2>
<span id="21-内接リサイズ" class="fragment"></span><a href="#21-%E5%86%85%E6%8E%A5%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>2.1 内接リサイズ</h2>

<div class="code-frame" data-lang="css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">contain</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">inline-block</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ccc</span><span class="p">;</span>
    <span class="k">background-position</span><span class="p">:</span> <span class="kc">center</span> <span class="kc">center</span><span class="p">;</span>
    <span class="k">background-repeat</span><span class="p">:</span> <span class="kc">no-repeat</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ccc</span><span class="p">;</span>
    <span class="k">background-size</span><span class="p">:</span> <span class="kc">contain</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"contain"</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-image: url('./横長.jpeg')"</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"contain"</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-image: url('./縦長.jpeg')"</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div></div>

<h3>
<span id="211-描画結果" class="fragment"></span><a href="#211-%E6%8F%8F%E7%94%BB%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>2.1.1 描画結果</h3>

<p><a href="https://camo.qiitausercontent.com/9367eb5f2905fb30e2e58231a69ccec73a771ed0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63313738653231332d326134622d306664652d383663642d3431636564616562646534642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9367eb5f2905fb30e2e58231a69ccec73a771ed0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63313738653231332d326134622d306664652d383663642d3431636564616562646534642e706e67" alt="contain" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/c178e213-2a4b-0fde-86cd-41cedaebde4d.png"></a></p>

<h2>
<span id="22-外接リサイズ" class="fragment"></span><a href="#22-%E5%A4%96%E6%8E%A5%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>2.2 外接リサイズ</h2>

<div class="code-frame" data-lang="css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">cover</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">inline-block</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ccc</span><span class="p">;</span>
    <span class="k">background-position</span><span class="p">:</span> <span class="kc">center</span> <span class="kc">center</span><span class="p">;</span>
    <span class="k">background-repeat</span><span class="p">:</span> <span class="kc">no-repeat</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ccc</span><span class="p">;</span>
    <span class="k">background-size</span><span class="p">:</span> <span class="kc">cover</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"cover"</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-image: url('./横長.jpeg')"</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"cover"</span> <span class="na">style</span><span class="o">=</span><span class="s">"background-image: url('./縦長.jpeg')"</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</pre></div></div>

<h3>
<span id="221-描画結果" class="fragment"></span><a href="#221-%E6%8F%8F%E7%94%BB%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>2.2.1 描画結果</h3>

<p><a href="https://camo.qiitausercontent.com/fc082a8cee9ada9c4732cb6943d26e2a33d2a871/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f31663133613632322d623431372d613330652d353766302d3130643262653662643332642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/fc082a8cee9ada9c4732cb6943d26e2a33d2a871/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f31663133613632322d623431372d613330652d353766302d3130643262653662643332642e706e67" alt="cover" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/1f13a622-b417-a30e-57f0-10d2be6bd32d.png"></a></p>

<h1>
<span id="3-object-fitを使った実装" class="fragment"></span><a href="#3-object-fit%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>3. <code>object-fit</code>を使った実装</h1>

<p><code>background-size</code>は背景画像を使った一種のハックでしたが、CSS3では<code>object-fit</code>という画像のサムネイル表示にぴったりなプロパティが追加されています。しかし、IEやEdgeが対応待ちになっているので、IE/Edgeをサポートするサイトで今すぐ使うのは難しいかもしれません。</p>

<p><em>object-fitのブラウザ対応状況 <a href="http://caniuse.com/#feat=object-fit" rel="nofollow noopener" target="_blank">Can I use... Support tables for HTML5, CSS3, etc</a>より</em><br>
<a href="https://camo.qiitausercontent.com/63f5263f9b55a593e0528b5a0f39485cf38971dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64383062373137652d383566632d396533632d643066382d3763376363326435383064362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/63f5263f9b55a593e0528b5a0f39485cf38971dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64383062373137652d383566632d396533632d643066382d3763376363326435383064362e706e67" alt="can-i-use-object-fill" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/d80b717e-85fc-9e3c-d0f8-7c7cc2d580d6.png"></a></p>

<p>とはいえ、IE/Edgeが対応すれば、<code>background-size</code>よりもシンプルなCSSになるので、<code>object-fit</code>の実装方法も紹介したいと思います。</p>

<h2>
<span id="31-内接リサイズ" class="fragment"></span><a href="#31-%E5%86%85%E6%8E%A5%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>3.1 内接リサイズ</h2>

<div class="code-frame" data-lang="css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">contain</span> <span class="p">{</span>
  <span class="k">object-fit</span><span class="p">:</span> <span class="kc">contain</span><span class="p">;</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ccc</span><span class="p">;</span>
  <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ccc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"横長.jpeg"</span> <span class="na">class</span><span class="o">=</span><span class="s">"contain"</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"縦長.jpeg"</span> <span class="na">class</span><span class="o">=</span><span class="s">"contain"</span><span class="p">&gt;</span>
</pre></div></div>

<p><a href="http://codepen.io/suin/pen/xZjrar" class="" rel="nofollow noopener" target="_blank">このCSSをCodePenで試す</a></p>

<h3>
<span id="311-描画結果" class="fragment"></span><a href="#311-%E6%8F%8F%E7%94%BB%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>3.1.1 描画結果</h3>

<p><a href="https://camo.qiitausercontent.com/9367eb5f2905fb30e2e58231a69ccec73a771ed0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63313738653231332d326134622d306664652d383663642d3431636564616562646534642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9367eb5f2905fb30e2e58231a69ccec73a771ed0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63313738653231332d326134622d306664652d383663642d3431636564616562646534642e706e67" alt="contain" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/c178e213-2a4b-0fde-86cd-41cedaebde4d.png"></a></p>

<h2>
<span id="32-外接リサイズ" class="fragment"></span><a href="#32-%E5%A4%96%E6%8E%A5%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>3.2 外接リサイズ</h2>

<div class="code-frame" data-lang="css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">cover</span> <span class="p">{</span>
  <span class="k">object-fit</span><span class="p">:</span> <span class="kc">cover</span><span class="p">;</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ccc</span><span class="p">;</span>
  <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ccc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"横長.jpeg"</span> <span class="na">class</span><span class="o">=</span><span class="s">"cover"</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">"縦長.jpeg"</span> <span class="na">class</span><span class="o">=</span><span class="s">"cover"</span><span class="p">&gt;</span>
</pre></div></div>

<p><a href="http://codepen.io/suin/pen/xZjrar" class="" rel="nofollow noopener" target="_blank">このCSSをCodePenで試す</a></p>

<h3>
<span id="321-描画結果" class="fragment"></span><a href="#321-%E6%8F%8F%E7%94%BB%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>3.2.1 描画結果</h3>

<p><a href="https://camo.qiitausercontent.com/fc082a8cee9ada9c4732cb6943d26e2a33d2a871/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f31663133613632322d623431372d613330652d353766302d3130643262653662643332642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/fc082a8cee9ada9c4732cb6943d26e2a33d2a871/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f31663133613632322d623431372d613330652d353766302d3130643262653662643332642e706e67" alt="cover" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/1f13a622-b417-a30e-57f0-10d2be6bd32d.png"></a></p>

<h2>
<span id="4-まとめ" class="fragment"></span><a href="#4-%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>4. まとめ</h2>

<p>CSS3の <code>background-size</code> プロパティや <code>object-fit</code> プロパティを使うとプログラムレスで画像の内接リサイズ・外接リサイズできるということを説明しました。サーバサイドで画像をリサイズしないので、画像の転送量は元画像と同じになってしまいますが、プロダクトのモックアップや初期リリース段階など、ベロシティが要求される場面で使ってみてはいかがでしょうか。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>488</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/0255f0637921dcdfe83b">箱で考えるFunctor、ApplicativeそしてMonad</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-25 23:12:49</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Haskell]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>モナドについて勉強していて見つけた英語記事を翻訳してみました。<br>
誤訳等あれば編集リクエストやコメントください <img alt=":bow:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/twemoji/unicode/1f647.png" title=":bow:" width="20"></p>

<p>原文: <a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html" rel="nofollow noopener" target="_blank">Functors, Applicatives, And Monads In Pictures - adit.io</a></p>

<hr>

<p>ここに単純な値(value)があります。</p>

<p><a href="https://camo.qiitausercontent.com/77fd17d21a8d61838d4f2d46b80f4e6418447b1c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38326333646664652d393866342d663133372d383435372d3334666262353332623131642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/77fd17d21a8d61838d4f2d46b80f4e6418447b1c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38326333646664652d393866342d663133372d383435372d3334666262353332623131642e706e67" alt="value.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/82c3dfde-98f4-f137-8457-34fbb532b11d.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kt">Prelude</span><span class="o">&gt;</span> <span class="mi">2</span>
<span class="mi">2</span>
</pre></div></div>

<p>そして、私たちはこの値に関数を適用する方法を知っています。</p>

<p><a href="https://camo.qiitausercontent.com/22cbff9db5899137dbed9b4bacbd50d4a62ea27e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62306138383333332d333739342d653537352d383962382d3764363833643562336433362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/22cbff9db5899137dbed9b4bacbd50d4a62ea27e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62306138383333332d333739342d653537352d383962382d3764363833643562336433362e706e67" alt="value_apply.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/b0a88333-3794-e575-89b8-7d683d5b3d36.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kt">Prelude</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="mi">2</span>
<span class="mi">5</span>
</pre></div></div>

<p>とても簡単ですね。それでは、ある状態(context)に値が入っていると仮定してみましょう。これからみなさんは値を入れられる状態のことを、箱だと考えてもらって構いません。</p>

<p><a href="https://camo.qiitausercontent.com/9dc9be24178567e23fd1f6d00656fc151767e7ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65303866616266342d386162632d393561382d646332382d3330653736326565323966382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9dc9be24178567e23fd1f6d00656fc151767e7ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65303866616266342d386162632d393561382d646332382d3330653736326565323966382e706e67" alt="value_and_context.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/e08fabf4-8abc-95a8-dc28-30e762ee29f8.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kt">Prelude</span><span class="o">&gt;</span> <span class="kt">Just</span> <span class="mi">2</span>
<span class="kt">Just</span> <span class="mi">2</span>
</pre></div></div>

<p>そして、この値に関数を適用したとき、 <strong>状態によって</strong> 異なる結果が返ります。この考え方に、Functor、Applicative、Monad、Arrowなどがもとづいています。<code>Maybe</code> データ型は2つの状態を定義できます。</p>

<p><a href="https://camo.qiitausercontent.com/f64f3f2e25c10972d85e4d092ec7e1d224e8442c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30383635356431372d363533642d303937302d616435662d3137663238346536623934652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f64f3f2e25c10972d85e4d092ec7e1d224e8442c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30383635356431372d363533642d303937302d616435662d3137663238346536623934652e706e67" alt="context.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/08655d17-653d-0970-ad5f-17f284e6b94e.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kr">data</span> <span class="kt">Maybe</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">Nothing</span> <span class="o">|</span> <span class="kt">Just</span> <span class="n">a</span>
</pre></div></div>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kt">Prelude</span><span class="o">&gt;</span> <span class="kt">:</span><span class="kr">type</span> <span class="kt">Just</span>
<span class="kt">Just</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">a</span>

<span class="kt">Prelude</span><span class="o">&gt;</span> <span class="kt">:</span><span class="kr">type</span> <span class="kt">Nothing</span>
<span class="kt">Nothing</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="n">a</span>
</pre></div></div>

<p>次に、<code>Just a</code> と <code>Nothing</code> それぞれに関数を適用したときどのような違いが出るか見てみましょう。先に Functor について話してみようと思います。</p>

<h1>
<span id="functor" class="fragment"></span><a href="#functor"><i class="fa fa-link"></i></a>Functor</h1>

<p>箱に入っている値に対して、普通の関数を適用することはできません。</p>

<p><a href="https://camo.qiitausercontent.com/b8d258b45802957b5509e7dc22e50d770af0e347/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36613962393631652d386365632d383435312d626234662d3133393639316636353765382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b8d258b45802957b5509e7dc22e50d770af0e347/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36613962393631652d386365632d383435312d626234662d3133393639316636353765382e706e67" alt="no_fmap_ouch.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/6a9b961e-8cec-8451-bb4f-139691f657e8.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kt">Prelude</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">2</span><span class="p">)</span>
 <span class="kt">ERR</span> <span class="o">-</span> <span class="kt">No</span> <span class="kr">instance</span> <span class="n">for</span> <span class="p">(</span><span class="kt">Num</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="n">a0</span><span class="p">))</span>
</pre></div></div>

<p>ここで <code>fmap</code> が登場します。<code>fmap</code>はその道の出身で、状態についてよく知っています。<code>fmap</code> は箱に入っている値にどのような関数を適用しなければならないか分かっています。例えば、 <code>Just 2</code> に <code>(+3)</code> を適用してみましょう。 <code>fmap</code> を使ってみると…</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">fmap</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">2</span><span class="p">)</span>
<span class="kt">Just</span> <span class="mi">5</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/d9914c97539a0ccb15393ae01a711107ce727497/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35636364313032622d303931632d326565632d353164352d6632376233616630383239392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d9914c97539a0ccb15393ae01a711107ce727497/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35636364313032622d303931632d326565632d353164352d6632376233616630383239392e706e67" alt="fmap_apply.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/5ccd102b-091c-2eec-51d5-f27b3af08299.png"></a></p>

<p><strong>ポン!</strong> <code>fmap</code> がやってくれました。では、どのように <code>fmap</code> は関数を適用する方法を知っていたのでしょうか?</p>

<h1>
<span id="functorとは一体何だろうか" class="fragment"></span><a href="#functor%E3%81%A8%E3%81%AF%E4%B8%80%E4%BD%93%E4%BD%95%E3%81%A0%E3%82%8D%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>Functorとは一体何だろうか?</h1>

<p><code>Functor</code> は <a href="http://learnyouahaskell.com/types-and-typeclasses#typeclasses-101" rel="nofollow noopener" target="_blank">typeclass</a> です。ここにその定義があります:</p>

<p><a href="https://camo.qiitausercontent.com/db0a69b1372c7a15f35d0eb1e1d0c31561425be6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61653737333038632d666334362d383331612d363537652d3065386463373331333066322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/db0a69b1372c7a15f35d0eb1e1d0c31561425be6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61653737333038632d666334362d383331612d363537652d3065386463373331333066322e706e67" alt="functor_def.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/ae77308c-fc46-831a-657e-0e8dc73130f2.png"></a></p>

<p><code>Functor</code> は fmap を適用する方法を定義したデータ型です。ここにどのように fmap が動作するのかが出ています。</p>

<p><a href="https://camo.qiitausercontent.com/7b4628695595d9911d2cf77a4c33adeaf61d76fa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35663635323535362d346539322d623430642d303538662d3566646366373734353336312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7b4628695595d9911d2cf77a4c33adeaf61d76fa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35663635323535362d346539322d623430642d303538662d3566646366373734353336312e706e67" alt="fmap_def.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/5f652556-4e92-b40d-058f-5fdcf7745361.png"></a></p>

<p>したがって、私たちは次のようにすることができます。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">fmap</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">2</span><span class="p">)</span>
<span class="kt">Just</span> <span class="mi">5</span>
</pre></div></div>

<p>そして <code>Maybe</code> もまた <code>Functor</code> なので、<code>fmap</code> は魔法のように関数を適用してくれました。どのように <code>fmap</code> が <code>Just</code> と <code>Nothing</code> に適用されるかについてが次に出ています。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kr">instance</span> <span class="kt">Functor</span> <span class="kt">Maybe</span> <span class="kr">where</span>  
    <span class="n">fmap</span> <span class="n">func</span> <span class="p">(</span><span class="kt">Just</span> <span class="n">val</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">func</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">fmap</span> <span class="n">func</span> <span class="kt">Nothing</span> <span class="ow">=</span> <span class="kt">Nothing</span> 
</pre></div></div>

<p>ここに <code>fmap (+3) (Just 2)</code> と打ったとき、裏でどんなことが起こるかが現れています。</p>

<p><a href="https://camo.qiitausercontent.com/4ae26d21f98ca0e090f6aeb93b4e3085691fa46b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30363139323338652d383331642d633632612d643166632d6362323231383733633930362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4ae26d21f98ca0e090f6aeb93b4e3085691fa46b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30363139323338652d383331642d633632612d643166632d6362323231383733633930362e706e67" alt="fmap_just.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/0619238e-831d-c62a-d1fc-cb221873c906.png"></a></p>

<p>それでは、 <code>(+3)</code> を <code>Nothing</code> に適用してみてください。</p>

<p><a href="https://camo.qiitausercontent.com/5e9195517731d21d425dddd418d0c4f2179417a2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33373164393562312d653330372d306233322d363962632d6431363766646237643538652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5e9195517731d21d425dddd418d0c4f2179417a2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33373164393562312d653330372d306233322d363962632d6431363766646237643538652e706e67" alt="fmap_nothing.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/371d95b1-e307-0b32-69bc-d167fdb7d58e.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">fmap</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="kt">Nothing</span>
<span class="kt">Nothing</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/a5ec0331e1d79f1e9933045cc987a01fa34ff7d8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35663538386566302d633035392d363063312d333065632d6231333036373764353665652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a5ec0331e1d79f1e9933045cc987a01fa34ff7d8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35663538386566302d633035392d363063312d333065632d6231333036373764353665652e706e67" alt="bill.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/5f588ef0-c059-60c1-30ec-b130677d56ee.png"></a></p>

<p><em>Maybe functorも知らないBill O'Reilly</em></p>

<p>マトリックスのモーフィアスのように、<code>fmap</code> は何をしなければならないか知っています。 <code>Nothing</code> で始まり、<code>Nothing</code> で終わる! <code>fmap</code> は禅です。では、<code>Maybe</code> データ型がなぜ存在するのか考えてみましょう。例えば、 <code>Maybe</code> がない言語で、データベースのレコードを扱おうとしたらこうなります。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find_by_id</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">if</span> <span class="n">post</span>
  <span class="k">return</span> <span class="n">post</span><span class="o">.</span><span class="n">title</span>
<span class="k">else</span>
  <span class="k">return</span> <span class="kp">nil</span>
<span class="k">end</span>
</pre></div></div>

<p>しかし、Haskellは次のようにできます。</p>

<div class="code-frame" data-lang="hakskell"><div class="highlight"><pre><span></span>fmap (getPostTitle) (findPost 1)
</pre></div></div>

<p>もしも、<code>findPost</code> が投稿(post)を返すならば、<code>getPostTitle</code>でタイトルを得ることができます。 <code>Nothing</code> を返したら、<code>Nothing</code> を得るのです。とっても簡単じゃないですか? <code>fmap</code> の周囲表記(infix) バージョンは <code>&lt;$&gt;</code> で、次のように書くこともできます。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="nf">getPostTitle</span> <span class="o">&lt;$&gt;</span> <span class="p">(</span><span class="n">findPost</span> <span class="mi">1</span><span class="p">)</span>
</pre></div></div>

<p>ここにもう一つの例があります。リストに関数を適用したらどんなことが起こるでしょうか?</p>

<p><a href="https://camo.qiitausercontent.com/9f7d99d68e017b14295d25223e96cfa238dcaa3b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63316264373430342d383765382d366430322d383738332d6261326464633665636363382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9f7d99d68e017b14295d25223e96cfa238dcaa3b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63316264373430342d383765382d366430322d383738332d6261326464633665636363382e706e67" alt="fmap_list.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/c1bd7404-87e8-6d02-8783-ba2ddc6eccc8.png"></a></p>

<p>リストもやはり functor だったのです! ここにその定義があります。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kr">instance</span> <span class="kt">Functor</span> <span class="kt">[]</span> <span class="kr">where</span>
    <span class="n">fmap</span> <span class="ow">=</span> <span class="n">map</span>
</pre></div></div>

<p>ではでは、最後にもう一つ例を。関数にまた別の関数を適用しようとしたらどんなことがおこるでしょうか?</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="nf">fmap</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div></div>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kt">Prelude</span><span class="o">&gt;</span> <span class="kt">:</span><span class="kr">type</span> <span class="n">fmap</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">fmap</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Functor</span> <span class="p">((</span><span class="ow">-&gt;</span><span class="p">)</span> <span class="n">b</span><span class="p">),</span> <span class="kt">Num</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span>
</pre></div></div>

<p>ここにある関数があります。</p>

<p><a href="https://camo.qiitausercontent.com/47119cd9453cb1e82a40c1faf8f1eda8583a8769/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35376664623836662d643732302d323061322d343261372d3664303361633539613366322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/47119cd9453cb1e82a40c1faf8f1eda8583a8769/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35376664623836662d643732302d323061322d343261372d3664303361633539613366322e706e67" alt="function_with_value.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/57fdb86f-d720-20a2-42a7-6d03ac59a3f2.png"></a></p>

<p>関数にまた別の関数を適用してみようと思います。</p>

<p><a href="https://camo.qiitausercontent.com/3ac0b5be156af04218027e76ff9c85da23242c30/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39653636316466612d396266662d356136392d353637652d3431343137336431393264312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3ac0b5be156af04218027e76ff9c85da23242c30/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39653636316466612d396266662d356136392d353637652d3431343137336431393264312e706e67" alt="fmap_function.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/9e661dfa-9bff-5a69-567e-414173d192d1.png"></a></p>

<p>結果もやはり関数でした。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="kr">import</span> <span class="nn">Control.Applicative</span>
<span class="o">&gt;</span> <span class="kr">let</span> <span class="n">foo</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">foo</span> <span class="mi">10</span>
<span class="mi">15</span>
</pre></div></div>

<p>したがって、関数も Functor なのです。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kr">instance</span> <span class="kt">Functor</span> <span class="p">((</span><span class="ow">-&gt;</span><span class="p">)</span> <span class="n">r</span><span class="p">)</span> <span class="kr">where</span>  
    <span class="n">fmap</span> <span class="n">f</span> <span class="n">g</span> <span class="ow">=</span> <span class="n">f</span> <span class="o">.</span> <span class="n">g</span>
</pre></div></div>

<p>関数に fmap を使用すると、関数の合成(function composition)をしたのと同じです。</p>

<h1>
<span id="applicative" class="fragment"></span><a href="#applicative"><i class="fa fa-link"></i></a>Applicative</h1>

<p>次の段階のApplicativeに進んでみましょう。Functorでやってみたように、箱に値を入れます。</p>

<p><a href="https://camo.qiitausercontent.com/9dc9be24178567e23fd1f6d00656fc151767e7ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65303866616266342d386162632d393561382d646332382d3330653736326565323966382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9dc9be24178567e23fd1f6d00656fc151767e7ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65303866616266342d386162632d393561382d646332382d3330653736326565323966382e706e67" alt="value_and_context.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/e08fabf4-8abc-95a8-dc28-30e762ee29f8.png"></a></p>

<p>そして、関数もまた箱に入れられるのです!</p>

<p><a href="https://camo.qiitausercontent.com/15543b22faa4bda91c4ed7ef8dfaae746cd2ed37/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65653834396334632d393830382d323433332d323161642d3935343937353538336535632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/15543b22faa4bda91c4ed7ef8dfaae746cd2ed37/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65653834396334632d393830382d323433332d323161642d3935343937353538336535632e706e67" alt="function_and_context.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/ee849c4c-9808-2433-21ad-954975583e5c.png"></a></p>

<p>はい、じゃあ詳しく見てみましょう。Applicativeもバカじゃありません。<code>Control.Applicative</code> は <code>&lt;*&gt;</code>  を定義していて、 <strong>箱の中の</strong> 値に、 <strong>箱の中の</strong> 関数を適用する方法を知っています。</p>

<p><a href="https://camo.qiitausercontent.com/b70fd34a47ddc36e67c47d5babc38abfa5d45f41/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33356639313466342d353661622d313838362d353461632d6163316339313430633664312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b70fd34a47ddc36e67c47d5babc38abfa5d45f41/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33356639313466342d353661622d313838362d353461632d6163316339313430633664312e706e67" alt="applicative_just.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/35f914f4-56ab-1886-54ac-ac1c9140c6d1.png"></a></p>

<p>なので、次のようなことができます。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kt">Just</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="kt">Just</span> <span class="mi">2</span> <span class="o">==</span> <span class="kt">Just</span> <span class="mi">5</span>
</pre></div></div>

<p><code>&lt;*&gt;</code> を使うと少し面白い結果を得ることができます。例えばこんな。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">[(</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">)]</span> <span class="o">&lt;*&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/00950b6c560865f0b7753a9831a47c5b326d8b2d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63636237346133622d353130632d323662662d356362322d6633623730613730396132352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/00950b6c560865f0b7753a9831a47c5b326d8b2d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63636237346133622d353130632d323662662d356362322d6633623730613730396132352e706e67" alt="applicative_list.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/ccb74a3b-510c-26bf-5cb2-f3b70a709a25.png"></a></p>

<p>ここでFunctorにはできなかったけど、Applicativeにはできることが出てきます。どうやって、中に値が入ってる2つの箱に、2つの引数を取る関数を適用するのでしょうか?</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="o">&lt;$&gt;</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">5</span><span class="p">)</span>
<span class="kt">Just</span> <span class="p">(</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="kt">Just</span> <span class="p">(</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span> <span class="o">&lt;$&gt;</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">4</span><span class="p">)</span>
<span class="kt">ERROR</span> <span class="o">???</span> <span class="kt">WHAT</span> <span class="kt">DOES</span> <span class="kt">THIS</span> <span class="kt">EVEN</span> <span class="kt">MEAN</span> <span class="kt">WHY</span> <span class="kt">IS</span> <span class="kt">THE</span> <span class="kt">FUNCTION</span> <span class="kt">WRAPPED</span> <span class="kt">IN</span> <span class="kt">A</span> <span class="kt">JUST</span>
</pre></div></div>

<p>Applicativeなら:</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span> <span class="o">&lt;$&gt;</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">5</span><span class="p">)</span>
<span class="kt">Just</span> <span class="p">(</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="kt">Just</span> <span class="p">(</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span> <span class="o">&lt;*&gt;</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">3</span><span class="p">)</span>
<span class="kt">Just</span> <span class="mi">8</span>
</pre></div></div>

<p><code>Functor</code> を横に追いやりながら <code>Applicative</code> は言います。</p>

<p>「大物は引数をいくつ取る関数だって扱えるんだぜ?」</p>

<p>「<code>&lt;$&gt;</code> と <code>&lt;*&gt;</code> を使ってオレは、箱を開いてみることができない関数どもに、箱の中の値を渡してやって、しまいに値を箱にいれて返すこともできるのさ! ぷははは!」</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&lt;$&gt;</span> <span class="kt">Just</span> <span class="mi">5</span> <span class="o">&lt;*&gt;</span> <span class="kt">Just</span> <span class="mi">3</span>
<span class="kt">Just</span> <span class="mi">15</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/f9c69f7c159540b16e9415442cf71341e9755eed/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f31383864346265332d333666302d663939302d643837632d6566376234303435353663652e676966" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f9c69f7c159540b16e9415442cf71341e9755eed/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f31383864346265332d333666302d663939302d643837632d6566376234303435353663652e676966" alt="TaTdV.gif" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/188d4be3-36f0-f990-d87c-ef7b404556ce.gif"></a></p>

<p><em>functorが関数を適用するのを見ていたapplicative</em></p>

<p>でもちょっと待って! ここに同じことをする <code>liftA2</code> もいます。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">liftA2</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="kt">Just</span> <span class="mi">3</span><span class="p">)</span>
<span class="kt">Just</span> <span class="mi">15</span>
</pre></div></div>

<h1>
<span id="monad" class="fragment"></span><a href="#monad"><i class="fa fa-link"></i></a>Monad</h1>

<p>モナドを学ぶ方法:</p>

<ol>
<li>情報工学の博士号を取る</li>
<li>ここでは博士号は要らないので取らない</li>
</ol>

<p>モナドは新しい解法を提示しました。</p>

<p>Functorは箱に入っている値に関数を適用できます。</p>

<p><a href="https://camo.qiitausercontent.com/c926f4c8a9d6f5477dac9926da22c4f3adf8cfd2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f66386338636364372d386534632d643138332d663165622d6335656165633134313164612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c926f4c8a9d6f5477dac9926da22c4f3adf8cfd2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f66386338636364372d386534632d643138332d663165622d6335656165633134313164612e706e67" alt="fmap.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/f8c8ccd7-8e4c-d183-f1eb-c5eaec1411da.png"></a></p>

<p>Applicativeは箱に入っている値に、箱に入っている関数を適用できます。</p>

<p><a href="https://camo.qiitausercontent.com/210efa53a9621c6a8115b513126d8616ff3aaef5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61326634303565652d393231642d666530342d376532302d3532306532613366393463342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/210efa53a9621c6a8115b513126d8616ff3aaef5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61326634303565652d393231642d666530342d376532302d3532306532613366393463342e706e67" alt="applicative.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/a2f405ee-921d-fe04-7e20-520e2a3f94c4.png"></a></p>

<p>モナドは箱に入っている値に、 <strong>箱に入った値を返す</strong> 関数を適用できます。</p>

<p>モナドはこのようなことをする("bind"と呼ばれる) <code>&gt;&gt;=</code> という関数を持っています。</p>

<p>例を見てみましょう。これまでに見てきた <code>Maybe</code> はモナドです。</p>

<p><a href="https://camo.qiitausercontent.com/f64f3f2e25c10972d85e4d092ec7e1d224e8442c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30383635356431372d363533642d303937302d616435662d3137663238346536623934652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f64f3f2e25c10972d85e4d092ec7e1d224e8442c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30383635356431372d363533642d303937302d616435662d3137663238346536623934652e706e67" alt="context.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/08655d17-653d-0970-ad5f-17f284e6b94e.png"></a></p>

<p><em>遊んでたJust aモナド</em></p>

<p>偶数に対してだけ動作する関数、<code>half</code>があると仮定してみましょう。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="nf">half</span> <span class="n">x</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">even</span> <span class="n">x</span>
           <span class="kr">then</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">x</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">2</span><span class="p">)</span>
           <span class="kr">else</span> <span class="kt">Nothing</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/58270f9c45bd6279d1e16d433acd8a15df8f569c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32396563323139352d353932632d393932622d356537382d3631313465303030636232332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/58270f9c45bd6279d1e16d433acd8a15df8f569c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32396563323139352d353932632d393932622d356537382d3631313465303030636232332e706e67" alt="half.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/29ec2195-592c-992b-5e78-6114e000cb23.png"></a></p>

<p>値が入っている箱を入れてみるとどうなるでしょうか?</p>

<p><a href="https://camo.qiitausercontent.com/ca3f5a71bf461744f95375fd46cea5d1857e5df0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39336133626538642d646139622d383833312d326562332d3538343464653133633730332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ca3f5a71bf461744f95375fd46cea5d1857e5df0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39336133626538642d646139622d383833312d326562332d3538343464653133633730332e706e67" alt="half_ouch.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/93a3be8d-da9b-8831-2eb3-5844de13c703.png"></a></p>

<p>関数に値が入っている箱を押し込めたいなら、<code>&gt;&gt;=</code> が必要です。ここに <code>&gt;&gt;=</code> の写真があります。</p>

<p><a href="https://camo.qiitausercontent.com/d489b23e95b031a5a7517c8e633be53b3dbcac9a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65346336643166302d643930302d616364392d656566362d3638343265353034383638622e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d489b23e95b031a5a7517c8e633be53b3dbcac9a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65346336643166302d643930302d616364392d656566362d3638343265353034383638622e6a706567" alt="plunger.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/e4c6d1f0-d900-acd9-eef6-6842e504868b.jpeg"></a></p>

<p>どんなふうに動作するのか確認してみましょう。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="kt">Just</span> <span class="mi">3</span> <span class="o">&gt;&gt;=</span> <span class="n">half</span>
<span class="kt">Nothing</span>
<span class="o">&gt;</span> <span class="kt">Just</span> <span class="mi">4</span> <span class="o">&gt;&gt;=</span> <span class="n">half</span>
<span class="kt">Just</span> <span class="mi">2</span>
<span class="o">&gt;</span> <span class="kt">Nothing</span> <span class="o">&gt;&gt;=</span> <span class="n">half</span>
<span class="kt">Nothing</span>
</pre></div></div>

<p>内部でどんなことが起こっているのでしょうか? <code>Monad</code>はまた別の<a href="http://learnyouahaskell.com/types-and-typeclasses#typeclasses-101" rel="nofollow noopener" target="_blank">typeclass</a>です。ここに定義の一部が載っています。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kr">class</span> <span class="kt">Monad</span> <span class="n">m</span> <span class="kr">where</span>    
    <span class="p">(</span><span class="o">&gt;&gt;=</span><span class="p">)</span> <span class="ow">::</span> <span class="n">m</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">b</span>  
</pre></div></div>

<p><code>&gt;&gt;=</code>は、</p>

<p><a href="https://camo.qiitausercontent.com/6aab91014c569b523bbd96bfc554515dc9232015/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64613534353265302d333036632d346230622d326362352d6361623662316661636530332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6aab91014c569b523bbd96bfc554515dc9232015/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64613534353265302d333036632d346230622d326362352d6361623662316661636530332e706e67" alt="bind_def.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/da5452e0-306c-4b0b-2cb5-cab6b1face03.png"></a></p>

<p>したがって、<code>Maybe</code>はモナドです。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="kr">instance</span> <span class="kt">Monad</span> <span class="kt">Maybe</span> <span class="kr">where</span>
    <span class="kt">Nothing</span> <span class="o">&gt;&gt;=</span> <span class="n">func</span> <span class="ow">=</span> <span class="kt">Nothing</span>
    <span class="kt">Just</span> <span class="n">val</span> <span class="o">&gt;&gt;=</span> <span class="n">func</span>  <span class="ow">=</span> <span class="n">func</span> <span class="n">val</span>
</pre></div></div>

<p>ここに <code>Just 3</code> についてどうやって動作しているか載っています!</p>

<p><a href="https://camo.qiitausercontent.com/1dab1c3b6b9048d38ce7d4d3a8b3067dd6adc5ce/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37333731616663632d613362652d616365642d393137382d3564363933393338396135372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1dab1c3b6b9048d38ce7d4d3a8b3067dd6adc5ce/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37333731616663632d613362652d616365642d393137382d3564363933393338396135372e706e67" alt="monad_just.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/7371afcc-a3be-aced-9178-5d6939389a57.png"></a></p>

<p><code>Nothing</code> を入れるともっと単純になります。</p>

<p><a href="https://camo.qiitausercontent.com/e2412353210147e3e8b151e2d12e8e26c6530113/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62373733613238392d623265392d333861352d343762352d6538353536383939306236662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e2412353210147e3e8b151e2d12e8e26c6530113/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62373733613238392d623265392d333861352d343762352d6538353536383939306236662e706e67" alt="monad_nothing.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/b773a289-b2e9-38a5-47b5-e85568990b6f.png"></a></p>

<p>このようにチェーン(chain)で呼び出すこともできます。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="kt">Just</span> <span class="mi">20</span> <span class="o">&gt;&gt;=</span> <span class="n">half</span> <span class="o">&gt;&gt;=</span> <span class="n">half</span> <span class="o">&gt;&gt;=</span> <span class="n">half</span>
<span class="kt">Nothing</span>
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/409ebe108f354532f1fc40d85a45f6cd7403c15a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36356138643732392d376234342d393162342d353332642d3731356263656135623837652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/409ebe108f354532f1fc40d85a45f6cd7403c15a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36356138643732392d376234342d393162342d353332642d3731356263656135623837652e706e67" alt="monad_chain.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/65a8d729-7b44-91b4-532d-715bcea5b87e.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/29b0e03755179779874990083117979103c5afbb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39396533386666622d316437322d616230352d333265382d3934383262616133303939332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/29b0e03755179779874990083117979103c5afbb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39396533386666622d316437322d616230352d333265382d3934383262616133303939332e706e67" alt="whoa.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/99e38ffb-1d72-ab05-32e8-9482baa30993.png"></a></p>

<p>カッチョイイです。もう私たちは <code>Maybe</code> が <code>Functor</code> であり、<code>Applicative</code> であり、<code>Monad</code> であることが分かりました。</p>

<p>それではそろそろ、<code>IO</code>モナドの例に行ってみましょう。</p>

<p><a href="https://camo.qiitausercontent.com/99d05d06398428ba4381a640a809bf6c113548b3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34323838613533332d303966612d633364322d623633622d6139656531653463356463622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/99d05d06398428ba4381a640a809bf6c113548b3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34323838613533332d303966612d633364322d623633622d6139656531653463356463622e706e67" alt="io.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/4288a533-09fa-c3d2-b63b-a9ee1e4c5dcb.png"></a></p>

<blockquote>
<p>訳注: 数字の10ではなく、英語のIO</p>
</blockquote>

<p>3つの特別な関数があります。 <code>getLine</code> は引数を取らず、ユーザの入力を受け取ります。</p>

<p><a href="https://camo.qiitausercontent.com/9df9165242b72786d5b414a77789477867c023cb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37643461346231642d393364302d376234632d396236382d3464636237333539333733372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9df9165242b72786d5b414a77789477867c023cb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37643461346231642d393364302d376234632d396236382d3464636237333539333733372e706e67" alt="getLine.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/7d4a4b1d-93d0-7b4c-9b68-4dcb73593737.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="nf">getLine</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">String</span>
</pre></div></div>

<p><code>readFile</code> は文字列(ファイル名)を受け取り、ファイルの中身を返します。</p>

<p><a href="https://camo.qiitausercontent.com/92ad555b710771376c78a7633102bd505f58cf10/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64303764343339372d373066302d623931612d616634352d6237643334353835656265332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/92ad555b710771376c78a7633102bd505f58cf10/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64303764343339372d373066302d623931612d616634352d6237643334353835656265332e706e67" alt="readFile.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/d07d4397-70f0-b91a-af45-b7d34585ebe3.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="nf">readFile</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">String</span>
</pre></div></div>

<p><code>putStrLn</code> は文字列を受け取り出力します。</p>

<p><a href="https://camo.qiitausercontent.com/8ab689abbda1c84651bf23d15ceb5e595a99b1e5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65363639656132652d633863342d326533352d303336302d3031393966333665626131642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8ab689abbda1c84651bf23d15ceb5e595a99b1e5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65363639656132652d633863342d326533352d303336302d3031393966333665626131642e706e67" alt="putStrLn.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/e669ea2e-c8c4-2e35-0360-0199f36eba1d.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="nf">putStrLn</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
</pre></div></div>

<p>ここに出てきた3つの関数は普通の値を受け取り(または何も受け取らず)、値が入っている箱を返します。したがって、私たちはこれを <code>&gt;&gt;=</code> でつなぐことができます。</p>

<p><a href="https://camo.qiitausercontent.com/6e5c06bafa748fb03ea2ac1bb2ec68094fdbc9b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64626133346432382d356533392d616637362d323030352d6635363361366533313130322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6e5c06bafa748fb03ea2ac1bb2ec68094fdbc9b6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64626133346432382d356533392d616637362d323030352d6635363361366533313130322e706e67" alt="monad_io.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/dba34d28-5e39-af76-2005-f563a6e31102.png"></a></p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="nf">getLine</span> <span class="o">&gt;&gt;=</span> <span class="n">readFile</span> <span class="o">&gt;&gt;=</span> <span class="n">putStrLn</span>
</pre></div></div>

<p>なんということでしょう! モナドのショーが巻き起こりました!</p>

<p>付け加えると、Haskellはこのモナドについて、<code>do</code> というシュガーシンタクスを提供してくれています。</p>

<div class="code-frame" data-lang="haskell"><div class="highlight"><pre><span></span><span class="nf">foo</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="n">filename</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>
    <span class="n">contents</span> <span class="ow">&lt;-</span> <span class="n">readFile</span> <span class="n">filename</span>
    <span class="n">putStrLn</span> <span class="n">contents</span>
</pre></div></div>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<ol>
<li>functorは <code>Functor</code> 型クラスを実装したデータ型。</li>
<li>applicativeは <code>Applicative</code> 型クラスを実装したデータ型。</li>
<li>モナドは <code>Monad</code> 型クラスを実装したデータ型。</li>
<li>
<code>Maybe</code> はこの3つをすべて実装しており、functorでありapplicativeでありモナドでもある。</li>
</ol>

<p>この3つの違いは何か?</p>

<p><a href="https://camo.qiitausercontent.com/39a9d575095ac6384bde8cf4a6419b62b7bb498b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38656461363532662d313839662d326432322d636133662d6363393065366537373337642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/39a9d575095ac6384bde8cf4a6419b62b7bb498b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38656461363532662d313839662d326432322d636133662d6363393065366537373337642e706e67" alt="recap.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/8eda652f-189f-2d22-ca3f-cc90e6e7737d.png"></a></p>

<ul>
<li>functor: <code>fmap</code> や <code>&lt;$&gt;</code> を使って、箱の中の値に関数を適用できる</li>
<li>applicative: <code>liftA</code> や <code>&lt;*&gt;</code> を使って、箱のなかの関数を箱の中の値に適用できる</li>
<li>モナド: <code>liftM</code> や <code>&gt;&gt;=</code> を使って、箱に入った値を返す関数を箱の中の値に適用できる</li>
</ul>

<p>わたしたちはみんな、モナドというものが簡単で粋な概念だということについて、同意することと思います。このガイドで満足のはまだ早いです。<a href="http://learnyouahaskell.com/a-fistful-of-monads" rel="nofollow noopener" target="_blank">LYAH’s section on Monads</a>をチェックしてみてください。Miranがすでにモナドに関する深く素晴らしい働きをしているので、だいぶざっくり説明してきました。</p>

<p><a href="http://habrahabr.ru/post/183150/" rel="nofollow noopener" target="_blank">ロシア語バージョン</a>もあります。もっとモナドと絵を見たい方は <a href="http://adit.io/posts/2013-06-10-three-useful-monads.html" rel="nofollow noopener" target="_blank">three useful monads</a>を見てみてください。</p>

<blockquote>
<p>訳注: <a href="https://github.com/netpyoung/netpyoung.Notes/tree/master/external/haskell/functors_applicatives_and_monads_in_pictures" rel="nofollow noopener" target="_blank">韓国語版</a>、<a href="http://jiyinyiyong.github.io/monads-in-pictures/" rel="nofollow noopener" target="_blank">中国語版</a>もあります。</p>
</blockquote>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>354</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/26162a4ebcbbb351b879">PHPerがMacbookAirを買ったら直ぐにすること 2012 </a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-04-13 23:17:17</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[Mac]</b> <b>[MySQL]</b> <b>[Apache]</b> <b>[homebrew]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ちょっと大げさなタイトルですが、あくまで私個人の環境構築手順をまとめたものです。WindowsからMacに乗り換えたばかりで、どうやってPHPの開発環境を整えるか分からないPHPerに向けの「開発環境を整えるためのガイド」と考えてください。</p>

<p>既にMacでAMP環境を構築したことがあるPHPerにとっても有用な情報を含めたつもりです。その例としては、php-buildとphp-versionで複数PHPバージョン環境の構築の手順、複数PHPバージョンとApacheの連携方法などがあります。</p>

<p>MacをUnix的に使えるようにするため、CUIで設定する手順を含んでいますが、怖がらずにやってみてください。ターミナルはあなたに噛み付いたりしません :) CUIに慣れてない方は、「難しい」と感じるかもしれませんが、きっとのちのちの財産になるはずです！</p>

<p>2012年版では「PHPerがMacbookAirを買ったら直ぐにすること」の<a href="http://suin.asia/2011/03/06/macbookair_kick_start_for_phper" rel="nofollow noopener" target="_blank">2011年版</a>をベースに、トレンドを取り入れたり、導入方法が変わっているものについては手順を修正しました。昨年版で紹介したMacPortsはHomebrewに置き換えました。またXcodeはAppStoreで入手できるようになったため手順を改めました。</p>

<h2>
<span id="phperがmacbookairを買ったら直ぐにすること" class="fragment"></span><a href="#phper%E3%81%8Cmacbookair%E3%82%92%E8%B2%B7%E3%81%A3%E3%81%9F%E3%82%89%E7%9B%B4%E3%81%90%E3%81%AB%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>PHPerがMacbookAirを買ったら直ぐにすること</h2>

<ol>
<li>ローカルアカウントの作成</li>
<li>Xcodeのダウンロード&amp;インストール</li>
<li>エディター/IDEのダウンロード&amp;インストール</li>
<li>ブラウザのダウンロード&amp;インストール</li>
<li>共有の設定</li>
<li>ターミナルのセットアップ</li>
<li>Homebrewのダウンロード&amp;インストール</li>
<li>Apache + MySQL + PHP のセットアップ</li>
<li>SSHのセットアップ</li>
</ol>

<h1>
<span id="ローカルアカウントの作成" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>ローカルアカウントの作成</h1>

<p>「アカウント名」にコダワリのある人は注意して入力しましょう。アカウント名はユーザディレクトリのディレクトリ名になります。後で変えるのはめんどくさいです。私はWeb上のハンドルネーム suin を必ず入力します。</p>

<h1>
<span id="xcodeのダウンロードインストール" class="fragment"></span><a href="#xcode%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Xcodeのダウンロード&amp;インストール</h1>

<p>XcodeはiOS/Macアプリを開発するためのツールですが、iOS/Macアプリを作らないPHPerにとっても便利な開発ツールが詰まってるのでインストールしておくことをお勧めします。 XcodeはMac App Storeから無料でダウンロードできます。 Xcodeは容量が大きいため時間がかかるので、まず最初にダウンロードを始めておきます。ダウンロードするためにはApple IDが必要なのであらかじめ作っておきます。</p>

<h1>
<span id="エディターideのダウンロードインストール" class="fragment"></span><a href="#%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%83%BCide%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>エディター/IDEのダウンロード&amp;インストール</h1>

<p>自分がよく使うエディタがあればそれを入れます。Macを始めたばかりでどんなエディタがあるかよく分からない人は、とりあえず <a href="http://sourceforge.jp/projects/coteditor/" rel="nofollow noopener" target="_blank">CotEditor</a>、<a href="http://www.panic.com/jp/coda/" rel="nofollow noopener" target="_blank">Coda</a>、<a href="http://macromates.com/" rel="nofollow noopener" target="_blank">TextMate</a>、<a href="http://code.google.com/p/macvim-kaoriya/" rel="nofollow noopener" target="_blank">MacVim</a>をすべてインストールしてみて自分に合うものを探しましょう。</p>

<p>PHP用のIDEとしてはPhpStromを入れておきます。</p>

<p><em>vimを使わない人、vimがなんだか分からないは CotEditor を入れてください。このあとのチュートリアルで使います。</em></p>

<h1>
<span id="ブラウザのダウンロードインストール" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ブラウザのダウンロード&amp;インストール</h1>

<p>主要なブラウザはこの際、いれておきましょう。</p>

<ul>
<li><a href="http://mozilla.jp/firefox/" rel="nofollow noopener" target="_blank">Firefox</a></li>
<li><a href="http://www.google.co.jp/chrome/intl/ja/landing.html" rel="nofollow noopener" target="_blank">Google Chrome</a></li>
<li><a href="http://jp.opera.com/" rel="nofollow noopener" target="_blank">Opera</a></li>
</ul>

<h1>
<span id="ユーティリティのダウンロードインストール" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ユーティリティのダウンロード&amp;インストール</h1>

<ul>
<li>
<a href="http://mattpatenaude.com/" rel="nofollow noopener" target="_blank">Colors</a>: シンプルなカラーピッカー。</li>
<li>
<a href="https://www.dropbox.com/" rel="nofollow noopener" target="_blank">Dropbox</a>: オンラインストレージ。</li>
<li>
<a href="http://www.redwinder.com/macapp/hoster/" rel="nofollow noopener" target="_blank">Hoster</a>: hostsファイルをGUIで設定するアプリ。</li>
<li>
<a href="http://www.sequelpro.com/" rel="nofollow noopener" target="_blank">Sequel Pro</a>: MySQLのGUIクライアント。phpMyAdminより便利。</li>
<li>
<a href="http://www.skype.com/intl/ja/home/" rel="nofollow noopener" target="_blank">Skype</a>: チャット・音声通話アプリ。</li>
<li>
<a href="http://www.alfredapp.com/" rel="nofollow noopener" target="_blank">Alfred</a>: アプリケーションランチャー。</li>
<li>
<a href="http://totalterminal.binaryage.com/" rel="nofollow noopener" target="_blank">Total Terminal</a>: ショートカットキーでTerminalを起動できる。</li>
</ul>

<h1>
<span id="共有の設定" class="fragment"></span><a href="#%E5%85%B1%E6%9C%89%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>共有の設定</h1>

<p>Dockにある「システム環境設定」から「共有」を開き、共有の設定をします。</p>

<p><a href="https://camo.qiitausercontent.com/214a170eac7662f3ffd740bb9b66a888b6a0b284/68747470733a2f2f6c68332e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e61473964515974492f4141414141414141425a492f457359642d7255647050772f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e30382e32342545462542432538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/214a170eac7662f3ffd740bb9b66a888b6a0b284/68747470733a2f2f6c68332e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e61473964515974492f4141414141414141425a492f457359642d7255647050772f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e30382e32342545462542432538392e706e67" alt="" data-canonical-src="https://lh3.googleusercontent.com/_dG0BBWAhWis/TXNaG9dQYtI/AAAAAAAABZI/EsYd-rUdpPw/s400/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%EF%BC%882011-03-06%2017.08.24%EF%BC%89.png"></a></p>

<h2>
<span id="コンピュータ名を設定" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E5%90%8D%E3%82%92%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>「コンピュータ名」を設定</h2>

<p>デフォルトだと「○○ ○○ の MackBook Air」となっていますが、これだと長すぎるので短く簡潔な名前に変更します。例えば、私のアカウント名はsuinなので、SuinMacbookAirのようにします。こうすることで、HTTPでMAMPにアクセスするときや、SSHでリモートログインするときに、<a href="http://suinmacbookair.local/" class="autolink" rel="nofollow noopener" target="_blank">http://suinmacbookair.local/</a> や ssh <a href="mailto:suin@suinmacbookair.local" class="autolink">suin@suinmacbookair.local</a> のようにでき、複数のマシン・グループでのウェブ開発の利便性が高まります。</p>

<h2>
<span id="ファイル共有をonにする" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%85%B1%E6%9C%89%E3%82%92on%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>「ファイル共有」をONにする</h2>

<p>他のマシンからMacbookAirの共有フォルダを参照できるようになります。</p>

<h2>
<span id="リモートログインをonにする" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92on%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>「リモートログイン」をONにする</h2>

<p>SSHで他のマシンからMacbookAirにログインできるようになります。</p>

<h1>
<span id="ターミナルのセットアップ" class="fragment"></span><a href="#%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>ターミナルのセットアップ</h1>

<p>「ターミナル」はWindowsでいう「コマンドプロンプト」です。コマンドラインに詳しくない人でも、そのうち必ず使うようになるので、設定しておきましょう。ターミナルは「アプリケーション」→「ユーティリティ」にあります。デフォルトだと味気ないアプリなので、いろいろ設定をしてやりましょう。</p>

<p><a href="https://camo.qiitausercontent.com/2504d055f8bbe2769473ef294a41e108dc800aaf/68747470733a2f2f6c68342e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e614852566e5047492f4141414141414141425a512f7037414b6c306b62354b382f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e32392e35392545462542432538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2504d055f8bbe2769473ef294a41e108dc800aaf/68747470733a2f2f6c68342e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e614852566e5047492f4141414141414141425a512f7037414b6c306b62354b382f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e32392e35392545462542432538392e706e67" alt="" data-canonical-src="https://lh4.googleusercontent.com/_dG0BBWAhWis/TXNaHRVnPGI/AAAAAAAABZQ/p7AKl0kb5K8/s400/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%EF%BC%882011-03-06%2017.29.59%EF%BC%89.png"></a></p>

<h2>
<span id="ターミナルの見た目をプロにしよう" class="fragment"></span><a href="#%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AE%E8%A6%8B%E3%81%9F%E7%9B%AE%E3%82%92%E3%83%97%E3%83%AD%E3%81%AB%E3%81%97%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>ターミナルの見た目をプロにしよう</h2>

<ul>
<li>「アプリケーション」→「ユーティリティ」→「ターミナル」を起動する。</li>
<li>メニューバーから「ターミナル」→「環境設定」を開く。</li>
<li>「起動」タブを開く。</li>
<li>「起動時に開く：次の設定の新しいウィンドウ」のセレクトボックスから「Pro」を選択する。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/2b1200b23d2102212d468462a0f80eae9326b634/68747470733a2f2f6c68332e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e6148686f353559492f4141414141414141425a592f454479725f6e616437716f2f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e33322e32352545462542432538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2b1200b23d2102212d468462a0f80eae9326b634/68747470733a2f2f6c68332e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e6148686f353559492f4141414141414141425a592f454479725f6e616437716f2f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e33322e32352545462542432538392e706e67" alt="" data-canonical-src="https://lh3.googleusercontent.com/_dG0BBWAhWis/TXNaHho55YI/AAAAAAAABZY/EDyr_nad7qo/s400/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%EF%BC%882011-03-06%2017.32.25%EF%BC%89.png"></a></p>

<ul>
<li>「設定」タブを開く。</li>
<li>「Pro」を選択状態にする。</li>
<li>「デフォルト」をクリックし、「Pro」をデフォルトにする。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/f7d9573091d19e17f917097ef4f36b8954650f40/68747470733a2f2f6c68362e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e614a4734757848492f4141414141414141425a6b2f4c2d314452584c314a4c732f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e33352e32342545462542432538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f7d9573091d19e17f917097ef4f36b8954650f40/68747470733a2f2f6c68362e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e614a4734757848492f4141414141414141425a6b2f4c2d314452584c314a4c732f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e33352e32342545462542432538392e706e67" alt="" data-canonical-src="https://lh6.googleusercontent.com/_dG0BBWAhWis/TXNaJG4uxHI/AAAAAAAABZk/L-1DRXL1JLs/s400/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%EF%BC%882011-03-06%2017.35.24%EF%BC%89.png"></a></p>

<ul>
<li>「設定」を閉じる。</li>
<li>一旦、ターミナルを閉じ、ターミナルを開いて、Proのテーマが適用されているか確認する。</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/76d8a3d9dd2334f8318be23a464f7b2ffc03aa35/68747470733a2f2f6c68362e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e61494258653265492f4141414141414141425a632f4b6f377936785f7439466f2f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e33372e32362545462542432538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/76d8a3d9dd2334f8318be23a464f7b2ffc03aa35/68747470733a2f2f6c68362e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e61494258653265492f4141414141414141425a632f4b6f377936785f7439466f2f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e33372e32362545462542432538392e706e67" alt="" data-canonical-src="https://lh6.googleusercontent.com/_dG0BBWAhWis/TXNaIBXe2eI/AAAAAAAABZc/Ko7y6x_t9Fo/s400/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%EF%BC%882011-03-06%2017.37.26%EF%BC%89.png"></a></p>

<h2>
<span id="ターミナルの設定ファイルを作ろう" class="fragment"></span><a href="#%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86"><i class="fa fa-link"></i></a>ターミナルの設定ファイルを作ろう</h2>

<blockquote>
<p>と、その前に、コマンドから起動するエディタの設定をしておきます。</p>

<h2>
<span id="coteditorの設定" class="fragment"></span><a href="#coteditor%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>CotEditorの設定</h2>

<blockquote>
<p>いきなりvimエディタを使うのが難しい方のために、CotEditorを使ってファイルを編集するようなチュートリアルになっています。vim使いの方などは <code>open -a CotEditor</code> の部分を <code>vim</code> などと読み替えていただいて構いません。</p>
</blockquote>

<p>CotEditorを使う方は文字コードの設定を完了しておいてください。</p>

<p>CotEditorを起動する &gt; "CotEditor" &gt; "環境設定" &gt; "フォーマット" タブ </p>

<p>"エンコーディング" の "既存ファイル" の設定を "自動認識" から "Unicode (UTF-8)" に変更し、CotEditorを終了する。</p>
</blockquote>

<p>ターミナルの設定をさらに細かくするために、次の二つのファイルを、ホームディレクトリに作ります。ホームディレクトリとは/Users/あなたのアカウント/のことです。</p>

<ul>
<li>.bash_profile</li>
<li>.bashrc</li>
</ul>

<p>まず、ターミナルを開きます。（すでに開いていると思いますが。）上のファイルを作るために次のコマンドを順に実行してください。よく分からない人はターミナルにコピペしてください。ちなみに上のファイルは不可視ファイルなのでFinderでホームディレクトリを開いても見ることができません。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cd
touch .bash_profile
touch .bashrc
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/8a3bdbdfed306035546f408ba678d73601ffa14e/68747470733a2f2f6c68362e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e61495a44784534492f4141414141414141425a672f4d6372366c6e3530444c552f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e34382e32342545462542432538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8a3bdbdfed306035546f408ba678d73601ffa14e/68747470733a2f2f6c68362e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e61495a44784534492f4141414141414141425a672f4d6372366c6e3530444c552f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031372e34382e32342545462542432538392e706e67" alt="" data-canonical-src="https://lh6.googleusercontent.com/_dG0BBWAhWis/TXNaIZDxE4I/AAAAAAAABZg/Mcr6ln50DLU/s400/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%EF%BC%882011-03-06%2017.48.24%EF%BC%89.png"></a></p>

<p>次に、.bash_profileをエディタで開きます。開くために次のコマンドを実行してください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor .bash_profile
</pre></div></div>

<p>.bash_profileに次の行を追加して保存します。これは、.bashrcがあればそれを読み込むという処理です。PHPで言えば <code>if(file_exists('.bashrc')) include '.bashrc';</code> です。保存したらエディタを閉じます。</p>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">.bash_profile</span></div>
<div class="highlight"><pre><span></span>if [ -f ~/.bashrc ]; then
    . ~/.bashrc
fi
</pre></div>
</div>

<p>今度は、.bashrcの設定するためにファイルを開きます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor .bashrc
</pre></div></div>

<p>アプリケーションやコマンドへのショートカットコマンドを設定していきます。私の設定は下のようになっています。自分の好みに合わせて設定してください。よく分からなければ、そのままコピペでもいいと思います。保存したらエディタを閉じます。</p>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">.bashrc</span></div>
<div class="highlight"><pre><span></span># Application Shortcuts
alias cot='open -g -a CotEditor' # ターミナルからCotEditorを開く
alias coda='open -g -a Coda' # ターミナルからCodaを開く
alias safari='open -g -a safari' # ターミナルからSafariを開く
alias console='open -a console' # ターミナルからコンソールを開く

# for shortcut
alias up='cd ..'
alias upp='cd ../..'
alias uppp='cd ../../..'
alias ls='ls -GwF'
alias la='ls -alh'
alias t='tar zxvf'
alias t-='tar xvf -'
alias b='bzip2 -dc'
alias dh='df -h'
alias vi='vim'
alias v='vim'
alias sr='screen -d -R'
alias grep='grep --exclude=*.svn*'
alias greprn='grep -rn --exclude=*.svn*'
alias bye='sudo shutdown -h now'

# for svn
alias st='svn st'
alias stu='svn st -u'
alias sd='svn di'
alias sdi='svn di'
alias sad='svn add'
alias sup='svn up'
alias sci='svn ci'
alias scim='svn ci -m'

# for git
alias gst='git status'
alias gci='git commit'
alias gdi='git diff'
alias gdc='git diff --cached'
alias gad='git add'
</pre></div>
</div>

<p>設定を書き込んだばかりだと、ターミナルに反映されないので、ターミナルを再起動します(ターミナルを再起動するのが面倒な人は <code>bash</code> コマンドを実行してください)。上の設定をコピペした場合、Safariをとじた状態で、safariとだけタイプしてエンターを押してみます。そこでSafariが起動すれば、設定が反映されていることになります。</p>

<h2>
<span id="プロンプトの書式をカスタマイズしよう" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88%E3%81%AE%E6%9B%B8%E5%BC%8F%E3%82%92%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%97%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>プロンプトの書式をカスタマイズしよう</h2>

<p>プロンプトとは、ターミナルの行頭に出ている<a href="https://camo.qiitausercontent.com/7a5594a90a961c2639f0a504bc7172ef1b78621f/68747470733a2f2f6c68352e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e614a397375517a492f4141414141414141425a302f4763556f66416733367a6b2f733830302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031382e31312e35312545462542432538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7a5594a90a961c2639f0a504bc7172ef1b78621f/68747470733a2f2f6c68352e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e614a397375517a492f4141414141414141425a302f4763556f66416733367a6b2f733830302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031382e31312e35312545462542432538392e706e67" alt="" data-canonical-src="https://lh5.googleusercontent.com/_dG0BBWAhWis/TXNaJ9suQzI/AAAAAAAABZ0/GcUofAg36zk/s800/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%EF%BC%882011-03-06%2018.11.51%EF%BC%89.png"></a>の部分を言います。デフォルトでも全く問題はありません。ただ、ちょっと白黒で寂しいですし、行の前後にスペースがあったほうが見やすいので、カスタマイズしてしまいます。</p>

<p>再び、.bashrcを開いて、編集します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor .bashrc
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>PS1="\n\`if [ \$? = 0 ]; then echo \[\e[32m\]^_^\[\e[0m\]; else echo \[\e[31m\]O_O\[\e[0m\]; fi\` (\h:\w)\n* "
</pre></div></div>

<p>保存したら、ターミナルを再起動(または <code>bash</code> コマンド実行)します。プロンプトが下のようになっていれば設定成功です。</p>

<p><a href="https://camo.qiitausercontent.com/601cf998ffc33b004aa470bb3520f7fe3228de9e/68747470733a2f2f6c68352e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e614b556f675167492f4141414141414141425a382f64316d48525366333972342f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031382e32302e30312545462542432538392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/601cf998ffc33b004aa470bb3520f7fe3228de9e/68747470733a2f2f6c68352e676f6f676c6575736572636f6e74656e742e636f6d2f5f64473042425741685769732f54584e614b556f675167492f4141414141414141425a382f64316d48525366333972342f733430302f254533253832254239254533253832254146254533253833254141254533253833254243254533253833254233254533253832254237254533253833254137254533253833253833254533253833253838254546254243253838323031312d30332d303625323031382e32302e30312545462542432538392e706e67" alt="" data-canonical-src="https://lh5.googleusercontent.com/_dG0BBWAhWis/TXNaKUogQgI/AAAAAAAABZ8/d1mHRSf39r4/s400/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%EF%BC%882011-03-06%2018.20.01%EF%BC%89.png"></a></p>

<h2>
<span id="自分用シェルスクリプト置き場を作ろう" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E7%94%A8%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E7%BD%AE%E3%81%8D%E5%A0%B4%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86"><i class="fa fa-link"></i></a>自分用シェルスクリプト置き場を作ろう</h2>

<p>/Users/あなたの名前/bin をシェルスクリプト置き場としてディレクトリを作ります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir ~/bin
</pre></div></div>

<p>ディレクトリを作ったら.bashrcを修正してパスを通します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor .bashrc
</pre></div></div>

<p>下記を.bashrcに追加します</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">.bashrc</span></div>
<div class="highlight"><pre><span></span>export PATH=~/bin:$PATH
</pre></div>
</div>

<p>保存したら、ターミナルを再起動(または <code>bash</code> コマンド実行)します。</p>

<h1>
<span id="homebrewのダウンロード" class="fragment"></span><a href="#homebrew%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>Homebrewのダウンロード</h1>

<p>Homebrewは、Unix向けに開発されたオープンソース・ソフトウェアを手軽にインストールすることができるMacOSX用のパッケージです。「Unixで使えるあのコマンド、Macでも使いたい！」というときに簡単にコマンドをインストールすることができます。</p>

<ul>
<li><a href="http://mxcl.github.com/homebrew/" rel="nofollow noopener" target="_blank">Homebrew</a></li>
</ul>

<p>ターミナルで下のコマンドを実行してインストールします:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/usr/bin/ruby -e "$(/usr/bin/curl -fksSL https://raw.github.com/mxcl/homebrew/master/Library/Contributions/install_homebrew.rb)"
</pre></div></div>

<p>Homebrewのしきたりとして、インストール直後や問題が起こった時に <code>brew doctor</code> コマンドを叩いて状況を確認するというものがあります:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew doctor
</pre></div></div>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">結果例</span></div>
<div class="highlight"><pre><span></span>Warning: You have no /usr/bin/cc.
This means you probably can't build *anything*. You need to install the Command
Line Tools for Xcode. You can either download this from http://connect.apple.com
or install them from inside Xcode's Download preferences. Homebrew does not
require all of Xcode! You only need the Command Line Tools package!

Warning: Git could not be found in your PATH.
Homebrew uses Git for several internal functions, and some formulae use Git
checkouts instead of stable tarballs. You may want to install Git:
  brew install git

Warning: Your Xcode is configured with an invalid path.
You should change it to the correct path. Please note that there is no correct
path at this time if you have *only* installed the Command Line Tools for Xcode.
If your Xcode is pre-4.3 or you installed the whole of Xcode 4.3 then one of
these is (probably) what you want:

    sudo xcode-select -switch /Developer
    sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer

DO NOT SET / OR EVERYTHING BREAKS!
</pre></div>
</div>

<p><code>/usr/bin/cc</code> が無いといけないらしいので、Xcodeで <em>Command Line Tools</em> を入れます:</p>

<blockquote>
<p>Xcode &gt; Preferences &gt; Downloads で Command Line Tools を Install する。</p>
</blockquote>

<p>Xcodeのパスを設定する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer
</pre></div></div>

<p>brew 本体のアップデートを行う:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew update
</pre></div></div>

<p>Homebrewでインストールしたunixツールが使えるようにパスを通します:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor ~/.bashrc
</pre></div></div>

<p>Homebrew用に <code>/usr/local/sbin</code> と <code>/usr/local/bin</code> へのパスを通すために、.bashrc に下記の2行を追加します。</p>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">.bashrc</span></div>
<div class="highlight"><pre><span></span>export PATH=/usr/local/sbin:$PATH # for Homebrew
export PATH=/usr/local/bin:$PATH  # for Homebrew
</pre></div>
</div>

<h2>
<span id="便利なコマンドを入れておこう" class="fragment"></span><a href="#%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%85%A5%E3%82%8C%E3%81%A6%E3%81%8A%E3%81%93%E3%81%86"><i class="fa fa-link"></i></a>便利なコマンドを入れておこう</h2>

<p>以上で HomeBrew の設定は完了です。ためしに、便利なコマンドを入れてみましょう。</p>

<p><a href="http://x68000.q-e-d.net/%7E68user/unix/pickup?tree" rel="nofollow noopener" target="_blank">treeコマンド</a>や<a href="http://x68000.q-e-d.net/%7E68user/unix/pickup?keyword=wget&amp;target=command" rel="nofollow noopener" target="_blank">wgetコマンド</a>など、あると便利なコマンドを入れておきます。ターミナルから次のコマンドを実行することでインストールできます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install tree
brew install wget
</pre></div></div>

<h1>
<span id="apache--mysql--php-のセットアップ" class="fragment"></span><a href="#apache--mysql--php-%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>Apache + MySQL + PHP のセットアップ</h1>

<p>MacビルトインのApacheを使ってもいいですが、Macのアップデートで変更があるといやなので、HomeBrewで別途システムとは独立した形でApacheをインストールします。また、PHPは5.2, 5.3, 5.4の環境を切り替えられるように、php-buildとphp-versionをインストールします。</p>

<blockquote>
<p>Apache + MySQL + PHP 環境に特にこだわりがない方、とりあえず手っ取り早く入れたい方は、<a href="http://www.mamp.info/en/index.html" rel="nofollow noopener" target="_blank">MAMP</a> をインストールしてこのセクションは読み飛ばしてください。WindowsではXAMPPが有名ですが、MAMPもXAMPPのようなアプリです。</p>
</blockquote>

<h2>
<span id="apacheをインストールする" class="fragment"></span><a href="#apache%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Apacheをインストールする</h2>

<p>Apache 2.2を扱っているFormulaを登録する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew tap Homebrew/dupes
</pre></div></div>

<p>httpdがインストール可能か確認する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew search httpd
</pre></div></div>

<p>httpdをインストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install httpd
</pre></div></div>

<h2>
<span id="mysqlをインストールする" class="fragment"></span><a href="#mysql%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>MySQLをインストールする</h2>

<p>mysqlをインストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install mysql
</pre></div></div>

<p>mysqlのデータベースをセットアップする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql_install_db --verbose -user=$(whoami) --basedir="$(brew --prefix mysql)" --datadir=/usr/local/var/mysql --tmpdir=/tmp
</pre></div></div>

<h2>
<span id="apacheを起動してみる" class="fragment"></span><a href="#apache%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>Apacheを起動してみる</h2>

<p>apachectlはApacheを制御するコマンドです。apachectlがどこにあるか確認してみます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>which apachectl
</pre></div></div>

<p>上の結果が、/usr/local/sbin/apachectl であればOKです。そうでなければ、/usr/local/sbin と /usr/local/bin へパスが通っていない可能性があります。.bashrcの内容を確認してください。</p>

<p>Apacheを起動する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apachectl start
</pre></div></div>

<p>パスワードを聞かれるので自分のアカウントのパスワードを入力します。ちなみに、<code>sudo</code> というのは管理者(root)として実行するという意味です。Macでは1024以下のポートを開くにはroot権限が必要になります。ApacheはHTTPなので80番ですね。</p>

<p>うまく起動できたか、<a href="http://localhost" rel="nofollow noopener" target="_blank">http://localhost</a>にアクセスしてみて確認します。｢It works!｣と出れば成功です。</p>

<p>次に <code>httpd.conf</code> の設定を変更します:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor /usr/local/etc/apache2/httpd.conf
</pre></div></div>

<h3>
<span id="1-サーバー名を設定する" class="fragment"></span><a href="#1-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%90%8D%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1. サーバー名を設定する</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#ServerName www.example.com:80
</pre></div></div>

<p>↓</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>ServerName localhost:80
</pre></div></div>

<h3>
<span id="2-実行ユーザを自分にする" class="fragment"></span><a href="#2-%E5%AE%9F%E8%A1%8C%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%92%E8%87%AA%E5%88%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2. 実行ユーザを自分にする</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>User daemon
Group daemon
</pre></div></div>

<p>↓</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>User suin
Group staff
</pre></div></div>

<p><code>suin</code>  の部分は自分のユーザ名にしてください。自分のユーザ名は <code>whoami</code> コマンドで確認できます。</p>

<h3>
<span id="3-アクセス拒否を取り払う" class="fragment"></span><a href="#3-%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%8B%92%E5%90%A6%E3%82%92%E5%8F%96%E3%82%8A%E6%89%95%E3%81%86"><i class="fa fa-link"></i></a>3. アクセス拒否を取り払う:</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;Directory /&gt;
    Options FollowSymLinks
#    AllowOverride None
    AllowOverride All
#    Order deny,allow
#    Deny from all
&lt;/Directory&gt;
</pre></div></div>

<p><code>Order deny,allow</code> と <code>Deny from all</code> をコメントアウトしてください。</p>

<p>.htaccessを使うことがあると思うので、 <code>AllowOverride None</code> を <code>AllowOverride All</code> に変更します。</p>

<h3>
<span id="4-ディレクトリにアクセスしたときに-indexphp-があれば実行するようにする" class="fragment"></span><a href="#4-%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AB-indexphp-%E3%81%8C%E3%81%82%E3%82%8C%E3%81%B0%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>4. ディレクトリにアクセスしたときに <code>index.php</code> があれば実行するようにする:</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;IfModule dir_module&gt;
    DirectoryIndex index.html
&lt;/IfModule&gt;
</pre></div></div>

<p>↓</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;IfModule dir_module&gt;
    DirectoryIndex index.php index.html
&lt;/IfModule&gt;
</pre></div></div>

<h3>
<span id="5-virtual-hostを有効化する" class="fragment"></span><a href="#5-virtual-host%E3%82%92%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5. Virtual Hostを有効化する:</h3>

<p>httpd-vhostsがコメントアウトされているので、コメントアウトを解除してください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Include /usr/local/etc/apache2/extra/httpd-vhosts.conf
</pre></div></div>

<p>保存したら Apache を再起動します:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo apachectl restart
</pre></div></div>

<p>うまく再起動できれば設定ファイル変更OKです。</p>

<p>もし、起動に失敗したら、<code>apachectl configtest</code> コマンドで設定ファルの書き方に問題がないか調べてください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>apachectl configtest
</pre></div></div>

<h2>
<span id="mysqlサーバを起動してみる" class="fragment"></span><a href="#mysql%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>MySQLサーバを起動してみる</h2>

<p>続いてMySQLサーバを起動してみます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql.server start
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">出力例</span></div>
<div class="highlight"><pre><span></span>Starting MySQL
.. SUCCESS!
</pre></div>
</div>

<p>Apacheを起動するときは<code>sudo</code>で実行する必要がありましたが、MySQLはデフォルト3306番ポートで起動するので、rootとして実行する必要はありません。</p>

<p>クライアントでつないでみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql -u root
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">出力例</span></div>
<div class="highlight"><pre><span></span>Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.5.20 Source distribution

Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</pre></div>
</div>

<p>試しに、データベース一覧を出すクエリを実行してみます:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql&gt; SHOW DATABASES;
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">結果例</span></div>
<div class="highlight"><pre><span></span>+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+
4 rows in set (0.00 sec)
</pre></div>
</div>

<p>mysqlクライアントを終了します:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql&gt; quit
</pre></div></div>

<h2>
<span id="phpインストールの準備" class="fragment"></span><a href="#php%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>PHPインストールの準備</h2>

<p>PHP関連のツールを扱っているFormulaを登録する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew tap josegonzalez/php
</pre></div></div>

<p>php-build, php-versionをインストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install php-build
brew install php-version
</pre></div></div>

<p>.bashrcにphp-buildのパスを追加する:</p>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">.bashrc</span></div>
<div class="highlight"><pre><span></span>export PHP_VERSIONS=${HOME}/local/php/versions
[ -f $(brew --prefix php-version)/php-version.sh ] &amp;&amp; source $(brew --prefix php-version)/php-version.sh &amp;&amp; php-version 5.4.0 &gt;/dev/null
</pre></div>
</div>

<p>PHPのコンパイルに必要なライブラリをインストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install re2c
brew install jpeg
brew install libpng
brew install mcrypt
</pre></div></div>

<p>PHPのインストール先ディレクトリを作成する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir -p $HOME/local/php/versions
</pre></div></div>

<h2>
<span id="php540をインストールする" class="fragment"></span><a href="#php540%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>PHP5.4.0をインストールする</h2>

<p>PHP5.4のconfigureパラメータを修正して、Apacheモジュールを生成するようにする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor /usr/local/share/php-build/definitions/5.4.0
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">/usr/local/share/php-build/definitions/5.4.0</span></div>
<div class="highlight"><pre><span></span>configure_option "--with-apxs2" "/usr/local/sbin/apxs"
install_package "http://www.php.net/distributions/php-5.4.0.tar.bz2"
install_pyrus
install_xdebug_master
</pre></div>
</div>

<p>PHP5.4をコンパイル＆インストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>php-build 5.4.0 $HOME/local/php/versions/5.4.0
</pre></div></div>

<p>ApacheのPHPモジュールを退避する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mv /usr/local/opt/httpd/libexec/libphp5.so $HOME/local/php/versions/5.4.0/libphp5.so
</pre></div></div>

<h2>
<span id="php5310をインストールする" class="fragment"></span><a href="#php5310%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>PHP5.3.10をインストールする</h2>

<p>PHP5.3のconfigureパラメータを修正して、Apacheモジュールを生成するようにする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor /usr/local/share/php-build/definitions/5.3.10 
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">/usr/local/share/php-build/definitions/5.3.10</span></div>
<div class="highlight"><pre><span></span>configure_option "--with-apxs2" "/usr/local/sbin/apxs"
configure_option -D "--enable-fpm"
install_package "http://www.php.net/distributions/php-5.3.10.tar.bz2"
install_pyrus
install_xdebug "2.1.3"
</pre></div>
</div>

<p>※ 5.3.10 では "--enable-fpm" を無効化しないと｢You've configured multiple SAPIs to be build. You can build only one SAPI module and CLI binary at the same time.｣というエラーが出てしまうので、<code>configure_option -D "--enable-fpm"</code> が必要になる。</p>

<p>PHP5.3をコンパイル＆インストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>php-build 5.3.10 $HOME/local/php/versions/5.3.10
</pre></div></div>

<p>ApacheのPHPモジュールを退避する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mv /usr/local/opt/httpd/libexec/libphp5.so $HOME/local/php/versions/5.3.10/libphp5.so
</pre></div></div>

<h2>
<span id="php5217をインストールする" class="fragment"></span><a href="#php5217%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>PHP5.2.17をインストールする</h2>

<p>PHP5.2のconfigureパラメータを修正して、Apacheモジュールを生成するようにする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor /usr/local/share/php-build/definitions/5.2.17 
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">/usr/local/share/php-build/definitions/5.2.17</span></div>
<div class="highlight"><pre><span></span>configure_option "--with-apxs2" "/usr/local/sbin/apxs"

configure_option "--enable-fastcgi"

configure_option -R "--with-mysql"
configure_option -R "--with-mysqli"
configure_option -R "--with-pdo-mysql"

with_pear

install_package "http://museum.php.net/php5/php-5.2.17.tar.bz2"
install_xdebug "2.1.3"
</pre></div>
</div>

<p>PHP5.2をコンパイル＆インストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>php-build 5.2.17 $HOME/local/php/versions/5.2.17
</pre></div></div>

<p>ApacheのPHPモジュールを退避する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mv /usr/local/opt/httpd/libexec/libphp5.so $HOME/local/php/versions/5.2.17/libphp5.so
</pre></div></div>

<p>mime.typesにPHPを登録する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>open -a CotEditor /usr/local/etc/apache2/mime.types 
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">/usr/local/etc/apache2/mime.types</span></div>
<div class="highlight"><pre><span></span>application/x-httpd-php                         php
</pre></div>
</div>

<h2>
<span id="php-versionの動作確認" class="fragment"></span><a href="#php-version%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>php-versionの動作確認</h2>

<p>php-versionは先程インストールした、PHP 5.2, 5.3, 5.4 の環境をコマンド一発で切り替えられるツールです。</p>

<p>php-versionでPHP 5.4.0にスイッチするのを試してみます:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>php-version 5.4.0 
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">出力例</span></div>
<div class="highlight"><pre><span></span>SWITCHED PHP VERSION TO: 5.4.0                                                 
NEW PHP ROOT DIRECTORY : /Users/suin/local/php/versions/5.4.0  
</pre></div>
</div>

<p>実際にどのPHPが有効になっているか確認します:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>php -v
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">出力例</span></div>
<div class="highlight"><pre><span></span>PHP 5.4.0 (cli) (built: Apr 12 2012 11:55:21)                                  
Copyright (c) 1997-2012 The PHP Group                                          
Zend Engine v2.4.0, Copyright (c) 1998-2012 Zend Technologies                  
    with Xdebug v2.2.0rc2-dev, Copyright (c) 2002-2012, by Derick Rethans   
</pre></div>
</div>

<h2>
<span id="apacheのphpモジュール切り替え用シェルスクリプトを作る" class="fragment"></span><a href="#apache%E3%81%AEphp%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E7%94%A8%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>ApacheのPHPモジュール切り替え用シェルスクリプトを作る</h2>

<p>php-versionで切り替えられるのは、ターミナルで実行する php のバージョンのみです。そこで、ApacheのPHPのバージョンを切り替えるためのスクリプトを作ります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch ~/bin/apache-php-version
chmod +x ~/bin/apache-php-version
open -a CotEditor ~/bin/apache-php-version
</pre></div></div>

<p>下記の内容を apache-php-version に保存します。</p>

<div class="code-frame" data-lang="sh">
<div class="code-lang"><span class="bold">~/bin/apache-php-version</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="nv">PROGRAM_APPNAME</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$0</span><span class="k">)</span>
<span class="nv">PROGRAM_VERSION</span><span class="o">=</span><span class="s2">"1.0.0"</span>
<span class="nv">APACHE_LIBEXEC_DIR</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">APACHE_PATH</span><span class="si">}</span><span class="s2">/libexec"</span>

show_help<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">PROGRAM_APPNAME</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="nv">PROGRAM_VERSION</span><span class="si">}</span><span class="s2">"</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="nb">echo</span> <span class="s2">""</span>                                      &gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="nb">echo</span> <span class="s2">"Usage  : </span><span class="si">${</span><span class="nv">PROGRAM_APPNAME</span><span class="si">}</span><span class="s2"> &lt;version&gt;"</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="nb">echo</span> <span class="s2">"Example: </span><span class="si">${</span><span class="nv">PROGRAM_APPNAME</span><span class="si">}</span><span class="s2"> 5.4.0RC6"</span>  &gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="o">}</span>

check_php_home<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[[</span> ! -d <span class="si">${</span><span class="nv">PHP_HOME</span><span class="si">}</span> <span class="o">]]</span>
    <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"Sorry, but </span><span class="si">${</span><span class="nv">PROGRAM_APPNAME</span><span class="si">}</span><span class="s2"> requires that \$PHP_HOME is set and points to an existing directory."</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>
<span class="o">}</span>

check_apache_path<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[[</span> ! -d <span class="si">${</span><span class="nv">APACHE_PATH</span><span class="si">}</span> <span class="o">]]</span>
    <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"Sorry, but </span><span class="si">${</span><span class="nv">PROGRAM_APPNAME</span><span class="si">}</span><span class="s2"> requires that \$APACHE_PATH is set and points to an existing directory."</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>
<span class="o">}</span>

set_up_apache_module_path<span class="o">()</span> <span class="o">{</span>
    <span class="nv">apache_module_path</span><span class="o">=</span><span class="nv">$PHP_HOME</span>/<span class="nv">$PHP_VERSION</span>/libphp5.so
<span class="o">}</span>

check_apache_module_path<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[[</span> ! -f <span class="si">${</span><span class="nv">apache_module_path</span><span class="si">}</span> <span class="o">]]</span>
    <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"Sorry, apache module not found: </span><span class="nv">$apache_module_path</span><span class="s2">"</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>
<span class="o">}</span>

check_apache_libexec_dir<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[[</span> ! -d <span class="si">${</span><span class="nv">APACHE_LIBEXEC_DIR</span><span class="si">}</span> <span class="o">]]</span>
    <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">"Directory not found: </span><span class="nv">$APACHE_LIBEXEC_DIR</span><span class="s2">"</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>
<span class="o">}</span>

replace_apache_module<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"Copy </span><span class="nv">$apache_module_path</span><span class="s2"> to </span><span class="nv">$APACHE_LIBEXEC_DIR</span><span class="s2">/libphp5.so"</span>
    cp <span class="nv">$apache_module_path</span> <span class="nv">$APACHE_LIBEXEC_DIR</span>/libphp5.so
<span class="o">}</span>

restart_apache<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"Restarting apache..."</span>
    sudo apachectl restart
<span class="o">}</span>

<span class="o">[</span> <span class="nv">$#</span> !<span class="o">=</span> <span class="m">1</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> show_help
<span class="nv">PHP_VERSION</span><span class="o">=</span><span class="nv">$1</span>
check_php_home
check_apache_path
set_up_apache_module_path
check_apache_module_path
check_apache_libexec_dir
replace_apache_module
restart_apache
</pre></div>
</div>

<p>次に、<code>apache-php-version</code> のためにApacheへのパスを通して、シェルを再起動します:</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">~/.bashrc</span></div>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">APACHE_PATH</span><span class="o">=</span><span class="k">$(</span>brew --prefix<span class="k">)</span>/opt/httpd
</pre></div>
</div>

<p>切り替わるか試してみる:</p>

<p>まず、切り替わっているのが分かるように<code>phpinfo()</code>を書いたファイルをドキュメントルートに作っておきます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch /usr/local/opt/httpd/share/apache2/htdocs/phpinfo.php
open -a CotEditor /usr/local/opt/httpd/share/apache2/htdocs/phpinfo.php
</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">/usr/local/opt/httpd/share/apache2/htdocs/phpinfo.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">phpinfo</span><span class="p">();</span>
</pre></div>
</div>

<p>切り替えを実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>apache-php-version 5.4.0
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">出力例</span></div>
<div class="highlight"><pre><span></span>Copy /Users/suin/local/php/versions/5.4.0/libphp5.so to /usr/local/Cellar/httpd/2.2.22/libexec/libphp5.so
Restarting apache...
Password:
httpd: Could not reliably determine the server's fully qualified domain name, using suinair2.local for ServerName
</pre></div>
</div>

<p>ブラウザで <a href="http://localhost/phpinfo.php" rel="nofollow noopener" target="_blank">http://localhost/phpinfo.php</a> にアクセスします。phpinfoのバージョンが5.4.0になっているでしょうか？</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>apache-php-version 5.3.10
</pre></div></div>

<p>や</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>apache-php-version 5.2.17
</pre></div></div>

<p>も試してみてください。</p>

<h1>
<span id="sshのセットアップ" class="fragment"></span><a href="#ssh%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>SSHのセットアップ</h1>

<h2>
<span id="秘密鍵公開鍵を作ろう" class="fragment"></span><a href="#%E7%A7%98%E5%AF%86%E9%8D%B5%E5%85%AC%E9%96%8B%E9%8D%B5%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86"><i class="fa fa-link"></i></a>秘密鍵/公開鍵を作ろう</h2>

<p>SSH秘密鍵・公開鍵を持ってない人はこの際作っておきましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>ssh-keygen
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">出力例</span></div>
<div class="highlight"><pre><span></span>Generating public/private rsa key pair.
Enter file in which to save the key (/Users/suin/.ssh/id_rsa): &lt;= Enter押す
Created directory '/Users/suin/.ssh'.
Enter passphrase (empty for no passphrase): &lt;= 秘密鍵のパスワードを決める
Enter same passphrase again:  &lt;= 秘密鍵のパスワード確認
Your identification has been saved in /Users/suin/.ssh/id_rsa.
Your public key has been saved in /Users/suin/.ssh/id_rsa.pub.
The key fingerprint is:
99:04:e5:25:18:f9:3a:79:19:4c:ef:6e:a0:ee:e0:12 suin@suinair2.local
The key's randomart image is:
+--[ RSA 2048]----+
|      o=o .      |
|      oo.o       |
|       +o.       |
|       .+o.      |
|       oS+       |
|  E   + + .      |
|   ..  + o       |
|  .. ..   o      |
|   ..oo  .       |
+-----------------+
</pre></div>
</div>

<p>/Users/(あなたの名前)/.ssh というディレクトリが作られ、そこに秘密鍵 <code>id_rsa</code> と公開鍵 <code>id_rsa.pub</code> が作られます。公開鍵はサーバに送る用です。秘密鍵はサーバに送ったり誰かに貸したりしないようにします。</p>

<p>.</p>

<h2>
<span id="sshのログイン設定ファイルを作っておこう" class="fragment"></span><a href="#ssh%E3%81%AE%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%8A%E3%81%93%E3%81%86"><i class="fa fa-link"></i></a>SSHのログイン設定ファイルを作っておこう</h2>

<p>ポート番号を変更しているサーバや鍵認証のサーバ、ドメインが長いサーバを使っていると、毎回<code>ssh -p 12345 -i ~/.ssh/id_rsa username@example.com</code>のような長いコマンドを打たなければならず不便ですね。そんなときは、<code>~/.ssh/config</code>ファイルに、サーバごとのログイン情報を書いておくとコマンドが短くなり利便性が増します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cd ~/.ssh
touch config
open -a CotEditor config
</pre></div></div>

<p>~/.ssh/configファイルの書き方については<a href="http://d.hatena.ne.jp/superbrothers/20090730/1248971671" rel="nofollow noopener" target="_blank">~/.ssh/config で簡単に複数ホストへのSSH接続を管理する</a>や<a href="http://d.hatena.ne.jp/nauthiz/20100919/1284892108" rel="nofollow noopener" target="_blank">.ssh/configの書き方</a>などを参考にしてください。</p>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>以上で、とりあえず「直ぐにすること」は終えられたんじゃないかと思います。もう少し踏み込むと、PHPやApache、MySQLの設定、PHPUnitなどツール類のインストールなどやることは出てくるかと思います。これらの解説については他に詳しい記事があると思うので、そちらに譲ることにします。</p>

<p>PHPer向けということもあって、RubyやPython、Node.jsなどの環境構築には触れませんでしたが、他言語でもPHPerにとって有用なツールは沢山あります。是非、<a href="http://qiita.com/items/f570f057a0ff927b47dc">【まとめ】これ知らないプログラマって損してんなって思う汎用的なツール 100超</a>をご覧になって、このまとめにあるツール名をキーワードに他言語のツールも探してみてください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>222</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/004679b27d4a1f8bcb36">ウェブ開発で大切な3つの環境: 開発・ステージング・プロダクション</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-06-25 01:57:31</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ウェブ開発]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>もはや常識だと思うが、ウェブシステム開発にあたって3つの環境はそれぞれ独立して用意しておくといい。（独立といっても同じサーバにあっても構わないこともある。）</p>

<ul>
<li>開発サーバ: 開発者用テスト環境</li>
<li>ステージングサーバ: 顧客用レビュー環境</li>
<li>プロダクションサーバ: 本番環境</li>
</ul>

<h2>
<span id="開発サーバ" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E3%82%B5%E3%83%BC%E3%83%90"><i class="fa fa-link"></i></a>開発サーバ</h2>

<p>開発者がコミットした内容を開発者が反映し、開発者がテストする環境。基本的に顧客や運用チームに見せることはない。</p>

<p>ローカル開発環境とは別に用意するのがポイント。「ローカルだと動くんだけど」病にいち早く気がつくために重要。ローカルはしばしば、開発者がライブラリへのリンクや各種設定を無意識のうちに行なっていて、そのためローカルでは動くがサーバでは動かないということがある。</p>

<p>この病の典型的な例としては次のようなものがある。</p>

<ul>
<li>Case-Insentive環境(ローカル)で動くが、Case-sensitive環境(リモート)で動かない。パスを指定したファイル名の大文字小文字など。</li>
<li>コミット漏れ。</li>
<li>コードベースで管理されていないライブラリへのリンク</li>
</ul>

<p>開発サーバは、個人によるプロジェクトであろうが、チームによるプロジェクトであろうが、ローカル環境とは独立した環境として用意しておくことが望ましい。</p>

<h2>
<span id="ステージングサーバ" class="fragment"></span><a href="#%E3%82%B9%E3%83%86%E3%83%BC%E3%82%B8%E3%83%B3%E3%82%B0%E3%82%B5%E3%83%BC%E3%83%90"><i class="fa fa-link"></i></a>ステージングサーバ</h2>

<p>ステージングは、運用担当や実際のユーザ（すなわち顧客）がテストを行う環境。ステージングには、開発サーバでテストが完了した機能・特徴が提供(デプロイ)される。</p>

<p>ステージングでのテストはデバッグのためのテストではなく(デバッグは既に開発サーバで完了していなければならない)、要件を満たしているか、実際の運用をするにあたって支障がないかなどを確認・レビューする。このレビューの結果、顧客からフィードバックが行われることがある。</p>

<h2>
<span id="プロダクションサーバ" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%B5%E3%83%BC%E3%83%90"><i class="fa fa-link"></i></a>プロダクションサーバ</h2>

<p>プロダクションは、システムが製品として提供され、運用担当や実際のユーザ（顧客）がシステムを利用する本番環境。ステージングでテスト（レビュー）が完了した機能・特徴が提供される。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>168</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/82ecb6f63ff4104d4f5d">Goルーチンで並行化する方法: 6秒かかる処理を3秒にしよう</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-05 16:33:34</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="この記事の目的" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>この記事の目的</h1>

<p>6秒かかる直列処理を並行処理に改修し、3秒で終わるようにする</p>

<h1>
<span id="準備" class="fragment"></span><a href="#%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>準備</h1>

<p>まずは、適当にフォルダを作る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir ~/Desktop/goroutine
cd ~/Desktop/goroutine/
</pre></div></div>

<p>つぎに、main.goファイルを作る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch main.go
</pre></div></div>

<h1>
<span id="まず直列実行するプログラムを書く" class="fragment"></span><a href="#%E3%81%BE%E3%81%9A%E7%9B%B4%E5%88%97%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>まず直列実行するプログラムを書く</h1>

<ul>
<li>1秒待つコマンド</li>
<li>2秒待つコマンド</li>
<li>3秒待つコマンド</li>
</ul>

<p>上記を順番に実行していくプログラムを <code>main.go</code> の中身を書く。<br>
つまり、合計で6秒かかってしまう。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"started."</span><span class="p">)</span>

    <span class="c1">// 1秒かかるコマンド</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 started."</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 finished."</span><span class="p">)</span>

    <span class="c1">// 2秒かかるコマンド</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 started."</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 finished."</span><span class="p">)</span>

    <span class="c1">// 3秒かかるコマンド</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 started."</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 finished."</span><span class="p">)</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"all finished."</span><span class="p">)</span>
<span class="p">}</span>


</pre></div>
</div>

<p>ともあれ、実行してみる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run main.go
2013/12/05 15:02:09 started.
2013/12/05 15:02:09 sleep1 started.
2013/12/05 15:02:10 sleep1 finished.
2013/12/05 15:02:10 sleep2 started.
2013/12/05 15:02:12 sleep2 finished.
2013/12/05 15:02:12 sleep3 started.
2013/12/05 15:02:15 sleep3 finished.
2013/12/05 15:02:15 all finished.
</pre></div></div>

<p>やはり、6秒かかった。</p>

<p>これを並行化したい。</p>

<h1>
<span id="goルーチンを使って並行化し3秒で終わるようにする" class="fragment"></span><a href="#go%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E4%B8%A6%E8%A1%8C%E5%8C%96%E3%81%973%E7%A7%92%E3%81%A7%E7%B5%82%E3%82%8F%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Goルーチンを使って並行化し、3秒で終わるようにする</h1>

<p>Go言語にはGoルーチンという処理の並行化を簡単にできる仕組みがある。クロージャーや関数に <code>go</code> をつけるだけなのでシンプル。</p>

<p>ただし、Goルーチンだけでは、並行化した処理が終わる前に、メインの処理が終わってしまう。つまり、待ってくれない。Goルーチンが終わるまで待つには、「チャネル」という仕組みを使う。</p>

<p>なお、各ルーチンの実行結果を、呼び出し元に戻すときにもチャネルを使う。今回は、特に実行結果は必要ないので、チャネルに適当な値を入れることにする。ここでは、とりあえずbool値にする。</p>

<p>以上を踏まえて、さきほどの <code>main.go</code> を改修する:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"started."</span><span class="p">)</span>

    <span class="c1">// チャネル</span>
    <span class="nx">sleep1_finished</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
    <span class="nx">sleep2_finished</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
    <span class="nx">sleep3_finished</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 1秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 finished."</span><span class="p">)</span>
        <span class="nx">sleep1_finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 2秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 finished."</span><span class="p">)</span>
        <span class="nx">sleep2_finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 3秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 finished."</span><span class="p">)</span>
        <span class="nx">sleep3_finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="c1">// 終わるまで待つ</span>
    <span class="o">&lt;-</span> <span class="nx">sleep1_finished</span>
    <span class="o">&lt;-</span> <span class="nx">sleep2_finished</span>
    <span class="o">&lt;-</span> <span class="nx">sleep3_finished</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"all finished."</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行してみよう</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run main.go
2013/12/05 15:14:58 started.
2013/12/05 15:14:58 sleep1 started.
2013/12/05 15:14:58 sleep2 started.
2013/12/05 15:14:58 sleep3 started.
2013/12/05 15:14:59 sleep1 finished.
2013/12/05 15:15:00 sleep2 finished.
2013/12/05 15:15:01 sleep3 finished.
2013/12/05 15:15:01 all finished.
</pre></div></div>

<p>並行化ができて、3秒で終わるようになった＼(^o^)／</p>

<h1>
<span id="チャネルが冗長なので1つにしたい" class="fragment"></span><a href="#%E3%83%81%E3%83%A3%E3%83%8D%E3%83%AB%E3%81%8C%E5%86%97%E9%95%B7%E3%81%AA%E3%81%AE%E3%81%A71%E3%81%A4%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>チャネルが冗長なので1つにしたい…</h1>

<p><code>sleep1_finished</code>、<code>sleep2_finished</code>、<code>sleep3_finished</code>の3つのチャネルを作ったが、もっとエレガントにチャネルしたい。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"started."</span><span class="p">)</span>

    <span class="c1">// チャネル</span>
    <span class="nx">finished</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 1秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 finished."</span><span class="p">)</span>
        <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 2秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 finished."</span><span class="p">)</span>
        <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 3秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 finished."</span><span class="p">)</span>
        <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="c1">// 終わるまで待つ</span>
    <span class="o">&lt;-</span><span class="nx">finished</span>
    <span class="o">&lt;-</span><span class="nx">finished</span>
    <span class="o">&lt;-</span><span class="nx">finished</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"all finished."</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>チャネルはひとつにできたが、待つところで3回待つ必要がある…。<br>
10並行したら10回 <code>&lt;-finished</code> を書かないといけないのは面倒だし、エンバグしそうなので、回数を指定したい。</p>

<h1>
<span id="終わるまで待つところを回数指定にする" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%82%8B%E3%81%BE%E3%81%A7%E5%BE%85%E3%81%A4%E3%81%A8%E3%81%93%E3%82%8D%E3%82%92%E5%9B%9E%E6%95%B0%E6%8C%87%E5%AE%9A%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>「終わるまで待つ」ところを回数指定にする</h1>

<p>とりあえず無骨に <code>for</code> で3回 <code>&lt;-finished</code> を実行すれば良いようだ</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"started."</span><span class="p">)</span>

    <span class="c1">// チャネル</span>
    <span class="nx">finished</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 1秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 finished."</span><span class="p">)</span>
        <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 2秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 finished."</span><span class="p">)</span>
        <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 3秒かかるコマンド</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 started."</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 finished."</span><span class="p">)</span>
        <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="c1">// 終わるまで待つ</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="o">&lt;-</span><span class="nx">finished</span>
    <span class="p">}</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"all finished."</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
</div>

<p>実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run main.go
2013/12/05 15:32:40 started.
2013/12/05 15:32:40 sleep2 started.
2013/12/05 15:32:40 sleep1 started.
2013/12/05 15:32:40 sleep3 started.
2013/12/05 15:32:41 sleep1 finished.
2013/12/05 15:32:42 sleep2 finished.
2013/12/05 15:32:43 sleep3 finished.
2013/12/05 15:32:43 all finished.
</pre></div></div>

<h1>
<span id="回数指定じゃなくてルーチンの数だけ待ちたい" class="fragment"></span><a href="#%E5%9B%9E%E6%95%B0%E6%8C%87%E5%AE%9A%E3%81%98%E3%82%83%E3%81%AA%E3%81%8F%E3%81%A6%E3%83%AB%E3%83%BC%E3%83%81%E3%83%B3%E3%81%AE%E6%95%B0%E3%81%A0%E3%81%91%E5%BE%85%E3%81%A1%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>回数指定じゃなくて、ルーチンの数だけ待ちたい</h1>

<p><code>&lt;-finsihed</code> を列挙するよりも、回数指定のほうが並行数の増減に対応しやすいが、ルーチンの数に応じて待つようにしたい。</p>

<p>どうやってやるかだが、クロージャーを配列にして、要素の数だけGoルーチンを開始し、要素の数だけ <code>&lt;-finsihed</code> を実行するようにする。この変更を加えたコードが下記になる。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"started."</span><span class="p">)</span>

    <span class="nx">finished</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>

    <span class="c1">// 配列</span>
    <span class="nx">funcs</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">func</span><span class="p">(){</span>
        <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 1秒かかるコマンド</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 started."</span><span class="p">)</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 finished."</span><span class="p">)</span>
            <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 2秒かかるコマンド</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 started."</span><span class="p">)</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 finished."</span><span class="p">)</span>
            <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 3秒かかるコマンド</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 started."</span><span class="p">)</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 finished."</span><span class="p">)</span>
            <span class="nx">finished</span> <span class="o">&lt;-</span> <span class="kc">true</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="c1">// 並行化する</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">sleep</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">funcs</span> <span class="p">{</span>
        <span class="k">go</span> <span class="nx">sleep</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// 終わるまで待つ</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">funcs</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="o">&lt;-</span><span class="nx">finished</span>
    <span class="p">}</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"all finished."</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run main.go
2013/12/05 16:30:18 started.
2013/12/05 16:30:18 sleep1 started.
2013/12/05 16:30:18 sleep2 started.
2013/12/05 16:30:18 sleep3 started.
2013/12/05 16:30:19 sleep1 finished.
2013/12/05 16:30:20 sleep2 finished.
2013/12/05 16:30:21 sleep3 finished.
2013/12/05 16:30:21 all finished.
</pre></div></div>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>6秒かかる処理を、Goルーチンとチャネルを組み合わせて並行化し、3秒で終わるようになった。</p>

<h1>
<span id="課題" class="fragment"></span><a href="#%E8%AA%B2%E9%A1%8C"><i class="fa fa-link"></i></a>課題</h1>

<p>最後の <code>for</code> あたりをもっとシンプルにする方法はないものか?</p>

<h1>
<span id="update-20131206-チャネルを使わずに待つ方法" class="fragment"></span><a href="#update-20131206-%E3%83%81%E3%83%A3%E3%83%8D%E3%83%AB%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%9A%E3%81%AB%E5%BE%85%E3%81%A4%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>UPDATE 2013/12/06 チャネルを使わずに待つ方法</h1>

<p>調べてみたら <a href="http://golang.org/pkg/sync/#WaitGroup" rel="nofollow noopener" target="_blank">sync.WaitGroup</a> というモジュールがあることがわかった。これを使うとチャネルを宣言しなくても、処理を待つことができる。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"sync"</span>
    <span class="s">"time"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"started."</span><span class="p">)</span>

    <span class="c1">// 配列</span>
    <span class="nx">funcs</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">func</span><span class="p">(){</span>
        <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 1秒かかるコマンド</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 started."</span><span class="p">)</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep1 finished."</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 2秒かかるコマンド</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 started."</span><span class="p">)</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep2 finished."</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 3秒かかるコマンド</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 started."</span><span class="p">)</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"sleep3 finished."</span><span class="p">)</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">waitGroup</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

    <span class="c1">// 関数の数だけ並行化する</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">sleep</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">funcs</span> <span class="p">{</span>
        <span class="nx">waitGroup</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// 待つ数をインクリメント</span>

        <span class="c1">// Goルーチンに入る</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">function</span> <span class="kd">func</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">defer</span> <span class="nx">waitGroup</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span> <span class="c1">// 待つ数をデクリメント</span>
            <span class="nx">function</span><span class="p">()</span>
        <span class="p">}(</span><span class="nx">sleep</span><span class="p">)</span>

    <span class="p">}</span>

    <span class="nx">waitGroup</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span> <span class="c1">// 待つ数がゼロになるまで処理をブロックする</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"all finished."</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
</div>

<p>実行結果:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go fmt main.go &amp;&amp; go run main.go
2013/12/06 16:14:40 started.
2013/12/06 16:14:40 sleep1 started.
2013/12/06 16:14:40 sleep2 started.
2013/12/06 16:14:40 sleep3 started.
2013/12/06 16:14:41 sleep1 finished.
2013/12/06 16:14:42 sleep2 finished.
2013/12/06 16:14:43 sleep3 finished.
2013/12/06 16:14:43 all finished.
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>129</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/8f1d42976dc350b953ea">GitHub Organization: Issues+Pull Requestでチケット駆動開発する手順</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-14 21:02:43</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[GitHub]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>GitHub OrganizationでGitHubのIssuesとPull Requestを使ってチケット駆動開発をする手順を説明する。</p>

<h1>
<span id="手順" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>手順</h1>

<h2>
<span id="organizationのリポジトリからローカルにチェックアウトする" class="fragment"></span><a href="#organization%E3%81%AE%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%8B%E3%82%89%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%AB%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%A2%E3%82%A6%E3%83%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Organizationのリポジトリからローカルにチェックアウトする</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>hub clone `org名`/`リポジトリ名`
</pre></div></div>

<h2>
<span id="organizationでissueを作る" class="fragment"></span><a href="#organization%E3%81%A7issue%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>OrganizationでIssueを作る</h2>

<p>ここで <code>issue番号</code> が発番される</p>

<h2>
<span id="トピックブランチを作る" class="fragment"></span><a href="#%E3%83%88%E3%83%94%E3%83%83%E3%82%AF%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>トピックブランチを作る</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git checkout -b issues/`issue番号`
</pre></div></div>

<h2>
<span id="開発する" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>開発する</h2>

<p>コードを書いて、テストを通す</p>

<h2>
<span id="トピックブランチをorganizationのリポジトリにpushする" class="fragment"></span><a href="#%E3%83%88%E3%83%94%E3%83%83%E3%82%AF%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%82%92organization%E3%81%AE%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%ABpush%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>トピックブランチをOrganizationのリポジトリにpushする</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git push -u origin issues/`issue番号`
</pre></div></div>

<h2>
<span id="プルリクエストする" class="fragment"></span><a href="#%E3%83%97%E3%83%AB%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>プルリクエストする</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>hub pull-request -i `issue番号` -h issues/`issue番号`
</pre></div></div>

<h2>
<span id="コードレビュー" class="fragment"></span><a href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC"><i class="fa fa-link"></i></a>コードレビュー</h2>

<p>メンバ全員にレビューを依頼する(大人数のチームならレビュアーを指名したほうがいい)。依頼するときはメンションする。</p>

<blockquote>
<p><strong>GitHubのPRでのコメント例</strong><br>
<a href="https://camo.qiitausercontent.com/4c0d15ddbf0f69df9ec15ce7db0849d44561b0bd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35616436373238652d376366662d363464612d623436662d6365353039343766393062662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4c0d15ddbf0f69df9ec15ce7db0849d44561b0bd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35616436373238652d376366662d363464612d623436662d6365353039343766393062662e706e67" alt="" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/5ad6728e-7cff-64da-b46f-ce50947f90bf.png"></a></p>
</blockquote>

<p>レビューを依頼してもなかなかレビューをしてもらえない場合は、Slackやチャットなどで、<strong>メンションを飛ばしつつしつこく依頼する</strong>。</p>

<p>レビューを依頼された側は、自分ができそうになければ、辞退することができる。他に適任の人を指名してもいい。その場合は、GitHubのissueにコメントを残す。</p>

<p>ここで、コード修正が必要になったらコードを直して、<code>git push</code>して、再度コードレビューへ。</p>

<p>コードレビューはブランチがマージ可能であることが前提。もしここでconflictしていたら、レビュー者は開発者に通知する。開発者はそれを解消してから再度コードレビューを依頼する。解消する方法は『<a href="http://qiita.com/mapyo/items/a3ab9ef0c011b6757d49" id="reference-91e04fa3f463d0e52eae">Git - プルリクエストの画面でMerge出来ない事がわかった場合にどうすればよいか考える。 - Qiita</a>』を参照。</p>

<h2>
<span id="マージ" class="fragment"></span><a href="#%E3%83%9E%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>マージ</h2>

<p>レビューが通ったらレビュー者がGitHubウェブサイト上でマージする。<br>
ここで master ブランチに取り込まれる</p>

<h2>
<span id="リモートのトピックブランチを削除する" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%81%AE%E3%83%88%E3%83%94%E3%83%83%E3%82%AF%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>リモートのトピックブランチを削除する</h2>

<p>マージすると、GitHubの画面上に「Delete Branch」ボタンが出るので押す。</p>

<h2>
<span id="ローカルの-master-ブランチを最新にする" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%AE-master-%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%82%92%E6%9C%80%E6%96%B0%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ローカルの master ブランチを最新にする</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git pull --prune
</pre></div></div>

<p><code>--prune</code> をつけることで前のステップで消したリモートトピックブランチのローカルにある情報が消える</p>

<h2>
<span id="ローカルのトピックブランチを削除する" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%AE%E3%83%88%E3%83%94%E3%83%83%E3%82%AF%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ローカルのトピックブランチを削除する</h2>

<p>masterに取り込まれたトピックブランチは削除してしまおう</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git branch -d issues/`issue番号`
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>128</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/33ba576b3a253d7fa709">【図解】Scala 2.10 + IntelliJ IDEA 12 で｢Hello World｣する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-07 02:28:26</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> <b>[IntelliJ]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h1>

<p>MacOSX で <a href="http://brew.sh/index_ja.html" rel="nofollow noopener" target="_blank">brew</a> コマンドが使える OR もうすでに scala が入っている</p>

<h1>
<span id="1-scalaをインストールする" class="fragment"></span><a href="#1-scala%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1. Scalaをインストールする</h1>

<p>Scalaが入ってる場合は飛ばしてOK</p>

<p>brewのリポジトリを更新しとく:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew update
</pre></div></div>

<p>scalaをインストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install scala
</pre></div></div>

<p>scalaのバージョンを確認する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ scala -version
Scala code runner version 2.10.0 -- Copyright 2002-2012, LAMP/EPFL
</pre></div></div>

<h1>
<span id="2-intellij-idea-12をインストール" class="fragment"></span><a href="#2-intellij-idea-12%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>2. IntelliJ IDEA 12をインストール</h1>

<p><a href="http://www.jetbrains.com/idea/download/" rel="nofollow noopener" target="_blank">IntelliJ IDEA :: Download Latest Version of IntelliJ IDEA</a>からCommunity Edition(無料)をダウンロードする。</p>

<p>IntelliJ IDEAを起動すると、設定情報をインポートするか聞かれる。ここでは、設定情報をインポートしないで進む:</p>

<p><a href="https://camo.qiitausercontent.com/3800852c0edbdad151bd22cebe4465e52d3fab9c/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/3800852c0edbdad151bd22cebe4465e52d3fab9c/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30312e706e67" alt="01.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/01.png"></a></p>

<p>起動中画面:</p>

<p><a href="https://camo.qiitausercontent.com/ac5eef5cfee90475d3c6e03fa98e16e513d4eecd/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ac5eef5cfee90475d3c6e03fa98e16e513d4eecd/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30322e706e67" alt="02.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/02.png"></a></p>

<h1>
<span id="3-scalaプラグインをインストールする" class="fragment"></span><a href="#3-scala%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>3. Scalaプラグインをインストールする</h1>

<p>上メニューから ｢IntelliJ IDEA｣ &gt; ｢Preferences｣ を開く:</p>

<p><a href="https://camo.qiitausercontent.com/54330b52ecfffbb71b4afb06eaf630a4de22e119/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/54330b52ecfffbb71b4afb06eaf630a4de22e119/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30332e706e67" alt="03.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/03.png"></a></p>

<p>検索窓に｢plugin｣と入力し、｢IDEA Settings｣の中から｢Plugins｣を開く。｢Browse repositories｣ボタンを押す:</p>

<p><a href="https://camo.qiitausercontent.com/38a87f614569d21eae7d94a9e589f59d95efaedf/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/38a87f614569d21eae7d94a9e589f59d95efaedf/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30342e706e67" alt="04.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/04.png"></a></p>

<p>Scalaプラグインを選択し、ダウンロードをする:</p>

<p><a href="https://camo.qiitausercontent.com/b76b820f60f20935c82cdf6e41e4402b32261d27/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b76b820f60f20935c82cdf6e41e4402b32261d27/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30352e706e67" alt="05.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/05.png"></a></p>

<p>確認が出るので、Yesを押す:</p>

<p><a href="https://camo.qiitausercontent.com/2c1ea75f94ec244fa8eeaa6cb829c7062457561f/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2c1ea75f94ec244fa8eeaa6cb829c7062457561f/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30362e706e67" alt="06.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/06.png"></a></p>

<p>ダウンロードが完了するまで待つ:</p>

<p><a href="https://camo.qiitausercontent.com/8adbb986cd073562e7e607230fcd4e4f7d497592/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8adbb986cd073562e7e607230fcd4e4f7d497592/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30372e706e67" alt="07.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/07.png"></a></p>

<p>ダウンロードが完了したら閉じる:</p>

<p><a href="https://camo.qiitausercontent.com/68b6a52d383289591b6a8760fa7e892b23254b62/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/68b6a52d383289591b6a8760fa7e892b23254b62/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30382e706e67" alt="08.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/08.png"></a></p>

<p>さらに閉じる:</p>

<p><a href="https://camo.qiitausercontent.com/7305442989383e4761053e99309a084f4bdeb2db/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/7305442989383e4761053e99309a084f4bdeb2db/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f30392e706e67" alt="09.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/09.png"></a></p>

<p>プラグインを有効化するには再起動する必要があるがどうするかと聞かれるので、｢Restart｣を選択する:</p>

<p><a href="https://camo.qiitausercontent.com/f65672771286bbff662ff21079848f526d5766d1/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f65672771286bbff662ff21079848f526d5766d1/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31302e706e67" alt="10.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/10.png"></a></p>

<h1>
<span id="4-hello-worldプロジェクトを作る" class="fragment"></span><a href="#4-hello-world%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>4. Hello Worldプロジェクトを作る</h1>

<p>新しいプロジェクトを作る:</p>

<p><a href="https://camo.qiitausercontent.com/9d672f758f4bf8c7d4941d2bf90e800bcc5aa939/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9d672f758f4bf8c7d4941d2bf90e800bcc5aa939/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31312e706e67" alt="11.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/11.png"></a></p>

<p>｢Scala Module｣を選択して、｢Project name｣にプロジェクト名を入力する</p>

<p><a href="https://camo.qiitausercontent.com/89f9d7340a494b4581fe95207c659ad891332553/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/89f9d7340a494b4581fe95207c659ad891332553/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31322e706e67" alt="12.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/12.png"></a></p>

<p>Project SDKを選択する:</p>

<p><a href="https://camo.qiitausercontent.com/53324b45be753a8abe46188e18918c73de1080d7/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/53324b45be753a8abe46188e18918c73de1080d7/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31332e706e67" alt="13.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/13.png"></a></p>

<p>Scala Homeを設定する:</p>

<p><a href="https://camo.qiitausercontent.com/a76c2dbb6b27af5f982ee5485f7197ca27bbf5ed/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a76c2dbb6b27af5f982ee5485f7197ca27bbf5ed/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31342e706e67" alt="14.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/14.png"></a></p>

<h1>
<span id="5-hello-worldクラスを作り実行する" class="fragment"></span><a href="#5-hello-world%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E4%BD%9C%E3%82%8A%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5. Hello Worldクラスを作り実行する</h1>

<p>クラスファイルを新規作成する:</p>

<p><a href="https://camo.qiitausercontent.com/e0390a49985b12b599301d46a116f37a7fbe515c/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e0390a49985b12b599301d46a116f37a7fbe515c/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31352e706e67" alt="15.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/15.png"></a></p>

<p>クラス名を決め、種類をObjectにする:</p>

<p><a href="https://camo.qiitausercontent.com/c5cbbff01cace96756769839d135e999e0cee18a/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c5cbbff01cace96756769839d135e999e0cee18a/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31362e706e67" alt="16.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/16.png"></a></p>

<p>main [TAB]と入力する:</p>

<p><a href="https://camo.qiitausercontent.com/406042ff8207d7b73da91af1cc9467997860c035/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/406042ff8207d7b73da91af1cc9467997860c035/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31372e706e67" alt="17.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/17.png"></a></p>

<p>printlnを書く:</p>

<p><a href="https://camo.qiitausercontent.com/05345aea9e0fdda8d93c998dc3117867242d5c7e/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/05345aea9e0fdda8d93c998dc3117867242d5c7e/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31382e706e67" alt="18.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/18.png"></a></p>

<p>プログラムを実行する:</p>

<p><a href="https://camo.qiitausercontent.com/bb49145c3a1873caae3854608bcb9251dcf8e7f0/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/bb49145c3a1873caae3854608bcb9251dcf8e7f0/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f31392e706e67" alt="19.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/19.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/9207ca0cb35570ed07aae798260febe6b7e0c4b4/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f32302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9207ca0cb35570ed07aae798260febe6b7e0c4b4/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f32302e706e67" alt="20.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/20.png"></a></p>

<p>実行結果がでる:</p>

<p><a href="https://camo.qiitausercontent.com/08689c2b254b26443335eefa740a61f953e22152/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f32312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/08689c2b254b26443335eefa740a61f953e22152/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133303830372d7363616c612d696e74656c6c696a2d68656c6c6f2d776f726c642f32312e706e67" alt="21.png" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/130807-scala-intellij-hello-world/21.png"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>113</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/f4ad02e4123c8a3c75eb">Go言語のpackageの作り方: 長くなったコードを別ファイルに切り出す方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-05 14:39:52</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>昨日『<a href="http://qiita.com/suin/items/a0b7eb585eeb6bda4174" id="reference-f0183139a351bb682312">PHPerだが今日初めてGo言語に手を出してみる試み</a>』というタイトルでGoの始め方を書いたが、Goを書き始めたら、あっという間に1ファイルのコードが長くなってきてしまった。長いコードは、関係性に応じてコードを小さな単位に分割したくなってくる。Go言語にはpackageという仕組みが有るので、簡単なpackageを作る方法を説明する。</p>

<h1>
<span id="記事のゴール" class="fragment"></span><a href="#%E8%A8%98%E4%BA%8B%E3%81%AE%E3%82%B4%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>記事のゴール</h1>

<ul>
<li>1ファイルに固まったコードを2ファイルに分割できるようになる</li>
</ul>

<h1>
<span id="準備" class="fragment"></span><a href="#%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>準備</h1>

<p>適当にフォルダを作り、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir ~/Desktop/go-package
cd ~/Desktop/go-package/
</pre></div></div>

<p>Goのソースファイルを作って、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch main.go
</pre></div></div>

<p>好きなエディタで開き、まずは、Hello Worldするコードを書く。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">"log"</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">foo</span><span class="p">()</span>
    <span class="nx">bar</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"Hello world from foo!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">bar</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"Hello world from bar!"</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
</div>

<p>とにかく実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run main.go
2013/12/05 14:32:55 Hello world from foo!
2013/12/05 14:32:55 Hello world from bar!
</pre></div></div>

<h1>
<span id="分割してみる" class="fragment"></span><a href="#%E5%88%86%E5%89%B2%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>分割してみる</h1>

<p>ここでは、この中の <code>foo</code> 関数、<code>bar</code> 関数を別パッケージに切り出すことにする。</p>

<p>パッケージ名は <code>foobar</code> にします。</p>

<p>まず、foobarパッケージのディレクトリを作る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir foobar
</pre></div></div>

<p>次に、2つの関数を書く場所として foobar.go を作る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch foobar/foobar.go
</pre></div></div>

<p>ディレクトリ構成はこのようになる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>.
├── foobar
│   └── foobar.go
└── main.go
</pre></div></div>

<p><code>foobar.go</code> に2つの関数を移植する。<br>
この際、関数は大文字から始めるようにする。<br>
大文字から始まる関数は外部に公開される。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">foobar/foobar.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">foobar</span>

<span class="kn">import</span> <span class="s">"log"</span>

<span class="kd">func</span> <span class="nx">Foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"Hello world from foo!"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Bar</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"Hello world from bar!"</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
</div>

<p>次に、 <code>main.go</code> を改修する。</p>

<ul>
<li>log パッケージは必要なくなったので削る。</li>
<li>foobarパッケージをimportする。</li>
<li>foo, barは関数が大文字になったので変える。</li>
</ul>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">"./foobar"</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">foobar</span><span class="p">.</span><span class="nx">Foo</span><span class="p">()</span>
    <span class="nx">foobar</span><span class="p">.</span><span class="nx">Bar</span><span class="p">()</span>
<span class="p">}</span>

</pre></div>
</div>

<p>動くか実行してみる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run main.go
2013/12/05 14:33:49 Hello world from foo!
2013/12/05 14:33:49 Hello world from bar!
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>109</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/f32fa82d6c35a34e8d16">こんなに簡単! Goで作るRESTサーバー</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-07 01:19:49</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Goを始めて4日たった。仕事関係のウェブサービスで、負荷分散のためにバックエンドを冗長化する必要がでてきた。そういうとなんかすごそうだが、高負荷の外部コマンドを叩くだけのサービスを作ればいい。複雑さはない。今回はそのサービスをRESTサーバーとしてGoで作る。</p>

<h1>
<span id="この記事のゴール" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E3%82%B4%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>この記事のゴール</h1>

<p>Goで作ったRESTサーバーをLinuxにデプロイし、<a href="https://github.com/jkbr/httpie" rel="nofollow noopener" target="_blank">httpie</a>で叩いてみる</p>

<h1>
<span id="準備" class="fragment"></span><a href="#%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>準備</h1>

<p>まず、Macで作ってLinuxにデプロイしようと思うので、Mac, Linux, Windowsにコンパイルできるように、クロスコンパイル可能な状態でGoをインストールする:</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>brew install go --cross-compile-common
</pre></div></div>

<p>次に、適当にフォルダを作る</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>mkdir ~/Desktop/gorest
cd ~/Desktop/gorest/
</pre></div></div>

<p>つぎに、service.goファイルを作る</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>touch service.go
</pre></div></div>

<p>それを、エディタで開く</p>

<p>最後に、$GOPATHをセットしてなければ、とりあえず <code>~/Desktop/gorest</code> にしておく</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>export GOPATH=$(pwd)
</pre></div></div>

<h1>
<span id="apiの仕様" class="fragment"></span><a href="#api%E3%81%AE%E4%BB%95%E6%A7%98"><i class="fa fa-link"></i></a>APIの仕様</h1>

<p>名前を入力すると、Hello, &lt;名前&gt; で返してくる</p>

<ul>
<li>POST /hello</li>
</ul>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">HTTPリクエストのBody</span></div>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">"Name"</span><span class="p">:</span> <span class="s2">"Alice"</span>
<span class="p">}</span>
</pre></div>
</div>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">HTTPレスポンスのBody</span></div>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">"Result"</span><span class="p">:</span> <span class="s2">"Hello, Alice"</span>
<span class="p">}</span>
</pre></div>
</div>

<h1>
<span id="restサーバーを簡単に作れるライブラリを取ってくる" class="fragment"></span><a href="#rest%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E7%B0%A1%E5%8D%98%E3%81%AB%E4%BD%9C%E3%82%8C%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E5%8F%96%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8B"><i class="fa fa-link"></i></a>RESTサーバーを簡単に作れるライブラリを取ってくる</h1>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>go get github.com/ant0ine/go-json-rest
</pre></div></div>

<h1>
<span id="サーバーservicegoのコードを書く" class="fragment"></span><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BCservicego%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F"><i class="fa fa-link"></i></a>サーバー(service.go)のコードを書く</h1>

<p>賞味40行くらい</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">service.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"github.com/ant0ine/go-json-rest"</span>
    <span class="s">"log"</span>
    <span class="s">"net/http"</span>
<span class="p">)</span>

<span class="c1">// 入力の定義</span>
<span class="kd">type</span> <span class="nx">postHelloInput</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// 出力の定義</span>
<span class="kd">type</span> <span class="nx">postHelloOutput</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Result</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">postHello</span><span class="p">(</span><span class="nx">w</span> <span class="o">*</span><span class="nx">rest</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">rest</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">input</span> <span class="o">:=</span> <span class="nx">postHelloInput</span><span class="p">{}</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">DecodeJsonPayload</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">input</span><span class="p">)</span>

    <span class="c1">// そもそも入力の形式と違うとここでエラーになる</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">rest</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">// 適当なバリデーション</span>
    <span class="k">if</span> <span class="nx">input</span><span class="p">.</span><span class="nx">Name</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
        <span class="nx">rest</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">"Name is required"</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%#v"</span><span class="p">,</span> <span class="nx">input</span><span class="p">)</span>

    <span class="c1">// 結果を返す部分</span>
    <span class="nx">w</span><span class="p">.</span><span class="nx">WriteJson</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">postHelloOutput</span><span class="p">{</span>
        <span class="s">"Hello, "</span> <span class="o">+</span> <span class="nx">input</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
    <span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">handler</span> <span class="o">:=</span> <span class="nx">rest</span><span class="p">.</span><span class="nx">ResourceHandler</span><span class="p">{}</span>
    <span class="nx">handler</span><span class="p">.</span><span class="nx">SetRoutes</span><span class="p">(</span>
        <span class="nx">rest</span><span class="p">.</span><span class="nx">Route</span><span class="p">{</span><span class="s">"POST"</span><span class="p">,</span> <span class="s">"/hello"</span><span class="p">,</span> <span class="nx">postHello</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Server started"</span><span class="p">)</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">":9999"</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">handler</span><span class="p">)</span> <span class="c1">// ポート9999で立ち上がる</span>
<span class="p">}</span>
</pre></div>
</div>

<h1>
<span id="実行してみる" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>実行してみる</h1>

<p><code>go run server.go</code> でサーバーを起動する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>go run service.go
</pre></div></div>

<p>ターミナルの別タブを開いて、httpieでリクエストを投げてみる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>http -v POST localhost:9999/hello "Content-Type:application/json; charset=UTF-8" Name="Suin"
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>POST /hello HTTP/1.1
Accept: application/json
Accept-Encoding: gzip, deflate, compress
Content-Length: 16
Content-Type: application/json; charset=UTF-8
Host: localhost:9999
User-Agent: HTTPie/0.6.0

{
    "Name": "Suin"
}

HTTP/1.1 200 OK
Content-Length: 29
Content-Type: application/json
Date: Fri, 06 Dec 2013 16:10:15 GMT

{
    "Result": "Hello, Suin"
}

</pre></div></div>

<p>うまく動いている様子。</p>

<h1>
<span id="linux用にビルドする" class="fragment"></span><a href="#linux%E7%94%A8%E3%81%AB%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Linux用にビルドする</h1>

<p>Linux 64ビット用のバイナリを作る:</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>GOOS=linux GOARCH=amd64 go build service.go
</pre></div></div>

<p>ビルドが終わると <code>service</code> という名前で7MBくらいの実行形式のバイナリができあがる。</p>

<h1>
<span id="ポート9999が開けてあるlinuxに持ってく" class="fragment"></span><a href="#%E3%83%9D%E3%83%BC%E3%83%889999%E3%81%8C%E9%96%8B%E3%81%91%E3%81%A6%E3%81%82%E3%82%8Blinux%E3%81%AB%E6%8C%81%E3%81%A3%E3%81%A6%E3%81%8F"><i class="fa fa-link"></i></a>ポート9999が開けてあるLinuxに持ってく</h1>

<p>scpとかで転送する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>scp service vagrant:
</pre></div></div>

<p>サーバにログインして、今転送したserviceを起動する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>vagrant@suin:~$ ./service
2013/12/07 01:15:02 Server started
</pre></div></div>

<p>手元のMacから httpie で叩いてみる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>http -v POST 11.11.11.11:9999/hello "Content-Type:application/json; charset=UTF-8" Name="Suin"
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>POST /hello HTTP/1.1
Accept: application/json
Accept-Encoding: gzip, deflate, compress
Content-Length: 16
Content-Type: application/json; charset=UTF-8
Host: 11.11.11.11:9999
User-Agent: HTTPie/0.6.0

{
    "Name": "Suin"
}

HTTP/1.1 200 OK
Content-Length: 29
Content-Type: application/json
Date: Fri, 06 Dec 2013 16:16:15 GMT

{
    "Result": "Hello, Suin"
}
</pre></div></div>

<p>Apacheも必要なくファイル一個だけで動くLinuxのRESTサーバーができました!</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>95</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/cdef17e447ceeff6e79d">Pythonで再帰的にファイル・ディレクトリを探して出力する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-11 17:30:36</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Pythonで再帰的に全てのファイルやディレクトリのリストを作るときは、<code>os.walk()</code>とジェネレーター(<code>yield</code>)を組み合わせた関数を作っとくと楽。</p>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">例えばこんなディレクトリ構成</span></div>
<div class="highlight"><pre><span></span>$ tree /tmp/test
/tmp/test
├── 1
│   ├── a
│   │   ├── A
│   │   ├── B
│   │   └── hoge
│   └── b
│       ├── A
│       ├── B
│       └── hoge
└── 2
    ├── bar
    ├── c
    │   ├── buzz
    │   └── fizz
    └── foo

9 directories, 6 files
</pre></div>
</div>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">find_all_files</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">root</span>
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>

<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">find_all_files</span><span class="p">(</span><span class="s1">'/tmp/test'</span><span class="p">):</span>
    <span class="k">print</span> <span class="nb">file</span>
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">出力</span></div>
<div class="highlight"><pre><span></span>/tmp/test
/tmp/test/1
/tmp/test/1/a
/tmp/test/1/a/hoge
/tmp/test/1/a/A
/tmp/test/1/a/B
/tmp/test/1/b
/tmp/test/1/b/hoge
/tmp/test/1/b/A
/tmp/test/1/b/B
/tmp/test/2
/tmp/test/2/bar
/tmp/test/2/foo
/tmp/test/2/c
/tmp/test/2/c/buzz
/tmp/test/2/c/fizz
</pre></div>
</div>

<h2>
<span id="関連記事" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B"><i class="fa fa-link"></i></a>関連記事</h2>

<ul>
<li>
<a href="http://qiita.com/suin/items/b5445ff6fbc21e8d883a" id="reference-508438f987079761eab9">PHP - ディレクトリを再帰的に削除する方法のメモ - Qiita</a>: PHPで同じようなことをする場合は <code>RecursiveIteratorIterator</code> を使うとできる</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>91</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/c958bcca90262467f2c0">ランダムなパスワードを1行で生成する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2011-12-18 22:04:06</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ランダムなパスワードや文字列を生成する方法を6つ紹介します。</p>

<h1>
<span id="1-str_shuffle-を使う" class="fragment"></span><a href="#1-str_shuffle-%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>1. str_shuffle() を使う</h1>

<ul>
<li>同じ文字が2回出ない</li>
<li>36文字まで生成可能</li>
</ul>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">random</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">str_shuffle</span><span class="p">(</span><span class="s1">'1234567890abcdefghijklmnopqrstuvwxyz'</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$length</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="2-mt_rand-を使う" class="fragment"></span><a href="#2-mt_rand-%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>2. mt_rand() を使う</h1>

<ul>
<li>同じ文字が複数回でる可能性がある</li>
<li>12文字まで生成可能</li>
</ul>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">random</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">base_convert</span><span class="p">(</span><span class="nb">mt_rand</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="nv">$length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="nv">$length</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">36</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></div>

<h1>
<span id="3-md5uniqid-を使う" class="fragment"></span><a href="#3-md5uniqid-%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>3. md5(uniqid()) を使う</h1>

<ul>
<li>同じ文字が複数回でる可能性がある</li>
<li>25文字まで生成可能</li>
</ul>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">random</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">base_convert</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nb">uniqid</span><span class="p">()),</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$length</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<p>sha256にすることで48文字まで生成可能になる</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">random</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">base_convert</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">'sha256'</span><span class="p">,</span> <span class="nb">uniqid</span><span class="p">()),</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$length</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="4-array_reduce-を使う" class="fragment"></span><a href="#4-array_reduce-%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>4. array_reduce() を使う</h1>

<ul>
<li>同じ文字が複数回でる可能性がある</li>
<li>何文字でも生成可能</li>
</ul>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">random</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">array_reduce</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$length</span><span class="p">),</span> <span class="k">function</span><span class="p">(</span><span class="nv">$p</span><span class="p">){</span> <span class="k">return</span> <span class="nv">$p</span><span class="o">.</span><span class="nb">str_shuffle</span><span class="p">(</span><span class="s1">'1234567890abcdefghijklmnopqrstuvwxyz'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span> <span class="p">});</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="5-opensslを使う" class="fragment"></span><a href="#5-openssl%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>5. opensslを使う</h1>

<p><a href="http://qiita.com/ngyuki/items/dd947aae213327cbeb70" id="reference-d5a3d065e291a5adc13b">PHP - ランダムなパスワードを1行で生成する with openssl - Qiita</a></p>

<h1>
<span id="6-str_repeat--str_shuffle" class="fragment"></span><a href="#6-str_repeat--str_shuffle"><i class="fa fa-link"></i></a>6. str_repeat + str_shuffle</h1>

<ul>
<li>同じ文字が複数回でる可能性がある</li>
<li>何文字でも生成可能</li>
</ul>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">random</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">str_shuffle</span><span class="p">(</span><span class="nb">str_repeat</span><span class="p">(</span><span class="s1">'0123456789abcdefghijklmnopqrstuvwxyz'</span><span class="p">,</span> <span class="nv">$length</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$length</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<p>参考: <a href="http://landhere.info/blog/a67.html" rel="nofollow noopener" target="_blank">[PHP] 一行でランダムパスワードを得る方法 : してログ - LANDHERE</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>89</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/a0b7eb585eeb6bda4174">PHPerだが今日初めてGo言語に手を出してみる試み</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-04 19:25:09</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="この試みのゴール" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A9%A6%E3%81%BF%E3%81%AE%E3%82%B4%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>この試みのゴール</h1>

<ul>
<li>Go言語でコマンドを叩けるようになる</li>
</ul>

<h1>
<span id="つまづいたときのググり方" class="fragment"></span><a href="#%E3%81%A4%E3%81%BE%E3%81%A5%E3%81%84%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE%E3%82%B0%E3%82%B0%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>つまづいたときのググり方</h1>

<p><code>go</code> だけでググるとGo言語以外の情報も出てくるので「Go言語」や「go lang」で検索する。</p>

<h1>
<span id="goをインストールする" class="fragment"></span><a href="#go%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Goをインストールする</h1>

<p>Macで作ってLinuxにデプロイしようと思うので、Mac, Linux, Windowsにコンパイルできるように、クロスコンパイル可能な状態でGoをインストールする:</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>brew install go --cross-compile-common
</pre></div></div>

<h1>
<span id="とりあえず-hello-world" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A-hello-world"><i class="fa fa-link"></i></a>とりあえず Hello World</h1>

<p>適当にフォルダ作って…</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cd ~/Desktop
mkdir my-first-go
cd my-first-go
</pre></div></div>

<p>そこにgoのファイル作って…</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>touch hello-world.go
</pre></div></div>

<p>エディタでそれを開いて、以下の10行程度のコードを書く。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">hello-world.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"Hello World\n"</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>おもむろに実行してみる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>go run hello-world.go
</pre></div></div>

<p>Hello Worldって出ればOK。</p>

<h1>
<span id="コンパイルしてみよう" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>コンパイルしてみよう</h1>

<p><code>go build</code> ってやるだけでコンパイルできる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>go build hello-world.go
</pre></div></div>

<p>ビルドしたファイルを実行してみる:</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>% ./hello-world
Hello World
</pre></div></div>

<p>こんな簡単にバイナリのコマンドが作れるなんてワクワクする！</p>

<h1>
<span id="さらにlinux-64ビット用のバイナリを作ってみる" class="fragment"></span><a href="#%E3%81%95%E3%82%89%E3%81%ABlinux-64%E3%83%93%E3%83%83%E3%83%88%E7%94%A8%E3%81%AE%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>さらに、Linux 64ビット用のバイナリを作ってみる</h1>

<p>Mac用の <code>hello-world</code> は消して、</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>rm -f hello-world
</pre></div></div>

<p>Linux 64ビット用のバイナリを作る:</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>GOOS=linux GOARCH=amd64 go build hello-world.go
</pre></div></div>

<p>できたら、適当なLinuxのマシンに送って、</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>scp hello-world sakura-vps:
</pre></div></div>

<p>Linuxにログインして、</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>ssh sakura-vps
</pre></div></div>

<p>実行してみる:</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>$ ./hello-world
Hello World
</pre></div></div>

<p>おー、出た！</p>

<p>Linuxからログアウトする</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>exit
</pre></div></div>

<h1>
<span id="コマンドを実行するだけのプログラムを作ってみる" class="fragment"></span><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%A0%E3%81%91%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>コマンドを実行するだけのプログラムを作ってみる</h1>

<p>とりあえず、Linuxコマンドさえコールできれば、Go言語でひかかってもなんとかなりそうなので、コマンドの呼び出し方を覚える。</p>

<p><code>hello-world.go</code> をコピーして <code>call-command.go</code> を作る</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>cp hello-world.go call-command.go
</pre></div></div>

<p>コマンドを実行するには <a href="http://golang.org/pkg/os/exec/" rel="nofollow noopener" target="_blank">exec</a> パッケージをインポートする:</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"os/exec"</span>
<span class="p">)</span>
</pre></div></div>

<p>あと、<code>fmt.Print</code> もいいけど、 <code>log</code> パッケージの <code>log.Print</code> のほうが時刻も一緒に出力してくれるので、<code>fmt</code> を <code>log</code> に置き換える:</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"os/exec"</span>
<span class="p">)</span>
</pre></div></div>

<p><code>date</code> コマンドを実行するコードを書く:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">call-command.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"os/exec"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"これはコマンドを実行するプログラムです!\n"</span><span class="p">)</span>
    <span class="nx">out</span><span class="p">,</span> <span class="kt">error</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">"date"</span><span class="p">).</span><span class="nx">Output</span><span class="p">()</span>

    <span class="k">if</span> <span class="kt">error</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"エラー: %s"</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"現在時刻: %s"</span><span class="p">,</span> <span class="nx">out</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run call-command.go                                                                                                                                                                                                           [18:23:40]
2013/12/04 18:24:24 これはコマンドを実行するプログラムです!
2013/12/04 18:24:24 現在時刻: Wed Dec  4 18:24:24 JST 2013
</pre></div></div>

<p>ちゃんと、現在時刻出ました!</p>

<p>エラーの場合どうなるか試してみる。<br>
手っ取り早く <code>date</code> コマンドを <code>false</code> コマンドに置き換えてみる:</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span>    <span class="nx">out</span><span class="p">,</span> <span class="kt">error</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">"false"</span><span class="p">).</span><span class="nx">Output</span><span class="p">()</span>
                                <span class="err">~~~~~</span> <span class="nx">ここ</span>
</pre></div></div>

<p>実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run call-command.go                                                                                                                                                                                                           [18:24:34]
2013/12/04 18:26:44 これはコマンドを実行するプログラムです!
2013/12/04 18:26:44 エラー: exit status 1
</pre></div></div>

<p>ちゃんとエラーの分岐に入りました!</p>

<h2>
<span id="引数を取るコマンドの実行" class="fragment"></span><a href="#%E5%BC%95%E6%95%B0%E3%82%92%E5%8F%96%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>引数を取るコマンドの実行</h2>

<p><code>ls -la</code> のように引数をとるコマンドを試してみる。<br>
コマンドの引数は <code>exec.Command()</code> の第二引数以降に与える。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">call-command.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"os/exec"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"これはコマンドを実行するプログラムです!\n"</span><span class="p">)</span>
    <span class="nx">out</span><span class="p">,</span> <span class="kt">error</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">"ls"</span><span class="p">,</span> <span class="s">"-la"</span><span class="p">).</span><span class="nx">Output</span><span class="p">()</span>

    <span class="k">if</span> <span class="kt">error</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"エラー: %s"</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="nx">out</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% go run call-command.go                                                                                                                                                                                                           [18:29:46]
2013/12/04 18:30:58 これはコマンドを実行するプログラムです!
2013/12/04 18:30:58 total 4424
drwxr-xr-x   5 suin  staff      170 Dec  4 18:08 .
drwx------+ 16 suin  staff      544 Dec  4 17:59 ..
-rw-r--r--   1 suin  staff      278 Dec  4 18:29 call-command.go
-rwxr-xr-x   1 suin  staff  2255544 Dec  4 18:08 hello-world
-rw-r--r--   1 suin  staff       77 Dec  4 18:02 hello-world.go
</pre></div></div>

<h2>
<span id="時間のかかるコマンド" class="fragment"></span><a href="#%E6%99%82%E9%96%93%E3%81%AE%E3%81%8B%E3%81%8B%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>時間のかかるコマンド</h2>

<p>時間がかかるコマンドは、終わるのを待たずに処理を進めたい場合があるので、そのやり方を覚える。</p>

<p>以下は、<code>sleep 2</code> コマンドを実行する例:</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"fmt"</span>
    <span class="s">"os/exec"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"これはコマンドを実行するプログラムです!\n"</span><span class="p">)</span>
    <span class="nx">command</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">"sleep"</span><span class="p">,</span> <span class="s">"2"</span><span class="p">)</span>
    <span class="kt">error</span> <span class="o">:=</span> <span class="nx">command</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>

    <span class="k">if</span> <span class="kt">error</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"エラー1: %v"</span><span class="p">,</span> <span class="kt">error</span><span class="p">))</span> <span class="c1">// コマンドがなかった場合とか</span>
    <span class="p">}</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"コマンドを開始しました"</span><span class="p">)</span>

    <span class="kt">error</span> <span class="p">=</span> <span class="nx">command</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>

    <span class="k">if</span> <span class="kt">error</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"エラー2: %v"</span><span class="p">,</span> <span class="kt">error</span><span class="p">))</span> <span class="c1">// コマンドがエラーステータスで終了した場合</span>
    <span class="p">}</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"コマンドが終了しました"</span><span class="p">)</span>
<span class="p">}</span>

</pre></div></div>

<p>こんなかんじで、大まかなコマンドの実行方法がつかめたと思う。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>81</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/857f839e894f5da787f8">【まとめ】Qiita API ライブラリ/ラッパー</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-14 16:45:06</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> <b>[Ruby]</b> <b>[Perl]</b> <b>[PHP]</b> <b>[QiitaAPI]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>先日公開された<a href="http://qiita.com/docs">Qiita API</a>の各言語のライブラリが続々とではじめているのでまとめました。</p>

<table>
<thead>
<tr>
<th>Platform</th>
<th>API version</th>
<th>
<img alt=":octocat:" class="emoji" height="20" src="https://cdn.qiita.com/emoji/octocat.png" title=":octocat:" width="20">  GitHub</th>
<th>Article</th>
</tr>
</thead>
<tbody>
<tr>
<td>ActionScript</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/katsuren/QiitaAPILibForAS3" rel="nofollow noopener" target="_blank">katsuren/QiitaAPILibForAS3</a></td>
<td><a href="http://qiita.com/items/24fce09ee26eb0cae78a">AS3 で Qiita API を利用するライブラリ作った</a></td>
</tr>
<tr>
<td>Elixir</td>
<td><a href="http://qiita.com/api/v2/docs">2</a></td>
<td><a href="https://github.com/ma2gedev/qiita_ex" rel="nofollow noopener" target="_blank">ma2gedev/qiita_ex</a></td>
<td><a href="http://qiita.com/ma2ge/items/8645f0e8bbd41e48b84b" id="reference-e9920c1ac4edd66e0409">Elixir 実装の Qiita API v2 Client を公開しました</a></td>
</tr>
<tr>
<td>Go</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/Warashi/qiita-go" rel="nofollow noopener" target="_blank">Warashi/qiita-go</a></td>
<td><a href="http://qiita.com/saveji/items/382cd382aa254121f1a5" id="reference-b2b0a5834daf8c68e2b4">Qiita API の wrapper を書いてみた</a></td>
</tr>
<tr>
<td>Haskell</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/jabaraster/network-qiita" rel="nofollow noopener" target="_blank">jabaraster/network-qiita</a></td>
<td><a href="http://qiita.com/items/a0e4d1a105b12467850f">Network.Qiita作りました！</a></td>
</tr>
<tr>
<td>Java</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/zaneli/qiita4j" rel="nofollow noopener" target="_blank">zaneli/qiita4j</a></td>
<td><a href="http://qiita.com/items/da835a0fd871b3e21158">Qiita API Java ラッパーライブラリを作りました！</a></td>
</tr>
<tr>
<td>Objective-C</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/ngs/AFQiitaClient" rel="nofollow noopener" target="_blank">ngs/AFQiitaClient</a></td>
<td><a href="http://qiita.com/items/6d66b98ce3a20ea8f23c">AFQiitaClient の使い方</a></td>
</tr>
<tr>
<td>Perl</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/y-uuki/WebService-Qiita" rel="nofollow noopener" target="_blank">y-uuki/WebService-Qiita</a></td>
<td><a href="http://qiita.com/items/e02abe21f3a719fac16a">Qiita APIのPerlラッパー作った</a></td>
</tr>
<tr>
<td>PHP</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/suin/php-qiita" rel="nofollow noopener" target="_blank">suin/php-qiita</a></td>
<td><a href="http://qiita.com/items/34fd34182ab2abd092fb">php-qiita: Qiita API PHPライブラリ</a></td>
</tr>
<tr>
<td>PHP</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/t-ishida/Net_Qiita" rel="nofollow noopener" target="_blank">t-ishida/Net_Qiita</a></td>
<td><a href="http://qiita.com/items/3dc4c784d3f3d546bcb2">Net_Qiita</a></td>
</tr>
<tr>
<td>Python</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/heavenshell/py-qiita" rel="nofollow noopener" target="_blank">heavenshell/py-qiita</a></td>
<td><a href="http://qiita.com/items/1e5397fd6df917628822">Qiita API の Python ラッパーを作った</a></td>
</tr>
<tr>
<td>Python</td>
<td><a href="http://qiita.com/api/v2/docs">2</a></td>
<td><a href="https://github.com/petitviolet/qiita_py" rel="nofollow noopener" target="_blank">petitviolet/qiita_py</a></td>
<td><a href="http://qiita.com/petitviolet/items/deda7b66852635264508" id="reference-c0d858fff44372bacfb9">Qiita API v2のPythonラッパー実装した</a></td>
</tr>
<tr>
<td>Ruby</td>
<td><a href="http://qiita.com/api/v2/docs">2</a></td>
<td><a href="https://github.com/increments/qiita-rb" rel="nofollow noopener" target="_blank">increments/qiita-rb</a></td>
<td><a href="http://blog.qiita.com/post/98796001374/qiita-api-v2" rel="nofollow noopener" target="_blank">Qiita/Qiita:Team API v2を公開しました！</a></td>
</tr>
<tr>
<td>Ruby</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/yuki24/kiita" rel="nofollow noopener" target="_blank">yuki24/kiita</a></td>
<td>Qiita Hackathonにて紹介</td>
</tr>
<tr>
<td>Scala</td>
<td><a href="http://qiita.com/api/v2/docs">2</a></td>
<td><a href="https://github.com/xuwei-k/qiitascala" rel="nofollow noopener" target="_blank">xuwei-k/qiitascala</a></td>
<td><a href="http://qiita.com/xuwei_k/items/12dc1926ba8cf70efd56" id="reference-505713c46f244b70bda5">QiitaのScalaのAPI clientライブラリ作った</a></td>
</tr>
<tr>
<td>Vim</td>
<td><a href="https://qiita.com/docs">1</a></td>
<td><a href="https://github.com/mattn/qiita-vim" rel="nofollow noopener" target="_blank">mattn/qiita-vim</a></td>
<td><a href="http://qiita.com/items/4b31a7ecd0a1fd761fe1">Qiita.vim 作りました!</a></td>
</tr>
</tbody>
</table>

<p>ここに記載されていないライブラリがあったら、「編集リクエスト」またはコメント欄で知らせてください！<br>
また、Qiita API v2に対応した、v1のサポートを切った等の更新などもお知らせください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>79</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/cbbbe8844fd734fa20e2">PHPで改行コードを統一する関数: CRLF, CR, LF が混在してる文字列を LF に変換するなど</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-02-22 16:30:46</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>各OS向けにCSVを出力するときとか。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">function</span> <span class="nf">convertEOL</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$to</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="p">{</span>   
    <span class="k">return</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">"/</span><span class="se">\r\n</span><span class="s2">|</span><span class="se">\r</span><span class="s2">|</span><span class="se">\n</span><span class="s2">/"</span><span class="p">,</span> <span class="nv">$to</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$string</span> <span class="o">=</span> <span class="s2">"CR + LF: </span><span class="se">\r\n</span><span class="s2"> CR: </span><span class="se">\r</span><span class="s2"> LF: </span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">"Testing string:"</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$string</span><span class="p">),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">"For MacOSX, Unix, Linux"</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nx">convertEOL</span><span class="p">(</span><span class="nv">$string</span><span class="p">)),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">"For Windows"</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nx">convertEOL</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">)),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">"For MacOS 9"</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nx">convertEOL</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s2">"</span><span class="se">\r</span><span class="s2">"</span><span class="p">)),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</pre></div></div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">結果</span></div>
<div class="highlight"><pre><span></span>Testing string:
"CR + LF: \r\n CR: \r LF: \n"
For MacOSX, Unix, Linux
"CR + LF: \n CR: \n LF: \n"
For Windows
"CR + LF: \r\n CR: \r\n LF: \r\n"
For MacOS 9
"CR + LF: \r CR: \r LF: \r"
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>76</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/269fa582e40f439d012f">トリガーの開発方法＆デバッグ方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-06-06 17:10:51</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[MySQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>MySQLのトリガー便利です。PHPでトランザクションを張って同期…というのもありだけど、データベースのレイヤで関係が担保されているのは開発者にとっても安心です。</p>

<p>しかし、トリガーの開発方法についての情報は少ない感じがあります。手探りで自己流なところがあると思いますが、トリガーの開発方法を整理できるくらいに自分の中でルーティンが決まってきたので記事としてまとめておきます。</p>

<h1>
<span id="掲示板のデータベースを例に作ってみよう" class="fragment"></span><a href="#%E6%8E%B2%E7%A4%BA%E6%9D%BF%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%82%92%E4%BE%8B%E3%81%AB%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>掲示板のデータベースを例に作ってみよう</h1>

<p>お題がないと説明しにくいので、掲示板アプリを例に話を進めます。YY-BBSのような単純な掲示板を思い浮かべてください。<br>
2つのテーブルを用意します。</p>

<ul>
<li>スレッドテーブル</li>
<li>投稿テーブル</li>
</ul>

<p>もう少しテーブルの関係がイメージしやすいようにもうちょい妄想しちゃいます。</p>

<p>スレッドテーブルと投稿テーブルは一対多の関係にあります。一つのスレッドに複数の投稿が記録できる仕様です。掲示板にはスレッド一覧のページがあります。そこにスレッドに対しての投稿数N件を表示しています。投稿数N件は、現仕様で <code>SELECT COUNT(*) FROM 投稿テーブル WHERE スレID = ?</code> といった具合に、毎回計算して表示するようになっています。</p>

<p>また、一覧ページにはソート機能があって、投稿数の多い少ないでソートできる仕様です。このときもさっきの <code>SELECT文</code> と <code>JOIN</code> で頑張っています。</p>

<p>さて、掲示板の投稿が増えてきて、若干重いなーと感じてきたので、投稿数N件は予め計算した値をスレッドテーブルに保存するように仕様変更したいと思います。</p>

<p>そんな掲示板のテーブルです。</p>

<p>新規投稿があるときに、PHPで <code>SELECT COUNT(*)</code> するのもありです。洗い替えするのはそのタイミングだけではありません。編集のときは？削除のときは？投稿のスレッド間移動のときは？管理者による投稿の一括削除のときは？などなど、いろいろ出てきそうです。こうなってくるとPHPに手を入れるのが嫌になります。そこでトリガーの出番です！</p>

<h1>
<span id="テーブルを作る" class="fragment"></span><a href="#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>テーブルを作る</h1>

<p>とりあえず、叩き台のテーブルを作ります。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="c1">-- スレッドテーブル</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">bbs_thread</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">title</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span><span class="p">,</span>
  <span class="o">`</span><span class="n">post_total</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>


<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">bbs_thread</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">title</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">post_total</span><span class="o">`</span><span class="p">)</span>
<span class="k">VALUES</span>
     <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'【便利】トリガーを試してみるスレ【使いたい】'</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</pre></div></div>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="c1">-- 投稿テーブル</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">bbs_post</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">thread_id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">body</span><span class="o">`</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>


<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">bbs_post</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">thread_id</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">username</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">body</span><span class="o">`</span><span class="p">)</span>
<span class="k">VALUES</span>
     <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'名無し'</span><span class="p">,</span> <span class="s1">'MySQLのトリガーってどうよ？'</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'名無し２'</span><span class="p">,</span> <span class="s1">'ずさー'</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'名無し３'</span><span class="p">,</span> <span class="s1">'3げと'</span><span class="p">);</span>
</pre></div></div>

<h1>
<span id="トリガー開発の手順" class="fragment"></span><a href="#%E3%83%88%E3%83%AA%E3%82%AC%E3%83%BC%E9%96%8B%E7%99%BA%E3%81%AE%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>トリガー開発の手順</h1>

<p>トリガーの開発手順は次のように行います。</p>

<ol>
<li>デバッグ環境の準備

<ol>
<li>ダンプテーブルの作成</li>
<li>ダンプ関数の作成</li>
</ol>
</li>
<li>ストアドプロシージャの作成</li>
<li>トリガーの作成</li>
<li>トリガーの単体テスト</li>
</ol>

<h2>
<span id="1-デバッグ環境の準備" class="fragment"></span><a href="#1-%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E7%92%B0%E5%A2%83%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>1. デバッグ環境の準備</h2>

<p>PHPであれば <code>var_dump()</code> でデバッグすることができます。MySQLではこのような関数がないようなので、自前で作る必要があります。</p>

<h3>
<span id="11-ダンプテーブルの作成" class="fragment"></span><a href="#11-%E3%83%80%E3%83%B3%E3%83%97%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1.1 ダンプテーブルの作成</h3>

<p><code>var_dump()</code> は画面出力という形で、変数をダンプしますが、MySQLではテーブルに出力するという形で変数を確認するようにします。<br>
そのため、出力用のテーブルを作るのが第一ステップになります。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">dump</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="nb">text</span><span class="p">,</span>
  <span class="o">`</span><span class="n">value</span><span class="o">`</span> <span class="nb">text</span><span class="p">,</span>
  <span class="o">`</span><span class="n">created</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">MyISAM</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</pre></div></div>

<h3>
<span id="12-ダンプ用プロシージャの作成" class="fragment"></span><a href="#12-%E3%83%80%E3%83%B3%E3%83%97%E7%94%A8%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>1.2 ダンプ用プロシージャの作成</h3>

<p>出力先ができたので、今度はvar_dump()のような出力関数を作ります。MySQLではストアドプロシージャで出力関数を実装するといいでしょう。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">DELIMITER</span> <span class="err">$$</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="o">`</span><span class="n">dump</span><span class="o">`</span><span class="p">(</span><span class="k">IN</span> <span class="err">$</span><span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span> <span class="k">IN</span> <span class="err">$</span><span class="n">value</span> <span class="nb">TEXT</span><span class="p">)</span>
     <span class="k">BEGIN</span>
          <span class="cm">/**</span>
<span class="cm">           * デバッグ用プロシージャ</span>
<span class="cm">           * @param TEXT $name 変数名</span>
<span class="cm">           * @param TEXT $value 変数値</span>
<span class="cm">           */</span>

          <span class="c1">-- テーブルにダンプする</span>
          <span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">dump</span><span class="o">`</span> <span class="k">SET</span> <span class="o">`</span><span class="n">name</span><span class="o">`</span> <span class="o">=</span> <span class="err">$</span><span class="n">name</span><span class="p">,</span> <span class="o">`</span><span class="n">value</span><span class="o">`</span> <span class="o">=</span> <span class="err">$</span><span class="n">value</span><span class="p">,</span> <span class="o">`</span><span class="n">created</span><span class="o">`</span> <span class="o">=</span> <span class="n">NOW</span><span class="p">();</span>
     <span class="k">END</span><span class="err">$$</span>
<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div></div>

<p>試しに呼んでみよう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql&gt; CALL dump('hoge', 'ほげ');
Query OK, 1 row affected (0.00 sec)

mysql&gt; SELECT * FROM dump;
+----+------+--------+---------------------+
| id | name | value  | created             |
+----+------+--------+---------------------+
|  1 | hoge | ほげ   | 2011-10-17 13:52:33 |
+----+------+--------+---------------------+
1 row in set (0.00 sec)
</pre></div></div>

<p>ちゃんと入っている。</p>

<h2>
<span id="2-ストアドプロシージャの作成" class="fragment"></span><a href="#2-%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>2. ストアドプロシージャの作成</h2>

<h3>
<span id="21-下準備" class="fragment"></span><a href="#21-%E4%B8%8B%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>2.1 下準備</h3>

<p>いきなりトリガーを実装してもいいけど、次の理由から実装はストアドプロシージャにしてトリガーはそのラッパーという位置づけがおすすめです。</p>

<ul>
<li>ストアドプロシージャにしとくと再利用性が高くなる。トリガーAとトリガーBで同じ処理が使える利点があります。また、トリガーを作ってさあデプロイってときにもプロシージャが再利用できちゃう。</li>
<li>同じイベントのトリガーは一つのテーブルに一つまで。トリガーに直ガキすると、新しいトリガーを追加するときにトリガーがモンスター化して、メンテが大変になります。ストアドプロシージャをラップする形にしておくと、見た目もスッキリ。メンテも楽。</li>
</ul>

<p>ということで、ストアドプロシージャを実装します。</p>

<p>ストアドプロシージャのテンプレートはこんなかんじ。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">PROCEDURE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="err">{プロシージャ名}</span><span class="p">;</span>

<span class="k">DELIMITER</span> <span class="err">$$</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="err">{プロシージャ名}</span><span class="p">(</span><span class="k">IN</span> <span class="err">$</span><span class="n">id</span> <span class="nb">INT</span><span class="p">)</span>
     <span class="n">main</span><span class="p">:</span><span class="k">BEGIN</span>
          <span class="cm">/**</span>
<span class="cm">           * かくかくしかじかするプロシージャ</span>
<span class="cm">           * @param INT $id ほげほげID</span>
<span class="cm">           */</span>

          <span class="c1">-- ここに処理を実装する</span>
     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>
<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div></div>

<p>ストアドプロシージャ名は個人的に次のような名づけルールがあります。</p>

<ul>
<li>挿入系: <code>insert_{テーブル名}_{カラム名}</code>
</li>
<li>更新系: <code>update_{テーブル名}_{カラム名}</code>
</li>
<li>削除系: <code>delete_{テーブル名}_{カラム名}</code>
</li>
</ul>

<p>テーブル名カラム名は影響を与える先を指すようにします。呼び出しもとではありません。たとえば、掲示板のスレッドテーブル(bbs_thread)に、投稿数カラム(post_total)があるとして、投稿数カラムを更新するプロシージャ（更新系）は <code>update_bbs_thread_post_total</code> という名前にします。（テーブルごとに接頭辞が規約で決まっていて、カラム名がある程度ユニークな場合にはテーブル名を省くこともあります）</p>

<p>最初に、<code>DROP PROCEDURE IF EXISTS</code> があるのは、開発中になんどもプロシージャを書き換えるからです。<code>DROP PROCEDURE IF EXISTS</code> と <code>CREATE PROCEDURE</code> はセットに(1ファイル)しておくとmysqlコマンドを叩くだけでプロシージャを更新できます。</p>

<p>変数名が<code>$</code>で始まっているのは変数であるということを分かりやすく（PHPの影響もあるが）するためです。また、変数名がカラム名とかぶると、しばしばドハマリするのでカラム名に使わない文字である<code>$</code>を使って衝突を防ぐという意味合いがあります。</p>

<p><code>main:BEGIN</code> の <code>main</code> はラベルです。<br>
ストアドプロシージャの途中で処理を抜けたいときに <code>LEAVE main;</code> とすることでプロシージャの処理を終わらせることができます。これは <code>main</code> ラベルの処理を去る（LEAVE)という意味です。PHPの <code>return</code> のようなことができるわけです。<br>
条件によってうまく <code>LEAVE main</code> を使えば、余計なクエリーを発行しなくていいので、リソースの節約になります。</p>

<h3>
<span id="22ストアドプロシージャ内で使う変数の定義" class="fragment"></span><a href="#22%E3%82%B9%E3%83%88%E3%82%A2%E3%83%89%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E5%86%85%E3%81%A7%E4%BD%BF%E3%81%86%E5%A4%89%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>2.2ストアドプロシージャ内で使う変数の定義</h3>

<p><code>DECLARE</code> で定義するだけです。JavaScriptの <code>var</code> やVBAの <code>Dim</code> だと思えば簡単！</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span>          <span class="k">DECLARE</span> <span class="err">$</span><span class="n">total</span> <span class="nb">INT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">-- 合計</span>
</pre></div></div>

<p><code>DECLARE</code> で定義した変数はローカルスコープになります。</p>

<p>ここまでの作業でこんなストアドプロシージャができます。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">PROCEDURE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">update_bbs_thread_post_totalupdate_bbs_thread_post_total</span><span class="p">;;</span>

<span class="k">DELIMITER</span> <span class="err">$$</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">IN</span> <span class="err">$</span><span class="n">id</span> <span class="nb">INT</span><span class="p">)</span>
     <span class="n">main</span><span class="p">:</span><span class="k">BEGIN</span>
          <span class="cm">/**</span>
<span class="cm">           * スレッドの投稿数を更新するプロシージャ</span>
<span class="cm">           * @param INT $id スレッドID</span>
<span class="cm">           */</span>

          <span class="c1">-- ローカル変数定義</span>
          <span class="k">DECLARE</span> <span class="err">$</span><span class="n">post_total</span> <span class="nb">INT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">-- 投稿件数</span>

     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>
<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div></div>

<h3>
<span id="23-変数への代入" class="fragment"></span><a href="#23-%E5%A4%89%E6%95%B0%E3%81%B8%E3%81%AE%E4%BB%A3%E5%85%A5"><i class="fa fa-link"></i></a>2.3 変数への代入</h3>

<p>変数（入れ物）ができたので、投稿テーブルから投稿数をカウントして代入する処理を書きます。<br>
カウントするクエリーはこんな感じですね。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span>          <span class="c1">-- 投稿件数をカウントする</span>
          <span class="k">SELECT</span>
               <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
               <span class="k">FROM</span> <span class="n">bbs_post</span>
               <span class="k">WHERE</span>
                    <span class="n">thread_id</span> <span class="o">=</span> <span class="mi">1</span>
          <span class="p">;</span>
</pre></div></div>

<p>これをちょっといじります。<br>
手始めに、<code>thread_id</code> はプロシージャの引数を使うようにします。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span>          <span class="c1">-- 投稿件数をカウントする</span>
          <span class="k">SELECT</span>
               <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
               <span class="k">FROM</span> <span class="n">bbs_post</span>
               <span class="k">WHERE</span>
                    <span class="n">thread_id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>
</pre></div></div>

<p>最後に、代入するように <code>INTO</code> 句を追加します。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span>          <span class="c1">-- 投稿件数をカウントする</span>
          <span class="k">SELECT</span>
               <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">INTO</span> <span class="err">$</span><span class="n">post_total</span>
               <span class="k">FROM</span> <span class="n">bbs_post</span>
               <span class="k">WHERE</span>
                    <span class="n">thread_id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>
</pre></div></div>

<p>これで代入されるようになります。</p>

<p>これを先程のプロシージャに組み込むとこのような感じになります。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">PROCEDURE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">update_bbs_thread_post_totalupdate_bbs_thread_post_total</span><span class="p">;;</span>

<span class="k">DELIMITER</span> <span class="err">$$</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">IN</span> <span class="err">$</span><span class="n">id</span> <span class="nb">INT</span><span class="p">)</span>
     <span class="n">main</span><span class="p">:</span><span class="k">BEGIN</span>
          <span class="cm">/**</span>
<span class="cm">           * スレッドの投稿数を更新するプロシージャ</span>
<span class="cm">           * @param INT $id スレッドID</span>
<span class="cm">           */</span>

          <span class="c1">-- ローカル変数定義</span>
          <span class="k">DECLARE</span> <span class="err">$</span><span class="n">post_total</span> <span class="nb">INT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">-- 投稿件数</span>

          <span class="c1">-- 投稿件数をカウントする</span>
          <span class="k">SELECT</span>
               <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">INTO</span> <span class="err">$</span><span class="n">post_total</span>
               <span class="k">FROM</span> <span class="n">bbs_post</span>
               <span class="k">WHERE</span>
                    <span class="n">thread_id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>

     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>
<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div></div>

<h3>
<span id="24-代入が上手く入ってるかダンプしてみよう" class="fragment"></span><a href="#24-%E4%BB%A3%E5%85%A5%E3%81%8C%E4%B8%8A%E6%89%8B%E3%81%8F%E5%85%A5%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%8B%E3%83%80%E3%83%B3%E3%83%97%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>2.4 代入が上手く入ってるかダンプしてみよう</h3>

<p>代入まで実装したので、正しく代入されているかダンプしてみます。<br>
ダンプは先ほど作った <code>dump()</code> プロシージャを使います。</p>

<p>下の2行を <code>END</code> の直前に追加します。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span>          <span class="c1">-- ダンプしてみる</span>
          <span class="k">call</span> <span class="n">dump</span><span class="p">(</span><span class="s1">'$post_total'</span><span class="p">,</span> <span class="err">$</span><span class="n">post_total</span><span class="p">);</span>
</pre></div></div>

<p>プロシージャ全体はこんな感じになります。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">PROCEDURE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">update_bbs_thread_post_total</span><span class="p">;</span>

<span class="k">DELIMITER</span> <span class="err">$$</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">IN</span> <span class="err">$</span><span class="n">id</span> <span class="nb">INT</span><span class="p">)</span>
     <span class="n">main</span><span class="p">:</span><span class="k">BEGIN</span>
          <span class="cm">/**</span>
<span class="cm">           * スレッドの投稿数を更新するプロシージャ</span>
<span class="cm">           * @param INT $id スレッドID</span>
<span class="cm">           */</span>

          <span class="c1">-- ローカル変数定義</span>
          <span class="k">DECLARE</span> <span class="err">$</span><span class="n">post_total</span> <span class="nb">INT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">-- 投稿件数</span>

          <span class="c1">-- 投稿件数をカウントする</span>
          <span class="k">SELECT</span>
               <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">INTO</span> <span class="err">$</span><span class="n">post_total</span>
               <span class="k">FROM</span> <span class="n">bbs_post</span>
               <span class="k">WHERE</span>
                    <span class="n">thread_id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>

          <span class="c1">-- ダンプしてみる</span>
          <span class="k">call</span> <span class="n">dump</span><span class="p">(</span><span class="s1">'$post_total'</span><span class="p">,</span> <span class="err">$</span><span class="n">post_total</span><span class="p">);</span>

     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>
<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div></div>

<p>では早速プロシージャを走らせてみます。<br>
プロシージャは <code>CALL</code> で呼び出します。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">CALL</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div></div>

<p>つぎに結果を確認します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>SELECT * FROM dump;
</pre></div></div>

<p><code>dump</code> テーブルに期待通りの出力が入っていれば成功です。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql&gt; SELECT * FROM dump;
+----+-------------+--------+---------------------+
| id | name        | value  | created             |
+----+-------------+--------+---------------------+
|  1 | hoge        | ほげ   | 2011-10-17 13:21:49 |
|  2 | $post_total | 3      | 2011-10-17 13:22:59 |
+----+-------------+--------+---------------------+
2 rows in set (0.00 sec)
</pre></div></div>

<p>ちなみに、</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">CALL</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dump</span><span class="p">;</span>
</pre></div></div>

<p>はセットで実行すると、すぐ結果が見れるので効率UPです。</p>

<h3>
<span id="25-更新してみる" class="fragment"></span><a href="#25-%E6%9B%B4%E6%96%B0%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>2.5 更新してみる</h3>

<p>下の <code>UPDATE</code> 文を追加します。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span>          <span class="c1">-- 投稿件数を反映する</span>
          <span class="k">UPDATE</span> <span class="n">bbs_thread</span>
               <span class="k">SET</span> <span class="n">post_total</span> <span class="o">=</span> <span class="err">$</span><span class="n">post_total</span>
               <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>
</pre></div></div>

<p>実行後すぐさま反映されているか確認するには、<code>dump</code> プロシージャの引数を <code>SELECT</code> 文にすればOKです。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span>          <span class="c1">-- 反映を確認</span>
          <span class="k">call</span> <span class="n">dump</span><span class="p">(</span><span class="s1">'bbs_thread.post_total'</span><span class="p">,</span>
               <span class="p">(</span><span class="k">SELECT</span> <span class="n">post_total</span> <span class="k">FROM</span> <span class="n">bbs_thread</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span><span class="p">)</span>
          <span class="p">);</span>
</pre></div></div>

<h3>
<span id="プロシージャの全体像と完成形" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B7%E3%83%BC%E3%82%B8%E3%83%A3%E3%81%AE%E5%85%A8%E4%BD%93%E5%83%8F%E3%81%A8%E5%AE%8C%E6%88%90%E5%BD%A2"><i class="fa fa-link"></i></a>プロシージャの全体像と完成形</h3>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">PROCEDURE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">update_bbs_thread_post_total</span><span class="p">;</span>

<span class="k">DELIMITER</span> <span class="err">$$</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">IN</span> <span class="err">$</span><span class="n">id</span> <span class="nb">INT</span><span class="p">)</span>
     <span class="n">main</span><span class="p">:</span><span class="k">BEGIN</span>
          <span class="cm">/**</span>
<span class="cm">           * スレッドの投稿数を更新するプロシージャ</span>
<span class="cm">           * @param INT $id スレッドID</span>
<span class="cm">           */</span>

          <span class="c1">-- ローカル変数定義</span>
          <span class="k">DECLARE</span> <span class="err">$</span><span class="n">post_total</span> <span class="nb">INT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">-- 投稿件数</span>

          <span class="c1">-- 投稿件数をカウントする</span>
          <span class="k">SELECT</span>
               <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">INTO</span> <span class="err">$</span><span class="n">post_total</span>
               <span class="k">FROM</span> <span class="n">bbs_post</span>
               <span class="k">WHERE</span>
                    <span class="n">thread_id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>

          <span class="c1">-- ダンプしてみる</span>
          <span class="k">call</span> <span class="n">dump</span><span class="p">(</span><span class="s1">'$post_total'</span><span class="p">,</span> <span class="err">$</span><span class="n">post_total</span><span class="p">);</span>

          <span class="c1">-- 投稿件数を反映する</span>
          <span class="k">UPDATE</span> <span class="n">bbs_thread</span>
               <span class="k">SET</span> <span class="n">post_total</span> <span class="o">=</span> <span class="err">$</span><span class="n">post_total</span>
               <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>

          <span class="c1">-- 反映を確認</span>
          <span class="k">call</span> <span class="n">dump</span><span class="p">(</span><span class="s1">'bbs_thread.post_total'</span><span class="p">,</span>
               <span class="p">(</span><span class="k">SELECT</span> <span class="n">post_total</span> <span class="k">FROM</span> <span class="n">bbs_thread</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span><span class="p">)</span>
          <span class="p">);</span>

     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>
<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div></div>

<p>これでひと通りの処理が実装されました。<br>
ためしに走らせてみよう。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">CALL</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dump</span><span class="p">;</span>
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>+----+-----------------------+--------+---------------------+
| id | name                  | value  | created             |
+----+-----------------------+--------+---------------------+
|  1 | hoge                  | ほげ   | 2011-10-17 13:21:49 |
|  2 | $post_total           | 3      | 2011-10-17 13:22:59 |
|  3 | $post_total           | 3      | 2011-10-17 13:24:49 |
|  4 | bbs_thread.post_total | 3      | 2011-10-17 13:24:49 |
+----+-----------------------+--------+---------------------+
4 rows in set (0.00 sec)
</pre></div></div>

<p>実装が済んだので、デバッグ用の <code>dump()</code> は用済みです。すべて消してしまいます。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">PROCEDURE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">update_bbs_thread_post_total</span><span class="p">;</span>

<span class="k">DELIMITER</span> <span class="err">$$</span>
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">IN</span> <span class="err">$</span><span class="n">id</span> <span class="nb">INT</span><span class="p">)</span>
     <span class="n">main</span><span class="p">:</span><span class="k">BEGIN</span>
          <span class="cm">/**</span>
<span class="cm">           * スレッドの投稿数を更新するプロシージャ</span>
<span class="cm">           * @param INT $id スレッドID</span>
<span class="cm">           */</span>

          <span class="c1">-- ローカル変数定義</span>
          <span class="k">DECLARE</span> <span class="err">$</span><span class="n">post_total</span> <span class="nb">INT</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">-- 投稿件数</span>

          <span class="c1">-- 投稿件数をカウントする</span>
          <span class="k">SELECT</span>
               <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">INTO</span> <span class="err">$</span><span class="n">post_total</span>
               <span class="k">FROM</span> <span class="n">bbs_post</span>
               <span class="k">WHERE</span>
                    <span class="n">thread_id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>

          <span class="c1">-- 投稿件数を反映する</span>
          <span class="k">UPDATE</span> <span class="n">bbs_thread</span>
               <span class="k">SET</span> <span class="n">post_total</span> <span class="o">=</span> <span class="err">$</span><span class="n">post_total</span>
               <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="err">$</span><span class="n">id</span>
          <span class="p">;</span>

     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>
<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div></div>

<h2>
<span id="3-トリガーの作成" class="fragment"></span><a href="#3-%E3%83%88%E3%83%AA%E3%82%AC%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>3. トリガーの作成</h2>

<p>次は、トリガーの作成になります。トリガーの実装はシンプルです。具体的な実装はストアドプロシージャでやっているので、トリガー部分ではそれを <code>CALL</code> するだけです。</p>

<p>今回の例では、次の3つのトリガーを作ります。</p>

<div class="code-frame" data-lang="sql"><div class="highlight"><pre><span></span><span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">tr_bbs_post_after_insert</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">tr_bbs_post_after_update</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">tr_bbs_post_after_delete</span><span class="p">;</span>

<span class="k">DELIMITER</span> <span class="err">$$</span>

<span class="c1">-- 投稿テーブルINSERT後</span>
<span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">tr_bbs_post_after_insert</span>
     <span class="k">AFTER</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="n">bbs_post</span> <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
     <span class="k">BEGIN</span>
          <span class="k">CALL</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">NEW</span><span class="p">.</span><span class="n">thread_id</span><span class="p">);</span>
     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>

<span class="c1">-- 投稿テーブルUPDATE後</span>
<span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">tr_bbs_post_after_update</span>
     <span class="k">AFTER</span> <span class="k">UPDATE</span> <span class="k">ON</span> <span class="n">bbs_post</span> <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
     <span class="k">BEGIN</span>
          <span class="k">CALL</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">OLD</span><span class="p">.</span><span class="n">thread_id</span><span class="p">);</span>
          <span class="k">CALL</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">NEW</span><span class="p">.</span><span class="n">thread_id</span><span class="p">);</span>
     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>

<span class="c1">-- 投稿テーブルDELETE後</span>
<span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">tr_bbs_post_after_delete</span>
     <span class="k">AFTER</span> <span class="k">DELETE</span> <span class="k">ON</span> <span class="n">bbs_post</span> <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
     <span class="k">BEGIN</span>
          <span class="k">CALL</span> <span class="n">update_bbs_thread_post_total</span><span class="p">(</span><span class="k">OLD</span><span class="p">.</span><span class="n">thread_id</span><span class="p">);</span>
     <span class="k">END</span><span class="p">;</span>
<span class="err">$$</span>

<span class="k">DELIMITER</span> <span class="p">;</span>
</pre></div></div>

<h2>
<span id="4-トリガーの単体テスト" class="fragment"></span><a href="#4-%E3%83%88%E3%83%AA%E3%82%AC%E3%83%BC%E3%81%AE%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>4. トリガーの単体テスト</h2>

<p>トリガーはアプリケーション全体において、下位レイヤーという位置づけになります。なので、トリガーがバグっているとそれだけで大惨事になります。トリガーがバグっていないことを保証するために、テストコードつきの単体テストをおすすめします。MySQLで単体テストを行うことは難儀なので、PHPUnitを使ってテストするといいでしょう。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>MySQLのトリガー便利です。しかし、トリガーの開発方法についての情報は少ない感じがあります。そこで、この記事では次の手順でトリガーを開発する方法を紹介しました。</p>

<ol>
<li>デバッグ環境の準備

<ol>
<li>ダンプテーブルの作成</li>
<li>ダンプ関数の作成</li>
</ol>
</li>
<li>ストアドプロシージャの作成</li>
<li>トリガーの作成</li>
<li>トリガーの単体テスト</li>
</ol>

<p>トリガーの単体テストでPHPUnitを紹介しましたが、PHPUnitを使った詳しい単体テストの手法は紹介できなかったので、いつか気が向いたら書こうとおもいます。</p>

<p>最後に、フィードバックなど歓迎します。もっといい方法、おすすめの方法があれば教えて下さい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>66</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/2814e91ed9c29c0f9287">空のディレクトリに.gitkeepを配置するコマンドラインツール </a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-04-04 18:18:28</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[Git]</b> <b>[Subversion]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>SubversionからGitに移行する過程で、空のディレクトリをリポジトリに追加するのを忘れないようにしないといけません。Gitは空のディレクトリはバージョン管理しないので、何らかのファイルを置く必要があります。何らかのファイルは<code>.gitignore</code>や<code>empty</code>などありますが、個人的にはRails風に<code>.gitkeep</code>を置くようにしています。</p>

<p>基本的には、<code>find . -type d -name .git -prune -o -type d -empty -exec touch {}/.gitkeep \;</code> を実行すればOKです。今回は作ったツールは、<code>.gitkeep</code>を配置する前にどのディレクトリが空っぽか確認する機能や、このコマンドの<code>.gitkeep</code>部分を指定できたりなど、オプショナルな機能を追加したものです。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>空っぽのディレクトリ一覧を出す:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cd git-repo
git-empty-dir list
</pre></div></div>

<p>空っぽのディレクトリに<code>.gitkeep</code>を配置する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cd git-repo
git-empty-dir keep
</pre></div></div>

<p>他にも<code>--dir</code>や<code>--keeper</code>などのオプションがあります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git-empty-dir keep --help
usage: git-empty-dir keep [-h] [--dir DIR] [--keeper KEEPER]

optional arguments:
  -h, --help       show this help message and exit
  --dir DIR        path to git directory
  --keeper KEEPER  dummy file name. Default is ".gitkeep"
</pre></div></div>

<h2>
<span id="git-empry-dirpy" class="fragment"></span><a href="#git-empry-dirpy"><i class="fa fa-link"></i></a>git-empry-dir.py</h2>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">git-empry-dir.py</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">commands</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">"find </span><span class="si">%(dir)s</span><span class="s2"> -type d -name .git -prune -o -type d -empty"</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="s2">"find </span><span class="si">%(dir)s</span><span class="s2"> -type d -name .git -prune -o -type d -empty -exec touch {}/</span><span class="si">%(keeper)s</span><span class="s2"> \;"</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">check_git_dir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
    <span class="n">git_dir</span> <span class="o">=</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s1">'/.git'</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">git_dir</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">git_dir</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">'Not found .git in '</span> <span class="o">+</span> <span class="nb">dir</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Add .gitkeep to empty directories.'</span><span class="p">)</span>

    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'commands'</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">'command'</span><span class="p">)</span>

    <span class="n">parser_list</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">'list'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'list candidates'</span><span class="p">)</span>
    <span class="n">parser_list</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">parser_list</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--dir'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'path to git directory'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

    <span class="n">parser_keep</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s1">'keep'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
    <span class="n">parser_keep</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">keep</span><span class="p">)</span>
    <span class="n">parser_keep</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--dir'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'path to git directory'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="n">parser_keep</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'--keeper'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">'dummy file name. Default is ".gitkeep"'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'.gitkeep'</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">args</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>

    <span class="n">check_git_dir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dir</span><span class="p">)</span>

    <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>

<p>Pythonの <code>argparse</code> って便利ですね！</p>

<p>[2012-04-05 11:55] .git がないところでうっかり keep してしまって悲惨なことになったので、.gitがあるかをチェックするようにした</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>65</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/b3619ddaa176fef519cb">コミットメッセージの作法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-04-30 22:57:43</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[Subversion]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://github.com/gitster/git/blob/master/Documentation/SubmittingPatches" rel="nofollow noopener" target="_blank">git</a>プロジェクトのガイドラインを参考にまとめました。この作法は英語で書くことが前提となっています。</p>

<h1>
<span id="1-コミットメッセージの1行目は短い説明文50文字以内" class="fragment"></span><a href="#1-%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE1%E8%A1%8C%E7%9B%AE%E3%81%AF%E7%9F%AD%E3%81%84%E8%AA%AC%E6%98%8E%E6%96%8750%E6%96%87%E5%AD%97%E4%BB%A5%E5%86%85"><i class="fa fa-link"></i></a>1. コミットメッセージの1行目は短い説明文(50文字以内)</h1>

<ul>
<li>モジュールについての修正の場合、<code>モジュール名:</code> ではじめる</li>
<li>説明文は小文字ではじめる</li>
<li>説明文のピリオド(句点)を省く</li>
</ul>

<h1>
<span id="2-2行目は空行にする" class="fragment"></span><a href="#2-2%E8%A1%8C%E7%9B%AE%E3%81%AF%E7%A9%BA%E8%A1%8C%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2. 2行目は空行にする</h1>

<p>そうすることで、例えばコミットした内容を E-Mail に変更するツールにて、 Subjectに最初の行を使用し、残りの行を本文にすることができる。</p>

<h1>
<span id="3-本文には意味ある内容を含める" class="fragment"></span><a href="#3-%E6%9C%AC%E6%96%87%E3%81%AB%E3%81%AF%E6%84%8F%E5%91%B3%E3%81%82%E3%82%8B%E5%86%85%E5%AE%B9%E3%82%92%E5%90%AB%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>3. 本文には意味ある内容を含める</h1>

<ul>
<li>問題点: 修正した問題点について説明する</li>
<li>妥当性: 行った修正について、「なぜその方法がより良いのか」を説明する</li>
<li>代替案: もし、他の修正方法を検討したのなら、それらについて説明する</li>
</ul>

<h1>
<span id="4-変更は命令形で表現する" class="fragment"></span><a href="#4-%E5%A4%89%E6%9B%B4%E3%81%AF%E5%91%BD%E4%BB%A4%E5%BD%A2%E3%81%A7%E8%A1%A8%E7%8F%BE%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>4. 変更は命令形で表現する</h1>

<p>まるであなたがコードベースに変更を命令じているかのように書く。</p>

<ul>
<li>[bad] "<strong>This patch</strong> makes xyzzy do frotz"</li>
<li>[bad] "<strong>I</strong> changed xyzzy to do frotz"</li>
<li>[ok] "make xyzzy do frotz"</li>
</ul>

<h1>
<span id="5-書いた内容が他の資料なしに理解できるものか確認する" class="fragment"></span><a href="#5-%E6%9B%B8%E3%81%84%E3%81%9F%E5%86%85%E5%AE%B9%E3%81%8C%E4%BB%96%E3%81%AE%E8%B3%87%E6%96%99%E3%81%AA%E3%81%97%E3%81%AB%E7%90%86%E8%A7%A3%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%82%E3%81%AE%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5. 書いた内容が他の資料なしに理解できるものか確認する</h1>

<p>メーリングリストのURLを指し示す代わりに、関連する点について要約する。</p>

<h1>
<span id="コミットメッセージの形式" class="fragment"></span><a href="#%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E5%BD%A2%E5%BC%8F"><i class="fa fa-link"></i></a>コミットメッセージの形式</h1>

<blockquote>
<p>モジュール名: 簡潔な説明文</p>

<p>どのような問題があり、どのような修正を行ったか...<br>
その修正はなぜ他の方法より良いか...<br>
他に検討した修正方法はどんなものか...(あれば)</p>
</blockquote>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>64</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/d952fb963956ac31b243">Go言語でPHPのvar_dumpやJavaScriptのconsole.log的なもの</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-11 21:53:59</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>デバッグするとき値の中身を見たいもの。Go言語にもPHPの <code>var_dump</code> やJavaScriptの <code>console.log</code> のように、値の中身をプリントすることができる関数がある。</p>

<table>
<thead>
<tr>
<th>関数</th>
<th>意味</th>
<th>例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fmt.Printf("%v", value)</code></td>
<td>デフォルトフォーマットを適用した値</td>
<td><code>&amp;{bar baz}</code></td>
</tr>
<tr>
<td><code>fmt.Printf("%+v", value)</code></td>
<td>デフォルトフォーマットを適用した値で、構造体のときフィールド名が出る</td>
<td><code>&amp;{Bar:bar Baz:baz}</code></td>
</tr>
<tr>
<td><code>fmt.Printf("%#v", value)</code></td>
<td>Go言語の構文で表現した値</td>
<td><code>&amp;main.Foo{Bar:"bar", Baz:"baz"}</code></td>
</tr>
<tr>
<td><code>fmt.Printf("%T", value)</code></td>
<td>Go言語の構文で表現した型</td>
<td><code>*main.Foo</code></td>
</tr>
</tbody>
</table>

<p>ちなみに、<code>fmt</code> ではなく <code>log</code> パッケージの <code>Printf</code> もある。違いは以下:</p>

<table>
<thead>
<tr>
<th>関数</th>
<th>パッケージ</th>
<th>日付が</th>
<th>最後が</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fmt.Printf</code></td>
<td>import "fmt"</td>
<td>出ない</td>
<td>改行されない</td>
</tr>
<tr>
<td><code>log.Printf</code></td>
<td>import "log"</td>
<td>出る</td>
<td>改行される</td>
</tr>
</tbody>
</table>

<h1>
<span id="使い方の例" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9%E3%81%AE%E4%BE%8B"><i class="fa fa-link"></i></a>使い方の例</h1>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Foo</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Bar</span> <span class="kt">string</span>
    <span class="nx">Baz</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">foo</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Foo</span><span class="p">{</span><span class="s">"bar"</span><span class="p">,</span> <span class="s">"baz"</span><span class="p">}</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%v"</span><span class="p">,</span> <span class="nx">foo</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%+v"</span><span class="p">,</span> <span class="nx">foo</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%#v"</span><span class="p">,</span> <span class="nx">foo</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%T"</span><span class="p">,</span> <span class="nx">foo</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
</div>

<p>出力結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>2013/12/11 21:52:10 &amp;{bar baz}
2013/12/11 21:52:10 &amp;{Bar:bar Baz:baz}
2013/12/11 21:52:10 &amp;main.Foo{Bar:"bar", Baz:"baz"}
2013/12/11 21:52:10 *main.Foo
</pre></div></div>

<h1>
<span id="var_dump-っぽく実装してみた" class="fragment"></span><a href="#var_dump-%E3%81%A3%E3%81%BD%E3%81%8F%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F"><i class="fa fa-link"></i></a>var_dump っぽく実装してみた</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>package main

import (
    "fmt"
)

type Foo struct {
    Bar string
    Baz string
}

func main() {
    foo := &amp;Foo{"bar", "baz"}
    var_dump(1, true, nil, "string", foo)
}

func var_dump(v ...interface{}) {
    for _, vv := range(v) {
        fmt.Printf("%#v\n", vv)
    }
}
</pre></div></div>

<p>出力結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>1
true
&lt;nil&gt;
"string"
&amp;main.Foo{Bar:"bar", Baz:"baz"}
</pre></div></div>

<h1>
<span id="update-20131212-spew" class="fragment"></span><a href="#update-20131212-spew"><i class="fa fa-link"></i></a>UPDATE 2013/12/12 spew</h1>

<p><a href="https://github.com/davecgh/go-spew/" rel="nofollow noopener" target="_blank">github.com/davecgh/go-spew/spew</a>を使うと改行もしてくれて見やすい</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"github.com/davecgh/go-spew/spew"</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Name</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">FirstName</span> <span class="kt">string</span>
    <span class="nx">LastName</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Address</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Country</span> <span class="kt">string</span>
    <span class="nx">PostalCode</span> <span class="kt">string</span>
    <span class="nx">Address</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Person</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="nx">Name</span>
    <span class="nx">Address</span> <span class="nx">Address</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">person</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span>
        <span class="nx">Name</span><span class="p">{</span><span class="s">"Cynthia"</span><span class="p">,</span> <span class="s">"Stone"</span><span class="p">},</span>
        <span class="nx">Address</span><span class="p">{</span><span class="s">"us"</span><span class="p">,</span> <span class="s">"02110"</span><span class="p">,</span> <span class="s">"1091 Lyon Avenue, Boston"</span><span class="p">},</span>
    <span class="p">}</span>
    <span class="nx">spew</span><span class="p">.</span><span class="nx">Dump</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="c1">// ここ!</span>
<span class="p">}</span>
</pre></div>
</div>

<p>出力結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>(*main.Person)(0x2102bd230)({
 Name: (main.Name) {
  FirstName: (string) "Cynthia",
  LastName: (string) "Stone"
 },
 Address: (main.Address) {
  Country: (string) "us",
  PostalCode: (string) "02110",
  Address: (string) "1091 Lyon Avenue, Boston"
 }
})
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />22位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>61</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/7225ab9f2aeb6f55c606">Go言語: いろいろなマップの作り方まとめ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-14 16:43:36</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="空っぽのマップを作る" class="fragment"></span><a href="#%E7%A9%BA%E3%81%A3%E3%81%BD%E3%81%AE%E3%83%9E%E3%83%83%E3%83%97%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>空っぽのマップを作る</h1>

<h2>
<span id="パターン1-var-variable-map-key_type--value_type--map-key_type--valutetype_" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B31-var-variable-map-key_type--value_type--map-key_type--valutetype_"><i class="fa fa-link"></i></a>パターン1: var <em>variable</em> map[ <em>key_type</em> ] <em>value_type</em> = map[ <em>key_type</em> ] <em>valute</em>type_</h2>

<p>長い書き方。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">languages</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>
</pre></div></div>

<p>実行結果</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nb">string</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
</pre></div></div>

<h2>
<span id="パターン2-variable--makemap-key_type--value_type-" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B32-variable--makemap-key_type--value_type-"><i class="fa fa-link"></i></a>パターン2: <em>variable</em> := make(map[ <em>key_type</em> ] <em>value_type</em> )</h2>

<p><code>make</code> を使った書き方。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="nx">languages</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
</pre></div></div>

<p>実行結果</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>
</pre></div></div>

<p>予め指定した要素数分のメモリを確保することもできる。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="c1">// 要素42個分の領域を予め確保</span>
<span class="nx">languages</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</pre></div></div>

<h2>
<span id="パターン3-variable--map-key_type--value_type-" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B33-variable--map-key_type--value_type-"><i class="fa fa-link"></i></a>パターン3: <em>variable</em> := map[ <em>key_type</em> ] <em>value_type</em> {}</h2>

<p>短い書き方。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="nx">languages</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>
</pre></div></div>

<p>実行結果</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>
</pre></div></div>

<h1>
<span id="要素が入ったマップを作る" class="fragment"></span><a href="#%E8%A6%81%E7%B4%A0%E3%81%8C%E5%85%A5%E3%81%A3%E3%81%9F%E3%83%9E%E3%83%83%E3%83%97%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>要素が入ったマップを作る</h1>

<h2>
<span id="パターン1" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B31"><i class="fa fa-link"></i></a>パターン1</h2>

<p>長い書き方。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">languages</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">"go"</span><span class="p">:</span><span class="s">"golang"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">:</span><span class="s">"ruby"</span><span class="p">,</span> <span class="s">"js"</span><span class="p">:</span><span class="s">"javascript"</span><span class="p">}</span>
</pre></div></div>

<p>実行結果</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">"go"</span><span class="p">:</span><span class="s">"golang"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">:</span><span class="s">"ruby"</span><span class="p">,</span> <span class="s">"js"</span><span class="p">:</span><span class="s">"javascript"</span><span class="p">}</span>
</pre></div></div>

<h2>
<span id="パターン2" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B32"><i class="fa fa-link"></i></a>パターン2</h2>

<p>短い書き方。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="nx">languages</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">"go"</span><span class="p">:</span><span class="s">"golang"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">:</span><span class="s">"ruby"</span><span class="p">,</span> <span class="s">"js"</span><span class="p">:</span><span class="s">"javascript"</span><span class="p">}</span>
</pre></div></div>

<p>実行結果</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span><span class="s">"go"</span><span class="p">:</span><span class="s">"golang"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">:</span><span class="s">"ruby"</span><span class="p">,</span> <span class="s">"js"</span><span class="p">:</span><span class="s">"javascript"</span><span class="p">}</span>
</pre></div></div>

<h2>
<span id="パターン3" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B33"><i class="fa fa-link"></i></a>パターン3</h2>

<p>各要素を改行する場合は、1要素ごとに カンマ<code>,</code>をつけないとパースエラーになるので注意。 </p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="nx">languages</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
    <span class="s">"go"</span><span class="p">:</span><span class="s">"golang"</span><span class="p">,</span> 
    <span class="s">"rb"</span><span class="p">:</span><span class="s">"ruby"</span><span class="p">,</span> 
    <span class="s">"js"</span><span class="p">:</span><span class="s">"javascript"</span><span class="p">,</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="パターン4" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B34"><i class="fa fa-link"></i></a>パターン4</h2>

<p><code>make</code> で作った時はキーを指定して代入する。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="nx">languages</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="nx">languages</span><span class="p">[</span><span class="s">"go"</span><span class="p">]</span> <span class="p">=</span> <span class="s">"golang"</span>
<span class="nx">languages</span><span class="p">[</span><span class="s">"rb"</span><span class="p">]</span> <span class="p">=</span> <span class="s">"ruby"</span>
<span class="nx">languages</span><span class="p">[</span><span class="s">"js"</span><span class="p">]</span> <span class="p">=</span> <span class="s">"javascript"</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />23位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>60</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/835ac0f58e6d3bbb6280">改行テキストを配列に変換する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2011-12-20 14:10:50</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="nv">$text</span> <span class="o">=</span> <span class="s1">'a</span>
<span class="s1">b</span>
<span class="s1">c</span>

<span class="s1">d</span>

<span class="s1">f</span>
<span class="s1">'</span><span class="p">;</span>
</pre></div></div>

<p>といった空白行まじりの改行テキストを次の処理にかけると</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="nv">$array</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span> <span class="c1">// とりあえず行に分割</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s1">'trim'</span><span class="p">,</span> <span class="nv">$array</span><span class="p">);</span> <span class="c1">// 各行にtrim()をかける</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="s1">'strlen'</span><span class="p">);</span> <span class="c1">// 文字数が0の行を取り除く</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="c1">// これはキーを連番に振りなおしてるだけ</span>
</pre></div></div>

<p>空白行を取り除いたキレイな配列になる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>array(5) {
  [0]=&gt;
  string(1) "a"
  [1]=&gt;
  string(1) "b"
  [2]=&gt;
  string(1) "c"
  [3]=&gt;
  string(1) "d"
  [4]=&gt;
  string(1) "f"
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />24位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>59</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/afaac37a2d83f8d366df">私のプロジェクトで取り入れた最強の問題解決フレームワーク『すごい会議』</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-28 15:19:07</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[すごい会議]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/15e5af213e089471f3554c0b14fba0d750e293e0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64626336656532612d393462372d383934342d656561662d6634376363653265396165332e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/15e5af213e089471f3554c0b14fba0d750e293e0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64626336656532612d393462372d383934342d656561662d6634376363653265396165332e6a706567" alt="IMG_1608.jpg" title="IMG_1608.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/dbc6ee2a-94b7-8944-eeaf-f47cce2e9ae3.jpeg"></a></p>

<h1>
<span id="伝統的な問題解決" class="fragment"></span><a href="#%E4%BC%9D%E7%B5%B1%E7%9A%84%E3%81%AA%E5%95%8F%E9%A1%8C%E8%A7%A3%E6%B1%BA"><i class="fa fa-link"></i></a>伝統的な問題解決</h1>

<ol>
<li>問題点を挙げる</li>
<li>原因について議論する</li>
<li>原因を取り除く対策を議論する</li>
<li>対策を実施する</li>
</ol>

<h2>
<span id="伝統的な問題解決の欠点-原因を特定しようとする" class="fragment"></span><a href="#%E4%BC%9D%E7%B5%B1%E7%9A%84%E3%81%AA%E5%95%8F%E9%A1%8C%E8%A7%A3%E6%B1%BA%E3%81%AE%E6%AC%A0%E7%82%B9-%E5%8E%9F%E5%9B%A0%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%97%E3%82%88%E3%81%86%E3%81%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>伝統的な問題解決の欠点: 原因を特定しようとする</h2>

<ol>
<li>因果関係の証明には時間と労力がかかる: 現実世界は因子(パラメータ)が多すぎる　→　非現実的</li>
<li>間違った原因に対策を講じてしまう危険性がある　→　努力が無駄になる</li>
<li>原因を特定できてもコントロールできるとは限らない</li>
</ol>

<h1>
<span id="すごい会議" class="fragment"></span><a href="#%E3%81%99%E3%81%94%E3%81%84%E4%BC%9A%E8%AD%B0"><i class="fa fa-link"></i></a>すごい会議</h1>

<div>
<a href="https://camo.qiitausercontent.com/d6e663b1b138f12bade39286fe0345a3e2d0c99a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33613935616531382d646234622d393238362d386465642d3266616137303734306231642e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d6e663b1b138f12bade39286fe0345a3e2d0c99a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33613935616531382d646234622d393238362d386465642d3266616137303734306231642e6a706567" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/3a95ae18-db4b-9286-8ded-2faa70740b1d.jpeg"></a><br>
<a href="http://sugoikaigi.jp/" rel="nofollow noopener" target="_blank">http://sugoikaigi.jp/</a>
</div>

<h2>
<span id="特徴" class="fragment"></span><a href="#%E7%89%B9%E5%BE%B4"><i class="fa fa-link"></i></a>特徴</h2>

<ul>
<li>すべて紙に書いて表現する</li>
<li>全員でひとつの方向性を共有する</li>
<li>「ひどい事実」「言えない事実」と正面から向き合う</li>
<li>会議終了後に全員が自信を持って退出できる</li>
<li>チームのコミュニケーションツールになる</li>
<li>冷静・提案ベース・システマティックな会議！</li>
<li>最短ステップで必ず解決策にたどり着く！！</li>
</ul>

<h2>
<span id="進め方-所要時間1525分程度" class="fragment"></span><a href="#%E9%80%B2%E3%82%81%E6%96%B9-%E6%89%80%E8%A6%81%E6%99%82%E9%96%931525%E5%88%86%E7%A8%8B%E5%BA%A6"><i class="fa fa-link"></i></a>進め方 (所要時間:15~25分程度)</h2>

<ol>
<li>問題を挙げる (1分程度)</li>
<li>理想に言い換える (1分程度)</li>
<li>事実を集める (5~10分程度)</li>
<li>解決アイディアをブレスト (5~10分程度)</li>
<li>解決策を選定 (5分程度)</li>
<li>解決策の実施</li>
</ol>

<h3>
<span id="1問題を挙げる" class="fragment"></span><a href="#1%E5%95%8F%E9%A1%8C%E3%82%92%E6%8C%99%E3%81%92%E3%82%8B"><i class="fa fa-link"></i></a>1.問題を挙げる</h3>

<ul>
<li>手元のポストイットに各自書き出す。1問題ごとに1枚。</li>
<li>全員が見えるように張り出して発表する。</li>
<li>この会議で解決する問題を選ぶ。選び方: 優先度をつける。</li>
</ul>

<h3>
<span id="2理想に言い換える" class="fragment"></span><a href="#2%E7%90%86%E6%83%B3%E3%81%AB%E8%A8%80%E3%81%84%E6%8F%9B%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>2.理想に言い換える</h3>

<ul>
<li>問題を「どのようにすれば_____になるか？」に言い換える。イーゼルパッドの一番上に書く。<br><code>問題</code> = <code>理想</code> - <code>現実</code>。<br>人によって理想が異なる。課題を理想に言い換えることで、会議の方向性を合わせる。</li>
</ul>

<blockquote>
<p>例: <br>
「SaaSの利益が少ない」→「どのようにすればSaaSの収益が増えるか?」<br>
「SaaSが利益が少ない」→「どのようにすればSaaS開発のムダを削減できるか?」<br>
「SaaSが利益が少ない」→「どのようにすれば新規ユーザにリーチできるか?」</p>
</blockquote>

<ul>
<li>さらに「〜なくてもいいようになるか」など否定系は肯定系に言い換える。</li>
<li>さらに、誇りに訴えかけるようなよりパワフルな表現に言い換える。<br>まるまる言い換えたり「世界一」「すごい」「驚くほど」などの副詞を使う。</li>
</ul>

<blockquote>
<p>例: 「どのようにすればのユーザが喜びにあふれ、SaaSの収益が増えるか?」</p>
</blockquote>

<h3>
<span id="3事実を集める" class="fragment"></span><a href="#3%E4%BA%8B%E5%AE%9F%E3%82%92%E9%9B%86%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>3.事実を集める</h3>

<ul>
<li>みんなで手元のポストイットに事実を書き出す。1事実ごとに1枚。</li>
<li>イーゼルパッド上半分に張り出して発表する。</li>
</ul>

<p>多い程よい<br>
普段は言えない事実・ひどい事実 = 価値が高い</p>

<p>事実=客観的なこと、定量的なこと</p>

<blockquote>
<p>例:「未着手が半分<strong>しか</strong>ない」→「未着手が半分ある」<br>
例:「残業が多い」→「先月と<strong>比べて</strong>残業が多い」</p>
</blockquote>

<p><strong>自分が感じていること</strong>も事実のひとつ: 「〜と感じている」をつける</p>

<blockquote>
<p>例:「ガラケーのほうが使いやすい」→「ガラケーのほうが使いやすいと感じている」</p>
</blockquote>

<p>感じていることは<strong>具体的な体験</strong>に言い換えると表現しやすい</p>

<blockquote>
<p>例:「ガラケーのほうが使いやすい」→「スマホの画面を間違ってタッチして大事なデータを消してしまった」</p>
</blockquote>

<p><strong>主張</strong>は客観化する: 「私が言うには〜」をつける: ニュアンスが変わり反発が起きにくくなる</p>

<blockquote>
<p>例:「○○さんのコードがキレイ」→「私が言うには、○○さんのコードがキレイ」</p>
</blockquote>

<p>「〜ので」「〜から」「〜せいで」「〜のに」のような接続詞は不可: 2つの事実に分ける</p>

<blockquote>
<p>例:「開発期間が1ヶ月だった<strong>ので</strong>納期に遅れた」→「開発期間が1ヶ月だった」「納期に遅れた」</p>
</blockquote>

<h3>
<span id="4解決アイディアをブレスト" class="fragment"></span><a href="#4%E8%A7%A3%E6%B1%BA%E3%82%A2%E3%82%A4%E3%83%87%E3%82%A3%E3%82%A2%E3%82%92%E3%83%96%E3%83%AC%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>4.解決アイディアをブレスト</h3>

<ul>
<li>みんなで手元のポストイットに解決アイディアを書き出す。1アイディアごとに1枚。</li>
<li>イーゼルパッド下半分に張り出して発表する。</li>
<li>多い場合はカテゴリ分けする。</li>
</ul>

<p>事実を参考にして良い。<br>
馬鹿げたアイディア、遊びのあるアイディア、くだらないアイディア、できそうもないアイディアも考えてみる　→　思考の枠が広がる。</p>

<blockquote>
<p>例: ラリー・ペイジにレビューしてもらう</p>
</blockquote>

<p><em>注意: この段階ではアイディアへの評価はしない。</em></p>

<h3>
<span id="5解決策を選定" class="fragment"></span><a href="#5%E8%A7%A3%E6%B1%BA%E7%AD%96%E3%82%92%E9%81%B8%E5%AE%9A"><i class="fa fa-link"></i></a>5.解決策を選定</h3>

<ul>
<li>解決アイディアの中から、実施するものを選定する。</li>
</ul>

<p><em>ヒント: 「今直ぐできるか」よりも「最も効果的か」で選ぶと良い</em></p>

<h3>
<span id="6解決策の実施" class="fragment"></span><a href="#6%E8%A7%A3%E6%B1%BA%E7%AD%96%E3%81%AE%E5%AE%9F%E6%96%BD"><i class="fa fa-link"></i></a>6.解決策の実施</h3>

<ul>
<li>だれが、いつまでに、なにをやるかを決める</li>
</ul>

<h2>
<span id="ルール" class="fragment"></span><a href="#%E3%83%AB%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ルール</h2>

<h3>
<span id="発言してもいいのは2種類" class="fragment"></span><a href="#%E7%99%BA%E8%A8%80%E3%81%97%E3%81%A6%E3%82%82%E3%81%84%E3%81%84%E3%81%AE%E3%81%AF2%E7%A8%AE%E9%A1%9E"><i class="fa fa-link"></i></a>発言してもいいのは2種類</h3>

<ol>
<li>建設的な提案: 「提案ですが、〜しませんか?」</li>
<li>明確化のための質問: 「明確化のための質問ですが、〜ですか?」</li>
</ol>

<h3>
<span id="この場で発言してはいけないコト" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E5%A0%B4%E3%81%A7%E7%99%BA%E8%A8%80%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84%E3%82%B3%E3%83%88"><i class="fa fa-link"></i></a>この場で発言してはいけないコト</h3>

<p>演説、コメント、ダメだし、脱線　→ 提案として発言する<br>
「無理」→「難しい」</p>

<h2>
<span id="必要なもの" class="fragment"></span><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>必要なもの</h2>

<table>
<thead>
<tr>
<th>強粘着<a href="http://www.amazon.co.jp/gp/product/B001F7DMFW?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=B001F7DMFW&amp;linkCode=shr&amp;tag=suinyeze-22" rel="nofollow noopener" target="_blank">ポストイット</a>  人数*冊</th>
<th><a href="https://camo.qiitausercontent.com/1c107a50a47144a2572162b5a5016754c7359394/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36343366306264302d313939342d653232362d643939312d3666356237353434356166352e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1c107a50a47144a2572162b5a5016754c7359394/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36343366306264302d313939342d653232362d643939312d3666356237353434356166352e6a706567" alt="ポストイット画像" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/643f0bd0-1994-e226-d991-6f5b75445af5.jpeg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="http://www.amazon.co.jp/gp/product/B000TI1HK0?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=B000TI1HK0&amp;linkCode=shr&amp;tag=suinyeze-22" rel="nofollow noopener" target="_blank">プロッキー</a> 黒 人数分</td>
<td><a href="https://camo.qiitausercontent.com/e992698df96c00ab1ec55823b417145e037333bf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36393436393233332d343536392d356464372d623631302d6238326161633432336364382e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e992698df96c00ab1ec55823b417145e037333bf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36393436393233332d343536392d356464372d623631302d6238326161633432336364382e6a706567" alt="プロッキー画像" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/69469233-4569-5dd7-b610-b82aac423cd8.jpeg"></a></td>
</tr>
<tr>
<td>
<a href="http://www.amazon.co.jp/gp/product/B001GXF7VC?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=B001GXF7VC&amp;linkCode=shr&amp;tag=suinyeze-22" rel="nofollow noopener" target="_blank">イーゼルパッド</a> 1冊</td>
<td><a href="https://camo.qiitausercontent.com/5509223fca103e31b40eac13292e84bd9190ce03/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61663237613536332d306466342d333665312d343233392d3963386532336637636634392e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5509223fca103e31b40eac13292e84bd9190ce03/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61663237613536332d306466342d333665312d343233392d3963386532336637636634392e6a706567" alt="イーゼルパッド画像" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/af27a563-0df4-36e1-4239-9c8e23f7cf49.jpeg"></a></td>
</tr>
</tbody>
</table>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />25位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>59</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/c2f7a50c9c0c05504acb">【まとめ】あのオープンソースの名前の由来、そういう意味だったのか！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-09 04:29:54</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[PHP]</b> <b>[Linux]</b> <b>[Git]</b> <b>[MySQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="mysql-娘の名前" class="fragment"></span><a href="#mysql-%E5%A8%98%E3%81%AE%E5%90%8D%E5%89%8D"><i class="fa fa-link"></i></a>MySQL: 娘の名前?</h1>

<p><a href="https://camo.qiitausercontent.com/6cb31ecefe6e3bbaaa030e7252902305bcd2df29/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6d7973716c2e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6cb31ecefe6e3bbaaa030e7252902305bcd2df29/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6d7973716c2e6a7067" alt="mysql" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/mysql.jpg"></a></p>

<p>必ずしもWidenius氏の娘の名前に由来したというわけではなさそうだが、氏がMySQLのブランチとして開発したMariaDBのMariaは末娘の名前。</p>

<blockquote>
<p>MySQL という名前の由来は明らかではありません。当社の基本ディレクトリおよび多数のライブラリやツールには、10 年以上にわたって ``my'' というプリフィックスが使われています。また、共同創設者 Monty Widenius の娘の名前も My です。そのため、このうちのどちらが MySQL の名前の由来となったのかは、私たちにとってもいまだに謎なのです。<br>
<a href="http://dev.mysql.com/doc/refman/4.1/ja/history.html" class="autolink" rel="nofollow noopener" target="_blank">http://dev.mysql.com/doc/refman/4.1/ja/history.html</a></p>
</blockquote>

<h1>
<span id="debian-創始者と妻の名前" class="fragment"></span><a href="#debian-%E5%89%B5%E5%A7%8B%E8%80%85%E3%81%A8%E5%A6%BB%E3%81%AE%E5%90%8D%E5%89%8D"><i class="fa fa-link"></i></a>Debian: 創始者と妻の名前</h1>

<p><a href="https://camo.qiitausercontent.com/36e22008cdc331145cd4af2d3d787ae63b132cb1/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f64656269616e2e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/36e22008cdc331145cd4af2d3d787ae63b132cb1/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f64656269616e2e6a7067" alt="debian" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/debian.jpg"></a></p>

<p>まさに子供みたい大事なものということなんだろうか。</p>

<blockquote>
<p>創始者 Ian Murdock と彼の妻 Debra の名前に由来しています。<br>
<a href="http://www.debian.org/intro/about.ja.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.debian.org/intro/about.ja.html</a></p>
</blockquote>

<h1>
<span id="lucene-妻のミドルネーム" class="fragment"></span><a href="#lucene-%E5%A6%BB%E3%81%AE%E3%83%9F%E3%83%89%E3%83%AB%E3%83%8D%E3%83%BC%E3%83%A0"><i class="fa fa-link"></i></a>Lucene: 妻のミドルネーム</h1>

<p>またもや、ファミリー系。</p>

<blockquote>
<p>Where does the name Lucene come from?</p>

<p>Lucene is Doug Cutting's wife's middle name, and her maternal grandmother's first name.<br>
<a href="http://wiki.apache.org/jakarta-lucene/LuceneFAQ" class="autolink" rel="nofollow noopener" target="_blank">http://wiki.apache.org/jakarta-lucene/LuceneFAQ</a></p>
</blockquote>

<h1>
<span id="php-再帰的な略語" class="fragment"></span><a href="#php-%E5%86%8D%E5%B8%B0%E7%9A%84%E3%81%AA%E7%95%A5%E8%AA%9E"><i class="fa fa-link"></i></a>PHP: 再帰的な略語</h1>

<p><a href="https://camo.qiitausercontent.com/5abd527e035aaa543843ec42894e77bd391ae560/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f7068702e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5abd527e035aaa543843ec42894e77bd391ae560/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f7068702e6a7067" alt="php" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/php.jpg"></a></p>

<p>無限ループ…。</p>

<blockquote>
<p>PHP (PHP: Hypertext Preprocessor を再帰的に略したものです) <br>
<a href="http://php.net/manual/ja/intro-whatis.php" class="autolink" rel="nofollow noopener" target="_blank">http://php.net/manual/ja/intro-whatis.php</a></p>
</blockquote>

<h1>
<span id="nagios-再帰的な略語" class="fragment"></span><a href="#nagios-%E5%86%8D%E5%B8%B0%E7%9A%84%E3%81%AA%E7%95%A5%E8%AA%9E"><i class="fa fa-link"></i></a>Nagios: 再帰的な略語</h1>

<p>無限ループ…。</p>

<blockquote>
<p>N.A.G.I.O.S. は再帰的頭字語であり、"Nagios Ain't Gonna Insist On Sainthood"（Nagios は聖人の地位に固執しない）の略であるという。<br>
<a href="http://ja.wikipedia.org/wiki/Nagios" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/Nagios</a></p>
</blockquote>

<h1>
<span id="mongodb-ばかでかい" class="fragment"></span><a href="#mongodb-%E3%81%B0%E3%81%8B%E3%81%A7%E3%81%8B%E3%81%84"><i class="fa fa-link"></i></a>MongoDB: ばかでかい</h1>

<p><a href="https://camo.qiitausercontent.com/06e1fb839dffdc472a074e1567055dc62cdccc86/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6d6f6e676f2e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/06e1fb839dffdc472a074e1567055dc62cdccc86/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6d6f6e676f2e706e67" alt="mongo" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/mongo.png"></a></p>

<p>大量に突っ込んでも大丈夫ってこと？</p>

<blockquote>
<p>Mongoという名前は、英単語の"humongous"（ばかでかい）に由来する。<br>
<a href="http://ja.wikipedia.org/wiki/MongoDB" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/MongoDB</a></p>
</blockquote>

<h1>
<span id="namazu-単なる思いつき" class="fragment"></span><a href="#namazu-%E5%8D%98%E3%81%AA%E3%82%8B%E6%80%9D%E3%81%84%E3%81%A4%E3%81%8D"><i class="fa fa-link"></i></a>Namazu: 単なる思いつき</h1>

<blockquote>
<p>Namazu の名前の由来は何ですか<br>
特に意味はありません。思いつきで決めました。<br>
<a href="http://namazu.org/FAQ.html#name-origin" class="autolink" rel="nofollow noopener" target="_blank">http://namazu.org/FAQ.html#name-origin</a></p>
</blockquote>

<h1>
<span id="python空飛ぶモンティパイソン" class="fragment"></span><a href="#python%E7%A9%BA%E9%A3%9B%E3%81%B6%E3%83%A2%E3%83%B3%E3%83%86%E3%82%A3%E3%83%91%E3%82%A4%E3%82%BD%E3%83%B3"><i class="fa fa-link"></i></a>Python:『空飛ぶモンティ・パイソン』</h1>

<p><a href="https://camo.qiitausercontent.com/33160a4ca39f1c2461f9d956762d0c45e5a4ba65/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f707974686f6e2e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/33160a4ca39f1c2461f9d956762d0c45e5a4ba65/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f707974686f6e2e6a7067" alt="python" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/python.jpg"></a></p>

<p>Guido van Rossum が好きだったらしい。</p>

<blockquote>
<p>イギリスのテレビ局 BBC が製作したコメディ番組『空飛ぶモンティ・パイソン』にちなんで名付けられた。<br>
<a href="http://ja.wikipedia.org/wiki/Python" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/Python</a></p>
</blockquote>

<h1>
<span id="django-ギタリスト" class="fragment"></span><a href="#django-%E3%82%AE%E3%82%BF%E3%83%AA%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>Django: ギタリスト</h1>

<blockquote>
<p>バンド gypsy jazz のギタリスト ジャンゴ・ラインハルト にちなんで命名された。<br>
<a href="http://ja.wikipedia.org/wiki/Django" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/Django</a></p>
</blockquote>

<h1>
<span id="ubuntu-ズールー語" class="fragment"></span><a href="#ubuntu-%E3%82%BA%E3%83%BC%E3%83%AB%E3%83%BC%E8%AA%9E"><i class="fa fa-link"></i></a>Ubuntu: ズールー語</h1>

<p><a href="https://camo.qiitausercontent.com/44e8112f2dbccf7b9c386a23ca94cfd1c9985484/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f7562756e74752e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/44e8112f2dbccf7b9c386a23ca94cfd1c9985484/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f7562756e74752e6a7067" alt="ubuntu" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/ubuntu.jpg"></a></p>

<p>○○語で○○という意味シリーズ。</p>

<blockquote>
<p>南アフリカのズールー語の言葉で「他者への思いやり」などの意味をもっている<br>
<a href="http://ja.wikipedia.org/wiki/Ubuntu" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/Ubuntu</a></p>
</blockquote>

<h1>
<span id="google-v8-javascript-engine-v型8気筒エンジン" class="fragment"></span><a href="#google-v8-javascript-engine-v%E5%9E%8B8%E6%B0%97%E7%AD%92%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%B3"><i class="fa fa-link"></i></a>Google V8 JavaScript Engine: V型8気筒エンジン</h1>

<p><a href="https://camo.qiitausercontent.com/48daed0fa19aae51d93f2130637b3a8089f3bf33/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f76382e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/48daed0fa19aae51d93f2130637b3a8089f3bf33/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f76382e6a7067" alt="v8" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/v8.jpg"></a></p>

<p>やっぱり！</p>

<blockquote>
<p>V8という名称はV型8気筒エンジンに由来する。米国製自動車ではV8エンジンが高性能を表現するステータスシンボルであり、Google ChromeのV8はそのシンボルにあやかって命名されたものであるという。<br>
<a href="http://www.itmedia.co.jp/enterprise/articles/0809/03/news051.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.itmedia.co.jp/enterprise/articles/0809/03/news051.html</a></p>
</blockquote>

<h1>
<span id="apache-ネイティブアメリカンのアパッチ族" class="fragment"></span><a href="#apache-%E3%83%8D%E3%82%A4%E3%83%86%E3%82%A3%E3%83%96%E3%82%A2%E3%83%A1%E3%83%AA%E3%82%AB%E3%83%B3%E3%81%AE%E3%82%A2%E3%83%91%E3%83%83%E3%83%81%E6%97%8F"><i class="fa fa-link"></i></a>Apache: ネイティブアメリカンのアパッチ族</h1>

<p><a href="https://camo.qiitausercontent.com/dd746fe83ee71be475a3ebf8b3a286e92afc1382/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6170616368652e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/dd746fe83ee71be475a3ebf8b3a286e92afc1382/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6170616368652e6a7067" alt="apache" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/apache.jpg"></a></p>

<p>パッチの集合なのでアパッチというのは違うらしい。</p>

<blockquote>
<p>The name 'Apache' was chosen from respect for the Native American Indian tribe of Apache,<br>
<a href="http://www.apache.org/foundation/faq.html#name" class="autolink" rel="nofollow noopener" target="_blank">http://www.apache.org/foundation/faq.html#name</a></p>
</blockquote>

<h1>
<span id="git-イギリス英語のスラングでバカ" class="fragment"></span><a href="#git-%E3%82%A4%E3%82%AE%E3%83%AA%E3%82%B9%E8%8B%B1%E8%AA%9E%E3%81%AE%E3%82%B9%E3%83%A9%E3%83%B3%E3%82%B0%E3%81%A7%E3%83%90%E3%82%AB"><i class="fa fa-link"></i></a>git: イギリス英語のスラングで「バカ」</h1>

<p><a href="https://camo.qiitausercontent.com/0cebaac680dcbe99ff16ff1af8692f9baf48c627/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6769742e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0cebaac680dcbe99ff16ff1af8692f9baf48c627/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6769742e6a7067" alt="git" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/git.jpg"></a></p>

<p>バカっていうほど単純じゃないような…。</p>

<blockquote>
<p>Linus Torvalds has quipped about the name git, which is Irish/British slang for a child born out of wedlock, and these days commonly British English slang for a stupid or unpleasant person. <br>
<a href="http://en.wikipedia.org/wiki/Git_(software)" class="autolink" rel="nofollow noopener" target="_blank">http://en.wikipedia.org/wiki/Git_(software)</a></p>
</blockquote>

<h1>
<span id="linux-作者の名前" class="fragment"></span><a href="#linux-%E4%BD%9C%E8%80%85%E3%81%AE%E5%90%8D%E5%89%8D"><i class="fa fa-link"></i></a>Linux: 作者の名前</h1>

<p><a href="https://camo.qiitausercontent.com/ff2408cf7482ebce3cb487742e550d698a8fa3ae/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6c696e75782e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ff2408cf7482ebce3cb487742e550d698a8fa3ae/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6c696e75782e6a7067" alt="linux" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/linux.jpg"></a></p>

<p>完全にリーナスの自称かと思いきや…。</p>

<blockquote>
<p>リーナス・トーバルズは、自分の 作品をFreak, Free, Unixを合成して「Freax」と呼ぼうと思っており、開発の初期の半年程の間は、彼はファイルを「Freax」というディレクトリに保存していた。 「Linux」という名前も思いついたが、自己中心的すぎるとして当初は却下していた。</p>

<p>1991年の9月、開発を促進するために、Linuxのファイルはヘルシンキ工科大学のFTPサーバ (ftp.funet.fi) にアップロードされた。トーバルズの協力者であり、当時そのサーバの責任者であったAri Lemmkeは、「Freax」という名前を良く思わず（「Freax」と語感が酷似している「Freaks」は英語で変人・奇人の意味を持つため）、彼はトーバルズに相談することなく、サーバ上のプロジェクトに勝手に「Linux」という名前をつけてしまった。しかし、その後トーバルズは「Linux」という名前をつけることに同意した。<br>
<a href="http://ja.wikipedia.org/wiki/Linux" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/Linux</a></p>
</blockquote>

<h1>
<span id="ruby-同僚の誕生石" class="fragment"></span><a href="#ruby-%E5%90%8C%E5%83%9A%E3%81%AE%E8%AA%95%E7%94%9F%E7%9F%B3"><i class="fa fa-link"></i></a>Ruby: 同僚の誕生石</h1>

<p><a href="https://camo.qiitausercontent.com/cf4cc51bd0883f235b9d0ba73d064440cb99a4a3/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f727562792e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/cf4cc51bd0883f235b9d0ba73d064440cb99a4a3/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f727562792e6a7067" alt="ruby" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/ruby.jpg"></a></p>

<p>ちなみに、まつもとゆきひろ氏は4月生まれで、誕生石はダイヤモンド。</p>

<blockquote>
<p>まつもとの同僚の誕生石（7月）のルビーを取って名付けられた<br>
<a href="http://ja.wikipedia.org/wiki/Ruby" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/Ruby</a></p>
</blockquote>

<h1>
<span id="なでしこ-なでしこjapan" class="fragment"></span><a href="#%E3%81%AA%E3%81%A7%E3%81%97%E3%81%93-%E3%81%AA%E3%81%A7%E3%81%97%E3%81%93japan"><i class="fa fa-link"></i></a>なでしこ: なでしこJAPAN</h1>

<p><a href="https://camo.qiitausercontent.com/63678ef03160638a3bfb30952b1946c08a0ce489/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6e6164657368696b6f2e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/63678ef03160638a3bfb30952b1946c08a0ce489/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303230392d6e616d652d6f726967696e2f6e6164657368696b6f2e6a7067" alt="nadeshiko" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130209-name-origin/nadeshiko.jpg"></a></p>

<blockquote>
<p>「なでしこ」という名前はなでしこジャパンが由来。<br>
<a href="http://ja.wikipedia.org/wiki/%E3%81%AA%E3%81%A7%E3%81%97%E3%81%93_(%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9E)" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/%E3%81%AA%E3%81%A7%E3%81%97%E3%81%93_(%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9E)</a></p>
</blockquote>

<h1>
<span id="typo3-タイプミス" class="fragment"></span><a href="#typo3-%E3%82%BF%E3%82%A4%E3%83%97%E3%83%9F%E3%82%B9"><i class="fa fa-link"></i></a>Typo3: タイプミス</h1>

<blockquote>
<p>カスパー氏は、TYPO3 を開発する前に３つのプロトタイプバージョンを開発しました。そのプロトタイプパージョンの開発している、ある日に何週間もかけて開発したシステムを誤っ て壊してしまったそうです。そこことから、「ミスタイプ・誤操作」の意味を持つ "TYPO" とプロトタイプバージョンの 3 を足して、”TYPO3”って名前にしたそうです。<br>
<a href="http://www.typo3.jp/about-tugj/blog/blog-post/2008/08/20/typo3.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.typo3.jp/about-tugj/blog/blog-post/2008/08/20/typo3.html</a></p>
</blockquote>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />26位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>58</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/94b0ca48fa34eb7ec048">過去を改ざんして過去のコミットをなかったことにする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-09 18:42:23</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>うっかりセンシティブな情報をリポジトリに入れてしまって、あとで気づいて過去もろとも消したい場合にどうしたらいいか手順を解説します。</p>

<h2>
<span id="1-tigとかgit-logで消したいコミットを探してリストアップする" class="fragment"></span><a href="#1-tig%E3%81%A8%E3%81%8Bgit-log%E3%81%A7%E6%B6%88%E3%81%97%E3%81%9F%E3%81%84%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%82%92%E6%8E%A2%E3%81%97%E3%81%A6%E3%83%AA%E3%82%B9%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1. tigとかgit logで消したいコミットを探してリストアップする</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git log --pretty=oneline --abbrev-commit

7217311 やばい &lt;-- 消したい奴
15456c2 だいじょぶ
169d5d2 だいじょぶ
4a398a0  だいじょぶ
</pre></div></div>

<h3>
<span id="2-git-rebaseで消したいコミットまで遡る" class="fragment"></span><a href="#2-git-rebase%E3%81%A7%E6%B6%88%E3%81%97%E3%81%9F%E3%81%84%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%BE%E3%81%A7%E9%81%A1%E3%82%8B"><i class="fa fa-link"></i></a>2. git rebaseで消したいコミットまで遡る</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git rebase -i 7217311~1
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pick 7217311 やばい &lt;ーーこの行を消す
pick fe0a9fc XXXXXXXX
pick 9e1ca25 XXXXXXXX
pick ed6e651 XXXXXXXX
pick 2d53f34 XXXXXXXX
pick 4a398a0 XXXXXXXX

# Rebase f40d7bd..cb26656 onto f40d7bd
#
# Commands:
#  p, pick = use commit
#  r, reword = use commit, but edit the commit message
#  e, edit = use commit, but stop for amending
#  s, squash = use commit, but meld into previous commit
#  f, fixup = like "squash", but discard this commit's log message
#  x, exec = run command (the rest of the line) using shell
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
</pre></div></div>

<p>保存する</p>

<h2>
<span id="3-git-rebase---skip-でコミットを飛ばす-or-消したいファイルを削除して-git-add--git-rebase---continue" class="fragment"></span><a href="#3-git-rebase---skip-%E3%81%A7%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%82%92%E9%A3%9B%E3%81%B0%E3%81%99-or-%E6%B6%88%E3%81%97%E3%81%9F%E3%81%84%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%89%8A%E9%99%A4%E3%81%97%E3%81%A6-git-add--git-rebase---continue"><i class="fa fa-link"></i></a>3. git rebase --skip でコミットを飛ばす OR 消したいファイルを削除して git add &amp;&amp; git rebase --continue</h2>

<h3>
<span id="1-コミットに含まれる一部のファイルだけなかったコトにしたい" class="fragment"></span><a href="#1-%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%AB%E5%90%AB%E3%81%BE%E3%82%8C%E3%82%8B%E4%B8%80%E9%83%A8%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A0%E3%81%91%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%82%B3%E3%83%88%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>1) コミットに含まれる一部のファイルだけなかったコトにしたい</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>rm -f 消したいファイル
git add -A
git rebase --continue

</pre></div></div>

<h3>
<span id="2-コミットに含まれるファイルすべてをなかったコトにしたい" class="fragment"></span><a href="#2-%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%AB%E5%90%AB%E3%81%BE%E3%82%8C%E3%82%8B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%99%E3%81%B9%E3%81%A6%E3%82%92%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%82%B3%E3%83%88%E3%81%AB%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>2) コミットに含まれるファイルすべてをなかったコトにしたい</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git rebase --skip
</pre></div></div>

<p>あとは、ずっと git rebase --contitnue をやっていくだけ。</p>

<h2>
<span id="番外-やっぱ過去改ざんやめようロールバック" class="fragment"></span><a href="#%E7%95%AA%E5%A4%96-%E3%82%84%E3%81%A3%E3%81%B1%E9%81%8E%E5%8E%BB%E6%94%B9%E3%81%96%E3%82%93%E3%82%84%E3%82%81%E3%82%88%E3%81%86%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>番外: やっぱ過去改ざんやめよう(ロールバック)</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git rebase --abort
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />27位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>58</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/81085381c4281e498cde">ComposerでPHPUnit一式+Mockeryをインストール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-08-12 13:44:23</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><strong>UPDATE 2013/03/01</strong>: phpunitの本家がcomposerをサポートしているので、EHER/phpunit-all-in-oneを使わないようにした</p>

<p>このtutorialで作るファイル</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>.
├── MyProject
│   └── ExampleTest.php
├── composer.json
├── phpunit.bootstrap.php
├── phpunit.xml.dist
└── vendor
</pre></div></div>

<h1>
<span id="composerjson-を作る" class="fragment"></span><a href="#composerjson-%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>composer.json を作る</h1>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">composer.json</span></div>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">"require-dev"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"phpunit/phpunit"</span><span class="p">:</span> <span class="s2">"3.7.*"</span><span class="p">,</span>
        <span class="nt">"mockery/mockery"</span><span class="p">:</span> <span class="s2">"0.7.*"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>phpunitの本家はなかなかcomposerに対応していませんでした。なので、今までは本家のリポジトリではなく、<a href="https://github.com/EHER/phpunit-all-in-one" rel="nofollow noopener" target="_blank">EHER/phpunit-all-in-one</a>からphpunitをインストールするのが最も手軽でした。しかし、2012年8月13日に本家がcomposerをサポートしため、本家のリポジトリからインストールすることができます。</p>

<p><code>composer.json</code> の <code>"require-dev"</code> は開発系の依存パッケージを指定するためのものです。一方、ここにはありませんが、通常の <code>"require"</code> はプロダクトの依存パッケージを指定するのものです。この2つを区別することで、開発環境やビルドマシンではComposerでPHPUnitをインストールでき、プロダクション環境ではPHPUnitをインストールしないように環境に応じて選択することができます。</p>

<h1>
<span id="composerでphpunitなどをインストールする" class="fragment"></span><a href="#composer%E3%81%A7phpunit%E3%81%AA%E3%81%A9%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ComposerでPHPUnitなどをインストールする</h1>

<p><code>"require-dev"</code> に指定した依存パッケージを含めてインストールする場合は <code>--dev</code> をつけます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ composer.phar install --dev
Loading composer repositories with package information
Installing dependencies
Nothing to install or update
Loading composer repositories with package information
Installing dev dependencies
  - Installing mockery/mockery (0.7.2)
    Loading from cache

  - Installing symfony/yaml (v2.1.8)
    Loading from cache

  - Installing phpunit/php-text-template (1.1.4)
    Loading from cache

  - Installing phpunit/phpunit-mock-objects (1.2.3)
    Loading from cache

  - Installing phpunit/php-timer (1.0.4)
    Loading from cache

  - Installing phpunit/php-token-stream (1.1.5)
    Loading from cache

  - Installing phpunit/php-file-iterator (1.3.3)
    Loading from cache

  - Installing phpunit/php-code-coverage (1.2.9)
    Loading from cache

  - Installing phpunit/phpunit (3.7.14)
    Loading from cache

mockery/mockery suggests installing Hamcrest (1.0.0)
phpunit/phpunit suggests installing phpunit/php-invoker (&gt;=1.1.0,&lt;1.2.0)
Writing lock file
Generating autoload files
</pre></div></div>

<h1>
<span id="phpunitが実行できるか確認する" class="fragment"></span><a href="#phpunit%E3%81%8C%E5%AE%9F%E8%A1%8C%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>PHPUnitが実行できるか確認する</h1>

<p>インストールすると、実行ファイル <code>phpunit</code> がついてきます。実行ファイルは <code>vendor/bin</code> に入ります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ./vendor/bin/phpunit --version
PHPUnit 3.7.14 by Sebastian Bergmann.
</pre></div></div>

<h1>
<span id="phpunit設定ファイルを作る" class="fragment"></span><a href="#phpunit%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>PHPUnit設定ファイルを作る</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vim phpunit.xml.dist
</pre></div></div>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">phpunit.xml.dist</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;phpunit</span>
    <span class="na">bootstrap=</span><span class="s">"phpunit.bootstrap.php"</span>
    <span class="na">processIsolation=</span><span class="s">"false"</span>
    <span class="na">verbose=</span><span class="s">"true"</span>
    <span class="na">strict=</span><span class="s">"false"</span>
    <span class="na">colors=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;testsuites&gt;</span>
        <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">"PHPUnit"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- テストケースがあるディレクトリを列挙する --&gt;</span>
            <span class="nt">&lt;directory&gt;</span>MyProject<span class="nt">&lt;/directory&gt;</span>
            <span class="c">&lt;!-- &lt;directory&gt;MyProject2&lt;/directory&gt; --&gt;</span>
            <span class="c">&lt;!-- &lt;directory&gt;MyProject3&lt;/directory&gt; --&gt;</span>
            <span class="c">&lt;!-- &lt;directory&gt;MyProject4&lt;/directory&gt; --&gt;</span>
        <span class="nt">&lt;/testsuite&gt;</span>
    <span class="nt">&lt;/testsuites&gt;</span>

    <span class="nt">&lt;logging&gt;</span>
        <span class="c">&lt;!-- コードカバレッジ率 --&gt;</span>
        <span class="nt">&lt;log</span>
            <span class="na">type=</span><span class="s">"coverage-html"</span>
            <span class="na">target=</span><span class="s">"metrics/coverage"</span>
            <span class="na">charset=</span><span class="s">"UTF-8"</span>
            <span class="na">yui=</span><span class="s">"true"</span>
            <span class="na">highlight=</span><span class="s">"false"</span>
            <span class="na">lowUpperBound=</span><span class="s">"35"</span>
            <span class="na">highLowerBound=</span><span class="s">"70"</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- &lt;log type="coverage-text" target="php://stdout" lowUpperBound="35" highLowerBound="70" /&gt; --&gt;</span>
        <span class="c">&lt;!-- 上行をアンコメントアウトするとカバレッジ率がプロンプトにも表示される --&gt;</span>
    <span class="nt">&lt;/logging&gt;</span>

    <span class="nt">&lt;filter&gt;</span>
        <span class="c">&lt;!-- コードカバレッジ率を計測する対象の指定 --&gt;</span>
        <span class="nt">&lt;whitelist&gt;</span>
            <span class="nt">&lt;directory</span> <span class="na">suffix=</span><span class="s">".php"</span><span class="nt">&gt;</span>src<span class="nt">&lt;/directory&gt;</span>
            <span class="c">&lt;!-- &lt;file&gt;/path/to/file&lt;/file&gt; --&gt;</span>
            <span class="nt">&lt;exclude&gt;</span>
                <span class="nt">&lt;file&gt;</span>public/index.php<span class="nt">&lt;/file&gt;</span>
            <span class="nt">&lt;/exclude&gt;</span>
        <span class="nt">&lt;/whitelist&gt;</span>
        <span class="c">&lt;!-- コードカバレッジ測定対象から除外 --&gt;</span>
        <span class="nt">&lt;blacklist&gt;</span>
            <span class="nt">&lt;directory</span> <span class="na">suffix=</span><span class="s">".php"</span> <span class="na">group=</span><span class="s">"PHPUNIT"</span><span class="nt">&gt;</span>vendor<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/blacklist&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;listeners&gt;</span>
        <span class="c">&lt;!-- mockery統合のため必要 --&gt;</span>
        <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">"\Mockery\Adapter\Phpunit\TestListener"</span> <span class="na">file=</span><span class="s">"Vendor/mockery/mockery/library/Mockery/Adapter/Phpunit/TestListener.php"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/listeners&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</div>

<h1>
<span id="phpunitbootstrapphp-を作成する" class="fragment"></span><a href="#phpunitbootstrapphp-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>phpunit.bootstrap.php を作成する</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vim phpunit.bootstrap.php
</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">phpunit.bootstrap.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// For composer</span>
<span class="k">require_once</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>

<span class="c1">// テストクラス対象のオートロードなどもここに書く</span>
</pre></div>
</div>

<h1>
<span id="単体テストのサンプルを作って試してみる" class="fragment"></span><a href="#%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>単体テストのサンプルを作って試してみる</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir MyProject
$ cd MyProject/
$ vim ExampleTest.php
</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">ExampleTest.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">ExampleTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
        <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd ../
$ ./vendor/bin/phpunit 
PHPUnit 3.7.14 by Sebastian Bergmann.

Configuration read from /private/tmp/phpunit/phpunit.xml.dist

.

Time: 0 seconds, Memory: 4.75Mb

OK (1 test, 1 assertion)

Generating code coverage report in HTML format ... done
</pre></div></div>

<p>PHPに <code>xdebug</code> 拡張が入っていればコードカバレッジは <code>metrics/coverage/index.html</code> に生成されます。</p>

<p>以上。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />28位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>54</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/9c349ee212caee635997">JavaScriptの対PHPerトラップ 13: その傾向と対策 </a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-02-03 18:05:40</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[JavaScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>JavaScriptはPHPとよく似たシンタクスを持っています。PHPerにとっては親近感を感じる言語かもしれません。しかし、両者の言語仕様の違いはおそらくPHPerの想像以上です。『JavaScript: The Good Parts ―「良いパーツ」によるベストプラクティス』の著者、Douglas Crockford 氏が「JavaScriptはCの皮をかぶったLISP」と表現するくらいです。</p>

<p>PHPとJavaScriptが似ている(ように見える)が故に、はまりそうなポイントとその対策について簡単にまとめてみました。より詳しく知りたい方は『JavaScript: The Good Parts ―「良いパーツ」によるベストプラクティス』や『JavaScriptパターン ―優れたアプリケーションのための作法』を読んでみることをオススメします。</p>

<p>あと、自分も経験が浅いところがありますので間違いなどあればご指摘くださいm(_ _)m 他にも、「こんなのではまった」というエピソードも募集してます。</p>

<h1>
<span id="1-for-in-は-foreach-じゃない" class="fragment"></span><a href="#1-for-in-%E3%81%AF-foreach-%E3%81%98%E3%82%83%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>1. for-in は foreach じゃない</h1>

<p>配列のループに便利なPHPの <code>foreach</code> ですが、同じ感覚でJavaScriptの配列(PHPで言う添字配列)に <code>for-in</code> を使うのは、論理的なバグの原因になります。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$num</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$num</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/*</span>
<span class="cm">int(1)</span>
<span class="cm">int(2)</span>
<span class="cm">int(3)</span>
<span class="cm">int(4)</span>
<span class="cm">int(5)</span>
<span class="cm">*/</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span> <span class="c1">// ライブラリ、広告、ブログガジェット、未来の改修などあなたの知らないところで</span>

<span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">];</span>

<span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">arr</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="p">}</span>
<span class="cm">/*</span>
<span class="cm">1</span>
<span class="cm">2</span>
<span class="cm">3</span>
<span class="cm">4</span>
<span class="cm">5</span>
<span class="cm">"foo" (←あれっ)</span>
<span class="cm">*/</span>
</pre></div></div>

<h3>
<span id="対策" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96"><i class="fa fa-link"></i></a>対策</h3>

<p>配列では、 <code>for-in</code> ではなく <code>for</code> を使う。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div></div>

<p>余談ですが、 <code>for-in</code> は配列の順番も保証されないので、なおのこと <code>for</code> を使うことが重要です。</p>

<h1>
<span id="2-ついつい-var-を忘れる" class="fragment"></span><a href="#2-%E3%81%A4%E3%81%84%E3%81%A4%E3%81%84-var-%E3%82%92%E5%BF%98%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>2. ついつい var を忘れる</h1>

<p>文末にセミコロンを用いない言語に慣れている人が、PHPでセミコロンをついつい忘れてしまうのと同じように、PHPに慣れている人は <code>var</code> 宣言をつい忘れてしまうことがあります。</p>

<p>しかし、JavaScriptは<code>var</code>宣言していない変数は、暗黙のうちにグローバル変数にしてしまいます。なんの警告もありません。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">func</span><span class="p">();</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span> <span class="c1">// string(0) ""</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span> <span class="c1">// var 忘れ！</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">func</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// "foo"</span>
</pre></div></div>

<h3>
<span id="対策-1" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-1"><i class="fa fa-link"></i></a>対策</h3>

<p>関数の最初にローカル変数をリストアップする。そうすることを習慣化する。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span><span class="p">,</span>
        <span class="nx">foo</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">,</span>
        <span class="nx">bar</span> <span class="o">=</span> <span class="s1">'bar'</span><span class="p">;</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">foo</span> <span class="o">+</span> <span class="nx">bar</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="3-巻き上げ" class="fragment"></span><a href="#3-%E5%B7%BB%E3%81%8D%E4%B8%8A%E3%81%92"><i class="fa fa-link"></i></a>3. 巻き上げ</h1>

<p>PHPでは、変数初期化より先に変数を参照すると Notice エラーになります。ところが、JavaScriptには「巻き上げ」と呼ばれる振る舞いにより、PHPでは考えられない動きになることがあります。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$foo</span><span class="p">);</span> <span class="c1">// NULL, Notice: Undefined variable: foo in ... on line ...</span>
    <span class="nv">$foo</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$foo</span><span class="p">);</span> <span class="c1">// string(3) "foo"</span>
<span class="p">}</span>

<span class="nx">func</span><span class="p">();</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s1">'hoge'</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// undefined (とくにエラーにもならず、グローバルのfooを参照しているわけでもない)</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// "foo"</span>
<span class="p">}</span>

<span class="nx">func</span><span class="p">();</span>
</pre></div></div>

<p><code>var</code> 宣言は関数のどこであっても行うことができます。「巻き上げ」とは、関数の途中で <code>var</code> 宣言している変数を、関数の最初で宣言したことにしていまう振る舞いのことです。つまり、上の例は、下記のコードと等価になります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">foo</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
    <span class="nx">foo</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// "foo"</span>
<span class="p">}</span>
</pre></div></div>

<h3>
<span id="対策-2" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-2"><i class="fa fa-link"></i></a>対策</h3>

<p>対策としては、「var忘れ」と同じく、関数の頭でローカル変数をリストアップすることです。</p>

<h1>
<span id="4-var宣言してもローカル変数にならない" class="fragment"></span><a href="#4-var%E5%AE%A3%E8%A8%80%E3%81%97%E3%81%A6%E3%82%82%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0%E3%81%AB%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>4. var宣言してもローカル変数にならない</h1>

<p><code>var</code> でリストアップするのは有効です。ただし、下記のように代入を連鎖することはハマリパターンになります。これは、式が右から順に評価されるためです。 下の例では、 <code>bar = '1'</code> がグローバル変数になっていまいます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">function</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$foo</span> <span class="o">=</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">func</span><span class="p">();</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$foo</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">);</span> <span class="c1">// NULL, NULL (Noticeが出ます)</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">bar</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">func</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// "foo is not defined" (例外が飛びます)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bar</span><span class="p">);</span> <span class="c1">// "1"</span>
</pre></div></div>

<h3>
<span id="対策-3" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-3"><i class="fa fa-link"></i></a>対策</h3>

<p>変数代入を連鎖する場合は、<code>var</code> 宣言だけ先にやっておきましょう。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">foo</span><span class="p">,</span> <span class="nx">bar</span>
    <span class="nx">foo</span> <span class="o">=</span> <span class="nx">bar</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="5-for-in-と-prototype" class="fragment"></span><a href="#5-for-in-%E3%81%A8-prototype"><i class="fa fa-link"></i></a>5. for-in と prototype</h1>

<p>オブジェクト(連想配列)に関しては、<code>for-in</code> を使うべきです。ところが、JavaScript は prototype を変更することで、すべての関連するオブジェクトにその変更が行き渡ります。その結果、自分のメンバ変数ではない変数を <code>for-in</code> が拾うことがあります。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$assoc</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'foo'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">'bar'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">'baz'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$assoc</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">string(3) "foo" int(1)</span>
<span class="cm">string(3) "bar" int(2)</span>
<span class="cm">string(3) "baz" int(3)</span>
<span class="cm">*/</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hoge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span> <span class="c1">// ライブラリ、広告、ブログガジェット、未来の改修などあなたの知らないところで</span>

<span class="kd">var</span> <span class="nx">assoc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">foo</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">bar</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nx">baz</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">};</span>

<span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">assoc</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">assoc</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">foo 1</span>
<span class="cm">bar 2</span>
<span class="cm">baz 3</span>
<span class="cm">hoge function () {} // あれ？</span>
<span class="cm">*/</span>
</pre></div></div>

<h3>
<span id="対策-4" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-4"><i class="fa fa-link"></i></a>対策</h3>

<p><code>hasOwnProperty()</code> を呼んで、自分自身のメンバ変数かを確認する必要があります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">assoc</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">assoc</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">assoc</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="6-最後のカンマ" class="fragment"></span><a href="#6-%E6%9C%80%E5%BE%8C%E3%81%AE%E3%82%AB%E3%83%B3%E3%83%9E"><i class="fa fa-link"></i></a>6. 最後のカンマ</h1>

<p>PHPは配列の列挙をカンマ(,)で終わることができます。プロジェクトによっては、コーディング規約で、必ずカンマで終わることを推奨しているところもあるでしょう。一方、JavaScriptでは、カンマで終わってしまうとIEでパースエラーになります。デバッグ環境が劣悪なIEでこの手のエラーが起こると、膨大なコードをデバッグするのも一苦労ですね。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="s1">'192.168.0.1'</span><span class="p">,</span>
    <span class="s1">'192.168.0.2'</span><span class="p">,</span>
    <span class="s1">'192.168.0.3'</span><span class="p">,</span>
<span class="p">);</span>

<span class="nv">$assoc</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'foo'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">'bar'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">'baz'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">);</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'127.0.0.1'</span><span class="p">,</span>
    <span class="s1">'192.168.0.1'</span><span class="p">,</span>
    <span class="s1">'192.168.0.2'</span><span class="p">,</span>
    <span class="s1">'192.168.0.3'</span><span class="p">,</span> <span class="c1">// このカンマでパースエラー</span>
<span class="p">]</span>

<span class="kd">var</span> <span class="nx">assoc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">foo</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">bar</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nx">baz</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="c1">// このカンマでパースエラー</span>
<span class="p">};</span>
</pre></div></div>

<h3>
<span id="対策-5" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-5"><i class="fa fa-link"></i></a>対策</h3>

<p>最後にカンマを付けないように注意するにこしたことはないですが、うっかりつけてしまうことがあると思います。こうした場合のチェックは、チェックツールに任せるのがおすすめです。Google Closure Compiler や JSLint などのツールを使うと、この手のエラーを発見してくれます。</p>

<h1>
<span id="7-intval-のつもりで-parseint" class="fragment"></span><a href="#7-intval-%E3%81%AE%E3%81%A4%E3%82%82%E3%82%8A%E3%81%A7-parseint"><i class="fa fa-link"></i></a>7. intval() のつもりで parseInt()</h1>

<p>文字列を数値型にすることは、PHPであれJavaScriptであれ、しばしば行うことがあります。ググルと、<code>parseInt()</code> を使った例が出てきたりします。これを <code>intval()</code> 的な感覚で使うと、0で始まる文字列が8進数として解釈されるなど、バグの原因になることがあります。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="s1">'1'</span><span class="p">));</span> <span class="c1">// int(1)</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="s1">'12 MB'</span><span class="p">));</span> <span class="c1">// int(12)</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="s1">'0775'</span><span class="p">));</span> <span class="c1">// int(775)</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="s1">'1'</span><span class="p">));</span> <span class="c1">// 1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="s1">'12 MB'</span><span class="p">));</span> <span class="c1">// 12</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="s1">'0775'</span><span class="p">));</span> <span class="c1">// 14509 (なんだとぉ！？)</span>
</pre></div></div>

<h3>
<span id="対策-6" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-6"><i class="fa fa-link"></i></a>対策</h3>

<p>対策としては、第二引数に進数を明示する他に、</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="s1">'0775'</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span> <span class="c1">// 775</span>
</pre></div></div>

<p>計算をする方法などもあります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="o">+</span><span class="s1">'0775'</span><span class="p">);</span> <span class="c1">// 775</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'0775'</span> <span class="o">*</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 775</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="s1">'0775'</span><span class="p">));</span> <span class="c1">// 775</span>
</pre></div></div>

<p>こちらのほうが <code>parseInt()</code> よりも速くなることがあるそうです。</p>

<h1>
<span id="8-字下げスタイルによる問題" class="fragment"></span><a href="#8-%E5%AD%97%E4%B8%8B%E3%81%92%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E3%81%AB%E3%82%88%E3%82%8B%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>8. 字下げスタイルによる問題</h1>

<p>PHPのプロジェクトによっては、字下げスタイルにBSD/オールマンスタイルを起用しているケースがあります。オールマンスタイルは、開始の波括弧を次の行に置くのが特徴的です。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">オールマンスタイル</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span> <span class="nv">$foo</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// code...</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="c1">// code...</span>
<span class="p">}</span>
</pre></div>
</div>

<p>PHPとJavaScriptで似た字下げスタイルをコーディング規約に盛り込むことは、プロジェクトとして一貫性があり迷いが少なくなります。しかし、JavaScriptにオールマンスタイルを適用する場合は注意が必要です。JavaScriptは、行が正しく終っていないと判断した場合、暗黙のうちにセミコロンを挿入するからです。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">func</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Alice'</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nx">func</span><span class="p">());</span> <span class="c1">// array(1) </span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">func</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span>
    <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">'Alice'</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">func</span><span class="p">());</span> <span class="c1">// undefined</span>
</pre></div></div>

<p>上記のコードは、暗黙のうちに次のコードと解釈されます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">func</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span><span class="p">;</span> <span class="c1">// セミコロン自動挿入。ここから下は到達できないコードになる。</span>
    <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">'Alice'</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h3>
<span id="対策-7" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-7"><i class="fa fa-link"></i></a>対策</h3>

<p>オールマンスタイルをやめて、K&amp;Rスタイルに統一するか、return については特別な例外を設け、チームメイトに注意喚起する。</p>

<h1>
<span id="9-配列もオブジェクトのひとつ" class="fragment"></span><a href="#9-%E9%85%8D%E5%88%97%E3%82%82%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E3%81%B2%E3%81%A8%E3%81%A4"><i class="fa fa-link"></i></a>9. 配列もオブジェクトのひとつ</h1>

<p>PHPは配列がとても便利です。<code>array()</code> と書いてしまえばあらゆる変数を格納できます。JavaScriptには、もっと短い配列リテラル <code>[]</code> とオブジェクトリテラル <code>{}</code> があり、これまた便利です。PHPの添字配列は <code>[]</code> に、連想配列は <code>{}</code> に直訳できますが、JavaScriptの配列もオブジェクトもあくまで オブジェクト ということを忘れてはいけません。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="nv">$assoc</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'foo'</span> <span class="o">=&gt;</span> <span class="s1">'Alice'</span><span class="p">,</span>
    <span class="s1">'bar'</span> <span class="o">=&gt;</span> <span class="s1">'Bob'</span><span class="p">,</span>
    <span class="s1">'baz'</span> <span class="o">=&gt;</span> <span class="s1">'Carol'</span><span class="p">,</span>
<span class="p">);</span>

<span class="c1">// 別変数にコピーする</span>
<span class="nv">$arrCopy</span> <span class="o">=</span> <span class="nv">$arr</span><span class="p">;</span>
<span class="nv">$assocCopy</span> <span class="o">=</span> <span class="nv">$assoc</span><span class="p">;</span>

<span class="c1">// コピーを修正する</span>
<span class="nv">$arrCopy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99999</span><span class="p">;</span>
<span class="nv">$assocCopy</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Dave'</span><span class="p">;</span>

<span class="c1">// 当然ながら、元の配列は変化なし</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// int(1)</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$assoc</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">]);</span> <span class="c1">// string(5) "Alice"</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>

<span class="kd">var</span> <span class="nx">assoc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">foo</span><span class="o">:</span> <span class="s1">'Alice'</span><span class="p">,</span>
    <span class="nx">bar</span><span class="o">:</span> <span class="s1">'Bob'</span><span class="p">,</span>
    <span class="nx">baz</span><span class="o">:</span> <span class="s1">'Carol'</span>
<span class="p">};</span>

<span class="c1">// 別変数にコピーする</span>
<span class="kd">var</span> <span class="nx">arrCopy</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">assocCopy</span> <span class="o">=</span> <span class="nx">assoc</span><span class="p">;</span>

<span class="c1">// コピーを修正する</span>
<span class="nx">arrCopy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99999</span><span class="p">;</span>
<span class="nx">assocCopy</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="s1">'Dave'</span><span class="p">;</span>

<span class="c1">// ！！！？？</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// 99999</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">assoc</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// "Dave"</span>
</pre></div></div>

<p>余談ですが、上のJSコードを厳密にPHPで再現するとしたら、次のようになります。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$arr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayObject</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>

<span class="nv">$assoc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayObject</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'foo'</span> <span class="o">=&gt;</span> <span class="s1">'Alice'</span><span class="p">,</span>
    <span class="s1">'bar'</span> <span class="o">=&gt;</span> <span class="s1">'Bob'</span><span class="p">,</span>
    <span class="s1">'baz'</span> <span class="o">=&gt;</span> <span class="s1">'Carol'</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$arrCopy</span> <span class="o">=</span> <span class="nv">$arr</span><span class="p">;</span>
<span class="nv">$assocCopy</span> <span class="o">=</span> <span class="nv">$assoc</span><span class="p">;</span>

<span class="nv">$arrCopy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99999</span><span class="p">;</span>
<span class="nv">$assocCopy</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Dave'</span><span class="p">;</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// int(99999)</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$assoc</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">]);</span> <span class="c1">// string(4) "Dave"</span>
</pre></div></div>

<h3>
<span id="対策-8" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-8"><i class="fa fa-link"></i></a>対策</h3>

<p><code>for</code> で回してコピーする。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">copyArray</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">arrCopy</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">arrCopy</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">arrCopy</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">copyObject</span><span class="p">(</span><span class="nx">assoc</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">assocCopy</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">assoc</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">assoc</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nx">assocCopy</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">assoc</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">assocCopy</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p><code>slice()</code> をたくみに使う。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">arrCopy</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div></div>

<p>jQueryを使ってコピーする。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="c1">// Shallow copy</span>
<span class="kd">var</span> <span class="nx">newObject</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">oldObject</span><span class="p">);</span>

<span class="c1">// Deep copy</span>
<span class="kd">var</span> <span class="nx">newObject</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">oldObject</span><span class="p">);</span>
</pre></div></div>

<h1>
<span id="10-メンバ変数の扱い" class="fragment"></span><a href="#10-%E3%83%A1%E3%83%B3%E3%83%90%E5%A4%89%E6%95%B0%E3%81%AE%E6%89%B1%E3%81%84"><i class="fa fa-link"></i></a>10. メンバ変数の扱い</h1>

<p>PHPのクラスでは、non-staticなメンバ変数が他のオブジェクトをいじったことで、影響をうけることはありません。(この例はちょっと長いですが我慢してください。)</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$profile</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">'age'</span>  <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">public</span> <span class="nv">$hobbies</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="sd">/**</span>
<span class="sd">     * コンストラクタ</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 名前をセットする</span>
<span class="sd">     * @param string $name 名前</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">profile</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 趣味を追加する</span>
<span class="sd">     * @param string $hobby 趣味</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addHobby</span><span class="p">(</span><span class="nv">$hobby</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hobbies</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$hobby</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$alice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$bob</span>   <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>

<span class="c1">// ボブの属性を変更</span>
<span class="nv">$bob</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">'Bob'</span><span class="p">);</span>
<span class="nv">$bob</span><span class="o">-&gt;</span><span class="na">addHobby</span><span class="p">(</span><span class="s1">'Ski'</span><span class="p">);</span>

<span class="c1">// 当然ながら、アリスのデータは何も変わってない</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$alice</span><span class="o">-&gt;</span><span class="na">profile</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span> <span class="c1">// NULL</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$alice</span><span class="o">-&gt;</span><span class="na">hobbies</span><span class="p">);</span> <span class="c1">// array(0) {}</span>

</pre></div></div>

<p>一方、JavaScriptでは、次のようなパターンでメンバ変数を扱った場合に、他のオブジェクトに影響を与えます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Userオブジェクトを作成する</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @class User</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="nx">User</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">     * @protected</span>
<span class="cm">     * @var {Object}</span>
<span class="cm">     */</span>
    <span class="nx">profile</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">},</span>

    <span class="nx">hobbies</span><span class="o">:</span> <span class="p">[],</span>

    <span class="cm">/**</span>
<span class="cm">     * 名前をセットする</span>
<span class="cm">     * @public</span>
<span class="cm">     * @param {String} name 名前</span>
<span class="cm">     */</span>
    <span class="nx">setName</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * 趣味を追加する</span>
<span class="cm">     * @public</span>
<span class="cm">     * @param {String} hobby 趣味</span>
<span class="cm">     */</span>
    <span class="nx">addHobby</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">hobby</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hobbies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">hobby</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">alice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">bob</span>   <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>

<span class="c1">// ボブの属性を変更</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">setName</span><span class="p">(</span><span class="s1">'Bob'</span><span class="p">);</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">addHobby</span><span class="p">(</span><span class="s1">'Ski'</span><span class="p">);</span>

<span class="c1">// ボブに対して適用したと思っていた変更がアリスにも適用されている</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">alice</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// "Bob"</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">alice</span><span class="p">.</span><span class="nx">hobbies</span><span class="p">);</span> <span class="c1">// ["Ski"]</span>
</pre></div></div>

<p>(厳密には、JavaScriptにはクラスがありません。また、PHP5~のオブジェクトも参照のように振舞いますし、JavaScriptの配列/オブジェクトは、PHPのオブジェクトとして対応付けるほうがより理解が進むかと思います。)</p>

<h3>
<span id="対策-9" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-9"><i class="fa fa-link"></i></a>対策</h3>

<p>オブジェクトごとに異なるメンバ変数はコンストラクタで初期化する。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Userオブジェクトを作成する</span>
<span class="cm"> * @constructor</span>
<span class="cm"> * @class User</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">profile</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hobbies</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">}</span>

<span class="nx">User</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/**</span>
<span class="cm">     * 名前をセットする</span>
<span class="cm">     * @public</span>
<span class="cm">     * @param {String} name 名前</span>
<span class="cm">     */</span>
    <span class="nx">setName</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="cm">/**</span>
<span class="cm">     * 趣味を追加する</span>
<span class="cm">     * @public</span>
<span class="cm">     * @param {String} hobby 趣味</span>
<span class="cm">     */</span>
    <span class="nx">addHobby</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">hobby</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hobbies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">hobby</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>


<span class="kd">var</span> <span class="nx">alice</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">bob</span>   <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>

<span class="nx">bob</span><span class="p">.</span><span class="nx">setName</span><span class="p">(</span><span class="s1">'Bob'</span><span class="p">);</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">addHobby</span><span class="p">(</span><span class="s1">'Ski'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">alice</span><span class="p">.</span><span class="nx">profile</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// null</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">alice</span><span class="p">.</span><span class="nx">hobbies</span><span class="p">);</span> <span class="c1">// []</span>
</pre></div></div>

<p>ちなみに、JavaScriptの <code>new</code> は「既存のオブジェクトをもとに新しいオブジェクトをつくる」という意味なので、PHPの <code>clone</code> に近いと思っておいたほうがいいでしょう。また、JavaScriptの <code>prototype</code> に格納されているメンバ変数は、そのままではPHPで言うところの <code>public static $value</code> のような状態にあると考えるとなんとなくイメージできるのではないでしょうか。</p>

<h1>
<span id="11-正規表現をコメントアウト" class="fragment"></span><a href="#11-%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E3%82%92%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88"><i class="fa fa-link"></i></a>11. 正規表現をコメントアウト</h1>

<p>PHPでは正規表現は文字列ですが、JavaScriptでは正規表現リテラル<code>//</code>を使うことができます。また、PHPと同じようにJavaScriptのコメントは <code>/* */</code> を使うことができます。ところが、コメントの終端<code>*/</code> と <code>/abc.*/</code> のような正規表現を区別するほどコンパイラは賢くありません。次の例は、パースエラーになります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="cm">/* ちょっとコメントアウト^^</span>
<span class="cm">var string = "0123456789abcdef".replace(/abc.*/</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
<span class="o">*</span><span class="err">/</span>

<span class="c1">// Uncaught SyntaxError: Unexpected token ,</span>
</pre></div></div>

<h3>
<span id="対策-10" class="fragment"></span><a href="#%E5%AF%BE%E7%AD%96-10"><i class="fa fa-link"></i></a>対策</h3>

<p>コメントは <code>//</code> のみを使う。<code>RegExp</code> オブジェクトを使う。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />29位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>51</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/31a1c7c47f49cb53f2a7">SplFileObjectでオブジェクト指向らしいファイル操作をしてみる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-03-04 14:05:39</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>file_get_contents()</code> すごく便利ですが、容量が大きいファイルを扱うときはメモリ消費が心配ですよね。<br>
かと言って <code>fopen()</code> で古めかしいコードを書くのはイヤ！そんなときこそ、<code>SplFileObject</code> クラスの出番です！</p>

<h2>
<span id="ファイルの中身は-foreach-で回すだけで取得できる" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%81%AF-foreach-%E3%81%A7%E5%9B%9E%E3%81%99%E3%81%A0%E3%81%91%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%A7%E3%81%8D%E3%82%8B"><i class="fa fa-link"></i></a>ファイルの中身は <code>foreach()</code> で回すだけで取得できる</h2>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$splFileObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplFileObject</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>

<span class="k">echo</span> <span class="s1">'File name:'</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$splFileObject</span><span class="o">-&gt;</span><span class="na">getPathname</span><span class="p">(),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s1">'File contents:'</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$splFileObject</span> <span class="k">as</span> <span class="nv">$line</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$line</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">実行結果</span></div>
<div class="highlight"><pre><span></span>$ php SplFileObject.php 
File name:
/Users/suin/Desktop/SplFileObject.php
File contents:
&lt;?php

$splFileObject = new SplFileObject(__FILE__);

echo 'File name:', PHP_EOL;
echo $splFileObject-&gt;getPathname(), PHP_EOL;

echo 'File contents:', PHP_EOL;

foreach ( $splFileObject as $line )
{
    echo $line;
}
</pre></div>
</div>

<h2>
<span id="もちろんcsvだって-foreach-でできます" class="fragment"></span><a href="#%E3%82%82%E3%81%A1%E3%82%8D%E3%82%93csv%E3%81%A0%E3%81%A3%E3%81%A6-foreach-%E3%81%A7%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>もちろんCSVだって <code>foreach()</code> でできます！</h2>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'foo.csv'</span><span class="p">,</span> <span class="s2">"1,2,3</span><span class="se">\n</span><span class="s2">4,5,6</span><span class="se">\n</span><span class="s2">7,8,9</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>

<span class="nv">$splFileObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplFileObject</span><span class="p">(</span><span class="s1">'foo.csv'</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$splFileObject</span> <span class="k">as</span> <span class="nv">$line</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$line</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// CSVモードに切り替える</span>
<span class="nv">$splFileObject</span><span class="o">-&gt;</span><span class="na">setFlags</span><span class="p">(</span><span class="nx">SplFileObject</span><span class="o">::</span><span class="na">READ_CSV</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$splFileObject</span> <span class="k">as</span> <span class="nv">$line</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">実行結果</span></div>
<div class="highlight"><pre><span></span>* php SplFileObject.php 
1,2,3
4,5,6
7,8,9
array(3) {
  [0] =&gt;
  string(1) "1"
  [1] =&gt;
  string(1) "2"
  [2] =&gt;
  string(1) "3"
}
array(3) {
  [0] =&gt;
  string(1) "4"
  [1] =&gt;
  string(1) "5"
  [2] =&gt;
  string(1) "6"
}
array(3) {
  [0] =&gt;
  string(1) "7"
  [1] =&gt;
  string(1) "8"
  [2] =&gt;
  string(1) "9"
}
array(1) {
  [0] =&gt;
  NULL
}
</pre></div>
</div>

<h2>
<span id="関連" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3"><i class="fa fa-link"></i></a>関連</h2>

<p><a href="http://qiita.com/suin/items/d1595d87a6aa7ba6492d" id="reference-d1b50ece3fad58fe4400">変則的なCSVを処理する - Qiita</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />30位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>50</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/00656d9dbd2f26dd8b91">人生いろいろ、インターフェイス命名規則いろいろ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-07-27 19:36:15</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>「PHPのinterfaceの命名規約ってどういうのがいいんだろう？」</p>

<p>フレームワークや他言語の命名規則をあつめてみた。(パターン名は勝手にでっち上げたものであり、実在の人物・団体・事件などとは一切関係ありません。 ）</p>

<p>○とか☓と書いたのは個人的な感想です。どれが優れている劣っているという主張ではありません。炎上しないでください&gt;&lt;。</p>

<h2>
<span id="i-接頭辞パターン" class="fragment"></span><a href="#i-%E6%8E%A5%E9%A0%AD%E8%BE%9E%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>I-接頭辞パターン</h2>

<p><code>I</code> をインターフェイス名の頭につけるパターン。それを実装するクラスは <code>I</code> を取り除いたインターフェイス名を引き継ぐ。<a href="http://msdn.microsoft.com/en-us/library/8bc1fexb" rel="nofollow noopener" target="_blank">.NET</a>やJavaで見かけます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">IUser</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">IUser</span><span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ 慣れればインターフェイスだと比較的分かりやすいかも。</li>
<li>○ ファイル名でソートしたときに、インターフェイスが集まる。</li>
<li>× Iが見えにくい。細い。</li>
<li>× ハンガリアン記法っぽくて。</li>
</ul>

<h2>
<span id="小文字-i-接頭辞パターン" class="fragment"></span><a href="#%E5%B0%8F%E6%96%87%E5%AD%97-i-%E6%8E%A5%E9%A0%AD%E8%BE%9E%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>小文字 I-接頭辞パターン</h2>

<p>I接頭辞パターンの小文字版です。<code>i</code> 接頭辞をインターフェイス名の頭につけます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">iUser</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">iUser</span><span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ 慣れればインターフェイスだと比較的分かりやすいかも。</li>
<li>○ ファイル名でソートしたときに、インターフェイスが集まる。</li>
<li>× iが見えにくい。細い。</li>
<li>× ハンガリアン記法っぽくて。</li>
<li>× PSR-0的に小文字なのに違和感。</li>
</ul>

<h2>
<span id="-interface接尾辞パターン" class="fragment"></span><a href="#-interface%E6%8E%A5%E5%B0%BE%E8%BE%9E%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>-Interface接尾辞パターン</h2>

<p><code>Interface</code> をインターフェイスの後ろにつけるパターンです。<a href="http://framework.zend.com/manual/ja/coding-standard.naming-conventions.html" rel="nofollow noopener" target="_blank">Zend Frameworkの命名規則</a>や<a href="http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml" rel="nofollow noopener" target="_blank">Google C++ Style Code</a>をはじめ、Javaなど複数の言語で見かけます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">UserInterface</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">User</span> <span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ インターフェイスって分かりやすい。</li>
<li>○ もうクラスがあって、それをインターフェイスに抽象化するときは、クラス名に接尾辞つけるだけ。</li>
<li>× インターフェイス定義だけ見ると冗長。</li>
<li>× 長い。</li>
</ul>

<h2>
<span id="-able接尾辞パターン" class="fragment"></span><a href="#-able%E6%8E%A5%E5%B0%BE%E8%BE%9E%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>-able接尾辞パターン</h2>

<p><code>-able</code> をインターフェイスの後ろにつけるパターンです。PHPの一部のインターフェイス(<a href="http://php.net/manual/ja/class.countable.php" rel="nofollow noopener" target="_blank">Countable</a>など）やJavaなど他の言語にも見られます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">Serializable</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">Serializable</span> <span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ 慣れればインターフェイスって分かりやすい。</li>
<li>○ インターフェイス＝能力と考えるとエレガント。</li>
<li>○ クラス名との関連が疎になるので、複数 implements する場合に馴染みやすい。</li>
<li>× -ableは原則的に動詞につける接尾辞なので語彙力が問われる。</li>
<li>× IDEなどのスペルチェック警告に引っかかりやすい。</li>
<li>× 英語の-ableの文法的生産性はさほど高くない。</li>
</ul>

<h2>
<span id="i--able接周辞パターン" class="fragment"></span><a href="#i--able%E6%8E%A5%E5%91%A8%E8%BE%9E%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>I--able接周辞パターン</h2>

<p>I-接頭辞パターンと-able接尾辞パターンを組み合わせたパターンです。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">ISerializable</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">ISerializable</span> <span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ これだけ冗長的であればクラスと見間違うまい。</li>
<li>☓ -ableパターンと同じ弱点がある。</li>
</ul>

<h2>
<span id="-ing接尾辞パターン" class="fragment"></span><a href="#-ing%E6%8E%A5%E5%B0%BE%E8%BE%9E%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>-ing接尾辞パターン</h2>

<p><code>-ing</code> をインターフェイスの後ろにつけるパターンです。Objective-C <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CodingGuidelines/Articles/NamingBasics.html#//apple_ref/doc/uid/20001281-1002242-BBCIJGDB" rel="nofollow noopener" target="_blank">Cococaの命名規則</a>などでみることができます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">Locking</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">Lock</span> <span class="k">implements</span> <span class="nx">Locking</span> <span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ 慣れればインターフェイスって分かりやすい。</li>
<li>○ クラス名との関連が疎になるので、複数 implements する場合に馴染みやすい。</li>
<li>○ 英語の-ingの文法的生産性は-ableより高い。</li>
<li>× -ingは原則的に動詞につける接尾辞なので語彙力が問われる。</li>
<li>× インターフェイス名は基本動詞という縛りができる。</li>
</ul>

<h2>
<span id="-implクラス接尾辞パターン" class="fragment"></span><a href="#-impl%E3%82%AF%E3%83%A9%E3%82%B9%E6%8E%A5%E5%B0%BE%E8%BE%9E%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>-Implクラス接尾辞パターン</h2>

<p>インターフェイス名には特別な接辞をつけず、そのインターフェイスを実装したクラスに <code>Impl</code> 接尾辞をつけるパターン。Javaなどで見られる。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">User</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">UserImpl</span> <span class="k">implements</span> <span class="nx">User</span> <span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ 抽象が先にあり、抽象に依存するイメージがあっていいかも。</li>
<li>× インターフェイスを実装したクラス全部にImplとつけるとごちゃごちゃしそう。</li>
<li>× Implという省略が好みじゃない。スペルチェックに引っかかりそう。</li>
</ul>

<h2>
<span id="interfaceネームスペースパターン" class="fragment"></span><a href="#interface%E3%83%8D%E3%83%BC%E3%83%A0%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>Interfaceネームスペースパターン</h2>

<p>インターフェイス用に特別なネームスペースを設けるパターンです。命名規則というよりは設計に関する部分かもしれません。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">Foo_Interface_User</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">Foo_Model_User</span> <span class="k">implements</span> <span class="nx">Foo_Interface_User</span> <span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ PSR-0に従えば、Interfaceフォルダにインターフェイスが集まる。</li>
<li>× <code>namespace</code> で <code>Interface</code> を使うと予約語にひっかかる。</li>
</ul>

<h2>
<span id="パスパターン" class="fragment"></span><a href="#%E3%83%91%E3%82%B9%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>パスパターン</h2>

<p>インターフェイスであることのヒントをネームスペースの階層で表現するパターンです。抽象はより浅いパスで表現され、実装はより深いパスで表現されます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">Foo_User</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">Foo_User_Admin</span> <span class="k">implements</span> <span class="nx">Foo_User</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">Foo_User_Visitor</span> <span class="k">implements</span> <span class="nx">Foo_User</span> <span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ 冗長的情報(-Interfaceや-able)をつけなくていい。</li>
<li>○ プロトタイプ的な発想が好き。</li>
<li>× 使う側でぱっと見インターフェイスと分かりにくい。</li>
<li>× 複数のインターフェイスを実装するケースには向かない。</li>
</ul>

<h2>
<span id="無印パターン" class="fragment"></span><a href="#%E7%84%A1%E5%8D%B0%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>無印パターン</h2>

<p>インターフェイス名やクラス名にインターフェイスかどうか判断する符号をつけないパターンです。インターフェイスに接辞をつけてはならない規約を設定しているプロジェクトもあるでしょう。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">FooBar</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">Baz</span> <span class="k">implements</span> <span class="nx">FooBar</span> <span class="p">{}</span>
</pre></div></div>

<ul>
<li>○ 臨機応変に名前をつけられる。</li>
<li>○ 冗長的情報(-Interfaceや-able)をつけなくていい。</li>
<li>× クラス名とかぶるとめんどくさい。</li>
<li>× インターフェイスを使う側のコード(type-hintingとかuseとかinstanceof)でインターフェイスって分かりにくい。</li>
</ul>

<h2>
<span id="おわり" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A"><i class="fa fa-link"></i></a>おわり</h2>

<p>さて、みなさんはどのパターンを使っていますか？他にも「こんなパターンもあるよ」というのがあれば教えてください！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />31位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>45</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/c6ccc1a23b334113579b">『Macで日本語ファイルをgitにコミットするのやめて&gt;&lt;』とりあずMacとLinuxで互換性のない日本語ファイルを探すスクリプト書いた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-11 18:33:26</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[PHP]</b> <b>[Mac]</b> <b>[Git]</b> <b>[unicode]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>最近携わっているPHPのプロジェクトでは、プログラムを日本語で書いています。クラス名・変数名はもちろんファイル名も日本語です。(なぜ日本語で書くことにしたのか、そこらへんのモチベーションについては別記事にまとめたい)</p>

<p>このプロジェクトは開発環境がMac、プロダクション環境がLinuxなのですが、日本語ファイル名のPHPがオートロードされないなどの問題が発生しました。しらべたところ、MacのファイルシステムとLinuxのファイルシステムでUnicodeの規格が違うのが原因でした。詳しくは、「<a href="http://www.sakito.com/2010/05/mac-os-x-normalization.html" rel="nofollow noopener" target="_blank">紹介マニアどらふと版: Mac OS X におけるファイル名に関するメモ(NFC, NFD等)</a>」の記事が参考になります。</p>

<p>簡単にファイルシステムの違いを説明すると、</p>

<p>Mac: NFDという規格。濁点半濁点などバラしている(正規化)。「だ」は「た」「゛」の6バイトになる<br>
Linux: NFCという規格。濁点半濁点をバラさない(非正規化)。「だ」は3バイトになる</p>

<p>という違いがあります。</p>

<p>Macで作ったNFDのファイルをgitにcommitすると、そのまま正規化された状態でステージされます。それを、Linuxでgit pullしたときに、NFDからNFCに変換してくれればいいのですが、NFDのままファイルが作られます。PHPのソースコードはNFCですから、ファイル名が決め打ちで参照されていると、「Macでは動いていたけど、Linuxで動かなくなった」という現象が発生するのです。</p>

<p>日本語ファイルをコミットされてしまったのはしょうがないので、ひとまず問題のあるファイルを洗い出すために、NFDのファイルを根こそぎ探しだすスクリプトをPythonで作りました。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ find-nfd -h
usage: find-nfd [-h] [path]

Find NFD files

positional arguments:
  path        path to find(Default: current working directory)

optional arguments:
  -h, --help  show this help message and exit
</pre></div></div>

<h2>
<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h2>

<div class="code-frame" data-lang="py">
<div class="code-lang"><span class="bold">find-nfd.py</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">unicodedata</span> <span class="kn">import</span> <span class="n">normalize</span>

<span class="k">def</span> <span class="nf">fild_all_files</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">root</span>
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">to_nfc</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf8"</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="s2">"NFC"</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf8"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>

<span class="k">def</span> <span class="nf">is_nfd</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">to_nfc</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="n">string</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">find_nfd_files</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">fild_all_files</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_nfd</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
            <span class="k">yield</span> <span class="nb">file</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">"Find NFD files"</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">"path"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"path to find(Default: current working directory)"</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">'?'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">find_nfd_files</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
        <span class="k">print</span> <span class="nb">file</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">print</span> <span class="s2">""</span>
    <span class="k">print</span> <span class="s2">"</span><span class="si">%u</span><span class="s2"> files found"</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>

<h2>
<span id="使ってみる" class="fragment"></span><a href="#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>使ってみる</h2>

<p>Macで作ったファイルです↓</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ php -r 'var_dump(glob("/tmp/test/1/*"));'
array(7) {
  [0] =&gt;
  string(13) "/tmp/test/1/a"
  [1] =&gt;
  string(13) "/tmp/test/1/b"
  [2] =&gt;
  string(17) "/tmp/test/1/schon"
  [3] =&gt;
  string(19) "/tmp/test/1/schön"
  [4] =&gt;
  string(30) "/tmp/test/1/한글"
  [5] =&gt;
  string(27) "/tmp/test/1/はひふへほ"
  [6] =&gt;
  string(42) "/tmp/test/1/ぱぴぷぺぽ"
}
</pre></div></div>

<p>見た目はNFDなのかNFCなのか全く区別がつきませんが、「はひふへほ」と「ぱぴぷぺぽ」でstringのバイト数が違うのがわかります。<br>
ドイツ語のウムラウトや、韓国語のハングルもNFDになっているのが分かります。</p>

<p>この中から、NFDのファイルを探してみます:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ find-nfd.py /tmp/test/1
/tmp/test/1/schön
/tmp/test/1/한글
/tmp/test/1/ぱぴぷぺぽ

3 files found
</pre></div></div>

<p>3つ見つかりました。</p>

<p>こういうファイルを見つけたら、Linux環境かWindows環境でリネームして、gitに入れなおすことになります。</p>

<p>「こんなめんどくさいこと毎回やるのか?」と言われそうですが、vagrantでDebian環境がたった5分でできあがるように開発の仕組み自体を変えています:)</p>

<p>Macとは言え、プロダクション環境ではないので、無駄なハマリを回避するには、プロダクション環境と全く同じ開発環境を作ることが大事ですね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />32位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>45</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/a171550c49de078e39fd">ドメイン駆動設計: Aggregate実装チェックシート</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-14 14:50:44</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[オブジェクト指向]</b> <b>[DDD]</b> <b>[ドメイン駆動設計]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ドメイン駆動設計でAggregate(集約)を実装するためのチェックシートです。</p>

<h2>
<span id="-トランザクション分析をしてトランザクションの単位でaggregateを実装しているか" class="fragment"></span><a href="#-%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E5%88%86%E6%9E%90%E3%82%92%E3%81%97%E3%81%A6%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B6%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8D%98%E4%BD%8D%E3%81%A7aggregate%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>□ トランザクション分析をしてトランザクションの単位でAggregateを実装しているか?</h2>

<p>単にツリー構造や分類学的にAggregateを作っているとしたら正しくない。</p>

<p>Entityを複数含むAggregateを作っている場合は、トランザクション分析していない可能性があるため、</p>

<p>ユースケースを確認しビジネス上のトランザクション分析を行う。</p>

<h2>
<span id="-aggregateの大きさは大き過ぎないか" class="fragment"></span><a href="#-aggregate%E3%81%AE%E5%A4%A7%E3%81%8D%E3%81%95%E3%81%AF%E5%A4%A7%E3%81%8D%E9%81%8E%E3%81%8E%E3%81%AA%E3%81%84%E3%81%8B"><i class="fa fa-link"></i></a>□ Aggregateの大きさは大き過ぎないか?</h2>

<p>もし、Aggregateが複数のEntityを含んでいる場合は、</p>

<p>EntityをValue Objectにすることができないか、</p>

<p>直接参照ではなくEntityをAggregate Rootに昇格しIDによって参照する設計にできないかを検討する余地がある。</p>

<h2>
<span id="-他のaggregateは直接参照ではなくidによって参照されているか" class="fragment"></span><a href="#-%E4%BB%96%E3%81%AEaggregate%E3%81%AF%E7%9B%B4%E6%8E%A5%E5%8F%82%E7%85%A7%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8Fid%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E5%8F%82%E7%85%A7%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>□ 他のAggregateは直接参照ではなく、IDによって参照されているか?</h2>

<p>もし、Aggregate が他のAggregateを直接参照している場合は、</p>

<p>IDを表現したValue ObjectをそのAggregateの代理として参照できないか検討する。</p>

<h2>
<span id="-複数のaggregateが同時に変更される場合にdomain-eventを使っているか" class="fragment"></span><a href="#-%E8%A4%87%E6%95%B0%E3%81%AEaggregate%E3%81%8C%E5%90%8C%E6%99%82%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%95%E3%82%8C%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%ABdomain-event%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>□ 複数のAggregateが同時に変更される場合にDomain Eventを使っているか?</h2>

<p>Application Serviceにて、ひとつのトランザクションで複数のAggregateを更新している場合は、</p>

<p>Domain Eventのパターンが利用できないか検討する。</p>

<h2>
<span id="-ひとつのentityをaggregate-rootとしてモデリングしているか" class="fragment"></span><a href="#-%E3%81%B2%E3%81%A8%E3%81%A4%E3%81%AEentity%E3%82%92aggregate-root%E3%81%A8%E3%81%97%E3%81%A6%E3%83%A2%E3%83%87%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>□ ひとつのEntityをAggregate Rootとしてモデリングしているか?</h2>

<p>どのEntityがAggregate Rootかを認識すること。</p>

<h2>
<span id="-そのaggregateはグローバル空間での一意なidを持っているか-uuidなど" class="fragment"></span><a href="#-%E3%81%9D%E3%81%AEaggregate%E3%81%AF%E3%82%B0%E3%83%AD%E3%83%BC%E3%83%90%E3%83%AB%E7%A9%BA%E9%96%93%E3%81%A7%E3%81%AE%E4%B8%80%E6%84%8F%E3%81%AAid%E3%82%92%E6%8C%81%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B-uuid%E3%81%AA%E3%81%A9"><i class="fa fa-link"></i></a>□ そのAggregateはグローバル空間での一意なIDを持っているか? UUIDなど。</h2>

<h2>
<span id="-aggregateの部品はentityではなくvalue-objectにできるかどうか検討したか" class="fragment"></span><a href="#-aggregate%E3%81%AE%E9%83%A8%E5%93%81%E3%81%AFentity%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8Fvalue-object%E3%81%AB%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E6%A4%9C%E8%A8%8E%E3%81%97%E3%81%9F%E3%81%8B"><i class="fa fa-link"></i></a>□ Aggregateの部品はEntityではなくValue Objectにできるかどうか検討したか?</h2>

<h2>
<span id="-クライアントには最低限の知識のみ提供されているか-tell-dont-ask原則のガイドラインに従っているか" class="fragment"></span><a href="#-%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%AB%E3%81%AF%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E7%9F%A5%E8%AD%98%E3%81%AE%E3%81%BF%E6%8F%90%E4%BE%9B%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B-tell-dont-ask%E5%8E%9F%E5%89%87%E3%81%AE%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E3%81%AB%E5%BE%93%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%8B"><i class="fa fa-link"></i></a>□ クライアントには最低限の知識のみ提供されているか? Tell, Don't Ask原則のガイドラインに従っているか?</h2>

<p>そのAggregateがテストしにくかったり、メンテナンスが難しいとしたら、</p>

<p>必要以上にクライアントに知識が漏洩している可能性がある。</p>

<p>Command(更新)とQuery(問い合わせ)の分別をつけ、</p>

<p>クライアントがCommandの条件分岐のためにQueryをしていないかチェックする。</p>

<h2>
<span id="-repositoryやdomain-serviceをaggregateにdependency-injectionしていないか" class="fragment"></span><a href="#-repository%E3%82%84domain-service%E3%82%92aggregate%E3%81%ABdependency-injection%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%81%8B"><i class="fa fa-link"></i></a>□ RepositoryやDomain ServiceをAggregateにDependency Injectionしていないか?</h2>

<p>Aggregateのオブジェクトは沢山つくられつため、DIは潜在的なパフォーマンスを損なう。</p>

<p>複数のAggregateに問い合わせる場合は、Application ServiceでそれぞれのRepositoryをコールしよう。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />33位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>45</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/fd996de8c5d58d95047d">データベーススキーマ変更の失敗しにくい管理方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-07-18 17:39:37</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[MySQL]</b> <b>[XOOPS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>プロジェクトの成長と付随して、データベースの構造は変化するものです。本番環境であればプロダクトのリリース時、開発環境であればコードベースからチェックアウトしてきた時などのタイミングで、データベースの構造を変化させなければなりません。</p>

<p>ここでは、複数人が携わるプロジェクトにて、失敗の少ないデータベーススキーマ変更の管理方法について紹介します。</p>

<p><br></p>

<div class="">
<strong>[2016-05-12 追記]</strong> この記事の内容は非常に古いものになっています。現在は「<a href="https://flywaydb.org/" rel="nofollow noopener" target="_blank">Flyway</a>」といったDBのマイグレーションのためのコマンドラインツールがあります。このツールは、この記事で紹介する方法やRuby on Railsのマイグレーションと似た仕組みを採用しています。この記事で紹介する手動な運用に取り入れる前に、是非Flywayを検討してみてください。</div>

<h2>
<span id="problems" class="fragment"></span><a href="#problems"><i class="fa fa-link"></i></a>Problems</h2>

<p>下記の問題のどれかに当てはまればこの記事はあなたにとって有用でしょう。</p>

<ul>
<li>私のプロジェクトでは、スキーマ更新がバージョン管理システムで管理されていません。</li>
<li>私のプロジェクトでは、スキーマ更新がモジュールごとに分散しています。</li>
<li>私のプロジェクトでは、どの環境にどのスキーマ更新を適用したか記録がありません。</li>
</ul>

<h3>
<span id="problem-1-スキーマ更新がバージョン管理システムで管理されていません" class="fragment"></span><a href="#problem-1-%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E6%9B%B4%E6%96%B0%E3%81%8C%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%A7%E7%AE%A1%E7%90%86%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%81%BE%E3%81%9B%E3%82%93"><i class="fa fa-link"></i></a>Problem 1: スキーマ更新がバージョン管理システムで管理されていません。</h3>

<blockquote>
<p>私のプロジェクトでは、各テーブルのスキーマ更新(ALETER クエリ), ビューやトリガー、プロシージャの作成クエリがバージョン管理システムで管理されていません。これらの更新情報は、テーブル定義書やプロジェクトwikiを参照する必要があります。</p>
</blockquote>

<p>このような問題を抱えるプロジェクトは、すぐさまスキーマ更新をSQLファイルにし、gitやsvnなどのバージョン管理システムで管理すべきです。</p>

<h3>
<span id="problem-2-スキーマ更新がモジュールごとに分散しています" class="fragment"></span><a href="#problem-2-%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E6%9B%B4%E6%96%B0%E3%81%8C%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%94%E3%81%A8%E3%81%AB%E5%88%86%E6%95%A3%E3%81%97%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>Problem 2: スキーマ更新がモジュールごとに分散しています。</h3>

<blockquote>
<p>私のプロジェクトでは、スキーマ更新はバージョン管理されています。しかし、それぞれの更新クエリは各モジュールに分散しています。サーバに適用するたびに、私は各モジュールに更新クエリが追加されていないか探しまわらなければなりません。</p>
</blockquote>

<p>更新クエリをバージョン管理しているとしたら良いことです。しかし、更新クエリは一箇所に集めたほうがいいです。管理が容易になります。一箇所に集約する場合は、更新クエリの時系列を把握できるように整理すべきです。</p>

<h3>
<span id="problem-3-どの環境にどのスキーマ更新を適用したか記録がありません" class="fragment"></span><a href="#problem-3-%E3%81%A9%E3%81%AE%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A9%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E6%9B%B4%E6%96%B0%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%81%8B%E8%A8%98%E9%8C%B2%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93"><i class="fa fa-link"></i></a>Problem 3: どの環境にどのスキーマ更新を適用したか記録がありません。</h3>

<blockquote>
<p>私のプロジェクトでは、本番環境、ステージング環境、開発環境がありますが、どのスキーマ更新をどの環境にどこまで適用したか記録がありません。</p>
</blockquote>

<p>どの環境にどのスキーマ更新を適用したかは必ず把握する必要があります。</p>

<blockquote>
<p>私のプロジェクトでは、どの環境にどのクエリを適用したか、どの環境にどのクエリを適用すべきかを、wikiなどのドキュメントで管理しています。しかし、そのドキュメントにはしばしば漏れや誤りがあります。</p>
</blockquote>

<p>更新クエリと更新記録は分散していないほうが望ましいです。更新クエリを一箇所に集約した上で、更新記録もそこに付随させます。そして、更新記録もバージョン管理システムで管理するようにします。</p>

<h2>
<span id="データベーススキーマを管理するベストプラクティス" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%82%92%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9"><i class="fa fa-link"></i></a>データベーススキーマを管理するベストプラクティス</h2>

<p>それでは、上記の問題に解決する管理方法を紹介します。</p>

<p>この管理方法は以下の小さなプロセスで構成されています。</p>

<ul>
<li>スキーマ更新はSQLにし、ファイルの形にします。</li>
<li>ファイルは一箇所に集めます。</li>
<li>どの環境にどこまで適用したか分かるようにトークン(しるし)をつけます。</li>
<li>ファイルとトークンはバージョン管理システムで管理します。</li>
</ul>

<h3>
<span id="スキーマ更新はsqlにしファイルの形にします" class="fragment"></span><a href="#%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E6%9B%B4%E6%96%B0%E3%81%AFsql%E3%81%AB%E3%81%97%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%BD%A2%E3%81%AB%E3%81%97%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>スキーマ更新はSQLにし、ファイルの形にします</h3>

<p>スキーマ更新は必ずSQLにし、ファイルの形で残すようにします。決して、伝言という形をとってはいけません。チャットやWikiは伝言の類になります。</p>

<p>ファイルはSQLサーバが理解できる形式で書かなければなりません。クエリは必ずセミコロン <code>;</code> で終了するように書きます。そうしなければ、複数のクエリをひとつのファイルに書いた時、SQLサーバは正しく理解できません。また、コメントは <code>--</code> や <code>/* */</code> で書かなければ当然パースエラーや予期しない挙動になります。</p>

<p>ファイル名は適切につけるようにします。<code>alter_user_table.sql</code> よりは <code>add_2_columns_to_user.sql</code> や <code>add_phone_and_address_to_user.sql</code> のほうがより分かりやすくなります。</p>

<h3>
<span id="ファイルは一箇所に集めます" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AF%E4%B8%80%E7%AE%87%E6%89%80%E3%81%AB%E9%9B%86%E3%82%81%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>ファイルは一箇所に集めます</h3>

<p>ファイルはプロジェクトのどこかに <code>sql</code> や <code>update_sql</code> といったフォルダを作り、そこに集約するようにします。</p>

<p>ファイルは時系列順でソートできるようにします。ソートのために特別なプログラムに頼る必要がないようにしましょう。、<code>yyyymmdd_hhmm_</code> のような日時情報をファイルの接頭辞します。こうすることで、 <code>ls</code> コマンドや Finder, Explorerといった基本的なツールだけでソートが可能になります。</p>

<h3>
<span id="どの環境にどこまで適用したか分かるようにトークンしるしをつけます" class="fragment"></span><a href="#%E3%81%A9%E3%81%AE%E7%92%B0%E5%A2%83%E3%81%AB%E3%81%A9%E3%81%93%E3%81%BE%E3%81%A7%E9%81%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%81%8B%E5%88%86%E3%81%8B%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%97%E3%82%8B%E3%81%97%E3%82%92%E3%81%A4%E3%81%91%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>どの環境にどこまで適用したか分かるようにトークン(しるし)をつけます</h3>

<p>どの環境にどこまで適用したか分かるように、トークンと言われる印をつけるようにします。トークンは 0 バイトのファイルで構いません。SQLファイル同様に、日時 <code>yyyymmdd_hhmm~</code> で始まるファイル名にします。この日時は、適用した日時と同じにします。分の後がチルダなのは、同じ日時のSQLファイルよりも必ず後に来るようにソートできるようにするためのTipsです。</p>

<p>ファイル名には、「どの環境のトークンか」を持たせるようにします。これはファイル名に環境名を含めるようにして対応します。例えば、production, staging, develop の3つの環境がある場合は <code>20120701_1021~production.apply_token</code>, <code>20120711_1432~staging.apply_token</code>, <code>20120718_0906~develop.apply_token</code> のようにします。 </p>

<p>また、開発者個人の環境についても <code>20120701_1021~alice_local.apply_token</code> のようにトークンを作ることが許されます。</p>

<h3>
<span id="ファイルとトークンはバージョン管理システムで管理します" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A8%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AF%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%A7%E7%AE%A1%E7%90%86%E3%81%97%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>ファイルとトークンはバージョン管理システムで管理します</h3>

<p>SQLファイルはgitやsvnなどのバージョン管理システム(VCS)で管理するようにします。1回でも適用されたSQLファイルを編集することは許可されません。時系列にそって適用すれば、時点がばらばらの環境でも必ず同じデータベーススキーマになるように保たなければなりません。特にVIEWやストアドプロシージャの更新ファイルは、もとのファイルを編集せずに、コピーし新しいSQLファイルとしてVCSに追加します。</p>

<p>トークンもVCSで管理します。トークンをVCSで管理すると、どこまで適用したかの記録をプロジェクトで共有することができます。たとえ、staging環境に更新クエリを適用する担当者が毎回変わったとして、このルールを守っていれば説明なしで、適切な更新クエリを選ぶことができます。</p>

<h2>
<span id="具体的な実践手順" class="fragment"></span><a href="#%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E5%AE%9F%E8%B7%B5%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>具体的な実践手順</h2>

<h3>
<span id="1-下準備" class="fragment"></span><a href="#1-%E4%B8%8B%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>1. 下準備</h3>

<h4>
<span id="11-バージョン管理システムを利用できるようにする" class="fragment"></span><a href="#11-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%92%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1.1 バージョン管理システムを利用できるようにする</h4>

<p>git や svn を利用できるように環境を構築してください。個人の判断でできない場合はプロジェクトリーダに相談してください。</p>

<p>バージョン管理システムにコミットする権限を、データベーススキーマを更新する可能性があるすべてのメンバーに与えてください。</p>

<h4>
<span id="12-sqlファイルを集約するためのフォルダを作る" class="fragment"></span><a href="#12-sql%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E9%9B%86%E7%B4%84%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>1.2 SQLファイルを集約するためのフォルダを作る</h4>

<p>プロジェクトのトップレベルに <code>sql</code> フォルダを作ります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir sql
</pre></div></div>

<h4>
<span id="13-環境ごとのトークンをつくる" class="fragment"></span><a href="#13-%E7%92%B0%E5%A2%83%E3%81%94%E3%81%A8%E3%81%AE%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B"><i class="fa fa-link"></i></a>1.3 環境ごとのトークンをつくる</h4>

<p>環境ごとのトークンをつくります。最初は日時を00000000_0000にします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ touch 00000000_0000~develop.apply_token
$ touch 00000000_0000~staging.apply_token
$ touch 00000000_0000~production.apply_token
</pre></div></div>

<p>作ったトークンはバージョン管理システムにコミットします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># git
$ git add *.apply_token
$ git commit
$ git push

# svn
$ svn add *.apply_token
$ svn commit
</pre></div></div>

<h3>
<span id="2-運用手順" class="fragment"></span><a href="#2-%E9%81%8B%E7%94%A8%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>2. 運用手順</h3>

<p>運用手順は 2.1 ~ 2.3 の繰り返しになります。</p>

<h4>
<span id="21-sqlファイルを作る" class="fragment"></span><a href="#21-sql%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>2.1 SQLファイルを作る</h4>

<p>sqlフォルダに行き、例えば 20120718_1727_add_birthday_to_user.sql を作ります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd sql
$ touch 20120718_1727_add_birthday_to_user.sql
</pre></div></div>

<p>20120718_1727_add_birthday_to_user.sql をエディタで開き、SQLを書き込みます。</p>

<h4>
<span id="22-バージョン管理システムに登録する" class="fragment"></span><a href="#22-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AB%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2.2 バージョン管理システムに登録する</h4>

<p>git や svn にSQLファイルをコミットします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># git
$ git add 20120718_1727_add_birthday_to_user.sql
$ git commit 20120718_1727_add_birthday_to_user.sql
$ git push

# svn
$ svn add 20120718_1727_add_birthday_to_user.sql
$ svn commit
</pre></div></div>

<h4>
<span id="23-環境に適用する" class="fragment"></span><a href="#23-%E7%92%B0%E5%A2%83%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>2.3 環境に適用する</h4>

<p>たとえば、develop環境に適用します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mysql -uroot -proot develop &lt; 20120718_1727_add_birthday_to_user.sql
</pre></div></div>

<p>適用したらトークンのファイル名を書き換えて、日時を適用日時に変更します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mv 00000000_0000~develop.apply_token 20120718_1811~develop.apply_token
</pre></div></div>

<p>トークンをバージョン管理システムに登録します。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>複数人が携わるプロジェクトにて、失敗の少ないデータベーススキーマ変更の管理方法について紹介しました。この方法を実践することで、よりシンプルで、より漏れや抜けのないデータベーススキーマ更新が行えるようになります。</p>

<p>また、この運用を支援するようなスクリプトを現在開発していますので、完成したら公開したいと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />34位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>44</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/68fa59a10c1ce1e84057">わたしたちがDDDを実践するに当たってDoctrineをやめようと決断した動機</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-19 00:43:53</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[doctrine]</b> <b>[DDD]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>断り書き:自分たちがやりたいDDDにDoctrineが必ずしも向いていないという判断をしたものです。Doctrineには非常にお世話になっており、批判するものではありません。どのツールにも適材適所があると思います。</p>

<ul>
<li><p>機械的なORMでエレガントに表現できないものがあった（ValueObjectなど）</p></li>
<li><p>Entityが1テーブルに固く対応していて、さらにその知識がインフラストラクチャレイヤからドメインレイヤに漏れ出していて、密結合が発生していた</p></li>
<li><p>Doctrineロックから脱出したい。Domain ServiceはRepositoryに依存しており、RepositoryはDoctrineに依存している。Doctrineが破滅への道を歩めば、アプリの心臓であるDomainも道連れとなる。</p></li>
<li><p>ストレージロックを脱出したい。ドメインレイヤがある具体的なRepositoryに依存していると、簡単にストレージを交換することができない。</p></li>
<li><p>インフラストラクチャレイヤはドメインレイヤに依存すべきと学んだ（ここが一番おおきな転換点）。普通の伝統的な設計では、下記図のような依存関係を作る。</p></li>
</ul>

<p><a href="https://camo.qiitausercontent.com/a18de761ba9c7800e09fe7b081ef2228fd368633/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303331392d73746f702d646f637472696e652f312e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a18de761ba9c7800e09fe7b081ef2228fd368633/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303331392d73746f702d646f637472696e652f312e6a7067" alt="" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130319-stop-doctrine/1.jpg"></a></p>

<p>このままでは、インフラレイヤの呪縛から逃れられない。<a href="http://www.amazon.co.jp/gp/product/0321834577?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=0321834577&amp;linkCode=shr&amp;tag=suinyeze-22&amp;=english-books&amp;qid=1363623102&amp;sr=1-1" rel="nofollow noopener" target="_blank">Implementing Domain-Driven-Design</a> では下記図のように、依存関係を逆転させること、Dependency Inversion Principle*1を実践することを強く提唱している。</p>

<p><a href="https://camo.qiitausercontent.com/4a5de692f0814d46340392657a0cb5b8cd6e02ef/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303331392d73746f702d646f637472696e652f322e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4a5de692f0814d46340392657a0cb5b8cd6e02ef/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303331392d73746f702d646f637472696e652f322e6a7067" alt="" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130319-stop-doctrine/2.jpg"></a></p>

<p>Doctrine ORMを使っている限り、ドメインはインフラに依存しつづけるので、Doctrine ORMはやめて、独自でRepositoryを作ることにした。</p>

<p>このアーキテクチャでは、初期工程でストレージについて一切議論しない。ストレージなんてMySQLだろうがMongoDBだろうがなんでもいい、そんつぁもん一番 後に決めればいいねっか！ポッペンディークも<a href="http://www.amazon.co.jp/gp/product/482228350X?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=482228350X&amp;linkCode=shr&amp;tag=suinyeze-22" rel="nofollow noopener" target="_blank">Lean Software Development</a>で「決定を遅らせる」ことはいいことだと言っている。</p>

<p>その代わり、最も重要なドメインを先に設計し、ドメインがインフラに対して必要とするインターフェイスを定義する。最後の工程で、インフラはそのインターフェイスにしたがって、必要なリソースを提供できるストレージを選択する。</p>

<hr>

<p>*1 Dependency Inversion Principle は、ロバート・C・マーチンが提唱している、セパレートインターフェイス[<a href="http://www.amazon.co.jp/gp/product/4798105538?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=4798105538&amp;linkCode=shr&amp;tag=suinyeze-22" rel="nofollow noopener" target="_blank">Fowler, PoEAA</a>]を使った依存関係の逆転を行う指針だ。同氏は他にも同様の指針を、SOLID (SRP, OCP, LSP, ISP, DIP)として定義している。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />35位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>43</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/1237f210ef9e81b6475d">Go言語:自分のライブラリをGitHubで公開する方法+drone.ioで継続的インテグレーション</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-08 18:15:24</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="この記事の目的" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>この記事の目的</h1>

<ul>
<li>Go言語でライブラリを作る</li>
<li>作ったライブラリをリモートリポジトリパッケージとしてGitHubで公開する</li>
<li>drone.ioで継続的インテグレーション(continuous integration 以下 CI)する</li>
</ul>

<h1>
<span id="go言語のパッケージ管理" class="fragment"></span><a href="#go%E8%A8%80%E8%AA%9E%E3%81%AE%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E7%AE%A1%E7%90%86"><i class="fa fa-link"></i></a>Go言語のパッケージ管理</h1>

<p>Go言語はパッケージ管理ツールが標準化されていて、依存するパッケージをGitHub上などから簡単にダウンロードすることができる。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">BDDスタイルでテストするライブラリをダウンロードする例</span></div>
<div class="highlight"><pre><span></span>go get github.com/r7kamura/gospel
</pre></div>
</div>

<h1>
<span id="ライブラリを作る" class="fragment"></span><a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>ライブラリを作る</h1>

<p>今回サンプルとして作るライブラリは、Hello Worldを返すというもの。パッケージ名は <code>gohelloworld</code> とする。</p>

<p>まずは、<code>gohelloworld</code> パッケージ用のディレクトリを好きな場所に作る:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir ~/Desktop/gohelloworld
cd ~/Desktop/gohelloworld/
</pre></div></div>

<p>ライブラリの実装を書くファイル <code>helloworld.go</code> を作る:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch helloworld.go
</pre></div></div>

<p>ちなみに、ファイルの名前はパッケージ名と同一でなくても良い。</p>

<p><code>HelloWorld</code> 関数を実装する:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">helloworld.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">gohelloworld</span>

<span class="kd">func</span> <span class="nx">HelloWorld</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Hello World"</span>
<span class="p">}</span>
</pre></div>
</div>

<p>パッケージ名はディレクトリ名と同じ <code>gohelloworld</code> にする。ここで作った <code>HelloWorld</code> 関数は依存するコードからは <code>gohelloworld.HelloWorld()</code> のようにパッケージ名を前につけて呼び出すようになる。</p>

<p>次に、<code>HelloWorld</code> 関数の単体テストを書くファイルを作る:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch helloworld_test.go
</pre></div></div>

<p>ファイル名は <code>_test.go</code> で終わるものであれば何でも構わない。</p>

<p>今回はBDD風にテストコードを書きたいので、<code>gospel</code>というライブラリを使う。使うためにはリモートリポジトリからライブラリを取ってきておく必要がある:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go get github.com/r7kamura/gospel
</pre></div></div>

<p>テストコードを記述する:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">helloworld_test.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">gohelloworld</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="p">.</span> <span class="s">"github.com/r7kamura/gospel"</span>
    <span class="s">"testing"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">TestDescribe</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Describe</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">"HelloWorld"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"call HelloWorld"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be 'Hello World'"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">HelloWorld</span><span class="p">()).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="s">"Hello World"</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></div>
</div>

<p>テストを実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go test
</pre></div></div>

<p>テスト実行結果:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>.PASS
ok      _/Users/suin/Desktop/gohelloworld       0.014s
</pre></div></div>

<h1>
<span id="github上でリポジトリを作る" class="fragment"></span><a href="#github%E4%B8%8A%E3%81%A7%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>GitHub上でリポジトリを作る</h1>

<p>上で作った <code>gohelloworld</code> ライブラリを公開するためのリポジトリをGitHubに作る。</p>

<p><a href="https://github.com/new" rel="nofollow noopener" target="_blank">GitHubの新規リポジトリ作成ページ</a>に行き、パッケージ名と同じ名前でリポジトリを作成する:</p>

<p><a href="https://camo.qiitausercontent.com/0f2b11103144dde87b922f5bdb70f2b2a3409fcf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63363264353536662d313063302d626137612d653939612d3332316162326533376364642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0f2b11103144dde87b922f5bdb70f2b2a3409fcf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63363264353536662d313063302d626137612d653939612d3332316162326533376364642e706e67" alt="Create_a_New_Repository-3.png" title="Create_a_New_Repository-3.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/c62d556f-10c0-ba7a-e99a-321ab2e37cdd.png"></a></p>

<p>リポジトリが作成されると、初期化のためのコマンドが表示されるので、それらを実行する:</p>

<p><a href="https://camo.qiitausercontent.com/ba5e4eaa7fdd04a012d6a721532f0ee2802cddd4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33366533316136312d643962662d386338322d386335372d3164383466373735666337632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ba5e4eaa7fdd04a012d6a721532f0ee2802cddd4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f33366533316136312d643962662d386338322d386335372d3164383466373735666337632e706e67" alt="suin_gohelloworld.png" title="suin_gohelloworld.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/36e31a61-d9bf-8c82-8c57-1d84f775fc7c.png"></a></p>

<p>最後に、<code>helloworld.go</code> と <code>helloworld_test.go</code> をコミットしてリモートリポジトリにpushしておく:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git add -A
git commit -m "add source code"
git push
</pre></div></div>

<p>これで <code>gohelloworld</code> パッケージがリモートパッケージとして利用できるようになる。</p>

<p>試しにリモートパッケージに依存するプロジェクトを作ってみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir ~/Desktop/other_go_project
cd ~/Desktop/other_go_project/
touch main.go
</pre></div></div>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">"github.com/suin/gohelloworld"</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">gohelloworld</span><span class="p">.</span><span class="nx">HelloWorld</span><span class="p">())</span>
<span class="p">}</span>

</pre></div>
</div>

<p>※ <code>suin</code> のところはご自分のアカウント名に書き換えてください</p>

<p>リモートパッケージをダウンロードする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go get github.com/suin/gohelloworld
</pre></div></div>

<p>※ <code>suin</code> のところはご自分のアカウント名に書き換えてください</p>

<p>実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run main.go
</pre></div></div>

<p>画面に <code>Hello World</code> と表示されていれば成功。</p>

<h1>
<span id="droneioでciする" class="fragment"></span><a href="#droneio%E3%81%A7ci%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>drone.ioでCIする</h1>

<p><a href="https://drone.io/" rel="nofollow noopener" target="_blank">drone.io</a>はCIをウェブサービスとして提供しており、簡単にGoのCI環境を利用することができる。</p>

<p>今回はdrone.ioを使ってGitHubにpushがあるたびに、単体テストが自動で実行されるようにする。</p>

<p>まずは、drone.ioにGitHubアカウントでログインする:</p>

<p><a href="https://camo.qiitausercontent.com/c74a7d827e0e4f80bc114c8bcff70d43991b08bc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36383535653535612d366461362d343366312d343934642d6366353465393038646363372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c74a7d827e0e4f80bc114c8bcff70d43991b08bc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36383535653535612d366461362d343366312d343934642d6366353465393038646363372e706e67" alt="Login___drone_io_continuous_integration.png" title="Login___drone_io_continuous_integration.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/6855e55a-6da6-43f1-494d-cf54e908dcc7.png"></a></p>

<p>「New Project」を開き、</p>

<p><a href="https://camo.qiitausercontent.com/4b80fc34b460ef4ce01c30d9ad3471d5d926201f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32636531343235302d663633362d366332392d383438652d6638663338383935616365352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4b80fc34b460ef4ce01c30d9ad3471d5d926201f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32636531343235302d663633362d366332392d383438652d6638663338383935616365352e706e67" alt="Dashboard___suin.png" title="Dashboard___suin.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/2ce14250-f636-6c29-848e-f8f38895ace5.png"></a></p>

<p>リポジトリの中から「GitHub」を選ぶ:</p>

<p><a href="https://camo.qiitausercontent.com/ed188a67e5102568cde128bcad177ba0a43d0825/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62336637393236352d363037392d623663642d643831622d3364333438373635626461662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ed188a67e5102568cde128bcad177ba0a43d0825/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62336637393236352d363037392d623663642d643831622d3364333438373635626461662e706e67" alt="Add_Repo___drone_io.png" title="Add_Repo___drone_io.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/b3f79265-6079-b6cd-d81b-3d348765bdaf.png"></a></p>

<p>GitHubのリポジトリの一覧が表示されるので、その中から <code>gohelloworld</code> の「Select」を押す:</p>

<p><a href="https://camo.qiitausercontent.com/2f585ec1f6d86921d626e254e6bc38439fe59ee8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61663735343432302d623331652d343137622d383562612d3938663062326336613738322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2f585ec1f6d86921d626e254e6bc38439fe59ee8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61663735343432302d623331652d343137622d383562612d3938663062326336613738322e706e67" alt="Add_Repo___drone_io-4.png" title="Add_Repo___drone_io-4.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/af754420-b31e-417b-85ba-98f0b2c6a782.png"></a></p>

<p>言語を選択する画面が出るので、「Go」を選ぶ:</p>

<p><a href="https://camo.qiitausercontent.com/58e0043748f3eca4f539aba577f9c0c9e5009cd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30346532623835612d373434322d333033662d336465362d6431373733643130383039652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/58e0043748f3eca4f539aba577f9c0c9e5009cd5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30346532623835612d373434322d333033662d336465362d6431373733643130383039652e706e67" alt="Add_Repo___drone_io-3.png" title="Add_Repo___drone_io-3.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/04e2b85a-7442-303f-3de6-d1773d10809e.png"></a></p>

<p>ビルドスクリプトの設定画面になるので、下記のスクリプトをフォームに入力し、「Save」を押すとプロジェクトのセットアップが完了となる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go get github.com/r7kamura/gospel
go test -short -cover
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/e9ef1fbf9547a954aa84f962d53b7a8275b2de1b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62653635343832352d356262302d646238392d633764312d3266663937626134383766342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e9ef1fbf9547a954aa84f962d53b7a8275b2de1b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62653635343832352d356262302d646238392d633764312d3266663937626134383766342e706e67" alt="Add_Repo___drone_io-7.png" title="Add_Repo___drone_io-7.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/be654825-5bb0-db89-c7d1-2ff97ba487f4.png"></a></p>

<p>初回のビルドは「Build Now」を押すとすぐに実行できる:</p>

<p><a href="https://camo.qiitausercontent.com/8b178cf5a951b7f48fe2447918af99d3602651b8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34323563636538372d636137302d663061662d643435342d6332386566636263383332612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/8b178cf5a951b7f48fe2447918af99d3602651b8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34323563636538372d636137302d663061662d643435342d6332386566636263383332612e706e67" alt="Build_Setup___gohelloworld.png" title="Build_Setup___gohelloworld.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/425cce87-ca70-f0af-d454-c28efcbc832a.png"></a></p>

<p>しばらく待つと結果が表示される:</p>

<p><a href="https://camo.qiitausercontent.com/e1964bcb078232c62765dd1dea566682886441bb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39333562636266652d653236322d383164382d373866332d3832613966316665396231332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e1964bcb078232c62765dd1dea566682886441bb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39333562636266652d653236322d383164382d373866332d3832613966316665396231332e706e67" alt="Build__1___gohelloworld.png" title="Build__1___gohelloworld.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/935bcbfe-e262-81d8-78f3-82a9f1fe9b13.png"></a></p>

<h2>
<span id="ビルドステータスバッジをgithubに載せる" class="fragment"></span><a href="#%E3%83%93%E3%83%AB%E3%83%89%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%83%90%E3%83%83%E3%82%B8%E3%82%92github%E3%81%AB%E8%BC%89%E3%81%9B%E3%82%8B"><i class="fa fa-link"></i></a>ビルドステータスバッジをGitHubに載せる</h2>

<p>ビルドがうまく行っているかどうかをGitHubで確認できるように、drone.ioのステータスバッジをREADMEに貼り付ける。</p>

<p>ステータスバッジのタグは「Setting」→「Status Budges」から得ることができる:</p>

<p><a href="https://camo.qiitausercontent.com/ab3891aaf42aeb46178420599df19d6ad12a0619/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38333132376234612d633737352d303262392d303732632d3335643734343464336361632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ab3891aaf42aeb46178420599df19d6ad12a0619/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38333132376234612d633737352d303262392d303732632d3335643734343464336361632e706e67" alt="Badges___gohelloworld-3.png" title="Badges___gohelloworld-3.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/83127b4a-c775-02b9-072c-35d7444d3cac.png"></a></p>

<p>README.mdにタグを貼り付ける:</p>

<div class="code-frame" data-lang="markdown">
<div class="code-lang"><span class="bold">README.md</span></div>
<div class="highlight"><pre><span></span># GoHelloWorld

[![Build Status](https://drone.io/github.com/suin/gohelloworld/status.png)](https://drone.io/github.com/suin/gohelloworld/latest)
</pre></div>
</div>

<p>GitHubにpushする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git add README.md
git commit -m "add drone.io status badge"
git push
</pre></div></div>

<p>GitHubを開いてみると、ステータスバッジが表示されている:</p>

<p><a href="https://camo.qiitausercontent.com/a54a872667d8a8ea67129426cccd2dc42df748cc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f31353437326239312d386331332d633532372d643364632d3931633930653135313433332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a54a872667d8a8ea67129426cccd2dc42df748cc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f31353437326239312d386331332d633532372d643364632d3931633930653135313433332e706e67" alt="suin_gohelloworld-2.png" title="suin_gohelloworld-2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/15472b91-8c13-c527-d3dc-91c90e151433.png"></a></p>

<p>ちなみに、今のコミットでdrone.io上ではビルドが自動で一度行われる:</p>

<p><a href="https://camo.qiitausercontent.com/2cd6d8e86d0476bdc2375f0331af9a2b1689ab8d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32363661633263332d343639642d393738382d633739322d6436663534323462323734662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2cd6d8e86d0476bdc2375f0331af9a2b1689ab8d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32363661633263332d343639642d393738382d633739322d6436663534323462323734662e706e67" alt="Builds___gohelloworld-2.png" title="Builds___gohelloworld-2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/266ac2c3-469d-9788-c792-d6f5424b274f.png"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />36位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>42</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/5e514e8edef7aba4a0fa">Scalaで列挙型(enum)を作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-20 19:13:39</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://xerial.org/scala-cookbook/recipes/2012/06/29/enumeration/" rel="nofollow noopener" target="_blank">ScalaのEnumerationは使うな - Scalaで列挙型を定義するには | Scala Cookbook</a>によると、Scalaで列挙型を定義するには <code>Enumeration</code> よりも case object を使ったほうが便利とのこと。</p>

<p>例: 出欠状況の列挙型の例</p>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="c1">// 列挙型をcase objectと継承を使って定義</span>
<span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">AttendingStatus</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Going</span> <span class="k">extends</span> <span class="nc">AttendingStatus</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">NotGoing</span> <span class="k">extends</span> <span class="nc">AttendingStatus</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Maybe</span> <span class="k">extends</span> <span class="nc">AttendingStatus</span>

<span class="k">var</span> <span class="n">attendingStatus</span><span class="k">:</span> <span class="kt">AttendingStatus</span> <span class="o">=</span> <span class="nc">Going</span>

<span class="c1">// case object だとマッチャーが使えて便利</span>
<span class="n">attendingStatus</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Going</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">"出席"</span><span class="o">)</span>
    <span class="k">case</span> <span class="nc">NotGoing</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">"欠席"</span><span class="o">)</span>
    <span class="k">case</span> <span class="nc">Maybe</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">"未定"</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div>

<p>出欠状況の選択肢を <code>Going</code>、<code>NotGoing</code>、<code>Maybe</code> の3種類だけに限定するために、下記の工夫をする。<br>
* <code>sealed</code> は同一ファイル内でのみ継承が可能にする。つまり、どこかで勝手に選択肢追加されることを防ぐ目的。<br>
* <code>abstract</code> は <code>AttendingStatus</code> 自体が選択肢のひとつになることを防ぐ目的。<br>
* <code>case class</code> ではなく <code>case object</code> にしているのは勝手な継承をさせないため。 (<code>sealed</code>だけではサブクラスの継承を防げない)</p>

<p>実際のコードでは、列挙型を使うクラスのコンパニオンオブジェクトの一部にしたほうが、整理されていていいと思う。</p>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="c1">// Attenderエンティティ</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Attender</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">status</span><span class="k">:</span> <span class="kt">Attender.Status</span> <span class="o">=</span> <span class="nc">Attender</span><span class="o">.</span><span class="nc">Status</span><span class="o">.</span><span class="nc">Maybe</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">attend</span> <span class="k">=</span> <span class="n">copy</span><span class="o">(</span><span class="n">status</span> <span class="k">=</span> <span class="nc">Attender</span><span class="o">.</span><span class="nc">Status</span><span class="o">.</span><span class="nc">Going</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">absent</span> <span class="k">=</span> <span class="n">copy</span><span class="o">(</span><span class="n">status</span> <span class="k">=</span> <span class="nc">Attender</span><span class="o">.</span><span class="nc">Status</span><span class="o">.</span><span class="nc">NotGoing</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Attender</span> <span class="o">{</span>
    <span class="c1">// 列挙型の定義はここ</span>
    <span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Status</span>
    <span class="k">object</span> <span class="nc">Status</span> <span class="o">{</span>
        <span class="k">case</span> <span class="k">object</span> <span class="nc">Going</span> <span class="k">extends</span> <span class="nc">Status</span>
        <span class="k">case</span> <span class="k">object</span> <span class="nc">NotGoing</span> <span class="k">extends</span> <span class="nc">Status</span>
        <span class="k">case</span> <span class="k">object</span> <span class="nc">Maybe</span> <span class="k">extends</span> <span class="nc">Status</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">attender</span> <span class="k">=</span> <span class="nc">Attender</span><span class="o">(</span><span class="s">"Hidehito Nozawa"</span><span class="o">)</span>

<span class="n">println</span><span class="o">(</span><span class="n">attender</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">attender</span><span class="o">.</span><span class="n">attend</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">attender</span><span class="o">.</span><span class="n">absent</span><span class="o">)</span>
</pre></div></div>

<p>実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Attender(Hidehito Nozawa,Maybe)
Attender(Hidehito Nozawa,Going)
Attender(Hidehito Nozawa,NotGoing)
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />37位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>42</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/7ddfcbc708c8863ea76a">Go言語のクロスコンパイル設定値 $GOOS, $GOARCH 一覧リスト</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-11 15:14:03</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>忘れやすいのでメモ。最新情報は公式ドキュメント <a href="http://golang.org/doc/install/source#environment" rel="nofollow noopener" target="_blank">Optional environment variables</a> を。</p>

<table>
<thead>
<tr>
<th>$GOOS</th>
<th>$GOARCH</th>
<th>メモ</th>
</tr>
</thead>
<tbody>
<tr>
<td>darwin</td>
<td>386</td>
<td>Mac OS X 10.6~</td>
</tr>
<tr>
<td>darwin</td>
<td>amd64</td>
<td>Mac OS X 10.6~</td>
</tr>
<tr>
<td>freebsd</td>
<td>386</td>
<td></td>
</tr>
<tr>
<td>freebsd</td>
<td>amd64</td>
<td></td>
</tr>
<tr>
<td>freebsd</td>
<td>arm</td>
<td></td>
</tr>
<tr>
<td>linux</td>
<td>386</td>
<td></td>
</tr>
<tr>
<td>linux</td>
<td>amd64</td>
<td></td>
</tr>
<tr>
<td>linux</td>
<td>arm</td>
<td></td>
</tr>
<tr>
<td>netbsd</td>
<td>386</td>
<td></td>
</tr>
<tr>
<td>netbsd</td>
<td>amd64</td>
<td></td>
</tr>
<tr>
<td>netbsd</td>
<td>arm</td>
<td></td>
</tr>
<tr>
<td>openbsd</td>
<td>386</td>
<td></td>
</tr>
<tr>
<td>openbsd</td>
<td>amd64</td>
<td></td>
</tr>
<tr>
<td>plan9</td>
<td>386</td>
<td></td>
</tr>
<tr>
<td>plan9</td>
<td>amd64</td>
<td></td>
</tr>
<tr>
<td>windows</td>
<td>386</td>
<td></td>
</tr>
<tr>
<td>windows</td>
<td>amd64</td>
<td></td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>$GOARCH</th>
<th>メモ</th>
</tr>
</thead>
<tbody>
<tr>
<td>amd64</td>
<td>64-bit x86</td>
</tr>
<tr>
<td>386</td>
<td>32-bit x86</td>
</tr>
<tr>
<td>arm</td>
<td>32-bit ARM</td>
</tr>
</tbody>
</table>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />38位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>40</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/76174e5b10477787ac26">Qiitaの記事タイトルに隠された秘密のルール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-13 15:44:24</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="">2016/03/18追記: この仕様は現時点で無くなっているようです。</div>

<p>まずは、2つの記事のスクリーンショットをご覧ください。</p>

<p><br></p>

<p>この2つには、ある違いがあります。さて、何でしょうか?</p>

<p><br></p>

<table>
<thead>
<tr>
<th>スクリーンショット1</th>
<th>スクリーンショット2</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://camo.qiitausercontent.com/6bd5067dd032aacbc0304b3713671da1b9b4afb3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37353533303335342d613962382d663663652d643561652d3663373536633663623530352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/6bd5067dd032aacbc0304b3713671da1b9b4afb3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37353533303335342d613962382d663663652d643561652d3663373536633663623530352e706e67" alt="" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/75530354-a9b8-f6ce-d5ae-6c756c6cb505.png"></a></td>
<td><a href="https://camo.qiitausercontent.com/c3cde12c7620e6d45427081de67273f58a417752/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30613164646437652d663365622d366463382d666336392d3961643738623866666339392e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c3cde12c7620e6d45427081de67273f58a417752/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f30613164646437652d663365622d366463382d666336392d3961643738623866666339392e706e67" alt="" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/0a1ddd7e-f3eb-6dc8-fc69-9ad78b8ffc99.png"></a></td>
</tr>
</tbody>
</table>

<p><br><br><br><br></p>

<p>違いに気づいたでしょうか? 記事のタイトルが「Scala」と「スカラ」で違うとか、URLが違うのはもちろんですが、<code>&lt;title&gt;</code> タグの内容が違っています。つまり、ブラウザのタイトルバーの内容が異なっているのです。</p>

<p><a href="https://camo.qiitausercontent.com/bb43baebc7a92c56ffa2a3bff8f186efbdccf527/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32626335633561612d353536382d636230302d386537662d3666666237636363363235312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/bb43baebc7a92c56ffa2a3bff8f186efbdccf527/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32626335633561612d353536382d636230302d386537662d3666666237636363363235312e706e67" alt="Scalaについての記事_-_Qiita.png" title="Scalaについての記事_-_Qiita.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/2bc5c5aa-5568-cb00-8e7f-6ffb7ccc6251.png"></a><br>
<a href="https://camo.qiitausercontent.com/4647567117b3a5bdc7f94425b04490efa54c62cd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62353535383661312d316464332d383838392d316539342d3563663630633061376235312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4647567117b3a5bdc7f94425b04490efa54c62cd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62353535383661312d316464332d383838392d316539342d3563663630633061376235312e706e67" alt="Scala_-_スカラについての記事_-_Qiita.png" title="Scala_-_スカラについての記事_-_Qiita.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/b55586a1-1dd3-8889-1e94-5cf60c0a7b51.png"></a></p>

<p>スクリーンショット1のほうは「Scalaについての記事 - Qiita」になっていますが、スクリーンショット2では「Scala - スカラについての記事 - Qiita」になっています。</p>

<h2>
<span id="違いを決めているのは何か" class="fragment"></span><a href="#%E9%81%95%E3%81%84%E3%82%92%E6%B1%BA%E3%82%81%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%AF%E4%BD%95%E3%81%8B"><i class="fa fa-link"></i></a>違いを決めているのは何か?</h2>

<p>このような違いが出るのはどうしてでしょうか? いくつかQiita上の記事を見て検証したところ、 <strong>タグと同じ文字列が記事に含まれていない場合、タグを自動的にタイトルに含める</strong> というルールがあるようです。</p>

<p>先のスクリーンショット2では、「Scala」タグがついていますが、記事タイトルには「Scala」が入っていません。そのため、タイトルに「Scala」が補完されています。一方、スクリーンショット1のほうは記事タイトルに「Scala」が入っているため、タグの補完はされていません。</p>

<h2>
<span id="複数タグがある場合はどうなのか" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%82%BF%E3%82%B0%E3%81%8C%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AF%E3%81%A9%E3%81%86%E3%81%AA%E3%81%AE%E3%81%8B"><i class="fa fa-link"></i></a>複数タグがある場合はどうなのか?</h2>

<p>「JavaScriptについての記事」という記事名で「HTML」と「JavaScript」のタグ2つをつけて実験してみました。2つの違いはタグの並びが「HTML、JavaScript」の順か、その逆かです。</p>

<table>
<thead>
<tr>
<th>タグの順序: HTML, JavaScript</th>
<th>タグの順序: JavaScript, HTML</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://camo.qiitausercontent.com/722dfefe0e134a9d72ee8ef748b963cbb18c993c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64323234623561332d343731372d633834342d346336642d6536316263313934613233662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/722dfefe0e134a9d72ee8ef748b963cbb18c993c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64323234623561332d343731372d633834342d346336642d6536316263313934613233662e706e67" alt="" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/d224b5a3-4717-c844-4c6d-e61bc194a23f.png"></a></td>
<td><a href="https://camo.qiitausercontent.com/e7e38f3d320b14ca34ff374a080dd04a25f8773d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35366565613661382d343936612d303739662d393933352d3666646138353132343466632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e7e38f3d320b14ca34ff374a080dd04a25f8773d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35366565613661382d343936612d303739662d393933352d3666646138353132343466632e706e67" alt="" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/56eea6a8-496a-079f-9935-6fda851244fc.png"></a></td>
</tr>
</tbody>
</table>

<p>タグの順序が「HTML, JavaScript」の記事は、タイトルにHTMLが補完されました。この振る舞いから、 <strong>一番最初のタグが記事タイトルに含まれているか</strong> という基準でタイトルにタグ補完が起こるようです。</p>

<h2>
<span id="記事タイトル生成ルールまとめ" class="fragment"></span><a href="#%E8%A8%98%E4%BA%8B%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E7%94%9F%E6%88%90%E3%83%AB%E3%83%BC%E3%83%AB%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>記事タイトル生成ルールまとめ</h2>

<p>以上をまとめると記事タイトル生成ルールはこのようになります:</p>

<ul>
<li>最初のタグが記事タイトルに含まれるか?</li>
<li>YES → 記事タイトル + Qiita</li>
<li>NO → 最初のタグ + 記事タイトル + Qiita</li>
</ul>

<p>個人的な使い方かもしれませんが、Qiitaに投稿したスニペットなどを検索するときにGoogleで「qiita &lt;言語&gt; &lt;探したい記事&gt;」などで検索することがあります。普段からQiita記事タイトル生成ルールを踏まえて記事タイトルを考えておけば、後で検索するときにすぐに見つかっていいかもしれませんね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />39位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>39</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/83b93e98a5503b4e0460">Scala: sbtでステップ実行できるようにする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-05 16:51:19</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> <b>[IntelliJ]</b> <b>[sbt]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>sbtでステップ実行するには、主に以下の準備をしておく</p>

<ul>
<li>sbt でjvm-debugのポートを指定して起動する</li>
<li>IntelliJで実行設定をしておく</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>./sbt -jvm-debug 5005
</pre></div></div>

<p>※ 普通のsbtでは-jvm-debugオプションが無いので、 <a href="https://github.com/sbt/sbt-launcher-package" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/sbt/sbt-launcher-package</a> を代わりに使う</p>

<p>IntelliJ側の設定</p>

<p>"Run" -&gt; "Edit Configuration" で下記の設定をしておく</p>

<p><a href="https://camo.qiitausercontent.com/d2f706cbf69deebc91f2e47cf58a74c249140596/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63656539653630612d313466332d316335332d353431662d3631643530343030616632652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/d2f706cbf69deebc91f2e47cf58a74c249140596/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63656539653630612d313466332d316335332d353431662d3631643530343030616632652e706e67" alt="Run_Debug_Configurations.png" title="Run_Debug_Configurations.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/cee9e60a-14f3-1c53-541f-61d50400af2e.png"></a></p>

<p>あとはブレークポイントをしこんで、虫のアイコンをクリックして、sbtのデバッグサーバにつないでsbtでrunするといい</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />40位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>39</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/3b513fffc300452b4e9e">redis.confの設定をしてみる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-08-08 14:33:50</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Redis]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>当方環境</p>

<ul>
<li>MacOSX 10.8</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ redis-server --version
Redis server version 2.4.11 (00000000:0)
</pre></div></div>

<hr>

<p>まずサービスとして起動したいのでデーモン化をyesにする</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>daemonize yes
</pre></div></div>

<p>デーモン化するのでプロセスIDを記録するファイルを指定する（デフォルトのままにした）</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pidfile /usr/local/var/run/redis.pid
</pre></div></div>

<p>ポートもデフォルト</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>port 6379
</pre></div></div>

<p>インターフェイスもローカルでしか使わないのでデフォルト</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>bind 127.0.0.1
</pre></div></div>

<p>タイムアウトは30秒くらいにセット</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>timeout 30
</pre></div></div>

<p>ログレベルはデフォルト</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>loglevel verbose
</pre></div></div>

<p>ログファイル</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>logfile /usr/local/var/log/redis.log
</pre></div></div>

<p>スナップショット間隔は特に基準がないけれど、10分間に1度でもキー変更があったら保存するようにしてみる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>save 600 1
# save 900 1
# save 300 10
# save 60 10000
</pre></div></div>

<p>CPUを節約する必要もないけど、容量もそんなでないからどちらでもいいんだけどとりあえず、DBファイルは圧縮有効</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>rdbcompression yes
</pre></div></div>

<p>ファイル名もデフォルト</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>dbfilename dump.rdb
</pre></div></div>

<p>ワーキングディレクトリ</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>dir /usr/local/var/db/redis/
</pre></div></div>

<p>開発環境なのでレプリケーションとセキュリティは飛ばす。</p>

<p>基本的に消えると困るデータなので <code>maxmemory</code> はセットしない。</p>

<hr>

<p>Macでデーモン化するには更に、plistを作らないといけない</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cp /usr/local/Cellar/redis/2.4.8/homebrew.mxcl.redis.plist ~/Library/LaunchAgents/
$ launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.redis.plist
$ launchctl start homebrew.mxcl.redis
$ ps aux | grep redis
jacknagel 85683   1.3  0.0   608696    856   ??  S     3:09PM   0:00.01 /usr/local/bin/redis-server /usr/local/etc/redis.conf
jacknagel 85685   0.0  0.0   614936      0 s000  R+    3:09PM   0:00.00 grep redis
$ launchctl stop homebrew.mxcl.redis
$ ps aux | grep redis
jacknagel 85735   0.0  0.0   590604      4 s000  S+    3:09PM   0:00.00 grep redis
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />41位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>39</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/e9597e43821f84cb180d">Node.jsからPHPのプロセスを呼び出す - JSONでやりとり編</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-01-25 22:09:13</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[JavaScript]</b> <b>[Node.js]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="nodejs側の実装" class="fragment"></span><a href="#nodejs%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>node.js側の実装</h1>

<p>Node.jsのAPIだけでやってます。<br>
PHPをコマンドラインで呼び出します。</p>

<div class="code-frame" data-lang="js">
<div class="code-lang"><span class="bold">icallyou.js</span></div>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">util</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'util'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">spawn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'child_process'</span><span class="p">).</span><span class="nx">spawn</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">php</span>   <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="s1">'php'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'callme.php'</span><span class="p">]);</span> <span class="c1">// $ php callme.php と同じ意味</span>

<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'foo'</span><span class="o">:</span> <span class="s1">'something'</span><span class="p">,</span>
    <span class="s1">'bar'</span><span class="o">:</span> <span class="s1">'something'</span><span class="p">,</span>
<span class="p">};</span>

<span class="nx">php</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span> <span class="c1">// 標準入力としてPHPに渡す</span>
<span class="nx">php</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span> <span class="c1">// PHPさん、標準入力終わったよ</span>

<span class="nx">php</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'stdout: '</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">php</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'stderr: '</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">php</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'exit'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'phpプロセスが終了しました: ステータスコード: '</span> <span class="o">+</span> <span class="nx">code</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ↓エラーなパターン</span>

<span class="kd">var</span> <span class="nx">php2</span>   <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="s1">'php'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'callme.php'</span><span class="p">]);</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="s1">'なんか変なデータ'</span><span class="p">;</span>

<span class="nx">php2</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="nx">php2</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>

<span class="nx">php2</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'stdout: '</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">php2</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'stderr: '</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">php2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'exit'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'php2プロセスが終了しました: ステータスコード: '</span> <span class="o">+</span> <span class="nx">code</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>

<h1>
<span id="php側の実装" class="fragment"></span><a href="#php%E5%81%B4%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>PHP側の実装</h1>

<p>php://stdinで標準入力を取得できます。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">callme.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$stdin</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">'php://stdin'</span><span class="p">);</span>

<span class="nv">$data</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$stdin</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">// var_dump($data);</span>

<span class="k">if</span> <span class="p">(</span> <span class="nb">is_array</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'status'</span>  <span class="o">=&gt;</span> <span class="s1">'error'</span><span class="p">,</span>
        <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'フォーマットに誤りがあります。JSONの配列で送ってこいｺﾞﾙｧ'</span><span class="p">,</span>
    <span class="p">));</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">'status'</span>  <span class="o">=&gt;</span> <span class="s1">'success'</span><span class="p">,</span>
        <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'OKです'</span><span class="p">,</span>
    <span class="p">));</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>

<h1>
<span id="実行してみる" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>実行してみる</h1>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ node icallyou.js 
stdout:  <span class="o">{</span> status: <span class="s1">'success'</span>, message: <span class="s1">'OKです'</span> <span class="o">}</span>
stdout:  <span class="o">{</span> status: <span class="s1">'error'</span>,
  message: <span class="s1">'フォーマットに誤りがあります。JSONの配列で送ってこいｺﾞﾙｧ'</span> <span class="o">}</span>
phpプロセスが終了しました: ステータスコード: <span class="m">0</span>
php2プロセスが終了しました: ステータスコード: <span class="m">1</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />42位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>39</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/3ada90eaf2e808e510b8">MySQLのUNIONの便利な使い道 </a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-01-25 12:11:37</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[MySQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="mysql"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">news</span> <span class="p">(</span>
    <span class="n">title</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">category</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="kt">date</span> <span class="kt">DATE</span>
<span class="p">);</span>
</pre></div></div>

<div class="code-frame" data-lang="mysql"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">news</span> 
<span class="k">VALUES</span> 
    <span class="p">(</span><span class="s1">'政治ニュース1'</span><span class="p">,</span> <span class="s1">'seiji'</span><span class="p">,</span> <span class="s1">'2012-01-21'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'政治ニュース2'</span><span class="p">,</span> <span class="s1">'seiji'</span><span class="p">,</span> <span class="s1">'2012-01-22'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'政治ニュース3'</span><span class="p">,</span> <span class="s1">'seiji'</span><span class="p">,</span> <span class="s1">'2012-01-23'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'経済ニュース1'</span><span class="p">,</span> <span class="s1">'keizai'</span><span class="p">,</span> <span class="s1">'2012-01-21'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'経済ニュース2'</span><span class="p">,</span> <span class="s1">'keizai'</span><span class="p">,</span> <span class="s1">'2012-01-22'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'経済ニュース3'</span><span class="p">,</span> <span class="s1">'keizai'</span><span class="p">,</span> <span class="s1">'2012-01-23'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'エンタメニュース1'</span><span class="p">,</span> <span class="s1">'entame'</span><span class="p">,</span> <span class="s1">'2012-01-21'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'エンタメニュース2'</span><span class="p">,</span> <span class="s1">'entame'</span><span class="p">,</span> <span class="s1">'2012-01-22'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'エンタメニュース3'</span><span class="p">,</span> <span class="s1">'entame'</span><span class="p">,</span> <span class="s1">'2012-01-23'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'コラム1'</span><span class="p">,</span> <span class="s1">'koramu'</span><span class="p">,</span> <span class="s1">'2012-01-23'</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">'コラム2'</span><span class="p">,</span> <span class="s1">'koramu'</span><span class="p">,</span> <span class="s1">'2012-01-24'</span><span class="p">);</span>
</pre></div></div>

<p>上記のデータに対して「最新ニュースを5件表示したい」という要望があったとする。<br>
その場合、単純に次のクエリになる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql&gt; SELECT * FROM news ORDER BY date DESC LIMIT 5;
+---------------------------+----------+------------+
| title                     | category | date       |
+---------------------------+----------+------------+
| コラム2                   | koramu   | 2012-01-24 |
| コラム1                   | koramu   | 2012-01-23 |
| エンタメニュース3         | entame   | 2012-01-23 |
| 経済ニュース3             | keizai   | 2012-01-23 |
| 政治ニュース3             | seiji    | 2012-01-23 |
+---------------------------+----------+------------+
</pre></div></div>

<p>さらに、追加要件として「コラムは最新1件を必ず表示する」があったとする。<br>
そして、いやらしくも「時系列順に表示されること」という内容。</p>

<p>この処理をやろうとすると、PHPで別々のクエリを発行してあとでマージ＆ソート、<br>
なんていうことになりそうだけど、UNIONを使うと簡単に取れる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mysql&gt; (SELECT * FROM news WHERE category != 'koramu' ORDER BY date DESC LIMIT 4)
    -&gt; UNION
    -&gt; (SELECT * FROM news WHERE category = 'koramu' ORDER BY date DESC LIMIT 1)
    -&gt; ORDER BY date DESC;
+---------------------------+----------+------------+
| title                     | category | date       |
+---------------------------+----------+------------+
| コラム2                   | koramu   | 2012-01-24 |
| 政治ニュース3             | seiji    | 2012-01-23 |
| エンタメニュース3         | entame   | 2012-01-23 |
| 経済ニュース3             | keizai   | 2012-01-23 |
| 経済ニュース2             | keizai   | 2012-01-22 |
+---------------------------+----------+------------+
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />43位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>39</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/2100dc48ec93df58ebf9">ディレクトリは755 ファイルは644 一括権限更新シェル</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-01-23 13:07:59</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>よく忘れるのでメモ</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>find /path/to/dir -type d -print | xargs chmod 755
find /path/to/dir -type f -print | xargs chmod 644
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />44位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>37</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/d4428e65a2cc1d956581">Linuxで1日あたりのデータ送受信量を算出する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-19 18:56:30</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[CentOS]</b> <b>[Ubuntu]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="1-今までに送受信したバイト数を求める" class="fragment"></span><a href="#1-%E4%BB%8A%E3%81%BE%E3%81%A7%E3%81%AB%E9%80%81%E5%8F%97%E4%BF%A1%E3%81%97%E3%81%9F%E3%83%90%E3%82%A4%E3%83%88%E6%95%B0%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>1. 今までに送受信したバイト数を求める</h2>

<p><code>ifconfig</code> コマンドで調べる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>ifconfig eth0
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>eth0      Link encap:Ethernet  HWaddr **:**:**:**:**:**  
          inet addr:***.***.***.***  Bcast:***.***.***.***  Mask:255.255.255.0
          inet6 addr: ****::****:****:****:****/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:52041393515 errors:0 dropped:0 overruns:0 frame:0
          TX packets:43058710548 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:7319618510115 (7.3 TB)  TX bytes:50480592202458 (50.4 TB)
          Interrupt:20 
</pre></div></div>

<p>ここの <code>RX bytes:7319618510115 (7.3 TB)</code> がOSを起動してから受信した合計バイト数、 <code>TX bytes:50480592202458 (50.4 TB)</code> がOSが起動してから送信した合計バイト数。</p>

<h2>
<span id="2-osが起動してからの経過時間を調べる" class="fragment"></span><a href="#2-os%E3%81%8C%E8%B5%B7%E5%8B%95%E3%81%97%E3%81%A6%E3%81%8B%E3%82%89%E3%81%AE%E7%B5%8C%E9%81%8E%E6%99%82%E9%96%93%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>2. OSが起動してからの経過時間を調べる</h2>

<p><code>uptime</code> コマンドで調べる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>uptime
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span> 18:14:30 up 292 days, 18:25,  2 users,  load average: 0.36, 0.34, 0.33
</pre></div></div>

<p>ここの <code>292 days</code> が経過日数。</p>

<h2>
<span id="3-送受信量を経過日数で割る" class="fragment"></span><a href="#3-%E9%80%81%E5%8F%97%E4%BF%A1%E9%87%8F%E3%82%92%E7%B5%8C%E9%81%8E%E6%97%A5%E6%95%B0%E3%81%A7%E5%89%B2%E3%82%8B"><i class="fa fa-link"></i></a>3. 送受信量を経過日数で割る</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>受信: 7.3 TB / 292 = 25.6 GB日
送信: 50.4 TB / 292 = 176.7 GB日
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />45位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>37</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/f44b9ee388668fd277a6">Qiita Widget : Qiitaの投稿を表示できるブログパーツ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-10-13 17:54:27</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Qiitaの新着投稿をウェブサイトに埋め込むことができるウィジェットです。自分のブログなどのウェブサイトにQiitaの活動を載せたり、Qiita:Teamに特定のタグのタイムラインを表示したりできます。</p>

<p><a href="https://camo.qiitausercontent.com/21eb20aa42b3615befc738675872292695f54a82/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39643738313237622d626232342d396532372d396161372d6239616531356266626639642e706e67" target="_blank" rel="nofollow noopener"><img width="1126" alt="Qiita_Widget_Demo.png" src="https://camo.qiitausercontent.com/21eb20aa42b3615befc738675872292695f54a82/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f39643738313237622d626232342d396532372d396161372d6239616531356266626639642e706e67" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/9d78127b-bb24-9e27-9aa7-b9ae15bfbf9d.png"></a></p>

<p><em>図:左はユーザ投稿の、右はRubyタグのタイムライン</em></p>

<p><a href="https://qiita-widget.suin.io/" rel="nofollow noopener" target="_blank">Qiita Widgetの動作するデモはこちら</a></p>

<h2>
<span id="ウィジェットの設置方法" class="fragment"></span><a href="#%E3%82%A6%E3%82%A3%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88%E3%81%AE%E8%A8%AD%E7%BD%AE%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>ウィジェットの設置方法</h2>

<p>下記のコードの<code>your_name</code>の部分を表示したいユーザ名に置換えてお使いください。</p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://qiita.com/your_name"</span> <span class="na">data-qiita-widget</span> <span class="na">data-username</span><span class="o">=</span><span class="s">"your_name"</span><span class="p">&gt;</span>suinのQiita投稿<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://qiita-widget.suin.io/widget.js"</span> <span class="na">defer</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div></div>

<h3>
<span id="ウィジェットのカスタマイズ" class="fragment"></span><a href="#%E3%82%A6%E3%82%A3%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>ウィジェットのカスタマイズ</h3>

<p><code>data-*</code>属性を設定することで、ウィジェットの表示をカスタマイズできます。</p>

<h4>
<span id="コンテンツのカスタマイズ" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>コンテンツのカスタマイズ</h4>

<p>表示するコンテンツは「ユーザ投稿」「タグへの投稿」「キーワード検索結果」のいずれかを選択することができます。</p>

<table>
<thead>
<tr>
<th>属性</th>
<th>値</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data-username="ユーザ名"</code></td>
<td>ユーザ名: <code>string</code>
</td>
<td>ユーザの新着投稿が表示される</td>
</tr>
<tr>
<td><code>data-tag="タグ"</code></td>
<td>タグ: <code>string</code>
</td>
<td>タグへの新着投稿が表示される</td>
</tr>
<tr>
<td><code>data-search="キーワード"</code></td>
<td>キーワード: <code>string</code>
</td>
<td>検索キーワードに合致する新着投稿が表示される</td>
</tr>
</tbody>
</table>

<h4>
<span id="見た目のカスタマイズ" class="fragment"></span><a href="#%E8%A6%8B%E3%81%9F%E7%9B%AE%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA"><i class="fa fa-link"></i></a>見た目のカスタマイズ</h4>

<p>ウィジェットの大きさや表示件数といった見た目をカスタマイズすることができます。</p>

<table>
<thead>
<tr>
<th>属性</th>
<th>値</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data-items</code></td>
<td>表示件数: <code>int</code>
</td>
<td>表示する投稿数</td>
</tr>
<tr>
<td><code>data-width</code></td>
<td>幅: <code>string</code>
</td>
<td>ウィジェットの幅。値はCSSの<code>width</code>で使用可能なもの。デフォルト: <code>100%</code>
</td>
</tr>
<tr>
<td><code>data-height</code></td>
<td>高さ: <code>string</code>
</td>
<td>ウィジェットの高さ。値はCSSの<code>height</code>で使用可能なもの。デフォルト: <code>400px</code>
</td>
</tr>
<tr>
<td><code>data-hide-header</code></td>
<td></td>
<td>Qiitaのロゴを非表示にする</td>
</tr>
<tr>
<td><code>data-hide-footer</code></td>
<td></td>
<td>Qiita Widgetへのリンクが非表示になる</td>
</tr>
</tbody>
</table>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />46位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>35</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/a87b4cdccbc5fa05a358">PHPのX-Powered-Byヘッダを送らないようにする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-08-27 01:37:21</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>PHPはデフォルトで稼働しているPHPのバージョンをHTTPヘッダに乗せてレスポンスを返しているって知っていました？意外と知らない人多いんじゃないかと思います。PHPスクリプトにHTTP Requestすると、このような詳細なバージョンがヘッダが帰ってきます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>X-Powered-By:PHP/5.4.0
</pre></div></div>

<p>バージョンがわかったところですぐに問題になるかと言えば微妙ですが、攻撃者がヘッダを解析するだけでPHPのバージョンを特定できるので、攻撃の事前調査などに悪用されることが考えられます。</p>

<p>X-Powered-Byヘッダを送らないようにする方法としては、3種類あります。1つ目は、php.iniで<code>expose_php = Off</code>をセットする方法です。これで、X-Powered-Byヘッダは送信されなくなります。ただし、<code>expose_php</code>を変更可能なのはphp.ini のみなので、<code>.htaccess</code>に書いたり、<code>set_ini()</code>でセットしたりするのは効果がありません。</p>

<div class="code-frame" data-lang="ini">
<div class="code-lang"><span class="bold">php.ini</span></div>
<div class="highlight"><pre><span></span><span class="na">expose_php</span> <span class="o">=</span> <span class="s">Off</span>
</pre></div>
</div>

<p>2つ目は、X-Powered-Byを置き換える方法です。<code>header()</code>で無理やりX-Powered-Byを送信すれば、PHPのバージョンは露出しなくなります。結局はX-Powered-Byを送信しているので、「PHPで動いているな」というのはだいたい予想がついてしまいます。できれば、X-Powered-Byヘッダ自体を送らないようにしたいですね。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">'X-Powered-By: Secret'</span><span class="p">);</span>
</pre></div></div>

<p>3つ目は、<code>header_register_callback()</code>を利用する方法です。この関数はPHP5.4で追加されたようで、ヘッダを送信する直前にコールされる関数を指定することができます。この関数を使うと、なんとヘッダを除去したり、追加したりできるのです。下の例は、X-Powered-Byヘッダを除去するものです。これでX-Powered-Byが送信されなくなります。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nb">header_register_callback</span><span class="p">(</span><span class="k">function</span><span class="p">(){</span>
    <span class="nb">header_remove</span><span class="p">(</span><span class="s1">'X-Powered-By'</span><span class="p">);</span>
<span class="p">});</span>
</pre></div></div>

<p>php.iniが編集できる環境であれば、<code>expose_php = Off</code>をセットするのが一番いいですが、例えば共有レンタルサーバでは3つ目の方法が有効に思えます。また、オープンソースとして配布するようなユーザの環境を特定できない場合も、3つ目の方法が役にたつと思います。</p>

<h2>
<span id="番外編-nginx--php-fpm構成でnginx側で消す方法" class="fragment"></span><a href="#%E7%95%AA%E5%A4%96%E7%B7%A8-nginx--php-fpm%E6%A7%8B%E6%88%90%E3%81%A7nginx%E5%81%B4%E3%81%A7%E6%B6%88%E3%81%99%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>番外編: Nginx + PHP-FPM構成でNginx側で消す方法</h2>

<p>Nginx + PHP-FPM構成でphp.iniがどうしても編集できない場合は、Nginx側(リバースプロキシ側)で<code>X-Powered-By</code>ヘッダを隠蔽することができます。<code>fastcgi_hide_header X-Powered-By;</code>をnginxの設定に追加します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>  location ~ \.php$ {
    fastcgi_pass  localhost:9000;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME  $document_root$fastcgi_script_name;
    fastcgi_hide_header X-Powered-By;
    include       fastcgi_params;
  }
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />47位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>34</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/6ad348113cb610b69919">JavaScript: 前後の空白を取り除く方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-25 13:34:28</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="s2">" aaa "</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span><span class="c1">// "aaa"</span>
</pre></div></div>

<h1>
<span id="解説" class="fragment"></span><a href="#%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>解説</h1>

<p>String.trim()メソッドがJavascript1.8.1より実装されています。</p>

<p><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/New_in_JavaScript/1.8.1" class="autolink" rel="nofollow noopener" target="_blank">https://developer.mozilla.org/ja/docs/Web/JavaScript/New_in_JavaScript/1.8.1</a></p>

<p>IEで言うと9以降。Chrome,Firefoxに関しては今日現在の最新版であればすでに対応しているようです。safariは5以降だそうです、実機で試していないので断言はできませんが動くと思います。</p>

<p>IE9未満のブラウザには正規表現で自前で行う必要があります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span><span class="s1">''</span><span class="p">);</span>
</pre></div></div>

<p>以下のようにしておくことで、IE9未満でも他のブラウザと同様に冒頭のように使えるようになります。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">trim</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">trim</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span><span class="s1">''</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />48位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>34</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/22ef05df5b8cfab29148">Kobitoをちょっぴり便利にするかも知れないCLIツールを作った</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-17 23:10:09</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> <b>[Go]</b> <b>[Kobito]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/9e24c9f6e11e34fed69aea6a095a60da148ffd7c/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f7375696e2f6b6f6269746f2d636c692f6d61737465722f696d6167652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9e24c9f6e11e34fed69aea6a095a60da148ffd7c/68747470733a2f2f7261772e67697468756275736572636f6e74656e742e636f6d2f7375696e2f6b6f6269746f2d636c692f6d61737465722f696d6167652e706e67" alt="" data-canonical-src="https://raw.githubusercontent.com/suin/kobito-cli/master/image.png"></a></p>

<ul>
<li>Markdownをパイプでつないで処理したい</li>
<li>勉強会用のネタや仕事上の報告書をKobitoで書いて印刷したい (Kobito v1.8.7では長い記事の印刷がうまくできない)</li>
<li>Kobito連携をコマンドラインからやりたい</li>
</ul>

<p>というふうな経緯があって、Kobitoをちょっと便利にするかもしれないCLIツールを作りました。</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<h3>
<span id="homebrewで入れる方法" class="fragment"></span><a href="#homebrew%E3%81%A7%E5%85%A5%E3%82%8C%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>Homebrewで入れる方法</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew tap suin/suin
brew install kobito-cli
</pre></div></div>

<p>Homebrewで入れるとzsh用の補完関数も入ります。</p>

<h3>
<span id="wgetで入れる方法" class="fragment"></span><a href="#wget%E3%81%A7%E5%85%A5%E3%82%8C%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>wgetで入れる方法</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>wget -O /usr/local/bin/kobito https://github.com/suin/kobito-cli/raw/master/bin/kobito
chmod +x /usr/local/bin/kobito
</pre></div></div>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>
Usage: 
  kobito [command]

Available Commands: 
  ls                                            :: List all items
  show [item id]                                :: Show item
  html [item id]                                :: Show item as HTML
  print [item id]                               :: Print out item
  link [markdown file]                          :: Link markdown file to Kobito
  version                                       :: Print kobito cli tools version
  pdf [item id] | pdf [item id] [pdf file name] :: Save item as PDF
  password                                      :: Show Kobito password
  sticker                                       :: Do you want Kobito sticker?
  help [command]                                :: Help about any command


Use "kobito help [command]" for more information about that command.
</pre></div></div>

<p></p>

<h3>
<span id="kobito-へ文字列を送信する" class="fragment"></span><a href="#kobito-%E3%81%B8%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E9%80%81%E4%BF%A1%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Kobito へ文字列を送信する</h3>

<p>パイプやリダイレクトなどで入力を渡すとKobitoのエントリーになります</p>

<p>historyの5件からKobitoのエントリーを作る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>history | tail -n 5 | kobito
</pre></div></div>

<p>main.goのソースコードでKobitoのエントリーを作る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>kobito &lt; main.go
</pre></div></div>

<p>「<a href="http://qiita.com/watson1978/items/c6ad9417298367aa9b9b" id="reference-8bc1d0d6a96421884300">Ruby - ターミナルから Kobito へ文字列を送信する - Qiita</a>」を参考にしました。</p>

<h2>
<span id="ソースコード" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>ソースコード</h2>

<p><a href="https://github.com/suin/kobito-cli" rel="nofollow noopener" target="_blank">github.com/suin/kobito-cli</a>で公開してます。PRあると嬉しいな(あるか?)</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />49位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/01149bcb7d4669642bb6">HTTPで読み書きできるデータベース「Riak」を使ってみる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-18 15:38:31</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> <b>[riak]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/795502885a0729d9bb680d4a1d1c6a4802713fde/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65336464313936382d613762372d393165382d626430362d3030633566663636653734362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/795502885a0729d9bb680d4a1d1c6a4802713fde/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65336464313936382d613762372d393165382d626430362d3030633566663636653734362e706e67" alt="Riak-logo.png" title="Riak-logo.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/e3dd1968-a7b7-91e8-bd06-00c5ff66e746.png"></a></p>

<h1>
<span id="riakとは" class="fragment"></span><a href="#riak%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Riakとは?</h1>

<ul>
<li>分散型キーバリューデータベース</li>
<li>HTTPで読み書きする</li>
<li>単一障害点がなく耐障害性がある</li>
<li>スケールが容易</li>
</ul>

<h1>
<span id="macにriakを入れてみる" class="fragment"></span><a href="#mac%E3%81%ABriak%E3%82%92%E5%85%A5%E3%82%8C%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>MacにRiakを入れてみる</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install riak
</pre></div></div>

<p>ulimit -n の値を増やす(OSX Lionの場合。ほかは<a href="http://docs.basho.com/riak/1.3.1/cookbooks/Open-Files-Limit/#Mac-OS-X" rel="nofollow noopener" target="_blank">公式ドキュメント</a>を参照)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sudo vim /etc/launchd.conf
</pre></div></div>

<div class="code-frame" data-lang="txt">
<div class="code-lang"><span class="bold">/etc/launchd.conf</span></div>
<div class="highlight"><pre><span></span>limit maxfiles 16384 32768
</pre></div>
</div>

<p>Macを再起動する</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>riak start
</pre></div></div>

<p>Riakとやりとりできることを確認する。(ここではhttpieコマンドを使う)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>http -v localhost:8098/ping
</pre></div></div>

<div class="code-frame" data-lang="http"><div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/ping</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, compress</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:8098</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">HTTPie/0.6.0</span>



HTTP/1.1 200 OK
Content-Length: 2
Content-Type: text/html
Date: Tue, 17 Dec 2013 08:18:22 GMT
Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)

OK
</pre></div></div>

<h1>
<span id="riakのurlのパターン" class="fragment"></span><a href="#riak%E3%81%AEurl%E3%81%AE%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>RiakのURLのパターン</h1>

<p>Riakはキーバリューストアで、キーに対応した値をストアできる。キーはバケツというカテゴリに分類される。バケツを分けることで、同じ名前のキーが衝突するのを避けることができる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>http://サーバー:ポート/buckets/バケツ/keys/キー
</pre></div></div>

<p>RiakはAmazonのDynamoの論文から着想を得ているせいか、RiakのURLはAWSのS3のものと似ている。</p>

<h1>
<span id="値を突っ込んでみる" class="fragment"></span><a href="#%E5%80%A4%E3%82%92%E7%AA%81%E3%81%A3%E8%BE%BC%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>値を突っ込んでみる</h1>

<p>例として、千葉市中央区の統計情報をchibaバケツに突っ込んでみる。</p>

<p>キーを指定する場合はPUTメソッドを使う</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>http -v PUT localhost:8098/buckets/chiba/keys/chuoku name=中央区 male_population=102080 female_population=100133 km2=44.81                                                                                                               

</pre></div></div>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPリクエスト</span></div>
<div class="highlight"><pre><span></span><span class="nf">PUT</span> <span class="nn">/buckets/chiba/keys/chuoku</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, compress</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">106</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:8098</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">HTTPie/0.6.0</span>

<span class="p">{</span>
    <span class="nt">"female_population"</span><span class="p">:</span> <span class="s2">"100133"</span><span class="p">,</span>
    <span class="nt">"km2"</span><span class="p">:</span> <span class="s2">"44.81"</span><span class="p">,</span>
    <span class="nt">"male_population"</span><span class="p">:</span> <span class="s2">"102080"</span><span class="p">,</span>
    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"中央区"</span>
<span class="p">}</span>
</pre></div>
</div>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPレスポンス</span></div>
<div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
<span class="na">Content-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">0</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 18 Dec 2013 04:58:50 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)</span>
<span class="na">Vary</span><span class="o">:</span> <span class="l">Accept-Encoding</span>
</pre></div>
</div>

<p>次に、さきほどの中央区のデータを取り出してみる。取り出すときはGETメソッド。</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>http -v GET localhost:8098/buckets/chiba/keys/chuoku
</pre></div></div>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPリクエスト</span></div>
<div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/buckets/chiba/keys/chuoku</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, compress</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:8098</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">HTTPie/0.6.0</span>
</pre></div>
</div>

<p>JSONデータがそのまま返ってくる。</p>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPレスポンス</span></div>
<div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">97</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 18 Dec 2013 07:45:12 GMT</span>
<span class="na">ETag</span><span class="o">:</span> <span class="l">"7HSboJBKuhPcawi77OYPcl"</span>
<span class="na">Last-Modified</span><span class="o">:</span> <span class="l">Wed, 18 Dec 2013 07:44:45 GMT</span>
<span class="na">Link</span><span class="o">:</span> <span class="l">&lt;/buckets/chiba&gt;; rel="up"</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)</span>
<span class="na">Vary</span><span class="o">:</span> <span class="l">Accept-Encoding</span>
<span class="na">X-Riak-Vclock</span><span class="o">:</span> <span class="l">a85hYGBgzGDKBVIcypz/fgZtYNLMYEpkyWNlyD2neoYvCwA=</span>

<span class="p">{</span>
    <span class="nt">"female_population"</span><span class="p">:</span> <span class="s2">"100133"</span><span class="p">,</span>
    <span class="nt">"km2"</span><span class="p">:</span> <span class="s2">"44.81"</span><span class="p">,</span>
    <span class="nt">"male_population"</span><span class="p">:</span> <span class="s2">"102080"</span><span class="p">,</span>
    <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"中央区"</span>
<span class="p">}</span>
</pre></div>
</div>

<h1>
<span id="存在しないキーのデータを取り出してみる" class="fragment"></span><a href="#%E5%AD%98%E5%9C%A8%E3%81%97%E3%81%AA%E3%81%84%E3%82%AD%E3%83%BC%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>存在しないキーのデータを取り出してみる</h1>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>http -v GET localhost:8098/buckets/chiba/keys/shinjukuku
</pre></div></div>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPリクエスト</span></div>
<div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/buckets/chiba/keys/shinjukuku</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, compress</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:8098</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">HTTPie/0.6.0</span>
</pre></div>
</div>

<p>404ステータスがかえってくる</p>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPレスポンス</span></div>
<div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">404</span> <span class="ne">Object Not Found</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">10</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/plain</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 18 Dec 2013 05:05:50 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)</span>

not found

</pre></div>
</div>

<h1>
<span id="キーの一覧を取得してみる" class="fragment"></span><a href="#%E3%82%AD%E3%83%BC%E3%81%AE%E4%B8%80%E8%A6%A7%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>キーの一覧を取得してみる</h1>

<p>まずは、複数のキーを登録する</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>http -v PUT localhost:8098/buckets/chiba/keys/hanamigawaku \
    name=花見川区 male_population=89369 female_population=90329 km2=34.24
http -v PUT localhost:8098/buckets/chiba/keys/inageku \
    name=稲毛区 male_population=78199 female_population=78413 km2=21.25
http -v PUT localhost:8098/buckets/chiba/keys/wakabaku \
    name=若葉区 male_population=76159 female_population=75006 km2=84.21
http -v PUT localhost:8098/buckets/chiba/keys/midoriku \
    name=緑区 male_population=62042 female_population=63914 km2=66.41
http -v PUT localhost:8098/buckets/chiba/keys/mihamaku \
    name=美浜区 male_population=72806 female_population=76145 km2=21.16
</pre></div></div>

<p>キー一覧を取得する。バケツに対して <code>keys=ture</code> を指定するとキーの一覧が取得できる。なお <code>keys=stream</code> とするとストリームで返してくれるのでデータセットが大きい場合はこちらのほうが安全とのこと。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>http -v GET 'localhost:8098/buckets/chiba/keys?keys=true'
</pre></div></div>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPリクエスト</span></div>
<div class="highlight"><pre><span></span><span class="nf">GET</span> <span class="nn">/buckets/chiba/keys?keys=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, compress</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:8098</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">HTTPie/0.6.0</span>
</pre></div>
</div>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPレスポンス</span></div>
<div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">77</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 18 Dec 2013 07:41:01 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)</span>
<span class="na">Vary</span><span class="o">:</span> <span class="l">Accept-Encoding</span>

<span class="p">{</span>
    <span class="nt">"keys"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"hanamigawaku"</span><span class="p">,</span>
        <span class="s2">"wakabaku"</span><span class="p">,</span>
        <span class="s2">"mihamaku"</span><span class="p">,</span>
        <span class="s2">"chuoku"</span><span class="p">,</span>
        <span class="s2">"midoriku"</span><span class="p">,</span>
        <span class="s2">"inageku"</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>

<h1>
<span id="キーを削除する" class="fragment"></span><a href="#%E3%82%AD%E3%83%BC%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>キーを削除する</h1>

<p>削除してみる</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>http -v DELETE localhost:8098/buckets/chiba/keys/mihamaku
</pre></div></div>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPリクエスト</span></div>
<div class="highlight"><pre><span></span><span class="nf">DELETE</span> <span class="nn">/buckets/chiba/keys/mihamaku</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, compress</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">0</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:8098</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">HTTPie/0.6.0</span>
</pre></div>
</div>

<p>204レスポンスを返す</p>

<div class="code-frame" data-lang="http">
<div class="code-lang"><span class="bold">HTTPレスポンス</span></div>
<div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">204</span> <span class="ne">No Content</span>
<span class="na">Content-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">0</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json; charset=utf-8</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Wed, 18 Dec 2013 05:23:15 GMT</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)</span>
<span class="na">Vary</span><span class="o">:</span> <span class="l">Accept-Encoding</span>
</pre></div>
</div>

<h1>
<span id="htmlだって置ける" class="fragment"></span><a href="#html%E3%81%A0%E3%81%A3%E3%81%A6%E7%BD%AE%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>HTMLだって置ける</h1>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>echo '&lt;!doctype html&gt;&lt;meta charset="utf8"&gt;&lt;h1&gt;Riak&lt;/h1&gt;&lt;p&gt;HTMLも置けます&lt;/p&gt;' | http -v --form PUT localhost:8098/buckets/my-bucket/keys/riak.html Content-Type:text/html
</pre></div></div>

<p>(ここの <code>--form</code> を指定しないとhttpieが <code>Accept: application/json</code> ヘッダを吐いてしまい、Riakが406 Not Acceptableを返してしまう。)</p>

<p>ブラウザで <a href="http://localhost:8098/buckets/my-bucket/keys/riak.html" class="autolink" rel="nofollow noopener" target="_blank">http://localhost:8098/buckets/my-bucket/keys/riak.html</a> を開くとHTMLが見れる</p>

<h1>
<span id="画像も置ける" class="fragment"></span><a href="#%E7%94%BB%E5%83%8F%E3%82%82%E7%BD%AE%E3%81%91%E3%82%8B"><i class="fa fa-link"></i></a>画像も置ける</h1>

<p>適当に画像を落としてくる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>wget http://128bitstudios.com/images/logo/Riak_logo.png -O riak-logo.png
</pre></div></div>

<p>Riakにつっこむ:</p>

<div class="code-frame" data-lang="shell"><div class="highlight"><pre><span></span>http -v --form PUT localhost:8098/buckets/my-bucket/keys/riak-logo.png Content-Type:image/png &lt; riak-logo.png
</pre></div></div>

<p>ブラウザで <a href="http://localhost:8098/buckets/my-bucket/keys/riak-logo.png" class="autolink" rel="nofollow noopener" target="_blank">http://localhost:8098/buckets/my-bucket/keys/riak-logo.png</a> を開くと画像が表示される</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />50位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/b2a81227c75c51579c04">Go言語でオブジェクトを作ってみる: オブジェクト・メソッド・コンストラクタなど</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-10 17:44:23</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="この記事の目的" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>この記事の目的</h1>

<ul>
<li>Go言語でオブジェクトを作れるようになる</li>
<li>Go言語でメソッドを定義できるようになる</li>
<li>Go言語でコンストラクタを定義できるようになる</li>
</ul>

<h1>
<span id="オブジェクトを作る" class="fragment"></span><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>オブジェクトを作る</h1>

<p>Go言語ではクラスと呼ばれるものはないらしい。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Money</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">amount</span>   <span class="kt">uint</span>
    <span class="nx">currency</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">money</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Money</span><span class="p">{</span><span class="mi">120</span><span class="p">,</span> <span class="s">"yen"</span><span class="p">}</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%#v"</span><span class="p">,</span> <span class="nx">money</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行してみる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run main.go                                                                                                                                     
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>2013/12/10 17:28:49 &amp;main.Money{amount:0x78, currency:"yen"}
</pre></div></div>

<h1>
<span id="クエリメソッドを定義してみる" class="fragment"></span><a href="#%E3%82%AF%E3%82%A8%E3%83%AA%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>クエリメソッドを定義してみる</h1>

<p>状態を変更しないクエリメソッド <code>Format</code> を定義する:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"log"</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Money</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">amount</span>   <span class="kt">uint</span>
    <span class="nx">currency</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Money</span><span class="p">)</span> <span class="nx">Format</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"%d %s"</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">amount</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">currency</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">money</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Money</span><span class="p">{</span><span class="mi">120</span><span class="p">,</span> <span class="s">"yen"</span><span class="p">}</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%#v"</span><span class="p">,</span> <span class="nx">money</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">money</span><span class="p">.</span><span class="nx">Format</span><span class="p">())</span>
<span class="p">}</span>

</pre></div>
</div>

<p>実行しての結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>2013/12/10 17:30:41 &amp;main.Money{amount:0x78, currency:"yen"}
2013/12/10 17:30:41 120 yen
</pre></div></div>

<h1>
<span id="コマンドメソッドを定義してみる" class="fragment"></span><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>コマンドメソッドを定義してみる</h1>

<p>状態を変更するコマンドメソッド <code>Add</code>  を定義する:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"log"</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Money</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">amount</span>   <span class="kt">uint</span>
    <span class="nx">currency</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Money</span><span class="p">)</span> <span class="nx">Format</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"%d %s"</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">amount</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">currency</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Money</span><span class="p">)</span> <span class="nx">Add</span><span class="p">(</span><span class="nx">that</span> <span class="o">*</span><span class="nx">Money</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">this</span><span class="p">.</span><span class="nx">amount</span> <span class="o">+=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">amount</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">money</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Money</span><span class="p">{</span><span class="mi">120</span><span class="p">,</span> <span class="s">"yen"</span><span class="p">}</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">money</span><span class="p">.</span><span class="nx">Format</span><span class="p">())</span>
    <span class="nx">money</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Money</span><span class="p">{</span><span class="mi">180</span><span class="p">,</span> <span class="s">"yen"</span><span class="p">})</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">money</span><span class="p">.</span><span class="nx">Format</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行しての結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>2013/12/10 17:34:41 120 yen
2013/12/10 17:34:41 300 yen
</pre></div></div>

<h1>
<span id="コンストラクタを作る" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>コンストラクタを作る</h1>

<p>Go言語ではJavaのコンストラクタ的なものはないみたい。代わりにファクトリー関数を定義する</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"log"</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Money</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">amount</span>   <span class="kt">uint</span>
    <span class="nx">currency</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">NewMoney</span><span class="p">(</span><span class="nx">amount</span> <span class="kt">uint</span><span class="p">)</span> <span class="o">*</span><span class="nx">Money</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Money</span><span class="p">{</span><span class="nx">amount</span><span class="p">,</span> <span class="s">"yen"</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Money</span><span class="p">)</span> <span class="nx">Format</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">"%d %s"</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">amount</span><span class="p">,</span> <span class="nx">this</span><span class="p">.</span><span class="nx">currency</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">this</span> <span class="o">*</span><span class="nx">Money</span><span class="p">)</span> <span class="nx">Add</span><span class="p">(</span><span class="nx">that</span> <span class="o">*</span><span class="nx">Money</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">this</span><span class="p">.</span><span class="nx">amount</span> <span class="o">+=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">amount</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">money</span> <span class="o">:=</span> <span class="nx">NewMoney</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">money</span><span class="p">.</span><span class="nx">Format</span><span class="p">())</span>
    <span class="nx">money</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">NewMoney</span><span class="p">(</span><span class="mi">180</span><span class="p">))</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">money</span><span class="p">.</span><span class="nx">Format</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行結果:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>2013/12/10 17:40:33 120 yen
2013/12/10 17:40:33 300 yen
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />51位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/fd4c0fc808316793f9cc">制御文字を取り除く方法（改行コードは保持）</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2011-12-05 21:39:52</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F]/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span> <span class="c1">// The line feed and carriage return will be saved.</span>
</pre></div></div>

<p>ここから拝借:<br>
<a href="http://stackoverflow.com/questions/1497885/remove-control-characters-from-php-string" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/1497885/remove-control-characters-from-php-string</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />52位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>32</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/629372fd08ee9e9cf727">SSHで日本語が入力できない</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-02 01:27:57</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> <b>[SSH]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>あとですいこうする</p>

<p>ローカルのMac(英語でインストール)の iTerm, Terminal, zsh, bashすべての組み合わせでは日本語を入力できる<br>
上記すべての組み合わせでsshでサーバーのbashに日本語を入力しようとすると、消えてなくなる<br>
日本語を入力できるサーバーとそうでないサーバーがある</p>

<p>不思議なことに、別のMac(日本語でインストール)では日本語入力できる</p>

<p>できないMac:</p>

<p>$ locale<br>
LANG=<br>
LC_COLLATE="C"<br>
LC_CTYPE="UTF-8"<br>
LC_MESSAGES="C"<br>
LC_MONETARY="C"<br>
LC_NUMERIC="C"<br>
LC_TIME="C"<br>
LC_ALL=</p>

<p>できるMac:</p>

<p>$ locale<br>
LANG="ja_JP.UTF-8"<br>
LC_COLLATE="ja_JP.UTF-8"<br>
LC_CTYPE="ja_JP.UTF-8"<br>
LC_MESSAGES="ja_JP.UTF-8"<br>
LC_MONETARY="ja_JP.UTF-8"<br>
LC_NUMERIC="ja_JP.UTF-8"<br>
LC_TIME="ja_JP.UTF-8"<br>
LC_ALL=</p>

<p>export LC_CTYPE=en_US.UTF-8<br>
export LC_ALL=en_US.UTF-8</p>

<p>をMacのzshenvに書いたら、↓こうなり、SSH先でも日本語使えるようになった</p>

<p>LANG=<br>
LC_COLLATE="en_US.UTF-8"<br>
LC_CTYPE="en_US.UTF-8"<br>
LC_MESSAGES="en_US.UTF-8"<br>
LC_MONETARY="en_US.UTF-8"<br>
LC_NUMERIC="en_US.UTF-8"<br>
LC_TIME="en_US.UTF-8"<br>
LC_ALL="en_US.UTF-8"</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />53位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>32</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/b522bd701cab1885344a">DNS浸透を温かく見守るコマンドラインツール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-03-30 15:35:05</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[server]</b> <b>[Network]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>サーバ移転とかしたときに、どのへんまでDNS情報が更新されてるか知りたい時に使います。</p>

<p>2012-04-04 追記:</p>

<p>コメントにてgeekpageさんがこのツールの問題を指摘しています。コメントを参照の上、各自の修正するなりして状況に対応してくださいm(_ _)m ご指摘くださったgeekpageさんありがとうございます！</p>

<p><a href="https://camo.qiitausercontent.com/91c979f2e02dc27d0dc2b8d37f12ae95f8fc3215/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38623338323765652d666262642d666163352d636533372d3137353838306135343831342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/91c979f2e02dc27d0dc2b8d37f12ae95f8fc3215/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38623338323765652d666262642d666163352d636533372d3137353838306135343831342e706e67" alt="120330-dns-penetration-monitor.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/8b3827ee-fbbd-fac5-ce37-175880a54814.png"></a></p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">dns-penetration-monitor.php</span></div>
<div class="highlight"><pre><span></span><span class="x">#!/usr/bin/env php</span>
<span class="cp">&lt;?php</span>

<span class="c1">//$monitor = new DNSPenetrationMonitor(ドメイン, 新しいIP);</span>
<span class="nv">$monitor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DNSPenetrationMonitor</span><span class="p">(</span><span class="s1">'suin.asia'</span><span class="p">,</span> <span class="s1">'59.106.173.151'</span><span class="p">);</span>
<span class="nv">$monitor</span><span class="o">-&gt;</span><span class="na">monitor</span><span class="p">();</span>

<span class="k">class</span> <span class="nc">DNSPenetrationMonitor</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="nv">$providers</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'202.234.232.6'</span>     <span class="o">=&gt;</span> <span class="s1">'OCN'</span><span class="p">,</span>
        <span class="s1">'221.113.139.250'</span>   <span class="o">=&gt;</span> <span class="s1">'OCN'</span><span class="p">,</span>
        <span class="s1">'210.196.3.183'</span>     <span class="o">=&gt;</span> <span class="s1">'auone'</span><span class="p">,</span>
        <span class="s1">'210.141.112.163'</span>   <span class="o">=&gt;</span> <span class="s1">'auone'</span><span class="p">,</span>
        <span class="s1">'202.248.37.74'</span>     <span class="o">=&gt;</span> <span class="s1">'@nifty'</span><span class="p">,</span>
        <span class="s1">'202.248.20.133'</span>    <span class="o">=&gt;</span> <span class="s1">'@nifty'</span><span class="p">,</span>
        <span class="s1">'202.238.95.24'</span>     <span class="o">=&gt;</span> <span class="s1">'So-net'</span><span class="p">,</span>
        <span class="s1">'202.238.95.26'</span>     <span class="o">=&gt;</span> <span class="s1">'So-net'</span><span class="p">,</span>
        <span class="s1">'143.90.130.165'</span>    <span class="o">=&gt;</span> <span class="s1">'odn'</span><span class="p">,</span>
        <span class="s1">'143.90.130.39'</span>     <span class="o">=&gt;</span> <span class="s1">'odn'</span><span class="p">,</span>
        <span class="s1">'8.8.8.8'</span>           <span class="o">=&gt;</span> <span class="s1">'google'</span><span class="p">,</span>
        <span class="s1">'dns3.sakura.ad.jp'</span> <span class="o">=&gt;</span> <span class="s1">'sakura'</span><span class="p">,</span>
        <span class="s1">'exnsa.plala.or.jp'</span> <span class="o">=&gt;</span> <span class="s1">'plala'</span><span class="p">,</span>
        <span class="s1">'198.153.192.1'</span>     <span class="o">=&gt;</span> <span class="s1">'Norton'</span><span class="p">,</span>
        <span class="s1">'198.153.194.1'</span>     <span class="o">=&gt;</span> <span class="s1">'Norton'</span><span class="p">,</span>
        <span class="s1">'208.67.222.222'</span>    <span class="o">=&gt;</span> <span class="s1">'OpenDNS'</span><span class="p">,</span>
        <span class="s1">'208.67.220.220'</span>    <span class="o">=&gt;</span> <span class="s1">'OpenDNS'</span><span class="p">,</span>
        <span class="s1">'4.2.2.1'</span>           <span class="o">=&gt;</span> <span class="s1">'GTEIDNS'</span><span class="p">,</span>
        <span class="s1">'4.2.2.2'</span>           <span class="o">=&gt;</span> <span class="s1">'GTEIDNS'</span><span class="p">,</span>
        <span class="s1">'156.154.70.1'</span>      <span class="o">=&gt;</span> <span class="s1">'Dnsadvantage'</span><span class="p">,</span>
        <span class="s1">'156.154.71.1'</span>      <span class="o">=&gt;</span> <span class="s1">'Dnsadvantage'</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">protected</span> <span class="nv">$hostName</span>   <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$newAddress</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$intervalSeconds</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$providerStringLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @param string $hostName</span>
<span class="sd">     * @param string $newAddress</span>
<span class="sd">     * @param int $intervalSeconds</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$hostName</span><span class="p">,</span> <span class="nv">$newAddress</span><span class="p">,</span> <span class="nv">$intervalSeconds</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hostName</span> <span class="o">=</span> <span class="nv">$hostName</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">newAddress</span> <span class="o">=</span> <span class="nv">$newAddress</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">intervalSeconds</span> <span class="o">=</span> <span class="nv">$intervalSeconds</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">providerStringLength</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_calculateProviderStringLength</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">monitor</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_print</span><span class="p">(</span><span class="s2">"Start monitor: </span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hostName</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_print</span><span class="p">(</span><span class="s2">"To quit: Ctrl + C"</span><span class="p">);</span>

        <span class="k">while</span> <span class="p">(</span> <span class="k">true</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lookup</span><span class="p">();</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_print</span><span class="p">(</span><span class="s2">"Sleep </span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">intervalSeconds</span><span class="si">}</span><span class="s2"> seconds..."</span><span class="p">);</span>
            <span class="nb">sleep</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">intervalSeconds</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">lookup</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$providers</span> <span class="k">as</span> <span class="nv">$providerAddress</span> <span class="o">=&gt;</span> <span class="nv">$providerName</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$currentAddress</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getAddress</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hostName</span><span class="p">,</span> <span class="nv">$providerAddress</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_printLookupResult</span><span class="p">(</span><span class="nv">$currentAddress</span><span class="p">,</span> <span class="nv">$providerAddress</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_calculateProviderStringLength</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$maxLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">foreach</span> <span class="p">(</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$providers</span> <span class="k">as</span> <span class="nv">$address</span> <span class="o">=&gt;</span> <span class="nv">$name</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$length</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$address</span><span class="o">.</span><span class="nv">$name</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span> <span class="nv">$maxLength</span> <span class="o">&lt;</span> <span class="nv">$length</span> <span class="p">)</span>
            <span class="p">{</span>
                <span class="nv">$maxLength</span> <span class="o">=</span> <span class="nv">$length</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$maxLength</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_isNewAddress</span><span class="p">(</span><span class="nv">$currentAddress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$currentAddress</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">newAddress</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_getAddress</span><span class="p">(</span><span class="nv">$hostName</span><span class="p">,</span> <span class="nv">$nameServerName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$command</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'nslookup %s %s'</span><span class="p">,</span> <span class="nv">$hostName</span><span class="p">,</span> <span class="nv">$nameServerName</span><span class="p">);</span>
        <span class="nv">$output</span>  <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nb">exec</span><span class="p">(</span><span class="nv">$command</span><span class="p">,</span> <span class="nv">$output</span><span class="p">);</span>
        <span class="nv">$output</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_getStatusString</span><span class="p">(</span><span class="nv">$currentAddress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isNewAddress</span><span class="p">(</span><span class="nv">$currentAddress</span><span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span>  <span class="s2">"</span><span class="se">\033</span><span class="s2">[32mNEW</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[31mOLD</span><span class="se">\033</span><span class="s2">[0m"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_printLookupResult</span><span class="p">(</span><span class="nv">$currentAddress</span><span class="p">,</span> <span class="nv">$providerAddress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$now</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">);</span>
        <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getStatusString</span><span class="p">(</span><span class="nv">$currentAddress</span><span class="p">);</span>
        <span class="nv">$providerName</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$providers</span><span class="p">[</span><span class="nv">$providerAddress</span><span class="p">];</span>
        <span class="nv">$providerString</span> <span class="o">=</span> <span class="nb">str_pad</span><span class="p">(</span><span class="s2">"</span><span class="si">$providerName</span><span class="s2">(</span><span class="si">$providerAddress</span><span class="s2">)"</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">providerStringLength</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="nx">STR_PAD_RIGHT</span><span class="p">);</span>
        <span class="nv">$message</span> <span class="o">=</span> <span class="s2">"[</span><span class="si">$now</span><span class="s2">] </span><span class="si">$providerString</span><span class="s2"> </span><span class="si">$status</span><span class="s2"> </span><span class="si">$currentAddress</span><span class="s2">"</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_print</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_print</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'php://stdout'</span><span class="p">,</span> <span class="nv">$message</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />54位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>31</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/2202bf27b5f865805226">【まとめ】『実践ドメイン駆動設計』: 7. サービス</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-14 22:22:16</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[オブジェクト指向]</b> <b>[DDD]</b> <b>[ドメイン駆動設計]</b> <b>[IDDD]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://amzn.to/YmRhoC" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/a968c1cf9eabf6f320899ccd4befdaa30110c1d0/687474703a2f2f6563782e696d616765732d616d617a6f6e2e636f6d2f696d616765732f492f3531703136584c6875694c2e5f53533530305f2e6a7067" alt="" data-canonical-src="http://ecx.images-amazon.com/images/I/51p16XLhuiL._SS500_.jpg"></a></p>

<h2>
<span id="serviceとは" class="fragment"></span><a href="#service%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>Serviceとは?</h2>

<ul>
<li>ドメイン固有のタスクを果たす状態を持たない操作</li>
<li>
<a href="http://martinfowler.com/bliki/UbiquitousLanguage.html" rel="nofollow noopener" target="_blank">ユビキタス言語</a>に従っている</li>
<li>ある操作が、AggregateやValue Objectのメソッドではないと感じられるなら、それをServiceとして作るといい</li>
</ul>

<h2>
<span id="domain-serviceじゃないもの" class="fragment"></span><a href="#domain-service%E3%81%98%E3%82%83%E3%81%AA%E3%81%84%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>Domain Serviceじゃないもの</h2>

<ul>
<li><a href="http://ja.wikipedia.org/wiki/%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E6%8C%87%E5%90%91%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3" rel="nofollow noopener" target="_blank">サービス指向アーキテクチャ</a></li>
<li><a href="http://ja.wikipedia.org/wiki/%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E6%8C%87%E5%90%91%E3%83%9F%E3%83%89%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2" rel="nofollow noopener" target="_blank">メッセージ指向ミドルウェア</a></li>
<li>Application Service(これはDomain Serviceのクライアントになる)</li>
<li>粒度が大きいもの (coarse-graind)</li>
<li>リモート実行可能なもの (remote-capable)</li>
<li>重量級のもの (hevyweight)</li>
<li>トランザクション操作を持つもの (transactional operation)</li>
</ul>

<h2>
<span id="domain-serviceであるもの" class="fragment"></span><a href="#domain-service%E3%81%A7%E3%81%82%E3%82%8B%E3%82%82%E3%81%AE"><i class="fa fa-link"></i></a>Domain Serviceであるもの</h2>

<p>ドメイン上の重要な処理や変形操作。<br>
すでにあるEntityやValue Objectに収まらない操作。</p>

<ul>
<li>重要なビジネス上の処理を行うもの</li>
<li>ドメインオブジェクトを他のドメインオブジェクトに変形するもの</li>
<li>2つ以上のドメインオブジェクトを入力に受け取って値(Value)を計算するもの</li>
</ul>

<h2>
<span id="domain-serviceの過剰使用" class="fragment"></span><a href="#domain-service%E3%81%AE%E9%81%8E%E5%89%B0%E4%BD%BF%E7%94%A8"><i class="fa fa-link"></i></a>Domain Serviceの過剰使用</h2>

<p>Domain Serviceの過剰使用はドメインモデル欠乏症(<a href="http://www.martinfowler.com/bliki/AnemicDomainModel.html" rel="nofollow noopener" target="_blank">Anemic Domain Model</a>)になる。</p>

<p>なぜサービスが必要なのかをよく考えること: <br>
「このふるまいは単純にEntityに置けないか?」</p>

<p>もし理由が</p>

<ul>
<li>それがEntityの単一責務(<a href="http://en.wikipedia.org/wiki/Single_responsibility_principle" rel="nofollow noopener" target="_blank">Single Responsibility</a>)に違反するから</li>
<li>クライアントが複雑になるから</li>
<li>ドメイン固有の知識がクライアントに流出するから</li>
</ul>

<p>等なら、答えは「Serviceを作るべき」。</p>

<p>Entityにあるstatic methodはServiceになるフラグ。</p>

<h2>
<span id="service実装のいろは" class="fragment"></span><a href="#service%E5%AE%9F%E8%A3%85%E3%81%AE%E3%81%84%E3%82%8D%E3%81%AF"><i class="fa fa-link"></i></a>Service実装のいろは</h2>

<ul>
<li>Serviceは<a href="http://martinfowler.com/eaaCatalog/separatedInterface.html" rel="nofollow noopener" target="_blank">Separated Interface</a>にするといい</li>
<li>インターフェイスはDomain Layerの中に定義する</li>
<li>そしてたったひとつの操作を持つようにする</li>
<li>技術的な実装はInfrastructure Layerの中に作るといいかもしれない</li>
<li>実装クラス名前はその実装の特性を表現したものにする(単に-ImplやDefault-ではなく)</li>
<li>実装は<a href="http://martinfowler.com/bliki/UbiquitousLanguage.html" rel="nofollow noopener" target="_blank">ユビキタス言語</a>を明示的(explicit)に表現する!</li>
</ul>

<h2>
<span id="separated-interfaceにすべきときそうでもないとき" class="fragment"></span><a href="#separated-interface%E3%81%AB%E3%81%99%E3%81%B9%E3%81%8D%E3%81%A8%E3%81%8D%E3%81%9D%E3%81%86%E3%81%A7%E3%82%82%E3%81%AA%E3%81%84%E3%81%A8%E3%81%8D"><i class="fa fa-link"></i></a>Separated Interfaceにすべきとき、そうでもないとき</h2>

<h3>
<span id="すべきとき" class="fragment"></span><a href="#%E3%81%99%E3%81%B9%E3%81%8D%E3%81%A8%E3%81%8D"><i class="fa fa-link"></i></a>すべきとき</h3>

<ul>
<li>Serviceに複数の実装がある(ポリモーフィックになっている)</li>
<li>技術的な実装がある(暗号化技術やInfrastructure LayerのRepositoryに依存するなど)</li>
<li>Serviceのインスタンス化の方法を隠蔽したいとき</li>
</ul>

<h3>
<span id="そうでもないとき" class="fragment"></span><a href="#%E3%81%9D%E3%81%86%E3%81%A7%E3%82%82%E3%81%AA%E3%81%84%E3%81%A8%E3%81%8D"><i class="fa fa-link"></i></a>そうでもないとき</h3>

<p>Separated Interfaceはいつも必要というわけではない。普通にクラスをDomain Layerに作るだけで十分なときもある。</p>

<ul>
<li>Serviceのポリモーフィックが不要なとき</li>
<li>ドメイン固有の操作しか含まない場合</li>
<li>Dependency InjectionやService FactoryがServiceのインスタンス化の方法を隠蔽しているとき。</li>
</ul>

<p>もし実装クラスが、インターフェイス名に-ImplやDefault-のような接辞をつけているだけなら、それはSeparated Interfaceが不要という合図。</p>

<h2>
<span id="サービスをテストする" class="fragment"></span><a href="#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%92%E3%83%86%E3%82%B9%E3%83%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>サービスをテストする</h2>

<p>Serviceをどう使うかデモンストレーションになるような、模範的なテストを提供すること。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />55位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>31</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/922e75b53d1d72581676">Redisに登録されているキー一覧の取得方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-01-27 07:21:19</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Redis]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>keys *
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>redis 127.0.0.1:6379&gt; keys *
(empty list or set)
redis 127.0.0.1:6379&gt; set hoge1 hoge
OK
redis 127.0.0.1:6379&gt; set hoge2 hoge
OK
redis 127.0.0.1:6379&gt; set fuga aaaaaaaaaaaaaaa
OK
redis 127.0.0.1:6379&gt; keys *
1) "fuga"
2) "hoge1"
3) "hoge2"
</pre></div></div>

<p><a href="http://stackoverflow.com/questions/5252099/redis-command-to-get-all-available-keys" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/questions/5252099/redis-command-to-get-all-available-keys</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />56位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>30</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/b9c0f92851454dc6d461">Go言語: ファイルの存在をちゃんとチェックする実装?</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-19 01:19:56</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Go言語でファイルの存在をチェックする関数を実装していて、予期しない振る舞いがあったのでメモ。</p>

<h1>
<span id="よく見かける実装" class="fragment"></span><a href="#%E3%82%88%E3%81%8F%E8%A6%8B%E3%81%8B%E3%81%91%E3%82%8B%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>よく見かける実装</h1>

<p><a href="http://stackoverflow.com/questions/12518876/how-to-check-if-a-file-exists-in-go" rel="nofollow noopener" target="_blank">How to check if a file exists in Go? - Stack Overflow</a>などで見かける実装で下記のようなコードがある。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">fileExists</span><span class="p">(</span><span class="nx">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div></div>

<p>結論から言うと、このスニペットではちゃんと判定できない場合がある。</p>

<p>テストコードを見てみよう。</p>

<p>テストコード:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">file-exists1.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">testCases</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{</span>
        <span class="s">"dir"</span><span class="p">:</span>                          <span class="kc">true</span><span class="p">,</span>
        <span class="s">"file.txt"</span><span class="p">:</span>                     <span class="kc">true</span><span class="p">,</span>
        <span class="s">".dotfile"</span><span class="p">:</span>                     <span class="kc">true</span><span class="p">,</span>
        <span class="s">"link-to-file.txt"</span><span class="p">:</span>             <span class="kc">true</span><span class="p">,</span>
        <span class="s">"unknown-dir"</span><span class="p">:</span>                  <span class="kc">false</span><span class="p">,</span>
        <span class="s">"unknown-file"</span><span class="p">:</span>                 <span class="kc">false</span><span class="p">,</span>
        <span class="s">".unknown-dotfile"</span><span class="p">:</span>             <span class="kc">false</span><span class="p">,</span>
        <span class="s">"unknown-link-to-file.txt"</span><span class="p">:</span>     <span class="kc">false</span><span class="p">,</span>
        <span class="s">"dir/unknown-dir"</span><span class="p">:</span>              <span class="kc">false</span><span class="p">,</span>
        <span class="s">"file.txt/unknown-dir"</span><span class="p">:</span>         <span class="kc">false</span><span class="p">,</span>
        <span class="s">".dotfile/unknown-dir"</span><span class="p">:</span>         <span class="kc">false</span><span class="p">,</span>
        <span class="s">"link-to-file.txt/unknown-dir"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">expects</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">testCases</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">fileExists</span><span class="p">(</span><span class="s">"/tmp/golang-test/"</span><span class="o">+</span><span class="nx">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nx">expects</span> <span class="p">{</span>
            <span class="nb">println</span><span class="p">(</span><span class="s">"PASS: "</span> <span class="o">+</span> <span class="nx">filename</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">println</span><span class="p">(</span><span class="s">"FAIL: "</span> <span class="o">+</span> <span class="nx">filename</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">fileExists</span><span class="p">(</span><span class="nx">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>

<p>テスト用のファイルを作るスクリプト</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

mkdir -p /tmp/golang-test
<span class="nb">cd</span> /tmp/golang-test
touch file.txt
mkdir dir
touch .dotfile
ln -s file.txt link-to-file.txt
</pre></div></div>

<h2>
<span id="実行結果" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>実行結果</h2>

<p>ご覧のとおり、存在するファイルのあとに <code>/</code> でファイル名を続けると、ファイルがないのに <code>true</code> が返ってきて結果的に FAIL になる。</p>

<p>go1.2 darwin/amd64 の実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>PASS: file.txt
PASS: .dotfile
PASS: link-to-file.txt
PASS: dir
PASS: unknown-dir
PASS: unknown-file
PASS: .unknown-dotfile
PASS: unknown-link-to-file.txt
PASS: dir/unknown-dir
FAIL: file.txt/unknown-dir
FAIL: .dotfile/unknown-dir
FAIL: link-to-file.txt/unknown-dir
</pre></div></div>

<p>go1.2 linux/amd64 の実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>PASS: file.txt
PASS: .dotfile
PASS: link-to-file.txt
PASS: unknown-dir
PASS: dir/unknown-dir
FAIL: .dotfile/unknown-dir
PASS: dir
PASS: unknown-file
PASS: .unknown-dotfile
PASS: unknown-link-to-file.txt
FAIL: file.txt/unknown-dir
FAIL: link-to-file.txt/unknown-dir
</pre></div></div>

<p>いろいろ調べてみたが、<code>file.txt/unknown-dir</code> のようなパスでは <code>syscall.ENOTDIR</code> が返ってくる場合があり、<code>os.IsNotExists</code> ではこれをハンドリングしていないようである。もしかしたら、<code>syscall.ENOTDIR</code> がOS依存なのかもしれず、それでハンドリングしていないのかもしれない。知ってる人がいたら教えてほしい。</p>

<h1>
<span id="ちゃんとした実装" class="fragment"></span><a href="#%E3%81%A1%E3%82%83%E3%82%93%E3%81%A8%E3%81%97%E3%81%9F%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>ちゃんとした実装?</h1>

<p>上の <code>file-exists1.go</code> に下記のエラーハンドリングを追加したのが <code>file-exists2.go</code> である。</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="nx">pathError</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">PathError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">pathError</span><span class="p">.</span><span class="nx">Err</span> <span class="o">==</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">ENOTDIR</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div></div>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">file-exists2.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"os"</span>
    <span class="s">"syscall"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">testCases</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{</span>
        <span class="s">"dir"</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s">"file.txt"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s">".dotfile"</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s">"link-to-file.txt"</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s">"unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"unknown-file"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">".unknown-dotfile"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"unknown-link-to-file.txt"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"dir/unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"file.txt/unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">".dotfile/unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"link-to-file.txt/unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">expects</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">testCases</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">fileExists</span><span class="p">(</span><span class="s">"/tmp/golang-test/"</span> <span class="o">+</span> <span class="nx">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nx">expects</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"PASS: %s\n"</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"FAIL: %s\n"</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">fileExists</span><span class="p">(</span><span class="nx">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">pathError</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">PathError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">pathError</span><span class="p">.</span><span class="nx">Err</span> <span class="o">==</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">ENOTDIR</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>

</pre></div>
</div>

<h2>
<span id="実行結果-1" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C-1"><i class="fa fa-link"></i></a>実行結果</h2>

<p>go1.2 darwin/amd64 の実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>PASS: file.txt
PASS: .dotfile
PASS: unknown-dir
PASS: .unknown-dotfile
PASS: unknown-link-to-file.txt
PASS: dir/unknown-dir
PASS: file.txt/unknown-dir
PASS: .dotfile/unknown-dir
PASS: dir
PASS: link-to-file.txt
PASS: unknown-file
PASS: link-to-file.txt/unknown-dir
</pre></div></div>

<p>go1.2 linux/amd64 の実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>PASS: dir
PASS: file.txt
PASS: unknown-dir
PASS: unknown-file
PASS: .unknown-dotfile
PASS: dir/unknown-dir
PASS: file.txt/unknown-dir
PASS: link-to-file.txt/unknown-dir
PASS: .dotfile
PASS: link-to-file.txt
PASS: unknown-link-to-file.txt
PASS: .dotfile/unknown-dir
</pre></div></div>

<p>これで期待するどおりの結果となった。</p>

<h1>
<span id="もっとちゃんとした実装追記-20140219" class="fragment"></span><a href="#%E3%82%82%E3%81%A3%E3%81%A8%E3%81%A1%E3%82%83%E3%82%93%E3%81%A8%E3%81%97%E3%81%9F%E5%AE%9F%E8%A3%85%E8%BF%BD%E8%A8%98-20140219"><i class="fa fa-link"></i></a>もっとちゃんとした実装(追記 2014/02/19)</h1>

<p><a href="http://qiita.com/suin/items/b9c0f92851454dc6d461#comment-70c188ae8ad783fe57f9">kaz8さんのコメント</a>で、ファイルの存在チェックは <code>os.Stat</code> でチェックするだけでいいとのことなので試してみた。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">file-exists3.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">testCases</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{</span>
        <span class="s">"dir"</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s">"file.txt"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s">".dotfile"</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s">"link-to-file.txt"</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="s">"unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"unknown-file"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">".unknown-dotfile"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"unknown-link-to-file.txt"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"dir/unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"file.txt/unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">".dotfile/unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="s">"link-to-file.txt/unknown-dir"</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">expects</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">testCases</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">fileExists</span><span class="p">(</span><span class="s">"/tmp/golang-test/"</span> <span class="o">+</span> <span class="nx">filename</span><span class="p">)</span> <span class="o">==</span> <span class="nx">expects</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"PASS: %s\n"</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"FAIL: %s\n"</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">fileExists</span><span class="p">(</span><span class="nx">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span>
<span class="p">}</span>

</pre></div>
</div>

<h2>
<span id="実行結果-2" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C-2"><i class="fa fa-link"></i></a>実行結果</h2>

<p>go1.2 darwin/amd64 の実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>PASS: dir
PASS: file.txt
PASS: .dotfile
PASS: unknown-dir
PASS: unknown-file
PASS: unknown-link-to-file.txt
PASS: .dotfile/unknown-dir
PASS: link-to-file.txt/unknown-dir
PASS: link-to-file.txt
PASS: .unknown-dotfile
PASS: dir/unknown-dir
PASS: file.txt/unknown-dir
</pre></div></div>

<p>go1.2 linux/amd64 の実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>PASS: dir
PASS: .dotfile
PASS: unknown-file
PASS: unknown-link-to-file.txt
PASS: file.txt
PASS: link-to-file.txt
PASS: unknown-dir
PASS: .unknown-dotfile
PASS: dir/unknown-dir
PASS: file.txt/unknown-dir
PASS: .dotfile/unknown-dir
PASS: link-to-file.txt/unknown-dir
</pre></div></div>

<p>期待通り動いた。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />57位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>29</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/599057e5e30627d2ed10">ワンクリックでGoのスニペットを試せる環境を作る!: CodeRunnerの設定方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-05 16:17:41</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Mac]</b> <b>[Go言語]</b> <b>[CodeRunner]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/4c604e132b25156494561a68c92edd63ec3e7835/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32316165663531392d343934382d666437612d303233302d3536613739353664663139342e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4c604e132b25156494561a68c92edd63ec3e7835/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32316165663531392d343934382d666437612d303233302d3536613739353664663139342e6a706567" alt="01.jpg" title="01.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/21aef519-4948-fd7a-0230-56a7956df194.jpeg"></a></p>

<h1>
<span id="coderunnerとは" class="fragment"></span><a href="#coderunner%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>CodeRunnerとは？</h1>

<p><a href="http://krillapps.com/coderunner/" rel="nofollow noopener" target="_blank">CodeRunner</a>とは、クリックするだけでどんなプログラミング言語でさくっと実行できるエディタです。CodeRunnerを使えば、アルゴリズムやコードスニペットの簡単なテストや実験をサクッと行うことができます。Mac用のアプリでAppStoreにて$9.99で買うことができます。インストール時点で下記の言語に対応してます:</p>

<ul>
<li>AppleScript</li>
<li>C</li>
<li>C++</li>
<li>Java</li>
<li>JavaScript(Node.js)</li>
<li>Lua</li>
<li>Objective-C</li>
<li>Perl</li>
<li>PHP</li>
<li>Python</li>
<li>Ruby</li>
<li>Shell Script</li>
</ul>

<h1>
<span id="goをcoderunnerで実行できるようにする" class="fragment"></span><a href="#go%E3%82%92coderunner%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>GoをCodeRunnerで実行できるようにする</h1>

<p>CodeRunnerは言語を追加することができます。ここではGoを追加して実行できるようにする方法を順を追って解説します。</p>

<p><a href="https://camo.qiitausercontent.com/2fe7427d10044164935c1e4f03475df56e91ea12/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34303330323239622d373531652d326633322d313738362d6334343535343438393534612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2fe7427d10044164935c1e4f03475df56e91ea12/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34303330323239622d373531652d326633322d313738362d6334343535343438393534612e706e67" alt="Screen Shot 2013-07-29 at 11.59.08 AM.png" title="Screen Shot 2013-07-29 at 11.59.08 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/4030229b-751e-2f32-1786-c4455448954a.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/30f8b742ab23d86c034ba4de02770a88bf20555d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35316362326464352d663432642d386431622d306336332d3836616135393038343761622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/30f8b742ab23d86c034ba4de02770a88bf20555d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35316362326464352d663432642d386431622d306336332d3836616135393038343761622e706e67" alt="Preferences.png" title="Preferences.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/51cb2dd5-f42d-8d1b-0c63-86aa590847ab.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/13fb1c37fa55473ffb684d95453f66b744908ea3/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133313230352d676f2d636f646572756e6e65722f312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/13fb1c37fa55473ffb684d95453f66b744908ea3/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133313230352d676f2d636f646572756e6e65722f312e706e67" alt="" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/131205-go-coderunner/1.png"></a></p>

<p>"Run Command" は <code>go fmt $filename &amp;&amp; go run $filename</code> としたが、フォーマットが要らなければ  <code>go run $filename</code> だけでいい。</p>

<p>また、brewでgoをインストールした場合、下記のように "Run Command" を設定しておくとGOPATHが通った状態にしておける</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>GOPATH=$(brew --prefix go) go run $filename
</pre></div></div>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">テンプレート</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">"Golang"</span><span class="p">)</span>
    <span class="o">%</span><span class="err">@</span>
<span class="p">}</span>

</pre></div>
</div>

<p><a href="https://camo.qiitausercontent.com/ebfc7d991a13275da7711fd47ba6b238de0daad5/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133313230352d676f2d636f646572756e6e65722f322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ebfc7d991a13275da7711fd47ba6b238de0daad5/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133313230352d676f2d636f646572756e6e65722f322e706e67" alt="" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/131205-go-coderunner/2.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/9ea0bfb5152fffb6ed425d7df30c5a9784156c2a/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133313230352d676f2d636f646572756e6e65722f332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9ea0bfb5152fffb6ed425d7df30c5a9784156c2a/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f3934393832322f71696974612e636f6d2f3133313230352d676f2d636f646572756e6e65722f332e706e67" alt="" data-canonical-src="https://dl.dropboxusercontent.com/u/949822/qiita.com/131205-go-coderunner/3.png"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />58位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>28</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/23b2c2e7cb7c80ca857e">Go言語:SJISのCSVファイルを読み込む!</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-18 18:52:35</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="この記事の目的" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>この記事の目的</h1>

<ul>
<li>SJISのCSVを読み込めるようになる</li>
</ul>

<h1>
<span id="まずはutf-8のcsvを読み込んでみる" class="fragment"></span><a href="#%E3%81%BE%E3%81%9A%E3%81%AFutf-8%E3%81%AEcsv%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>まずはUTF-8のCSVを読み込んでみる</h1>

<p>まず、UTF-8のCSVファイルを作る</p>

<ul>
<li>改行コード: CR LF</li>
</ul>

<p>Macのエクセルで作ると改行コードがCRになるので注意</p>

<div class="code-frame" data-lang="csv">
<div class="code-lang"><span class="bold">/tmp/chibashi.csv</span></div>
<div class="highlight"><pre><span></span>ku,male population,female population
Chuoku,"202,213","102,080"
Hanamigawaku,"179,698","89,369"
Inageku,"156,612","78,199"
Wakabaku,"151,165","76,159"
Midoriku,"125,956","62,042"
Mihamaku,"148,951","72,806"
</pre></div>
</div>

<p>めんどくさい人は wget で落としてください</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>wget -O /tmp/chibashi.csv https://dl.dropboxusercontent.com/u/949822/qiita.com/131218-golang-read-csv/chibashi.csv
</pre></div></div>

<p>コードを書く</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"encoding/csv"</span>
    <span class="s">"io"</span>
    <span class="s">"log"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">"Error:"</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">"/tmp/chibashi.csv"</span><span class="p">)</span>
    <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="nx">reader</span> <span class="o">:=</span> <span class="nx">csv</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">record</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">()</span> <span class="c1">// 1行読み出す</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%#v"</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>

<p>実行する</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run main.go
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">17</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">42</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"ku"</span><span class="p">,</span> <span class="s">"male population"</span><span class="p">,</span> <span class="s">"female population"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">17</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">42</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Chuoku"</span><span class="p">,</span> <span class="s">"202,213"</span><span class="p">,</span> <span class="s">"102,080"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">17</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">42</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Hanamigawaku"</span><span class="p">,</span> <span class="s">"179,698"</span><span class="p">,</span> <span class="s">"89,369"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">17</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">42</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Inageku"</span><span class="p">,</span> <span class="s">"156,612"</span><span class="p">,</span> <span class="s">"78,199"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">17</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">42</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Wakabaku"</span><span class="p">,</span> <span class="s">"151,165"</span><span class="p">,</span> <span class="s">"76,159"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">17</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">42</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Midoriku"</span><span class="p">,</span> <span class="s">"125,956"</span><span class="p">,</span> <span class="s">"62,042"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">17</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">42</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Mihamaku"</span><span class="p">,</span> <span class="s">"148,951"</span><span class="p">,</span> <span class="s">"72,806"</span><span class="p">}</span>
</pre></div></div>

<h1>
<span id="sjisのcsvを読み込んでみる" class="fragment"></span><a href="#sjis%E3%81%AEcsv%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>SJISのCSVを読み込んでみる</h1>

<ul>
<li>文字コード: SJIS</li>
<li>改行コード: CR LF</li>
</ul>

<p>Macのエクセルで作ると改行コードがCRになるので注意</p>

<div class="code-frame" data-lang="csv">
<div class="code-lang"><span class="bold">/tmp/chibashi-sjis.csv</span></div>
<div class="highlight"><pre><span></span>区,男性人口,女性人口,,,,,,
中央区,"202,213","102,080",,,,,,
花見川区,"179,698","89,369",,,,,,
稲毛区,"156,612","78,199",,,,,,
若葉区,"151,165","76,159",,,,,,
緑区,"125,956","62,042",,,,,,
美浜区,"148,951","72,806",,,,,,
</pre></div>
</div>

<p>めんどくさい人は wget で落としてください</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>wget -O /tmp/chibashi-sjis.csv https://dl.dropboxusercontent.com/u/949822/qiita.com/131218-golang-read-csv/chibashi-sjis.csv
</pre></div></div>

<p>SJISからUTF-8への変換はgithub.com/djimenez/iconv-go を使う。io.Readerのインターフェイスにそって作ってあるので、os.Fileとcsv.Readerとの間に挟んであげると、SJISをUTF-8に変換しながらCSVを読み込めるようになる。</p>

<p>github.com/djimenez/iconv-go をダウンロードする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go get github.com/djimenez/iconv-go
</pre></div></div>

<p>コードを書く</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"encoding/csv"</span>
    <span class="nx">iconv</span> <span class="s">"github.com/djimenez/iconv-go"</span>
    <span class="s">"io"</span>
    <span class="s">"log"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">"Error:"</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">"/tmp/chibashi-sjis.csv"</span><span class="p">)</span>
    <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="nx">converter</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">iconv</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="s">"sjis"</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">)</span>
    <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

    <span class="nx">reader</span> <span class="o">:=</span> <span class="nx">csv</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">converter</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">record</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">reader</span><span class="p">.</span><span class="nx">Read</span><span class="p">()</span> <span class="c1">// 1行読み出す</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"%#v"</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>

<p>実行する</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run main.go
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">41</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"区"</span><span class="p">,</span> <span class="s">"男性人口"</span><span class="p">,</span> <span class="s">"女性人口"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">41</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"中央区"</span><span class="p">,</span> <span class="s">"202,213"</span><span class="p">,</span> <span class="s">"102,080"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">41</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"花見川区"</span><span class="p">,</span> <span class="s">"179,698"</span><span class="p">,</span> <span class="s">"89,369"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">41</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"稲毛区"</span><span class="p">,</span> <span class="s">"156,612"</span><span class="p">,</span> <span class="s">"78,199"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">41</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"若葉区"</span><span class="p">,</span> <span class="s">"151,165"</span><span class="p">,</span> <span class="s">"76,159"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">41</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"緑区"</span><span class="p">,</span> <span class="s">"125,956"</span><span class="p">,</span> <span class="s">"62,042"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">41</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"美浜区"</span><span class="p">,</span> <span class="s">"148,951"</span><span class="p">,</span> <span class="s">"72,806"</span><span class="p">}</span>
</pre></div></div>

<p>ちなみにiconvを外すと下記のようにSJISのまま読み込まる:</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">52</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"��"</span><span class="p">,</span> <span class="s">"�j���l��"</span><span class="p">,</span> <span class="s">"�����l��"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">52</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"������"</span><span class="p">,</span> <span class="s">"202,213"</span><span class="p">,</span> <span class="s">"102,080"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">52</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"�Ԍ�����"</span><span class="p">,</span> <span class="s">"179,698"</span><span class="p">,</span> <span class="s">"89,369"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">52</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"���ы�"</span><span class="p">,</span> <span class="s">"156,612"</span><span class="p">,</span> <span class="s">"78,199"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">52</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"���t��"</span><span class="p">,</span> <span class="s">"151,165"</span><span class="p">,</span> <span class="s">"76,159"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">52</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"�\u038b�"</span><span class="p">,</span> <span class="s">"125,956"</span><span class="p">,</span> <span class="s">"62,042"</span><span class="p">}</span>
<span class="mi">2013</span><span class="o">/</span><span class="mi">12</span><span class="o">/</span><span class="mi">18</span> <span class="mi">18</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">52</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"���l��"</span><span class="p">,</span> <span class="s">"148,951"</span><span class="p">,</span> <span class="s">"72,806"</span><span class="p">}</span>
</pre></div></div>

<p>次回: <a href="http://qiita.com/suin/items/347ecda071a6999e5d22" id="reference-1fe70e307de93a99f68c">Go言語: SJISのCSVを読み込みながら1行毎に処理を実行する</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />59位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>28</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/99c95c6b2182b54d9405">PHPでメソッドを動的に追加する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-08-11 01:05:00</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[JavaScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>JavaScriptではオブジェクトに後からメソッド追加して、オブジェクトを動的に拡張できますよね。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nb">Object</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="s2">"foo"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">();</span>

<span class="nx">object</span><span class="p">.</span><span class="nx">getFoo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span><span class="p">.</span><span class="nx">getFoo</span><span class="p">());</span> <span class="c1">// foo</span>
</pre></div></div>

<p>PHP5.4からは <code>Closure::bind()</code> を使うとこれと似たようなことができます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Object</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$dynamicMethods</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">protected</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$callback</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dynamicMethods</span><span class="p">[</span><span class="nv">$name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Closure</span><span class="o">::</span><span class="na">bind</span><span class="p">(</span><span class="nv">$callback</span><span class="p">,</span> <span class="nv">$this</span><span class="p">,</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$this</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$arguments</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">call_user_func_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dynamicMethods</span><span class="p">[</span><span class="nv">$method</span><span class="p">],</span> <span class="nv">$arguments</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// オブジェクトを作る</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Object</span><span class="p">();</span>

<span class="c1">// 後からメソッドを追加する</span>
<span class="nv">$object</span><span class="o">-&gt;</span><span class="na">getFoo</span> <span class="o">=</span> <span class="k">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// 追加したメソッドを呼び出す</span>
<span class="k">echo</span> <span class="nv">$object</span><span class="o">-&gt;</span><span class="na">getFoo</span><span class="p">();</span>
</pre></div></div>

<p>ただし、カプセル化を破壊するので、使い所は計画的かつ慎重に判断したほうがいいです。</p>

<p>せっかく <code>trait</code> が使えるので、この動的メソッド追加の処理をトレイト化すると再利用性が高まり、動的メソッド追加を実装するクラスも形式的なコードが少なくなりますね。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;?php

trait DynamicMethodTrait
{
    private $__dynamicMethods = [];


    public function addDynamicMethod($name, Closure $callback)
    {
        $this-&gt;__dynamicMethods[$name] = Closure::bind($callback, $this, get_class($this));
    }

    public function __call($method, array $arguments)
    {
        return call_user_func_array($this-&gt;__dynamicMethods[$method], $arguments);
    }
}

class Object
{
    use DynamicMethodTrait;

    private $foo = 'foo';
}

$object = new Object();
$object-&gt;addDynamicMethod('getFoo', function(){
    return $this-&gt;foo;
});

echo $object-&gt;getFoo();
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />60位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>27</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/523817ead3b30b9578bd">【質問】Scalaのcase classはグッドパーツですか?</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-06 12:37:25</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> <b>[Q&A]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>下記の特性を踏まえた上で質問を2つさせてください。</p>

<h2>
<span id="class-と-case-class-を比べたときに次のような特性があります" class="fragment"></span><a href="#class-%E3%81%A8-case-class-%E3%82%92%E6%AF%94%E3%81%B9%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AB%E6%AC%A1%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E7%89%B9%E6%80%A7%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99"><i class="fa fa-link"></i></a>class と case class を比べたときに次のような特性があります</h2>

<ul>
<li>
<code>new</code> を書かなくても良い</li>
</ul>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Foo</span><span class="o">()</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">Foo</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">NoneCaseFoo</span><span class="o">()</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">NoneCaseFoo</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Foo</span><span class="o">()</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">Foo</span> <span class="o">=</span> <span class="nc">Foo</span><span class="o">()</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">new</span> <span class="nc">Foo</span><span class="o">()</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">Foo</span> <span class="o">=</span> <span class="nc">Foo</span><span class="o">()</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">NoneCaseFoo</span><span class="o">()</span>
<span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">8</span><span class="k">:</span> <span class="kt">error:</span> <span class="kt">not</span> <span class="kt">found:</span> <span class="kt">value</span> <span class="kt">NoneCaseFoo</span>
              <span class="nc">NoneCaseFoo</span><span class="o">()</span>
</pre></div></div>

<ul>
<li>case class は <code>equals</code> メソッドを自動で実装してくれる</li>
</ul>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Card</span><span class="o">(</span><span class="n">value</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">Card</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">NoneCaseCard</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">NoneCaseCard</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">card1</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">NoneCaseCard</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="n">card1</span><span class="k">:</span> <span class="kt">NoneCaseCard</span> <span class="o">=</span> <span class="nc">NoneCaseCard</span><span class="k">@</span><span class="mi">58</span><span class="n">a0ee03</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">card2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">NoneCaseCard</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="n">card2</span><span class="k">:</span> <span class="kt">NoneCaseCard</span> <span class="o">=</span> <span class="nc">NoneCaseCard</span><span class="k">@</span><span class="mi">7</span><span class="n">e19c472</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">card1</span> <span class="o">==</span> <span class="n">card2</span>
<span class="n">res2</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">==</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="n">res3</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span>
</pre></div></div>

<ul>
<li>
<code>match</code> キーワードで型+値のパターンマッチができる</li>
</ul>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">name</span><span class="o">(</span><span class="n">card</span><span class="k">:</span><span class="kt">Card</span><span class="o">)</span> <span class="k">=</span> <span class="n">card</span> <span class="k">match</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="k">case</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">"Alice"</span>
     <span class="o">|</span>   <span class="k">case</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">"Bob"</span>
     <span class="o">|</span>   <span class="k">case</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">"Carol"</span>
     <span class="o">|</span>   <span class="k">case</span> <span class="nc">Card</span><span class="o">(</span><span class="n">x</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">toString</span><span class="o">()</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">name</span><span class="k">:</span> <span class="o">(</span><span class="kt">card:</span> <span class="kt">Card</span><span class="o">)</span><span class="kt">String</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">name</span><span class="o">(</span><span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
<span class="n">res4</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Carol</span>
</pre></div></div>

<ul>
<li>
<code>toString</code> を自動で実装してくれる</li>
</ul>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="n">println</span><span class="o">(</span><span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
<span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
</pre></div></div>

<ul>
<li>ゲッターを自動で実装してくれる</li>
</ul>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Card</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="n">value</span>
<span class="n">res6</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div></div>

<ul>
<li>copyを自動で実装してくれる</li>
</ul>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Product</span><span class="o">(</span><span class="n">name</span><span class="k">:</span><span class="kt">String</span><span class="o">,</span> <span class="n">price</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">Product</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">product</span> <span class="k">=</span> <span class="nc">Product</span><span class="o">(</span><span class="s">"Bear"</span><span class="o">,</span> <span class="mi">200</span><span class="o">)</span>
<span class="n">product</span><span class="k">:</span> <span class="kt">Product</span> <span class="o">=</span> <span class="nc">Product</span><span class="o">(</span><span class="nc">Bear</span><span class="o">,</span><span class="mi">200</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">productForSale</span> <span class="k">=</span> <span class="n">product</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">price</span> <span class="k">=</span> <span class="mi">150</span><span class="o">)</span>
<span class="n">productForSale</span><span class="k">:</span> <span class="kt">Product</span> <span class="o">=</span> <span class="nc">Product</span><span class="o">(</span><span class="nc">Bear</span><span class="o">,</span><span class="mi">150</span><span class="o">)</span>
</pre></div></div>

<h2>
<span id="q1-case-class-はグッドパーツですか" class="fragment"></span><a href="#q1-case-class-%E3%81%AF%E3%82%B0%E3%83%83%E3%83%89%E3%83%91%E3%83%BC%E3%83%84%E3%81%A7%E3%81%99%E3%81%8B"><i class="fa fa-link"></i></a>Q1: case class はグッドパーツですか?</h2>

<p>私はPHPくらいしか知らないので、case classに馴染みがありません。case classは便利な点が多そうですが、classと同じように使っても問題ないのでしょうか? バッドパーツではないですよね?</p>

<h2>
<span id="q2-全部-case-class-で書くべき" class="fragment"></span><a href="#q2-%E5%85%A8%E9%83%A8-case-class-%E3%81%A7%E6%9B%B8%E3%81%8F%E3%81%B9%E3%81%8D"><i class="fa fa-link"></i></a>Q2: 全部 case class で書くべき?</h2>

<p>case class は <code>new</code> を書かなくてよかったりと、普通の classより便利なのですが、全部 case class で書いたほうがいいのでしょうか? それとも、適材適所なのでしょうか? 使い分けがあれば教えて下さい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />61位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>27</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/1c862635265de315a99f">PHPでMySQLの大量の検索結果を扱うためのMySQLResultIterator</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-02-17 12:11:34</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>10000行をCSVに出力したい。<br>
PDO使えない(´・ω・｀)<br>
10000行なんて、一度にすべてを配列にしたらメモリに乗らない(´・ω・｀)</p>

<p>そんなときは、こんなふうにイテレータにしておくと、<br>
・メモリを節約しながら10000行のレコードを処理でき、<br>
・モデルからイテレータオブジェクトを返すことで、カプセル化とポリモーフィズムも実現できる。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">'MySQLResultIterator.php'</span><span class="p">;</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">'SELECT * FROM foo'</span><span class="p">);</span> <span class="c1">// 10000行</span>

<span class="k">if</span> <span class="p">(</span> <span class="nv">$result</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$rows</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySQLResultIterator</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$rows</span> <span class="k">as</span> <span class="nv">$row</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ここで行ごとに echo するなり、file_put_contents()するなり</span>
<span class="p">}</span>

</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">MySQLResultIterator.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * MySQLの結果イテレータ</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MySQLResultIterator</span> <span class="k">implements</span> <span class="nx">SeekableIterator</span><span class="p">,</span> <span class="nx">Countable</span>
<span class="p">{</span>
    <span class="sd">/** @var resource */</span>
    <span class="k">protected</span> <span class="nv">$result</span>   <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$total</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nb">is_resource</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span> <span class="k">or</span> <span class="nb">get_resource_type</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">'mysql result'</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="s2">"Result type must be MySQL result set."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$total</span> <span class="o">=</span> <span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nv">$total</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s2">"Failed to detect row count."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">result</span> <span class="o">=</span> <span class="nv">$result</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">total</span>  <span class="o">=</span> <span class="nv">$total</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 最初の行に巻き戻す</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rewind</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isValid</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nb">mysql_data_seek</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">result</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 現在の行を返す</span>
<span class="sd">     * @return array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$current</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">result</span><span class="p">);</span>
        <span class="nb">mysql_data_seek</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">result</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">position</span><span class="p">);</span> <span class="c1">// 進んだぶん、戻す</span>
        <span class="k">return</span> <span class="nv">$current</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 現在の行のキーを返す</span>
<span class="sd">     * @return int</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">position</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 次の行に進む</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">next</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">position</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isValid</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">position</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nb">mysql_data_seek</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">result</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">position</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 現在位置が有効かどうかを調べる</span>
<span class="sd">     * @return bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">valid</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isValid</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">position</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 行数を返す</span>
<span class="sd">     * @return int</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">total</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * 行を移動する</span>
<span class="sd">     * @param int $position</span>
<span class="sd">     * @throws OutOfBoundsException</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">seek</span><span class="p">(</span><span class="nv">$position</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$position</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$position</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_isValid</span><span class="p">(</span><span class="nv">$position</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">OutOfBoundsException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nb">mysql_data_seek</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">result</span><span class="p">,</span> <span class="nv">$position</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_isValid</span><span class="p">(</span><span class="nv">$position</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span> <span class="nv">$position</span> <span class="o">&lt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">total</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />62位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>25</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/bb9d817af5ccedb18be9">Go言語でCSVを書き出す!エクセル用のSJIS版も!</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-12 22:03:01</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>デフォルトで用意されている<a href="http://golang.org/pkg/encoding/csv/" rel="nofollow noopener" target="_blank">encoding/csv</a>を使うのが楽みたい。日本語も出力できる。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"encoding/csv"</span>
    <span class="s">"log"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">"Error:"</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// O_WRONLY:書き込みモード開く, O_CREATE:無かったらファイルを作成</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="s">"/tmp/people.csv"</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">,</span> <span class="mo">0600</span><span class="p">)</span>
    <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="nx">err</span> <span class="p">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// ファイルを空っぽにする(実行2回目以降用)</span>
    <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

    <span class="nx">writer</span> <span class="o">:=</span> <span class="nx">csv</span><span class="p">.</span><span class="nx">NewWriter</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
    <span class="nx">writer</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Alice"</span><span class="p">,</span> <span class="s">"20"</span><span class="p">})</span>
    <span class="nx">writer</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Bob"</span><span class="p">,</span> <span class="s">"21"</span><span class="p">})</span>
    <span class="nx">writer</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Carol"</span><span class="p">,</span> <span class="s">"22"</span><span class="p">})</span>
    <span class="nx">writer</span><span class="p">.</span><span class="nx">Flush</span><span class="p">()</span>
<span class="p">}</span>

</pre></div>
</div>

<p><code>writer.Write</code>でバッファにためて、<code>writer.Flush</code>で一気に書き込むようだ。</p>

<p>実行してみる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run csv.go &amp;&amp; cat /tmp/people.csv
</pre></div></div>

<p>実行結果</p>

<div class="code-frame" data-lang="csv"><div class="highlight"><pre><span></span>Alice,20
Bob,21
Carol,22
</pre></div></div>

<h1>
<span id="csvをsjisで出したい" class="fragment"></span><a href="#csv%E3%82%92sjis%E3%81%A7%E5%87%BA%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>CSVをSJISで出したい</h1>

<p>CSVを出す目的はだいたいがエクセルで開くため。<br>
日本語のエクセルは文字コードがSJISなので、SJISでCSVを出力してみる。</p>

<p>UTF-8からSJISへの変換は、<a href="https://github.com/djimenez/iconv-go" rel="nofollow noopener" target="_blank">github.com/djimenez/iconv-go</a> を使う。<code>io.Writer</code>のインターフェイスにそって作ってある。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"encoding/csv"</span>
    <span class="nx">iconv</span> <span class="s">"github.com/djimenez/iconv-go"</span>
    <span class="s">"log"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">"Error:"</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// O_WRONLY:書き込みモード開く, O_CREATE:無かったらファイルを作成</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="s">"/tmp/people.csv"</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">,</span> <span class="mo">0600</span><span class="p">)</span>
    <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="nx">err</span> <span class="p">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// ファイルを空っぽにする(2回目以降用)</span>
    <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

    <span class="nx">converter</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">iconv</span><span class="p">.</span><span class="nx">NewWriter</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">,</span> <span class="s">"sjis"</span><span class="p">)</span>
    <span class="nx">failOnError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

    <span class="nx">writer</span> <span class="o">:=</span> <span class="nx">csv</span><span class="p">.</span><span class="nx">NewWriter</span><span class="p">(</span><span class="nx">converter</span><span class="p">)</span>
    <span class="nx">writer</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"山田"</span><span class="p">,</span> <span class="s">"20"</span><span class="p">})</span>
    <span class="nx">writer</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"田中"</span><span class="p">,</span> <span class="s">"21"</span><span class="p">})</span>
    <span class="nx">writer</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">"佐藤"</span><span class="p">,</span> <span class="s">"22"</span><span class="p">})</span>
    <span class="nx">writer</span><span class="p">.</span><span class="nx">Flush</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行してみる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run csv.go &amp;&amp; open /tmp/people.csv
</pre></div></div>

<p>実行結果</p>

<p><a href="https://camo.qiitausercontent.com/e2f4dd94246948a3d1b77751e95f1d5431cec257/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37653932323262372d313332342d303237662d303136392d6162626134366634633566652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e2f4dd94246948a3d1b77751e95f1d5431cec257/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37653932323262372d313332342d303237662d303136392d6162626134366634633566652e706e67" alt="Screen Shot 2013-12-12 at 22.00.59.png" title="Screen Shot 2013-12-12 at 22.00.59.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/7e9222b7-1324-027f-0169-abba46f4c5fe.png"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />63位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>25</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/d8ec606f18e74044e5e8">PHPerだが、Scalaのフレームワーク「Scalatra」を使ってみる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-27 16:45:29</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> <b>[Scalatra]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Scalatra = Scalaで書かれたウェブマイクロフレームワーク</p>

<p>PHPでいうと、Silex的なもの。</p>

<h1>
<span id="1-インストール" class="fragment"></span><a href="#1-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>1. インストール</h1>

<p><a href="http://www.scalatra.org/getting-started/installation.html" rel="nofollow noopener" target="_blank">Installation | Scalatra(英語)</a> に書いてある内容に従ってやる</p>

<h2>
<span id="11-jdkをインストールする" class="fragment"></span><a href="#11-jdk%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1.1. JDKをインストールする</h2>

<p><code>java -version</code> と <code>javac -version</code> を実行して、自分の環境にJDKがインストールされているか確認する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ java -version
java version "1.6.0_24"
OpenJDK Runtime Environment (IcedTea6 1.11.1) (6b24-1.11.1-3)
OpenJDK 64-Bit Server VM (build 20.0-b12, mixed mode)
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ javac -version
javac 1.6.0_24
</pre></div></div>

<p>バージョン1.6以降が必要。</p>

<h2>
<span id="12-giter8をインストールする" class="fragment"></span><a href="#12-giter8%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>1.2. giter8をインストールする</h2>

<p>Conscriptをインストールする</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ curl https://raw.github.com/n8han/conscript/master/setup.sh | sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   725  100   725    0     0    747      0 --:--:-- --:--:-- --:--:--  1139

Fetching current launch configuration...

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   242  100   242    0     0    261      0 --:--:-- --:--:-- --:--:--   313

Fetching launcher...

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 1079k  100 1079k    0     0   179k      0  0:00:06  0:00:06 --:--:--  224k

conscript installed to /Users/suin/bin/cs
</pre></div></div>

<p>giter8をインストールする</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cs n8han/giter8
Getting net.databinder.conscript conscript_2.9.1 0.4.1 ...
downloading https://oss.sonatype.org/content/repositories/releases/net/databinder/conscript/conscript_2.9.1/0.4.1/

…いっぱいダウンロードされる

downloading http://repo1.maven.org/maven2/com/jcraft/jsch/0.1.44-1/jsch-0.1.44-1.jar ...
    [SUCCESSFUL ] com.jcraft#jsch;0.1.44-1!jsch.jar (243ms)
:: retrieving :: org.scala-sbt#boot-app
    confs: [default]
    25 artifacts copied, 0 already retrieved (4251kB/32ms)

giter8 0.5.3
Usage: g8 [TEMPLATE] [OPTION]...
Apply specified template.

OPTIONS
    -b, --branch
        Resolves a template within a given branch
    --paramname=paramvalue
        Set given parameter value and bypass interaction.


Apply template and interactively fulfill parameters.
    g8 n8han/giter8

Or
    g8 git://github.com/n8han/giter8.git

Apply template from a remote branch
    g8 n8han/giter8 -b some-branch

Apply template from a local repo
    g8 file://path/to/the/repo

Apply given name parameter and use defaults for all others.
    g8 n8han/giter8 --name=template-test




Conscripted n8han/giter8 to /Users/suin/bin/g8
</pre></div></div>

<h1>
<span id="2-最初のプロジェクト" class="fragment"></span><a href="#2-%E6%9C%80%E5%88%9D%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><i class="fa fa-link"></i></a>2. 最初のプロジェクト</h1>

<h2>
<span id="21-scalatraプロジェクトを生成" class="fragment"></span><a href="#21-scalatra%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E7%94%9F%E6%88%90"><i class="fa fa-link"></i></a>2.1 Scalatraプロジェクトを生成</h2>

<p>インタラクティブシェルでプロジェクト名などを聞かれるので適当に入力していく</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ g8 scalatra/scalatra-sbt 
organization [com.example]: org.suin
package [com.example.app]: org.suin.helloworld
name [My Scalatra Web App]: My Scalatra Hello World
scalatra_version [2.2.1]: 
servlet_name [MyScalatraServlet]: 
scala_version [2.10.2]: 
version [0.1.0-SNAPSHOT]: 

Template applied in ./my-scalatra-hello-world
</pre></div></div>

<h2>
<span id="22-ビルド" class="fragment"></span><a href="#22-%E3%83%93%E3%83%AB%E3%83%89"><i class="fa fa-link"></i></a>2.2 ビルド</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd my-scalatra-hello-world/
$ chmod u+x sbt 
$ ./sbt
…いろいろダウンロードされる

&gt; container:start

って入力すると、
コンパイルされて、localhost:8080 でサーバが立ち上がる
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&gt; browse
</pre></div></div>

<p>と叩くとブラウザが立ち上がって localhost:8080 につなぎに行ってくれる。(Macでためした)</p>

<h2>
<span id="23-自動リロード" class="fragment"></span><a href="#23-%E8%87%AA%E5%8B%95%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>2.3 自動リロード</h2>

<p><code>sbt</code> のコンソールで <code>~ ;copy-resources;aux-compile</code> と入力すると、ファイル更新時に自動でコンパイルしてくれるようになる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ./sbt
&gt; ~ ;copy-resources;aux-compile
</pre></div></div>

<p>ENTERを押すと自動リロードを中断できる。</p>

<h1>
<span id="3-プロジェクトの構造" class="fragment"></span><a href="#3-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%A7%8B%E9%80%A0"><i class="fa fa-link"></i></a>3 プロジェクトの構造</h1>

<h2>
<span id="31-パス" class="fragment"></span><a href="#31-%E3%83%91%E3%82%B9"><i class="fa fa-link"></i></a>3.1 パス</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>project
|_build.properties      &lt;= どのバージョンのsbtを使うか指定する
|_build.scala           &lt;= プロジェクトの設定と依存関係がここに入ってる
|_plugins.sbt           &lt;= sbtのプラグインはここに入る

src
|_ main
|  |_ scala
|  |  |   |_ScalatraBootstrap.scala     &lt;= mount servlets in here
|  |  |_org
|  |      |_ yourdomain
|  |         |_ projectname
|  |            |_ MyScalatraServlet.scala
|  |_ webapp
|     |_ WEB-INF
|        |_ views
|        |  |_ hello-scalate.scaml
|        |_ layouts
|        |  |_ default.scaml
|        |_ web.xml
|_ test
   |_ scala
      |_ org
         |_ yourdomain
            |_ projectname
               |_ MyScalatraServletSpec.scala
</pre></div></div>

<h2>
<span id="32-静的ファイルをあつかう" class="fragment"></span><a href="#32-%E9%9D%99%E7%9A%84%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%81%82%E3%81%A4%E3%81%8B%E3%81%86"><i class="fa fa-link"></i></a>3.2 静的ファイルをあつかう</h2>

<p><code>webapp</code> ディレクトリに置くだけ。 ただし、<code>WEB-INF</code> の中身は公開されない。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ echo 'test' &gt; hoge.html
</pre></div></div>

<p><code>http://localhost:8080/hoge.html</code> をブラウザで見ると <code>test</code> を表示される。</p>

<h1>
<span id="4-ideをそろえる" class="fragment"></span><a href="#4-ide%E3%82%92%E3%81%9D%E3%82%8D%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>4. IDEをそろえる</h1>

<p>公式サイトのドキュメント <a href="http://www.scalatra.org/getting-started/ide-support.html" rel="nofollow noopener" target="_blank">IDE Support (optional)</a> ではEclipse、IntelliJ、ENSIMEについて解説してるが、PhpStromに慣れてるので姉妹アプリのIntelliJを選択した。</p>

<ul>
<li>
<a href="http://www.jetbrains.com/idea/download/index.html" rel="nofollow noopener" target="_blank">IntelliJ IDEA</a>のcommunityエディションをダウンロードする</li>
<li>
<a href="https://github.com/mpeltonen/sbt-idea" rel="nofollow noopener" target="_blank">Scala plugin</a>をJetBrainsからダウンロードする(IntelliJを起動して、Preference &gt; Plugins &gt; Install JetBrains plugins にて Scala で検索してインストールするほうが便利)</li>
<li>
<code>project/plugins.sbt</code> に以下の行を追加して、<a href="https://github.com/mpeltonen/sbt-idea" rel="nofollow noopener" target="_blank">sbt-idea</a>プラグインをインストールする</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>addSbtPlugin("com.github.mpeltonen" % "sbt-idea" % "1.5.2")
</pre></div></div>

<p>※上記記述はバージョン番号が古くなっている場合があります。最新のバージョンは <a href="https://github.com/mpeltonen/sbt-idea" rel="nofollow noopener" target="_blank">sbt-idea</a> で調べてください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ./sbt
&gt; gen-idea
</pre></div></div>

<h1>
<span id="5-サンプルを入手する" class="fragment"></span><a href="#5-%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%92%E5%85%A5%E6%89%8B%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>5. サンプルを入手する</h1>

<p><a href="https://github.com/scalatra/scalatra-website-examples" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/scalatra/scalatra-website-examples</a> でScalatraのサンプルが配布されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>hub clone scalatra/scalatra-website-examples
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />64位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>25</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/c581eb9cc7e6009b19d2">CoffeeScriptで作るjQueryプラグイン</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-02-15 13:39:12</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[CoffeeScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>たぶん動く。</p>

<div class="code-frame" data-lang="coffeescript"><div class="highlight"><pre><span></span><span class="nx">do</span> <span class="nf">(jQuery) -&gt;</span>
  <span class="nv">$ = </span><span class="nx">jQuery</span>
  <span class="nv">$.fn.mypluin = </span><span class="nf">(config) -&gt;</span>
    <span class="nv">defaultConfig =</span>
      <span class="nv">color: </span><span class="s">'red'</span>
    <span class="nv">options = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">defaultConfig</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
    <span class="nx">@each</span> <span class="nf">() -&gt;</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s">'color'</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">red</span><span class="p">)</span>
</pre></div></div>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">$</span><span class="p">;</span>
  <span class="nx">$</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">mypluin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">defaultConfig</span><span class="p">,</span> <span class="nx">options</span><span class="p">;</span>
    <span class="nx">defaultConfig</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">color</span><span class="o">:</span> <span class="s1">'red'</span>
    <span class="p">};</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">defaultConfig</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">'color'</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">red</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />65位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/ed0957dc45ecdcf3963c">Qiita投稿のストック数・コメント数・ツイート数・はてぶ数・いいね数・ページビュー数を取得する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-03 18:43:09</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> <b>[PHP]</b> <b>[QiitaAPI]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="ストック数コメント数ツイート数はてぶ数いいね数を取得する" class="fragment"></span><a href="#%E3%82%B9%E3%83%88%E3%83%83%E3%82%AF%E6%95%B0%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E6%95%B0%E3%83%84%E3%82%A4%E3%83%BC%E3%83%88%E6%95%B0%E3%81%AF%E3%81%A6%E3%81%B6%E6%95%B0%E3%81%84%E3%81%84%E3%81%AD%E6%95%B0%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ストック数・コメント数・ツイート数・はてぶ数・いいね数を取得する</h2>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">const</span> <span class="no">USERNAME</span> <span class="o">=</span> <span class="s2">"suin"</span><span class="p">;</span>
<span class="k">const</span> <span class="no">COUNT</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="nb">error_reporting</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">'display_errors'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nv">$filename</span> <span class="o">=</span> <span class="s1">'https://qiita.com/api/v1/users/'</span><span class="o">.</span><span class="nx">USERNAME</span><span class="o">.</span><span class="s1">'/items?per_page='</span><span class="o">.</span><span class="nx">COUNT</span><span class="p">;</span>

<span class="nv">$contents</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

<span class="nv">$items</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$contents</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nv">$items</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="k">array</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">'url'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="s1">'url'</span><span class="p">],</span>
        <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="s1">'title'</span><span class="p">],</span>
        <span class="s1">'created_at'</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="nv">$item</span><span class="p">[</span><span class="s1">'created_at'</span><span class="p">]))</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">),</span>
            <span class="s1">'stock_count'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="s1">'stock_count'</span><span class="p">],</span>
            <span class="s1">'comment_count'</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">[</span><span class="s1">'comment_count'</span><span class="p">],</span>
            <span class="s1">'content_length'</span> <span class="o">=&gt;</span> <span class="nb">mb_strlen</span><span class="p">(</span><span class="nv">$item</span><span class="p">[</span><span class="s1">'raw_body'</span><span class="p">],</span> <span class="s1">'UTF-8'</span><span class="p">),</span>
    <span class="p">];</span>
<span class="p">},</span> <span class="nv">$items</span><span class="p">);</span>

<span class="nb">usort</span><span class="p">(</span><span class="nv">$items</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$item1</span><span class="p">,</span> <span class="nv">$item2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$created1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="nv">$item1</span><span class="p">[</span><span class="s1">'created_at'</span><span class="p">]);</span>
    <span class="nv">$created2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="nv">$item2</span><span class="p">[</span><span class="s1">'created_at'</span><span class="p">]);</span>

    <span class="k">return</span> <span class="p">(</span><span class="nv">$created1</span> <span class="o">&gt;=</span> <span class="nv">$created2</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">});</span>

<span class="k">echo</span> <span class="s2">"created: "</span><span class="p">,</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="k">echo</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span> <span class="p">[</span>
    <span class="s2">"date"</span><span class="p">,</span>
    <span class="s2">"stocks"</span><span class="p">,</span>
    <span class="s2">"comments"</span><span class="p">,</span>
    <span class="s2">"hatena"</span><span class="p">,</span>
    <span class="s2">"tweets"</span><span class="p">,</span>
    <span class="s2">"likes"</span><span class="p">,</span>
    <span class="s2">"chars"</span><span class="p">,</span>
    <span class="s2">"url"</span><span class="p">,</span>
    <span class="s2">"title"</span><span class="p">,</span>
<span class="p">]),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$items</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$fb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$hateb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$tweets</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$fb</span> <span class="o">=</span> <span class="nx">get_fb</span><span class="p">(</span><span class="nv">$item</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]);</span>
    <span class="nv">$hateb</span> <span class="o">=</span> <span class="nx">get_hatena_count</span><span class="p">(</span><span class="nv">$item</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]);</span>
    <span class="nv">$tweets</span> <span class="o">=</span> <span class="nx">get_tweets</span><span class="p">(</span><span class="nv">$item</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]);</span>

    <span class="k">echo</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span> <span class="p">[</span>
        <span class="nv">$item</span><span class="p">[</span><span class="s1">'created_at'</span><span class="p">],</span>
        <span class="nv">$item</span><span class="p">[</span><span class="s1">'stock_count'</span><span class="p">],</span>
        <span class="nv">$item</span><span class="p">[</span><span class="s1">'comment_count'</span><span class="p">],</span>
        <span class="nv">$hateb</span><span class="p">,</span>
        <span class="nv">$tweets</span><span class="p">,</span>
        <span class="nv">$fb</span><span class="p">,</span>
        <span class="nv">$item</span><span class="p">[</span><span class="s1">'content_length'</span><span class="p">],</span>
        <span class="nv">$item</span><span class="p">[</span><span class="s1">'url'</span><span class="p">],</span>
        <span class="nv">$item</span><span class="p">[</span><span class="s1">'title'</span><span class="p">],</span>
    <span class="p">]),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_hatena_count</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$url</span> <span class="o">=</span> <span class="s1">'http://api.b.st-hatena.com/entry.count?url='</span><span class="o">.</span><span class="nb">urlencode</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_tweets</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$url</span> <span class="o">=</span> <span class="s1">'http://urls.api.twitter.com/1/urls/count.json?url='</span><span class="o">.</span><span class="nb">urlencode</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
    <span class="nv">$json</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_fb</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$url</span> <span class="o">=</span> <span class="s1">'http://graph.facebook.com/?id='</span><span class="o">.</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
    <span class="nv">$json</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">([</span><span class="s1">'shares'</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
    <span class="k">return</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'shares'</span><span class="p">];</span>
<span class="p">}</span>

</pre></div>
</div>

<h1>
<span id="ページビューを取得する" class="fragment"></span><a href="#%E3%83%9A%E3%83%BC%E3%82%B8%E3%83%93%E3%83%A5%E3%83%BC%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ページビューを取得する</h1>

<p>PVはAPIで取れないので、QiitaにログインしChromeのインスペクタ上で実行する</p>

<div class="code-frame" data-lang="coffeescript">
<div class="code-lang"><span class="bold">coffeescript</span></div>
<div class="highlight"><pre><span></span><span class="nv">username = </span><span class="s">"suin"</span>
<span class="nv">count = </span><span class="mi">100</span>

<span class="nv">getQiitaItems = </span><span class="nf">(username) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span>
        <span class="nv">url: </span><span class="s">"https://qiita.com/api/v1/users/</span><span class="si">#{</span><span class="nx">username</span><span class="si">}</span><span class="s">/items?per_page=</span><span class="si">#{</span><span class="nx">count</span><span class="si">}</span><span class="s">"</span>
        <span class="nv">success: </span><span class="nf">(items)-&gt;</span>
            <span class="nx">getPV</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>
        <span class="nv">dataType: </span><span class="s">"json"</span>

<span class="nv">getPV = </span><span class="nf">(items, result = "") -&gt;</span>
    <span class="k">if</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">"Result:"</span> <span class="o">+</span> <span class="nx">result</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nv">item = </span><span class="nx">items</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">"fetch(</span><span class="si">#{</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="s">): </span><span class="si">#{</span><span class="nx">item</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="s">..."</span><span class="p">)</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">get</span> <span class="nx">item</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nf">(data)-&gt;</span>
        <span class="nv">pv = </span><span class="nx">$</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s">'li.view-count'</span><span class="p">).</span><span class="nx">text</span><span class="p">().</span><span class="nx">trim</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s/</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nv">result = </span><span class="nx">result</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s">"\t"</span> <span class="o">+</span> <span class="nx">pv</span>
        <span class="nx">getPV</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> 

<span class="nx">getQiitaItems</span><span class="p">(</span><span class="nx">username</span><span class="p">)</span>
</pre></div>
</div>

<p>↓ コンパイル後JS</p>

<div class="code-frame" data-lang="js">
<div class="code-lang"><span class="bold">js</span></div>
<div class="highlight"><pre><span></span><span class="c1">// Generated by CoffeeScript 1.6.3</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">getPV</span><span class="p">,</span> <span class="nx">getQiitaItems</span><span class="p">,</span> <span class="nx">username</span><span class="p">;</span>

  <span class="nx">username</span> <span class="o">=</span> <span class="s2">"suin"</span><span class="p">;</span>

  <span class="nx">count</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

  <span class="nx">getQiitaItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">username</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s2">"https://qiita.com/api/v1/users/"</span> <span class="o">+</span> <span class="nx">username</span> <span class="o">+</span> <span class="s2">"/items?per_page="</span> <span class="o">+</span> <span class="nx">count</span><span class="p">,</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">getPV</span><span class="p">(</span><span class="nx">items</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">dataType</span><span class="o">:</span> <span class="s2">"json"</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="nx">getPV</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">item</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Result:"</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"fetch("</span> <span class="o">+</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">"): "</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s2">"..."</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">pv</span><span class="p">;</span>
      <span class="nx">pv</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">'li.view-count'</span><span class="p">).</span><span class="nx">text</span><span class="p">().</span><span class="nx">trim</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s/</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span> <span class="o">+</span> <span class="s2">"\n"</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">url</span> <span class="o">+</span> <span class="s2">"\t"</span> <span class="o">+</span> <span class="nx">pv</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">getPV</span><span class="p">(</span><span class="nx">items</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="nx">getQiitaItems</span><span class="p">(</span><span class="nx">username</span><span class="p">);</span>

<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />66位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/71f28f06e7a49414cc93">Go言語: 単体テストの始め方！Gospelを使ってBDDをやってみよう</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-27 16:14:58</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[TDD]</b> <b>[bdd]</b> <b>[gospel]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="この記事の目的" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>この記事の目的</h1>

<ul>
<li>Go言語で単体テストを書けるようになる</li>
</ul>

<h1>
<span id="テーマ" class="fragment"></span><a href="#%E3%83%86%E3%83%BC%E3%83%9E"><i class="fa fa-link"></i></a>テーマ</h1>

<p>「じゃんけんプログラムをBDDで作る」をテーマに順を追って説明する。</p>

<h1>
<span id="準備" class="fragment"></span><a href="#%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>準備</h1>

<p>適当に作業用のディレクトリを作る:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir ~/Desktop/go-bdd
cd ~/Desktop/go-bdd/
</pre></div></div>

<p>テストを書いていくGoのファイルを作ってエディタで開く:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch janken_test.go
</pre></div></div>

<p>github.com/r7kamura/gospel をインストールする:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go get github.com/r7kamura/gospel
</pre></div></div>

<h1>
<span id="ひとまず-gospel-を体験してみる" class="fragment"></span><a href="#%E3%81%B2%E3%81%A8%E3%81%BE%E3%81%9A-gospel-%E3%82%92%E4%BD%93%E9%A8%93%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>ひとまず Gospel を体験してみる</h1>

<p>じゃんけんと関係ないが、100円入っている財布に100円を追加したら200円になるテストを試しに書いて、gospel を使い方を体験してみる。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">janken_test.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">janken</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="p">.</span> <span class="s">"github.com/r7kamura/gospel"</span>
    <span class="s">"testing"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">TestDescribe</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Describe</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">"I have 100 yen"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">wallet</span> <span class="o">:=</span> <span class="mi">100</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"and I got 100 yen"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">wallet</span> <span class="o">+=</span> <span class="mi">100</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be 200 yen"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">wallet</span><span class="p">).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">}</span>

</pre></div>
</div>

<p>テストを実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go test -v
</pre></div></div>

<p>テスト結果が表示された:</p>

<p><a href="https://camo.qiitausercontent.com/08478c1e467a08f027d29d1cd5ceebea2c99439c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37663036316664342d366631322d663334612d326264382d6433336435646232616631632e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/08478c1e467a08f027d29d1cd5ceebea2c99439c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f37663036316664342d366631322d663334612d326264382d6433336435646232616631632e706e67" alt="Terminal_—_bash_—_68×23.png" title="Terminal_—_bash_—_68×23.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/7f061fd4-6f12-f34a-2bd8-d33d5db2af1c.png"></a></p>

<h1>
<span id="じゃんけんのルール仕様" class="fragment"></span><a href="#%E3%81%98%E3%82%83%E3%82%93%E3%81%91%E3%82%93%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%AB%E4%BB%95%E6%A7%98"><i class="fa fa-link"></i></a>じゃんけんのルール仕様</h1>

<p>じゃんけんの勝敗は自分の手と相手の手の関係で決まる:</p>

<table>
<thead>
<tr>
<th>自分(i)＼相手(you)</th>
<th>rock</th>
<th>paper</th>
<th>scessors</th>
</tr>
</thead>
<tbody>
<tr>
<td>rock</td>
<td><em>draw</em></td>
<td><strong>lose</strong></td>
<td>win</td>
</tr>
<tr>
<td>paper</td>
<td>win</td>
<td><em>draw</em></td>
<td><strong>lose</strong></td>
</tr>
<tr>
<td>scessors</td>
<td><strong>lose</strong></td>
<td>win</td>
<td><em>draw</em></td>
</tr>
</tbody>
</table>

<p>draw: ひきわけ<br>
lose: 負け<br>
win: 勝ち</p>

<h1>
<span id="仕様をシナリオに落としこむ" class="fragment"></span><a href="#%E4%BB%95%E6%A7%98%E3%82%92%E3%82%B7%E3%83%8A%E3%83%AA%E3%82%AA%E3%81%AB%E8%90%BD%E3%81%A8%E3%81%97%E3%81%93%E3%82%80"><i class="fa fa-link"></i></a>仕様をシナリオに落としこむ</h1>

<p>財布の例では処理とシナリオを同時に書いたが、今回はいきなり処理を書かずに、まずはシナリオ(テストケース)だけ先に決めてしまう。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">janken_test.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">janken</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="p">.</span> <span class="s">"github.com/r7kamura/gospel"</span>
    <span class="s">"testing"</span>

<span class="p">)</span>

<span class="kd">func</span> <span class="nx">TestDescribe</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Describe</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">"I pick rock"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick rock"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be draw"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick paper"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be lose"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick scessors"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be win"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
    <span class="nx">Describe</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">"I pick paper"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick rock"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be win"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick paper"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be draw"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick scessors"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be lose"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
    <span class="nx">Describe</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">"I pick scessors"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick rock"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be lose"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick paper"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be win"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick scessors"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be draw"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">}</span>

</pre></div>
</div>

<h1>
<span id="振る舞いを埋めていく" class="fragment"></span><a href="#%E6%8C%AF%E3%82%8B%E8%88%9E%E3%81%84%E3%82%92%E5%9F%8B%E3%82%81%E3%81%A6%E3%81%84%E3%81%8F"><i class="fa fa-link"></i></a>振る舞いを埋めていく</h1>

<p>次に、振る舞い(処理)の部分を埋めていく。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">janken_test.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">janken</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="p">.</span> <span class="s">"github.com/r7kamura/gospel"</span>
    <span class="s">"testing"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">TestDescribe</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Describe</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">"I pick rock"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">Rock</span><span class="p">()</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick rock"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Rock</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be draw"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">DRAW</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick paper"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Paper</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be lose"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">LOSE</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick scessors"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Scessors</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be win"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">WIN</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
    <span class="nx">Describe</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">"I pick paper"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">Paper</span><span class="p">()</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick rock"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Rock</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be win"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">WIN</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick paper"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Paper</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be draw"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">DRAW</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick scessors"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Scessors</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be lose"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">LOSE</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
    <span class="nx">Describe</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s">"I pick scessors"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">Scessors</span><span class="p">()</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick rock"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Rock</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be lose"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">LOSE</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick paper"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Paper</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be win"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">WIN</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nx">Context</span><span class="p">(</span><span class="s">"you pick scessors"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">you</span> <span class="o">:=</span> <span class="nx">Scessors</span><span class="p">()</span>
            <span class="nx">It</span><span class="p">(</span><span class="s">"should be draw"</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">Expect</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">Beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)).</span><span class="nx">To</span><span class="p">(</span><span class="nx">Equal</span><span class="p">,</span> <span class="nx">DRAW</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">})</span>
<span class="p">}</span>

</pre></div>
</div>

<p>この状態でテストを実行すると、まだテスト対象の <code>janken</code> モジュールが定義されていないのでコンパイルエラーになる:</p>

<p><a href="https://camo.qiitausercontent.com/f3f83d5c82d3855406629f289644d1a83ba22fa4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38353335366665392d336662612d323633612d323134352d3133366562653836333666352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f3f83d5c82d3855406629f289644d1a83ba22fa4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f38353335366665392d336662612d323633612d323134352d3133366562653836333666352e706e67" alt="Terminal_—_bash_—_68×23-3.png" title="Terminal_—_bash_—_68×23-3.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/85356fe9-3fba-263a-2145-136ebe8636f5.png"></a></p>

<h1>
<span id="実装する" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>実装する</h1>

<p>実装を書くGoファイルを作り、エディタで開く:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch janken.go
</pre></div></div>

<p>ファイルを置く場所は  <code>janken_test.go</code> のあるディレクトリにする。全体のファイルツリーとしては下記のようになる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>~/Desktop/go-bdd
├── janken.go
└── janken_test.go
</pre></div></div>

<p><code>janken.go</code> を実装する:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">janken.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">janken</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">ROCK</span>     <span class="p">=</span> <span class="mi">1</span>
    <span class="nx">PAPER</span>    <span class="p">=</span> <span class="mi">2</span>
    <span class="nx">SCESSORS</span> <span class="p">=</span> <span class="mi">3</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">WIN</span>  <span class="p">=</span> <span class="mi">1</span>
    <span class="nx">LOSE</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="nx">DRAW</span> <span class="p">=</span> <span class="mi">0</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Hand</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Hand</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Rock</span><span class="p">()</span> <span class="o">*</span><span class="nx">Hand</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Hand</span><span class="p">{</span><span class="nx">ROCK</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Paper</span><span class="p">()</span> <span class="o">*</span><span class="nx">Hand</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Hand</span><span class="p">{</span><span class="nx">PAPER</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Scessors</span><span class="p">()</span> <span class="o">*</span><span class="nx">Hand</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Hand</span><span class="p">{</span><span class="nx">SCESSORS</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">my</span> <span class="o">*</span><span class="nx">Hand</span><span class="p">)</span> <span class="nx">Beats</span><span class="p">(</span><span class="nx">your</span> <span class="o">*</span><span class="nx">Hand</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">mine</span> <span class="o">:=</span> <span class="nx">my</span><span class="p">.</span><span class="nx">Hand</span>
    <span class="nx">yours</span> <span class="o">:=</span> <span class="nx">your</span><span class="p">.</span><span class="nx">Hand</span>

    <span class="k">switch</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">mine</span> <span class="o">==</span> <span class="nx">ROCK</span> <span class="o">&amp;&amp;</span> <span class="nx">yours</span> <span class="o">==</span> <span class="nx">SCESSORS</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">WIN</span>
    <span class="k">case</span> <span class="nx">mine</span> <span class="o">==</span> <span class="nx">PAPER</span> <span class="o">&amp;&amp;</span> <span class="nx">yours</span> <span class="o">==</span> <span class="nx">ROCK</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">WIN</span>
    <span class="k">case</span> <span class="nx">mine</span> <span class="o">==</span> <span class="nx">SCESSORS</span> <span class="o">&amp;&amp;</span> <span class="nx">yours</span> <span class="o">==</span> <span class="nx">PAPER</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">WIN</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">LOSE</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>

<h1>
<span id="テストする" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>テストする</h1>

<p>テストを実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go test -v
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/b4af6fec2b06e81aca3b43240015bb409146d2dd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63316535646133332d656433622d343432312d326639612d6435643465376337623365312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b4af6fec2b06e81aca3b43240015bb409146d2dd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63316535646133332d656433622d343432312d326639612d6435643465376337623365312e706e67" alt="Terminal_—_bash_—_68×43.png" title="Terminal_—_bash_—_68×43.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/c1e5da33-ed3b-4421-2f9a-d5d4e7c7b3e1.png"></a></p>

<p>見ての通り、3つのシナリオでテストが失敗している。プログラムを確認すると、引き分けのロジックが抜けていた。いわゆるバグだ。</p>

<p>下記のコードを <code>janken.go</code> に追加する:</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span>    <span class="k">case</span> <span class="nx">mine</span> <span class="o">==</span> <span class="nx">yours</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">DRAW</span>
</pre></div></div>

<p>全体のコードはこのようになる:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">janken.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">janken</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">ROCK</span>     <span class="p">=</span> <span class="mi">1</span>
    <span class="nx">PAPER</span>    <span class="p">=</span> <span class="mi">2</span>
    <span class="nx">SCESSORS</span> <span class="p">=</span> <span class="mi">3</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">WIN</span>  <span class="p">=</span> <span class="mi">1</span>
    <span class="nx">LOSE</span> <span class="p">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="nx">DRAW</span> <span class="p">=</span> <span class="mi">0</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Hand</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Hand</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Rock</span><span class="p">()</span> <span class="o">*</span><span class="nx">Hand</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Hand</span><span class="p">{</span><span class="nx">ROCK</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Paper</span><span class="p">()</span> <span class="o">*</span><span class="nx">Hand</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Hand</span><span class="p">{</span><span class="nx">PAPER</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Scessors</span><span class="p">()</span> <span class="o">*</span><span class="nx">Hand</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Hand</span><span class="p">{</span><span class="nx">SCESSORS</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">my</span> <span class="o">*</span><span class="nx">Hand</span><span class="p">)</span> <span class="nx">Beats</span><span class="p">(</span><span class="nx">your</span> <span class="o">*</span><span class="nx">Hand</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">mine</span> <span class="o">:=</span> <span class="nx">my</span><span class="p">.</span><span class="nx">Hand</span>
    <span class="nx">yours</span> <span class="o">:=</span> <span class="nx">your</span><span class="p">.</span><span class="nx">Hand</span>

    <span class="k">switch</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">mine</span> <span class="o">==</span> <span class="nx">ROCK</span> <span class="o">&amp;&amp;</span> <span class="nx">yours</span> <span class="o">==</span> <span class="nx">SCESSORS</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">WIN</span>
    <span class="k">case</span> <span class="nx">mine</span> <span class="o">==</span> <span class="nx">PAPER</span> <span class="o">&amp;&amp;</span> <span class="nx">yours</span> <span class="o">==</span> <span class="nx">ROCK</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">WIN</span>
    <span class="k">case</span> <span class="nx">mine</span> <span class="o">==</span> <span class="nx">SCESSORS</span> <span class="o">&amp;&amp;</span> <span class="nx">yours</span> <span class="o">==</span> <span class="nx">PAPER</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">WIN</span>
    <span class="k">case</span> <span class="nx">mine</span> <span class="o">==</span> <span class="nx">yours</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">DRAW</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">LOSE</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>ふたたびテストを実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go test -v
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/2329155e3238f45825beecbb86ae0fbf87ca47d6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34323734333139622d663866662d303333352d343162632d6233343833316236396237352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2329155e3238f45825beecbb86ae0fbf87ca47d6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34323734333139622d663866662d303333352d343162632d6233343833316236396237352e706e67" alt="Terminal_—_bash_—_68×27.png" title="Terminal_—_bash_—_68×27.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/4274319b-f8ff-0335-41bc-b34831b69b75.png"></a></p>

<p>今度は全てのテストが通った。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />67位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/062dab1e6dc82c81c320">Go言語でランダムな文字列を生成する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-12 15:38:35</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ランダムな64ビットのintを生成して、基数を36に変更することで、英数混合のランダムな文字列が生成できる。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"encoding/binary"</span>
    <span class="s">"crypto/rand"</span>
    <span class="s">"strconv"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">random</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">random</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">random</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">random</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">n</span> <span class="kt">uint64</span>
    <span class="nx">binary</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Reader</span><span class="p">,</span> <span class="nx">binary</span><span class="p">.</span><span class="nx">LittleEndian</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">FormatUint</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
</div>

<p>実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>g7zxz0xwrlq0
2zy0sbwx1ujlf
2t9t3pqrof5dm
</pre></div></div>

<h1>
<span id="関連" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3"><i class="fa fa-link"></i></a>関連</h1>

<ul>
<li><a href="http://qiita.com/suin/items/23ba4a487425bbad90c8" id="reference-a3b846eadb3f06440243">JavaScriptでランダムな文字列</a></li>
<li><a href="http://qiita.com/suin/items/c958bcca90262467f2c0" id="reference-c1cc2a9fa71d93fa861b">PHPでランダムな文字列</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />68位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/9cf0da1b92a166863076">tmuxでウィンドウを閉じた時にインデックス番号を詰めるには renumber-windows on を設定する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-14 14:02:34</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[tmux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>次のように3つウィンドウを開いていた時に</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>1:foo-  2:bar*  3:baz
</pre></div></div>

<p>2番を閉じると、次のように2番が欠番してしまう</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>1:foo*  3:baz
</pre></div></div>

<p>この状態で新しいウィンドウを開くと2番にウィンドウが作られてしまう。</p>

<p>個人的にこのふるまいが馴染めず、下記のように3番が2番に付番し直されるふるまいを期待していた</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>1:foo*  2:baz
</pre></div></div>

<p>tmux 1.7以上では、ウィンドウを閉じた時にインデックス番号を振り直す設定ができる、設定のしかたは、<code>~/.tmux.conf</code> に下記の1行を追加する</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">~/.tmux.conf</span></div>
<div class="highlight"><pre><span></span>set-option -g renumber-windows on
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />69位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/b8a7af13b00cfdecfd1e">Scala初心者の俺が「Hello World」する jar を作るまで。</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-31 22:33:35</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> <b>[sbt]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="ゴール" class="fragment"></span><a href="#%E3%82%B4%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>ゴール</h1>

<p>IDEの力を借りずに、｢Hello World!｣を出力するCUIプログラムをScalaで書いて、実行できて配布できるファイル形式  <a href="http://ja.wikipedia.org/wiki/JAR_(%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88)" rel="nofollow noopener" target="_blank">jar</a> を作る。</p>

<h1>
<span id="要件" class="fragment"></span><a href="#%E8%A6%81%E4%BB%B6"><i class="fa fa-link"></i></a>要件</h1>

<ul>
<li>MacOSX で <code>brew</code> コマンドが使える OR もうすでに <code>scala</code> と <code>sbt</code> が入っている</li>
</ul>

<h1>
<span id="scalaをインストールする" class="fragment"></span><a href="#scala%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>Scalaをインストールする</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew update
</pre></div></div>

<p>Scalaが入ってる場合は飛ばしてOK</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install scala
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ scala -version
Scala code runner version 2.10.0 -- Copyright 2002-2012, LAMP/EPFL
</pre></div></div>

<h1>
<span id="sbtsimple-build-toolをインストールする" class="fragment"></span><a href="#sbtsimple-build-tool%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>SBT(Simple Build Tool)をインストールする</h1>

<p>SBTが入っている場合は飛ばしてOK</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew install sbt
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sbt --version
sbt launcher version 0.12.2
</pre></div></div>

<h1>
<span id="hello-worldプロジェクトを作る" class="fragment"></span><a href="#hello-world%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>Hello Worldプロジェクトを作る</h1>

<p>おもむろにDesktopにscala_hello_worldプロジェクトを作る:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cd ~/Desktop/
mkdir scala_hello_world
cd scala_hello_world/
</pre></div></div>

<p><code>sbt</code> コマンドを実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sbt
</pre></div></div>

<p>いろいろダウンロードされる</p>

<p><code>exit</code> と打って抜ける</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sbt update
</pre></div></div>

<p>またいろいろダウンロードされる</p>

<p><code>build.sbt</code> を作り、下記のように書く。注意として、1行ごとに必ず空行を入れること。</p>

<div class="code-frame" data-lang="scala">
<div class="code-lang"><span class="bold">build.sbt</span></div>
<div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">:=</span> <span class="s">"Hello World"</span>

<span class="n">version</span> <span class="o">:=</span> <span class="s">"1.0"</span>

<span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">"2.10.0"</span>
</pre></div>
</div>

<p>SBTでの標準的なディレクトリ構成:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>├── project
│   └── target
│       └── config-classes
├── src
│   ├── main
│   │   ├── resources
│   │   └── scala
│   └── test
│       ├── resources
│       └── scala
└── target
</pre></div></div>

<p>とりあえず <code>src</code> の下だけ作る:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir -p src/{main,test}/{resources,scala}
</pre></div></div>

<p><code>src/main/scala/</code> に <code>HelloWorld.scala</code> を作って、中身を下記のように書く:</p>

<div class="code-frame" data-lang="scala">
<div class="code-lang"><span class="bold">src/main/scala/HelloWorld.scala</span></div>
<div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"Hello World!"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></div>
</div>

<h1>
<span id="実行してみる" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>実行してみる</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sbt run
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>[info] Set current project to Hello World (in build file:/Users/suin/Desktop/scala_hello_world/)
[info] Compiling 1 Scala source to /Users/suin/Desktop/scala_hello_world/target/scala-2.10/classes...
[info] Running HelloWorld
Hello World!
[success] Total time: 3 s, completed Jul 31, 2013 9:50:45 PM
</pre></div></div>

<p>Hello World! と出ればOK。</p>

<h1>
<span id="jarを作る" class="fragment"></span><a href="#jar%E3%82%92%E4%BD%9C%E3%82%8B"><i class="fa fa-link"></i></a>jarを作る</h1>

<p><a href="https://github.com/sbt/sbt-assembly" rel="nofollow noopener" target="_blank">sbt-assembly</a> というSBTのプラグインを使うと楽との情報を得たので使ってみる。ここに書いたセットアップ方法は <a href="https://github.com/sbt/sbt-assembly" rel="nofollow noopener" target="_blank">sbt-assembly</a> のREADMEから持ってきたものなので、最新の情報はリンク先を参照してほしい。</p>

<p><code>project/plugins.sbt</code> を作り、下記を追加する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>addSbtPlugin("com.eed3si9n" % "sbt-assembly" % "0.9.1")
</pre></div></div>

<p><code>build.sbt</code> に下の2行を追加する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>import AssemblyKeys._ // put this at the top of the file

assemblySettings
</pre></div></div>

<p>さっそく jar を作ってみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sbt assembly                                                                                                                                                                                   
</pre></div></div>

<p>jar を実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>java -jar target/scala-2.10/Hello\ World-assembly-1.0.jar
</pre></div></div>

<p>下のようにHello World!とだけ出れば成功。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Hello World!
</pre></div></div>

<p>jar のファイル名を <code>hello_world.jar</code> に変えたいので、<code>build.sbt</code> に設定を追加する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>jarName in assembly := "hello_world.jar"
</pre></div></div>

<p>jar を作りなおしてみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sbt assembly                                                                                                                                                                                   
</pre></div></div>

<p>実行してみる:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>java -jar target/scala-2.10/hello_world.jar
</pre></div></div>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Hello World!
</pre></div></div>

<p><code>hello_world-X.X.jar</code> のようにバージョンつけたいので、 <code>build.sbt</code> の <code>jarName in assembly</code> の設定を次のようにかえる。(もっとシンプルに書けるのかもしれないので知っていたら教えてほしい。)</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>jarName in assembly &lt;&lt;= (version) map { (version) =&gt; "hello_world-" + version + ".jar" }
</pre></div></div>

<p>jar を作り直して実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>sbt assembly          
java -jar target/scala-2.10/hello_world-1.0.jar                                                                                                                                                                         
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />70位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/14c455691a0391ee265c">set_error_handler と ErrorException を組み合わせると幸せになるかも</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-05-03 20:59:52</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>set_error_handler()</code> のコールバック関数でエラー情報を一旦 <code>ErrorException</code> にしておくと、いろいろ恩恵が得られるというお話。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// ErrorExceptionをもう少し便利にしたクラス</span>
<span class="k">class</span> <span class="nc">MyErrorException</span> <span class="k">extends</span> <span class="nx">ErrorException</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="nv">$severities</span> <span class="o">=</span> <span class="p">[</span>
        <span class="k">E_ERROR</span>             <span class="o">=&gt;</span> <span class="s1">'ERROR'</span><span class="p">,</span>
        <span class="k">E_WARNING</span>           <span class="o">=&gt;</span> <span class="s1">'WARNING'</span><span class="p">,</span>
        <span class="k">E_PARSE</span>             <span class="o">=&gt;</span> <span class="s1">'PARSING ERROR'</span><span class="p">,</span>
        <span class="nx">E_NOTICE</span>            <span class="o">=&gt;</span> <span class="s1">'NOTICE'</span><span class="p">,</span>
        <span class="nx">E_CORE_ERROR</span>        <span class="o">=&gt;</span> <span class="s1">'CORE ERROR'</span><span class="p">,</span>
        <span class="nx">E_CORE_WARNING</span>      <span class="o">=&gt;</span> <span class="s1">'CORE WARNING'</span><span class="p">,</span>
        <span class="nx">E_COMPILE_ERROR</span>     <span class="o">=&gt;</span> <span class="s1">'COMPILE ERROR'</span><span class="p">,</span>
        <span class="nx">E_COMPILE_WARNING</span>   <span class="o">=&gt;</span> <span class="s1">'COMPILE WARNING'</span><span class="p">,</span>
        <span class="nx">E_USER_ERROR</span>        <span class="o">=&gt;</span> <span class="s1">'USER ERROR'</span><span class="p">,</span>
        <span class="nx">E_USER_WARNING</span>      <span class="o">=&gt;</span> <span class="s1">'USER WARNING'</span><span class="p">,</span>
        <span class="nx">E_USER_NOTICE</span>       <span class="o">=&gt;</span> <span class="s1">'USER NOTICE'</span><span class="p">,</span>
        <span class="nx">E_STRICT</span>            <span class="o">=&gt;</span> <span class="s1">'STRICT NOTICE'</span><span class="p">,</span>
        <span class="nx">E_RECOVERABLE_ERROR</span> <span class="o">=&gt;</span> <span class="s1">'RECOVERABLE ERROR'</span><span class="p">,</span>
        <span class="nx">E_DEPRECATED</span>        <span class="o">=&gt;</span> <span class="s1">'DEPRECATED'</span><span class="p">,</span>
        <span class="nx">E_USER_DEPRECATED</span>   <span class="o">=&gt;</span> <span class="s1">'USER DEPRECATED'</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * return full exception message</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFullMessage</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'%s: %s in %s on line %u'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSeverityString</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getFile</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getLine</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * return the exception severity as string</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getSeverityString</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_severityToString</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getSeverity</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * return severity as string</span>
<span class="sd">     * @param int $severity</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_severityToString</span><span class="p">(</span><span class="nv">$severity</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$severity</span><span class="p">,</span> <span class="k">static</span><span class="o">::</span><span class="nv">$severities</span><span class="p">)</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="nv">$severities</span><span class="p">[</span><span class="nv">$severity</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="s1">'UNKNOWN ERROR('</span><span class="o">.</span><span class="nv">$severity</span><span class="o">.</span><span class="s1">')'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// エラーハンドラーの登録</span>
<span class="nb">set_error_handler</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$severity</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 一度例外オブジェクトにすると、エラーをオブジェクト指向的に扱えます。</span>
    <span class="c1">// 例外オブジェクトですが必ずしも throw する必要はないです。</span>
    <span class="nv">$errorException</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyErrorException</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$severity</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>

    <span class="c1">// ErrorExceptionを継承したクラスを使うこともできます。</span>
    <span class="k">echo</span> <span class="nv">$errorException</span><span class="o">-&gt;</span><span class="na">getFullMessage</span><span class="p">(),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

    <span class="c1">// オブジェクトを文字列にキャストすると、バックトレースもできます。</span>
    <span class="k">echo</span> <span class="nv">$errorException</span><span class="p">;</span>

    <span class="c1">// 任意のファイルに書き込んだりとか。</span>
    <span class="nb">error_log</span><span class="p">(</span><span class="nv">$errorException</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'/tmp/error_log'</span><span class="p">);</span>

    <span class="c1">// オブザーバパターンを使って、オブザーバに知らせるとか。</span>
    <span class="nx">observe_error</span><span class="p">(</span><span class="nv">$errorException</span><span class="p">);</span>

    <span class="c1">// 例外を投げて処理を中断したり。</span>
    <span class="k">throw</span> <span class="nv">$errorException</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// オブザーバ</span>
<span class="k">function</span> <span class="nf">observe_error</span><span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$errorException</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ErrorException を使えば、コールバック関数側で、引数に型を指定できるので、契約プログラミング(Programming By Contract)的な安心感があります。</span>
    <span class="c1">// function($severity, $message, $file, $line) {} のような引数いっぱいのコールバックを書かなくてよくなります。</span>

    <span class="c1">// ErrorExceptionの処理が続く...</span>
<span class="p">}</span>


<span class="c1">// エラーを起こす</span>
<span class="nb">trigger_error</span><span class="p">(</span><span class="s1">'エラーだよ!'</span><span class="p">);</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />71位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>23</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/7eb4fc405ac73846a9b1">Go言語でファイル操作: ファイルを作って書き込む</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-10 17:12:19</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="この記事の目的" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>この記事の目的</h1>

<ul>
<li>Go言語でファイルに書き込めるようになる</li>
</ul>

<h1>
<span id="準備" class="fragment"></span><a href="#%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>準備</h1>

<p>適当に作業用のディレクトリを作る:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>mkdir ~/Desktop/gofile
cd ~/Desktop/gofile/
</pre></div></div>

<p>処理を書いていくGoのファイルを作ってエディタで開く:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>touch main.go
</pre></div></div>

<h1>
<span id="ファイルに1行書き込む" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB1%E8%A1%8C%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>ファイルに1行書き込む</h1>

<p><a href="http://golang.org/pkg/io/ioutil/#WriteFile" rel="nofollow noopener" target="_blank"><code>ioutil.WriteFile</code></a>を使うと1行でファイルの書き込みができる:</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"io/ioutil"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">content</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">"hello world\n"</span><span class="p">)</span>
    <span class="nx">ioutil</span><span class="p">.</span><span class="nx">WriteFile</span><span class="p">(</span><span class="s">"/tmp/go-file"</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">ModePerm</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
</div>

<p>実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run main.go
</pre></div></div>

<p>書き込めているか確認:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% cat /tmp/go-file
hello world
</pre></div></div>

<h1>
<span id="ファイルに複数行書き込む" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E8%A4%87%E6%95%B0%E8%A1%8C%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>ファイルに複数行書き込む</h1>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"io/ioutil"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">content</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span>
        <span class="s">"hello world\n"</span> <span class="o">+</span>
            <span class="s">"hello world\n"</span> <span class="o">+</span>
            <span class="s">"hello world\n"</span> <span class="o">+</span>
            <span class="s">"hello world\n"</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nx">ioutil</span><span class="p">.</span><span class="nx">WriteFile</span><span class="p">(</span><span class="s">"/tmp/go-file"</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">ModePerm</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run main.go
</pre></div></div>

<p>書き込めているか確認:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% cat /tmp/go-file
hello world
hello world
hello world
hello world
</pre></div></div>

<h1>
<span id="raw-string-literalを使って複数行書き込む" class="fragment"></span><a href="#raw-string-literal%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E8%A4%87%E6%95%B0%E8%A1%8C%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%82%80"><i class="fa fa-link"></i></a>Raw string literalを使って複数行書き込む</h1>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"io/ioutil"</span>
    <span class="s">"os"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">content</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span>
        <span class="s">`hello world</span>
<span class="s">hello world</span>
<span class="s">hello world</span>
<span class="s">hello world</span>
<span class="s">`</span><span class="p">)</span>
    <span class="nx">ioutil</span><span class="p">.</span><span class="nx">WriteFile</span><span class="p">(</span><span class="s">"/tmp/go-file"</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">ModePerm</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
</div>

<p>実行する:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run main.go
</pre></div></div>

<p>書き込めているか確認:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>% cat /tmp/go-file
hello world
hello world
hello world
hello world
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />72位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>23</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/8ff2d3b99af795cd03f2">ドメイン駆動設計: IDDDに登場するサンプルコードのModule構成をまとめてみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-16 14:16:01</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[DDD]</b> <b>[ドメイン駆動設計]</b> <b>[IDDD]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote>

<h3>
<span id="update-20130416" class="fragment"></span><a href="#update-20130416"><i class="fa fa-link"></i></a>UPDATE 2013.04.16</h3>

<p>まとめてから気がついたが、GitHubの<a href="https://github.com/VaughnVernon/IDDD_Samples" rel="nofollow noopener" target="_blank">VaughnVernon/IDDD_Samples</a>にIDDDのサンプルコードがあった。</p>
</blockquote>

<p>ドメイン駆動設計で実際にどういうふうにディレクトリを切って、Moduleを構成するのか知りたかったので、<a href="http://amzn.to/YmRhoC" rel="nofollow noopener" target="_blank">Implementing Domain-Driven Design</a> に記載さいれているサンプルコードからModule構成をかき集めて再構成してみた。</p>

<h2>
<span id="moduleの構成" class="fragment"></span><a href="#module%E3%81%AE%E6%A7%8B%E6%88%90"><i class="fa fa-link"></i></a>Moduleの構成</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>com
└── saasovation
    ├── agilepm
    │   ├── application
    │   │   ├── ProcessService
    │   │   ├── ProductService
    │   │   └── TeamService
    │   ├── domain
    │   │   └── model
    │   │       ├── DomainEvent
    │   │       ├── DomainEventPublisher
    │   │       ├── DomainRegistry
    │   │       ├── DomainTest
    │   │       ├── product
    │   │       │   ├── BacklogItem
    │   │       │   │   └── BacklogItem
    │   │       │   ├── BacklogItemComitted
    │   │       │   ├── BacklogItemRepository
    │   │       │   ├── BusinessPriority
    │   │       │   ├── BusinessPriorityCalculator
    │   │       │   ├── BusinessPriorityRatings
    │   │       │   ├── BusinessPriorityTest
    │   │       │   ├── Product
    │   │       │   ├── ProductDiscussion
    │   │       │   ├── ProductDiscussionRequestTimeOut
    │   │       │   ├── ProductDiscussionRequested
    │   │       │   ├── ProductRepository
    │   │       │   ├── SprintId
    │   │       │   ├── Tenant
    │   │       │   ├── impl
    │   │       │   │   └── InMemoryProductRepository
    │   │       │   ├── release
    │   │       │   │   └── Release
    │   │       │   └── sprint
    │   │       │       └── Sprint
    │   │       ├── team
    │   │       │   ├── Member
    │   │       │   ├── MemberChangeTracker
    │   │       │   ├── MemberService
    │   │       │   ├── ProductOwner
    │   │       │   ├── Team
    │   │       │   └── TeamMember
    │   │       └── tenant
    │   │           └── TenantId
    │   ├── infrastrcuture
    │   │   └── messaging
    │   │       └── ProductDiscussionRequestedListener
    │   └── infrastructure
    │       ├── HibernateBacklogItemRepository
    │       ├── messaging
    │       │   ├── DiscussionStartedListener
    │       │   ├── ProductDiscussionRetryListener
    │       │   └── TeamMemberEnablerListener
    │       └── persistence
    │           └── CoherenceProductRepository
    ├── collaboration
    │   ├── application
    │   │   ├── AccessService
    │   │   └── ForumService
    │   ├── domain
    │   │   └── model
    │   │       ├── calendar
    │   │       │   ├── Calendar
    │   │       │   └── CalendarEntityRepository
    │   │       ├── collaborator
    │   │       │   ├── Author
    │   │       │   ├── Collaborator
    │   │       │   └── CollaboratorService
    │   │       ├── forum
    │   │       │   └── Forum
    │   │       └── tenant
    │   │           └── Tenant
    │   └── infrastructure
    │       ├── messaging
    │       │   └── ExclusiveDiscussionCreationListener
    │       ├── persistence
    │       │   ├── HibernateCalendarEntityRepository
    │       │   └── SpringHibernateSessionProvider
    │       ├── services
    │       │   ├── CollaboratorTranslator
    │       │   ├── TranslatingCollaboratorService
    │       │   └── UserInRoleAdapter
    │       └── servicies
    │           └── UserRoleToCollaboratorService
    ├── common
    │   ├── domain
    │   │   └── model
    │   │       └── process
    │   │           ├── Process
    │   │           ├── ProcessId
    │   │           └── ProcessTimeOut
    │   ├── media
    │   │   ├── OvationMediaType
    │   │   └── ReprensentationReader
    │   └── port
    │       └── adapter
    │           └── messaging
    │               └── rabbitmq
    │                   └── ExchangeListener
    └── identityaccess
        ├── application
        │   ├── AccessService
        │   ├── NotificationService
        │   ├── TenantIdentityService
        │   ├── eventStore
        │   │   ├── EventStore
        │   │   └── StoredEvent
        │   └── notifications
        │       └── PublishedMessageTracker
        ├── domain
        │   └── model
        │       ├── DomainRegistry
        │       ├── access
        │       │   └── Role
        │       └── identity
        │           ├── AuthenticationService
        │           ├── Group
        │           ├── GroupMember
        │           ├── GroupMemberType
        │           ├── Tenant
        │           ├── TenantId
        │           ├── User
        │           └── UserDescriptor
        └── infrastructure
            ├── persistence
            │   ├── GroupMemberTypeUserType
            │   ├── HibernateUserRepository
            │   └── SpringHibernateSessionProvider
            └── servicies
                └── DefaultEncryptionAuthenticationService
</pre></div></div>

<h2>
<span id="収集したクラスインターフェイスの一覧" class="fragment"></span><a href="#%E5%8F%8E%E9%9B%86%E3%81%97%E3%81%9F%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A7%E3%82%A4%E3%82%B9%E3%81%AE%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>収集したクラス・インターフェイスの一覧</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>com.saasovation.agilepm.domain.model.DomainTest
com.saasovation.agilepm.domain.model.DomainRegistry
com.saasovation.agilepm.domain.model.DomainEvent
com.saasovation.agilepm.domain.model.DomainEventPublisher
com.saasovation.agilepm.domain.model.product.BacklogItemRepository
com.saasovation.agilepm.domain.model.product.BacklogItem
com.saasovation.agilepm.domain.model.product.Tenant
com.saasovation.agilepm.domain.model.product.SprintId
com.saasovation.agilepm.domain.model.product.BusinessPriority
com.saasovation.agilepm.domain.model.product.BusinessPriorityRatings
com.saasovation.agilepm.domain.model.product.BusinessPriorityTest
com.saasovation.agilepm.domain.model.product.BusinessPriorityCalculator
com.saasovation.agilepm.domain.model.product.BacklogItemComitted
com.saasovation.agilepm.domain.model.product.Product
com.saasovation.agilepm.domain.model.product.backlogitem.BacklogItem
com.saasovation.agilepm.domain.model.product.release.Release
com.saasovation.agilepm.domain.model.product.sprint.Sprint
com.saasovation.agilepm.domain.model.product.impl.InMemoryProductRepository
com.saasovation.agilepm.domain.model.product.ProductRepository
com.saasovation.agilepm.domain.model.product.ProductDiscussion
com.saasovation.agilepm.domain.model.product.ProductDiscussionRequested
com.saasovation.agilepm.domain.model.product.ProductDiscussionRequestTimeOut
com.saasovation.agilepm.domain.model.tenant.TenantId
com.saasovation.agilepm.domain.model.team.MemberService
com.saasovation.agilepm.domain.model.team.ProductOwner
com.saasovation.agilepm.domain.model.team.Team
com.saasovation.agilepm.domain.model.team.TeamMember
com.saasovation.agilepm.domain.model.team.Member
com.saasovation.agilepm.domain.model.team.MemberChangeTracker
com.saasovation.agilepm.infrastructure.persistence.CoherenceProductRepository
com.saasovation.agilepm.infrastructure.messaging.TeamMemberEnablerListener
com.saasovation.agilepm.infrastrcuture.messaging.ProductDiscussionRequestedListener
com.saasovation.agilepm.infrastructure.messaging.DiscussionStartedListener
com.saasovation.agilepm.infrastructure.messaging.ProductDiscussionRetryListener
com.saasovation.agilepm.infrastructure.HibernateBacklogItemRepository
com.saasovation.agilepm.application.TeamService
com.saasovation.agilepm.application.ProductService
com.saasovation.agilepm.application.ProcessService
com.saasovation.identityaccess.domain.model.DomainRegistry
com.saasovation.identityaccess.domain.model.identity.User 
com.saasovation.identityaccess.domain.model.identity.GroupMemberType 
com.saasovation.identityaccess.domain.model.identity.Group
com.saasovation.identityaccess.domain.model.identity.GroupMember
com.saasovation.identityaccess.domain.model.identity.TenantId
com.saasovation.identityaccess.domain.model.identity.AuthenticationService
com.saasovation.identityaccess.domain.model.identity.Tenant
com.saasovation.identityaccess.domain.model.identity.UserDescriptor
com.saasovation.identityaccess.domain.model.access.Role
com.saasovation.identityaccess.application.eventStore.EventStore
com.saasovation.identityaccess.application.eventStore.StoredEvent
com.saasovation.identityaccess.application.NotificationService
com.saasovation.identityaccess.application.AccessService
com.saasovation.identityaccess.application.TenantIdentityService
com.saasovation.identityaccess.application.notifications.PublishedMessageTracker
com.saasovation.identityaccess.infrastructure.persistence.HibernateUserRepository
com.saasovation.identityaccess.infrastructure.servicies.DefaultEncryptionAuthenticationService
com.saasovation.identityaccess.infrastructure.persistence.GroupMemberTypeUserType
com.saasovation.identityaccess.infrastructure.persistence.SpringHibernateSessionProvider
com.saasovation.collaboration.domain.model.tenant.Tenant
com.saasovation.collaboration.domain.model.forum.Forum
com.saasovation.collaboration.domain.model.calendar.Calendar
com.saasovation.collaboration.domain.model.calendar.CalendarEntityRepository
com.saasovation.collaboration.domain.model.collaborator.CollaboratorService
com.saasovation.collaboration.domain.model.collaborator.Author
com.saasovation.collaboration.domain.model.collaborator.Collaborator
com.saasovation.collaboration.infrastructure.persistence.HibernateCalendarEntityRepository
com.saasovation.collaboration.infrastructure.persistence.SpringHibernateSessionProvider
com.saasovation.collaboration.infrastructure.servicies.UserRoleToCollaboratorService
com.saasovation.collaboration.infrastructure.services.TranslatingCollaboratorService
com.saasovation.collaboration.infrastructure.services.UserInRoleAdapter
com.saasovation.collaboration.infrastructure.services.CollaboratorTranslator
com.saasovation.collaboration.infrastructure.messaging.ExclusiveDiscussionCreationListener
com.saasovation.collaboration.application.ForumService
com.saasovation.collaboration.application.AccessService
com.saasovation.common.media.OvationMediaType
com.saasovation.common.media.ReprensentationReader
com.saasovation.common.port.adapter.messaging.rabbitmq.ExchangeListener
com.saasovation.common.domain.model.process.ProcessId
com.saasovation.common.domain.model.process.ProcessTimeOut
com.saasovation.common.domain.model.process.Process
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />73位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>21</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/80609e9354377698d364">rmコマンドが怖い人向け: 削除しないでゴミ箱に移動するシェルスクリプト</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-03-22 23:23:20</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>rm -rf</code> を実行して、「本当は消したくなかったファイルを消してしまった」、「消したけど元に戻したいのに後の祭り」なんて経験は誰しも一度はあるんじゃないでしょうか。</p>

<p>そんな人向けの、<code>del</code> コマンド。このコマンドは、Window のエクスプローラやMacのFinderのように、削除したファイルを一旦ゴミ箱に移動することで、いざというときに復旧できるすべを残してくれます。</p>

<p><code>alias "rm=del"</code> とかしておくと安心です。本当に物理削除したいときは <code>\rm -f ...</code> で行えます。</p>

<div class="code-frame" data-lang="sh">
<div class="code-lang"><span class="bold">del</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nv">SCRIPT_NAME</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$0</span><span class="k">)</span>

setup_trash_dir<span class="o">()</span> <span class="o">{</span>
    <span class="o">[[</span> <span class="nv">$TRASH_DIR</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">trash_dir</span><span class="o">=</span><span class="nv">$TRASH_DIR</span> <span class="o">||</span> <span class="nv">trash_dir</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.Trash"</span>
<span class="o">}</span>

print_help<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">"Safe delete command."</span>
    <span class="nb">echo</span>
    <span class="nb">echo</span> <span class="s2">"  Usage:"</span>
    <span class="nb">echo</span> <span class="s2">"    \$ </span><span class="nv">$SCRIPT_NAME</span><span class="s2"> &lt;files…&gt;"</span>
    <span class="nb">echo</span>
    <span class="nb">echo</span> <span class="s2">"  Trash box directory:"</span>
    <span class="nb">echo</span> <span class="s2">"    </span><span class="nv">$trash_dir</span><span class="s2">"</span>

    <span class="k">if</span> <span class="o">[[</span> ! <span class="nv">$TRASH_DIR</span> <span class="o">]]</span>
    <span class="k">then</span>
        <span class="nb">echo</span>
        <span class="nb">echo</span> <span class="s2">"    You can specify the trash box as the environment variable \$TRASH_DIR."</span>
    <span class="k">fi</span>

    <span class="nb">exit</span> <span class="m">1</span>
<span class="o">}</span>

make_new_trash_box<span class="o">()</span> <span class="o">{</span>

    <span class="nv">trash_dir</span><span class="o">=</span><span class="nv">$trash_dir</span>/<span class="k">$(</span>date +%y%m%d.%H%M%S<span class="k">)</span>

    <span class="nv">suffix</span><span class="o">=</span><span class="s2">""</span>
    <span class="nv">number</span><span class="o">=</span><span class="m">0</span>
    <span class="k">while</span> <span class="o">[</span> -e <span class="nv">$trash_dir$suffix</span> <span class="o">]</span>
    <span class="k">do</span>
        <span class="nv">suffix</span><span class="o">=</span><span class="s2">".</span><span class="nv">$number</span><span class="s2">"</span>
        <span class="nv">number</span><span class="o">=</span><span class="k">$(</span>expr <span class="nv">$number</span> + <span class="m">1</span><span class="k">)</span>
    <span class="k">done</span>
    <span class="nv">trash_dir</span><span class="o">=</span><span class="nv">$trash_dir$suffix</span>

    mkdir <span class="nv">$trash_dir</span>
<span class="o">}</span>

check_file_exists<span class="o">()</span> <span class="o">{</span>

    <span class="nv">has_error</span><span class="o">=</span><span class="m">0</span>

    <span class="k">for</span> filename in <span class="nv">$@</span>
    <span class="k">do</span>
        <span class="k">if</span> <span class="o">[</span> ! -e <span class="nv">$filename</span> <span class="o">]</span>
        <span class="k">then</span>
            <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$SCRIPT_NAME</span><span class="s2">: delete </span><span class="nv">$filename</span><span class="s2">: No such file or directory"</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
            <span class="nv">has_error</span><span class="o">=</span><span class="m">1</span>
        <span class="k">fi</span>
    <span class="k">done</span>

    <span class="o">[[</span> <span class="nv">$has_error</span> -eq <span class="m">1</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="o">}</span>

remove_files<span class="o">()</span> <span class="o">{</span>
    <span class="k">for</span> filename in <span class="nv">$@</span>
    <span class="k">do</span>
        <span class="nv">dest_filename</span><span class="o">=</span><span class="nv">$trash_dir</span>/<span class="k">$(</span>basename <span class="nv">$filename</span><span class="k">)</span>

        <span class="nv">suffix</span><span class="o">=</span><span class="s2">""</span>
        <span class="nv">number</span><span class="o">=</span><span class="m">0</span>
        <span class="k">while</span> <span class="o">[</span> -e <span class="nv">$dest_filename$suffix</span> <span class="o">]</span>
        <span class="k">do</span>
            <span class="nv">suffix</span><span class="o">=</span><span class="s2">" - copy </span><span class="nv">$i</span><span class="s2">"</span>
            <span class="nv">number</span><span class="o">=</span><span class="k">$(</span>expr <span class="nv">$number</span> + <span class="m">1</span><span class="k">)</span>
        <span class="k">done</span>

        mv -vi <span class="nv">$filename</span> <span class="nv">$dest_filename$suffix</span>
    <span class="k">done</span>
<span class="o">}</span>

setup_trash_dir

<span class="k">if</span> <span class="o">[</span> <span class="nv">$#</span> -eq <span class="m">0</span> <span class="o">]</span>
<span class="k">then</span>
    print_help
<span class="k">fi</span>

make_new_trash_box
check_file_exists <span class="nv">$@</span>
remove_files <span class="nv">$@</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />74位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>20</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/f33b2a55dbde0febd484">QiitaプロフィールページのURLを7文字削減する短縮URLサービス作った件について</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-30 03:53:23</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/733fed9f7270c904e298e8001cdaffae4bf37b17/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303333302d71696974616d652f312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/733fed9f7270c904e298e8001cdaffae4bf37b17/68747470733a2f2f646c2e64726f70626f782e636f6d2f752f3934393832322f71696974612e636f6d2f3133303333302d71696974616d652f312e706e67" alt="" data-canonical-src="https://dl.dropbox.com/u/949822/qiita.com/130330-qiitame/1.png"></a></p>

<p>自分のブログと並行してQiitaにコンテンツを書いている人や、Qiitaを自分のメインブログとして記事をあげている人もいるとおもいます。私もQiitaを始めてから、個人ブログはほとんど更新しなくなったうちのひとりです。</p>

<p>ところで、みなさん。Qiitaのプロフィールページを自己紹介などで掲載していますか? 発表のスライドに載せたり、名刺に印字していますか? 2012年の秋ごろにQiitaのプロフィールページがパーソナライズされたUIになり、「自分のブログ」として自己紹介にあげても遜色のないものになっています。</p>

<p>ですが、なかなかメインブログとして紹介しにくい理由のひとつにプロフィールページの URL があかぬけていないという点があります。というのも、URLに <code>/users/</code> という部分がどうしても入ってしまうのです。qiita.com/users/suin のようなURLでは、なんとなく自分が所有している感がでませんよね。できれば、Facebookのパーマリンクのように facebook.com/suinyeze といった風に表現したいものです。</p>

<p>この課題を解決するために、このたび QiitaのプロフィールページURLから <code>/users</code> を取り去り、個人を連想しやすいTLDの <code>.me</code> ドメインを取得し、Qiitaのプロフィールページにリダイレクトするだけのウェブサービスを作りました。だれでも設定不要で使えますので、自己紹介に掲載したい人、発表会のスライドに投影したい人、名刺に印刷したい人など、ご自由に使ってください!</p>

<h3>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h3>

<p><code>http://qiita.com/users/{あなたのID}</code></p>

<p>を</p>

<p><code>http://qiita.me/{あなたID}</code></p>

<p>にするだけです。</p>

<p>設定などは不要です。</p>

<h3>
<span id="update-20130401" class="fragment"></span><a href="#update-20130401"><i class="fa fa-link"></i></a>UPDATE 2013.04.01</h3>

<p>qiita.me を Qiita で提供してもらえるかどうか Increments に連絡してみたところ、ドメイン&amp;コンセプトを引き継いでいただけるとの快諾をいただきました！すぐにでも qiita.me を移管したいところだったのですが、レジストラの制約で60日間は移管できないことが分かり、少なくとも3/29からの60日間は suin のほうで一時的にホスティングすることになりました。また何か報告できることがあればお知らせしますm(_ _)m</p>

<h3>
<span id="update-20130402" class="fragment"></span><a href="#update-20130402"><i class="fa fa-link"></i></a>UPDATE 2013.04.02</h3>

<p>同じレジストラ内であれば60日以内でもドメインの移動が可能だったので、ドメインの移動手続きを進めさせていただいてます。Incrementsさんのほうでは、運用準備中であるとのことですので今後が楽しみですね(^-^)/</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />75位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/40e1f86dc07f6a4db84a">CodeRunnerを使ってScalaのスニペットをサクサク試せるようにしよう</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-29 12:31:10</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> <b>[Mac]</b> <b>[CodeRunner]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/4c604e132b25156494561a68c92edd63ec3e7835/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32316165663531392d343934382d666437612d303233302d3536613739353664663139342e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4c604e132b25156494561a68c92edd63ec3e7835/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32316165663531392d343934382d666437612d303233302d3536613739353664663139342e6a706567" alt="01.jpg" title="01.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/21aef519-4948-fd7a-0230-56a7956df194.jpeg"></a></p>

<h1>
<span id="coderunnerとは" class="fragment"></span><a href="#coderunner%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>CodeRunnerとは？</h1>

<p><a href="http://krillapps.com/coderunner/" rel="nofollow noopener" target="_blank">CodeRunner</a>とは、クリックするだけでどんなプログラミング言語でもさくっと実行できるエディタです。CodeRunnerを使えば、アルゴリズムやコードスニペットの簡単なテストや実験をサクッと行うことができます。Mac用のアプリでAppStoreにて$9.99で買うことができます。インストール時点で下記の言語に対応してます:</p>

<ul>
<li>AppleScript</li>
<li>C</li>
<li>C++</li>
<li>Java</li>
<li>JavaScript(Node.js)</li>
<li>Lua</li>
<li>Objective-C</li>
<li>Perl</li>
<li>PHP</li>
<li>Python</li>
<li>Ruby</li>
<li>Shell Script</li>
</ul>

<h1>
<span id="scalaをcoderunnerで実行できるようにする" class="fragment"></span><a href="#scala%E3%82%92coderunner%E3%81%A7%E5%AE%9F%E8%A1%8C%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>ScalaをCodeRunnerで実行できるようにする</h1>

<p>CodeRunnerは言語を追加することができます。ここではScalaを追加して実行できるようにする方法を順を追って解説します。</p>

<p><a href="https://camo.qiitausercontent.com/2fe7427d10044164935c1e4f03475df56e91ea12/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34303330323239622d373531652d326633322d313738362d6334343535343438393534612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/2fe7427d10044164935c1e4f03475df56e91ea12/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f34303330323239622d373531652d326633322d313738362d6334343535343438393534612e706e67" alt="Screen Shot 2013-07-29 at 11.59.08 AM.png" title="Screen Shot 2013-07-29 at 11.59.08 AM.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/4030229b-751e-2f32-1786-c4455448954a.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/30f8b742ab23d86c034ba4de02770a88bf20555d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35316362326464352d663432642d386431622d306336332d3836616135393038343761622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/30f8b742ab23d86c034ba4de02770a88bf20555d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f35316362326464352d663432642d386431622d306336332d3836616135393038343761622e706e67" alt="Preferences.png" title="Preferences.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/51cb2dd5-f42d-8d1b-0c63-86aa590847ab.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/024678ea676ca689428ddba3acf1d185bd9f07b2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61333235326463642d383632352d323332372d326334662d6366363333393536306166612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/024678ea676ca689428ddba3acf1d185bd9f07b2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61333235326463642d383632352d323332372d326334662d6366363333393536306166612e706e67" alt="Preferences-2.png" title="Preferences-2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/a3252dcd-8625-2327-2c4f-cf6339560afa.png"></a></p>

<div class="code-frame" data-lang="scala">
<div class="code-lang"><span class="bold">テンプレート</span></div>
<div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">Untitled</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
        <span class="o">%@</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></div>
</div>

<p><a href="https://camo.qiitausercontent.com/45a0a298049c13588c7c744482c44fb27b827420/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62303361636435332d303533642d333635612d646365662d6133333631663164633163642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/45a0a298049c13588c7c744482c44fb27b827420/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f62303361636435332d303533642d333635612d646365662d6133333631663164633163642e706e67" alt="Untitled_2.scala.png" title="Untitled_2.scala.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/b03acd53-053d-365a-dcef-a3361f1dc1cd.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/f97d605203bd51c68eaf9be4090db36e55eda860/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f66386539616439372d376530382d346135622d613834612d3631656663326336353536612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/f97d605203bd51c68eaf9be4090db36e55eda860/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f66386539616439372d376530382d346135622d613834612d3631656663326336353536612e706e67" alt="Untitled_2.scala-2.png" title="Untitled_2.scala-2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/f8e9ad97-7e08-4a5b-a84a-61efc2c6556a.png"></a></p>

<p><a href="https://camo.qiitausercontent.com/21ba237525325b2a941b90cd0b2109453defcca4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32663234326437352d303630342d633339362d336333332d6337653539663764666164642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/21ba237525325b2a941b90cd0b2109453defcca4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f32663234326437352d303630342d633339362d336333332d6337653539663764666164642e706e67" alt="Untitled_2.scala-2 2.png" title="Untitled_2.scala-2 2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/2f242d75-0604-c396-3c33-c7e59f7dfadd.png"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />76位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/e5cfee2f34efedb67b8c">is_ssl() : HTTPSプロトコルかどうかを返す</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-03-04 22:30:54</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>なんか大掛かりになったけど、こんなんでいいんじゃないかな…？<br>
ツッコミほしい…。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * Determine if the protocol is HTTPS.</span>
<span class="sd"> * @return bool</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">is_ssl</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTPS'</span><span class="p">])</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span> <span class="c1">// Apache</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTPS'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'on'</span> <span class="k">or</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTPS'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'1'</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">elseif</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SSL'</span><span class="p">])</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span> <span class="c1">// IIS</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SSL'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'on'</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">elseif</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_PROTO'</span><span class="p">])</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span> <span class="c1">// Reverse proxy</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_PROTO'</span><span class="p">])</span> <span class="o">===</span> <span class="s1">'https'</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">elseif</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_PORT'</span><span class="p">])</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span> <span class="c1">// Reverse proxy</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_X_FORWARDED_PORT'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'443'</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">elseif</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SERVER_PORT'</span><span class="p">])</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SERVER_PORT'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'443'</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />77位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/61d121bef4d99a701543">Scala: Stringを安全にIntに変換する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-12 00:37:46</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://coderwall.com/p/lcxjzw" rel="nofollow noopener" target="_blank">Pierre Andrews : Safely parsing Strings to numbers in Scala</a>に詳しく書いてある。</p>

<p>変換時の注意点</p>

<ul>
<li>異常時の <code>java.lang.NumberFormatException</code> をキャッチしないといけない</li>
</ul>

<p>変換できたときは <code>Some(10)</code> のようなものが返り、そうでなければ <code>None</code> が反るような実装にするといい:</p>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">safeStringToInt</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">import</span> <span class="nn">scala.util.control.Exception._</span>
    <span class="n">catching</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">NumberFormatException</span><span class="o">])</span> <span class="n">opt</span> <span class="n">str</span><span class="o">.</span><span class="n">toInt</span>
<span class="o">}</span>
</pre></div></div>

<p>さらにimplicit classにすると汎用的に使いやすくなる:</p>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">StringUtils</span> <span class="o">{</span>
     <span class="k">implicit</span> <span class="k">class</span> <span class="nc">StringImprovements</span><span class="o">(</span><span class="k">val</span> <span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">import</span> <span class="nn">scala.util.control.Exception._</span>
         <span class="k">def</span> <span class="n">toIntOpt</span> <span class="k">=</span> <span class="n">catching</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">NumberFormatException</span><span class="o">])</span> <span class="n">opt</span> <span class="n">s</span><span class="o">.</span><span class="n">toInt</span>
     <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>もっといい方法がないかStackOverflowなども調べてみたが、どうやら上記のやりかたが一種の定型文化しているみたいだった。Scalaがデフォルトで <code>"1".toIntOption</code> とか提供してくれても良さそうなものだが。</p>

<p>ちなみに、scalaz なら <code>"1".parseInt.toOption</code> らしい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />78位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/bd2542b568e8a01254a9">DockerでimportしたイメージをrunするときはCMDがなくなっているので注意</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-10 20:16:23</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[docker]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Dockerのコンテナをexportする機能は便利ですが、エクスポートしたtarにはDockerfileがついてこないので、インポートしたイメージをrunするときに注意する必要がある。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>cat コンテナ.tar | docker import - &lt;repository&gt; 
docker run &lt;image_id&gt;
</pre></div></div>

<p>これだとうまく動かない。下記のようなエラーが出る。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>2014/02/10 19:19:25 Error: create: No command specified
</pre></div></div>

<p>DockerfileにあるCMDを後ろにつけて実行するとうまく</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>docker run &lt;image_id&gt; &lt;CMD&gt;
</pre></div></div>

<p>また、VOLUME や WORKDIR を Dockerfile で指定している場合は下記のように run のオプションとして渡して上げる必要がある</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>docker run -v /contaienr/vol:/host/vol:rw -w /container/workdir &lt;image_id&gt; &lt;CMD&gt;
</pre></div></div>

<p><a href="/reoring" class="user-mention js-hovercard" title="reoring" data-hovercard-target-type="user" data-hovercard-target-name="reoring">@reoring</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />79位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/2a38f3e072523fa49a5b">Go言語でRESTful APIクライアント: Qiita APIを叩いてみよう!</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-11 21:17:26</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[Go言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="この記事の目的" class="fragment"></span><a href="#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E7%9B%AE%E7%9A%84"><i class="fa fa-link"></i></a>この記事の目的</h1>

<p>Go言語で <a href="http://qiita.com/docs">Qiita API</a> のRESTful APIを叩いてトークンを取れるようになる</p>

<h1>
<span id="qiita-apiの仕様" class="fragment"></span><a href="#qiita-api%E3%81%AE%E4%BB%95%E6%A7%98"><i class="fa fa-link"></i></a>Qiita APIの仕様</h1>

<blockquote>

<h3>
<span id="token取得" class="fragment"></span><a href="#token%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>token取得</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>POST /api/v1/auth
</pre></div></div>

<p>認証: ユーザー名+パスワードによる認証</p>

<h4>
<span id="input" class="fragment"></span><a href="#input"><i class="fa fa-link"></i></a>input</h4>

<ul>
<li>url_name (必須) String

<ul>
<li>Qiitaのユーザー名(twittername or githubname@github)</li>
</ul>
</li>
<li>password (必須) String</li>
</ul>

<h4>
<span id="response" class="fragment"></span><a href="#response"><i class="fa fa-link"></i></a>response</h4>

<p>Status: 200 OK</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"url_name"</span><span class="p">:</span> <span class="s2">"yourname"</span><span class="p">,</span>
  <span class="nt">"token"</span><span class="p">:</span> <span class="s2">"yoursecrettoken"</span>
<span class="p">}</span>
</pre></div></div>
</blockquote>

<hr>

<blockquote>

<h3>
<span id="エラー時のレスポンス" class="fragment"></span><a href="#%E3%82%A8%E3%83%A9%E3%83%BC%E6%99%82%E3%81%AE%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>エラー時のレスポンス</h3>

<p>APIのリクエストに失敗したときはステータスコード400/403/404でエラーメッセージが以下の形式で返される．</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">"error"</span><span class="p">:</span> <span class="s2">"Required key `url_name` is missing."</span><span class="p">}</span>
</pre></div></div>
</blockquote>

<h1>
<span id="実装してみる" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>実装してみる</h1>

<p>RESTful APIクライアントライブラリは <a href="https://github.com/jmcvetta/napping" rel="nofollow noopener" target="_blank">github.com/jmcvetta/napping</a> を使う。</p>

<div class="code-frame" data-lang="go">
<div class="code-lang"><span class="bold">main.go</span></div>
<div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"log"</span>
    <span class="s">"github.com/jmcvetta/napping"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">urlName</span> <span class="o">:=</span> <span class="s">"suin"</span> <span class="c1">// ここは自分のものに</span>
    <span class="nx">password</span> <span class="o">:=</span> <span class="s">"p@ssW0rd"</span> <span class="c1">// ここは自分のものに</span>

    <span class="c1">// 入力JSONのフォーマットを定義 &amp; 初期化</span>
    <span class="nx">input</span> <span class="o">:=</span>  <span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">UrlName</span> <span class="kt">string</span> <span class="s">`json:"url_name"`</span> <span class="c1">// JSONのキーと構造体のキーが一致しないものは、ここでマッピングする </span>
        <span class="nx">Password</span> <span class="kt">string</span> <span class="s">`json:"password"`</span> <span class="c1">// 同上</span>
    <span class="p">}</span> <span class="p">{</span>
        <span class="nx">urlName</span><span class="p">,</span>
        <span class="nx">password</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1">// 正常時のJSONのフォーマットを定義 &amp; 初期化</span>
    <span class="c1">// Qiitaからのレスポンスには url_name も含まれるが、必要ないのでここでは定義しない</span>
    <span class="nx">response</span> <span class="o">:=</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">Token</span> <span class="kt">string</span>
    <span class="p">}</span> <span class="p">{}</span>

    <span class="c1">// エラー時のJSONのフォーマットを定義 &amp; 初期化</span>
    <span class="kt">error</span> <span class="o">:=</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">Error</span> <span class="kt">string</span>
    <span class="p">}</span> <span class="p">{}</span>

    <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">napping</span><span class="p">.</span><span class="nx">Post</span><span class="p">(</span><span class="s">"https://qiita.com/api/v1/auth"</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">input</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">response</span><span class="p">,</span> <span class="o">&amp;</span><span class="kt">error</span><span class="p">)</span> <span class="c1">// input, response, errorは参照を渡す</span>

    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"status: %#v"</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Status</span><span class="p">())</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"token: %#v"</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">Token</span><span class="p">)</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"error message: %#v"</span><span class="p">,</span> <span class="kt">error</span><span class="p">.</span><span class="nx">Error</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>

<p>実行してみる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>go run main.go
</pre></div></div>

<p>結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>2013/12/11 21:07:42 status: 200
2013/12/11 21:07:42 token: "d61c32d3f02543b39d61e9b545c58d0c"
2013/12/11 21:07:42 error message: ""
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />80位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/3527297a22632f3db31d">MySQLの「暗黙のトランザクションコミット」対策：トランザクション中でも安全にCREATE TABLEなどをする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-02-16 14:54:34</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[MySQL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://dev.mysql.com/doc/refman/5.1/ja/implicit-commit.html" rel="nofollow noopener" target="_blank">MySQL ::   MySQL 5.1 リファレンスマニュアル :: 12.4.3 暗黙のコミットを引き起こすステートメント</a></p>

<blockquote>
<p>次の各ステートメント(そしてそれらの同義語)は、まるでステートメントを実行する前に COMMIT を行ったかのように、暗黙にトランザクションを終了します。</p>

<blockquote>
<p>ALTER FUNCTION, ALTER PROCEDURE, ALTER TABLE, BEGIN, CREATE DATABASE, CREATE FUNCTION, CREATE INDEX, CREATE PROCEDURE, CREATE TABLE, DROP DATABASE, DROP FUNCTION, DROP INDEX, DROP PROCEDURE, DROP TABLE, LOAD DATA INFILE LOCK TABLES, RENAME TABLE, SET AUTOCOMMIT=1, START TRANSACTION, TRUNCATE TABLE, UNLOCK TABLES.</p>
</blockquote>
</blockquote>

<p>とのことなので、<code>BEGIN</code> していても、途中で <code>CREATE TABLE</code> などをすると、その直前で <code>COMMIT</code> が走ります。「CREATE TABLE失敗しちゃったー、とりあえずできたかどうかわからんテーブルはDROP IF EXISTSするとして、その前にやったデータ更新系はROLLBACKだ！」なんて思っても、既に遅しです。</p>

<p>ここでは、トランザクション中でも安全にCREATE TABLEなどをするコードを紹介します。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$dbname</span> <span class="o">=</span> <span class="s1">'test'</span><span class="p">;</span>
<span class="nv">$host</span>   <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$user</span>   <span class="o">=</span> <span class="s1">'root'</span><span class="p">;</span>
<span class="nv">$pass</span>   <span class="o">=</span> <span class="s1">'root'</span><span class="p">;</span>
<span class="nv">$dsn</span>    <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'mysql:dbname=%s;host=%s'</span><span class="p">,</span> <span class="nv">$dbname</span><span class="p">,</span> <span class="nv">$host</span><span class="p">);</span>

<span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ORACLE_NULLS</span>       <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">NULL_NATURAL</span><span class="p">,</span>
    <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_DEFAULT_FETCH_MODE</span> <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">,</span>
    <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span>            <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">,</span>
    <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span>         <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="nx">PDO</span><span class="o">::</span><span class="na">MYSQL_ATTR_INIT_COMMAND</span> <span class="o">=&gt;</span> <span class="s1">'SET NAMES utf8'</span><span class="p">,</span>
    <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_EMULATE_PREPARES</span>   <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="p">);</span>

<span class="sd">/**</span>
<span class="sd"> * クエリーをログできるようにしたPDO</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MyPDO</span> <span class="k">extends</span> <span class="nx">PDO</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_print</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
        <span class="nv">$arguments</span> <span class="o">=</span> <span class="nb">func_get_args</span><span class="p">();</span>
        <span class="k">return</span> <span class="nb">call_user_func_array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'parent'</span><span class="p">,</span> <span class="s1">'query'</span><span class="p">),</span> <span class="nv">$arguments</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">beginTransaction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_print</span><span class="p">(</span><span class="s1">'BEGIN'</span><span class="p">);</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">beginTransaction</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">rollBack</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_print</span><span class="p">(</span><span class="s1">'ROLLBACK'</span><span class="p">);</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">rollBack</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_print</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="nv">$count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">echo</span> <span class="nv">$count</span><span class="o">.</span><span class="s1">') '</span><span class="o">.</span><span class="nv">$query</span><span class="o">.</span><span class="s1">';'</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="nv">$count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">echo</span> <span class="s2">"暗黙のトランザクションコミットが走るかどうかの実験</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">;</span>

<span class="c1">// 下準備</span>
<span class="sd">/** @var PDO $pdo  */</span>
<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyPDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS foo'</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS baz'</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'CREATE TABLE foo (bar VARCHAR(255)) ENGINE=InnoDB'</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'INSERT INTO foo (bar) VALUES ("a"), ("b"), ("c")'</span><span class="p">);</span>

<span class="c1">// 更新処理</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">beginTransaction</span><span class="p">();</span> <span class="c1">// トランザクション開始</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'DELETE FROM foo'</span><span class="p">);</span> <span class="c1">// fooテーブルのレコードすべて削除</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'CREATE TABLE baz (bazbaz VARCHAR(255)) ENGINE=InnoDB'</span><span class="p">);</span> <span class="c1">// 暗黙のトランザクションコミットが走る</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">rollBack</span><span class="p">();</span> <span class="c1">// ロールバック！</span>
<span class="nb">var_export</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM foo'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">());</span> <span class="c1">// ロールバックが効いていないので fooテーブルには何も残ってない</span>


<span class="k">echo</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">CREATE TABLE文を別コネクションにしたら,</span>
<span class="s2">暗黙のトランザクションコミットがどうなるかの実験</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">;</span>

<span class="c1">// 下準備</span>
<span class="sd">/** @var PDO $pdo  */</span>
<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyPDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$pdoAnother</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyPDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS foo'</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS baz'</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'CREATE TABLE foo (bar VARCHAR(255)) ENGINE=InnoDB'</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'INSERT INTO foo (bar) VALUES ("a"), ("b"), ("c")'</span><span class="p">);</span>

<span class="c1">// 更新処理</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">beginTransaction</span><span class="p">();</span> <span class="c1">// トランザクション開始</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'DELETE FROM foo'</span><span class="p">);</span> <span class="c1">// fooテーブルのレコードすべて削除</span>
<span class="nv">$pdoAnother</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'CREATE TABLE baz (bazbaz VARCHAR(255)) ENGINE=InnoDB'</span><span class="p">);</span> <span class="c1">// 別コネクションなのでトランザクションには影響ない</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">rollBack</span><span class="p">();</span> <span class="c1">// ロールバック！</span>
<span class="nb">var_export</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM foo'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">());</span> <span class="c1">// ロールバックが効いているので、fooテーブルは元通りになっている</span>
</pre></div></div>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">実行結果</span></div>
<div class="highlight"><pre><span></span>
php TransactionWithCreateTable.php 
暗黙のトランザクションコミットが走るかどうかの実験

1) DROP TABLE IF EXISTS foo;
2) DROP TABLE IF EXISTS baz;
3) CREATE TABLE foo (bar VARCHAR(255)) ENGINE=InnoDB;
4) INSERT INTO foo (bar) VALUES ("a"), ("b"), ("c");
5) BEGIN;
6) DELETE FROM foo;
7) CREATE TABLE baz (bazbaz VARCHAR(255)) ENGINE=InnoDB;
8) ROLLBACK;
9) SELECT * FROM foo;
array (
)

CREATE TABLE文を別コネクションにしたら,
暗黙のトランザクションコミットがどうなるかの実験

10) DROP TABLE IF EXISTS foo;
11) DROP TABLE IF EXISTS baz;
12) CREATE TABLE foo (bar VARCHAR(255)) ENGINE=InnoDB;
13) INSERT INTO foo (bar) VALUES ("a"), ("b"), ("c");
14) BEGIN;
15) DELETE FROM foo;
16) CREATE TABLE baz (bazbaz VARCHAR(255)) ENGINE=InnoDB;
17) ROLLBACK;
18) SELECT * FROM foo;
array (
  0 =&gt; 
  array (
    'bar' =&gt; 'a',
  ),
  1 =&gt; 
  array (
    'bar' =&gt; 'b',
  ),
  2 =&gt; 
  array (
    'bar' =&gt; 'c',
  ),
)
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />81位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/b5445ff6fbc21e8d883a">ディレクトリを再帰的に削除する方法のメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2011-11-22 08:16:15</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><ul>
<li>RecursiveIteratorIteratorを使うと楽。</li>
</ul>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="s1">'/path/to/dir'</span><span class="p">;</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RecursiveIteratorIterator</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">RecursiveDirectoryIterator</span><span class="p">(</span><span class="nv">$dir</span><span class="p">,</span> <span class="nx">FilesystemIterator</span><span class="o">::</span><span class="na">SKIP_DOTS</span><span class="p">),</span>
    <span class="nx">RecursiveIteratorIterator</span><span class="o">::</span><span class="na">CHILD_FIRST</span>
<span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">isDir</span><span class="p">()</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">rmdir</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getPathname</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="nb">unlink</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getPathname</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">rmdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />82位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/2169e10c059584da4783">cakeコマンドでCoffeeScriptをひとつのjsにまとめる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-01-27 08:51:56</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[CoffeeScript]</b> <b>[cake]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ビルドをプログラミングした <code>Cakefile</code> ファイルを用意して、<code>cake</code> コマンドでいつでもビルドできるようにしておくと大変便利。この例は、foo.coffee, bar.coffee, baz.coffeeをbuild.jsにコンパイルするものです。</p>

<div class="code-frame" data-lang="coffeescript">
<div class="code-lang"><span class="bold">Cakefile</span></div>
<div class="highlight"><pre><span></span><span class="nv">util = </span><span class="nx">require</span><span class="p">(</span><span class="s">'util'</span><span class="p">)</span>
<span class="nv">exec = </span><span class="nx">require</span><span class="p">(</span><span class="s">'child_process'</span><span class="p">).</span><span class="nx">exec</span>

<span class="c1"># 設定</span>
<span class="nv">SOURCE_DIR = </span><span class="s">'./source'</span>
<span class="nv">TARGET_DIR = </span><span class="s">'./build'</span>
<span class="nv">TARGET_FILENAME = </span><span class="s">'build.js'</span>

<span class="c1">#コンパイルするファイル群</span>
<span class="nv">files = </span><span class="p">[</span>
    <span class="s">'foo.coffee'</span>
    <span class="s">'bar.coffee'</span>
    <span class="s">'baz.coffee'</span>
<span class="p">]</span>

<span class="c1"># タスクの登録</span>
<span class="nx">task</span> <span class="s">'build'</span><span class="p">,</span> <span class="s">'CoffeeScriptをまとめてひとつのJavaScriptにします'</span><span class="p">,</span> <span class="nf">(options) -&gt;</span>

    <span class="c1"># ファイルを構成する</span>
    <span class="nx">util</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">'まとめるファイルを構成します'</span><span class="p">)</span>
    <span class="nv">fileList = </span><span class="p">[]</span>

    <span class="k">for</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">files</span>
        <span class="nv">file = </span><span class="nx">SOURCE_DIR</span> <span class="o">+</span> <span class="s">'/'</span> <span class="o">+</span> <span class="nx">filename</span>
        <span class="nx">fileList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
        <span class="nx">util</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">"</span><span class="si">#{</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s">) </span><span class="si">#{</span><span class="nx">file</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="nv">fileList = </span><span class="nx">fileList</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>

    <span class="c1"># コンパイルオプション</span>
    <span class="nv">option = </span><span class="s">"-b -cj </span><span class="si">#{</span><span class="nx">TARGET_DIR</span><span class="si">}</span><span class="s">/</span><span class="si">#{</span><span class="nx">TARGET_FILENAME</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">fileList</span><span class="si">}</span><span class="s">"</span>

    <span class="c1"># コンパイル実行</span>
    <span class="nx">util</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">'コンパイルします'</span><span class="p">)</span>
    <span class="nx">exec</span> <span class="s">"coffee </span><span class="si">#{</span><span class="nx">option</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="nf">(error, stdout, stderr) -&gt;</span> 

        <span class="nx">util</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">if</span> <span class="nx">error</span>
        <span class="nx">util</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stdout</span><span class="p">)</span> <span class="k">if</span> <span class="nx">stdout</span>
        <span class="nx">util</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stderr</span><span class="p">)</span> <span class="k">if</span> <span class="nx">stderr</span>

        <span class="k">if</span> <span class="nx">error</span>
            <span class="nx">util</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">'失敗しました'</span><span class="p">)</span>
        <span class="k">else</span>
            <span class="nx">util</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">'成功しました'</span><span class="p">)</span>
</pre></div>
</div>

<h1>
<span id="使い方とか" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9%E3%81%A8%E3%81%8B"><i class="fa fa-link"></i></a>使い方とか</h1>

<p><code>cake</code> を叩くと、Cakefileが提供しているタスクの一覧が確認できます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>^_^ (suinair:~/Desktop/project)
* tree .
.
├── Cakefile
├── build
└── source
    ├── bar.coffee
    ├── baz.coffee
    └── foo.coffee

2 directories, 4 files

^_^ (suinair:~/Desktop/project)
* cake
Cakefile defines the following tasks:

cake build                # CoffeeScriptをまとめてひとつのJavaScriptにします

^_^ 3 hits! (suinair:~/Desktop/project)
* cake build
27 Jan 08:47:17 - まとめるファイルを構成します
27 Jan 08:47:17 - 1) ./source/foo.coffee
27 Jan 08:47:17 - 2) ./source/bar.coffee
27 Jan 08:47:17 - 3) ./source/baz.coffee
27 Jan 08:47:17 - コンパイルします
27 Jan 08:47:18 - 成功しました

^_^ 4 hits! (suinair:~/Desktop/project)
* tree .
.
├── Cakefile
├── build
│   └── build.js
└── source
    ├── bar.coffee
    ├── baz.coffee
    └── foo.coffee

2 directories, 5 files
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />83位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/9494ca1b68fb47cf6baa">Node.js + Socket.io + CoffeeScript + jQueryでチャットのサンプルを作ってみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-01-22 18:25:48</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[CoffeeScript]</b> <b>[Node.js]</b> <b>[jQuery]</b> <b>[Socket.io]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>READMEが長いのでURLだけ貼っつけます<br>
<a href="https://github.com/suin/chat-nodejs" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/suin/chat-nodejs</a><br>
<a href="http://chat.suin.org/" class="autolink" rel="nofollow noopener" target="_blank">http://chat.suin.org/</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />84位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/9eaa000bc0e7d51c1446">複数のCoffeeScriptファイルからひとつのJavaScriptファイルにコンパイルする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-01-22 14:05:48</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[CoffeeScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>元ネタ： <a href="http://stackoverflow.com/a/8046962" class="autolink" rel="nofollow noopener" target="_blank">http://stackoverflow.com/a/8046962</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ coffee -cj path/to/compiled/file.js file1 file2 file3 file4
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />85位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/cd0a03ccc574382d9f15">PHPUnitで定数のテストをするときは@runInSeparateProcessで別プロセスに</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2011-12-28 22:08:08</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[PHPUnit]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>定数を動的に定義するようなプログラムを一つのテストプロセスでやってしまうと、定数は上書きできないためうまくテストできない。</p>

<p>そんなときはテストを別プロセスにすることでテスタブルになる。</p>

<p>やり方は <code>@runInSeparateProcess</code> アノテーションを別プロセスにしたいテストにつけるだけ。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">ConstantTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @runInSeparateProcess</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConstant1</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">define</span><span class="p">(</span><span class="s1">'THIS_IS_CONSTANT'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="nx">THIS_IS_CONSTANT</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @runInSeparateProcess</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConstant2</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">define</span><span class="p">(</span><span class="s1">'THIS_IS_CONSTANT'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'bar'</span><span class="p">,</span> <span class="nx">THIS_IS_CONSTANT</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @runInSeparateProcess</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testConstant3</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">define</span><span class="p">(</span><span class="s1">'THIS_IS_CONSTANT'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'baz'</span><span class="p">,</span> <span class="nx">THIS_IS_CONSTANT</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<p>実行結果</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>PHPUnit 3.6.3 by Sebastian Bergmann.

...

Time: 0 seconds, Memory: 4.75Mb

OK (3 tests, 3 assertions)
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />86位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/36248bfb4681beaf1765">RiakのGUI管理ツール4選！スクリーンキャプチャあり</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-10 20:17:23</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Ruby]</b> <b>[riak]</b> <b>[nosql]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="1rekon-推奨度" class="fragment"></span><a href="#1rekon-%E6%8E%A8%E5%A5%A8%E5%BA%A6"><i class="fa fa-link"></i></a>1.<a href="https://github.com/basho/rekon" rel="nofollow noopener" target="_blank">Rekon</a> 推奨度★★★</h1>

<p>Riak以外必要としない(Javaやnode.jsなどが不要)HTMLベースのGUI管理ツール。下記のインストールコマンドを実行すると、Riakのストレージ上にRekonのソースコードやCSS、JavaScriptが配置され、ユーザはRiakの/buckets/rekon/keys/goを開くだけ。Riakの特性をうまく使ったなんとも目からうろこなプロダクト。</p>

<h2>
<span id="インストール方法" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>インストール方法</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>curl -s -L rekon.basho.com | sh
</pre></div></div>

<h2>
<span id="バケツ一覧画面" class="fragment"></span><a href="#%E3%83%90%E3%82%B1%E3%83%84%E4%B8%80%E8%A6%A7%E7%94%BB%E9%9D%A2"><i class="fa fa-link"></i></a>バケツ一覧画面</h2>

<p><a href="https://camo.qiitausercontent.com/4bc8782e16069ae04d40e0209335d5ef5691ba6b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61666265613161362d333831622d636563652d313333642d3865636464663535616234662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4bc8782e16069ae04d40e0209335d5ef5691ba6b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f61666265613161362d333831622d636563652d313333642d3865636464663535616234662e706e67" alt="rekon_v1_0_0.png" title="rekon_v1_0_0.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/afbea1a6-381b-cece-133d-8ecddf55ab4f.png"></a></p>

<h2>
<span id="キーの一覧画面" class="fragment"></span><a href="#%E3%82%AD%E3%83%BC%E3%81%AE%E4%B8%80%E8%A6%A7%E7%94%BB%E9%9D%A2"><i class="fa fa-link"></i></a>キーの一覧画面</h2>

<p><a href="https://camo.qiitausercontent.com/65bd3a8864a76d97bec02d2b697ac7185933eef9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65353139613735652d363739652d326461362d333136632d3332306634376163386438342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/65bd3a8864a76d97bec02d2b697ac7185933eef9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f65353139613735652d363739652d326461362d333136632d3332306634376163386438342e706e67" alt="rekon_v1_0_0-2.png" title="rekon_v1_0_0-2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/e519a75e-679e-2da6-316c-320f47ac8d84.png"></a></p>

<h2>
<span id="キーの編集画面" class="fragment"></span><a href="#%E3%82%AD%E3%83%BC%E3%81%AE%E7%B7%A8%E9%9B%86%E7%94%BB%E9%9D%A2"><i class="fa fa-link"></i></a>キーの編集画面</h2>

<p><a href="https://camo.qiitausercontent.com/aca9d2e2b0c9dc949761b5df7c05beb98b19fd6b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64376166633866332d656538322d353265322d646466352d6363633231623064306233642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/aca9d2e2b0c9dc949761b5df7c05beb98b19fd6b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f64376166633866332d656538322d353265322d646466352d6363633231623064306233642e706e67" alt="rekon_v1_0_0-3.png" title="rekon_v1_0_0-3.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/d7afc8f3-ee82-52e2-ddf5-ccc21b0d0b3d.png"></a></p>

<h1>
<span id="2riak-admin-推奨度" class="fragment"></span><a href="#2riak-admin-%E6%8E%A8%E5%A5%A8%E5%BA%A6"><i class="fa fa-link"></i></a>2.<a href="https://bitbucket.org/harmen/riak-admin" rel="nofollow noopener" target="_blank">riak-admin</a> 推奨度★☆☆</h1>

<p>JavaベースのGUIツール。Rekonに比べると完成度はあまり高くない。</p>

<h2>
<span id="インストール方法-1" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95-1"><i class="fa fa-link"></i></a>インストール方法</h2>

<p><a href="https://bitbucket.org/harmen/riak-admin/downloads" rel="nofollow noopener" target="_blank">ダウンロードページ</a>からriak-admin-0.1.jarをダウンロードして開く。</p>

<h2>
<span id="キーの一覧画面-1" class="fragment"></span><a href="#%E3%82%AD%E3%83%BC%E3%81%AE%E4%B8%80%E8%A6%A7%E7%94%BB%E9%9D%A2-1"><i class="fa fa-link"></i></a>キーの一覧画面</h2>

<p><a href="https://camo.qiitausercontent.com/1ddf01e2ce6f7dc31f601466acb6664d91281142/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63326162626232642d623366652d623938372d316662342d3730616537313364306632362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1ddf01e2ce6f7dc31f601466acb6664d91281142/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f63326162626232642d623366652d623938372d316662342d3730616537313364306632362e706e67" alt="Riak_Admin.png" title="Riak_Admin.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/c2abbb2d-b3fe-b987-1fb4-70ae713d0f26.png"></a></p>

<h1>
<span id="3riak-admin-推奨度" class="fragment"></span><a href="#3riak-admin-%E6%8E%A8%E5%A5%A8%E5%BA%A6"><i class="fa fa-link"></i></a>3.<a href="https://github.com/frank06/riak-admin" rel="nofollow noopener" target="_blank">riak-admin</a> 推奨度★☆☆</h1>

<p>これもRekon同様に、Riak上に管理ツールを構築するプロダクト。今日(2014/01/10)現在、<a href="https://github.com/frank06/riak-admin/issues/5" rel="nofollow noopener" target="_blank">依存するサブモジュールが存在しない不具合</a>が解消されておらず、動くところを確認することができなかった。</p>

<h1>
<span id="4briak-推奨度" class="fragment"></span><a href="#4briak-%E6%8E%A8%E5%A5%A8%E5%BA%A6"><i class="fa fa-link"></i></a>4.<a href="https://github.com/johnthethird/Briak" rel="nofollow noopener" target="_blank">Briak</a> 推奨度★★☆</h1>

<p>RubyのSinatraベースのGUIツール。管理したいRiakをホストとポートで指定することができる。</p>

<h2>
<span id="ruby187とsinatraが必要" class="fragment"></span><a href="#ruby187%E3%81%A8sinatra%E3%81%8C%E5%BF%85%E8%A6%81"><i class="fa fa-link"></i></a>Ruby1.8.7とSinatraが必要</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>gem install sinatra ripple
</pre></div></div>

<h2>
<span id="インストール手順" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>インストール手順</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git clone http://github.com/johnthethird/Briak.git briak
cd briak
ruby briak.rb
</pre></div></div>

<p><a href="http://127.0.0.1:4567" class="autolink" rel="nofollow noopener" target="_blank">http://127.0.0.1:4567</a> を開くと管理画面に入ることができる。</p>

<h2>
<span id="キー編集画面" class="fragment"></span><a href="#%E3%82%AD%E3%83%BC%E7%B7%A8%E9%9B%86%E7%94%BB%E9%9D%A2"><i class="fa fa-link"></i></a>キー編集画面</h2>

<p><a href="https://camo.qiitausercontent.com/38ba42eec1d69dcd57c264b4bdeb8baf3ad6e27b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36343034303539652d336339612d633639632d346661322d3530653437353664396131302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/38ba42eec1d69dcd57c264b4bdeb8baf3ad6e27b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3838392f36343034303539652d336339612d633639632d346661322d3530653437353664396131302e706e67" alt="Briak_-_Browser_for_Riak.png" title="Briak_-_Browser_for_Riak.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/889/6404059e-3c9a-c69c-4fa2-50e4756d9a10.png"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />87位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/157d14e467e31ad561d0">13行のシンプルなPSR-0準拠APCクラスローダー</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-08-29 01:47:08</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Symfonyの<a href="http://docs.symfony.gr.jp/symfony2/book/performance.html" rel="nofollow noopener" target="_blank">ApcUniversalClassLoader</a>のシンプル版です。</p>

<p>標準的なクラスローダーは、ファイルの存在チェックのために <code>file_exists()</code> を使っています。なので、そこそこの規模のアプリケーションは、アクセス毎に数百のファイル情報をチェックしているということになります。カーネルがメモリ上にバッファすることもあるので一概には言えませんが、標準的なクラスローダーはI/Oオーバヘッドが潜在的にあるのです。</p>

<p><code>ApcUniversalClassLoader</code> は「じゃあクラス=&gt;パスのマップをメモリ上にもってそれを手がかりに一発でファイル引き抜けばI/O減るんじゃない？」という発想から来ています。一度読み込まれたクラスは、APCのキャッシュとして保存されます。二回目以降は、キャッシュ上のマップを手がかりにファイルを探します。デプロイなどで、キャッシュ上のファイルパスと実際のファイルパスが乖離する場合がありますが、それは上記のSymfonyのサイトにも注意書きがあります。</p>

<p>今回作ったのは、<code>ApcUniversalClassLoader</code>の13行版です。また、以前に書いた<a href="http://qiita.com/items/5fdbc2681b778a9cd24f">ワンラインPSR-0準拠クラスオートローダー</a>の発展系でもあります。実装は次のようになります。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$prefix</span> <span class="o">=</span> <span class="s1">'foo.example.com.'</span><span class="p">;</span>

<span class="nb">spl_autoload_register</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$class</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$prefix</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="k">false</span> <span class="o">===</span> <span class="nv">$path</span> <span class="o">=</span> <span class="nb">apc_fetch</span><span class="p">(</span><span class="nv">$prefix</span><span class="o">.</span><span class="nv">$class</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$nsEnd</span> <span class="o">=</span> <span class="nb">strrpos</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="s1">'\\'</span><span class="p">);</span>
        <span class="nv">$file</span>  <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$nsEnd</span><span class="p">),</span> <span class="s1">'\\'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">);</span>
        <span class="nv">$file</span> <span class="o">.=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$nsEnd</span><span class="p">),</span> <span class="s1">'\\_'</span><span class="p">,</span> <span class="s1">'//'</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="k">false</span> <span class="o">!==</span> <span class="nv">$path</span> <span class="o">=</span> <span class="nb">stream_resolve_include_path</span><span class="p">(</span><span class="nv">$file</span><span class="o">.</span><span class="s1">'.php'</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nb">apc_store</span><span class="p">(</span><span class="nv">$prefix</span><span class="o">.</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$path</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nv">$path</span> <span class="k">and</span> <span class="k">include</span> <span class="nv">$path</span><span class="p">;</span>
<span class="p">});</span>
</pre></div></div>

<p>パスの追加は <code>set_include_path()</code> を通してやります。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">set_include_path</span><span class="p">(</span><span class="nb">get_include_path</span><span class="p">()</span> <span class="o">.</span> <span class="nx">PATH_SEPARATOR</span> <span class="o">.</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">'/vendor/twig/twig/lib'</span><span class="p">);</span>
</pre></div></div>

<h2>
<span id="解説" class="fragment"></span><a href="#%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>解説</h2>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;?php
$prefix = 'foo.example.com.';
// APCはグローバル空間です。
// プロセスごとやアプリごとのスコープはありません。
// なので、キー名にprefixをつけるのが安全です。
// 他のアプリケーションや、プロダクション環境とステージング環境が共存するサーバで、
// キーがバッティングすることを防ぎます。


// とにかく短くしたかったので Closure をそのまま `spl_autoload_register` に渡しています。
spl_autoload_register(function($class) use ($prefix) {

    // APC上にキーがクラス名のデータがあるかチェックします。
    if ( false === $path = apc_fetch($prefix.$class) ) {
        // なければファイルを探しに行きます

        // PSR-0の規定で名前空間のアンダースコアはそのままにするという
        // 決まりがあるので、名前空間とそれ以下は別々に処理しています。
        $nsEnd = strrpos($class, '\\');
        $file  = strtr(substr($class, 0, $nsEnd), '\\', '/');
        $file .= strtr(substr($class, $nsEnd), '\\_', '//');

        // ファイルがあるかチェックします。
        if ( false !== $path = stream_resolve_include_path($file.'.php') ) {
            // あれば、APCに登録します
            apc_store($prefix.$class, $path);
        }
    }

    // $path が false でなければ include します。
    $path and include $path;
});
</pre></div></div>

<p>最後の行ですが、<code>include_once</code> ではなく <code>include</code> にしているのはAPCの性能を最大限に活かすためです。php.iniで <code>apc.stat = 0</code> にしておく(デフォルトは1)と、APCはキャッシュされたファイルに更新があるか見に行かなくなります。つまり、APC上でクラス名:ファイルパスのマップがあって、そのファイル自体がAPCにキャッシュされているとハードディスクへの問い合わせは0になるということです。したがって、最大限にオーバヘッドを抑えることができます。言い換えると、このクラスローダーは <code>file_exists()</code> のオーバヘッドと、<code>include</code> のオーバヘッドを削減できるということです。</p>

<p>ちなみに、APC上のユーザキャッシュを確認するのは <code>APCIterator</code> が便利です。<a href="http://svn.php.net/repository/pecl/apc/trunk/apc.php" rel="nofollow noopener" target="_blank"><code>apc.php</code></a>があるならそちらでもいいですね。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;?php
foreach (new APCIterator('user') as $counter) {
    var_dump("$counter[key]: $counter[value]");
}
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />88位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/4e384323df88f5578c06">php.iniの設定値を自動テストするコマンドツール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-08-08 12:38:53</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>php.ini</code> の設定を確認するために、PHPUnitを使って自動テストできるコマンドツールを作ってみた。これで手順書+目視確認っていうアナログから脱出する。要件としては、phpunitが入っていること。</p>

<p>以下のファイルを <code>php-ini-check</code> という名前で <code>~/bin</code> などに保存して <code>chmod +x</code> する。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">php-ini-check</span></div>
<div class="highlight"><pre><span></span><span class="x">#!/usr/bin/env phpunit --colors --no-configuration</span>
<span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PhpIniTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">setUpBeforeClass</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'PHP Version: %s'</span><span class="p">,</span> <span class="k">PHP_VERSION</span><span class="p">),</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @dataProvider dataForTestIni</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIniDevelop</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$expect</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="nb">ini_get</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nv">$actual</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">markTestSkipped</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s2">"The configuration option doesn't exist: %s"</span><span class="p">,</span> <span class="nv">$name</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expect</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">dataForTestIni</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'expose_php'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s2">"Offにする。HTTPヘッダにPHPのバージョンを出す必要がない。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'display_errors'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">,</span> <span class="s2">"Onにする。(開発環境)"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'log_errors'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">,</span> <span class="s2">"Onにすること。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'log_errors_max_len'</span><span class="p">,</span> <span class="s1">'4096'</span><span class="p">,</span> <span class="s2">"4096 = 目安"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'error_log'</span><span class="p">,</span> <span class="s1">'/var/log/php_error.log'</span><span class="p">,</span> <span class="s2">"ログの場所を指定する。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'register_globals'</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">,</span> <span class="s2">"Offにする。予期せぬセキュリティ的な問題や不具合の原因になる。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'register_long_arrays'</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">,</span> <span class="s2">"Offにする。</span><span class="se">\$</span><span class="s2">HTTP_GET_VARSなどは使わない。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'magic_quotes_gpc'</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">,</span> <span class="s2">"Offにする。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'allow_url_include'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s2">"デフォルトでOff。必要に応じてプログラムでOnにする。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'default_charset'</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">,</span> <span class="s2">"UTF-8にする。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'mbstring.internal_encoding'</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">,</span> <span class="s2">"UTF-8にする。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'mbstring.language'</span><span class="p">,</span> <span class="s1">'Japanese'</span><span class="p">,</span> <span class="s1">'Japaneseにする。'</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'mbstring.substitute_character'</span><span class="p">,</span> <span class="s1">'none'</span><span class="p">,</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">none</span><span class="se">\"</span><span class="s2">にする。クォーテーションを忘れずに。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'date.timezone'</span><span class="p">,</span> <span class="s1">'Asia/Tokyo'</span><span class="p">,</span> <span class="s2">"Asia/Tokyoをセットする。"</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'phar.readonly'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s2">"Offにする。(開発環境)"</span><span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>ところで、シェバンって <code>#!/usr/bin/env phpunit --colors --no-configuration</code> みたいな書き方できるのね。今まで <code>#!/usr/bin/env php</code> ぐらいしかやったことなかった。</p>

<p>インストールしたばっかりだとでるわでるわ</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ php-ini-check 
#!/usr/bin/env phpunit --colors --no-configuration
PHPUnit 3.6.10 by Sebastian Bergmann.

PHP Version: 5.3.10
FF.FFFFF.FFFF.F

Time: 0 seconds, Memory: 5.50Mb

There were 12 failures:

1) PhpIniTest::testIniDevelop with data set #0 ('expose_php', '', 'Offにする。HTTPヘッダにPHPのバージョンを出す必要がない。')
Offにする。HTTPヘッダにPHPのバージョンを出す必要がない。
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-
+1

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

2) PhpIniTest::testIniDevelop with data set #1 ('display_errors', '1', 'Onにする。(開発環境)')
Onにする。(開発環境)
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-1
+

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

3) PhpIniTest::testIniDevelop with data set #3 ('log_errors_max_len', '4096', '4096 = 目安')
4096 = 目安
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-4096
+1024

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

4) PhpIniTest::testIniDevelop with data set #4 ('error_log', '/var/log/php_error.log', 'ログの場所を指定する。')
ログの場所を指定する。
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-/var/log/php_error.log
+

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

5) PhpIniTest::testIniDevelop with data set #5 ('register_globals', '0', 'Offにする。予期せぬセキュリティ的な問題や不具合の原因になる。')
Offにする。予期せぬセキュリティ的な問題や不具合の原因になる。
Failed asserting that two strings are identical.

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

6) PhpIniTest::testIniDevelop with data set #6 ('register_long_arrays', '0', 'Offにする。$HTTP_GET_VARSなどは使わない。')
Offにする。$HTTP_GET_VARSなどは使わない。
Failed asserting that two strings are identical.

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

7) PhpIniTest::testIniDevelop with data set #7 ('magic_quotes_gpc', '0', 'Offにする。')
Offにする。
Failed asserting that two strings are identical.

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

8) PhpIniTest::testIniDevelop with data set #9 ('default_charset', 'UTF-8', 'UTF-8にする。')
UTF-8にする。
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-UTF-8
+

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

9) PhpIniTest::testIniDevelop with data set #10 ('mbstring.internal_encoding', 'UTF-8', 'UTF-8にする。')
UTF-8にする。
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-UTF-8
+

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

10) PhpIniTest::testIniDevelop with data set #11 ('mbstring.language', 'Japanese', 'Japaneseにする。')
Japaneseにする。
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-Japanese
+neutral

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

11) PhpIniTest::testIniDevelop with data set #12 ('mbstring.substitute_character', 'none', '"none"にする。クォーテーションを忘れずに。')
"none"にする。クォーテーションを忘れずに。
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-none
+

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

12) PhpIniTest::testIniDevelop with data set #14 ('phar.readonly', '', 'Offにする。(開発環境)')
Offにする。(開発環境)
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-
+1

/Users/suin/Dropbox/Suin/Projects/Private/cli-tools/php-ini-check.php:22
/Users/suin/local/php/versions/5.3.10/bin/phpunit:46

FAILURES!
Tests: 15, Assertions: 15, Failures: 12.
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />89位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/933c5904550f88be0308">都道府県のリストをサクッと出力するだけのCLIツール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-06-26 23:28:24</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ウェブ開発で都道府県のリストが欲しいときに、サクッとリストを生成するためのスクリプトです。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">prefecture</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">FORMAT_DEFAULT</span> <span class="o">=</span> <span class="s1">'</span><span class="si">%s</span><span class="s1">'</span><span class="p">;</span>

<span class="n">DATA</span> <span class="o">=</span> <span class="s2">"""北海道</span>
<span class="s2">青森県</span>
<span class="s2">岩手県</span>
<span class="s2">宮城県</span>
<span class="s2">秋田県</span>
<span class="s2">山形県</span>
<span class="s2">福島県</span>
<span class="s2">茨城県</span>
<span class="s2">栃木県</span>
<span class="s2">群馬県</span>
<span class="s2">埼玉県</span>
<span class="s2">千葉県</span>
<span class="s2">東京都</span>
<span class="s2">神奈川県</span>
<span class="s2">新潟県</span>
<span class="s2">富山県</span>
<span class="s2">石川県</span>
<span class="s2">福井県</span>
<span class="s2">山梨県</span>
<span class="s2">長野県</span>
<span class="s2">岐阜県</span>
<span class="s2">静岡県</span>
<span class="s2">愛知県</span>
<span class="s2">三重県</span>
<span class="s2">滋賀県</span>
<span class="s2">京都府</span>
<span class="s2">大阪府</span>
<span class="s2">兵庫県</span>
<span class="s2">奈良県</span>
<span class="s2">和歌山県</span>
<span class="s2">鳥取県</span>
<span class="s2">島根県</span>
<span class="s2">岡山県</span>
<span class="s2">広島県</span>
<span class="s2">山口県</span>
<span class="s2">徳島県</span>
<span class="s2">香川県</span>
<span class="s2">愛媛県</span>
<span class="s2">高知県</span>
<span class="s2">福岡県</span>
<span class="s2">佐賀県</span>
<span class="s2">長崎県</span>
<span class="s2">熊本県</span>
<span class="s2">大分県</span>
<span class="s2">宮崎県</span>
<span class="s2">鹿児島県</span>
<span class="s2">沖縄県"""</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Print prefectures'</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-f'</span><span class="p">,</span> <span class="s1">'--format'</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">"format"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"line format"</span> <span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">FORMAT_DEFAULT</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">'-n'</span><span class="p">,</span> <span class="s1">'--no-line-break'</span><span class="p">,</span>  <span class="n">help</span><span class="o">=</span><span class="s2">"if add this, print all in one line"</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">'store_true'</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">no_line_break</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">line_break</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_break</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">):</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">format</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>

    <span class="k">print</span> <span class="n">line_break</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>とりあえず、一覧を出すだけ:</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ prefecture 
北海道
青森県
<span class="o">(</span>略<span class="o">)</span>
鹿児島県
沖縄県
</pre></div></div>

<p>カンマで区切って出す:</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ prefecture -f <span class="s2">"%s,"</span>
北海道,
青森県,
<span class="o">(</span>略<span class="o">)</span>
鹿児島県,
沖縄県,
</pre></div></div>

<p>カンマで区切って、1行で出す:</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ prefecture -f <span class="s2">"%s,"</span> --no-line-break
北海道,青森県,...,鹿児島県,沖縄県,
</pre></div></div>

<p>クォーテーションで囲って、カンマをつけて出す:</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ prefecture -f <span class="s2">"'%s',"</span>
<span class="s1">'北海道'</span>,
<span class="s1">'青森県'</span>,
<span class="o">(</span>略<span class="o">)</span>
<span class="s1">'鹿児島県'</span>,
<span class="s1">'沖縄県'</span>,
</pre></div></div>

<p>などなど</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />90位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/a6f4a6998cfadef04a4b">Kobito.appで書いた記事をまるごとMarkdownファイルに書き出すPHP</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-04-13 18:34:28</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[Kobito]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Kobito.appのストレージはSQLiteなので、PDOを使うと読み込みができます。<br>
下のPHPを実行したディレクトリに、YYYYMMDD_記事名.md というファイル名でエクスポートされます。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">KobitoExport.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$dbPath</span> <span class="o">=</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">'HOME'</span><span class="p">]</span><span class="o">.</span><span class="s1">'/Library/Kobito/Kobito.db'</span><span class="p">;</span>

<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'sqlite:'</span><span class="o">.</span><span class="nv">$dbPath</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_DEFAULT_FETCH_MODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="nv">$rows</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"SELECT * FROM ZITEM"</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$rows</span> <span class="k">as</span> <span class="nv">$row</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$created</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">'now'</span><span class="p">,</span> <span class="k">new</span> <span class="nx">DateTimeZone</span><span class="p">(</span><span class="s1">'GMT'</span><span class="p">));</span>
    <span class="nv">$created</span><span class="o">-&gt;</span><span class="na">setTimestamp</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'ZCREATED_AT'</span><span class="p">]);</span>
    <span class="nv">$created</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">DateInterval</span><span class="p">(</span><span class="s1">'P31Y'</span><span class="p">));</span> <span class="c1">// Objective-Cのタイムスタンプは2001-01-01 GMT始まり</span>
    <span class="nv">$created</span><span class="o">-&gt;</span><span class="na">setTimezone</span><span class="p">(</span><span class="k">new</span> <span class="nx">DateTimeZone</span><span class="p">(</span><span class="s1">'Asia/Tokyo'</span><span class="p">));</span>

    <span class="nv">$prefix</span>   <span class="o">=</span> <span class="nv">$created</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'Ymd'</span><span class="p">)</span><span class="o">.</span><span class="s1">'_'</span><span class="p">;</span>
    <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$prefix</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'ZTITLE'</span><span class="p">]</span><span class="o">.</span><span class="s1">'.md'</span><span class="p">;</span>
    <span class="nv">$filename</span> <span class="o">=</span> <span class="nx">convertFileName</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nb">file_exists</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">===</span> <span class="k">true</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">'File already exists: %s'</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'ZRAW_BODY'</span><span class="p">]);</span>

    <span class="k">echo</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">convertFileName</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"￥"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="s2">"／"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">":"</span><span class="p">,</span> <span class="s2">"："</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"*"</span><span class="p">,</span> <span class="s2">"＊"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"?"</span><span class="p">,</span> <span class="s2">"？"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"”"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"&lt;"</span><span class="p">,</span> <span class="s2">"＜"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"＞"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"|"</span><span class="p">,</span> <span class="s2">"｜"</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />91位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/0090ab167bbdb3d77181">バイト数をキロバイト・メガバイト・ギガバイトなどの書式に変換する関数</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-01-20 10:57:53</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * バイト数をフォーマットする</span>
<span class="sd"> * @param integer $bytes</span>
<span class="sd"> * @param integer $precision</span>
<span class="sd"> * @param array $units</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">formatBytes</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span> <span class="nv">$precision</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$units</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1024</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$precision</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nb">is_array</span><span class="p">(</span><span class="nv">$units</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$units</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'B'</span><span class="p">,</span> <span class="s1">'KB'</span><span class="p">,</span> <span class="s1">'MB'</span><span class="p">,</span> <span class="s1">'GB'</span><span class="p">,</span> <span class="s1">'TB'</span><span class="p">,</span> <span class="s1">'PB'</span><span class="p">,</span> <span class="s1">'EB'</span><span class="p">,</span> <span class="s1">'ZB'</span><span class="p">,</span> <span class="s1">'YB'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$bytes</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$sign</span> <span class="o">=</span> <span class="s1">'-'</span><span class="p">;</span>
        <span class="nv">$bytes</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="nv">$sign</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$exp</span>   <span class="o">=</span> <span class="nb">floor</span><span class="p">(</span><span class="nb">log</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">)</span> <span class="o">/</span> <span class="nb">log</span><span class="p">(</span><span class="mi">1024</span><span class="p">));</span>
    <span class="nv">$unit</span>  <span class="o">=</span> <span class="nv">$units</span><span class="p">[</span><span class="nv">$exp</span><span class="p">];</span>
    <span class="nv">$bytes</span> <span class="o">=</span> <span class="nv">$bytes</span> <span class="o">/</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="nb">floor</span><span class="p">(</span><span class="nv">$exp</span><span class="p">));</span>
    <span class="nv">$bytes</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'%.'</span><span class="o">.</span><span class="nv">$precision</span><span class="o">.</span><span class="s1">'f'</span><span class="p">,</span> <span class="nv">$bytes</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$sign</span><span class="o">.</span><span class="nv">$bytes</span><span class="o">.</span><span class="s1">' '</span><span class="o">.</span><span class="nv">$unit</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>使い方</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nx">formatBytes</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// 1 B</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nx">formatBytes</span><span class="p">(</span><span class="mi">1024</span><span class="p">));</span> <span class="c1">// 1 KB</span>

<span class="c1">// 少数を出す</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nx">formatBytes</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span> <span class="c1">// 1.00 KB</span>

<span class="c1">// 単位の文言をカスタマイズ</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nx">formatBytes</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'バイト'</span><span class="p">,</span> <span class="s1">'キロバイト'</span><span class="p">,</span> <span class="s1">'メガバイト'</span><span class="p">)));</span> <span class="c1">// 1.00 キロバイト</span>
</pre></div></div>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">PHPUnit用テストコード</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">FormatBytesTest</span> <span class="k">extends</span> <span class="nx">PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider data4testFormatBytes</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFormatBytes</span><span class="p">(</span><span class="nv">$expect</span><span class="p">,</span> <span class="nv">$bytes</span><span class="p">,</span> <span class="nv">$precision</span><span class="p">,</span> <span class="nv">$units</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$actual</span> <span class="o">=</span> <span class="nx">formatBytes</span><span class="p">(</span><span class="nv">$bytes</span><span class="p">,</span> <span class="nv">$precision</span><span class="p">,</span> <span class="nv">$units</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$expect</span><span class="p">,</span> <span class="nv">$actual</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">data4testFormatBytes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'1 B'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'-1 B'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'-1 KB'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'-1.0 KB'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'1.5 KB'</span><span class="p">,</span> <span class="mi">1536</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'1.50 KB'</span><span class="p">,</span> <span class="mi">1536</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">null</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'10 バイト'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'バイト'</span><span class="p">)),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'1 ギガバイト'</span><span class="p">,</span> <span class="mi">1073741824</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'バイト'</span><span class="p">,</span> <span class="s1">'キロバイト'</span><span class="p">,</span> <span class="s1">'メガバイト'</span><span class="p">,</span> <span class="s1">'ギガバイト'</span><span class="p">)),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />92位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/9bdfc8d99947525390ac">Docker Meetup Tokyo #1 に参加してきた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-12 23:46:05</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[docker]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Docker Meetup Tokyoに行ってきた。</p>

<h1>
<span id="docker-と-infiniband-で実現するコンテナ内高速ネットワーク通信の試み" class="fragment"></span><a href="#docker-%E3%81%A8-infiniband-%E3%81%A7%E5%AE%9F%E7%8F%BE%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%86%85%E9%AB%98%E9%80%9F%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E9%80%9A%E4%BF%A1%E3%81%AE%E8%A9%A6%E3%81%BF"><i class="fa fa-link"></i></a>Docker と InfiniBand で実現するコンテナ内高速ネットワーク通信の試み</h1>

<p><a href="/syoyo" class="user-mention js-hovercard" title="syoyo" data-hovercard-target-type="user" data-hovercard-target-name="syoyo">@syoyo</a>さん</p>

<p>InfiniBand: なんかイーサネットよりすごい早く通信できる仕組みらしい。</p>

<p><a href="http://qiita.com/syoyo/items/bea48de8d7c6d8c73435" class="autolink" id="reference-637ba61cebe93a2251b3">http://qiita.com/syoyo/items/bea48de8d7c6d8c73435</a></p>

<h1>
<span id="hack-for-dockers-network" class="fragment"></span><a href="#hack-for-dockers-network"><i class="fa fa-link"></i></a>Hack for Docker's Network</h1>

<p><a href="/hansode" class="user-mention js-hovercard" title="hansode" data-hovercard-target-type="user" data-hovercard-target-name="hansode">@hansode</a>さん</p>

<h2>
<span id="コンテナ間を制御する仕組み" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E9%96%93%E3%82%92%E5%88%B6%E5%BE%A1%E3%81%99%E3%82%8B%E4%BB%95%E7%B5%84%E3%81%BF"><i class="fa fa-link"></i></a>コンテナ間を制御する仕組み</h2>

<p>Inter-Container Communication(ICC)</p>

<p>iptables ALLOW -&gt; DENY になる</p>

<h2>
<span id="特定のコンテナ間の通信のみ許可したい" class="fragment"></span><a href="#%E7%89%B9%E5%AE%9A%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E9%96%93%E3%81%AE%E9%80%9A%E4%BF%A1%E3%81%AE%E3%81%BF%E8%A8%B1%E5%8F%AF%E3%81%97%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>特定のコンテナ間の通信のみ許可したい</h2>

<p>Link Containers</p>

<p>iptablesのsprt定義を生成する部分にバグがあるらしい。</p>

<h2>
<span id="dockerに任意のipを割り当てる機能はない" class="fragment"></span><a href="#docker%E3%81%AB%E4%BB%BB%E6%84%8F%E3%81%AEip%E3%82%92%E5%89%B2%E3%82%8A%E5%BD%93%E3%81%A6%E3%82%8B%E6%A9%9F%E8%83%BD%E3%81%AF%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>Dockerに任意のIPを割り当てる機能はない</h2>

<p>→ pipeworkを使う</p>

<p>pipeworkはdockerに依存していない</p>

<h2>
<span id="dockerhostを超えてコンテナを繋ぐには" class="fragment"></span><a href="#dockerhost%E3%82%92%E8%B6%85%E3%81%88%E3%81%A6%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E7%B9%8B%E3%81%90%E3%81%AB%E3%81%AF"><i class="fa fa-link"></i></a>DockerHostを超えてコンテナを繋ぐには?</h2>

<p><a href="http://tech.riywo.com/blog/2013/12/20/fluentd-on-mesos-plus-docker-plus-marathon/" class="autolink" rel="nofollow noopener" target="_blank">http://tech.riywo.com/blog/2013/12/20/fluentd-on-mesos-plus-docker-plus-marathon/</a></p>

<p>枯れた技術がない</p>

<h1>
<span id="up-with-vagrant-and-docker" class="fragment"></span><a href="#up-with-vagrant-and-docker"><i class="fa fa-link"></i></a>"Up" with Vagrant and Docker</h1>

<p>三浦広志(github.com/miurahr)さん</p>

<p>Vagrant 1.4 から Docker provisioner 標準搭載</p>

<p>Docker環境をVagrant上のOSに簡単に構築してくれる</p>

<h1>
<span id="docker-と継続的インテグレーション" class="fragment"></span><a href="#docker-%E3%81%A8%E7%B6%99%E7%B6%9A%E7%9A%84%E3%82%A4%E3%83%B3%E3%83%86%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>Docker と継続的インテグレーション</h1>

<p><a href="/superbrothers" class="user-mention js-hovercard" title="superbrothers" data-hovercard-target-type="user" data-hovercard-target-name="superbrothers">@superbrothers</a> さん</p>

<p>DockerイメージもCIで回す!</p>

<h1>
<span id="niiクラウドチームとdocker" class="fragment"></span><a href="#nii%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E3%83%81%E3%83%BC%E3%83%A0%E3%81%A8docker"><i class="fa fa-link"></i></a>NIIクラウドチームとDocker</h1>

<p>谷沢智史さん</p>

<p>DockerをIaaSに組み込む利点</p>

<p>・Reproducibility<br>
・Protability<br>
・Supervision</p>

<p>DockerHostでtopするだけである程度ボトルネックの当たりを付けられるのは確かにいいかもと思った。</p>

<h1>
<span id="みんなの発表を聞いて感じられた課題" class="fragment"></span><a href="#%E3%81%BF%E3%82%93%E3%81%AA%E3%81%AE%E7%99%BA%E8%A1%A8%E3%82%92%E8%81%9E%E3%81%84%E3%81%A6%E6%84%9F%E3%81%98%E3%82%89%E3%82%8C%E3%81%9F%E8%AA%B2%E9%A1%8C"><i class="fa fa-link"></i></a>みんなの発表を聞いて感じられた課題</h1>

<h2>
<span id="dockerhostを超えてコンテナを繋ぐ決定打がない" class="fragment"></span><a href="#dockerhost%E3%82%92%E8%B6%85%E3%81%88%E3%81%A6%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E7%B9%8B%E3%81%90%E6%B1%BA%E5%AE%9A%E6%89%93%E3%81%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>DockerHostを超えてコンテナを繋ぐ決定打がない</h2>

<p>うちのチームでも <a href="/reoring" class="user-mention js-hovercard" title="reoring" data-hovercard-target-type="user" data-hovercard-target-name="reoring">@reoring</a> がいろいろ試していて <a href="http://qiita.com/reoring/items/75817a01f719328b99fe" id="reference-2bf0f44c86c74d627bf7">Elasticsearch - Ambassadorパターンを使った複数のDockerホストにおけるコンテナ間通信 - Qiita</a> が今のところ一番ベターとのことらしいけど、まだまだ改善の余地がありそう。</p>

<h2>
<span id="データをどこに置くか" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%81%A9%E3%81%93%E3%81%AB%E7%BD%AE%E3%81%8F%E3%81%8B"><i class="fa fa-link"></i></a>データをどこに置くか?</h2>

<ul>
<li>データをホストに置いて、VOLUMEでマウントする</li>
<li>データを持つコンテナを作って他のコンテナを繋ぐ</li>
<li>外部にデータサーバを作ってコンテナがNFSでマウントする</li>
</ul>

<p>複数方法があるけど、ここらへんはみんな試行錯誤しているという印象。</p>

<h2>
<span id="dockerhostにどこまで依存すべきか" class="fragment"></span><a href="#dockerhost%E3%81%AB%E3%81%A9%E3%81%93%E3%81%BE%E3%81%A7%E4%BE%9D%E5%AD%98%E3%81%99%E3%81%B9%E3%81%8D%E3%81%8B"><i class="fa fa-link"></i></a>DockerHostにどこまで依存すべきか?</h2>

<p>データとも関連した課題だけど、例えば、DockerHostでファイアウォールを作っちゃうと、そのファイアウォールはdisposable infrastractureじゃなくなるなど、何をDockerHostでやって何をコンテナにすべきかというプラクティスはまだ確立されてないのかなという感触。</p>

<p>いずれもDockerユーザ共通の課題のようなので、そう遠くない未来に解決されそうな気もする。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />93位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/e1b007a98e0fcabf755e">PHPUnitでinterfaceのテストを書く方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-01-09 23:30:43</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[PHPUnit]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>PHPUnitでinterfaceの単体テストを書く方法について紹介します。</p>

<h2>
<span id="1-ポイント" class="fragment"></span><a href="#1-%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>1. ポイント</h2>

<p>PHPUnitでinterfaceのテストを書く上でのポイントは次の2点です。</p>

<ul>
<li>インターフェイスについてのテストを抽象テストクラスに書く</li>
<li>実装クラスのテストはその抽象テストクラスを継承する</li>
</ul>

<h2>
<span id="2-例" class="fragment"></span><a href="#2-%E4%BE%8B"><i class="fa fa-link"></i></a>2. 例</h2>

<p>配列を文字列に変換するライブラリを例に、どのようにテストを書くか見て行きましょう。</p>

<h3>
<span id="21-どのようなライブラリか" class="fragment"></span><a href="#21-%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%8B"><i class="fa fa-link"></i></a>2.1 どのようなライブラリか？</h3>

<p>例に上げるのは、配列を文字列に変換する汎用的なライブラリです。 どのような形式に変換するかは、クラスによって異なります。あるクラスはJSON形式に、あるクラスはXML形式に変換します。<code>FormatterInterface</code> で各クラスが実装すべきインターフェイスを定義します。<code>JsonFormatter</code> クラスは <code>FormatterInterface</code> を実装して、JSON形式の文字列を返します。 <code>BuggyFormatter</code> クラスはバグがあるクラスです。JSON形式を返そうとしますが、バグのため文字列ではなく <code>false</code> を返してしまいます。なお、このライブラリのソースコードはGitHubの<a href="https://github.com/suin/unit-test-patterns/tree/master/src/Suin/UnitTestPatterns/TestingInterfaces" rel="nofollow noopener" target="_blank">suin/unit-test-patterns</a>に収録されています。</p>

<h3>
<span id="22-クラス図" class="fragment"></span><a href="#22-%E3%82%AF%E3%83%A9%E3%82%B9%E5%9B%B3"><i class="fa fa-link"></i></a>2.2 クラス図</h3>

<p><a href="https://camo.qiitausercontent.com/b1c606c18d6062bcbcbd9da1ab218f211f8a19c8/68747470733a2f2f7261772e6769746875622e636f6d2f7375696e2f756e69742d746573742d7061747465726e732f6d61737465722f7372632f5375696e2f556e6974546573745061747465726e732f54657374696e67496e74657266616365732f756d6c2e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b1c606c18d6062bcbcbd9da1ab218f211f8a19c8/68747470733a2f2f7261772e6769746875622e636f6d2f7375696e2f756e69742d746573742d7061747465726e732f6d61737465722f7372632f5375696e2f556e6974546573745061747465726e732f54657374696e67496e74657266616365732f756d6c2e706e67" alt="UML" data-canonical-src="https://raw.github.com/suin/unit-test-patterns/master/src/Suin/UnitTestPatterns/TestingInterfaces/uml.png"></a></p>

<h3>
<span id="23-コード" class="fragment"></span><a href="#23-%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>2.3 コード</h3>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">FormatterInterface</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * The interface for clients who wants to format data to string.</span>
<span class="sd"> */</span>
<span class="k">interface</span> <span class="nx">FormatterInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Format an array to string</span>
<span class="sd">     *</span>
<span class="sd">     * @param array $data</span>
<span class="sd">     * @return string A formatted string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>

<p><code>JsonFormatter</code> JSON形式の文字列を返す具象クラスです。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">JsonFormatter</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * JSON formatter</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">JsonFormatter</span> <span class="k">implements</span> <span class="nx">FormatterInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inherit}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p><code>FormatterInterface</code> は戻り値の型を <code>string</code> にすることを要求していますが、 <code>BuggyFormatter</code> には不具合があり、 <code>bool</code> を返すようになっています。この不具合は、 <code>FormatterInterface</code> のテストで検出されます。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">BuggyFormatter</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * This is a example class and has a bug</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">BuggyFormatter</span> <span class="k">implements</span> <span class="nx">FormatterInterface</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inherit}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">format</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// here is a bug</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<h3>
<span id="24-テストコード" class="fragment"></span><a href="#24-%E3%83%86%E3%82%B9%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>2.4 テストコード</h3>

<p>まず、インターフェイス用のテストケースを用意します。テストを書く内容としては、全ての具象クラスが遵守しなければならい事項に限定してテストを書きます。具象クラス固有のテストケースについては、インターフェイス用のテストケースには書かず、具象クラス用のテストケースに書きます。具象クラスとインターフェイスのシグネチャが合っていない場合は、テスト実行時にエラーになるので、シグネチャについてテストを書く必要はありません。インターフェイステストケースの、テストメソッドは <code>final</code> キーワードを付け、具象クラスが誤ってオーバーライドしないようにします。</p>

<ul>
<li>引数やコンテキスト、メソッド実行前のオブジェクトの状態</li>
<li>戻り値、例外の型、メソッド実行後のオブジェクトの状態変化のチェック</li>
<li>オブジェクトの検証、論理的におかしくなっていないかなど</li>
</ul>

<p>インターフェイス用テストケースは、抽象クラスにした上でテンプレートメソッドパターンを適用します。テンプレートメソッドは、下位クラスのテストケースが、具象クラスのオブジェクトを返すために用意します。</p>

<p>インターフェイス用テストケースは、<code>PHPUnit_Framework_TestCase</code> を継承します。具象クラス用のテストケースはインターフェイス用テストケースを継承した上で、具象クラス固有のテストケースを書きます。</p>

<p>Formatterの例では、<code>format()</code> メソッドについてテストします。具象クラスが配列を受け取れ、戻り値の文字列フォーマットはJSONかもしれないし、XMLかもしれないので、フォーマットの妥当性については検証せず、戻り値の方が string 型かだけにつてテストします。このテストを <code>testContractOfFormat()</code> メソッドにてテストコードにします。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">FormatterInterfaceTest</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces\FormatterInterface</span><span class="p">;</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">FormatterInterfaceTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Return concrete formatter object</span>
<span class="sd">     * @return FormatterInterface</span>
<span class="sd">     */</span>
    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getFormatter</span><span class="p">();</span>

    <span class="sd">/**</span>
<span class="sd">     * Tests the contract of format() method</span>
<span class="sd">     *</span>
<span class="sd">     * This is a test that executed commonly all concrete classes.</span>
<span class="sd">     */</span>
    <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">testContractOfFormat</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'dummy'</span><span class="p">,</span> <span class="s1">'values'</span><span class="p">);</span>

        <span class="nv">$formatter</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getFormatter</span><span class="p">();</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$formatter</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInternalType</span><span class="p">(</span>
            <span class="s1">'string'</span><span class="p">,</span>
            <span class="nv">$result</span><span class="p">,</span>
            <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'%s::format() MUST returns string'</span><span class="p">,</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$formatter</span><span class="p">))</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>具象クラスの <code>JsonFormatter</code> のテストは、<code>FormatterInterfaceTest</code> を継承した <code>JsonFormatterTest</code> クラスを作成します。こうすることで、<code>JsonFormatter</code> についても <code>testContractOfFormat()</code> のテストが実行されます。<code>JsonFormatter</code> 固有のテストは <code>JsonFormatterTest</code> クラスに書きます。以下の例では、 <code>testFormat()</code> でJSONの書式についてテストしています。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">JsonFormatterTest</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces\JsonFormatter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">JsonFormatterTest</span> <span class="k">extends</span> <span class="nx">FormatterInterfaceTest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inherit}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">JsonFormatter</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * This is a class owned test case.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFormat</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'foo'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">'bar'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">'baz'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">);</span>

        <span class="nv">$formatter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JsonFormatter</span><span class="p">();</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$formatter</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">'{"foo":1,"bar":2,"baz":3}'</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p><code>BuggyFormatterTest</code> は <code>FormatterInterfaceTest</code> を継承したばかり不完全な状態です。この段階でも、<code>BuggyFormatterTest</code> は親クラスのテストが実行されため、インターフェイスをちゃんと実装できているかチェックすることができます。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">BuggyFormatterTest</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces\Tests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Suin\UnitTestPatterns\TestingInterfaces\BuggyFormatter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BuggyFormatterTest</span> <span class="k">extends</span> <span class="nx">FormatterInterfaceTest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * {@inherit}</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">BuggyFormatter</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="3-おわり" class="fragment"></span><a href="#3-%E3%81%8A%E3%82%8F%E3%82%8A"><i class="fa fa-link"></i></a>3. おわり</h2>

<p>以上で解説したとおり、PHPUnitでinterfaceの単体テストを書く際には、インターフェイスについてのテストを抽象テストクラスに書き、実装クラスのテストはその抽象テストクラスを継承するようにするといいでしょう。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />94位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/0b120b56e64906161b60">LESSでループ処理を実装する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-09-24 08:08:51</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[CSS]</b> <b>[less]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>LESSでも連番でクラスを定義したいことってありますね。<br>
共通部分を関数にして、手動で連番を列挙する方法があります。</p>

<div class="code-frame" data-lang="css">
<div class="code-lang"><span class="bold">less</span></div>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">foo</span><span class="o">(</span><span class="p">@</span><span class="k">num</span><span class="o">)</span> <span class="p">{</span>
    <span class="o">(~</span><span class="s2">".foo-@{num}"</span><span class="o">)</span> <span class="p">{</span>
        <span class="err">//</span> <span class="err">style...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">foo</span><span class="o">(</span><span class="nt">1</span><span class="o">);</span>
<span class="p">.</span><span class="nc">foo</span><span class="o">(</span><span class="nt">2</span><span class="o">);</span>
<span class="p">.</span><span class="nc">foo</span><span class="o">(</span><span class="nt">3</span><span class="o">);</span>
<span class="o">//</span> <span class="o">...</span>
<span class="p">.</span><span class="nc">foo</span><span class="o">(</span><span class="nt">99</span><span class="o">);</span>
<span class="p">.</span><span class="nc">foo</span><span class="o">(</span><span class="nt">100</span><span class="o">);</span>
</pre></div>
</div>

<p>ただ、これが数十行ともなると書くのも大変ですし、LESS自体の見通しも悪くなりますね。プログラミングをやったことがある人であれば、<code>for</code> などのループで回せないかと考えると思います。</p>

<p>しかし、LESSはループ構文をサポートしていません。なので、再帰関数とLESSのガード(<code>when</code>)を使ってループっぽいことをします。このトリックはTwitter Bootstrapで使われています。</p>

<div class="code-frame" data-lang="css">
<div class="code-lang"><span class="bold">less</span></div>
<div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">iterate</span><span class="o">(</span><span class="p">@</span><span class="k">i</span><span class="o">)</span> <span class="nt">when</span> <span class="nt">not</span> <span class="o">(</span><span class="p">@</span><span class="k">i</span> <span class="o">&lt;</span> <span class="nt">10</span><span class="o">)</span> <span class="p">{</span> <span class="p">}</span> <span class="o">//</span> <span class="err">ループを抜けるために必要</span>
<span class="p">.</span><span class="nc">iterate</span><span class="o">(</span><span class="p">@</span><span class="k">i</span><span class="o">)</span> <span class="nt">when</span> <span class="o">(</span><span class="p">@</span><span class="k">i</span> <span class="o">&lt;</span> <span class="nt">10</span><span class="o">)</span> <span class="p">{</span>
    <span class="o">(~</span><span class="s2">".test@{i}"</span><span class="o">)</span> <span class="p">{</span>
        <span class="k">width</span><span class="p">:</span> <span class="o">@</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">.</span><span class="nc">iterate</span><span class="o">(</span><span class="p">@</span><span class="k">i</span> <span class="o">+</span> <span class="nt">1</span><span class="o">)</span><span class="p">;</span> <span class="o">//</span> <span class="err">次のループへ</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">iterate</span><span class="o">(</span><span class="nt">0</span><span class="o">)</span><span class="p">;</span> <span class="o">//</span> <span class="err">ループを実行</span>
</pre></div>
</div>

<p>これをコンパイルすると、次の通りループした結果のCSSが生成されます。</p>

<div class="code-frame" data-lang="css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">test0</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test1</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test2</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test3</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test4</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test5</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test6</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">6</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test7</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test8</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">test9</span> <span class="p">{</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">9</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>ちなみに、上のLESSをPHPで表現するとしたら下記のようなコードになります。PHPにはガードがありませんが、<code>if</code>分岐でガードします。再帰はLESSと同じですね。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">iterate</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// ガード</span>
        <span class="k">echo</span> <span class="s2">".test</span><span class="si">{</span><span class="nv">$i</span><span class="si">}</span><span class="s2"> { width: </span><span class="si">{</span><span class="nv">$i</span><span class="si">}</span><span class="s2"> }</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

        <span class="nx">iterate</span><span class="p">(</span><span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 再帰</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">iterate</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div></div>

<p>LESSでループを実装するとトリッキーなコードになるので、ループを多く書く必要がある場面では、SaSSなどの別のツールと組み合わせたほうがいいかもしれませんね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />95位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/6859401972c568056694">XOOPS Cubeのプリロードとデリゲートの解説</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-08-18 01:09:06</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[XOOPS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="0-はじめに" class="fragment"></span><a href="#0-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>0. はじめに</h1>

<p>本稿はXOOPS Cubeのデリゲートとプリロードについて解説するものです。デリゲートは処理の一部を別のプログラムに委譲するための仕組みです。プリロードはモジュール実行前に前処理を行えるようにするための仕組みです。デリゲートとプリロードは本来別の仕組みで、それぞれ独立して利用することができます。実際の利用では、プリロードプログラムでデリゲート機構を利用し、XOOPSやモジュールの処理や振る舞いを変更するワンファイルハックが多いでしょう。</p>

<p>解説にあたって、本稿は次のような流れで進めていきます。まず最初にデリゲートについて解説します。デリゲートについて初めて触れる方や、デリゲートの実装方法について知りたければ、「1.デリゲート」を読んで下さい。次にプリロードについて解説します。プリロードの仕組みや実装方法については「2.プリロード」をご覧になってください。最後に、ワンファイルハックについて解説します。デリゲートとプリロードを組み合わせた、より発展的で実践的な手法についての情報は「3.ワンファイルハック」が詳しいです。</p>

<h1>
<span id="1-デリゲート" class="fragment"></span><a href="#1-%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>1. デリゲート</h1>

<h2>
<span id="11-デリゲートとは" class="fragment"></span><a href="#11-%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>1.1 デリゲートとは</h2>

<p>デリゲート(delegate)とは、あるプログラムの処理の一部を他のプログラムに委譲する仕組みです。デリゲートの仕組みを言語自体が持っている言語がありますが、PHPにはその仕組がないため、XOOPS Cubeが独自にその仕組を提供しています。厳密には他の言語のデリゲートと異なり、XOOPS Cubeのデリゲートは「委譲」だけではなく、イベントの「フック」や「ファイア」の仕組みとしても利用されています。</p>

<h2>
<span id="12-xoops-cubeでのデリゲート機構の仕組み" class="fragment"></span><a href="#12-xoops-cube%E3%81%A7%E3%81%AE%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E6%A9%9F%E6%A7%8B%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF"><i class="fa fa-link"></i></a>1.2 XOOPS Cubeでのデリゲート機構の仕組み</h2>

<p>XOOPS Cubeで「デリゲート」と言うと、委譲やイベントの仕組みや概念を指す場合と、具体的なイベントのフックポイントそのものを指す場合があります。このセクションでは分かりやすさのために、仕組みのことを「デリゲート機構」、フックポイントを「デリゲート」として区別して呼びます。</p>

<p>デリゲート機構は3つの要素で構成されています: デリゲート、コールバック関数、デリゲートマネージャです。デリゲートとは、イベントのフックポイントです。XOOPS Cube Legacyでは多数のデリゲートが定義されています。デリゲートには任意の処理(コールバック関数)を追加(add)することができます。デリゲートがコール(call)された際に、登録した処理が順次実行されます。デリゲートの定義・コールは、<code>XCube_Delegate</code> で行います。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span> <span class="c1">// デリゲートの作成</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$callbackFunction</span><span class="p">);</span> <span class="c1">// 処理の登録</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">();</span> <span class="c1">// デリゲートをコールし、登録された処理を順次実行</span>
</pre></div></div>

<p>コールバック関数とは、デリゲートがコールされた際に呼び出される関数です。コールバック関数をデリゲートがコールされる前に、デリゲートに登録する必要があります。コールバック関数はデリゲートから引数を受け取る場合があります。引数があるかどうかはデリゲートごとに異なります。コールバック関数は、PHPの <code>callable</code> 型または <code>callback</code> 型であればよく、XOOPS Cubeではコールバック関数用にクラスを定義していません。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$callbackFunction</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 何かの処理</span>
<span class="p">};</span>

<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span> <span class="c1">// デリゲートの作成</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$callbackFunction</span><span class="p">);</span> <span class="c1">// コールバック関数の登録</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">();</span> <span class="c1">// コールバック関数が実行される</span>
</pre></div></div>

<p>デリゲートマネージャは、デリゲートとコールバック関数を仲介する役割があります。デリゲートは自分自身をデリゲートマネージャに登録(register)します。登録する際にデリゲートは自分自身のデリゲート名をデリゲートマネージャに渡します。コールバック関数は、デリゲート名を指定して自分自身の追加(add)をデリゲートマネージャに要求します。デリゲートマネージャは追加されたコールバック関数をデリゲートに渡します。</p>

<div class="code-frame" data-lang="txt"><div class="highlight"><pre><span></span>      +--------------------+            +-------------------+
      |   DelegateManager  | &lt;--------- | Callback Function |
      +--------------------+   (2)add   +-------------------+
              ^      |
 (1)register  |      | (3)pass callback function
              |      v
      +--------------------+
      |       Delegate     |
      +--------------------+
</pre></div></div>

<p>デリゲートマネージャは <code>XCube_DelegateManager</code> オブジェクトが担います。このオブジェクトはXOOPS Cubeが起動したときに生成されます。デリゲートマネージャはデリゲートに名前を与えます。名前さえわかっていれば<code>XCube_DelegateManager</code> オブジェクトを仲介すればどこからでもデリゲートにアクセスすることができるわけです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;?php

$delegate = new XCube_Delegate(); // デリゲートの作成
$delegate-&gt;register('MyDelegate.Foo.Bar'); // デリゲートマネージャにデリゲート名を登録

$callbackFunction = function() {
    // 何かの処理
};

$root = XCube_Root::getSingleton();
// 'MyDelegate.Foo.Bar'デリゲートへのコールバック関数追加要求
$root-&gt;mDelegateManager-&gt;add('MyDelegate.Foo.Bar', $callbackFunction); 

$delegate-&gt;call(); // コールバック関数が実行される
</pre></div></div>

<h2>
<span id="13-無名デリゲートと登録済みデリゲート" class="fragment"></span><a href="#13-%E7%84%A1%E5%90%8D%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%A8%E7%99%BB%E9%8C%B2%E6%B8%88%E3%81%BF%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>1.3 無名デリゲートと登録済みデリゲート</h2>

<p>デリゲートには、無名デリゲートと登録済みデリゲートの2種類があります。ここでは、この2つのデリゲートについて解説します。</p>

<h3>
<span id="131-無名デリゲート" class="fragment"></span><a href="#131-%E7%84%A1%E5%90%8D%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>1.3.1 無名デリゲート</h3>

<p>無名デリゲート(unregistered delegate)とは、デリゲートマネージャに登録していないデリゲートのことです。無名デリゲートの特徴は、デリゲートのインスタンスを参照できなければ、デリゲートにコールバック関数を登録できない点です。デリゲートマネージャにデリゲートを登録してしまうと、XOOPSのどこからでもコールバック関数が追加できるようになりますが、スコープが開きすぎてしまうため意図しないコールバックが追加されてしまう危険性があります。無名デリゲートを使うことで、スコープを制限しつつ、安全にデリゲートをコールすることができます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">MyScope</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$secretDelegate</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 無名デリゲートの定義。</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secretDelegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secretDelegate</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="nx">MyScope</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">prepare</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ここではデリゲートにタッチできる</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secretDelegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">'callme'</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">callme</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 何らかの処理</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">();</span>

<span class="c1">// このスコープでは$secretDelegateにタッチできない</span>

<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div></div>

<h3>
<span id="132-登録済みデリゲート" class="fragment"></span><a href="#132-%E7%99%BB%E9%8C%B2%E6%B8%88%E3%81%BF%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88"><i class="fa fa-link"></i></a>1.3.2 登録済みデリゲート</h3>

<p>登録済みデリゲート(registered delegate)とは、デリゲートマネージャに登録されたデリゲートのことを言います。デリゲートマネージャに登録する際に、デリゲートの識別子（デリゲート名）をセットするので、デリゲートマネージャを介せばスコープに制限なくデリゲートにコールバック関数を登録することができます。いわば、グローバル空間に存在するデリゲートということになります。クラスやモジュールを超えて委譲したい処理は登録済みデリゲートにするといいでしょう。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">MyScope</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$publicDelegate</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">publicDelegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">publicDelegate</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">'MyDelegate.Foo.Bar'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">prepare</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">publicDelegate</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">();</span>

<span class="c1">// このスコープでは$publicDelegateにタッチできる</span>
<span class="nv">$root</span> <span class="o">=</span> <span class="nx">XCube_Root</span><span class="o">::</span><span class="na">getSingleton</span><span class="p">();</span>
<span class="nv">$root</span><span class="o">-&gt;</span><span class="na">mDelegateManager</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'MyDelegate.Foo.Bar'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 何らかの処理</span>
<span class="p">});</span>

<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div></div>

<p>デリゲート名は決まった命名規則があるわけではありません。しかし、デリゲート名はグローバル空間に登録されるため、デリゲート名の資源は有限です。他のデリゲート名と重複しない名前を付ける必要があります。筆者としては、<code>{モジュール名}.{クラス名}.{メソッド名}</code> の書式をおすすめします。例えば、site_mapモジュールの <code>SiteMap_ViewAction</code> クラスの <code>executeViewSuccess</code> メソッドに登録済みデリゲートを定義する場合は、<code>SiteMap.ViewAction.executeViewSucess</code> という名前にします。</p>

<p>XOOPS Cube Legacyのデリゲートには多くの登録済みデリゲートがあります。しかしながら、公式にはデリゲート名の目録が文書化されていません。非公式のドキュメント中では <a href="https://github.com/suin/xoopscube-cheatsheet" rel="nofollow noopener" target="_blank">XoopsCubeLegacy2.xDelegateCheatSheet</a> が多くのデリゲート名を収録しています。デリゲートはXCLのアップデートで追加・削除・名前変更される可能性がありますので、実際のデリゲートについてはソースコードを参照する他ありません。</p>

<h2>
<span id="14-デリゲートの遅延登録" class="fragment"></span><a href="#14-%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AE%E9%81%85%E5%BB%B6%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>1.4 デリゲートの遅延登録</h2>

<p>登録済みデリゲートへのコールバック関数追加は、デリゲート名をデリゲートマネージャに登録して後、デリゲート名を指定してコールバック関数を追加するというのが基本的な順序です。この順序を逆に行うことを、デリゲートの遅延登録(lazy registering)と言います。</p>

<p>デリゲートマネージャは、未登録のデリゲート名についてもコールバック関数を受け付けることができます。未登録のデリゲート名に対してコールバック関数追加要求があると、デリゲートマネージャはコールバック関数を保持しておき、デリゲート名が登録された際に保持していたコールバック関数をデリゲートに渡すような振る舞いをします。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$root</span> <span class="o">=</span> <span class="nx">XCube_Root</span><span class="o">::</span><span class="na">getSingleton</span><span class="p">();</span>

<span class="c1">// 未登録のデリゲート名にコールバック関数を追加</span>
<span class="nv">$root</span><span class="o">-&gt;</span><span class="na">mDelegateManager</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'MyDelegate'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 何らかの処理</span>
<span class="p">});</span>

<span class="nv">$myDelegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>
<span class="nv">$myDelegate</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">'MyDelegate'</span><span class="p">);</span> <span class="c1">// 遅延登録</span>
<span class="nv">$myDelegate</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">();</span> <span class="c1">// 追加されたコールバック関数が実行される</span>
</pre></div></div>

<h2>
<span id="15-コールバック関数の追加" class="fragment"></span><a href="#15-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E9%96%A2%E6%95%B0%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fa fa-link"></i></a>1.5 コールバック関数の追加</h2>

<h3>
<span id="151-コールバック関数として有効な型" class="fragment"></span><a href="#151-%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E9%96%A2%E6%95%B0%E3%81%A8%E3%81%97%E3%81%A6%E6%9C%89%E5%8A%B9%E3%81%AA%E5%9E%8B"><i class="fa fa-link"></i></a>1.5.1 コールバック関数として有効な型</h3>

<p>コールバック関数はPHPの <code>callable</code> 型または <code>callback</code> 型である必要があります。主に次の形式で渡します。</p>

<ul>
<li>関数名の文字列</li>
<li>オブジェクト・メソッド名からなる配列</li>
<li>クラス名・静的メソッド名からなる配列</li>
<li>クラス名・静的メソッド名からなる文字列</li>
<li>無名関数やクロージャー</li>
<li>
<code>__invoke()</code> を実装したオブジェクト</li>
</ul>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'my_func'</span><span class="p">);</span> <span class="c1">// 関数名の文字列 </span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$object</span><span class="p">,</span> <span class="s1">'doSomething'</span><span class="p">));</span> <span class="c1">// オブジェクト・メソッド名からなる配列</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'MyClass'</span><span class="p">,</span> <span class="s1">'staticMethod'</span><span class="p">));</span> <span class="c1">// クラス名・静的メソッド名からなる配列</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'MyClass::staticMethod'</span><span class="p">);</span> <span class="c1">// クラス名・静的メソッド名からなる文字列</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">function</span><span class="p">(){</span> <span class="cm">/* do something */</span> <span class="p">});</span> <span class="c1">// 無名関数やクロージャー</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span> <span class="c1">// __invoke() を実装したオブジェクト</span>
</pre></div></div>

<h3>
<span id="152-基本的な追加方法" class="fragment"></span><a href="#152-%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E8%BF%BD%E5%8A%A0%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>1.5.2 基本的な追加方法</h3>

<p>コールバック関数をデリゲートに追加するには、 <code>XCube_Delegate</code> オブジェクトまたは <code>XCube_DelegateManager</code> オブジェクトの <code>add()</code> メソッドにコールバック関数を渡します。デリゲートマネージャは第1引数がデリゲート名になり、第2引数以降は、デリゲートの <code>add()</code> メソッドと用法は同じです。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// 無名デリゲート</span>
<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">function</span><span class="p">(){</span>
    <span class="c1">// code...</span>
<span class="p">});</span>

<span class="c1">// 登録済みデリゲート</span>
<span class="nv">$delegateManager</span> <span class="o">=</span> <span class="nx">XCube_Root</span><span class="o">::</span><span class="na">getSingleton</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">mDelegateManager</span><span class="p">;</span>
<span class="nv">$delegateManager</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'FooBarDelegate'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// code ...</span>
<span class="p">});</span>
</pre></div></div>

<p>ひとつのデリゲートに対して複数のコールバック関数を追加することができます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$callbackFunction1</span><span class="p">);</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$callbackFunction2</span><span class="p">);</span>
</pre></div></div>

<h3>
<span id="153-実行順序と優先度" class="fragment"></span><a href="#153-%E5%AE%9F%E8%A1%8C%E9%A0%86%E5%BA%8F%E3%81%A8%E5%84%AA%E5%85%88%E5%BA%A6"><i class="fa fa-link"></i></a>1.5.3 実行順序と優先度</h3>

<p>コールバック関数は登録された順序で実行されますが、優先度を2番目の引数にセットすることで、他の関数よりも早く/遅く実行されるようにすることができます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$callbackFunction1</span><span class="p">);</span>

<span class="c1">// これは $callbackFunction1 よりも先に実行されます</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$callbackFunction2</span><span class="p">,</span> <span class="nx">XCUBE_DELEGATE_PRIORITY_FIRST</span><span class="p">);</span>
</pre></div></div>

<p>優先度指定は <code>XCUBE_DELEGATE_PRIORITY_1</code> から <code>XCUBE_DELEGATE_PRIORITY_10</code> の間で設定することができます。<code>XCUBE_DELEGATE_PRIORITY_FIRST</code> は <code>XCUBE_DELEGATE_PRIORITY_1</code> のエイリアスで最も優先されます。<code>XCUBE_DELEGATE_PRIORITY_FINAL</code> は <code>XCUBE_DELEGATE_PRIORITY_10</code> のエイリアスで最も遅く実行されます。同じ優先度を指定した関数が複数ある場合は登録された順番で順位が決まります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>XCUBE_DELEGATE_PRIORITY_1 XCUBE_DELEGATE_PRIORITY_FIRST
XCUBE_DELEGATE_PRIORITY_2
XCUBE_DELEGATE_PRIORITY_3
XCUBE_DELEGATE_PRIORITY_4
XCUBE_DELEGATE_PRIORITY_5 XCUBE_DELEGATE_PRIORITY_NORMAL
XCUBE_DELEGATE_PRIORITY_6
XCUBE_DELEGATE_PRIORITY_7
XCUBE_DELEGATE_PRIORITY_8
XCUBE_DELEGATE_PRIORITY_9
XCUBE_DELEGATE_PRIORITY_10 XCUBE_DELEGATE_PRIORITY_FINAL
</pre></div></div>

<h3>
<span id="154-実行時のファイル読み込み" class="fragment"></span><a href="#154-%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>1.5.4 実行時のファイル読み込み</h3>

<p><code>add()</code>メソッドの最後の引数にファイル名を渡すと、デリゲートがコールされる前にそのファイルを読みこませることができます。この仕組は、デリゲート関数が別ファイルにある場合に有効な手段です。デリゲートがコールされなければ、デリゲート関数が定義されているファイルも読み込まれないので、余分なI/Oがなく実行時のリソースを節約することができます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$classFile</span> <span class="o">=</span> <span class="nx">XOOPS_MODULE_PATH</span><span class="o">.</span><span class="s1">'/mymodule/class/MyClass.class.php'</span><span class="p">;</span>

<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'MyClass::callme()'</span><span class="p">,</span> <span class="nv">$classFile</span><span class="p">);</span>

<span class="c1">// 優先度指定と併用する場合</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'MyClass::callme()'</span><span class="p">,</span> <span class="nx">XCUBE_DELEGATE_PRIORITY_FINAL</span><span class="p">,</span> <span class="nv">$classFile</span><span class="p">);</span>
</pre></div></div>

<h3>
<span id="155-デリゲートからコールバックに変数を渡す" class="fragment"></span><a href="#155-%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%81%8B%E3%82%89%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%AB%E5%A4%89%E6%95%B0%E3%82%92%E6%B8%A1%E3%81%99"><i class="fa fa-link"></i></a>1.5.5 デリゲートからコールバックに変数を渡す</h3>

<p>デリゲートからコールバック関数に変数を渡すことができます。 <code>call()</code> メソッドの引数に与えられた変数は、その順序でコールバック関数に渡ります。引数の数に制限はありません。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>

<span class="c1">// コールバック関数</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$xoopsUser</span><span class="p">,</span> <span class="nv">$moduleConfig</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $xoopsUserや$moduleConfigが利用可能</span>
<span class="p">});</span>

<span class="c1">// コールバック関数に変数を渡す</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="nv">$xoopsUser</span><span class="p">,</span> <span class="nv">$moduleConfig</span><span class="p">);</span>
</pre></div></div>

<p>プリミティブ型を参照渡しする場合は、<code>XCube_Ref</code> オブジェクトを使います。オブジェクト型はPHP5からデフォルトで参照渡しになるので、 <code>XCube_Ref</code> を使う必要がなくなりました。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>

<span class="c1">// コールバック関数</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$int</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// コールバック関数は参照を受け取るために、&amp;を使う</span>
<span class="p">});</span>

<span class="c1">// 参照渡し</span>
<span class="nv">$int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">'string'</span><span class="p">;</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="k">new</span> <span class="nx">XCube_Ref</span><span class="p">(</span><span class="nv">$int</span><span class="p">),</span> <span class="k">new</span> <span class="nx">XCube_Ref</span><span class="p">(</span><span class="nv">$string</span><span class="p">));</span>
</pre></div></div>

<h2>
<span id="16-デリゲートユーティリティ" class="fragment"></span><a href="#16-%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3"><i class="fa fa-link"></i></a>1.6 デリゲートユーティリティ</h2>

<p>XOOPS Cubeでは登録済みデリゲートのコールを手軽に行うためのユーティリティクラスを提供しています。登録済みデリゲートをコールするには通常、<code>XCube_Delegate</code> のインスタンスを作り、<code>register</code> したあと <code>call</code> します。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$delegate</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XCube_Delegate</span><span class="p">();</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="s1">'MyDelegate.Foo.Bar'</span><span class="p">);</span>
<span class="nv">$delegate</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">();</span>
</pre></div></div>

<p><code>XCube_DelegateUtils</code> は上記の手続きを1行で行うためのメソッド <code>call()</code> を提供します。第1引数に、デリゲート名を指定します。第2引数以降は、コールバック関数に渡されます。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nx">XCube_DelegateUtils</span><span class="o">::</span><span class="na">call</span><span class="p">(</span><span class="s1">'MyDelegate.Foo.Bar'</span><span class="p">);</span>

<span class="c1">// 変数をコールバック関数に渡す</span>
<span class="nx">XCube_DelegateUtils</span><span class="o">::</span><span class="na">call</span><span class="p">(</span><span class="s1">'MyDelegate.Foo.Bar'</span><span class="p">,</span> <span class="nv">$xoopsUser</span><span class="p">,</span> <span class="nv">$moduleConfig</span><span class="p">);</span>
</pre></div></div>

<h2>
<span id="17-デリゲートコールのトレース" class="fragment"></span><a href="#17-%E3%83%87%E3%83%AA%E3%82%B2%E3%83%BC%E3%83%88%E3%82%B3%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>1.7 デリゲートコールのトレース</h2>

<p>デリゲート機構は処理を実行する場所（デリゲート）と実際に処理がある場所（コールバック関数）が分離して存在しているため、しばしばコードが追いにくいことや、どのような処理が実行されているか把握しにくいことがあります。デリゲートがどのような順番で実行されているかなどを知りたいと考えるでしょう。その場合は、<code>XCube_Delegate::call()</code> にブレークポイントをしこむと、すべてのデリゲートを追跡することができます。ブレークポイントをしこむには、<code>Xdebug</code>が必要になります。<code>Xdebug</code>導入が難しいときは、<code>var_dump()</code>でデリゲートコールをダンプするだけでも十分実用的です。</p>

<h1>
<span id="2-プリロード" class="fragment"></span><a href="#2-%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>2. プリロード</h1>

<h2>
<span id="21-プリロードとは" class="fragment"></span><a href="#21-%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>2.1 プリロードとは</h2>

<p>プリロード(preload)とは、モジュール実行前に事前処理を行う仕組みのことです。その処理を書いたプログラムをプリロードと呼ぶこともあります。本書で「プリロード機構」と書いてあるものは仕組みのことを、「プリロード」と書いたものはプリロードプログラムのことを指します。</p>

<p>プリロード機構は、モジュール実行前に設定や下準備をするためのものです。「デリゲート機構」とは独立した仕組みです。しかし、実際のところ多くのプリロードは、「ワンファイルハック」を行うためにデリゲート機構を活用しています。このセクションでは専らプリロードについて扱い、デリゲートについては扱いません。デリゲートについて知りたければ「デリゲート」のセクションを、プリロードでデリゲートを利用する方法については「ワンファイルハック」のセクションを参照してください。</p>

<h2>
<span id="22-サイトプリロードとモジュールプリロード" class="fragment"></span><a href="#22-%E3%82%B5%E3%82%A4%E3%83%88%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89%E3%81%A8%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>2.2 サイトプリロードとモジュールプリロード</h2>

<p>プリロードには2種類あります。サイトプリロードとモジュールプリロードです。サイトプリロードはサイトで所有するプリロードです。プリロード単体で配布されているものは、大抵サイトプリロードになります。</p>

<p>モジュールプリロードは、各モジュールが所有するプリロードです。モジュール作者がモジュールに同梱して配布します。モジュールプリロードは、アクティブなモジュールのプリロードに限り読み込まれます。</p>

<h2>
<span id="23-プリロードの置き場とファイル命名規則" class="fragment"></span><a href="#23-%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89%E3%81%AE%E7%BD%AE%E3%81%8D%E5%A0%B4%E3%81%A8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%91%BD%E5%90%8D%E8%A6%8F%E5%89%87"><i class="fa fa-link"></i></a>2.3 プリロードの置き場とファイル命名規則</h2>

<p>サイトプリロードは、 <code>/html/preload</code> に置きます。また、管理画面でのみ読み込むサイトプリロードは <code>/html/preload/admin</code> に置きます。モジュールプリロードは、各モジュールの <code>preload</code> フォルダに置きます。</p>

<p>プリロードファイルの名前は、<code>{任意の名前}.class.php</code> にします。このパターンにマッチしないファイルは <code>preload</code> フォルダに置いても読み込まれません。</p>

<h2>
<span id="24-2つの読み込みタイミング" class="fragment"></span><a href="#24-2%E3%81%A4%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>2.4 2つの読み込みタイミング</h2>

<p>サイトプリロードとモジュールプリロードは読み込まれるタイミングが異なります。サイトプリロードはXOOPSが起動した直後に読み込まれます。一方のモジュールプリロードは、ある程度コントローラの処理が進んだ時点で読み込まれます。コントローラとプリロードの読み込み順序関係は次のようになります。</p>

<ol>
<li>★ サイトプリロードの読み込み</li>
<li>環境設定ファイルの読み込み</li>
<li>ロガーの初期化</li>
<li>データベースへの接続</li>
<li>多言語対応の初期化</li>
<li>テキストフィルタの初期化</li>
<li>一般設定の初期化</li>
<li>★ モジュールプリロードの読み込み</li>
<li>セッションの初期化</li>
<li>ユーザの初期化</li>
<li>モジュールの初期化</li>
</ol>

<p>このリストから分かるように、ロガーやデータベースの初期化に影響を与えられるのはサイトプリロードのみに限られます。</p>

<h3>
<span id="241-モジュールプリロードのロード条件" class="fragment"></span><a href="#241-%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%89%E6%9D%A1%E4%BB%B6"><i class="fa fa-link"></i></a>2.4.1 モジュールプリロードのロード条件</h3>

<p>モジュールプリロードの読み込みは、アクティブな全モジュールに対して行われます。よくある誤解として、アクセス中のモジュールのプリロードのみが読み込まれると思われがちですが、この認識は誤りです。あるモジュールのプリロードで、別のモジュールの動作を変えることが可能です。</p>

<h3>
<span id="242-サイトプリロードの読み込み順" class="fragment"></span><a href="#242-%E3%82%B5%E3%82%A4%E3%83%88%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E9%A0%86"><i class="fa fa-link"></i></a>2.4.2 サイトプリロードの読み込み順</h3>

<p>プリロードが読み込まれる順番は、ファイル名のアルファベット順になります。他のプリロードよりいち早く(あるいは最も遅く)読み込ませたい場合は、ファイル名を工夫します。Aで始まるプリロードは最初に、Zで始まるプリロードは最も遅く読み込まれるでしょう。</p>

<h3>
<span id="243-モジュールプリロードの読み込み順" class="fragment"></span><a href="#243-%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E9%A0%86"><i class="fa fa-link"></i></a>2.4.3 モジュールプリロードの読み込み順</h3>

<p>モジュールプリロードの読み込まれる順番は、モジュールの「並び順」の昇順になります。「並び順」は管理画面のモジュール管理で設定される数値です。「並び順」が同値のモジュールが複数ある場合は、モジュールID(mid)の小さいものが先にロードされます。次に、ひとつのモジュールに複数のプリロードがある場合は、サイトプリロードと同様にファイル名の昇順で読み込まれます。</p>

<h2>
<span id="25-3つの実行タイミング" class="fragment"></span><a href="#25-3%E3%81%A4%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>2.5 3つの実行タイミング</h2>

<p>プリロードが実行されるタイミングは3つあります。1つ目は <code>preFilter</code> です。このタイミングはXOOPSが起動した直後です。サイトプリロードの読み込み後に実行されます。ですので、モジュールプリロードは <code>preFilter</code> を利用できません。<code>preFilter</code> ではデータベースや多言語対応、ロガーなどがセットアップされていませんので、これらを参照することができません。</p>

<p>2つ目は <code>preBlockFilter</code> です。モジュールプリロードが読み込まれた後に実行されます。この時点では、データベースの接続が確立していますので、データベースを参照することができます。ユーザの初期化は完了していませんので、ユーザ情報を参照することはできません。</p>

<p>3つ目は <code>postFilter</code> です。モジュールが実行される直前に実行されます。この時点では、ほぼすべての初期化が完了していますので、利用できるオブジェクトは3つのフィルタの中で最も多いです。モジュールの初期化も完了しているので、モジュールの情報を利用することもできます。</p>

<p>以上の3つのタイミングをコントローラの処理順序とあわせてみると次のリストのようになります。</p>

<ol>
<li>サイトプリロードの読み込み</li>
<li>★ <code>preFilter</code> の実行</li>
<li>環境設定ファイルの読み込み</li>
<li>ロガーの初期化</li>
<li>データベースへの接続</li>
<li>多言語対応の初期化</li>
<li>テキストフィルタの初期化</li>
<li>一般設定の初期化</li>
<li>モジュールプリロードの読み込み</li>
<li>★ <code>preBlockFilter</code> の実行</li>
<li>セッションの初期化</li>
<li>ユーザの初期化</li>
<li>モジュールの初期化</li>
<li>★ <code>postFilter</code> の実行</li>
</ol>

<p>ちなみに、ひとつのタイミングに複数のプリロードが実行される場合は、先に読み込まれたプリロードが先に実行されます。</p>

<h2>
<span id="26-実装方法" class="fragment"></span><a href="#26-%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>2.6 実装方法</h2>

<p>プリロードは、<code>XCube_ActionFilter</code> クラスを継承して実装します。クラス名は任意の名前をつけることができます。任意の名前はファイル名と一致する必要があります。例えば、<code>FooBar</code> という名前のプリロードは <code>FooBar.class.php</code> にします。大文字小文字は区別します。</p>

<p>FooBar.class.phpの例</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">FooBar</span> <span class="k">extends</span> <span class="nx">XCube_ActionFilter</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div></div>

<p>モジュールプリロードは、クラス名の頭にモジュール名を付けます。例えば、<code>news</code> モジュールの <code>FooBar</code> プリロードは <code>News_FooBar</code> という具合にアンダースコアでつなげます。モジュール名の1文字目は大文字にします。<code>news_letter</code> のようにアンダースコアを含む場合は、<code>News_letter_FooBar</code> になります。ファイル名には、モジュール名を含めないので注意してください。</p>

<p>/html/modules/news/preload/FooBar.class.phpの例</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">News_FooBar</span> <span class="k">extends</span> <span class="nx">XCube_ActionFilter</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div></div>

<p>/html/modules/news_letter/preload/FooBar.class.phpの例</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">News_letter_FooBar</span> <span class="k">extends</span> <span class="nx">XCube_ActionFilter</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div></div>

<p>プリロードのクラスでは、<code>preFilter()</code>, <code>preBlockFilter()</code>, <code>postFilter()</code> メソッドを1つ以上実装します。これらのメソッドは、実行されるタイミングがことなります。<code>preFilter()</code> はXOOPS起動直後に、<code>preBlockFilter()</code> はデータベース接続後に、 <code>postFilter()</code> はモジュール実行直前に実行されます。実行タイミングの詳細は、「3つの実行タイミング」を御覧ください。</p>

<p>メソッドを実装した FooBar.class.php の例</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">FooBar</span> <span class="k">extends</span> <span class="nx">XCube_ActionFilter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preFilter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="s2">"preFilterが呼ばれました"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">preBlockFilter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="s2">"preBlockFilterが呼ばれました"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">postFilter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="s2">"postFilterが呼ばれました"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="27-プライマリプリロード" class="fragment"></span><a href="#27-%E3%83%97%E3%83%A9%E3%82%A4%E3%83%9E%E3%83%AA%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>2.7 プライマリプリロード</h2>

<p>モジュールプリロードは <code>preBlockFilter</code> のタイミングの直前で読み込まれるため、 原則として <code>preFilter</code> のポイントを使うことができません。しかし、プライマリプリロード(primary preloads)にモジュールプリロードを指定することで、 <code>preFilter</code> を使えるようになります。プライマリプリロードとは、どのプリロードよりも優先してロードされるプリロードです。</p>

<p>プライマリプリロードは設定ファイル <code>site_custom.ini</code> の <code>Legacy.PrimaryPreloads</code> の項目に明示的に記述します。XOOPS Cube Legacy 2.1であれば、<code>/html/settings/site_custom.ini</code> を作ります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ touch html/settings/site_custom.ini
</pre></div></div>

<p>XOOPS Cube Legacy 2.2では、<code>settings</code> フォルダが <code>xoops_trust_path</code> に移動されました。<code>xoops_trust_path</code> は複数のサイトで共有される可能性があります。すべてのサイトで共通して使う設定は <code>/xoops_trust_path/settings/site_custom.ini</code> に記述します。特定のサイトでのみ使う設定は <code>/xoops_trust_path/settings/site_custom_{XOOPS_SALT}.ini</code> を作成します。 <code>XOOPS_SALT</code> は各サイトごとに異なります。各サイトの <code>mainfile.php</code> の <code>XOOPS_SALT</code> の定義とあわせます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ touch xoops_trust_path/settings/site_custom.ini # 共有
$ touch xoops_trust_path/settings/site_custom_a73dfbe9.ini # サイト固有
</pre></div></div>

<p><code>site_custom.ini</code> には <code>site_default.ini</code> の差分だけ記述します。つまり、<code>site_custom.ini</code> をまるごとコピーする必要はありません。<code>Legacy.PrimaryPreloads</code> の項目を設定する場合は、 <code>site_default.ini</code> から <code>Legacy.PrimaryPreloads</code> の項目だけをコピーし <code>site_custom.ini</code> に記述します。</p>

<p><code>Legacy.PrimaryPreloads</code> の項目は <code>キー: 値</code> の書式で記述します。キーはプリロードクラス名を指定します。値には、プリロードクラスが定義されているファイル名を指定します。ファイル名に指定できるのは <code>XOOPS_ROOT_PATH</code> にあるファイルのみです。現時点では、トラストパスのファイルを指定することができませんが、今後のアップデートで改善されるかもしれません。プライマリプリロードは各モジュールの <code>preload/Primary</code> フォルダに置きます。</p>

<div class="code-frame" data-lang="ini">
<div class="code-lang"><span class="bold">/xoops_trust_path/settings/site_custom.ini</span></div>
<div class="highlight"><pre><span></span><span class="c1">;                  ;</span>
<span class="c1">; Primary Preloads ;</span>
<span class="c1">;                  ;</span>

<span class="k">[Legacy.PrimaryPreloads]</span>
<span class="na">protectorLE_Filter</span><span class="o">=</span><span class="s">/modules/legacy/preload/protectorLE/protectorLE.class.php</span>
<span class="na">Legacy_SystemModuleInstall</span><span class="o">=</span><span class="s">/modules/legacy/preload/Primary/SystemModuleInstall.class.php</span>
<span class="na">Legacy_SiteClose</span><span class="o">=</span><span class="s">/modules/legacy/preload/Primary/SiteClose.class.php</span>
<span class="na">User_PrimaryFilter</span><span class="o">=</span><span class="s">/modules/user/preload/Primary/Primary.class.php</span>
<span class="na">Legacy_NuSoapLoader</span><span class="o">=</span><span class="s">/modules/legacy/preload/Primary/NuSoapLoader.class.php</span>
<span class="na">Legacy_SessionCallback</span><span class="o">=</span><span class="s">/modules/legacy/preload/Primary/SessionCallback.class.php</span>
</pre></div>
</div>

<h2>
<span id="28-プリロードの有効化と無効化" class="fragment"></span><a href="#28-%E3%83%97%E3%83%AA%E3%83%AD%E3%83%BC%E3%83%89%E3%81%AE%E6%9C%89%E5%8A%B9%E5%8C%96%E3%81%A8%E7%84%A1%E5%8A%B9%E5%8C%96"><i class="fa fa-link"></i></a>2.8 プリロードの有効化と無効化</h2>

<p>プリロードはモジュールと異なり、管理画面からインストールする必要がありません。<code>preload</code> フォルダに配置するだけで実行されるようになります。プリロードを無効化する方法としては、<code>preload</code> フォルダから削除するでけですが、<code>preload/disabled</code> フォルダを作り、無効化したいプリロードをそこに移動する方法がベストプラクティスです。</p>

<h1>
<span id="3-ワンファイルハック" class="fragment"></span><a href="#3-%E3%83%AF%E3%83%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%8F%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>3. ワンファイルハック</h1>

<h2>
<span id="31-ワンファイルハックとは" class="fragment"></span><a href="#31-%E3%83%AF%E3%83%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%8F%E3%83%83%E3%82%AF%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>3.1 ワンファイルハックとは</h2>

<p>ワンファイルハック(one file hack)は、プリロードとデリゲート機構を組み合わせて、コアやモジュールの振る舞いを変える（ハックする）手法を言います。ここでの「ハック」という言葉は、クラッキングのような不正さを表す意味合いはありません。XOOPSでは慣習的に、XOOPS本体やモジュールの機能に手を加えることをハックと表現します。XOOPS Cube Legacy以前のXOOPSでは、デリゲート機構がありませんでしたので、やりたいことを実現するためにしばしばコアのプラグラムを変更しなければならないことがありました。XOOPS Cube Legacyではコアのプログラムを直接変更せずに、プリロードの1ファイルだけでコアの振る舞いをハックできるという点からワンファイルハックと言うようになりました。</p>

<p>現在、配布されているプリロードの多くはワンファイルハックで、例えば次のようなものがあります。アイディア次第で様々なワンファイルハックが可能になります。</p>

<ul>
<li>メールアドレスでログインできるようにする。</li>
<li>非登録ユーザがユーザプロフィールを閲覧できなくする。</li>
<li>iPhoneからアクセスが合った場合に専用のテーマに切り替える。</li>
<li>AdelieDebugのようなデバッグツール。</li>
</ul>

<h2>
<span id="32-ワンファイルハックの実装手順" class="fragment"></span><a href="#32-%E3%83%AF%E3%83%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%8F%E3%83%83%E3%82%AF%E3%81%AE%E5%AE%9F%E8%A3%85%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>3.2 ワンファイルハックの実装手順</h2>

<p>ワンファイルハックは基本的に、プリロードとデリゲート機構を応用して実装しますので、それぞれの基礎的な知識が必要となります。デリゲートについては、「1. デリゲート」のセクションを、プリロードの詳細については、「2. プリロード」を参照してください。ここでは、それぞれの詳細には触れず、「非登録ユーザがユーザプロフィールを閲覧できなくする」ワンファイルハックを例に具体的な実装手順を解説します。</p>

<p>まず、ワンファイルハックを実装するにあたって、プリロードを作ることになります。ここではファイル名は <code>UserInfoProtector.class.php</code> としておきます。ファイルの内容は <code>XCube_ActionFilter</code> クラスを継承した <code>UserInfoProtector</code> クラスを定義することが第一のステップとなります。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">UserInfoProtector.class.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserInfoProtector</span> <span class="k">extends</span> <span class="nx">XCube_ActionFilter</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>

<p>次に、プロフィールページのデリゲートを探します。「デリゲート」の章でも述べましたが、デリゲートの公式的な一覧や簡単に探す方法は現在のところありませんので、コアのコードを確認する必要があります。今回の例では <code>Legacypage.Userinfo.Access</code> デリゲートが最適です。</p>

<p>デリゲートが特定できれば、今度はデリゲートにコールバックを追加する処理を追加します。この例でのコールバック追加の処理はどのプリロード実行タイミングでもかまいませんが、ここでは <code>preFilter</code> を利用することにします。<code>XCube_ActionFilter</code> クラスは <code>XCube_Root</code> クラスのオブジェクトを <code>mRoot</code> メンバとして持っています。なので、コールバックの追加は <code>mRoot</code> をつたって <code>XCube_DelegateManager</code> を利用します。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">UserInfoProtector.class.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserInfoProtector</span> <span class="k">extends</span> <span class="nx">XCube_ActionFilter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preFilter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mRoot</span><span class="o">-&gt;</span><span class="na">mDelegateManager</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'Legacypage.Userinfo.Access'</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
            <span class="c1">// コールバック処理</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="s1">'UserInfoProtectorがコールされました'</span><span class="p">);</span> <span class="k">die</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>

<p>この状態で実際に、ユーザプロフィールの画面にアクセスしてコールバック関数が呼ばれているか確認します。</p>

<p>最後に、コールバック関数内で、ゲストユーザかどうかを判定し、ゲストユーザであればサイトトップページにリダイレクトする処理を実装します。</p>

<div class="code-frame" data-lang="php">
<div class="code-lang"><span class="bold">UserInfoProtector.class.php</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">UserInfoProtector</span> <span class="k">extends</span> <span class="nx">XCube_ActionFilter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">preFilter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mRoot</span><span class="o">-&gt;</span><span class="na">mDelegateManager</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">'Legacypage.Userinfo.Access'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nv">$root</span> <span class="o">=</span> <span class="nx">XCube_Root</span><span class="o">::</span><span class="na">getSingleton</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nv">$root</span><span class="o">-&gt;</span><span class="na">mContext</span><span class="o">-&gt;</span><span class="na">mUser</span><span class="o">-&gt;</span><span class="na">mIdentity</span><span class="o">-&gt;</span><span class="na">isAuthenticated</span><span class="p">()</span> <span class="o">===</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nv">$root</span><span class="o">-&gt;</span><span class="na">mController</span><span class="o">-&gt;</span><span class="na">executeForward</span><span class="p">(</span><span class="nx">XOOPS_URL</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<h2>
<span id="33-ワンファイルハックの問題点" class="fragment"></span><a href="#33-%E3%83%AF%E3%83%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%8F%E3%83%83%E3%82%AF%E3%81%AE%E5%95%8F%E9%A1%8C%E7%82%B9"><i class="fa fa-link"></i></a>3.3 ワンファイルハックの問題点</h2>

<p>コアやモジュールの振る舞いを変えることができるワンファイルハックは非常に強力ですが問題点もあります。プリロードはXOOPS Cubeの仕組み上、実行時にすべてのプリロードファイルを <code>require_once</code> します。しかし、読み込まれたワンファイルハックがページやモジュールによっては必ずしも実行されません。ワンファイルハックはデリゲートがコールされてはじめて実行されるためです。そのため、一部のワンファイルハックはオーバヘッドになってしまい、サイト全体のパフォーマンスに少なからず影響があります。</p>

<h1>
<span id="4-おわりに" class="fragment"></span><a href="#4-%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>4. おわりに</h1>

<p>本稿ではXOOPS Cubeのデリゲート、プリロード、そしてそれらを組み合わせたワンファイルハックについて解説しました。どれも最初はなじみにくい仕組みかもしれませんが、とても強力で便利な機能です。この機会に試してみてはいかがでしょうか。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />96位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/4d5f60dfb40c41c244e9">Selenium: テキストボックスやテキストエリアの値を取得する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-25 18:18:07</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Scala]</b> <b>[Selenium]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">value</span> <span class="k">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">findElement</span><span class="o">(</span><span class="nc">By</span><span class="o">.</span><span class="n">id</span><span class="o">(</span><span class="s">"input"</span><span class="o">)).</span><span class="n">getAttribute</span><span class="o">(</span><span class="s">"value"</span><span class="o">)</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />97位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/5025a631fe8e78c97574">Scalaでjava.util.Listをforeachする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-28 01:29:54</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Scala]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>JavaのライブラリをScalaで使っていると <code>java.lang</code> の型が返ってくることがある。</p>

<p>たとえば、<code>java.util.List</code>。</p>

<p><code>java.util.List</code> には <code>foreach</code> メソッドがない。</p>

<p>Scalaのリストだったら便利なのに!</p>

<p>そんなときは、</p>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">scala.collection.JavaConversions._</span>
</pre></div></div>

<p>インポートするといい。</p>

<p>と思ったら、これは Scala 2.8 までの作法らしい。</p>

<p>ソースコードを見たら非推奨となっていた。</p>

<p>Scala 2.9 からは</p>

<div class="code-frame" data-lang="scala"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">scala.collection.convert.WrapAsScala._</span>
</pre></div></div>

<p>とする。</p>

<p>どうしてインポートするだけでScalaのListのように振る舞えるか疑問だったが、ソースコードを読んでみたら「暗黙の型変換(implicit conversion)」を行っていた。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />98位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/29f87d5ddef78ecb69ff">パラダイム別 じゃんけんの書き方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-26 22:16:37</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[CoffeeScript]</b> <b>[Prolog]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="データ手続き型" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E6%89%8B%E7%B6%9A%E3%81%8D%E5%9E%8B"><i class="fa fa-link"></i></a>データ手続き型</h1>

<div class="code-frame" data-lang="coffeescript">
<div class="code-lang"><span class="bold">procedural.coffee</span></div>
<div class="highlight"><pre><span></span><span class="nv">beats = </span><span class="nf">(you, opponent)-&gt;</span>
    <span class="k">if</span> <span class="nx">you</span> <span class="o">is</span> <span class="s">'rock'</span>
        <span class="k">if</span> <span class="nx">opponent</span> <span class="o">is</span> <span class="s">'scissors'</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="kc">false</span> 
    <span class="k">else</span> <span class="k">if</span> <span class="nx">you</span> <span class="o">is</span> <span class="s">'paper'</span>
        <span class="k">if</span> <span class="nx">opponent</span> <span class="o">is</span> <span class="s">'rock'</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="kc">false</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">you</span> <span class="o">is</span> <span class="s">'scissors'</span>
        <span class="k">if</span> <span class="nx">opponent</span> <span class="o">is</span> <span class="s">'paper'</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="kc">false</span>
    <span class="k">else</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">"your hand is unexpected: </span><span class="si">#{</span><span class="nx">you</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="nv">you = </span><span class="s">'rock'</span>
<span class="nv">opponent = </span><span class="s">'paper'</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">beats</span><span class="p">(</span><span class="nx">you</span><span class="p">,</span> <span class="nx">opponent</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">beats</span><span class="p">(</span><span class="nx">opponent</span><span class="p">,</span> <span class="nx">you</span><span class="p">)</span>
</pre></div>
</div>

<h1>
<span id="オブジェクト指向" class="fragment"></span><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%8C%87%E5%90%91"><i class="fa fa-link"></i></a>オブジェクト指向</h1>

<div class="code-frame" data-lang="coffeescript">
<div class="code-lang"><span class="bold">oo.coffee</span></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nx">Rock</span>
    <span class="nv">beats: </span><span class="nf">(hand)-&gt;</span>
        <span class="k">return</span> <span class="nx">hand</span> <span class="k">instanceof</span> <span class="nx">Scissors</span>

<span class="k">class</span> <span class="nx">Paper</span>
    <span class="nv">beats: </span><span class="nf">(hand)-&gt;</span>
        <span class="k">return</span> <span class="nx">hand</span> <span class="k">instanceof</span> <span class="nx">Rock</span>

<span class="k">class</span> <span class="nx">Scissors</span>
    <span class="nv">beats: </span><span class="nf">(hand)-&gt;</span>
        <span class="k">return</span> <span class="nx">hand</span> <span class="k">instanceof</span> <span class="nx">Paper</span>


<span class="nv">you = </span><span class="k">new</span> <span class="nx">Rock</span>
<span class="nv">opponent = </span><span class="k">new</span> <span class="nx">Paper</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">you</span><span class="p">.</span><span class="nx">beats</span><span class="p">(</span><span class="nx">opponent</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">opponent</span><span class="p">.</span><span class="nx">beats</span><span class="p">(</span><span class="nx">you</span><span class="p">)</span>
</pre></div>
</div>

<h1>
<span id="論理型" class="fragment"></span><a href="#%E8%AB%96%E7%90%86%E5%9E%8B"><i class="fa fa-link"></i></a>論理型</h1>

<div class="code-frame" data-lang="prolog">
<div class="code-lang"><span class="bold">janken.pro</span></div>
<div class="highlight"><pre><span></span><span class="nf">beats</span><span class="p">(</span><span class="s s-Atom">rock</span><span class="p">,</span> <span class="s s-Atom">scissors</span><span class="p">).</span>
<span class="nf">beats</span><span class="p">(</span><span class="s s-Atom">paper</span><span class="p">,</span> <span class="s s-Atom">rock</span><span class="p">).</span>
<span class="nf">beats</span><span class="p">(</span><span class="s s-Atom">scissors</span><span class="p">,</span> <span class="s s-Atom">paper</span><span class="p">).</span>
</pre></div>
</div>

<h1>
<span id="関数型" class="fragment"></span><a href="#%E9%96%A2%E6%95%B0%E5%9E%8B"><i class="fa fa-link"></i></a>関数型</h1>

<p>だれか...</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />99位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/874ea9b409b75de41914">静的ページを作るときにもjadeを使うと便利</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-10 01:10:18</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[HTML]</b> <b>[JavaScript]</b> <b>[Node.js]</b> <b>[Jade]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://jade-lang.com/" rel="nofollow noopener" target="_blank">jade</a>といえばnode.jsのテンプレートエンジンで<a href="http://expressjs.com/" rel="nofollow noopener" target="_blank">express</a>などのフレームワークと組み合わせて使うことが多いと思うが、単に静的ページを作るときにも使うことができる。jadeを使えば、HTMLを素でコーディングする場合と比べて次のような利点がある。なお、jadeと似たようなもので<a href="http://haml.info/" rel="nofollow noopener" target="_blank">Haml</a>や<a href="https://code.google.com/p/zen-coding/" rel="nofollow noopener" target="_blank">zen coding</a>がある。</p>

<ul>
<li>
<code>&lt;div&gt;</code> のとじ忘れによるレイアウト崩れで悩まない</li>
<li>変数が使えるので、文言の置き換えが簡単</li>
<li>ループができるので、HTMLが繰り返しになる部分が簡単</li>
</ul>

<p>jadeコマンドをインストールしておく:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>npm install -g jade
</pre></div></div>

<p>jadeでページを作る:</p>

<div class="code-frame" data-lang="jade">
<div class="code-lang"><span class="bold">src/index.jade</span></div>
<div class="highlight"><pre><span></span><span class="c">//- 変数定義</span>
<span class="nt">title</span> = "ぺーじのたいとる"
<span class="c">//- 以下HTML</span>
<span class="nt">doctype</span> 5
<span class="nt">html</span>
    <span class="nt">head</span>
        <span class="nt">meta</span>(<span class="na">charset=</span><span class="s">"utf-8"</span>)
        <span class="nt">title</span><span class="p">=</span> <span class="n">title</span>
    <span class="nt">body</span>
        <span class="nt">h1</span><span class="p">=</span> <span class="n">title</span>
        <span class="nt">p</span> コンテンツ
</pre></div>
</div>

<p>あとはコマンド叩くだけ:</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>jade -P src/*.jade -O public/
</pre></div></div>

<p>できあがり:</p>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">public/index.html</span></div>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"utf-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>ぺーじのたいとる<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>ぺーじのたいとる<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>コンテンツ<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>suinさんの<br />100位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>13</kbd>
		<a target="_blank" href="https://qiita.com/suin/items/d344c873178f1930b979">Doctrine2のBatch ProcessingのdetachをCallbackFilterIteratorでカプセル化してみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-12-12 20:39:07</center>
	</td>
	<td style="width:200px;">
		@suin<br />(ShouldBee 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/889/profile-images/1473682133">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> <b>[doctrine]</b> <b>[Symfony2]</b> <b>[Doctrine2]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>大量のデータをあつかう処理のために、Doctrine2には<a href="http://docs.doctrine-project.org/en/2.0.x/reference/batch-processing.html" rel="nofollow noopener" target="_blank">Batch Processing</a>があります。このBatch Processingは、<code>findBy()</code> とは違って結果をメモリに溜め込まみません。<code>foreach</code> のループ1回ごとに結果を逐次生成するため、メモリにやさしいのです。CSV出力など全データを参照するような場合は、このBatch Processingを使うほういいです。データが増えた時にもメモリ不足を回避できるからです。</p>

<p>しかし、Batch Processingは自分でメモリ管理をする必要があります。Doctrineは一意マッピング(Identity Map)をしているため、一度生成されたEntityはDoctrine側で参照を持っています。そのため、下記の例の(1)のように、ループごとに <code>EntityManager::detach()</code> をコールして Entity を開放しなければなりません。これでは、Doctrineについてよく知らない開発者が detach() を忘れてしまい、結局メモリ不足に陥ってしまうかもしれません。</p>

<p>また、Doctrineが返すイテレータはなぜか Entity を含む配列になっていて、下記の例の(2)のように、Entityを配列から取り出す処理を書かなければなりません。これでは一見何をしているか分かりにくいですね。あまり直感的ではありません。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">'SELECT p FROM AcmeBlogBundle:Post p'</span><span class="p">);</span>
<span class="nv">$iterableResult</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">iterate</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$iterableResult</span> <span class="k">AS</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>

    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">());</span> <span class="c1">// ・・・ (2)</span>

    <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// ・・・ (1)</span>
<span class="p">}</span>
</pre></div></div>

<ul>
<li>ループごとに <code>detach()</code> しないといけない</li>
<li>イテレータの戻り値が直感的でない</li>
</ul>

<p>そこで、<a href="http://php.net/manual/ja/class.callbackfilteriterator.php" rel="nofollow noopener" target="_blank"><code>CallbackFilterIterator</code></a> を使って上記の2つの問題をカプセル化する方法をご紹介します。 <code>CallbackFilterIterator</code> は PHP5.4 から追加されたクラスです。各要素について、コールバック関数を実行することができます。以下が、<code>CallbackFilterIterator</code> を使ったBatch Processingの実装です。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">'SELECT p FROM AcmeBlogBundle:Post p'</span><span class="p">);</span>
<span class="nv">$posts</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">iterate</span><span class="p">();</span>
<span class="nv">$posts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CallbackFilterIterator</span><span class="p">(</span><span class="nv">$posts</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$current</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$iterator</span><span class="p">)</span> <span class="k">use</span><span class="p">(</span><span class="nv">$entityManager</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// $current から Entity オブジェクトを取り出してセットしてあげる</span>
    <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$current</span><span class="p">);</span> <span class="c1">// イテレータの中でデタッチしてあげる</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">});</span>

<span class="k">foreach</span> <span class="p">(</span> <span class="nv">$posts</span> <span class="k">as</span> <span class="nv">$post</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">());</span>
<span class="p">}</span>

</pre></div></div>

<p>このままだと、コントローラがごちゃごちゃしてしまうので、CallbackFilterIterator部分はRepositoryでカプセル化しておくといいですね。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">PostRepository</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * すべてのブログ投稿を返す</span>
<span class="sd">     * @return Post[]</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getWholePostIterator</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">'SELECT p FROM AcmeBlogBundle:Post p'</span><span class="p">);</span>
        <span class="nv">$posts</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">iterate</span><span class="p">();</span>
        <span class="nv">$posts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CallbackFilterIterator</span><span class="p">(</span><span class="nv">$posts</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$current</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$iterator</span><span class="p">)</span> <span class="k">use</span><span class="p">(</span><span class="nv">$entityManager</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$current</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nv">$posts</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">CSVExportController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">exportAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$postRepository</span> <span class="o">=</span> <span class="o">.</span> <span class="o">.</span> <span class="o">.</span>

        <span class="nv">$posts</span> <span class="o">=</span> <span class="nv">$postRepository</span><span class="o">-&gt;</span><span class="na">getWholePostIterator</span><span class="p">();</span>

        <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$posts</span> <span class="k">as</span> <span class="nv">$post</span> <span class="p">)</span> <span class="p">{</span>
            <span class="c1">// CSV 吐き出し処理</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
