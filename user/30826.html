<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (asakahara)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (asakahara さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>659</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/32002bbf76ec112366b4">アプリエンジニアがアプリのデザインで困った時に頼るべきサイト一覧</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-12 22:50:55</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>この内容は前回の記事同様に始めたばかりの<a href="http://sakahara.hatenablog.jp/entry/2014/02/12/000341" rel="nofollow noopener" target="_blank">個人ブログ</a>に掲載していますが、少しでもたくさんの方に見ていただきたいので、Qiitaにも掲載することにしました。</p>

<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>アプリを開発する環境やチームは人それぞれだと思います。数人のプログラマーとデザイナーのチームで開発することもあればほとんど全てを一人でやる場合など。</p>

<p>特に日曜プログラマーの人でアプリを公開してみたいとなるとデザイナーの知り合いにお願いするか、お金を払ってデザインの発注するをするのはちょっと厳しい場合もあると思います。<br>
そんな時に全てではなくともある程度のデザインを自力でする力があると非常に助かります。</p>

<p>私も個人でアプリ出してますが、デザインがうまくできないせいでホントによく苦労しました。そんな中で参考にさせていただいたサイトや実際につかっているアイコン集などもあるので、数は少ないですが紹介してみます。</p>

<h2>
<span id="おすすめサイト" class="fragment"></span><a href="#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%82%B5%E3%82%A4%E3%83%88"><i class="fa fa-link"></i></a>おすすめサイト</h2>

<p>・<a href="http://pttrns.com/" rel="nofollow noopener" target="_blank">pttrns</a></p>

<p><a href="http://pttrns.com/" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/d8bc295a52080836991de9ba21ae5b3ea1bd0f85/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f732f73616b61686172612f32303134303231312f32303134303231313233353133302e706e67" alt="f:id:sakahara:20140211235130p:plain" title="f:id:sakahara:20140211235130p:plain" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/s/sakahara/20140211/20140211235130.png"></a></p>

<p>実際にリリースされているデザインのよい様々なアプリのスクリーンショットをカテゴリ毎に見れます。デザインの参考になるアプリが見たい場合はまずこちらがお勧めです。</p>

<p>・<a href="http://dribbble.com/" rel="nofollow noopener" target="_blank">dribbble</a></p>

<p><a href="http://dribbble.com/" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/c9f06baba0dea75e212e244f6b86ddc5a322fd42/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f732f73616b61686172612f32303134303231312f32303134303231313233353133382e706e67" alt="f:id:sakahara:20140211235138p:plain" title="f:id:sakahara:20140211235138p:plain" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/s/sakahara/20140211/20140211235138.png"></a></p>

<p>アプリ以外のデザインもありますが、ここに掲載されているアプリのデザインもとてもよいものが多いです。ここに掲載されているものは実際のアプリではなくコンセプト的なデザイン画像がほとんどです。</p>

<p>他にも日本のサイトでよいデザインを紹介してくれているサイトです。</p>

<p>・<a href="http://photoshopvip.net/archives/57164" rel="nofollow noopener" target="_blank">photoshopvip</a></p>

<p><a href="http://photoshopvip.net/archives/57164" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/fe4c8ad148ca08a9b9159978d4cb896261f5ad49/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f732f73616b61686172612f32303134303231312f32303134303231313233353134352e706e67" alt="f:id:sakahara:20140211235145p:plain" title="f:id:sakahara:20140211235145p:plain" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/s/sakahara/20140211/20140211235145.png"></a></p>

<p>こんなデザインがゼロからできるようになりたい！とよく思いますw</p>

<p>私はデザインのプロではないですし、デザインについて語れるほどの知識は持ち合わせていませんが、様々なデザインを見て実際にアプリを触ってみることで、より良い方法を知ることができます。そしてそれらを取り入れていくことが良い物を作る一番の近道だと思います。</p>

<p>自分でアイコン作るのも無理！という方は下記ここらのサイトからアイコンをゲットするのがよいです。有料のものが多いですが、一から描くことを考えると購入した方がかなり工数削減できます。それに加えVectorなどの様々なフォーマットに対応しているのでカスタマイズもできます。</p>

<h2>
<span id="アイコン等" class="fragment"></span><a href="#%E3%82%A2%E3%82%A4%E3%82%B3%E3%83%B3%E7%AD%89"><i class="fa fa-link"></i></a>アイコン等</h2>

<p>・<a href="http://www.glyphish.com/" rel="nofollow noopener" target="_blank">glyphish</a></p>

<p><a href="http://www.glyphish.com/" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/5eb9d0a59bde5187e910a0e8a4f0d160af8958aa/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f732f73616b61686172612f32303134303231312f32303134303231313233353135312e706e67" alt="f:id:sakahara:20140211235151p:plain" title="f:id:sakahara:20140211235151p:plain" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/s/sakahara/20140211/20140211235151.png"></a></p>

<p>・<a href="http://glyphicons.com/" rel="nofollow noopener" target="_blank">glyphicons.com</a></p>

<p><a href="http://glyphicons.com/" rel="nofollow noopener" target="_blank"><img src="https://camo.qiitausercontent.com/944096ed4322c380272f1751d05e748a0dab6c5b/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f732f73616b61686172612f32303134303231312f32303134303231313233353230312e706e67" alt="f:id:sakahara:20140211235201p:plain" title="f:id:sakahara:20140211235201p:plain" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/s/sakahara/20140211/20140211235201.png"></a></p>

<h2>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h2>

<p>アプリ作ってる方でデザインに苦労してる方に是非参考にして頂きたいと思います。<br>
また紹介したサイト以外にもまだまだ参考になる情報はあるので是非探してみてください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>375</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/9cb68bef56ca70b505c6">AFNetworking 2.0 のまとめ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-21 00:19:47</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>2.0になってから更にシンプルに記述できるようになっています。</p>

<p>下記が必須要件となっていますので導入前に確認してください。</p>

<ul>
<li>Xcode 5以上</li>
<li>iOS 6.0以上</li>
</ul>

<p>大きな変更点として<a href="http://cocoadocs.org/docsets/AFNetworking/2.0.0/Classes/AFHTTPSessionManager.html" rel="nofollow noopener" target="_blank">ドキュメント</a>にあるようにiOS7以降のサポートのみでよければ<code>AFHTTPSessionManager</code>のサブクラスを作成して実装することが推奨されています。<br>
iOS6やそれ以前のバージョンをサポートする場合の選択肢として<code>AFHTTPRequestOperationManager</code>が用意されています。</p>

<p>ここでは主に<code>AFHTTPRequestOperationManager</code>の使い方について触れておきます。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>インストールもCocoaPodsで簡単に導入できますので、下記Podfileをプロジェクトのルート直下に作成してインストールしましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>platform :ios, '7.0'
pod "AFNetworking", "~&gt; 2.0"
</pre></div></div>

<p>インストールできたら後はこの記述のみでJSONにパースするとこまでやってくれます。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">AFHTTPRequestOperationManager</span><span class="o">*</span> <span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
<span class="p">[</span><span class="n">manager</span> <span class="nl">GET</span><span class="p">:</span><span class="s">@"http://hoge/sample.json"</span>
      <span class="nl">parameters</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"response: %@"</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
    <span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error: %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="p">}];</span>
</pre></div></div>

<p>POSTでパラメータを設定する場合</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">AFHTTPRequestOperationManager</span><span class="o">*</span> <span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
<span class="bp">NSDictionary</span><span class="o">*</span> <span class="n">param</span> <span class="o">=</span> <span class="l">@{</span><span class="s">@"param1"</span> <span class="o">:</span> <span class="s">@"value1"</span><span class="p">,</span> <span class="s">@"param2"</span> <span class="o">:</span> <span class="s">@"value2"</span><span class="l">}</span><span class="p">;</span>
<span class="p">[</span><span class="n">manager</span> <span class="nl">POST</span><span class="p">:</span><span class="s">@"http://hoge/sample.json"</span> <span class="nl">parameters</span><span class="p">:</span><span class="n">param</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"response: %@"</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
    <span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error: %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="p">}];</span>
</pre></div></div>

<p>結果が通常のレスポンスの場合</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">AFHTTPRequestOperationManager</span><span class="o">*</span> <span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
<span class="n">manager</span><span class="p">.</span><span class="n">responseSerializer</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPResponseSerializer</span> <span class="n">serializer</span><span class="p">];</span>
</pre></div></div>

<p>として<code>AFHTTPResponseSerializer</code>をセットしておきましょう。<br>
でないとJSONのパースエラーになります。</p>

<p>レスポンスがXMLの場合少し面倒です。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">AFHTTPRequestOperationManager</span><span class="o">*</span> <span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
<span class="n">manager</span><span class="p">.</span><span class="n">responseSerializer</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFXMLParserResponseSerializer</span> <span class="n">serializer</span><span class="p">];</span>
<span class="c1">// 許可するContentTypeの設定が必要</span>
<span class="n">manager</span><span class="p">.</span><span class="n">responseSerializer</span><span class="p">.</span><span class="n">acceptableContentTypes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSSet</span> <span class="nl">setWithObject</span><span class="p">:</span><span class="s">@"application/rss+xml"</span><span class="p">];</span>
</pre></div></div>

<p>結果のresponseObjectが<code>NSXMLParser</code>なので自前でパースする必要があります。<br>
ここも自動でパースしてくれれば言う事無しです。</p>

<p>他にもリクエストパラメータをJSONにしたい場合には、</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">AFHTTPRequestOperationManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
<span class="n">manager</span><span class="p">.</span><span class="n">requestSerializer</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFJSONRequestSerializer</span> <span class="n">serializer</span><span class="p">];</span>
</pre></div></div>

<p>だけで自動でやってくれます。</p>

<h2>
<span id="通信ログについて" class="fragment"></span><a href="#%E9%80%9A%E4%BF%A1%E3%83%AD%E3%82%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>通信ログについて</h2>

<p>通信の詳細なログが見たい時は<code>AFNetworkActivityLogger</code>を別途インストールするとリクエストヘッダー、レスポンスヘッダーもログ出力してくれます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>platform :ios, '7.0'
pod "AFNetworking", "~&gt; 2.0"
pod "AFNetworkActivityLogger", "~&gt; 2.0"
</pre></div></div>

<p>Podfileに<code>AFNetworkActivityLogger</code>を追加してインストールします。</p>

<p><code>AppDelegate.m -application:didFinishLaunchingWithOptions::</code>にログを開始する処理を記述します。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">AFNetworkActivityLogger</span> <span class="n">sharedLogger</span><span class="p">]</span> <span class="n">startLogging</span><span class="p">];</span>
</pre></div></div>

<p>ログレベルを<code>AFLoggerLevelDebug</code>にすればリクエストヘッダー、レスポンスヘッダーを含む通信のやりとりをログに出力できます。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">AFNetworkActivityLogger</span> <span class="n">sharedLogger</span><span class="p">]</span> <span class="nl">setLevel</span><span class="p">:</span><span class="n">AFLoggerLevelDebug</span><span class="p">];</span>
</pre></div></div>

<p>GTMHttpFetcherのように通信ログをHTMLファイルで別途出力してくれれば言うことなしなんですけどね。</p>

<h2>
<span id="キャッシュポリシータイムアウトについて" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>キャッシュポリシー、タイムアウトについて</h2>

<p><code>AFHTTPRequestOperationManager</code>にはキャッシュポリシーとタイムアウトを設定するパラメータがありません。<br>
現状で対応しようとすると<code>AFHTTPRequestOperationManager</code>を継承したクラスを作って下記メソッドを追加するといった個別の対応をする必要があります。<br>
カテゴリを使ってメソッドを追加してもよさそうです。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="p">)</span><span class="nf">GET:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">URLString</span>
                     <span class="nf">parameters:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">parameters</span>
                <span class="nf">timeoutInterval:</span><span class="p">(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">timeoutInterval</span>
                    <span class="nf">cachePolicy:</span><span class="p">(</span><span class="n">NSURLRequestCachePolicy</span><span class="p">)</span><span class="nv">cachePolicy</span>
                        <span class="nf">success:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">))</span><span class="nv">success</span>
                        <span class="nf">failure:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">failure</span>
<span class="p">{</span>
    <span class="bp">NSMutableURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">requestSerializer</span> <span class="nl">requestWithMethod</span><span class="p">:</span><span class="s">@"GET"</span> <span class="nl">URLString</span><span class="p">:[[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="n">URLString</span> <span class="nl">relativeToURL</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">baseURL</span><span class="p">]</span> <span class="n">absoluteString</span><span class="p">]</span> <span class="nl">parameters</span><span class="p">:</span><span class="n">parameters</span><span class="p">];</span>
    <span class="n">request</span><span class="p">.</span><span class="n">timeoutInterval</span> <span class="o">=</span> <span class="n">timeoutInterval</span><span class="p">;</span>
    <span class="n">request</span><span class="p">.</span><span class="n">cachePolicy</span> <span class="o">=</span> <span class="n">cachePolicy</span><span class="p">;</span>
    <span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">HTTPRequestOperationWithRequest</span><span class="p">:</span><span class="n">request</span> <span class="nl">success</span><span class="p">:</span><span class="n">success</span> <span class="nl">failure</span><span class="p">:</span><span class="n">failure</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">operationQueue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">operation</span><span class="p">];</span>

    <span class="k">return</span> <span class="n">operation</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>もしくは<code>AFHTTPRequestOperationManager</code>を使用せず<code>AFHTTPRequestOperation</code>を直接使用することでも対応できます。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="bp">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@"http://hoge/sample.json"</span><span class="p">];</span>
<span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span><span class="n">URL</span> <span class="nl">cachePolicy</span><span class="p">:</span><span class="n">NSURLRequestReloadIgnoringLocalCacheData</span> <span class="nl">timeoutInterval</span><span class="p">:</span><span class="mf">60.0</span><span class="p">];</span>
<span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFHTTPRequestOperation</span> <span class="n">alloc</span><span class="p">]</span>
                                         <span class="nl">initWithRequest</span><span class="p">:</span><span class="n">request</span><span class="p">];</span>
<span class="p">[</span><span class="n">operation</span> <span class="nl">setCompletionBlockWithSuccess</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"response: %@"</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
    <span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error: %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="p">}];</span>

<span class="p">[</span><span class="n">operation</span> <span class="n">start</span><span class="p">];</span>
</pre></div></div>

<h2>
<span id="セキュリティポリシー" class="fragment"></span><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC"><i class="fa fa-link"></i></a>セキュリティポリシー</h2>

<p>テスト環境などでSSL通信をする際にオレオレ証明書(自己署名証明書)を使っている場合は、<code>AFHTTPRequestOperationManager</code>にオレオレ証明書を許可する設定を行うことで通信できます。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">AFHTTPRequestOperationManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
<span class="n">manager</span><span class="p">.</span><span class="n">securityPolicy</span><span class="p">.</span><span class="n">allowInvalidCertificates</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
<span class="c1">// 以降は通常通りAFHTTPRequestOperationManagerを使って通信を行う</span>
</pre></div></div>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p><code>NSURLSession</code>の登場によって今後は<code>NSURLConnection</code>がベースとなっている<code>AFHTTPRequestOperationManager</code>ではなく<code>AFHTTPSessionManager</code>が主流になると思います。<br>
現状ではiOS6のサポートが必要なアプリも多いと思いますので、<code>AFHTTPRequestOperationManager</code>をメインに使いつつ、可能なところから<code>AFHTTPSessionManager</code>にシフトしていけばよいでしょう。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>206</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/06abbc0209262d0051ef">iOSでアプリを削除してもデータを保持する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-12 00:12:42</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p><code>Keychain Services</code>というとパスワードを保存する仕組みだと思われる方が多いと思います。<br>
実際にそうなのですが、Keychainに保存した情報は<code>NSUserDefaults</code>と違ってアプリを削除した後もデータを保持することができるという別のメリットがあります。<br>
(Keychainの事を知らない人は<a href="http://cocoadays.blogspot.jp/2011/02/ios-keychain-services.html" rel="nofollow noopener" target="_blank">こちら</a>にとても分かりやすい説明が書いてあります)</p>

<p>そういった要件があるときに<code>NSUserDefaults</code>のように簡単にデータを保存するライブラリがあったらいいなと思ったら既に作ってる人がいました。<br>
<a href="https://github.com/TheLevelUp/LUKeychainAccess" rel="nofollow noopener" target="_blank">LUKeychainAccess</a>という名前のライブラリです。</p>

<p><code>Keychain Services</code>は<code>NSUserDefaults</code>と違い、気軽に使うにはちょっと面倒な仕組みなのでとてもありがたいです。</p>

<h4>
<span id="追記" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98"><i class="fa fa-link"></i></a>追記：</h4>

<p>iOSのバックアップを暗号化していない場合はキーチェーンの内容はバックアップされません。<br>
機種変更の時などに初期化されてしまう環境もありますので、その辺も踏まえて利用しましょう。</p>

<blockquote>
<p><a href="http://qiita.com/takayama">takayamaさん</a>、ご指摘いただきありがとうございます。</p>
</blockquote>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p><code>Security.framework</code>をターゲットに追加してください。<br>
次にソースをダウンロードしましょう。</p>

<p><a href="https://github.com/TheLevelUp/LUKeychainAccess" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/TheLevelUp/LUKeychainAccess</a></p>

<p>ダウンロードしたソースコード内の<code>LUKeychainAccess</code>ディレクトリごとプロジェクトにコピーして、<br>
<code>LUKeychainAccess.h</code>ファイルをインポートしましょう。</p>

<p>使い方もとてもシンプルで<code>NSUserDefaults</code>とほぼ同様の使い方でデータを扱えます。</p>

<h4>
<span id="データの保存" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%BF%9D%E5%AD%98"><i class="fa fa-link"></i></a>データの保存</h4>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">// integer</span>
<span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">setInteger</span><span class="p">:</span><span class="mi">1</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@"integerKey"</span><span class="p">];</span>
<span class="c1">// float</span>
<span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">setFloat</span><span class="p">:</span><span class="mf">1.0</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@"floatKey"</span><span class="p">];</span>
<span class="c1">// double</span>
<span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">setDouble</span><span class="p">:</span><span class="mf">1.0</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@"doubleKey"</span><span class="p">];</span>
<span class="c1">// BOOL</span>
<span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">setBool</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@"boolKey"</span><span class="p">];</span>
<span class="c1">// NSString</span>
<span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">setString</span><span class="p">:</span><span class="s">@"string"</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@"stringKey"</span><span class="p">];</span>
<span class="c1">// NSObject</span>
<span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">setObject</span><span class="p">:</span><span class="s">@"object"</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@"objectKey"</span><span class="p">];</span>
</pre></div></div>

<p>セットした値はすぐに保存されます。</p>

<h4>
<span id="保存したデータの読み込み" class="fragment"></span><a href="#%E4%BF%9D%E5%AD%98%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><i class="fa fa-link"></i></a>保存したデータの読み込み</h4>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">// integer</span>
<span class="n">NSInteger</span> <span class="n">integerValue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">integerForKey</span><span class="p">:</span><span class="s">@"integerKey"</span><span class="p">];</span>
<span class="c1">// float</span>
<span class="kt">float</span> <span class="n">floatValue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">floatForKey</span><span class="p">:</span><span class="s">@"floatKey"</span><span class="p">];</span>
<span class="c1">// double</span>
<span class="kt">float</span> <span class="n">doubleValue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">doubleForKey</span><span class="p">:</span><span class="s">@"doubleKey"</span><span class="p">];</span>
<span class="c1">// BOOL</span>
<span class="kt">BOOL</span> <span class="n">boolValue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">boolForKey</span><span class="p">:</span><span class="s">@"boolKey"</span><span class="p">];</span>
<span class="c1">// NSString</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">stringValue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">stringForKey</span><span class="p">:</span><span class="s">@"stringKey"</span><span class="p">];</span>
<span class="c1">// NSObject</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">objectValue</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LUKeychainAccess</span> <span class="n">standardKeychainAccess</span><span class="p">]</span> <span class="nl">objectForKey</span><span class="p">:</span><span class="s">@"objectKey"</span><span class="p">];</span>
</pre></div></div>

<p>と正に<code>NSUserDefaults</code>と同じ使い勝手でした。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>197</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/9d553a76e82df00319cd">無料でここまでできる！iOSでグラフ／チャートを描くためのライブラリ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-15 21:32:43</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>ちょっと大げさなタイトルですが、仕事で円グラフを描画したいという要望があったので調査してみたときのメモです。</p>

<p>グラフを描写するライブラリで無料かつ良さそうなものをいくつかをピックアップしてみました。</p>

<p>・<a href="https://www.cocoacontrols.com/controls/xypiechart" rel="nofollow noopener" target="_blank">XYPieChart for iOS</a><br>
円グラフ専用のライブラリです。<br>
円グラフのみ使用するのであればデザイン、アニメーションなど含めて一番よいライブラリでしょう。</p>

<p>・<a href="https://www.cocoacontrols.com/controls/pnchart" rel="nofollow noopener" target="_blank">PNChart for iOS</a><br>
円グラフ、折れ線グラフ、棒グラフの３つをサポートしてます。<br>
サポートしているグラフも一番多くデザインもシンプルで気に入っているのですが、円グラフは通常のものと表現方法が違い一つのデータしか扱えないようです。<br>
ここを改善できればこの３つの中では一番よいライブラリだと思います。</p>

<p>・<a href="https://github.com/honcheng/iOSPlot" rel="nofollow noopener" target="_blank">iOSPlot for iOS</a><br>
円グラフと折れ線グラフの両方をサポートしています。<br>
機能的にも中々よいのですが、ここ半年以上更新されていないので今後のアップデートは期待できなさそうです。</p>

<p>この３つを比較した結果、折れ線グラフ、棒グラフなら<code>PNChart</code>、円グラフオンリーなら<code>XYPieChart</code>と使い分けるのが良さそうです。<br>
「別のグラフ使いたいよ」という方は自力で作るか、別のライブラリ探してみてください。</p>

<p>[追記]<br>
・<a href="https://github.com/core-plot/core-plot" rel="nofollow noopener" target="_blank">Core Plot</a><br>
この<a href="https://github.com/core-plot/core-plot/wiki/Example-Graphs" rel="nofollow noopener" target="_blank">サンプル</a>をご覧になれば分かると思いますが、かなり高機能なライブラリです。<br>
その代わり高機能だけにそれだけ複雑な仕様にもなっているので、業務などでがっつりグラフを描写する必要がある場合などはCore Plotが一番柔軟に対応できるでしょう。</p>

<p>ここでは<code>XYPieChart</code>で円グラフを表示する方法を紹介します。</p>

<h2>
<span id="xypiechartの使い方" class="fragment"></span><a href="#xypiechart%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>XYPieChartの使い方</h2>

<p>Cocoa Podsで導入するのが一番楽です。<br>
下記のPodfileをプロジェクトのルードディレクトリ配下に作成して、コンソールから<code>pod install</code>コマンドを実行すれば導入できます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>platform :ios, '6.0'
pod 'XYPieChart', '~&gt; 0.2'
</pre></div></div>

<p>次にUIViewControllerを作成します。<br>
ここでは便宜上<code>ASChartViewController</code>という名前にします。<br>
後は下記ソースコードを作成したViewControllerのソースに貼付けてもらえば円グラフを画面に表示できます。<br>
ソースコード内のコメントを見ていただければ必要最低限の使い方は把握できると思います。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#import "ASChartViewController.h"</span>
<span class="cp">#import "XYPieChart.h"</span>

<span class="k">@interface</span> <span class="nc">ASChartViewController</span> <span class="p">()</span> <span class="o">&lt;</span><span class="n">XYPieChartDelegate</span><span class="p">,</span> <span class="n">XYPieChartDataSource</span><span class="o">&gt;</span>

<span class="c1">// 各スライスの色</span>
<span class="k">@property</span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSArray</span> <span class="o">*</span><span class="n">sliceColors</span><span class="p">;</span>
<span class="c1">// 各スライスのデータ</span>
<span class="k">@property</span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">slices</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ASChartViewController</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>

    <span class="c1">// スライスに表示するデータの定義</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">slices</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="nl">arrayWithCapacity</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">NSNumber</span> <span class="o">*</span><span class="n">one</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">+</span> <span class="mi">20</span><span class="p">];</span>
        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">slices</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">one</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// 各項目の背景色を定義</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">sliceColors</span> <span class="o">=</span> <span class="l">@[</span><span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">246</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">green</span><span class="p">:</span><span class="mi">155</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span>
                         <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">129</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">green</span><span class="p">:</span><span class="mi">195</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">29</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span>
                         <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">62</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">green</span><span class="p">:</span><span class="mi">173</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">219</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span>
                         <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">229</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">green</span><span class="p">:</span><span class="mi">66</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">115</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span>
                         <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">148</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">green</span><span class="p">:</span><span class="mi">141</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">139</span><span class="o">/</span><span class="mf">255.0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="l">]</span><span class="p">;</span>

    <span class="c1">// パイチャートの初期化</span>
    <span class="n">XYPieChart</span> <span class="o">*</span><span class="n">pieChart</span> <span class="o">=</span> <span class="p">[[</span><span class="n">XYPieChart</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">220.0</span><span class="p">,</span> <span class="mf">220.0</span><span class="p">)];</span>

    <span class="c1">// デリゲートの設定</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="c1">// データソースの設定</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="c1">// パイチャートの中心位置</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">pieCenter</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">center</span><span class="p">;</span>
    <span class="c1">// YESの場合、パーセンテージで数字を表示します。</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">showPercentage</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="c1">// 値を表示するラベルのフォント</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">labelFont</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIFont</span> <span class="nl">systemFontOfSize</span><span class="p">:</span><span class="mf">12.0</span><span class="p">];</span>
    <span class="c1">// 値を表示するラベルの色</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">labelColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">blackColor</span><span class="p">];</span>
    <span class="c1">// 値を表示するラベル背景のシャドウカラー</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">labelShadowColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">darkGrayColor</span><span class="p">];</span>
    <span class="c1">// 表示アニメーションのスピード</span>
    <span class="n">pieChart</span><span class="p">.</span><span class="n">animationSpeed</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="c1">// パイチャートの背景色</span>
    <span class="p">[</span><span class="n">pieChart</span> <span class="nl">setPieBackgroundColor</span><span class="p">:[</span><span class="bp">UIColor</span> <span class="n">darkGrayColor</span><span class="p">]];</span>

    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">pieChart</span><span class="p">];</span>

    <span class="c1">// パイチャートを描画します。</span>
    <span class="p">[</span><span class="n">pieChart</span> <span class="n">reloadData</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - XYPieChart Data Source</span>

<span class="c1">// スライスの件数</span>
<span class="p">-</span> <span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nf">numberOfSlicesInPieChart:</span><span class="p">(</span><span class="n">XYPieChart</span> <span class="o">*</span><span class="p">)</span><span class="nv">pieChart</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">slices</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 各スライスの値</span>
<span class="p">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">pieChart:</span><span class="p">(</span><span class="n">XYPieChart</span> <span class="o">*</span><span class="p">)</span><span class="nv">pieChart</span> <span class="nf">valueForSliceAtIndex:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">index</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">slices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="n">floatValue</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// 各スライスの色を設定(Optional)</span>
<span class="p">-</span> <span class="p">(</span><span class="bp">UIColor</span> <span class="o">*</span><span class="p">)</span><span class="nf">pieChart:</span><span class="p">(</span><span class="n">XYPieChart</span> <span class="o">*</span><span class="p">)</span><span class="nv">pieChart</span> <span class="nf">colorForSliceAtIndex:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">index</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">self</span><span class="p">.</span><span class="n">sliceColors</span><span class="p">[(</span><span class="n">index</span> <span class="o">%</span> <span class="nb">self</span><span class="p">.</span><span class="n">sliceColors</span><span class="p">.</span><span class="n">count</span><span class="p">)];</span>
<span class="p">}</span>

<span class="c1">// 各スライスに表示する文字列の設定(Optional)</span>
<span class="p">-</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">pieChart:</span><span class="p">(</span><span class="n">XYPieChart</span> <span class="o">*</span><span class="p">)</span><span class="nv">pieChart</span> <span class="nf">textForSliceAtIndex:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="nv">index</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@"%@ 件"</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">slices</span><span class="p">[</span><span class="n">index</span><span class="p">]];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div></div>

<p>実行結果のスクリーンショットです。</p>

<p><a href="https://camo.qiitausercontent.com/da977909f500255a6badf41f55b87215c76a73bc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f63306234363839632d343764622d653333622d366531302d6230363966373234393839382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/da977909f500255a6badf41f55b87215c76a73bc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f63306234363839632d343764622d653333622d366531302d6230363966373234393839382e706e67" alt="XYPieChartSample.png" title="XYPieChartSample.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/c0b4689c-47db-e33b-6e10-b069f7249898.png"></a></p>

<p>使い勝手もよく必要最低限の機能は揃っているのでオススメです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>98</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/cf68f87be4f1dd116778">iOSでZIPファイルの圧縮／解凍を簡単に実装する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-08 14:20:52</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>iOSで手っ取り早くZIPファイルの圧縮／解凍する方法を調べてみました。</p>

<p>zlibを使ってC言語で処理を書くなんてこともできるようですが、<br>
Objective-c 一辺倒の私にはこの方法は却下です。</p>

<p><a href="https://code.google.com/p/ziparchive/" title="ZipArchive" rel="nofollow noopener" target="_blank">ZipArchive</a>というライブラリもありますが、こちらはソースコードが古くARCにも対応していません。<br>
で最終的に行き着いたのが<a href="https://github.com/soffes/ssziparchive" title="SSZipArchive" rel="nofollow noopener" target="_blank">SSZipArchive</a>というライブラリです。<br>
これはZipArchiveをベースに作られたものでARCにも対応しています。</p>

<p>使い方もとてもシンプルだったのでSSZipArchiveが現時点(2013/12/8)では一番よいかと思います。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>まずgithubからソースを取得しましょう。</p>

<p><a href="https://github.com/soffes/ssziparchive" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/soffes/ssziparchive</a></p>

<p>ソースコード内の<code>SSZipArchive</code>ディレクトリとその配下にある<code>minizip</code>ディレクトリをプロジェクトに追加します。</p>

<p><code>libz.dylib</code>をターゲットに追加します。</p>

<p><code>SSZipArchive.h</code>ヘッダーをインポートすることも忘れないように。</p>

<h4>
<span id="解凍するとき" class="fragment"></span><a href="#%E8%A7%A3%E5%87%8D%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D"><i class="fa fa-link"></i></a>解凍するとき</h4>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">// 解凍</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">zipFilePath</span> <span class="o">=</span> <span class="s">@"解凍するZIPファイルのパス"</span><span class="p">;</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">destinationPath</span> <span class="o">=</span> <span class="s">@"解凍したファイルを展開するディレクトリのス"</span><span class="p">;</span>
<span class="kt">BOOL</span> <span class="n">isSuccess</span> <span class="o">=</span> <span class="p">[</span><span class="n">SSZipArchive</span> <span class="nl">unzipFileAtPath</span><span class="p">:</span><span class="n">zipFilePath</span> <span class="nl">Destination</span><span class="p">:</span><span class="n">destinationPath</span> <span class="nl">delegate</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="n">isSuccess</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 処理が成功した場合</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 処理が失敗した場合</span>
<span class="p">}</span>
</pre></div></div>

<p>パスワードを指定する場合</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">// 解凍</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">zipFilePath</span> <span class="o">=</span> <span class="s">@"解凍するZIPファイルのパス"</span><span class="p">;</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">destinationPath</span> <span class="o">=</span> <span class="s">@"解凍したファイルを展開するディレクトリのス"</span><span class="p">;</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">password</span> <span class="o">=</span> <span class="s">@"パスワード"</span><span class="p">;</span>
<span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">[</span><span class="n">SSZipArchive</span> <span class="nl">unzipFileAtPath</span><span class="p">:</span><span class="n">zipFilePath</span> <span class="nl">toDestination</span><span class="p">:</span><span class="n">destinationPath</span>
                    <span class="nl">overwrite</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">password</span><span class="p">:</span><span class="n">password</span> <span class="nl">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span> <span class="nl">delegate</span><span class="p">:</span><span class="nb">self</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// エラーが発生した場合</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"error: %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<p>解凍が完了した場合に処理を実行した場合はデリゲートを設定した上で、下記メソッドを実装する</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">zipArchiveDidUnzipArchiveAtPath:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">path</span> <span class="nf">zipInfo:</span><span class="p">(</span><span class="n">unz_global_info</span><span class="p">)</span><span class="nv">zipInfo</span> <span class="nf">unzippedPath:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">unzippedPath</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"解凍完了"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div>

<h4>
<span id="圧縮する時" class="fragment"></span><a href="#%E5%9C%A7%E7%B8%AE%E3%81%99%E3%82%8B%E6%99%82"><i class="fa fa-link"></i></a>圧縮する時</h4>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">// 圧縮</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">zippedFilePath</span> <span class="o">=</span> <span class="s">@"圧縮したZIPファイルの保存先パス"</span><span class="p">;</span>
<span class="bp">NSArray</span> <span class="o">*</span><span class="n">inputFilePaths</span> <span class="o">=</span> <span class="l">@[</span><span class="p">[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span>
                             <span class="nl">pathForResource</span><span class="p">:</span><span class="s">@"sampleImage"</span> <span class="nl">ofType</span><span class="p">:</span><span class="s">@"jpg"</span><span class="p">],</span>
                            <span class="p">[[</span><span class="bp">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span>
                             <span class="nl">pathForResource</span><span class="p">:</span><span class="s">@"sampleText"</span> <span class="nl">ofType</span><span class="p">:</span><span class="s">@"txt"</span><span class="p">]</span><span class="l">]</span><span class="p">;</span>
<span class="kt">BOOL</span> <span class="n">isSuccess</span> <span class="o">=</span> <span class="p">[</span><span class="n">SSZipArchive</span> <span class="nl">createZipFileAtPath</span><span class="p">:</span><span class="n">zippedFilePath</span> <span class="nl">hFilesAtPaths</span><span class="p">:</span><span class="n">inputFilePaths</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="n">isSuccess</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 処理が成功した場合</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// 処理が失敗した場合</span>
<span class="p">}</span>
</pre></div></div>

<p>という事でとても簡単に実装できます。<br>
デリゲートでは無くブロック構文に対応させてもよさそうです。</p>

<p>お試しあれ！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>85</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/307638c1396286afb3f3">JSON&lt;-&gt;NSManagedObjectのマッピングを簡単に！Mantleを使ってCore Dataのソースコードをシンプルにする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-15 00:28:52</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>JSONをProperyに変換する作業を一つずつ手動でコーティングするのはかなり手間だと思います。<br>
その作業を楽にするために今回使用する<a href="https://github.com/MantleFramework/Mantle" rel="nofollow noopener" target="_blank">Mantle</a>やその他に<a href="https://github.com/icanzilb/JSONModel" rel="nofollow noopener" target="_blank">JSONModel</a>などを使ってマッピングを極力自動でできるようにしている方は多いのではないでしょうか？</p>

<p>この便利な仕組みをCore Dataの<code>NSManagedObject</code>でも利用できないかなと思い調べてみた際のログです。<br>
結論から言うとMantleは既に<code>NSManagedObject</code>にも対応しています。</p>

<p>これができれば例えばサーバからJSONで受け取った値を自動で<code>NSManagedObject</code>にマッピングして登録することがとても簡単になります。</p>

<p>今回利用する<code>NSManagedObject</code>のレイアウトを記載しておきます。</p>

<p>エンティティ名:Blog<br>
クラス名:ASBlogEntity</p>

<table>
<thead>
<tr>
<th style="text-align: left">項目名</th>
<th style="text-align: left">データ型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">title</td>
<td style="text-align: left">NSString</td>
</tr>
<tr>
<td style="text-align: left">body</td>
<td style="text-align: left">NSString</td>
</tr>
<tr>
<td style="text-align: left">pubDate</td>
<td style="text-align: left">NSDate</td>
</tr>
<tr>
<td style="text-align: left">userID</td>
<td style="text-align: left">NSString</td>
</tr>
<tr>
<td style="text-align: left">webURL</td>
<td style="text-align: left">NSString</td>
</tr>
<tr>
<td style="text-align: left">blogImageURL</td>
<td style="text-align: left">NSString</td>
</tr>
</tbody>
</table>

<p>Mantleで使用するモデルクラスのレイアウトです。</p>

<p>クラス名:ASBlogModel</p>

<table>
<thead>
<tr>
<th style="text-align: left">項目名</th>
<th style="text-align: left">データ型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">title</td>
<td style="text-align: left">NSString</td>
</tr>
<tr>
<td style="text-align: left">body</td>
<td style="text-align: left">NSString</td>
</tr>
<tr>
<td style="text-align: left">pubDate</td>
<td style="text-align: left">NSDate</td>
</tr>
<tr>
<td style="text-align: left">creator</td>
<td style="text-align: left">NSString</td>
</tr>
<tr>
<td style="text-align: left">webURL</td>
<td style="text-align: left">NSString</td>
</tr>
<tr>
<td style="text-align: left">blogImageURL</td>
<td style="text-align: left">NSURL</td>
</tr>
</tbody>
</table>

<p>ポイントとして項目名が違うuserID、creatorの関連付けを手動でマッピングし、<code>blogImageURL</code>の型の違いを<code>NSValueTransformer</code>で対応します。</p>

<h2>
<span id="手順" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>手順</h2>

<p>ではMantleの導入からです。</p>

<p>下記内容のPodfileを作成してインストールしましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>platform :ios, '7.0'
pod 'Mantle'
</pre></div></div>

<p><code>pod install</code>を実行することも忘れずに。</p>

<p>Core Dataに関する詳細な設定は省いて、検証した内容のみ記載しておきます。</p>

<p>まずCore DataのData ModelにBlogエンティティを作成します。(Blogエンティティのクラス名はASBlogEntityに設定)<br>
次にNSManagedObject subclassを作成し、ASBlogEntityクラスを自動生成します。<br>
これでCore Data側の準備はオッケーです。<br>
下記は自動生成されたASBlogEntityのソースとなります。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">ASBlogEntity</span> : <span class="bp">NSManagedObject</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">retain</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span> <span class="n">blogImageURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">retain</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span> <span class="n">body</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">retain</span><span class="p">)</span> <span class="bp">NSDate</span> <span class="o">*</span> <span class="n">pubDate</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">retain</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span> <span class="n">title</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">retain</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span> <span class="n">userID</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">retain</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span> <span class="n">webURL</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ASBlogEntity</span>

<span class="k">@dynamic</span> <span class="n">blogImageURL</span><span class="p">;</span>
<span class="k">@dynamic</span> <span class="n">body</span><span class="p">;</span>
<span class="k">@dynamic</span> <span class="n">pubDate</span><span class="p">;</span>
<span class="k">@dynamic</span> <span class="n">title</span><span class="p">;</span>
<span class="k">@dynamic</span> <span class="n">userID</span><span class="p">;</span>
<span class="k">@dynamic</span> <span class="n">webURL</span><span class="p">;</span>

<span class="k">@end</span>
</pre></div></div>

<p>次はMantleを使用したModelクラスの作成です。</p>

<p>こちらはJSONの項目に基づいて手動で作成しています。<br>
今回作成した内容は下記の通りです。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">ASBlogModel</span> : <span class="nc">MTLModel</span> <span class="o">&lt;</span><span class="n">MTLJSONSerializing</span><span class="p">,</span> <span class="n">MTLManagedObjectSerializing</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">title</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">body</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">creator</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSURL</span> <span class="o">*</span><span class="n">blogImageURL</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">webURL</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSDate</span> <span class="o">*</span><span class="n">pubDate</span><span class="p">;</span>

<span class="k">@end</span>


<span class="k">@implementation</span> <span class="nc">ASBlogModel</span>

<span class="p">+</span> <span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nf">JSONKeyPathsByPropertyKey</span> <span class="p">{</span>
    <span class="k">return</span> <span class="l">@{</span>
             <span class="s">@"body"</span><span class="o">:</span> <span class="s">@"description"</span><span class="p">,</span>
             <span class="s">@"creator"</span><span class="o">:</span> <span class="s">@"dc:creator"</span><span class="p">,</span>
             <span class="s">@"blogImageURL"</span><span class="o">:</span> <span class="s">@"media:content.url"</span><span class="p">,</span>
             <span class="s">@"webURL"</span><span class="o">:</span> <span class="s">@"link"</span><span class="p">,</span>
             <span class="l">}</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">+</span> <span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nf">managedObjectKeysByPropertyKey</span> <span class="p">{</span>
    <span class="k">return</span> <span class="l">@{</span>
             <span class="s">@"creator"</span><span class="o">:</span> <span class="s">@"userID"</span><span class="p">,</span>
             <span class="l">}</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">+</span> <span class="p">(</span><span class="bp">NSValueTransformer</span> <span class="o">*</span><span class="p">)</span><span class="nf">blogImageURLJSONTransformer</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">NSValueTransformer</span> <span class="nl">valueTransformerForName</span><span class="p">:</span><span class="n">MTLURLValueTransformerName</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// 画像URLはJSONではNSURLだがNSManagedObjectはNSStringのため型変換を手動で行う</span>
<span class="p">+</span> <span class="p">(</span><span class="bp">NSValueTransformer</span> <span class="o">*</span><span class="p">)</span><span class="nf">blogImageURLEntityAttributeTransformer</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">MTLValueTransformer</span> <span class="nl">reversibleTransformerWithForwardBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSURL</span> <span class="o">*</span><span class="n">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">.</span><span class="n">absoluteString</span><span class="p">;</span>
    <span class="p">}</span> <span class="nl">reverseBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="n">str</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="p">+</span> <span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">managedObjectEntityName</span> <span class="p">{</span>
    <span class="c1">// クラス名ではなくData Modelで定義したエンティティ名を返す</span>
    <span class="k">return</span> <span class="s">@"Blog"</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>

</pre></div></div>

<p><code>+ managedObjectKeysByPropertyKey:</code>をオーバーライドしてモデルのプロパティと<code>NSManagedObject</code>のプロパティのマッピングを行います。<br>
同名のプロパティは自動でマッピングしてくれますが、プロパティ名が異なる項目はここで関連付けを行います。<br>
しかし全て同名の項目の場合でも一つは項目を定義しないとマッピングがうまくいきません。<br>
例えば空の<code>NSDictionary</code>やnilを返すとマッピングに失敗します。<br>
これはさすがに不便なので今後の改善に期待するか自前で修正するかのどちらかになるでしょう。<br>
説明は省きますが<code>+ JSONKeyPathsByPropertyKey:</code>は<code>+ managedObjectKeysByPropertyKey:</code>メソッドのJSON版という認識でオッケーです。</p>

<p>プロパティ名ではなくデータ型が異なるケースではblogImageURLプロパティのように<code>+ blogImageURLEntityAttributeTransformer:</code>メソッドに返す結果を直接書くことで対応します。<br>
(EntityAttributeTransformerより前がプロパティ名になります)</p>

<p>下記のようにテストを行ってみました。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">ASBlogModel</span> <span class="o">*</span><span class="n">blog</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ASBlogModel</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

<span class="n">blog</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">@"title1"</span><span class="p">;</span>
<span class="n">blog</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">@"body1"</span><span class="p">;</span>
<span class="n">blog</span><span class="p">.</span><span class="n">creator</span> <span class="o">=</span> <span class="s">@"asakahara"</span><span class="p">;</span>
<span class="n">blog</span><span class="p">.</span><span class="n">webURL</span> <span class="o">=</span> <span class="s">@"http://www.mocology.com"</span><span class="p">;</span>
<span class="n">blog</span><span class="p">.</span><span class="n">blogImageURL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@"http://www.mocology.com"</span><span class="p">];</span>

<span class="n">ASBlogEntity</span> <span class="o">*</span><span class="n">blogEntity</span> <span class="o">=</span> <span class="p">[</span><span class="n">MTLManagedObjectAdapter</span> <span class="nl">managedObjectFromModel</span><span class="p">:</span><span class="n">blog</span>
                                                                <span class="nl">insertingIntoContext</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">managedObjectContext</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>

<span class="n">NSLog</span><span class="p">(</span><span class="s">@"blogEntity: %@"</span><span class="p">,</span> <span class="n">blogEntity</span><span class="p">);</span>
</pre></div></div>

<p>テスト結果は下記の通りで、マッピングは問題なく成功しています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>blogEntity: &lt;ASBlogEntity: 0x8c335e0&gt; (entity: Blog; id: 0x8c33800 &lt;x-coredata:///Blog/t626186A9-E3A2-487E-9EFB-A224A4C63FD52&gt; ; data: {
    blogImageURL = "http://www.mocology.com";
    body = body1;
    pubDate = nil;
    title = title1;
    userID = asakahara;
    webURL = "http://www.mocology.com";
})
</pre></div></div>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>Mantleを使用することでJSONだけでなくNSManagedObjectのマッピングもとてもシンプルにコーディングできるようになりました。<br>
自前でマッピング処理を記述するよりも機能も豊富なのでMantleを使用することをお勧めします。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>56</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/39abb8aa08544223ecd4">iOSでの単体テストをとてもシンプルにできる！XCTestとOHHTTPStubsを使ってAFNetworkingの単体テストをやってみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-08 23:11:40</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p><a href="http://qiita.com/asakahara/items/5b5a994782db856741e0" id="reference-efe24dbb041b56d0ef7a">前回</a>の続きで今回は<a href="https://github.com/AliSoftware/OHHTTPStubs" rel="nofollow noopener" target="_blank">OHHTTPStubs</a>を使用して単体テストを行ってみました。<br>
(テスト対象となるソースコードの概要は<a href="http://qiita.com/asakahara/items/5b5a994782db856741e0">前回のコンテンツ</a>を参照してください)</p>

<p><code>OHHTTPStubs</code>はサーバサイドの処理を用意することなく、クライアントのみでHTTP通信のスタブを用意できるとても便利なライブラリです。</p>

<p>今回は<a href="https://github.com/travisjeffery/TRVSMonitor" rel="nofollow noopener" target="_blank">TRVSMonitor</a>というライブラリも一緒に使用しています。<br>
XCTestは非同期処理を待たずにテストケースを終了してしまう場合があるのですが、それを防いでくれるのが<code>TRVSMonitor</code>です。</p>

<h2>
<span id="手順" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>手順</h2>

<p><code>OHHTTPStubs</code>もCocoaPodsでインストールします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>platform :ios, '7.0'
pod "AFNetworking", "~&gt; 2.0"
pod 'KissXML'
target :BlogProjectTest, :exclusive =&gt; true do
  pod 'OHHTTPStubs'
  pod 'TRVSMonitor'
end
</pre></div></div>

<p>テスト開始時のテストデータを用意する目的で<code>OHHTTPStubs</code>を使用します。<br>
今回は使いやすいように<code>OHHTTPStubs</code>のユーティリティクラスを用意しました。<br>
必要となるのはレスポンスの結果、ステータスコード、コンテントタイプ、最後にエンドポイントです。<br>
これらを自由にカスタマイズできるのでHTTP通信のほとんどをテストできます。<br>
また今回は使用しませんが、リクエストタイム、レスポンスタイムも調整できます。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">ASHTTPStubUtil</span> : <span class="bp">NSObject</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupResponseWithFile:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fileName</span> <span class="nf">statusCode:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">statusCode</span>
         <span class="nf">contentTypes:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">contentTypes</span> <span class="nf">endPoint:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">endPoint</span><span class="p">;</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupResponseWithData:</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="p">)</span><span class="nv">data</span> <span class="nf">statusCode:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">statusCode</span>
                 <span class="nf">contentTypes:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">contentTypes</span> <span class="nf">endPoint:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">endPoint</span><span class="p">;</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupResponseXML:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fileName</span> <span class="nf">statusCode:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">statusCode</span>
                <span class="nf">endPoint:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">endPoint</span><span class="p">;</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeAll</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ASHTTPStubUtil</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupResponseXML:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fileName</span> <span class="nf">statusCode:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">statusCode</span> <span class="nf">endPoint:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">endPoint</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">OHHTTPStubs</span> <span class="nl">stubRequestsPassingTest</span><span class="p">:</span><span class="o">^</span><span class="kt">BOOL</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">request</span><span class="p">.</span><span class="n">URL</span><span class="p">.</span><span class="n">absoluteString</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">endPoint</span><span class="p">];</span>
    <span class="p">}</span> <span class="nl">withStubResponse</span><span class="p">:</span><span class="o">^</span><span class="n">OHHTTPStubsResponse</span> <span class="o">*</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">OHHTTPStubsResponse</span> <span class="nl">responseWithFileAtPath</span><span class="p">:</span><span class="n">OHPathForFileInBundle</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="nb">nil</span><span class="p">)</span>
                                                <span class="nl">statusCode</span><span class="p">:</span><span class="n">statusCode</span> <span class="nl">headers</span><span class="p">:</span><span class="l">@{</span><span class="s">@"Content-Type"</span><span class="o">:</span><span class="s">@"application/rss+xml"</span><span class="l">}</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupResponseWithFile:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fileName</span> <span class="nf">statusCode:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">statusCode</span>
             <span class="nf">contentTypes:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">contentTypes</span> <span class="nf">endPoint:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">endPoint</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">OHHTTPStubs</span> <span class="nl">stubRequestsPassingTest</span><span class="p">:</span><span class="o">^</span><span class="kt">BOOL</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">request</span><span class="p">.</span><span class="n">URL</span><span class="p">.</span><span class="n">absoluteString</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">endPoint</span><span class="p">];</span>
    <span class="p">}</span> <span class="nl">withStubResponse</span><span class="p">:</span><span class="o">^</span><span class="n">OHHTTPStubsResponse</span> <span class="o">*</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">OHHTTPStubsResponse</span> <span class="nl">responseWithFileAtPath</span><span class="p">:</span><span class="n">OHPathForFileInBundle</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="nb">nil</span><span class="p">)</span>
                                                <span class="nl">statusCode</span><span class="p">:</span><span class="n">statusCode</span> <span class="nl">headers</span><span class="p">:</span><span class="n">contentTypes</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setupResponseWithData:</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="p">)</span><span class="nv">data</span> <span class="nf">statusCode:</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="nv">statusCode</span>
             <span class="nf">contentTypes:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">contentTypes</span> <span class="nf">endPoint:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">endPoint</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">OHHTTPStubs</span> <span class="nl">stubRequestsPassingTest</span><span class="p">:</span><span class="o">^</span><span class="kt">BOOL</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">request</span><span class="p">.</span><span class="n">URL</span><span class="p">.</span><span class="n">absoluteString</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">endPoint</span><span class="p">];</span>
    <span class="p">}</span> <span class="nl">withStubResponse</span><span class="p">:</span><span class="o">^</span><span class="n">OHHTTPStubsResponse</span> <span class="o">*</span><span class="p">(</span><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">OHHTTPStubsResponse</span> <span class="nl">responseWithData</span><span class="p">:</span><span class="n">data</span> <span class="nl">statusCode</span><span class="p">:</span><span class="n">statusCode</span> <span class="nl">headers</span><span class="p">:</span><span class="n">contentTypes</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeAll</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">OHHTTPStubs</span> <span class="n">removeAllStubs</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>

</pre></div></div>

<p>次は実際のテストコードです。<br>
詳細な説明は省きますが、コメントを見てもらえば何をしているかは理解できると思います。<br>
ポイントとしては<code>TRVSMonitor</code>を使ってブロック内の処理が完了するまで待機し、処理が完了したら処理を再開してテストを実行しています。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@implementation</span> <span class="nc">ASBlogManagerTests</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setUp</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">setUp</span><span class="p">];</span>
    <span class="c1">// Put setup code here; it will be run once, before the first test case.</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tearDown</span>
<span class="p">{</span>
    <span class="c1">// Put teardown code here; it will be run once, after the last test case.</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">tearDown</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testFetchBlogsWithCompletionSuccess</span>
<span class="p">{</span>
    <span class="c1">// テストデータの設定</span>
    <span class="p">[</span><span class="n">ASHTTPStubUtil</span> <span class="nl">setupResponseXML</span><span class="p">:</span><span class="s">@"BlogList.txt"</span>
                          <span class="nl">statusCode</span><span class="p">:</span><span class="mi">200</span> <span class="nl">endPoint</span><span class="p">:</span><span class="s">@"http://blog.hatena.ne.jp/-/hotentry/rss"</span><span class="p">];</span>

    <span class="n">ASBlogManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">ASBlogManager</span> <span class="n">sharedManager</span><span class="p">];</span>

    <span class="c1">// Monitorの生成</span>
    <span class="n">TRVSMonitor</span> <span class="o">*</span><span class="n">monitor</span> <span class="o">=</span> <span class="p">[</span><span class="n">TRVSMonitor</span> <span class="n">monitor</span><span class="p">];</span>

    <span class="k">__block</span> <span class="bp">NSArray</span> <span class="o">*</span><span class="n">testResult</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>

    <span class="p">[</span><span class="n">manager</span> <span class="nl">fetchBlogsWithCompletion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">results</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">testResult</span> <span class="o">=</span> <span class="n">results</span><span class="p">;</span>

        <span class="c1">// ブロックの処理が完了したらシグナルを送る</span>
        <span class="p">[</span><span class="n">monitor</span> <span class="n">signal</span><span class="p">];</span>
    <span class="p">}];</span>

    <span class="c1">// シグナルを受け取るまで待機する</span>
    <span class="p">[</span><span class="n">monitor</span> <span class="n">wait</span><span class="p">];</span>

    <span class="c1">// テスト実行</span>
    <span class="n">XCTAssertTrue</span><span class="p">(</span><span class="n">testResult</span><span class="p">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>

    <span class="n">ASBlog</span> <span class="o">*</span><span class="n">blog1</span> <span class="o">=</span> <span class="n">testResult</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">XCTAssertTrue</span><span class="p">([</span><span class="n">blog1</span><span class="p">.</span><span class="n">title</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"タイトル1"</span><span class="p">]);</span>
    <span class="n">XCTAssertTrue</span><span class="p">([</span><span class="n">blog1</span><span class="p">.</span><span class="n">body</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"本文test1"</span><span class="p">]);</span>

    <span class="n">ASBlog</span> <span class="o">*</span><span class="n">blog2</span> <span class="o">=</span> <span class="n">testResult</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">XCTAssertTrue</span><span class="p">([</span><span class="n">blog2</span><span class="p">.</span><span class="n">title</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"タイトル2"</span><span class="p">]);</span>
    <span class="n">XCTAssertTrue</span><span class="p">([</span><span class="n">blog2</span><span class="p">.</span><span class="n">body</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"本文test2"</span><span class="p">]);</span>

    <span class="c1">// テストデータの廃棄</span>
    <span class="p">[</span><span class="n">ASHTTPStubUtil</span> <span class="n">removeAll</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testFetchBlogsWithCompletionFailNotFound</span>
<span class="p">{</span>
    <span class="c1">// テストデータの設定(ステータスコードを404にする)</span>
    <span class="p">[</span><span class="n">ASHTTPStubUtil</span> <span class="nl">setupResponseXML</span><span class="p">:</span><span class="s">@"BlogList.txt"</span>
                          <span class="nl">statusCode</span><span class="p">:</span><span class="mi">404</span> <span class="nl">endPoint</span><span class="p">:</span><span class="s">@"http://blog.hatena.ne.jp/-/hotentry/rss"</span><span class="p">];</span>

    <span class="n">ASBlogManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">ASBlogManager</span> <span class="n">sharedManager</span><span class="p">];</span>

    <span class="c1">// Monitorの生成</span>
    <span class="n">TRVSMonitor</span> <span class="o">*</span><span class="n">monitor</span> <span class="o">=</span> <span class="p">[</span><span class="n">TRVSMonitor</span> <span class="n">monitor</span><span class="p">];</span>

    <span class="k">__block</span> <span class="bp">NSArray</span> <span class="o">*</span><span class="n">testResult</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="k">__block</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">testError</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>

    <span class="p">[</span><span class="n">manager</span> <span class="nl">fetchBlogsWithCompletion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">results</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">testResult</span> <span class="o">=</span> <span class="n">results</span><span class="p">;</span>
        <span class="n">testError</span> <span class="o">=</span> <span class="n">error</span><span class="p">;</span>

        <span class="c1">// ブロックの処理が完了したらシグナルを送る</span>
        <span class="p">[</span><span class="n">monitor</span> <span class="n">signal</span><span class="p">];</span>
    <span class="p">}];</span>

    <span class="c1">// シグナルを受け取るまで待機する</span>
    <span class="p">[</span><span class="n">monitor</span> <span class="n">wait</span><span class="p">];</span>

    <span class="c1">// テスト実行</span>
    <span class="c1">// エラーのためデータが返ってこないことを期待する</span>
    <span class="n">XCTAssertNil</span><span class="p">(</span><span class="n">testResult</span><span class="p">);</span>
    <span class="c1">// エラー情報が含まれることを期待する</span>
    <span class="n">XCTAssertNotNil</span><span class="p">(</span><span class="n">testError</span><span class="p">);</span>

    <span class="c1">// テストデータの廃棄</span>
    <span class="p">[</span><span class="n">ASHTTPStubUtil</span> <span class="n">removeAll</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div></div>

<h2>
<span id="概要-1" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81-1"><i class="fa fa-link"></i></a>概要</h2>

<p>テストデータの切替が容易なので、前回使用した<code>OCMock</code>よりもかなりシンプルなテストコードになりました。<br>
HTTP通信周りの単体テストは<code>OHHTTPStubs</code>を利用することでかなり楽に行える事が分かりました。<br>
XCTestで単体テストを行う際に少しでも参考になれば幸いです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>53</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/5b5a994782db856741e0">XCTestとOCMockを使ってAFNetworking 2.0の単体テストを行う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-05 22:02:44</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p><code>AFNetworking 2.0</code>利用時の単体テストを自動化するためにテストコード書いてみた際のログです。<br>
あまりここら辺の知見がないので、もっとこうした方がいいなどのアドバイス等あれば是非お聞かせください。</p>

<p>やった内容としては、はてなブログの人気エントリーを返すRSSフィードをリクエストし、その結果としXMLが返ってくるので、その部分を<code>OCMock</code>を使ってXMLを返すようにメソッドの結果を書き換えることで単体テストを実現しています。</p>

<p>・はてなブログの人気エントリー<br>
<a href="http://blog.hatena.ne.jp/-/hotentry/rss" class="autolink" rel="nofollow noopener" target="_blank">http://blog.hatena.ne.jp/-/hotentry/rss</a></p>

<h2>
<span id="手順" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>手順</h2>

<p><code>OCMock</code>と<code>AFNetworking</code>のインストールにはCocoaPodsを使用するため<code>Podfile</code>を作成します。<br>
XMLを扱うので<code>kissXML</code>を一緒に入れています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>platform :ios, '7.0'
pod "AFNetworking", "~&gt; 2.0"
pod 'KissXML'
target :BlogProjectTest, :exclusive =&gt; true do
  pod 'OCMock'
end
</pre></div></div>

<p>下記コマンドを実行してインストールしてください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pod install
</pre></div></div>

<p>次にXMLの内容をBlogList.txtファイルに格納します。<br>
中身はこんな感じです。</p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre><span></span><span class="nt">&lt;rss</span> <span class="na">version=</span><span class="s">"2.0"</span> <span class="na">xmlns:dc=</span><span class="s">"http://purl.org/dc/elements/1.1/"</span> <span class="na">xmlns:media=</span><span class="s">"http://search.yahoo.com/mrss"</span><span class="nt">&gt;</span>  <span class="nt">&lt;channel&gt;</span>    <span class="nt">&lt;title&gt;</span>人気エントリー<span class="nt">&lt;/title&gt;</span>      <span class="nt">&lt;item&gt;</span>        <span class="nt">&lt;title&gt;</span>タイトル1<span class="nt">&lt;/title&gt;</span>        <span class="nt">&lt;description&gt;</span>本文test1<span class="nt">&lt;/description&gt;</span>      <span class="nt">&lt;/item&gt;</span>          <span class="nt">&lt;item&gt;</span>        <span class="nt">&lt;title&gt;</span>タイトル2<span class="nt">&lt;/title&gt;</span>        <span class="nt">&lt;description&gt;</span>本文test2<span class="nt">&lt;/description&gt;</span>      <span class="nt">&lt;/item&gt;</span>  <span class="nt">&lt;/channel&gt;&lt;/rss&gt;</span>
</pre></div></div>

<p><code>AFNetworking 2.0</code>を使ってRSSフィードへリクエストを投げる処理はこんな感じで実装しています。<br>
ここでは返却されたXMLをパースして<code>NSDictionary</code>に一旦変換してから更に<code>ASBlog</code>エンティティにパースしています。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#import "ASBlogManager.h"</span>
<span class="cp">#import "AFHTTPRequestOperationManager.h"</span>
<span class="cp">#import "DDXMLDocument.h"</span>
<span class="cp">#import "DDXMLElement+Dictionary.h"</span>
<span class="cp">#import "ASBlog.h"</span>

<span class="k">@implementation</span> <span class="nc">ASBlogManager</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">sharedManager</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">ASBlogManager</span> <span class="o">*</span><span class="n">_sharedManager</span><span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">dispatch_once_t</span> <span class="n">onceToken</span><span class="p">;</span>
    <span class="n">dispatch_once</span><span class="p">(</span><span class="o">&amp;</span><span class="n">onceToken</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
        <span class="n">_sharedManager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ASBlogManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="n">_sharedManager</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">fetchBlogsWithCompletion:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">results</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">block</span>
<span class="p">{</span>
    <span class="n">AFHTTPRequestOperationManager</span><span class="o">*</span> <span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
    <span class="n">manager</span><span class="p">.</span><span class="n">responseSerializer</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPResponseSerializer</span> <span class="n">serializer</span><span class="p">];</span>
    <span class="k">__weak</span> <span class="k">typeof</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="n">weakSelf</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>

    <span class="p">[</span><span class="n">manager</span> <span class="nl">GET</span><span class="p">:</span><span class="s">@"http://blog.hatena.ne.jp/-/hotentry/rss"</span>
      <span class="nl">parameters</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>

          <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">xml</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
          <span class="bp">NSError</span> <span class="o">*</span><span class="n">parseError</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
          <span class="n">DDXMLDocument</span> <span class="o">*</span><span class="n">doc</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DDXMLDocument</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithData</span><span class="p">:</span><span class="n">responseObject</span> <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">parseError</span><span class="p">];</span>

          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">parseError</span><span class="p">)</span> <span class="p">{</span>
              <span class="c1">// 取得したXMLの内容をNSDictionaryに変換する</span>
              <span class="n">xml</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">.</span><span class="n">rootElement</span> <span class="n">convertDictionary</span><span class="p">];</span>
              <span class="c1">// ブログ情報の配列を取得する</span>
              <span class="bp">NSArray</span> <span class="o">*</span><span class="n">blogsJSON</span> <span class="o">=</span> <span class="n">xml</span><span class="p">[</span><span class="s">@"rss"</span><span class="p">][</span><span class="s">@"channel"</span><span class="p">][</span><span class="s">@"item"</span><span class="p">];</span>

              <span class="c1">// ブログ情報(NSDictionary)の内容をASBlogエンティティにパースして渡す</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="n">block</span><span class="p">([</span><span class="n">weakSelf</span> <span class="nl">parseBlogs</span><span class="p">:</span><span class="n">blogsJSON</span><span class="p">],</span> <span class="nb">nil</span><span class="p">);</span>

          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="n">block</span><span class="p">(</span><span class="nb">nil</span><span class="p">,</span> <span class="n">parseError</span><span class="p">);</span>
          <span class="p">}</span>

      <span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="n">block</span><span class="p">(</span><span class="nb">nil</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
      <span class="p">}];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">parseBlogs:</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">blogs</span>
<span class="p">{</span>
    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">mutableBlogs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>

    <span class="p">[</span><span class="n">blogs</span> <span class="nl">enumerateObjectsUsingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="n">NSUInteger</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span><span class="n">stop</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ASBlog</span> <span class="o">*</span><span class="n">blog</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ASBlog</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithJSONDictionary</span><span class="p">:</span><span class="n">obj</span><span class="p">];</span>
        <span class="p">[</span><span class="n">mutableBlogs</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">blog</span><span class="p">];</span>
    <span class="p">}];</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">mutableBlogs</span> <span class="k">copy</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div></div>

<p>下記は<code>ASBlog</code>エンティティの内容です。<br>
初期化時に引数の<code>NSDictionary</code>の内容を各プロパティに反映しています。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">@interface</span> <span class="nc">ASBlog</span> : <span class="bp">NSObject</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">title</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">body</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">initWithJSONDictionary:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">json</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ASBlog</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">initWithJSONDictionary:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">json</span>
<span class="p">{</span>
    <span class="nb">self</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="n">init</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// title</span>
        <span class="bp">NSString</span> <span class="o">*</span><span class="n">title</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">@"title"</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">title</span> <span class="nl">isKindOfClass</span><span class="p">:[</span><span class="bp">NSString</span> <span class="k">class</span><span class="p">]])</span> <span class="p">{</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// body</span>
        <span class="bp">NSString</span> <span class="o">*</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">@"description"</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">body</span> <span class="nl">isKindOfClass</span><span class="p">:[</span><span class="bp">NSString</span> <span class="k">class</span><span class="p">]])</span> <span class="p">{</span>
            <span class="nb">self</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></div>

<p>下記が実際のテストコードです。<br>
テストケースはJSON内の各項目と期待値が一致するかで判定しています。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="cp">#import &lt;XCTest/XCTest.h&gt;</span>
<span class="cp">#import "AFHTTPRequestOperationManager.h"</span>
<span class="cp">#import "ASBlogManager.h"</span>
<span class="cp">#import "ASBlog.h"</span>
<span class="c1">// Test support</span>
<span class="cp">#import &lt;OCMock/OCMock.h&gt;</span>

<span class="k">@interface</span> <span class="nc">ASBlogManagerTests</span> : <span class="nc">XCTestCase</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ASBlogManagerTests</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setUp</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">setUp</span><span class="p">];</span>
    <span class="c1">// Put setup code here; it will be run once, before the first test case.</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tearDown</span>
<span class="p">{</span>
    <span class="c1">// Put teardown code here; it will be run once, after the last test case.</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">tearDown</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">testFetchBlogsWithCompletionSuccess</span>
<span class="p">{</span>
    <span class="n">AFHTTPRequestOperationManager</span><span class="o">*</span> <span class="n">operationManager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
    <span class="c1">// Mockを生成</span>
    <span class="kt">id</span> <span class="n">mockOperationManager</span> <span class="o">=</span> <span class="p">[</span><span class="n">OCMockObject</span> <span class="nl">partialMockForObject</span><span class="p">:</span><span class="n">operationManager</span><span class="p">];</span>
    <span class="c1">// [AFHTTPRequestOperationManager manager]の呼び出しでmockOperationManagerを返すようにする</span>
    <span class="p">[[[</span><span class="n">mockOperationManager</span> <span class="n">stub</span><span class="p">]</span> <span class="nl">andReturn</span><span class="p">:</span><span class="n">mockOperationManager</span><span class="p">]</span> <span class="n">manager</span><span class="p">];</span>

    <span class="p">[[</span><span class="n">mockOperationManager</span> <span class="n">expect</span><span class="p">]</span>
     <span class="nl">GET</span><span class="p">:</span><span class="s">@"http://blog.hatena.ne.jp/-/hotentry/rss"</span> <span class="nl">parameters</span><span class="p">:</span><span class="nb">nil</span>
     <span class="nl">success</span><span class="p">:[</span><span class="n">OCMArg</span> <span class="nl">checkWithBlock</span><span class="p">:</span><span class="o">^</span><span class="kt">BOOL</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="n">successBlock</span><span class="p">)(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="p">,</span> <span class="kt">id</span><span class="p">))</span>
              <span class="p">{</span>
                  <span class="c1">// テストケースクラスが置かれている場所のNSBundleを取得</span>
                  <span class="bp">NSBundle</span> <span class="o">*</span><span class="n">bundle</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSBundle</span> <span class="nl">bundleForClass</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="k">class</span><span class="p">];</span>
                  <span class="c1">// テストデータファイルのパス</span>
                  <span class="bp">NSString</span> <span class="o">*</span><span class="n">testDataPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">bundle</span> <span class="nl">pathForResource</span><span class="p">:</span><span class="s">@"BlogList"</span> <span class="nl">ofType</span><span class="p">:</span><span class="s">@"txt"</span><span class="p">];</span>
                  <span class="c1">// reponseObjectにテストデータを設定</span>
                  <span class="bp">NSData</span> <span class="o">*</span><span class="n">responseObject</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfFile</span><span class="p">:</span><span class="n">testDataPath</span><span class="p">];</span>

                  <span class="n">successBlock</span><span class="p">(</span><span class="nb">nil</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>

                  <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
              <span class="p">}]</span>
     <span class="nl">failure</span><span class="p">:</span><span class="n">OCMOCK_ANY</span><span class="p">];</span>

    <span class="c1">// テスト実行</span>
    <span class="n">ASBlogManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">ASBlogManager</span> <span class="n">sharedManager</span><span class="p">];</span>

    <span class="p">[</span><span class="n">manager</span> <span class="nl">fetchBlogsWithCompletion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">results</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">XCTAssertTrue</span><span class="p">(</span><span class="n">results</span><span class="p">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>

        <span class="n">ASBlog</span> <span class="o">*</span><span class="n">blog1</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">XCTAssertTrue</span><span class="p">([</span><span class="n">blog1</span><span class="p">.</span><span class="n">title</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"タイトル1"</span><span class="p">]);</span>
        <span class="n">XCTAssertTrue</span><span class="p">([</span><span class="n">blog1</span><span class="p">.</span><span class="n">body</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"本文test1"</span><span class="p">]);</span>

        <span class="n">ASBlog</span> <span class="o">*</span><span class="n">blog2</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">XCTAssertTrue</span><span class="p">([</span><span class="n">blog2</span><span class="p">.</span><span class="n">title</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"タイトル2"</span><span class="p">]);</span>
        <span class="n">XCTAssertTrue</span><span class="p">([</span><span class="n">blog2</span><span class="p">.</span><span class="n">body</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"本文test2"</span><span class="p">]);</span>
    <span class="p">}];</span>

    <span class="p">[</span><span class="n">mockOperationManager</span> <span class="n">verify</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div></div>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>今回は<code>OCMock</code>を使う事で単体テストを行いました。<br>
同様に<a href="https://github.com/AliSoftware/OHHTTPStubs" rel="nofollow noopener" target="_blank">OHHTTPStubs</a>を利用することでも単体テストを実施できそうですが、それは今後チャレンジする予定です。<br>
テストフレームワークに関するよりよい情報などありましたら是非お知らせください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>53</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/3c582d4073fa67ca599a">ドコモの「しゃべってコンシェル」や Appleの「Siri」のようなサービスが誰でも作れる！？ドコモが提供する「雑談対話」APIを試してみた！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-19 00:58:54</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="今回作ったアプリのイメージ" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>今回作ったアプリのイメージ</h2>

<p>アプリのスクリーンショットです。</p>

<p><a href="https://camo.qiitausercontent.com/fdfa79490e7a7eb5762c1cc4ca8d827fa7cd756b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f38396135633434322d363035352d323536302d623431612d6333666437643666643131622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/fdfa79490e7a7eb5762c1cc4ca8d827fa7cd756b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f38396135633434322d363035352d323536302d623431612d6333666437643666643131622e706e67" alt="screenshot_chat.png" title="screenshot_chat.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/89a5c442-6055-2560-b41a-c3fd7d6fd11b.png"></a></p>

<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>現在ドコモが提供している音声・会話関連のAPIには以下のものがあります。</p>

<p>・音声認識(Androidのみ対応)<br>
・雑談対話<br>
・知識Q&amp;A</p>

<p>せっかくこんなサービスが無料で使えるんで、<br>
今回は上記の中から「雑談対話」APIを利用したチャット風アプリを開発してみましたので紹介します。<br>
「音声認識」APIも使ってユーザーの声でそのままやり取りできるようにしたかったのですが、<br>
Androidしかサポートしていないためこちらは諦めました・・・。<br>
代わりにキーボードからSiriを呼び出し音声をテキストに変換してもらうことでご容赦ください。</p>

<p>また「知識Q&amp;A」APIは申請後に審査があるため今回は対象から外しています。<br>
審査が通ったら紹介するかもです。</p>

<p>まずAPIを使用するためにはユーザー登録とアプリ情報の登録が必要になるので下記URLから登録作業を行ってください。</p>

<p><a href="http://dev.smt.docomo.ne.jp/?p=index" class="autolink" rel="nofollow noopener" target="_blank">http://dev.smt.docomo.ne.jp/?p=index</a></p>

<p>「雑談対話」APIリファレンスのURLは下記になります。</p>

<p><a href="http://dev.smt.docomo.ne.jp/?p=docs.api.zatsudan.reference.detail01" class="autolink" rel="nofollow noopener" target="_blank">http://dev.smt.docomo.ne.jp/?p=docs.api.zatsudan.reference.detail01</a></p>

<p>APIをPOSTで呼び出すとレスポンスがjson形式で返却されます。<br>
パラメータはAPI_KEYとユーザの発話をテキストで付与するだけで使えます。</p>

<p>チャット風な画面をサクッと作るため<a href="https://github.com/jessesquires/MessagesTableViewController" rel="nofollow noopener" target="_blank">JSMessagesViewController for iOS</a>というライブラリを使用しました。<br>
MITライセンスで無料なので安心して使ってください。</p>

<h2>
<span id="導入手順" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>導入手順</h2>

<p>APIをPOSTでリクエストするので「雑談対話」API専用に用意するものはありません。<br>
代わりにAPIとやり取りするために<code>AFNetworking 2.0</code>と<code>JSMessagesViewController for iOS</code>を導入します。</p>

<p>導入にはCocoaPodsを利用しましょう。<br>
まず適当な名前でプロジェクトを作り<br>
プロジェクトのルート配下のディレクトリに下記のPodfileを作成します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>platform :ios, '6.0'pod "AFNetworking", "~&gt; 2.0"pod 'JSMessagesViewController', '~&gt; 3.4.0'
</pre></div></div>

<p>次にコンソールから下記コマンドを実行してインストールします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pod install
</pre></div></div>

<h2>
<span id="apiの使い方" class="fragment"></span><a href="#api%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>APIの使い方</h2>

<p>ここではAFNetworkingを利用してAPIをリクエストします。</p>

<div class="code-frame" data-lang="リクエストURL"><div class="highlight"><pre><span></span>https://api.apigw.smt.docomo.ne.jp/dialogue/v1/dialogue?APIKEY=xxxxxxxx
</pre></div></div>

<p>パラメータの詳細はリファレンスを参照するとして、<br>
ここでは下記二つのパラメータのみ使用します。</p>

<div class="code-frame" data-lang="パラメータの例"><div class="highlight"><pre><span></span>{
 　"utt":"こんにちは",
 　"context":"aaabbbccc111222333"
}
</pre></div></div>

<p>パラメータはjson形式で設定してください。</p>

<p><code>AFNetworking</code>を使えば簡単に実装できます。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span>
<span class="k">static</span> <span class="k">const</span> <span class="bp">NSString</span> <span class="o">*</span> <span class="n">API_KEY</span> <span class="o">=</span> <span class="p">@</span><span class="err">“</span><span class="n">xxxxxxx</span><span class="err">”</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">fetchChatRequest:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">comment</span> <span class="nf">context:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">context</span> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span> <span class="nv">completionHandler</span>
<span class="p">{</span>
    <span class="n">AFHTTPRequestOperationManager</span><span class="o">*</span> <span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
    <span class="n">manager</span><span class="p">.</span><span class="n">requestSerializer</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFJSONRequestSerializer</span> <span class="n">serializer</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">context</span><span class="p">)</span> <span class="n">context</span> <span class="o">=</span> <span class="s">@""</span><span class="p">;</span>

    <span class="c1">// パラメータの設定</span>
    <span class="bp">NSDictionary</span><span class="o">*</span> <span class="n">param</span> <span class="o">=</span> <span class="l">@{</span><span class="s">@"utt"</span> <span class="o">:</span> <span class="n">comment</span><span class="p">,</span> <span class="s">@"context"</span> <span class="o">:</span> <span class="n">context</span><span class="l">}</span><span class="p">;</span>
    <span class="p">[</span><span class="n">manager</span> <span class="nl">POST</span><span class="p">:[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span>
                   <span class="s">@"https://api.apigw.smt.docomo.ne.jp/dialogue/v1/dialogue?APIKEY=%@"</span><span class="p">,</span> <span class="n">API_KEY</span><span class="p">]</span>
       <span class="nl">parameters</span><span class="p">:</span><span class="n">param</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"response: %@"</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">completionHandler</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">completionHandler</span><span class="p">(</span><span class="n">responseObject</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error: %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">completionHandler</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">completionHandler</span><span class="p">(</span><span class="nb">nil</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>

</pre></div></div>

<p>リクエストが成功すると下記のようなjson形式のレスポンスが返却されます。</p>

<div class="code-frame" data-lang="レスポンスサンプル"><div class="highlight"><pre><span></span>{
　"utt":"こんにちは",
　"yomi":"こんにちは",
　"mode":"dialog",
　"da":"0",
　"context":"aaabbbccc111222333",
}
</pre></div></div>

<p>あとは結果をパースして画面に表示します。</p>

<h2>
<span id="結論" class="fragment"></span><a href="#%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>結論</h2>

<p>細かい説明も書こうと思いましたが、長くなりそうなので<br>
やめておきますw<br>
興味がある方は作成したサンプルのソースコードを下記にアップしてますのでダウンロードしてみてください。</p>

<p><a href="https://github.com/asakahara/ASAppLikeSiri" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/asakahara/ASAppLikeSiri</a></p>

<p>改善の余地はまだまだあって「知識Q&amp;A」APIを組み合わせるともっとおもしろい事ができそうです。</p>

<p>Siriに飽きた方は是非こいつと会話してみることをオススメしますw</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>48</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/ad2216b3d44964a743f0">最速ではてなブログリーダー・アプリを作る！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-18 19:18:46</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>この内容は始めたばかりの<a href="http://sakahara.hatenablog.jp/" rel="nofollow noopener" target="_blank">個人ブログ</a>に掲載したのですが、さすがにまだ何も反応がないのでQiitaにも掲載しておくことにしました。</p>

<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p>はてなブログには人気エントリーを返すRSSフィードがあるので人気エントリーを表示するアプリを勉強がてらに作ってみました。<br>
Core Data に取得した人気エントリーを保存してるのでオフラインでもみれます。<br>
(ただこのアプリ、表示できるのは人気エントリーの一覧だけです・・・)</p>

<p><a href="http://blog.hatena.ne.jp/-/hotentry/rss" class="autolink" rel="nofollow noopener" target="_blank">http://blog.hatena.ne.jp/-/hotentry/rss</a></p>

<p>Xcode5から使いやすくなったAuto LayoutやXCTestなどあまりキャッチアップできていなかった部分の勉強や単体テストをちゃんと書くという目的があったのですが、作りっぱなしでは面白くないのでソースコードも公開しています。</p>

<p><a href="https://github.com/asakahara/ASHatenaBlogReader" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/asakahara/ASHatenaBlogReader</a></p>

<h2>
<span id="スクリーンショット" class="fragment"></span><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>スクリーンショット</h2>

<p>・ブログ一覧画面(縦) <br>
<a href="https://camo.qiitausercontent.com/4f948d1ad9091853222b4f2d7610d7aebffddce8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f32353033366630352d613537622d303365382d383164392d6531363162343833623937622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/4f948d1ad9091853222b4f2d7610d7aebffddce8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f32353033366630352d613537622d303365382d383164392d6531363162343833623937622e706e67" alt="blogScreenshot1.png" title="blogScreenshot1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/25036f05-a57b-03e8-81d9-e161b483b97b.png"></a></p>

<p>・ブログ詳細画面(縦)<br>
<a href="https://camo.qiitausercontent.com/718fd7674295d54ae72a10cc81f9e10657480aae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f32613630633964302d613436372d373165302d653464322d3739386162363438656565662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/718fd7674295d54ae72a10cc81f9e10657480aae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f32613630633964302d613436372d373165302d653464322d3739386162363438656565662e706e67" alt="blogScreenshot2.png" title="blogScreenshot2.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/2a60c9d0-a467-71e0-e4d2-798ab648eeef.png"></a></p>

<p>・ブログ一覧画面(横)<br>
<a href="https://camo.qiitausercontent.com/1adf07f3b0a724d8ccfdb3e595d3374bfd619ddd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f32353034383339382d316564652d353437362d316532662d6539623266396332643934302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/1adf07f3b0a724d8ccfdb3e595d3374bfd619ddd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f32353034383339382d316564652d353437362d316532662d6539623266396332643934302e706e67" alt="blogScreenshot3.png" title="blogScreenshot3.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/25048398-1ede-5476-1e2f-e9b2f9c2d940.png"></a></p>

<p>・ブログ詳細画面(横)<br>
<a href="https://camo.qiitausercontent.com/c8c09a4b235013439f34096f6d5b546796942f16/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f30616139323334382d313334662d663439362d653236352d3338626662383265363334372e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c8c09a4b235013439f34096f6d5b546796942f16/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f30616139323334382d313334662d663439362d653236352d3338626662383265363334372e706e67" alt="blogScreenshot4.png" title="blogScreenshot4.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/0aa92348-134f-f496-e265-38bfb82e6347.png"></a></p>

<h2>
<span id="開発後の感想" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E5%BE%8C%E3%81%AE%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>開発後の感想</h2>

<p>Auto Layoutは正直かなりよかったです！<br>
これまで<code>UILabel</code>の高さを可変にする表示は<code>NSString:sizeWithFont:constrainedToSize:lineBreakMode:</code>を使って毎回計算してました。<br>
Auto Layoutの使う場合、制約の設定さえちゃんとしておけば<code>UILabel</code>の高さ調整は勝手にやってくれます。<br>
(もっと早く知っておきたかった・・・)<br>
勝手にやってくれるんで <code>sizeToFit</code>などのメソッドをプログラムから呼び出さないようにしましょう。<br>
ただ一つ問題として横画面にも対応させたのですが、縦から横画面へした際にStoryBoardから設定した制約だけでは<code>UILabel</code>の横幅の制御がどうもうまくいきません。<br>
仕方なくUILabel.preferredMaxLayoutWidthを横画面のサイズに併せて変更かけることで対応しています。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">updateLabelPreferredMaxLayoutWidthToCurrentWidth:</span><span class="p">(</span><span class="bp">UILabel</span> <span class="o">*</span><span class="p">)</span><span class="nv">label</span>
<span class="p">{</span>
    <span class="n">label</span><span class="p">.</span><span class="n">preferredMaxLayoutWidth</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="nl">alignmentRectForFrame</span><span class="p">:</span><span class="n">label</span><span class="p">.</span><span class="n">frame</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLayoutSubviews</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLayoutSubviews</span><span class="p">];</span>

    <span class="c1">// 横画面にした際にラベルの横幅が縦画面のサイズのままになってしまうため、</span>
    <span class="c1">// preferredMaxLayoutWidthを画面サイズに併せて調整する</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">updateLabelPreferredMaxLayoutWidthToCurrentWidth</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">bodyLabel</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">updateLabelPreferredMaxLayoutWidthToCurrentWidth</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">titleLabel</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="n">layoutSubviews</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>その他にもCore Data用に初めて使ったMagicalRecordは思った以上に便利でした。<br>
特にマルチスレッドでCore Dataを扱う部分をかなり楽にしてくれます。<br>
MagicalRecordのドキュメントにあったサンプルを見てもらえば納得してもらえると思います。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="n">Person</span> <span class="o">*</span><span class="n">person</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">[</span><span class="n">MagicalRecord</span> <span class="nl">saveInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSManagedObjectContext</span> <span class="o">*</span><span class="n">localContext</span><span class="p">){</span>

    <span class="n">Person</span> <span class="o">*</span><span class="n">localPerson</span> <span class="o">=</span> <span class="p">[</span><span class="n">person</span> <span class="nl">MR_inContext</span><span class="p">:</span><span class="n">localContext</span><span class="p">];</span>

    <span class="n">localPerson</span><span class="p">.</span><span class="n">firstName</span> <span class="o">=</span> <span class="s">@"John"</span><span class="p">;</span>
    <span class="n">localPerson</span><span class="p">.</span><span class="n">lastName</span> <span class="o">=</span> <span class="s">@"Appleseed"</span><span class="p">;</span>

<span class="p">}</span> <span class="nl">completion</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>

    <span class="nb">self</span><span class="p">.</span><span class="n">everyoneInTheDepartment</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span> <span class="n">findAll</span><span class="p">];</span>

<span class="p">}];</span>
</pre></div></div>

<p>ブロック内に書いた処理を全て別スレッドで処理を行い、完了ブロックはメインスレッドで動作します。</p>

<p>あと単体テストはXCTestを使って最低限のモデルのテスト書いてます。<br>
HTTP通信周りはOHHTTPStubs使ってやってます。</p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>細かい説明を書く余裕がないので興味がある方はGitHubからソースを落として試してみてください。</p>

<p><a href="https://github.com/asakahara/ASHatenaBlogReader" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/asakahara/ASHatenaBlogReader</a></p>

<p>今回は<a href="https://github.com/hatena/Hatena-Textbook/blob/master/ios-app-development-with-web-api.md" rel="nofollow noopener" target="_blank">はてな教科書</a>を参考にしながら開発してみました。<br>
とても充実した内容で初心者向けのようですが中級者以上の方でも参考になる部分はあると思います。</p>

<p>ご意見や改善点などありましたら是非お聞かせください！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>33</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/bb256de6e8cec9784dff">ドコモの「しゃべってコンシェル」や Appleの「Siri」のようなサービスが誰でも作れる！？今度はドコモが提供する「知識Q&amp;A」APIを試してみた！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-22 00:00:55</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="概要" class="fragment"></span><a href="#%E6%A6%82%E8%A6%81"><i class="fa fa-link"></i></a>概要</h2>

<p><a href="http://qiita.com/asakahara/items/3c582d4073fa67ca599a" id="reference-23fae511db9e388213e6">前回の記事</a>では「雑談対話」APIの利用方法を紹介しました。<br>
同じタイミングで「知識Q&amp;A」APIの利用申請をしたのですが、<br>
特に連絡もないまま気づいたときには利用できるようになっていたのでご紹介します。<br>
ちなみに「知識Q&amp;A」APIは質問文をテキストで受け付け、回答を返却するAPIです。<br>
サイトには「質問は話しかけるような自然な文章を入力できます。回答はズバリの回答候補を返却します。」という説明がありますが、ズバリな回答が返ってくることは中々ないので、辛抱強く聞いてあげてくださいw</p>

<p>このAPIに加え今回は<code>AVSpeechSynthesizer</code>, <code>AVSpeechUtterance</code>を使用したテキストの読み上げ機能を追加することでよりSiriっぽくしたいと思います。</p>

<h2>
<span id="今回作ったアプリのイメージ" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>今回作ったアプリのイメージ</h2>

<p>アプリのスクリーンショットです。</p>

<p><a href="https://camo.qiitausercontent.com/cc32bdf396da9695640c93260113428a0cd2c2d3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f35663131653333642d363130352d363365392d663431642d3838633264656637656536622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/cc32bdf396da9695640c93260113428a0cd2c2d3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f35663131653333642d363130352d363365392d663431642d3838633264656637656536622e706e67" alt="screenshot.png" title="screenshot.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/5f11e33d-6105-63e9-f41d-88c2def7ee6b.png"></a></p>

<h2>
<span id="導入手順" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>導入手順</h2>

<p>ライブラリの導入については<a href="http://qiita.com/asakahara/items/3c582d4073fa67ca599a">前回の記事</a>を参照してください。</p>

<p>追加の手順として音声の読み上げ機能を使用するために<code>AVFoundation.framework</code>をターゲットに追加します。</p>

<h2>
<span id="apiの使い方" class="fragment"></span><a href="#api%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>APIの使い方</h2>

<p>ここも前回と同様にAFNetworkingを利用しますが、今回はPOSTではなくGETでリクエストします。</p>

<div class="code-frame" data-lang="リクエストURL"><div class="highlight"><pre><span></span>https://api.apigw.smt.docomo.ne.jp/knowledgeQA/v1/ask/?APIKEY=xxxxxxxx
</pre></div></div>

<p>qパラメータに「○○は誰」「○○は何ですか」といった、自然な文章をテキストで入力してください。<br>
リクエスト時は、リクエストURLをUTF-8でエンコードする必要がありますが、<code>AFNetworking</code>を使用している場合は自動でエンコードしてくれます。</p>

<div class="code-frame" data-lang="パラメータの例"><div class="highlight"><pre><span></span>{
 　"q":"明日の東京の天気は何ですか？",
}
</pre></div></div>

<p><code>AFNetworking</code>での実装例です。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">const</span> <span class="bp">NSString</span> <span class="o">*</span> <span class="n">API_KEY</span> <span class="o">=</span> <span class="p">@</span><span class="err">“</span><span class="n">xxxxxxx</span><span class="err">”</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">fetchQARequest:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">question</span> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span> <span class="nv">completionHandler</span>
<span class="p">{</span>
    <span class="n">AFHTTPRequestOperationManager</span><span class="o">*</span> <span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>

    <span class="c1">// パラメータの設定</span>
    <span class="bp">NSDictionary</span><span class="o">*</span> <span class="n">param</span> <span class="o">=</span> <span class="l">@{</span><span class="s">@"q"</span> <span class="o">:</span> <span class="n">question</span><span class="l">}</span><span class="p">;</span>
    <span class="p">[</span><span class="n">manager</span> <span class="nl">GET</span><span class="p">:[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span>
                   <span class="s">@"https://api.apigw.smt.docomo.ne.jp/knowledgeQA/v1/ask/?APIKEY=%@"</span><span class="p">,</span> <span class="n">API_KEY</span><span class="p">]</span>
        <span class="nl">parameters</span><span class="p">:</span><span class="n">param</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"response: %@"</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">completionHandler</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">completionHandler</span><span class="p">(</span><span class="n">responseObject</span><span class="p">,</span> <span class="nb">nil</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error: %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">completionHandler</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">completionHandler</span><span class="p">(</span><span class="nb">nil</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>
</pre></div></div>

<p>リクエストが成功すると下記のようなjson形式のレスポンスが返却されます。</p>

<div class="code-frame" data-lang="レスポンスサンプル"><div class="highlight"><pre><span></span>{
　{"code":"S020010","message":{"textForDisplay":"インターネットで調べたところ、もしかすると晴時々曇です。","textForSpeech":"インターネットで調べたところ、もしかするとハレトキドキクモリです。"},"answers":[{"rank":"1","answerText":"晴時々曇","linkText":"リアルタイム検索｜dメニュー","linkUrl":"http://realtime.search.smt.docomo.ne.jp/knfnt.html?IE=UTF-8&amp;id_list=414032698269638656&amp;kw=%E6%98%8E%E6%97%A5%20%E6%9D%B1%E4%BA%AC%20%E5%A4%A9%E6%B0%97"},{"rank":"2","answerText":"西高東低","linkText":"リアルタイム検索｜dメニュー","linkUrl":"http://realtime.search.smt.docomo.ne.jp/knfnt.html?IE=UTF-8&amp;id_list=414379070420299777&amp;kw=%E6%98%8E%E6%97%A5%20%E6%9D%B1%E4%BA%AC%20%E5%A4%A9%E6%B0%97"},{"rank":"3","answerText":"晴","linkText":"リアルタイム検索｜dメニュー","linkUrl":"http://realtime.search.smt.docomo.ne.jp/knfnt.html?IE=UTF-8&amp;id_list=414304487646322688&amp;kw=%E6%98%8E%E6%97%A5%20%E6%9D%B1%E4%BA%AC%20%E5%A4%A9%E6%B0%97"},{"rank":"4","answerText":"曇","linkText":"リアルタイム検索｜dメニュー","linkUrl":"http://realtime.search.smt.docomo.ne.jp/knfnt.html?IE=UTF-8&amp;id_list=414304487646322688&amp;kw=%E6%98%8E%E6%97%A5%20%E6%9D%B1%E4%BA%AC%20%E5%A4%A9%E6%B0%97"},{"rank":"5","answerText":"雲","linkText":"リアルタイム検索｜dメニュー","linkUrl":"http://realtime.search.smt.docomo.ne.jp/knfnt.html?IE=UTF-8&amp;id_list=414058749746110464&amp;kw=%E6%98%8E%E6%97%A5%20%E6%9D%B1%E4%BA%AC%20%E5%A4%A9%E6%B0%97"}]}
}
</pre></div></div>

<h3>
<span id="テキストの読み上げ方法" class="fragment"></span><a href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%AE%E8%AA%AD%E3%81%BF%E4%B8%8A%E3%81%92%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>テキストの読み上げ方法</h3>

<p>テキストの読み上げは非常に簡単です。<br>
テキストの読み上げを行いたいソースコードに<code>AVFoundation/AVFoundation.h</code> をインポートします。<br>
あとは下記のように<code>AVSpeechSynthesizer</code>, <code>AVSpeechUtterance</code>を使用して実装してください。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">// AVSpeechSynthesizerの初期化</span>
<span class="bp">AVSpeechSynthesizer</span> <span class="o">*</span><span class="n">synthesizer</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">AVSpeechSynthesizer</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
<span class="c1">// 読み上げるテキストの設定</span>
<span class="bp">AVSpeechUtterance</span> <span class="o">*</span><span class="n">utterance</span> <span class="o">=</span> <span class="p">[</span><span class="bp">AVSpeechUtterance</span> <span class="nl">speechUtteranceWithString</span><span class="p">:</span><span class="n">message</span><span class="p">];</span>
<span class="c1">// 読み上げる言語の設定</span>
<span class="n">utterance</span><span class="p">.</span><span class="n">voice</span> <span class="o">=</span> <span class="p">[</span><span class="bp">AVSpeechSynthesisVoice</span> <span class="nl">voiceWithLanguage</span><span class="p">:</span><span class="s">@"ja-JP"</span><span class="p">];</span>
<span class="c1">// 声の高さを設定（0.5〜2.0）</span>
<span class="n">utterance</span><span class="p">.</span><span class="n">pitchMultiplier</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="c1">// 読み上げ開始</span>
<span class="p">[</span><span class="n">synthesizer</span> <span class="nl">speakUtterance</span><span class="p">:</span><span class="n">utterance</span><span class="p">];</span>
</pre></div></div>

<h2>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h2>

<p>テキストを読み上げるようにすることでよりSiriっぽくなったのではないかと思います。<br>
いろいろ可能性を感じる機能なので、ぜひトライしておもしろいアプリ作りの参考にされてみてはと思います。</p>

<p>今回作成したサンプルのソースコードもアップしておきます。</p>

<p><a href="https://github.com/asakahara/ASAppLikeSiri2" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/asakahara/ASAppLikeSiri2</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>32</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/33e362f0df4868ebf5bd">最速ではてなフォトライフ・ビューワを作る!</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-09 19:56:56</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[Xcode]</b> <b>[iOS]</b> <b>[はてなフォトライフ]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>最近画像ビューワを作ることにハマってまして、iPhoneアプリではてなフォトライフを使ったものがあまり無いことに気づき、サンプルを作成してみました。</p>

<p><a href="https://camo.qiitausercontent.com/5de4f50940882673df647c099a6cdcf330710c5e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f61633635366466322d643538342d633162382d376230322d3939626433303333396663352e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/5de4f50940882673df647c099a6cdcf330710c5e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f61633635366466322d643538342d633162382d376230322d3939626433303333396663352e706e67" alt="screenshot1.png" title="screenshot1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/ac656df2-d584-c1b8-7b02-99bd30339fc5.png"></a></p>

<p>人気写真、新着写真はRSSで公開されているので認証とかせず、すぐ試せます。</p>

<p>・人気写真<br>
<a href="http://f.hatena.ne.jp/hotfoto?mode=rss" class="autolink" rel="nofollow noopener" target="_blank">http://f.hatena.ne.jp/hotfoto?mode=rss</a></p>

<p>・新着写真<br>
<a href="http://f.hatena.ne.jp/userlist?mode=rss" class="autolink" rel="nofollow noopener" target="_blank">http://f.hatena.ne.jp/userlist?mode=rss</a></p>

<p>RSSですのでXMLの読み込みにはKissXMLを使用しました。<br>
下記から落とせます。<br>
<a href="https://github.com/robbiehanson/KissXML" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/robbiehanson/KissXML</a></p>

<p>HTTP通信にはGTMHttpFetcherを使ってみました。<br>
下記からSVNでソースコードをチェックアウトしてください。<br>
<a href="http://code.google.com/p/gtm-http-fetcher/" class="autolink" rel="nofollow noopener" target="_blank">http://code.google.com/p/gtm-http-fetcher/</a></p>

<p>ではそのKissXMLとGtmHttpFetcherを使って人気写真を取得します。<br>
取得したRSSの結果を使いやすいようにNSDictionaryに変換するまでが基本的な流れとなります。</p>

<p>ではまず最初にASPhotoListFetcherクラス(名前は別に何でもいいです)を作成してその何に下記メソッドを追加します。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">beginFetchPopularPhotoList:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span> <span class="nv">completionHandler</span> <span class="p">{</span>

    <span class="bp">NSMutableURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span>
                                    <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@"http://f.hatena.ne.jp/hotfoto?mode=rss"</span><span class="p">]</span>
                                                           <span class="nl">cachePolicy</span><span class="p">:</span><span class="n">NSURLRequestReloadIgnoringLocalCacheData</span> <span class="nl">timeoutInterval</span><span class="p">:</span><span class="mi">60</span><span class="p">];</span>

    <span class="c1">// この設定が無いとProxyサーバのキャッシュの結果が返ってくるみたい・・・</span>
    <span class="p">[</span><span class="n">request</span> <span class="nl">addValue</span><span class="p">:</span><span class="s">@"no-cache"</span> <span class="nl">forHTTPHeaderField</span><span class="p">:</span><span class="s">@"Cache-Control"</span><span class="p">];</span>

    <span class="n">GTMHTTPFetcher</span><span class="o">*</span> <span class="n">fetcher</span> <span class="o">=</span> <span class="p">[</span><span class="n">GTMHTTPFetcher</span> <span class="nl">fetcherWithRequest</span><span class="p">:</span><span class="n">request</span><span class="p">];</span>

    <span class="p">[</span><span class="n">fetcher</span> <span class="nl">beginFetchWithCompletionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">xml</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">DDXMLDocument</span> <span class="o">*</span><span class="n">doc</span> <span class="o">=</span> <span class="p">[[</span><span class="n">DDXMLDocument</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithData</span><span class="p">:</span><span class="n">data</span> <span class="nl">options</span><span class="p">:</span><span class="mi">0</span> <span class="nl">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">xml</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">.</span><span class="n">rootElement</span> <span class="n">convertDictionary</span><span class="p">];</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@ %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">error</span> <span class="n">localizedDescription</span><span class="p">],</span> <span class="p">[</span><span class="n">error</span> <span class="n">userInfo</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">completionHandler</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">completionHandler</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>
</pre></div></div>

<p>上記で人気写真のRSS取得結果をconvertDictionary メソッドを使ってNSDictionaryに変換してます。</p>

<p>XMLの結果を解析してNSDictionaryに変換するのは下記を参考にしました。<br>
<a href="http://dev.classmethod.jp/smartphone/iphone/ios-xml-parse-2/" class="autolink" rel="nofollow noopener" target="_blank">http://dev.classmethod.jp/smartphone/iphone/ios-xml-parse-2/</a><br>
勝手に使っていいということなので、ありがたく使わせてもらってます！</p>

<p>呼び出し元はこんな感じになります。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">requestPhotoList</span>
<span class="p">{</span>
    <span class="k">__weak</span> <span class="n">ASPopularListViewController</span> <span class="o">*</span><span class="n">weakSelf</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>

    <span class="n">ASPhotoListFetcher</span> <span class="o">*</span><span class="n">fetcher</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ASPhotoListFetcher</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">fetcher</span> <span class="nl">beginFetchPopularPhotoList</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 取得結果を配列に格納します</span>
            <span class="bp">NSArray</span> <span class="o">*</span><span class="n">photos</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">@"rdf:RDF"</span><span class="p">][</span><span class="s">@"item"</span><span class="p">];</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"photos: %@"</span><span class="p">,</span> <span class="n">photos</span><span class="p">);</span>
            <span class="c1">// 取得結果をゴニョゴニョしてください・・・</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span>
</pre></div></div>

<p>取得した結果からほしい項目は下記のようにして取り出せます。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="c1">// 写真タイトル</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">title</span> <span class="o">=</span> <span class="n">photos</span><span class="p">[</span><span class="s">@"title"</span><span class="p">];</span>
<span class="c1">// 投稿日付</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">date</span> <span class="o">=</span> <span class="n">photos</span><span class="p">[</span><span class="s">@"dc:date"</span><span class="p">]];</span>
<span class="c1">// 画像URL</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">imageUrl</span> <span class="o">=</span> <span class="n">photos</span><span class="p">[</span><span class="s">@"hatena:imageurl"</span><span class="p">];</span>
<span class="c1">// 小さい画像URL</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">smallImageUrl</span> <span class="o">=</span> <span class="n">photos</span><span class="p">[</span><span class="s">@"hatena:imageurlsmal"</span><span class="p">];</span>
<span class="c1">// 中くらいの画像URL</span>
<span class="bp">NSString</span> <span class="o">*</span><span class="n">mediumImageUrl</span> <span class="o">=</span> <span class="n">photos</span><span class="p">[</span><span class="s">@"hatena:imageurlmedium"</span><span class="p">];</span>
</pre></div></div>

<p>必要な最低限をことしか書いてないですが、ソースコードアップしたので詳細はそちらを見てください。</p>

<p><a href="https://github.com/asakahara/ASHatenaPhotoClient" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/asakahara/ASHatenaPhotoClient</a></p>

<p>サンプルの中ではIDMPhotoBrowserというとても便利なフォトビューワを使ってます。<br>
こちらから落とせます。<br>
<a href="https://github.com/ideaismobile/IDMPhotoBrowser" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/ideaismobile/IDMPhotoBrowser</a></p>

<p>こうやって自分で作ったビューワで画像眺めるのも中々よいです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>asakaharaさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>29</kbd>
		<a target="_blank" href="https://qiita.com/asakahara/items/7fd8eee74f06e9bdacf5">Tumblr SDK for iOSの使い方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-27 20:25:50</center>
	</td>
	<td style="width:200px;">
		@asakahara<br />(株式会社ソニックムーブ 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30826/profile-images/1473685563">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Objective-C]</b> <b>[iPhone]</b> <b>[Xcode]</b> <b>[iOS]</b> <b>[tumblr]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>以前作ったアプリでTumblr SDKを使うことがありましたので、導入方法を紹介します。</p>

<p>Tumblr APIもありますが、SDKを使う方がより簡単に使えます。</p>

<p>まずこちらからアプリを登録してOAuthによる認証に必要なコンシューマキー、コンシューマ秘密鍵取得します。</p>

<p><a href="http://www.tumblr.com/oauth/apps" class="autolink" rel="nofollow noopener" target="_blank">http://www.tumblr.com/oauth/apps</a></p>

<p>CocoaPodsを使って導入もできますが、今回は必要なファイルを直接取ってきます。</p>

<p>まずこちらからTumblr SDKをダウンロードしてください。</p>

<p><a href="https://github.com/tumblr/TMTumblrSDK" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/tumblr/TMTumblrSDK</a></p>

<p>解凍してできたTMTumblrSDKディレクトリをプロジェクトにコピーします。</p>

<p>下記も必要となりますのでダウンロードしてプロジェクトにコピーしてください。</p>

<p>・JXHTTP<br>
<a href="https://github.com/jstn/JXHTTP" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/jstn/JXHTTP</a></p>

<p>・NSData-Base64<br>
<a href="https://github.com/l4u/NSData-Base64" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/l4u/NSData-Base64</a></p>

<p>これでSDKを使用する準備が整いました。</p>

<p>ではここからは認証方法についてです。</p>

<p>AppDelegateのapplication:didFinishLaunchingWithOptionsに下記のコードを追加します。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">TMAPIClient</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">OAuthConsumerKey</span> <span class="o">=</span> <span class="s">@"取得したコンシューマキー"</span><span class="p">;</span>
<span class="p">[</span><span class="n">TMAPIClient</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">OAuthConsumerSecret</span> <span class="o">=</span> <span class="s">@"取得した秘密鍵"</span><span class="p">;</span>
</pre></div></div>

<p>次にinfo.plistにURL schemeの設定を行います。</p>

<div class="code-frame" data-lang="xml"><div class="highlight"><pre><span></span><span class="nt">&lt;key&gt;</span>CFBundleURLTypes<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;array&gt;</span>
  <span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>CFBundleURLSchemes<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;array&gt;</span>
      <span class="nt">&lt;string&gt;</span>astumblrclient<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/array&gt;</span>
  <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/array&gt;</span>
</pre></div></div>

<p>上記で設定したURL schemeでアプリを起動できるようにします。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">handleOpenURL:</span><span class="p">(</span><span class="bp">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">url</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">TMAPIClient</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">handleOpenURL</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
<span class="p">}</span>
</pre></div></div>

<p>次に認証処理を行います。<br>
引数に上記で設定したURL schemeを設定してください。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">TMAPIClient</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">authenticate</span><span class="p">:</span><span class="s">@"astumblrclient"</span> <span class="nl">callback</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error login to Tumblr"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"login to Tumblr"</span><span class="p">);</span>

                <span class="c1">// 取得したコンシューマキーと秘密鍵を保存する</span>
                <span class="n">settingInfo</span><span class="p">.</span><span class="n">tumblrAuthToken</span> <span class="o">=</span> <span class="p">[</span><span class="n">TMAPIClient</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">OAuthToken</span><span class="p">;</span>
                <span class="n">settingInfo</span><span class="p">.</span><span class="n">tumblrAuthTokenSecret</span> <span class="o">=</span> <span class="p">[</span><span class="n">TMAPIClient</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">OAuthTokenSecret</span><span class="p">;</span>
                <span class="err">・・・</span>
            <span class="p">}</span>
        <span class="p">}];</span>
</pre></div></div>

<p>認証が完了したらDashboardから画像一覧をリクエストします。</p>

<div class="code-frame" data-lang="objc"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">TMAPIClient</span> <span class="n">sharedInstance</span><span class="p">]</span> <span class="nl">dashboard</span><span class="p">:</span><span class="l">@{</span><span class="s">@"type"</span><span class="o">:</span> <span class="s">@"photo"</span><span class="p">,</span>
                                              <span class="s">@"limit"</span> <span class="o">:</span> <span class="s">@"20"</span><span class="l">}</span>
                                   <span class="nl">callback</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">results</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"results: %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">results</span> <span class="n">description</span><span class="p">]);</span>

        <span class="bp">NSArray</span> <span class="o">*</span><span class="n">posts</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s">@"posts"</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">posts</span><span class="p">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 処理を行う</span>
            <span class="err">・・・</span>
        <span class="p">}</span>
    <span class="p">}];</span>
</pre></div></div>

<p>実際にDashboardの画像一覧を取得して表示するサンプルを作ってみましたので、参考にしてください。</p>

<p><a href="https://github.com/asakahara/ASTumblrClient" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/asakahara/ASTumblrClient</a></p>

<p><a href="https://camo.qiitausercontent.com/70f82891773bc7596c6969506f0494d409be5129/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f37336630383039312d643437352d303466622d326537632d3162623932356635613236302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/70f82891773bc7596c6969506f0494d409be5129/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33303832362f37336630383039312d643437352d303466622d326537632d3162623932356635613236302e706e67" alt="tumblrScreenshot1.png" title="tumblrScreenshot1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/30826/73f08091-d475-04fb-2e7c-1bb925f5a260.png"></a></p>

<p>作ってみた感想としてSDKを使えば簡単にTumblr APIを扱えるのですが、<br>
ドキュメントが少ない点や日本語の情報がほとんどないので少し困りました。<br>
日本人でTumblrを使う人があまり多くないということなんでしょうかね。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
