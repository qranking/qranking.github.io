<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (hirokidaichi)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (hirokidaichi さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>hirokidaichiさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1447</kbd>
		<a target="_blank" href="https://qiita.com/hirokidaichi/items/f9f4549c88aaf8b38bda">エンジニアなら知っておきたい障害報告&amp;再発防止策の考え方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-18 16:13:28</center>
	</td>
	<td style="width:200px;">
		@hirokidaichi<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/35671/profile-images/1473686806">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[test]</b> <b>[再発防止策]</b> <b>[障害報告]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/b36b991f4a85c669303d812c2bbed35d7ac92102/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33353637312f64633531373236612d313563312d346232652d313935652d6131346461643661653031312e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b36b991f4a85c669303d812c2bbed35d7ac92102/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33353637312f64633531373236612d313563312d346232652d313935652d6131346461643661653031312e706e67" alt="スクリーンショット 2014-01-17 15.31.41.png" title="スクリーンショット 2014-01-17 15.31.41.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/35671/dc51726a-15c1-4b2e-195e-a14dad6ae011.png"></a></p>

<p>システムには障害がつきものです。どんなにしっかりと作られたサービスであっても思わぬところで、バグやミスが発覚して、トラブルになるものです。大事なのはこういった障害を次への糧にしていくこと。失敗というのは大事な資産なので、管理できるようにしましょうという話。</p>

<h1>
<span id="あわせて読みたい" class="fragment"></span><a href="#%E3%81%82%E3%82%8F%E3%81%9B%E3%81%A6%E8%AA%AD%E3%81%BF%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>あわせて読みたい</h1>

<ul>
<li><a href="http://qiita.com/hirokidaichi/items/c9a76191216f3cc6c4b2" id="reference-076c61b217db3975bf65">新人プログラマに知ってもらいたいメソッドを読みやすく維持するいくつかの原則</a></li>
<li><a href="http://qiita.com/hirokidaichi/items/591ad96ab12938878fe1" id="reference-52f806d80c589350ac18">新人プログラマに知っておいてもらいたい人類がオブジェクト指向を手に入れるまでの軌跡</a></li>
<li><a href="http://qiita.com/hirokidaichi/items/27c757d92b6915e8ecf7" id="reference-874b4e807470aa225581">ペアプログラミングして気がついた新人プログラマの成長を阻害する悪習</a></li>
<li>
<a href="http://qiita.com/hirokidaichi/items/5a5cb63ef5499143bc40" id="reference-0e0527a8ccf65e2496aa">あきらめるにはまだ早い！ソースコードの品質向上に効果的なアプローチ</a>
メンタリングの方法について基礎をまとめました。内心でなく行動を変えることが障害報告とも共通します。</li>
<li><a href="http://qiita.com/hirokidaichi/items/2e8e731acfd7b6c7e02f" id="reference-d0edd0798354822e21c4">新入社員が来てメンターになれって言われたけど、どうすればいいのかという対話テクニック</a></li>
</ul>

<h1>
<span id="障害の種類と障害報告について" class="fragment"></span><a href="#%E9%9A%9C%E5%AE%B3%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%A8%E9%9A%9C%E5%AE%B3%E5%A0%B1%E5%91%8A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>障害の種類と障害報告について</h1>

<p>障害には、小さなもの、たとえば画面に表示されているテキストの乱れから、すべての画面で50xエラーが発生しているもの、決済とのつなぎ込みが失敗し、金銭的な影響が大きいものなど様々あります。どのような時に障害報告を書くのかと言われれば、「できればすべて書きましょう」というのが原則になると思います。</p>

<p>大前提として、「障害報告は始末書や反省文ではない」ということです。仕方なく、嫌嫌恥ずかしい思いをしながら書く必要はありません。うちはそういう文化じゃないんだと言う場合は、自分たちのチームから障害報告を始めてみるとよいのではないでしょうか。</p>

<h1>
<span id="ハインリッヒの法則あるいはヒヤリハット" class="fragment"></span><a href="#%E3%83%8F%E3%82%A4%E3%83%B3%E3%83%AA%E3%83%83%E3%83%92%E3%81%AE%E6%B3%95%E5%89%87%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E3%83%92%E3%83%A4%E3%83%AA%E3%83%8F%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>ハインリッヒの法則、あるいはヒヤリハット</h1>

<p><a href="http://ja.wikipedia.org/wiki/%E3%83%8F%E3%82%A4%E3%83%B3%E3%83%AA%E3%83%83%E3%83%92%E3%81%AE%E6%B3%95%E5%89%87" class="autolink" rel="nofollow noopener" target="_blank">http://ja.wikipedia.org/wiki/ハインリッヒの法則</a></p>

<p>ハインリッヒの法則というものがあります。これは、１件の重大な事故の背後には29件の軽微な事故、300件のヒヤリハット事例(事故にはならなかったけど、ヒヤッとしたこと)が隠れているという統計的な経験則です。</p>

<p>これは、逆説的に言えば、小さな障害報告であってもしっかりとマネージすることで重大な事故を防ぐことができるだろうということを意味しています。</p>

<h1>
<span id="障害報告のフォーマットについて" class="fragment"></span><a href="#%E9%9A%9C%E5%AE%B3%E5%A0%B1%E5%91%8A%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>障害報告のフォーマットについて</h1>

<p>障害報告はできれば、ticket/issue管理システムなどで管理した方が良いでしょう。なければ、wikiのようなものでもかまいません。そのときのフォーマットとしては、最低限、次のようなものを用意するといいでしょう。</p>

<ul>
<li>障害内容サマリ</li>
<li>カスタマーフィードバック</li>
<li>障害タイムライン</li>
<li>対応差分</li>
<li>再発防止策</li>
</ul>

<h2>
<span id="障害内容サマリ" class="fragment"></span><a href="#%E9%9A%9C%E5%AE%B3%E5%86%85%E5%AE%B9%E3%82%B5%E3%83%9E%E3%83%AA"><i class="fa fa-link"></i></a>障害内容サマリ</h2>

<p>障害内容のサマリを端的な文章で記述しましょう。このとき、やってしまいがちなのは、「起きた現象」の内容ではなくて、「原因やバグが発生しているモジュール名」などを書いてしまいがちだったりします。ここに書くべきは、技術者以外も含めたメンバーが理解できるような現象面について言及することです。</p>

<p>たとえば、<br>
「HogeFuga_master DBの物理障害が発生」<br>
ではなくて、<br>
「Hoge表示画面でinternal server errorと表示される」<br>
「Hogeの投稿ができない不具合が発生」<br>
などと記述します。</p>

<p>これは、影響の大きさを営業部門やサポート部門と共有するためにも大事なことです。</p>

<h2>
<span id="カスタマーフィードバック" class="fragment"></span><a href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%83%BC%E3%83%95%E3%82%A3%E3%83%BC%E3%83%89%E3%83%90%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>カスタマーフィードバック</h2>

<p>発生した障害に関して、問い合わせの件数やその内容などを記述します。あるいは関連部門の人に記述してもらいましょう。これは、影響の大きさを可視化するのに役立ちます。また、障害発生時にそういった部門との情報共有を必要とするフォーマットになるため、障害対応から問い合わせ応答や、障害発生のお知らせを出すための連携もしやすくなります。</p>

<h2>
<span id="障害タイムライン" class="fragment"></span><a href="#%E9%9A%9C%E5%AE%B3%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%A9%E3%82%A4%E3%83%B3"><i class="fa fa-link"></i></a>障害タイムライン</h2>

<p>障害タイムラインとは、発生時刻、認知時刻、対応開始時刻、対応完了時刻、その他必要な時系列の対応状況に関する報告です。また、それぞれについて、「誰によって」「いつ」「どのように」がわかるとよりよいでしょう。</p>

<p>これを記述する理由は、再発防止策の検討の際にも役に立つからです。たとえば、発生時刻から認知時刻までの差が「２時間」であった場合、これを「１０分」にすることができるだけでも、障害の影響度は変わってきます。また、「認知時刻から対応開始まで」「対応開始から対応完了まで」の時刻も同様です。</p>

<p>障害の影響度については、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>障害の影響度＝影響範囲 * 金銭的重要性 * 対応完了までにかかった時間
</pre></div></div>

<p>このように考えるとよいでしょう。</p>

<h2>
<span id="対応差分" class="fragment"></span><a href="#%E5%AF%BE%E5%BF%9C%E5%B7%AE%E5%88%86"><i class="fa fa-link"></i></a>対応差分</h2>

<p>対応差分へのリンクを必ず張りましょう。障害の理由は文章だけでは、伝わらないケースも多いです。</p>

<h2>
<span id="再発防止策" class="fragment"></span><a href="#%E5%86%8D%E7%99%BA%E9%98%B2%E6%AD%A2%E7%AD%96"><i class="fa fa-link"></i></a>再発防止策</h2>

<p>再発防止策は、障害報告を書く最大の理由です。障害報告を書いた時点では、すべてを記述する必要はありませんが、再発防止策が完了するまでは、チケットをクローズしないことが重要です。また、再発防止策を記述するときは、「原因(だと思ったもの)」と「対策」をしっかりと記述しましょう。なぜなら、原因だと思ったものが共有されていない場合、対策が的外れになってしまう場合もあるからです。</p>

<p>また、その際に</p>

<ul>
<li>直接原因　：　その不具合が発生した直接的原因</li>
<li>間接原因　：　その不具合に至るまでの間接的な原因</li>
<li>本当の理由：　なぜ、このようなパターンの障害が発生したか</li>
</ul>

<p>のように３段階くらいに再発防止策を検討していけるとよいでしょう。これが三段階なのは前述のハインリッヒの法則をイメージしてもらうとわかりやすいと思います。一つの障害には、３００のヒヤリとしている事例、あるいはメンバーの慣れや、習慣、努力によってたまたま防ぐことができている障害が隠れています。直接的な原因を潰すだけでは、再発防止策としてはあまり適していないケースが多いです。そうではなくて、もう一段トラブルを引き起こした間接的な問題がはらんでいて、その問題を解決することで本当の再発防止となることが多いからです。</p>

<p>また、前述の通り、障害の影響度の式をイメージして、影響度を減らすための方策も重要です。</p>

<ul>
<li>影響範囲 　　　　　：同様の問題が起こっても影響範囲の極小化はできないか？</li>
<li>対応完了までの時間 ：同様の問題が起こっても、短い時間で、あるいは自動的に対応できないか？</li>
</ul>

<p>という問いも再発防止策を検討する上では重要です。</p>

<h1>
<span id="再発防止検討サイクルについて" class="fragment"></span><a href="#%E5%86%8D%E7%99%BA%E9%98%B2%E6%AD%A2%E6%A4%9C%E8%A8%8E%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>再発防止検討サイクルについて</h1>

<h2>
<span id="チーム振り返り" class="fragment"></span><a href="#%E3%83%81%E3%83%BC%E3%83%A0%E6%8C%AF%E3%82%8A%E8%BF%94%E3%82%8A"><i class="fa fa-link"></i></a>チーム振り返り</h2>

<p>再発防止策の検討は、定期的にチームで振り返ることが大事です。この際に障害を引き起こしたチームメンバーに対する糾弾のようにならない配慮が重要です。再発防止策の検討には、かならずファシリテータを用意し、画面やホワイトボードに注目させ、また、ブレストのような自由闊達とした雰囲気づくりが重要です。お菓子を用意してもいいですし、適度なアイスブレイクも重要でしょう。</p>

<p>この際に、次に述べる良い再発防止策と悪い再発防止策のペーパーをメンバーは見ることができるようにしておくのも大事です。</p>

<p>また、これはファシリテータの仕事ですが、原因-&gt;対策という順番を忘れずに議論することが大事です。</p>

<h2>
<span id="セカンドオピニオン" class="fragment"></span><a href="#%E3%82%BB%E3%82%AB%E3%83%B3%E3%83%89%E3%82%AA%E3%83%94%E3%83%8B%E3%82%AA%E3%83%B3"><i class="fa fa-link"></i></a>セカンドオピニオン</h2>

<p>再発防止策は、チーム外のメンバーで振り返るシーンを作った方が良いでしょう。その理由の１つは、情報を他のチームのメンバーと共有することでより広範囲の問題を解決する案が出てくるかもしれないこと。もうひとつは、チームの事情によってかかるバイアスを排除した意見をもらうことができることです。チームで行動していると、忙しさから場当たり的な問題解決をしがちになりますし、それを互いに指摘し合える関係を他のチームと構築することで、障害という資産を活かすことができる文化が生まれてくるでしょう。</p>

<h1>
<span id="良い再発防止策と悪い再発防止策" class="fragment"></span><a href="#%E8%89%AF%E3%81%84%E5%86%8D%E7%99%BA%E9%98%B2%E6%AD%A2%E7%AD%96%E3%81%A8%E6%82%AA%E3%81%84%E5%86%8D%E7%99%BA%E9%98%B2%E6%AD%A2%E7%AD%96"><i class="fa fa-link"></i></a>良い再発防止策と悪い再発防止策</h1>

<h2>
<span id="良い再発防止策" class="fragment"></span><a href="#%E8%89%AF%E3%81%84%E5%86%8D%E7%99%BA%E9%98%B2%E6%AD%A2%E7%AD%96"><i class="fa fa-link"></i></a>良い再発防止策</h2>

<p>良い再発防止策について、順位付けするとしたら、</p>

<ol>
<li>その種類の問題について二度と意識することがなくなる解決策</li>
<li>その種類の問題を開発時に自動的に検知することができる解決策</li>
<li>その種類の問題が発生しても自動的に復旧することができる解決策</li>
<li>その種類の問題が発生しても影響が局所化される、フールプルーフ、フェールセーフになる解決策</li>
</ol>

<p>このような順序でしょうか。</p>

<h2>
<span id="悪い再発防止策" class="fragment"></span><a href="#%E6%82%AA%E3%81%84%E5%86%8D%E7%99%BA%E9%98%B2%E6%AD%A2%E7%AD%96"><i class="fa fa-link"></i></a>悪い再発防止策</h2>

<p>悪い再発防止策は、シンプルで人間というコンポーネントを使うことです。</p>

<ol>
<li>責任回避のため稟議、決済経路を追加する策</li>
<li>他者の努力／忍耐／根性の不足を指摘し改善を求める策</li>
<li>個人／チームの注意力を原因とし、「より注意深く確認します／させます」といった策</li>
<li>それっぽい言い訳付きのダブルチェック/トリプルチェック体制</li>
<li>ドキュメントにその旨追記します！的な解決策</li>
</ol>

<p>これは、そんなことやらないよと思っていると、ついついやってしまいがちなので注意が必要です。<br>
「ちゃんと」「しっかり」というフレーズが出てきたら、危険信号です。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<ul>
<li>障害報告は資産。どんなものでも作成し有効活用しよう。</li>
<li>人間というコンポーネントを再発防止に入れない</li>
<li>セカンドオピニオンをもうけよう</li>
</ul>

<p>以上です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>hirokidaichiさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1096</kbd>
		<a target="_blank" href="https://qiita.com/hirokidaichi/items/0de5ca336de862cc91bd">MVCの流れを簡単にまとめてみる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-14 23:41:33</center>
	</td>
	<td style="width:200px;">
		@hirokidaichi<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/35671/profile-images/1473686806">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Silverlight]</b> <b>[AngularJS]</b> <b>[knockoutjs]</b> <b>[DDD]</b> <b>[MVVM]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/0640a966e047d903b9f788436a34b996fb142d68/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33353637312f65653363353436382d373134362d623937302d343033352d3936336230303765383062652e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0640a966e047d903b9f788436a34b996fb142d68/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33353637312f65653363353436382d373134362d623937302d343033352d3936336230303765383062652e706e67" alt="kobito.1389710043.312112.png" title="kobito.1389710043.312112.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/35671/ee3c5468-7146-b970-4035-963b007e80be.png"></a></p>

<p>理解しやすいように適当に遮ったり、言い切ってしまったところもあるがご容赦いただきたい。</p>

<h1>
<span id="mvcの登場" class="fragment"></span><a href="#mvc%E3%81%AE%E7%99%BB%E5%A0%B4"><i class="fa fa-link"></i></a>MVCの登場</h1>

<p>MVCは、SmalltalkのGUIライブラリのモデルとして登場した。 <br>
これはGUIアプリケーションを記述する際に、適切なモデル化を進めるのにとてもいい考え方だと思われていたし、実際にそうだった。 </p>

<p>これはアーキテクチャパターンとして、それぞれがどのように依存するべきか、どこにコードを書くべきかということを端的に表している。 </p>

<p>安定依存の原則というものがある。これは、要件が安定しているモジュールに依存し、要件が変動しやすいモジュールには依存しないようにするという原則だ。MVCアーキテクチャでは、GUIアプリケーションの安定関係をModel &gt; View &gt; Controllerの順でとらえている。データ処理や業務要件というのは安定しており、UIパーツもまた比較的安定している。それらを統合してアプリケーションとしてくみ上げる部分が一番安定していないというようにとらえた。 </p>

<p>なので、ModelはViewやControllerから依存されるが、Controllerは依存されない。その他の関係はイベントのように抽象度が高いものを使っている。 </p>

<p>実際にはもう少し粒度の細かいデザインパターンの集合として記述されることが多い。その代表例がイベントを抽象化するObserverパターンや、インタフェースを集約するFacadeパターンだ。 </p>

<p>このモデルは現在に至るまで長いこと支持されている。もしかしたら金科玉条のように宗教的な信仰を受けているといっても言い過ぎじゃないかもしれない。 </p>

<p>今日は、MVCが最近どのように変化しているかという話をしたい。 </p>

<h1>
<span id="document-viewモデル" class="fragment"></span><a href="#document-view%E3%83%A2%E3%83%87%E3%83%AB"><i class="fa fa-link"></i></a>Document-Viewモデル</h1>

<p>MVCをもとに実際にアプリケーションを書いていくと、UIとコントローラには実際的には依存関係が強いことが多い。結局のところ１つのUIのために１つのControllerというように１：１の関係があった。 </p>

<p>そこで、１つの割り切りとしてMFC（WindowsのC++ GUIフレームワーク）ではDocument-ViewモデルというM+VCというModel層とイベントを内包したUI部品という形を採用した。 <br>
これはイベント駆動のUIと切り離されたスレッドを持つ状態を共存させるのにいい考えだった。 </p>

<h1>
<span id="ドメインモデル貧血症" class="fragment"></span><a href="#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%A2%E3%83%87%E3%83%AB%E8%B2%A7%E8%A1%80%E7%97%87"><i class="fa fa-link"></i></a>ドメインモデル貧血症</h1>

<p>一方で、MVCでの開発にはやっかいな現象が起き始めた。ドメインモデル貧血症である。 <br>
<a href="http://en.wikipedia.org/wiki/Anemic_domain_model" class="autolink" rel="nofollow noopener" target="_blank">http://en.wikipedia.org/wiki/Anemic_domain_model</a> <br>
これは、要件追加が主に安定しないViewに近い部分から発生するために起こりやすい現象で、あるフィーチャーを開発する際にデータ処理をモデリングできず、Controller層で直接データベースを触って、必要なトランザクションまで記述してしまうというために起きた。そのためデータ処理の完全性を保証することが難しくなったり、テストの難しいコードとなってしまいバグの増加を招いた。 </p>

<p>ドメインモデルは、業務上のロジックをすべてモデルとして隠蔽することが望まれていたが、追加要件に対してもろいことが多かった。 </p>

<p>これは同時にO/Rマッパーの普及によるところも大きい。O/Rマッパーはデータベース処理をObject指向のライブラリに隠蔽することができるが、ドメインモデルの設計を助ける訳ではない。複数のデータベースにまたがるドメインモデルも存在するし、それがDBである必要性も本来的には無いのだから当然のことだ。 </p>

<p>O/Rマッパーも複雑な要件に耐えるため、ActiveRecordというデータベース上のRowとDomainModel上のEntityを一致させる簡易的なものからDataMapperというデータベース処理をEntityにマッピングさせるというタイプのフレームワークなどを提供するようになってきた。 </p>

<p>ライブラリの普及だけではなく、デザインパターンに関してもDDD（Domain Driven Design）と呼ばれるドメインモデルの分析から入る設計の必要性が説かれるようになった。 <br>
これは、ドメイン駆動による設計を実現するための共通言語を作ることが目的だった。そのなかでサービス層/サービスクラスという概念が登場した。これは問題領域そのものの概念化ではなく、インタフェース提供や粗結合化を実現するためのモジュールである。 </p>

<h1>
<span id="mmvc" class="fragment"></span><a href="#mmvc"><i class="fa fa-link"></i></a>MMVC</h1>

<p>これに関連して、MMVC( Model Model View Controller ）という考え方が出てきた。 <br>
<a href="http://c2.com/cgi/wiki?ModelModelViewController" class="autolink" rel="nofollow noopener" target="_blank">http://c2.com/cgi/wiki?ModelModelViewController</a> <br>
モデル層を２つに分割し、DomainModelとApplicationModelとよぶ。このため　MAVCと呼ぶ人もいる。（DAVCと呼ぶ人はいない。） </p>

<p>DomainModelは状態を持つオブジェクトとして作り、複数のDomainModelを利用した処理をApplicationModelというサービス層に隠蔽する考え方だ。 </p>

<p>このようにControllerが太る理由は、Model層についてモジュール化するためのノウハウやルールが確立されていないからだという考えのもとMVCの進歩は進んできた。 </p>

<h1>
<span id="dciの登場" class="fragment"></span><a href="#dci%E3%81%AE%E7%99%BB%E5%A0%B4"><i class="fa fa-link"></i></a>DCIの登場</h1>

<p>最近ではDCIという考え方が出てきた。DCIの問題意識は、Modelに次々に追加される要件に対応することだ。これはAgileな開発というスタイルにも関連している。DCIの考え方はDataよばれるデータソース層に対して、Roleと呼ばれる役割をContext上でアドホックに組み込んで提供するものだ。(なぜ　DRC：Data Role Contextじゃないのかはよくわからない。) <br>
RoleはTraitで実装される。とても現代的なものではあるが、有効性や問題点はまだ未知数といってもいいだろう。 </p>

<p>このようにControllerにModelで書くべきことが記述される問題に関してはアプローチされてきた。ではControllerとViewの関係はどうであろうか。 </p>

<h1>
<span id="mvvmあるいは双方向バインディング" class="fragment"></span><a href="#mvvm%E3%81%82%E3%82%8B%E3%81%84%E3%81%AF%E5%8F%8C%E6%96%B9%E5%90%91%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>MVVMあるいは双方向バインディング</h1>

<p>実際のところ、ViewとControllerの間で記述されている処理は非常に明快なことが多い。Viewへのアクションに伴うイベントのハンドリングや、データのアサインをModelを介して行うだけだ。これはModelが十分な機能を提供している限り、これ以上のことをする必要は無い。であれば、ViewとModelの関係を明快にすることでControllerの肥大化は防ぐことができる。 </p>

<p>そこで出てきた考え方がMVVMだ。(Model View ViewModel ) <br>
UIには入力フォームや表示データのように見た目とは別のデータ構造を隠し持っていることがわかる。そのUIパーツのためにアサインしているデータを考えればわかりやすいだろう。 <br>
このデータ構造をViewModelといい、その変更を監視しモデルに伝え、モデルがViewModelを変更するといったインタフェースを持つことで煩雑なイベント処理を隠蔽できる。 <br>
これはmicrosoftのsilverlightのためのRIAであるWPFから出てきた考え方だ。しかし、現在ではknockout.jsやandroid-bindingでも同様のことができる。 <br>
(はてぶより追記：WPF上でのMVVMについて、より詳細にはこちらのスライド <a href="http://www.slideboom.com/presentations/381148" class="autolink" rel="nofollow noopener" target="_blank">http://www.slideboom.com/presentations/381148</a> をご確認ください。)</p>

<p>この考え方をより明快にWebアプリケーションと結びつけようとするむきがある。これがModel driven Viewというgoogleがリードして提案しているDOM拡張である。これは、viewModelにあたるオブジェクトをviewであるdomオブジェクトとmodelオブジェクトがどちらも参照をもっており、それぞれの変更をそれぞれが通知され処理するというものだ。これは、WebComponentsの流れに関連しているものだ。まだ開発中であるがpolymer.jsを利用することである程度先取りすることができる。また、実用を考えるのであれば、angular.jsなどでも近しいの考え方で実装されている。 </p>

<p>DCIとMVVMあるいはmdvは今後、アプリケーション開発においては主流になっていくだろう。これによって、Controllerの責務はほぼなくなっていき、Fat Controllerの問題は別の問題にすり替わっていくだろうということが想像される。 </p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>hirokidaichiさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>10</kbd>
		<a target="_blank" href="https://qiita.com/hirokidaichi/items/30591e2f5ac7a020e041">agとackとptを全部入れて比較してみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-13 14:26:06</center>
	</td>
	<td style="width:200px;">
		@hirokidaichi<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/35671/profile-images/1473686806">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ag]</b> <b>[ack]</b> <b>[pt]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>動かしたのはEC2のt1.mediumインスタンス。</p>

<p>まずはack</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>[ec2-user@***:~/golang]$ time ack my_ -l                                                                                                      (r:0 s:6 j:0)
doc/go_faq.html
src/pkg/html/template/escape_test.go
src/pkg/go/printer/testdata/declarations.golden
src/pkg/go/printer/testdata/declarations.input
src/pkg/debug/dwarf/testdata/typedef.c
src/pkg/debug/dwarf/type_test.go
src/pkg/syscall/types_linux.go
src/pkg/runtime/sys_darwin_386.s
src/pkg/runtime/sys_darwin_amd64.s
misc/cgo/test/issue4273b.c
ack my_ -l (real: 1.763 user: 1.384 sys: 0.252 cpu: 92% pf: 0)
</pre></div></div>

<p>次にag</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>[ec2-user@***-:~/golang]$ time ag my_ -l                                                                                                       (r:0 s:6 j:0)
doc/go_faq.html
src/pkg/html/template/escape_test.go
src/pkg/go/printer/testdata/declarations.golden
src/pkg/go/printer/testdata/declarations.input
src/pkg/debug/dwarf/testdata/typedef.c
src/pkg/debug/dwarf/type_test.go
src/pkg/syscall/types_linux.go
src/pkg/runtime/sys_darwin_386.s
src/pkg/runtime/sys_darwin_amd64.s
misc/cgo/test/issue4273b.c
ag my_ -l (real: 0.262 user: 0.128 sys: 0.128 cpu: 97% pf: 0)
</pre></div></div>

<div class="code-frame" data-lang="pt"><div class="highlight"><pre><span></span>ec2-user@ip-172-31-18-203:~]$ time pt my_ golang -l                                                                                                       (r:0 s:1 j:0)
golang/doc/go_faq.html
golang/misc/cgo/test/issue4273b.c
golang/src/pkg/debug/dwarf/testdata/typedef.c
golang/src/pkg/debug/dwarf/type_test.go
golang/src/pkg/go/printer/testdata/declarations.golden
golang/src/pkg/go/printer/testdata/declarations.input
golang/src/pkg/html/template/escape_test.go
golang/src/pkg/runtime/sys_darwin_386.s
golang/src/pkg/runtime/sys_darwin_amd64.s
golang/src/pkg/syscall/types_linux.go
pt my_ golang -l (real: 0.840 user: 0.576 sys: 0.256 cpu: 99% pf: 0)
</pre></div></div>

<p>だいたい１０倍くらいag速い。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>hirokidaichiさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/hirokidaichi/items/e4a0971d5c2650252580">スコープでリソースを破棄するいろいろなやりかた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-15 02:16:17</center>
	</td>
	<td style="width:200px;">
		@hirokidaichi<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/35671/profile-images/1473686806">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[Python]</b> <b>[C++]</b> <b>[Go]</b> <b>[D言語]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="raiic" class="fragment"></span><a href="#raiic"><i class="fa fa-link"></i></a>RAII(C++)</h1>

<p>wikipediaから参照。デストラクタが自動変数の破棄によってよびだされて、そのときにリソースのcloseを行う。closeのAPIが例外を出さないことが前提。perlのguard系モジュールとかもそう。</p>

<div class="code-frame" data-lang="c++"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">functionA</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LogFile</span> <span class="n">log</span><span class="p">(</span><span class="s">"Output log of functionA"</span><span class="p">);</span>

    <span class="n">log</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"fun Step succeeded"</span><span class="p">);</span>

    <span class="c1">// ... logを使い続ける ...</span>
    <span class="c1">// 例外が送出されようと、関数からreturnが行われようと確実にlogのファイルハンドルは閉じられる。</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="with句python" class="fragment"></span><a href="#with%E5%8F%A5python"><i class="fa fa-link"></i></a>with句(python)</h1>

<p>昔は無かったけど、増えた。</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"hello.txt"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">line</span>
</pre></div></div>

<h1>
<span id="proc受け取りruby" class="fragment"></span><a href="#proc%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8Aruby"><i class="fa fa-link"></i></a>proc受け取り(ruby)</h1>

<p>closureを受け取り、その関数の実行前後でリソースの確保と破棄を行う。</p>

<div class="code-frame" data-lang="ruby"><div class="highlight"><pre><span></span><span class="nb">open</span><span class="p">(</span><span class="s2">"foo.csv"</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="k">while</span> <span class="n">l</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">gets</span>
    <span class="n">lines</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">fields</span> <span class="o">+=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
  <span class="k">end</span>
<span class="p">}</span>

</pre></div></div>

<h1>
<span id="using句c" class="fragment"></span><a href="#using%E5%8F%A5c"><i class="fa fa-link"></i></a>using句(C#)</h1>

<p>c#はwith見たいのがあるよ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>// Disposeメソッドを実装しておけば、using抜けた後に使える

using (StreamWriter writer = 
                new StreamWriter("memo.txt", false, Encoding.UTF8))
{
    writer.Write("テキスト");
}
</pre></div></div>

<h1>
<span id="scoped-lang" class="fragment"></span><a href="#scoped-lang"><i class="fa fa-link"></i></a>scope(D-lang)</h1>

<p>scopeのあとの関数が、脱出時に評価される。</p>

<div class="code-frame" data-lang="d"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">abc</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Mutex</span> <span class="n">m</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mutex</span><span class="p">;</span>

    <span class="n">lock</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>    <span class="c1">// mutexをロック</span>
    <span class="k">scope</span><span class="p">(</span><span class="n">exit</span><span class="p">)</span> <span class="n">unlock</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>  <span class="c1">// スコープ終了時にアンロック</span>

    <span class="n">foo</span><span class="p">();</span>  <span class="c1">// 処理を行う</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="defergo-lang" class="fragment"></span><a href="#defergo-lang"><i class="fa fa-link"></i></a>defer(go-lang)</h1>

<p>scopeと似てる</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span>    <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">""</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>  <span class="c1">// f.Closeは、完了時に実行される</span>
</pre></div></div>

<h1>
<span id="try-with-resources構文java" class="fragment"></span><a href="#try-with-resources%E6%A7%8B%E6%96%87java"><i class="fa fa-link"></i></a>try-with-resources構文(java)</h1>

<p>AutoCloseableのInterfaceを実装しているものを閉じてくれる。<br>
(tsuyoshi_choさんありがとうございました)</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">AutoCloseable</span> <span class="n">imp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AutoCloseableImpl</span><span class="o">())</span> <span class="o">{</span> <span class="c1">// New!</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"hoge"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"catch:"</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"finally"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></div></div>

<h1>
<span id="synchronizedjava" class="fragment"></span><a href="#synchronizedjava"><i class="fa fa-link"></i></a>synchronized(Java)</h1>

<p>オブジェクトのロックの獲得管理が、構文でできる。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">MyObject</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">val</span><span class="o">;</span>

  <span class="n">MyObject</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">setVal</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">synchronized</span> <span class="kt">int</span> <span class="nf">getVal</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">val</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>とりあえず、なんか思い出したら追記します。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>hirokidaichiさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/hirokidaichi/items/73850270ecbba6f92010">go言語のchannelでムダに竹内関数をまわす</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-13 04:18:47</center>
	</td>
	<td style="width:200px;">
		@hirokidaichi<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/35671/profile-images/1473686806">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Go]</b> <b>[golang]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>channelの勉強がてら、竹内関数の入出力をチャンネル経由にする</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span>
<span class="kd">func</span> <span class="nx">Tak</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">y</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">y</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Tak</span><span class="p">(</span><span class="nx">Tak</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">),</span> <span class="nx">Tak</span><span class="p">(</span><span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">x</span><span class="p">),</span> <span class="nx">Tak</span><span class="p">(</span><span class="nx">z</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
<span class="p">}</span>

</pre></div></div>

<p>竹内関数とはこんな感じのもの。<br>
やたらとたらいまわされる。</p>

<p>これをひとつひとつチャンネル経由にしたらどうなるか<br>
さらにたらいまわされるに違いないということで、やってみた。</p>

<p>名前は <strong>タケちゃん</strong>関数</p>

<div class="code-frame" data-lang="go"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">Tak</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">y</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">y</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Tak</span><span class="p">(</span><span class="nx">Tak</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">),</span> <span class="nx">Tak</span><span class="p">(</span><span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">z</span><span class="p">,</span> <span class="nx">x</span><span class="p">),</span> <span class="nx">Tak</span><span class="p">(</span><span class="nx">z</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">v2c</span><span class="p">(</span><span class="nx">v</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">chan</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">e</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nx">e</span> <span class="o">&lt;-</span> <span class="nx">v</span> <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">e</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">Takechan</span><span class="p">(</span><span class="nx">xc</span><span class="p">,</span> <span class="nx">yc</span><span class="p">,</span> <span class="nx">zc</span> <span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">chan</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="nx">emitter</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">xc</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">yc</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">zc</span>
        <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">y</span> <span class="p">{</span>
            <span class="nx">emitter</span> <span class="o">&lt;-</span> <span class="nx">y</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="nx">emitter</span> <span class="o">&lt;-</span> <span class="o">&lt;-</span><span class="nx">Takechan</span><span class="p">(</span>
            <span class="nx">Takechan</span><span class="p">(</span><span class="nx">v2c</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nx">v2c</span><span class="p">(</span><span class="nx">y</span><span class="p">),</span> <span class="nx">v2c</span><span class="p">(</span><span class="nx">z</span><span class="p">)),</span>
            <span class="nx">Takechan</span><span class="p">(</span><span class="nx">v2c</span><span class="p">(</span><span class="nx">y</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nx">v2c</span><span class="p">(</span><span class="nx">z</span><span class="p">),</span> <span class="nx">v2c</span><span class="p">(</span><span class="nx">x</span><span class="p">)),</span>
            <span class="nx">Takechan</span><span class="p">(</span><span class="nx">v2c</span><span class="p">(</span><span class="nx">z</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nx">v2c</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span> <span class="nx">v2c</span><span class="p">(</span><span class="nx">y</span><span class="p">)))</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">emitter</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">Takechan</span><span class="p">(</span><span class="nx">v2c</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span> <span class="nx">v2c</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="nx">v2c</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">Tak</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="p">}</span>
</pre></div></div>

<p>そこそこ早くうごいた。goroutineすごい。<br>
そんじゃーね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>hirokidaichiさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/hirokidaichi/items/92632bc8b15086839fd3">iTerm2でMacのdeleteキーをbackspaceにかえる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-13 21:38:12</center>
	</td>
	<td style="width:200px;">
		@hirokidaichi<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/35671/profile-images/1473686806">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iTerm2]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="https://camo.qiitausercontent.com/e9761da16274ac48849abb9160d328c2cb172d5d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33353637312f31623734366638352d306632372d646462302d633333382d6262393034656439623435662e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e9761da16274ac48849abb9160d328c2cb172d5d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f33353637312f31623734366638352d306632372d646462302d633333382d6262393034656439623435662e706e67" alt="スクリーンショット 2014-01-13 21.20.24.png" title="スクリーンショット 2014-01-13 21.20.24.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/35671/1b746f85-0f27-ddb0-c338-bb904ed9b45f.png"></a><br>
⬆ここ</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>hirokidaichiさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/hirokidaichi/items/359f4da8864fc534dbfc">coffeescript/ harmonyのdestrucutring assignmentをperlでやる。</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-14 23:55:56</center>
	</td>
	<td style="width:200px;">
		@hirokidaichi<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/35671/profile-images/1473686806">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Perl]</b> <b>[JavaScript]</b> <b>[CoffeeScript]</b> <b>[Harmony]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>cpanizeはしてないけど、とりあえずgithubにはあげた。<br>
<a href="https://github.com/hirokidaichi/p5-Data-Destructuring-Assignment" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/hirokidaichi/p5-Data-Destructuring-Assignment</a></p>

<p>分割代入ってなにかというと"分割"して "代入"できるという機能です。</p>

<div class="code-frame" data-lang="coffeescript"><div class="highlight"><pre><span></span><span class="nv">futurists =</span>
  <span class="nv">sculptor: </span><span class="s">"Umberto Boccioni"</span>
  <span class="nv">painter: </span> <span class="s">"Vladimir Burliuk"</span>
  <span class="nv">poet:</span>
    <span class="nv">name: </span>  <span class="s">"F.T. Marinetti"</span>
    <span class="nv">address: </span><span class="p">[</span>
      <span class="s">"Via Roma 42R"</span>
      <span class="s">"Bellagio, Italy 22021"</span>
    <span class="p">]</span>
<span class="o">//</span> <span class="err">１行で変数に構造を写像できる</span>
<span class="p">{</span><span class="nv">poet: </span><span class="p">{</span><span class="nx">name</span><span class="p">,</span> <span class="nv">address: </span><span class="p">[</span><span class="nx">street</span><span class="p">,</span> <span class="nx">city</span><span class="p">]}}</span> <span class="o">=</span> <span class="nx">futurists</span>

</pre></div></div>

<p>詳しくは<br>
<a href="http://coffeescript.org/#destructuring" class="autolink" rel="nofollow noopener" target="_blank">http://coffeescript.org/#destructuring</a><br>
ここを参照</p>

<p>これが慣れてくると以外と便利なんだけど、<br>
perlの黒魔術で実現したいなと言うことで、皆さん大好きlvalueとtieを使って、次のようなことができるモジュールを作ってみた。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span>
<span class="n">destruct</span><span class="p">([</span><span class="o">\</span><span class="k">my</span> <span class="nv">$hoge</span><span class="p">,</span><span class="o">\</span><span class="k">my</span> <span class="nv">$fuga</span><span class="p">])</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">];</span>
<span class="k">print</span> <span class="s">"hoge is $hoge"</span><span class="p">;</span><span class="c1"># hoge is 10</span>
<span class="k">print</span> <span class="s">"fuga is $fuga"</span><span class="p">;</span><span class="c1"># fuga is 20</span>
</pre></div></div>

<p>こんな風に左辺に構造をもって、右辺の構造とマッチングして、代入することができます。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="n">destruct</span><span class="p">(</span> <span class="o">\</span><span class="k">my</span> <span class="nv">$hoge</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</pre></div></div>

<p>変数はリファレンスで渡してください。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="n">destruct</span><span class="p">(</span> <span class="p">[</span><span class="o">\</span> <span class="nv">$a</span> <span class="p">,</span><span class="o">\</span> <span class="nv">$b</span><span class="p">]</span> <span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$b</span><span class="p">,</span><span class="nv">$a</span><span class="p">];</span>
</pre></div></div>

<p>swapもこんなに簡単。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span>
<span class="n">destruct</span><span class="p">(</span> <span class="p">{</span> <span class="n">hash</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="k">my</span> <span class="nv">$hash</span> <span class="p">}</span> <span class="p">)</span> <span class="o">=</span> <span class="p">{</span> <span class="n">hash</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]};</span>

</pre></div></div>

<p>hashrefもできます。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span>  <span class="nb">map</span><span class="p">{</span> <span class="o">+</span><span class="p">{</span> <span class="n">hoge</span> <span class="o">=&gt;</span> <span class="s">"$_"</span><span class="p">,</span><span class="n">fuga</span> <span class="o">=&gt;</span> <span class="nv">$_</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}}</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">);</span>

<span class="k">while</span><span class="p">(</span><span class="n">destruct</span><span class="p">({</span> <span class="n">hoge</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="k">my</span> <span class="nv">$hoge</span> <span class="p">}</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">shift</span> <span class="nv">@array</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># $hoge..;</span>
<span class="p">}</span>
</pre></div></div>

<p>while句の中で。</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span>  <span class="nb">map</span><span class="p">{</span> <span class="o">+</span><span class="p">{</span> <span class="n">hoge</span> <span class="o">=&gt;</span> <span class="s">"$_"</span><span class="p">,</span><span class="n">fuga</span> <span class="o">=&gt;</span> <span class="nv">$_</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}}</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">);</span>
<span class="k">for</span> <span class="k">my</span> <span class="nv">$elem</span> <span class="p">(</span><span class="nv">@array</span><span class="p">){</span>
    <span class="n">destruct</span><span class="p">({</span> <span class="n">hoge</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="k">my</span> <span class="nv">$hoge</span><span class="p">,</span> <span class="n">fuga</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="k">my</span> <span class="nv">$fuga</span><span class="p">})</span> <span class="o">=</span> <span class="nv">$elem</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></div>

<p>for文とともに</p>

<div class="code-frame" data-lang="perl"><div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$template</span> <span class="o">=</span> <span class="p">{</span> <span class="n">hoge</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span><span class="n">fuga</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">};</span>
<span class="k">if</span><span class="p">(</span> <span class="n">destruct</span><span class="p">({</span> <span class="n">hoge</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="k">my</span> <span class="nv">$hoge</span> <span class="p">,</span><span class="n">piyo</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="k">my</span> <span class="nv">$fuga</span> <span class="p">})</span> <span class="o">=</span> <span class="nv">$template</span> <span class="p">){</span>
    <span class="o">::</span><span class="n">pass</span> <span class="s">'matched any'</span><span class="p">;</span>
<span class="p">}</span><span class="k">else</span> <span class="p">{</span>
    <span class="c1"># not come here</span>
<span class="p">}</span>
</pre></div></div>

<p>if文の中ではこう。一個でもmatchするとtrueです。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
