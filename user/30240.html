<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (mountcedar)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (mountcedar さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>735</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/682743c95fd3b8fc274b">いまさら聞けないgitの使い方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-19 15:47:25</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> <b>[GitHub]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>表題のとおり、いまさら聞けないgitの使い方だが、正直マイナーなコマンドはヘビーユーザではない限り、必要になるたびにGoogleで検索しているのが実情ではないだろうか。このページではその備忘録として、基本的な使い方＋アルファのgitコマンドについてまとめる。</p>

<h1>
<span id="基本操作" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><i class="fa fa-link"></i></a>基本操作</h1>

<h2>
<span id="リモートリポジトリからクローンする" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%8B%E3%82%89%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%B3%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>リモートリポジトリからクローンする</h2>

<p>大抵のgitプロジェクトでは、githubなどから自分の環境にクローンを作成するところからはじまる。基本文法は以下の通り</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone &lt;uri&gt;
</pre></div></div>

<p>このuriの中に入るのは、http,httpsから始まるurlやsshプロトコルで指定するもの、gitoliteなどの他のソフトウェアと連携するものなどいくつかのパターンがある。</p>

<h3>
<span id="http-httpsを使う場合" class="fragment"></span><a href="#http-https%E3%82%92%E4%BD%BF%E3%81%86%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>http, httpsを使う場合</h3>

<p>だいたい、githubからcloneする場合はこのパターン。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone https://github.com/YYYYYY/XXXXX.git
</pre></div></div>

<p>ウェブデザインが変化してからだいぶ経つが、httpsのurlはページ右サイドバーの、HTTPS clone URLのボタンをクリックするとクリップボードにコピーされる。</p>

<h3>
<span id="sshプロトコルから始まる場合" class="fragment"></span><a href="#ssh%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E3%81%8B%E3%82%89%E5%A7%8B%E3%81%BE%E3%82%8B%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>sshプロトコルから始まる場合</h3>

<p>研究室や会社の一部門などの比較的ローカルなセクションで、gitを使っている場合はこのケースが多い。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone ssh://user@hostname/path/to/repos
</pre></div></div>

<p>ユーザにはアクセスするユーザ名、hostnameはローカルマシンのホスト名またはIPアドレス、/path/to/reposには、gitリポジトリまでの絶対パスが入る。ホームディレクトリからの相対パスじゃないことに注意。</p>

<h3>
<span id="gitoliteなどの他のサードパーティのソフトとの連携" class="fragment"></span><a href="#gitolite%E3%81%AA%E3%81%A9%E3%81%AE%E4%BB%96%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%89%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%81%AE%E3%82%BD%E3%83%95%E3%83%88%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA"><i class="fa fa-link"></i></a>gitoliteなどの他のサードパーティのソフトとの連携</h3>

<p>それぞれの内容に従ってください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone gitolite@&lt;hostname&gt;:&lt;projectname&gt;
</pre></div></div>

<p>上記は、標準的にセットアップされたgitoliteのアクセス方法。詳しくは以下のページ参照。</p>

<ul>
<li><a href="http://git-scm.com/book/ja/Git-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC-Gitolite" class="autolink" rel="nofollow noopener" target="_blank">http://git-scm.com/book/ja/Git-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC-Gitolite</a></li>
</ul>

<h2>
<span id="自分用にローカルにgitリポジトリをつくる" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E7%94%A8%E3%81%AB%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%ABgit%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B"><i class="fa fa-link"></i></a>自分用にローカルにgitリポジトリをつくる</h2>

<p>自分用にリポジトリを作る場合は、プロジェクトのディレクトリの中で、ゴミファイルやビルド途中でできたファイルなどを削除し、以下を実行する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git init
$ git add *
$ git commit -m "initial import"
</pre></div></div>

<p>リポジトリを初期化し、現在あるファイルを全部登録して、コミットする手順を実行すると、初期インポートまでが完了する。</p>

<h2>
<span id="ローカルで開発するときに必要な作業" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%A7%E9%96%8B%E7%99%BA%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E4%BD%9C%E6%A5%AD"><i class="fa fa-link"></i></a>ローカルで開発するときに必要な作業</h2>

<p>最も多用するコマンド群です。ローカルのみで作業している人は、「リモートリポジトリ・・・」の件は無視してよいです。</p>

<h3>
<span id="変更のコミット" class="fragment"></span><a href="#%E5%A4%89%E6%9B%B4%E3%81%AE%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>変更のコミット</h3>

<p>いちいち、変更したファイルを登録したり、コメントをエディタを立ち上げて書くのが面倒なので、以下のコマンドに落ち着く</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git commit -a -m "&lt;comment&gt;"
</pre></div></div>

<p>-aオプションは、既に登録されたファイルで変更点があるものをすべて指定するという意味、-mオプションはその後につづく文字列をコメントとして追加する。</p>

<h3>
<span id="新しく出来たファイルの登録" class="fragment"></span><a href="#%E6%96%B0%E3%81%97%E3%81%8F%E5%87%BA%E6%9D%A5%E3%81%9F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>新しく出来たファイルの登録</h3>

<p>開発途上でできたソースファイルや設定ファイル、ライブラリは以下のコマンドで追加する</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git add &lt;file&gt;
$ git add &lt;directory&gt;
$ git add &lt;wildcard. e.g. *.java&gt;
</pre></div></div>

<p>addの後に続くものは、ファイルやディレクトリの他にワイルドカードも使えます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$  git add -A
</pre></div></div>

<p>プロジェクトディレクトリ中に追加されたすべてのファイルを追加する場合は上記が便利。ただし、コンパイルの中間ファイルなども登録されちゃったりするので、注意。</p>

<h3>
<span id="変更したファイルのコミット" class="fragment"></span><a href="#%E5%A4%89%E6%9B%B4%E3%81%97%E3%81%9F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>変更したファイルのコミット</h3>

<p>git mvを用いず、エディタなどで変更したファイルの変更履歴をコミットする場合は以下を用いる．</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git add --all &lt;target&gt;
</pre></div></div>

<p>オプションをつけない場合のgit addコマンドは、省略しないと</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git add --ignore-removal &lt;target&gt;
</pre></div></div>

<p>に設定されていて、ワーキングツリーから削除されたファイルの追跡は行われないようになっているとのこと．ちなみに、疑わしき状況になるとwarningでしっかりと警告されます。以下、原文。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>* 'git add --ignore-removal &lt;pathspec&gt;', which is the current default,
  ignores paths you removed from your working tree.

* 'git add --all &lt;pathspec&gt;' will let you also record the removals.

Run 'git status' to check the paths you removed from your working tree.
</pre></div></div>

<p>eclipseはgitプラグインがちゃんとしていないので、手動でコミットしている人はたびたびお世話になるかもしれない．</p>

<h3>
<span id="ファイル権限の編集" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%A8%A9%E9%99%90%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>ファイル権限の編集</h3>

<p>うっかり実行権限を付け忘れてコミットした場合は、以下のコマンドで権限を修正可能</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git update-index --add --chmod=&lt;options&gt; &lt;target&gt;
# e.g.
$ git update-index --add --chmod=+x &lt;target&gt;
</pre></div></div>

<h3>
<span id="不要なファイルの削除" class="fragment"></span><a href="#%E4%B8%8D%E8%A6%81%E3%81%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%89%8A%E9%99%A4"><i class="fa fa-link"></i></a>不要なファイルの削除</h3>

<p>実装過程で不要になったファイルは以下のように削除できる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git rm &lt;target&gt;
$ git rm -r &lt;target dir&gt;
</pre></div></div>

<p>ディレクトリ単位で削除したい場合は、-rオプションをつけると良い。中間ファイルなどを誤ってコミットしてしまった場合、--cachedオプションを使って削除すると、ローカルコピー上からは削除されず、git管理ファイルから外すことが出来る</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git rm —cached &lt;target&gt;
$ git tm -r —cached &lt;target dir&gt;
</pre></div></div>

<h2>
<span id="まだコミットしていない内容のコミット状態までのロールバックsvn-revert相当" class="fragment"></span><a href="#%E3%81%BE%E3%81%A0%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E5%86%85%E5%AE%B9%E3%81%AE%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E7%8A%B6%E6%85%8B%E3%81%BE%E3%81%A7%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AFsvn-revert%E7%9B%B8%E5%BD%93"><i class="fa fa-link"></i></a>まだコミットしていない内容のコミット状態までのロールバック（svn revert相当）</h2>

<p>編集中の内容からコミット済みのところまで戻りたい場合は以下のようにして、ロールバックできる。svn revertと一緒。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git checkout &lt;target file name&gt;
</pre></div></div>

<h2>
<span id="リモートリポジトリとのシンク" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%A8%E3%81%AE%E3%82%B7%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>リモートリポジトリとのシンク</h2>

<p>チームプログラミングして、自分のローカル環境と、リモートリポジトリの内容をシンクしたい場合には以下のコマンドを使います。</p>

<h3>
<span id="リモートリポジトリからローカルのリポジトリへ変更を反映" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%8B%E3%82%89%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%AE%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%B8%E5%A4%89%E6%9B%B4%E3%82%92%E5%8F%8D%E6%98%A0"><i class="fa fa-link"></i></a>リモートリポジトリからローカルのリポジトリへ変更を反映</h3>

<p>自分が寝ている間に他の小人さんがソースに加えた変更を自分のリポジトリに反映します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git pull
</pre></div></div>

<h3>
<span id="リモートリポジトリへローカルで編集した内容の反映" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%B8%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%A7%E7%B7%A8%E9%9B%86%E3%81%97%E3%81%9F%E5%86%85%E5%AE%B9%E3%81%AE%E5%8F%8D%E6%98%A0"><i class="fa fa-link"></i></a>リモートリポジトリへローカルで編集した内容の反映</h3>

<p>ある程度ローカルで編集した内容をリモートリポジトリに反映するときに使います。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git push
</pre></div></div>

<p>ローカルのタグのpushは</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git push --tags
$ git push origin &lt;tagname&gt;
</pre></div></div>

<h3>
<span id="ブランチで作業しているときのpushとpull" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%A7%E4%BD%9C%E6%A5%AD%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AEpush%E3%81%A8pull"><i class="fa fa-link"></i></a>ブランチで作業しているときのpushとpull</h3>

<h4>
<span id="remoteのブランチへの変更を取得するとき" class="fragment"></span><a href="#remote%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%B8%E3%81%AE%E5%A4%89%E6%9B%B4%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D"><i class="fa fa-link"></i></a>remoteのブランチ（への変更）を取得するとき</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git pull origin &lt;branchname&gt;
$ git checkout &lt;branchname&gt;
</pre></div></div>

<p>checkoutは、まだそのブランチに移行していないとき実行する。すでにそのブランチで作業しているときはいらない。</p>

<h4>
<span id="ブランチのremoteへのpush" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AEremote%E3%81%B8%E3%81%AEpush"><i class="fa fa-link"></i></a>ブランチのremoteへのpush</h4>

<p>ブランチのpushは以下で実行する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git push origin &lt;branchname&gt;
</pre></div></div>

<p>基本的には、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git push/pull origin &lt;tagname&gt;
</pre></div></div>

<p>だということさえ覚えておけば、後の開発方法は一緒である。自分がいま、どのブランチで作業しているかは以下を実行して調べられる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git branch
</pre></div></div>

<h1>
<span id="知っておくと便利だけどだいたい使わず忘れるコマンド" class="fragment"></span><a href="#%E7%9F%A5%E3%81%A3%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%A8%E4%BE%BF%E5%88%A9%E3%81%A0%E3%81%91%E3%81%A9%E3%81%A0%E3%81%84%E3%81%9F%E3%81%84%E4%BD%BF%E3%82%8F%E3%81%9A%E5%BF%98%E3%82%8C%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>知っておくと便利だけど、だいたい使わず忘れるコマンド</h1>

<h2>
<span id="アーカイブの作成" class="fragment"></span><a href="#%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>アーカイブの作成</h2>

<p>配布物をつくるときは以下のコマンドを使います。svn exportとだいたい同じ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git archive --format=tar --prefix=&lt;dir/&gt; HEAD | gzip &gt; &lt;path/to/repo.tar.gz&gt;
$ git archive --format=tar --prefix=&lt;dir/&gt; HEAD | bzip2 &gt; &lt;path/to/repo.tar.bz2&gt;
</pre></div></div>

<p>prefixには、archiveが解凍されたときのディレクトリ名が、にはtarballのパスが入ります。</p>

<h2>
<span id="タグの作成とタグづけされた状態への移行" class="fragment"></span><a href="#%E3%82%BF%E3%82%B0%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E3%82%BF%E3%82%B0%E3%81%A5%E3%81%91%E3%81%95%E3%82%8C%E3%81%9F%E7%8A%B6%E6%85%8B%E3%81%B8%E3%81%AE%E7%A7%BB%E8%A1%8C"><i class="fa fa-link"></i></a>タグの作成とタグづけされた状態への移行</h2>

<h3>
<span id="タグの一覧" class="fragment"></span><a href="#%E3%82%BF%E3%82%B0%E3%81%AE%E4%B8%80%E8%A6%A7"><i class="fa fa-link"></i></a>タグの一覧</h3>

<p>以下のコマンドで一覧を見ることが出来ます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git tag
</pre></div></div>

<h3>
<span id="タグの作成" class="fragment"></span><a href="#%E3%82%BF%E3%82%B0%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>タグの作成</h3>

<p>タグの作成。オプション付きだけど、以下のセットが便利です。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git tag -a &lt;tagname&gt; -m &lt;comment&gt;
</pre></div></div>

<p>tagnameにはタグの名前（たいてい、"v0.0.X"のような文字列が入ります）。commentにはコメントが入ります。</p>

<h3>
<span id="タグの反映" class="fragment"></span><a href="#%E3%82%BF%E3%82%B0%E3%81%AE%E5%8F%8D%E6%98%A0"><i class="fa fa-link"></i></a>タグの反映</h3>

<p>クローンしてきたリポジトリをタグ付けされた状態に戻すときに使います。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git checkout refs/tags/&lt;tagname&gt;
</pre></div></div>

<h2>
<span id="管理されているファイルの一覧を見る" class="fragment"></span><a href="#%E7%AE%A1%E7%90%86%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%80%E8%A6%A7%E3%82%92%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>管理されているファイルの一覧を見る</h2>

<p>初期のインポート時に、全部インポートしたか確認するときなどに便利．</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git ls-files
</pre></div></div>

<h2>
<span id="ブランチの作り方" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>ブランチの作り方</h2>

<h3>
<span id="ブランチの確認" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>ブランチの確認</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git branch
</pre></div></div>

<h3>
<span id="ブランチの作成" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>ブランチの作成</h3>

<p>&lt;new branch name&gt;という名前のブランチを作成します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git checkout -b &lt;new branch name&gt;
</pre></div></div>

<h3>
<span id="リモートブランチの取得" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>リモートブランチの取得</h3>

<p>リモートブランチの取得は以下のコマンドから実行する。git pullするとすごいことになるので、checkoutでやったほうが良い。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git checkout -b &lt;same branch name with remote&gt; origin/&lt;remote branch name&gt;
</pre></div></div>

<p>たとえば、developというリモートブランチがある場合、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git checkout -b develop origin/develop
</pre></div></div>

<p>となる。</p>

<h3>
<span id="ブランチの切り替え" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AE%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88"><i class="fa fa-link"></i></a>ブランチの切り替え</h3>

<p>&lt;branch name&gt;というブランチに切り替えます（そのブランチ名がない場合は作成します）</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git checkout &lt;branch name&gt;
</pre></div></div>

<h3>
<span id="ブランチの削除" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%AE%E5%89%8A%E9%99%A4"><i class="fa fa-link"></i></a>ブランチの削除</h3>

<p>&lt;the branch name to be removed.&gt;という名前のブランチを削除します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git branch -d &lt;the branch name to be removed.&gt;
</pre></div></div>

<h3>
<span id="リモートリポジトリへの反映" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%B8%E3%81%AE%E5%8F%8D%E6%98%A0"><i class="fa fa-link"></i></a>リモートリポジトリへの反映</h3>

<p>リモートリポジトリにブランチ&lt;branch name to be updated.&gt;をpushします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git commit -a -m “comments”
…
$ git push origin &lt;branch name to be updated.&gt;
</pre></div></div>

<p>githubのpullリクエストでよく使うので、覚えておきましょう。</p>

<h2>
<span id="githubとの密な連携" class="fragment"></span><a href="#github%E3%81%A8%E3%81%AE%E5%AF%86%E3%81%AA%E9%80%A3%E6%90%BA"><i class="fa fa-link"></i></a>githubとの密な連携</h2>

<p>githubとの連携をするなら、github拡張のhubを利用すると良い。コマンドラインからpull requestを行うなど、より密にgithubと連携できる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>## OSX
$ brew install hub
</pre></div></div>

<p>インストールはOSXなら上記のコマンドで、他のOSならバイナリが以下から入手できる．</p>

<ul>
<li><a href="https://github.com/github/hub/releases" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/github/hub/releases</a></li>
</ul>

<p>その後、.bash_profileに以下を設定すると、hubコマンドとしてgitを使用できる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>eval "$(hub alias -s)"
</pre></div></div>

<p>以下は新たに追加されるコマンドの一部</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>## clone
$ git clone hoge/geho
&gt; git clone https://github.com/hoge/geho.git
## pull-request
$ git pull-request
</pre></div></div>

<p>詳細なコマンドは以下を参照のこと</p>

<ul>
<li><a href="https://github.com/github/hub" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/github/hub</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>177</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/e7603c2eb65661369c3b">MarkdownとPandocを用いた簡易Latex環境の構築</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-16 21:33:44</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[LaTeX]</b> <b>[Mac]</b> <b>[Markdown]</b> <b>[PDF]</b> <b>[Pandoc]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>論文などの文章を書くとき、texを使う・・でも、軽いメモ書きとかミーティングログとか、毎週の報告書で書くにはちょっと手軽じゃない。一方、markdownは簡単で良いけど、ビュワーを通して見ないと整形されない。ソフトウェアのreadmeで使うには良いけど、普段のログをみんなで共有するとかドキュメントとして残すにはもう一歩足りない。</p>

<p>Word?なにそれ美味しいの？ってかそもそも、有料の時点で終わってる。（Office使いの人ごめんなさい。）</p>

<p>普段からログや文章を残す人・残したい人はツールやまとめる書式選びで日々悩んでいることと思います（僕だけか・・）。そんなあなたに普段の日常的な記録・ログ・報告の類はMarkdown記法でまとめておいて、必要に応じて、pdf化する方法を紹介します。なお、今回はtexフォーマットにしてから、pdf化する手順で紹介しますが、スタイルが質素なままで良ければ、そのままpdf化しても、html化しても構いません。</p>

<p>注意：方法は結構ギークなので、好きな方のみ採用してください。</p>

<h2>
<span id="markdownとpandocを用いた簡易latex環境" class="fragment"></span><a href="#markdown%E3%81%A8pandoc%E3%82%92%E7%94%A8%E3%81%84%E3%81%9F%E7%B0%A1%E6%98%93latex%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>MarkdownとPandocを用いた簡易Latex環境</h2>

<p>標題は難しい感じがしますが、やり方は至って簡単です。Pandocとはドキュメント変換ツールで、markdown、html、Latexを相互変換する便利なツールです。出力側はwordやpdfファイルをサポートしているので、簡単な書式で書いた文章の体裁を整えるにはうってつけのツールといえるでしょう。今回はこのツールを使って、texファイルを作り、pdf化するまでの手順を紹介します。なお、インストール方法以外はおそらくwindows, linuxでも共通なので、他のOSを使っている人でも同じような作業で導入できると思います。</p>

<h3>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h3>

<p>homebrewを使ってインストールする方法もありますが、時間がかかるので、mac版のインストーラを使ってインストールするのが便利です。</p>

<ul>
<li><a href="http://johnmacfarlane.net/pandoc/installing.html" class="autolink" rel="nofollow noopener" target="_blank">http://johnmacfarlane.net/pandoc/installing.html</a></li>
</ul>

<p>上記のページから、dmgファイルをダウンロードしてインストールしてください。もちろん、linux用のtarball, windowsのインストーラも提供されています。</p>

<h3>
<span id="ドキュメント変換" class="fragment"></span><a href="#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>ドキュメント変換</h3>

<p>ドキュメントの変換は以下のようなコマンドで行います。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pandoc readme.md -o readme.tex
</pre></div></div>

<p>readme.mdが入力、readme.texが出力です。入力したreadme.mdと出力されたreadme.texをそれぞれ以下に示します。</p>

<div class="code-frame" data-lang="gcc-machine-description">
<div class="code-lang"><span class="bold">readme.md</span></div>
<div class="highlight"><pre><span></span># はじめに

これはテストです。書式はgithubのmarkdownを採用しています。

# いろいろな書式

## subsection的な

* 箇条書きも対応してほしい
* itemizeとか毎回書くのまじでしんどい
    * 入れ子とかもサポートしてくれると良いよね

### subsubsection的な

1. もちろん、数字のサポートも必須でしょ
    * 違うアイテマイズの入れ子ももちろんサポートするよね

# リンク関係

[リンクはどうなるの？](http://localhost)

![画像とかはどうなるの？](sample.png)

# 文字書式

* これはイタリック体です*
* _これもイタリック体です_
* これはイタリック体になりません
* **これは太字です**
* __これも太字です__

&gt; 引用はどうなるんだろう

# 表はどうなる

|カラム1|カラム2|
|------|------|
|hoge|geho|
</pre></div>
</div>

<p>上記が以下のように変換されます。</p>

<div class="code-frame" data-lang="tex">
<div class="code-lang"><span class="bold">readme.tex</span></div>
<div class="highlight"><pre><span></span><span class="k">\section</span><span class="nb">{</span>はじめに<span class="nb">}</span><span class="k">\label</span><span class="nb">{</span>はじめに<span class="nb">}</span>

これはテストです。書式はgithubのmarkdownを採用しています。

<span class="k">\section</span><span class="nb">{</span>いろいろな書式<span class="nb">}</span><span class="k">\label</span><span class="nb">{</span>いろいろな書式<span class="nb">}</span>

<span class="k">\subsection</span><span class="nb">{</span>subsection的な<span class="nb">}</span><span class="k">\label</span><span class="nb">{</span>subsection的な<span class="nb">}</span>

<span class="k">\begin</span><span class="nb">{</span>itemize<span class="nb">}</span>
<span class="k">\itemsep</span>1pt<span class="k">\parskip</span>0pt<span class="k">\parsep</span>0pt
<span class="k">\item</span>
  箇条書きも対応してほしい
<span class="k">\item</span>
  itemizeとか毎回書くのまじでしんどい

  <span class="k">\begin</span><span class="nb">{</span>itemize<span class="nb">}</span>
  <span class="k">\itemsep</span>1pt<span class="k">\parskip</span>0pt<span class="k">\parsep</span>0pt
  <span class="k">\item</span>
    入れ子とかもサポートしてくれると良いよね
  <span class="k">\end</span><span class="nb">{</span>itemize<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>itemize<span class="nb">}</span>

<span class="k">\subsubsection</span><span class="nb">{</span>subsubsection的な<span class="nb">}</span><span class="k">\label</span><span class="nb">{</span>subsubsection的な<span class="nb">}</span>

<span class="k">\begin</span><span class="nb">{</span>enumerate<span class="nb">}</span>
<span class="k">\def\labelenumi</span><span class="nb">{</span><span class="k">\arabic</span><span class="nb">{</span>enumi<span class="nb">}</span>.<span class="nb">}</span>
<span class="k">\itemsep</span>1pt<span class="k">\parskip</span>0pt<span class="k">\parsep</span>0pt
<span class="k">\item</span>
  もちろん、数字のサポートも必須でしょ

  <span class="k">\begin</span><span class="nb">{</span>itemize<span class="nb">}</span>
  <span class="k">\itemsep</span>1pt<span class="k">\parskip</span>0pt<span class="k">\parsep</span>0pt
  <span class="k">\item</span>
    違うアイテマイズの入れ子ももちろんサポートするよね
  <span class="k">\end</span><span class="nb">{</span>itemize<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>enumerate<span class="nb">}</span>

<span class="k">\section</span><span class="nb">{</span>リンク関係<span class="nb">}</span><span class="k">\label</span><span class="nb">{</span>リンク関係<span class="nb">}</span>

<span class="k">\href</span><span class="nb">{</span>http://localhost<span class="nb">}{</span>リンクはどうなるの？<span class="nb">}</span>

<span class="k">\begin</span><span class="nb">{</span>figure<span class="nb">}</span>[htbp]
<span class="k">\centering</span>
<span class="k">\includegraphics</span><span class="nb">{</span>sample.png<span class="nb">}</span>
<span class="k">\caption</span><span class="nb">{</span>画像とかはどうなるの？<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>figure<span class="nb">}</span>

<span class="k">\section</span><span class="nb">{</span>文字書式<span class="nb">}</span><span class="k">\label</span><span class="nb">{</span>文字書式<span class="nb">}</span>

<span class="k">\begin</span><span class="nb">{</span>itemize<span class="nb">}</span>
<span class="k">\itemsep</span>1pt<span class="k">\parskip</span>0pt<span class="k">\parsep</span>0pt
<span class="k">\item</span>
  これはイタリック体です*
<span class="k">\item</span>
  <span class="k">\emph</span><span class="nb">{</span>これもイタリック体です<span class="nb">}</span>
<span class="k">\item</span>
  これはイタリック体になりません
<span class="k">\item</span>
  <span class="k">\textbf</span><span class="nb">{</span>これは太字です<span class="nb">}</span>
<span class="k">\item</span>
  <span class="k">\textbf</span><span class="nb">{</span>これも太字です<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>itemize<span class="nb">}</span>

<span class="k">\begin</span><span class="nb">{</span>quote<span class="nb">}</span>
引用はどうなるんだろう
<span class="k">\end</span><span class="nb">{</span>quote<span class="nb">}</span>

<span class="k">\section</span><span class="nb">{</span>表はどうなる<span class="nb">}</span><span class="k">\label</span><span class="nb">{</span>表はどうなる<span class="nb">}</span>

<span class="k">\begin</span><span class="nb">{</span>longtable<span class="nb">}</span>[c]<span class="nb">{</span>@<span class="nb">{}</span>ll@<span class="nb">{}}</span>
<span class="k">\hline\noalign</span><span class="nb">{</span><span class="k">\medskip</span><span class="nb">}</span>
カラム1 <span class="nb">&amp;</span> カラム2
<span class="k">\\\noalign</span><span class="nb">{</span><span class="k">\medskip</span><span class="nb">}</span>
<span class="k">\hline\noalign</span><span class="nb">{</span><span class="k">\medskip</span><span class="nb">}</span>
hoge <span class="nb">&amp;</span> geho
<span class="k">\\\noalign</span><span class="nb">{</span><span class="k">\medskip</span><span class="nb">}</span>
<span class="k">\hline</span>
<span class="k">\end</span><span class="nb">{</span>longtable<span class="nb">}</span>
</pre></div>
</div>

<p>ほとんどのMarkdownの書式をtex変換してくれていることがわかると思います。ここまでできるなら、markdownで書いてtex変換するほうが楽だと言えるでしょう。</p>

<p>なお、出力されるのは、texでいう\begin{document}の後に続く部分です。ドキュメントのスタイルなどは、別途、元となるtexファイルにまとめておき、中で上記のtexファイルをincludeするようにしておくと、毎回書き直す必要がなく便利だと思います。</p>

<div class="code-frame" data-lang="tex">
<div class="code-lang"><span class="bold">manuscript.tex</span></div>
<div class="highlight"><pre><span></span><span class="k">\documentclass</span><span class="na">[11pt,a4paper,twocolumn]</span><span class="nb">{</span>jarticle<span class="nb">}</span>
<span class="c">%</span>
<span class="k">\usepackage</span><span class="nb">{</span>amsmath,amssymb<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>bm<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>graphicx<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>ascmac<span class="nb">}</span>
<span class="k">\usepackage</span><span class="na">[dvipdfm]</span><span class="nb">{</span>hyperref<span class="nb">}</span>

<span class="k">\title</span> <span class="nb">{</span>Weekly Report<span class="nb">}</span>
<span class="k">\author</span> <span class="nb">{</span>Yamamoto Tarou<span class="nb">}</span>

<span class="k">\begin</span> <span class="nb">{</span>document<span class="nb">}</span>
<span class="k">\maketitle</span>
<span class="k">\input</span> <span class="nb">{</span>readme<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>document<span class="nb">}</span>
</pre></div>
</div>

<p>注意：使っているパッケージやドキュメントクラスは用途に応じて、使い分けてください。今回はjarticleの2カラム版のドキュメントを生成するように書いています。</p>

<p>後は、latexコマンドを使って、ビルドするだけです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ platex manuscript.tex
$ dvipdfmx manuscript.dvi
</pre></div></div>

<hr>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pdflatex manuscript.tex
</pre></div></div>

<p>なお、文中の数式などもそのまま反映されることが確認済みです。もう少し頑張れば、論文などの執筆にも使える強力なツールになりそうです。</p>

<p>ついでに、論文のpdfをつくるときによく使うMakefileの中身をさらす。tableもなんとかしたいけど、これは次の課題。</p>

<div class="code-frame" data-lang="Makefile"><div class="highlight"><pre><span></span><span class="c"># -*- makefile -*-</span>

<span class="nv">TEX</span><span class="o">=</span>platex
<span class="nv">DVI2PDF</span><span class="o">=</span>dvipdfmx

<span class="nv">SOURCES</span> <span class="o">=</span> <span class="se">\</span>
    manuscript.tex <span class="se">\</span>
    <span class="k">$(</span>NULL<span class="k">)</span>

<span class="nv">MDSCRIPT</span> <span class="o">=</span> <span class="se">\</span>
    contents.md <span class="se">\</span>
    <span class="k">$(</span>NULL<span class="k">)</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">convertmd</span> <span class="n">dvi</span>2<span class="n">pdf</span> <span class="n">clean</span>

<span class="nf">convertmd</span><span class="o">:</span> <span class="k">$(</span><span class="nv">MDSCRIPT</span><span class="k">)</span>
    @cat $^ <span class="se">\</span>
    <span class="p">|</span> sed s/.png/.eps/g <span class="se">\</span>
    <span class="p">|</span> pandoc -t latex <span class="se">\</span>
    <span class="p">|</span> sed <span class="s1">'s/includegraphics/includegraphics[width=1.0\\columnwidth]/g'</span> <span class="se">\</span>
    <span class="p">|</span> sed <span class="s1">'s/\[htbp\]/\[t\]/g'</span> <span class="se">\</span>
    &gt; <span class="k">$(</span>MDSCRIPT:.md<span class="o">=</span>.tex<span class="k">)</span>

<span class="nf">.tex.dvi</span><span class="o">:</span> <span class="n">convertmd</span>
    @<span class="si">${</span><span class="nv">TEX</span><span class="si">}</span> $&lt;
    @<span class="si">${</span><span class="nv">TEX</span><span class="si">}</span> $&lt;  

<span class="nf">dvi2pdf</span><span class="o">:</span> <span class="k">$(</span><span class="nv">SOURCES</span>:.<span class="nv">tex</span>=.<span class="nv">dvi</span><span class="k">)</span>
    @<span class="si">${</span><span class="nv">DVI2PDF</span><span class="si">}</span> $^

<span class="nf">clean</span><span class="o">:</span> 
    @rm -f *.dvi *.aux *.log
</pre></div></div>

<p>図はtexではepsの方がよく、markdown上で確認するときはpngがよいので、両方出力するようにして、sedで変換するようにしている．また、図の位置はトップのみにしたいので、[htbp]から[t]に、graphicsの広さは、2カラムの文章が多いため、1.0\columnwidthとしている。</p>

<h2>
<span id="macで使う人に便利なツール" class="fragment"></span><a href="#mac%E3%81%A7%E4%BD%BF%E3%81%86%E4%BA%BA%E3%81%AB%E4%BE%BF%E5%88%A9%E3%81%AA%E3%83%84%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>Macで使う人に便利なツール</h2>

<p>Macの人限定ですが、Markdownの編集にはkobitoが便利です。</p>

<ul>
<li><a href="http://kobito.qiita.com/" rel="nofollow noopener" target="_blank">Kobito</a></li>
</ul>

<p>オープンにしてよい技術文章はQiitaで公開することもできるので、公開する場合は、Qiitaに内部で発表するにはTexでといった使い分けができます。また、編集した内容をDropboxなどで管理することで、複数のmac間でリソースを管理することもできます。</p>

<h2>
<span id="将来的には" class="fragment"></span><a href="#%E5%B0%86%E6%9D%A5%E7%9A%84%E3%81%AB%E3%81%AF"><i class="fa fa-link"></i></a>将来的には</h2>

<p>プレゼンなどもこの形式で作れたら、なお便利でしょうね。でも、pandocを使えばできそうなので、試してみて成功したら次回紹介します。</p>

<h2>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h2>

<ul>
<li><a href="http://qiita.com/Qiita/items/c686397e4a0f4f11683d" id="reference-ace6ecf448658b310b80">GithubのMarkdown書式</a></li>
<li><a href="http://qiita.com/yamakuda/items/5fdd269af54f83c6c64e" id="reference-98715fb8510369ccfdb8">Kobito+Dropbox</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>75</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/9d313a6a0a8f86f1d962">redmineでGitHubのMarkdown記法を利用する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-10 18:04:18</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[GitHub]</b> <b>[Markdown]</b> <b>[Redmine]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Redmine textileのフォーマットはいやだという人のために、いま流行りのGithub Markdown形式でredmineのwiki, チケットを編集するプラグインRedmine Redcarpet Markdown Formatterを紹介する。他にも似たプラグインはあるらしいけど、Githubとの互換性と高速性が特徴とのこと。</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<p>Redcarpet Formatterの動作にはRedcarpet 2.0.0b5以降のバージョンが必要とのことなので、バージョン指定でgemを使ってインストールする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo gem install --version 2.0.0b5 redcarpet
</pre></div></div>

<p>次に以下のサイトから、アクセスurlをコピーしてプラグインディレクトリにコピーする．</p>

<ul>
<li><a href="https://github.com/alminium/redmine_redcarpet_formatter" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/alminium/redmine_redcarpet_formatter</a></li>
</ul>

<p>注意：Redmine Markdown Formatterプラグインが既にインストールされている場合、正しく動作しません。Redmine Markdown Formatterプラグインをアンインストール(プラグインディレクトリを削除)してから利用してください。</p>

<p>redmineのプラグインディレクトリに移動し、git cloneする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd &lt;redmine&gt;
$ cd plugins
$ sudo git clone https://github.com/alminium/redmine_redcarpet_formatter.git
($ sudo chmod -R www-data.www-data redmine_redcarpet_formatter)
$ cd ..
$ sudo rake redmine:plugins:migrate RAILS_ENV=production
</pre></div></div>

<p>&lt;redmine&gt;にはそれぞれのredmineのルートディレクトリを代入すること。また、上記はubuntu環境を想定しているので、sudoが必要なかったり、chmodのユーザ・グループ名は各自読み替えたりする必要があります。（rakeのコマンドはredmine2.0以降のコマンドになります）</p>

<p>展開が終了したら、apacheを再起動します（redmineがapache+passengerで運用されている場合に限ります）</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo apache2ctl restart
</pre></div></div>

<h2>
<span id="設定" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>設定</h2>

<p>基本的に設定はありません。アドミニストレータ権限のあるユーザが</p>

<p>「管理」→「設定」→「テキスト書式」</p>

<p>の部分をtextileから、markdownに変更するだけです。</p>

<p>注意：変更するとこれまで編集してきたwikiのフォーマットをすべて入れ替える必要があります。</p>

<h2>
<span id="その他tips" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96tips"><i class="fa fa-link"></i></a>その他、Tips</h2>

<p>redmine固有と思われる記法への対応を挙げておきます。</p>

<h3>
<span id="アップロードした画像へのリンク" class="fragment"></span><a href="#%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89%E3%81%97%E3%81%9F%E7%94%BB%E5%83%8F%E3%81%B8%E3%81%AE%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>アップロードした画像へのリンク</h3>

<ul>
<li>元の記法</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>!imagefile.png!
</pre></div></div>

<ul>
<li>Markdown記法</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>![title](imagefile.png)
</pre></div></div>

<h2>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>　参考文献</h2>

<ul>
<li><a href="http://www.r-labs.org/projects/r-labs/wiki/Redcarpet_Formatter" class="autolink" rel="nofollow noopener" target="_blank">http://www.r-labs.org/projects/r-labs/wiki/Redcarpet_Formatter</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>70</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/a04ebc4f8c27c226bbff">今更聞けない目的別soxの使い方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-30 20:18:07</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[sox]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>soxは、音声ファイルをコマンドラインから加工・変換することができる便利なコマンドだ。フォーマットの変換などはmanを見ずにできるが、ある程度込み入った処理をするとなった途端、Googleでいくつものページを見返すことになって不便なので、ここに過去に使ったコマンドとそのオプションの備忘録を残しておく。</p>

<h1>
<span id="オーディオ形式の変換" class="fragment"></span><a href="#%E3%82%AA%E3%83%BC%E3%83%87%E3%82%A3%E3%82%AA%E5%BD%A2%E5%BC%8F%E3%81%AE%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>オーディオ形式の変換</h1>

<p>最も多い使い方、wavファイルから、mp3などに変換するパターン。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sox &lt;input&gt;.wav &lt;output&gt;.mp3
</pre></div></div>

<p>またはその逆。あまり多く使わないと思いきや、プログラムで使うライブラリや、パッケージがサポートしている音楽ファイル形式がまちまちで頼ることがしばしばある。</p>

<p>上記の場合、ただ変換するだけでなく、サンプルレートは16kでモノラルじゃないと動かないとか言う場合もある。そういった場合は、エフェクトをかけて、変換を行う。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sox &lt;input&gt;.mp3 &lt;output&gt;.wav channels 1 rate 16k
</pre></div></div>

<p>録音音声がraw（ヘッダレス）形式でwavに変換を行う場合、rawのタイプ指定を行う必要がある場合もある。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sox -r 16k -e signed -b 8 -c 1 &lt;input&gt;.raw &lt;output&gt;.wav
</pre></div></div>

<p>こんなもんだろうか。他にも遭遇した場合はまた追記していくことにする。</p>

<h1>
<span id="結合" class="fragment"></span><a href="#%E7%B5%90%E5%90%88"><i class="fa fa-link"></i></a>結合</h1>

<p>2つの音楽ファイルを結合する場合はこちら。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sox &lt;input1&gt;.wav &lt;input2&gt;.wav &lt;output&gt;.wav
</pre></div></div>

<h1>
<span id="混合" class="fragment"></span><a href="#%E6%B7%B7%E5%90%88"><i class="fa fa-link"></i></a>混合</h1>

<p>2つの音楽ファイルを混合する場合、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sox -m &lt;input1&gt;.wav &lt;input2&gt;.wav &lt;output&gt;.wav
</pre></div></div>

<h1>
<span id="x倍再生" class="fragment"></span><a href="#x%E5%80%8D%E5%86%8D%E7%94%9F"><i class="fa fa-link"></i></a>X倍再生</h1>

<p>スロー再生とか高速再生とかしたい場合はこちら（例は1.2倍、速くなる）。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sox &lt;input&gt;.wav &lt;output&gt;.wav speed 1.2
</pre></div></div>

<h1>
<span id="トリミング" class="fragment"></span><a href="#%E3%83%88%E3%83%AA%E3%83%9F%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>トリミング</h1>

<p>長い音楽ファイルの一部だけを取り出すトリミング作業をするときのコマンドオプション。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sox &lt;input&gt; &lt;output&gt; trim &lt;start&gt; &lt;end&gt;
</pre></div></div>

<p>それぞれ</p>

<ul>
<li>input: 入力ファイルのパス</li>
<li>output: 出力ファイルのパス</li>
<li>start: 開始秒</li>
<li>end: 終了秒</li>
</ul>

<p>になる。</p>

<h1>
<span id="正規化" class="fragment"></span><a href="#%E6%AD%A3%E8%A6%8F%E5%8C%96"><i class="fa fa-link"></i></a>正規化</h1>

<p>何かの理由で、再生するソースの音量がとても小さい or 大きい場合に音量を正規化するコマンドオプション。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sox &lt;input&gt; &lt;output&gt; norm
</pre></div></div>

<h1>
<span id="何気に優秀なplayコマンド" class="fragment"></span><a href="#%E4%BD%95%E6%B0%97%E3%81%AB%E5%84%AA%E7%A7%80%E3%81%AAplay%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>何気に優秀なplayコマンド</h1>

<p>Linuxなどで音楽や音声ファイルを再生するコマンドラインは、alsa playerが有名だが、soxを入れたときについてくるplayコマンドは、soxの処理を入れながら再生することが出来るため、ちょっと凝った処理をしたい場合に威力を発揮する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ play &lt;input&gt; trim &lt;start&gt; &lt;end&gt;
</pre></div></div>

<p>簡易的な音再生プログラムを作りたい場合は、popenでこれを呼び出すとかなり時間節約できるかも・・</p>

<h1>
<span id="対となるrecコマンド" class="fragment"></span><a href="#%E5%AF%BE%E3%81%A8%E3%81%AA%E3%82%8Brec%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>対となるrecコマンド</h1>

<p>再生(play)ができるなら、録音もできるでしょという感覚は正解でもちろん、録音用のコマンドも提供されている（ただ、どちらもsoxのショートカットにすぎない）</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rec -c 1 -r 16k output.wav trim 0 360
</pre></div></div>

<p>上記は、1チャンネル、サンプルレート16kHzで360秒、wavファイルを録音するときのコマンド。録音時間を指定できるのは以外と便利だったりする。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>58</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/16373094e2c41b512783">MavericksでのMySQLの運用</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-31 17:45:57</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[MySQL]</b> <b>[homebrew]</b> <b>[mavericks]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>Mavericksに限ってはいないけど、Mac OS Xで開発しているときに、自分のマシンローカルにmysqlサーバをたててテストしたくなるときがある。homebrewで割と簡単にインストール・運用できるのだけど、開発するプロジェクトが変わると、初期化・再インストールしたくなることがある。ところが、インストール方法は結構書いてあるけど、アンインストールする方法は探さないとでてこないので、ここに備忘録として残しておく。</p>

<p>なお、インストールにはhomebrewを使う。</p>

<h1>
<span id="インストール方法" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>インストール方法</h1>

<p>インストール方法はいたって標準。brew installの後も、インストール時にでてくるインストラクションメッセージに従うだけ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew install mysql
$ unset TMPDIR
$ mysql_install_db --verbose --user=`whoami` --basedir="$(brew --prefix mysql)" --datadir=/usr/local/var/mysql --tmpdir=/tmp
$ mysql.server start
$ /usr/local/Cellar/mysql/5.5.10/bin/mysql_secure_installation
</pre></div></div>

<h1>
<span id="インストール後の設定" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E5%BE%8C%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>インストール後の設定</h1>

<h2>
<span id="mycnfの場所" class="fragment"></span><a href="#mycnf%E3%81%AE%E5%A0%B4%E6%89%80"><i class="fa fa-link"></i></a>my.cnfの場所</h2>

<p>デフォルトのmy.cnfの場所は変更されない限りは以下の通り</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/usr/local/opt/mysql/my.cnf
</pre></div></div>

<h2>
<span id="リモートからのアクセス方法" class="fragment"></span><a href="#%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%81%8B%E3%82%89%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>リモートからのアクセス方法</h2>

<p>ローカルの検証をして、サーバを閉じようとすると、他の人から使わせてくれと言われ、なし崩し的にテストSQLサーバになることも結構、多いのではないだろうか。ここではリモートからのアクセスを許可する設定の備忘録を残しておく。大抵のサイトでは、以下のうちひとつしか解説していないことが多く、意外とはまるのだ・・</p>

<h3>
<span id="mysql内の設定" class="fragment"></span><a href="#mysql%E5%86%85%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>MySQL内の設定</h3>

<p>他のサイトからのアクセス(privilege)を許可する必要がある。</p>

<div class="code-frame" data-lang="mysql"><div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">-</span><span class="n">p</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">grant</span> <span class="k">all</span> <span class="n">privileges</span> <span class="k">on</span> <span class="o">&lt;</span><span class="k">database</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">*</span> <span class="k">to</span> <span class="n">root</span><span class="o">@</span><span class="s2">"%"</span> <span class="n">identified</span> <span class="k">by</span> <span class="err">‘</span><span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span><span class="err">’</span> <span class="k">with</span> <span class="k">grant</span> <span class="k">option</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="nf">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">04</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">flush</span> <span class="n">privileges</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="n">rows</span> <span class="nf">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">quit</span>
</pre></div></div>

<p>database name, passwordにはそれぞれ、許可したいデータベース名、パスワードが入る。</p>

<h3>
<span id="mycnfの設定" class="fragment"></span><a href="#mycnf%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>my.cnfの設定</h3>

<p>以外と忘れがちなのが、my.cnfの設定で、以下の行をmysqldの設定の下に追加する必要がある。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">my.cnf</span></div>
<div class="highlight"><pre><span></span>[mysqld]
bind-address=&lt;your server ip&gt;
</pre></div>
</div>

<p>your server ipには、ホストマシンのIPアドレスが入る。</p>

<p>その後、mysqlサーバを再起動すること。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mysql.server resart
</pre></div></div>

<h1>
<span id="アンインストール方法" class="fragment"></span><a href="#%E3%82%A2%E3%83%B3%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>アンインストール方法</h1>

<p>アンインストール方法は以下の通り。この作業を行った後、インストール作業を再度実行することで再インストールすることができる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>brew remove mysql
brew cleanup
launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist
rm ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist
sudo rm -rf /usr/local/var/mysql
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>48</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/4bba761f06592ce1f4ce">Mac OS Xでのvagrant運用</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-01 12:50:03</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> <b>[vagrant]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>vagrant + virtualboxはコマンドラインベースでバーチャルマシンを立ち上げ、ソフトウェアのテストができる便利なツールだ。ただ、chefなどとの組み合わせも書いているページが多く、いろいろなページに分散して情報が載っていて不便なので、自分が使うとこだけログ代わりにまとめていくことにする。</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<p>VirtualBoxとVagrantをインストールする。</p>

<ul>
<li><a href="https://www.virtualbox.org/wiki/Downloads" class="autolink" rel="nofollow noopener" target="_blank">https://www.virtualbox.org/wiki/Downloads</a></li>
<li><a href="http://downloads.vagrantup.com/" class="autolink" rel="nofollow noopener" target="_blank">http://downloads.vagrantup.com/</a></li>
</ul>

<p>それぞれのサイトから、dmgを持ってきて、それぞれインストールする。</p>

<h2>
<span id="セットアップ" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>セットアップ</h2>

<p>セットアップは基本的に以下の手順で行う。</p>

<ul>
<li>仮想環境の登録</li>
<li>ハンドル用のディレクトリの作成と初期化</li>
</ul>

<h3>
<span id="仮想環境の登録" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E7%92%B0%E5%A2%83%E3%81%AE%E7%99%BB%E9%8C%B2"><i class="fa fa-link"></i></a>仮想環境の登録</h3>

<p>仮想環境は、外からダウンロードして登録するらしい。以下のサイトにいろいろな仮想環境（Linuxディストリビューション）がころがっているので、必要な環境を登録しておく。</p>

<ul>
<li><a href="http://www.vagrantbox.es/" class="autolink" rel="nofollow noopener" target="_blank">http://www.vagrantbox.es/</a></li>
</ul>

<p>ここでは、Ubuntu12.04をダウンロードして登録することにする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant box add ubuntu12.04 http://cloud-images.ubuntu.com/vagrant/precise/current/precise-server-cloudimg-i386-vagrant-disk1.box
</pre></div></div>

<p>4つめの引数は登録名になるので、自分で分かりやすい登録名を登録しておきましょう。ubuntuの複数のバージョンを使いたい場合など、"ubuntu"などという名前で登録すると後で面倒になります。また、ダウンロードするため、登録にはそれなりの時間がかかるので、まとまった時間を確保して行いましょう。</p>

<h3>
<span id="ハンドル用のディレクトリの作成と初期化" class="fragment"></span><a href="#%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AB%E7%94%A8%E3%81%AE%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E5%88%9D%E6%9C%9F%E5%8C%96"><i class="fa fa-link"></i></a>ハンドル用のディレクトリの作成と初期化</h3>

<p>ホームディレクトリにでも、vagrantというディレクトリを作って、初期化する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir vagrant
$ cd vagrant
$ vagrant init ubuntu12.04
</pre></div></div>

<p>登録されたいずれかの環境で初期化するので、複数の環境を運用する場合は、ディレクトリ名を考えましょう。</p>

<h2>
<span id="基本の使い方" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>基本の使い方</h2>

<p>基本的な使い方は以下の通りである</p>

<h3>
<span id="仮想環境の立ち上げ" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E7%92%B0%E5%A2%83%E3%81%AE%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92"><i class="fa fa-link"></i></a>仮想環境の立ち上げ</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant up
</pre></div></div>

<h3>
<span id="仮想環境へのアクセス" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E7%92%B0%E5%A2%83%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9"><i class="fa fa-link"></i></a>仮想環境へのアクセス</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant ssh
</pre></div></div>

<h3>
<span id="仮想環境の停止" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E7%92%B0%E5%A2%83%E3%81%AE%E5%81%9C%E6%AD%A2"><i class="fa fa-link"></i></a>仮想環境の停止</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant halt
</pre></div></div>

<h3>
<span id="仮想環境のサスペンド" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E7%92%B0%E5%A2%83%E3%81%AE%E3%82%B5%E3%82%B9%E3%83%9A%E3%83%B3%E3%83%89"><i class="fa fa-link"></i></a>仮想環境のサスペンド</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant suspend
</pre></div></div>

<h2>
<span id="ロールバックとスナップショット" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%A8%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>ロールバックとスナップショット</h2>

<p>基本的な使い方はできたとはいえ、本当にやりたいのは、クリーンインストール環境でソフトウェアの確認を行いたいことだったりするので、ロールバックやスナップショットの機能を入れる</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant plugin install sahara
$ vagrant plugin install vagrant-vbox-snapshot
</pre></div></div>

<h3>
<span id="ロールバック" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF"><i class="fa fa-link"></i></a>ロールバック</h3>

<p>ロールバックを試すには、</p>

<ol>
<li>sandboxモードに入る</li>
<li>適当に作業</li>
<li>正否によって以下を実行

<ul>
<li>失敗してロールバックしたい場合、ロールバックを実行</li>
<li>成功して保存したい場合は現在の状態を反映する</li>
</ul>
</li>
</ol>

<p>という手順を踏む。以下、必要になるコマンドを示す。</p>

<h4>
<span id="sandboxモードに入る" class="fragment"></span><a href="#sandbox%E3%83%A2%E3%83%BC%E3%83%89%E3%81%AB%E5%85%A5%E3%82%8B"><i class="fa fa-link"></i></a>sandboxモードに入る</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant sandbox on
</pre></div></div>

<h4>
<span id="ロールバック-1" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF-1"><i class="fa fa-link"></i></a>ロールバック</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant sandbox rollback
</pre></div></div>

<h4>
<span id="変更を反映" class="fragment"></span><a href="#%E5%A4%89%E6%9B%B4%E3%82%92%E5%8F%8D%E6%98%A0"><i class="fa fa-link"></i></a>変更を反映</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant sandbox commit
</pre></div></div>

<h3>
<span id="スナップショット" class="fragment"></span><a href="#%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>スナップショット</h3>

<p>スナップショットは、仮想マシンのある状態を保存しておく機能だ。環境構築や共通の作業をしたところまでのスナップショットをとっておき、そのスナップショットを使って環境を作ると、同じ手順を何回も繰り返さずに済み、便利である。</p>

<h4>
<span id="snapshotの作成" class="fragment"></span><a href="#snapshot%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>Snapshotの作成</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vargrant snapshot take hoge
</pre></div></div>

<h4>
<span id="snapshotの確認" class="fragment"></span><a href="#snapshot%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>Snapshotの確認</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant snapshot list
</pre></div></div>

<h4>
<span id="最新のsnapshotへ戻す" class="fragment"></span><a href="#%E6%9C%80%E6%96%B0%E3%81%AEsnapshot%E3%81%B8%E6%88%BB%E3%81%99"><i class="fa fa-link"></i></a>最新のSnapshotへ戻す</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant snapshot back
</pre></div></div>

<h4>
<span id="特的のsnapshotへ戻す" class="fragment"></span><a href="#%E7%89%B9%E7%9A%84%E3%81%AEsnapshot%E3%81%B8%E6%88%BB%E3%81%99"><i class="fa fa-link"></i></a>特的のSnapshotへ戻す</h4>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant snapshot go hoge
</pre></div></div>

<h3>
<span id="ssh-configの設定" class="fragment"></span><a href="#ssh-config%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>ssh-configの設定</h3>

<p>指定ディレクトリに入れなくても、立ち上げた仮想環境にsshログインできるように設定をconfigファイルに書き込むと楽です。また、X11を使ったアクセスなどをしたい場合に必要になります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant ssh-config --host ubuntu12.04 &gt;&gt; ~/.ssh/config
</pre></div></div>

<h2>
<span id="仮想環境のパッケージ化" class="fragment"></span><a href="#%E4%BB%AE%E6%83%B3%E7%92%B0%E5%A2%83%E3%81%AE%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E5%8C%96"><i class="fa fa-link"></i></a>仮想環境のパッケージ化</h2>

<p>すべての環境に必要なソフトウェアのインストールを一からやるのは効率が悪い。そこで、一定の作業を終えた仮想環境をパッケージ化して他の仮想環境に適用できると便利だ。それを実行するのが以下のコマンド</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ vagrant package
$ vagrant box add copy package.box
</pre></div></div>

<p>一つ目のコマンドで、まず現在の仮想環境のコピーがpackage.boxという名前で作成される。二つ目のコマンドでは、生成されたpackage.boxに基づいて、新しい環境copyを作成している。これで、一から環境をインストールすることなく、作業を開始できる。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>47</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/1dba3fe497b4d350d18e">sublimeから、ssh経由で別のマシンのソースを編集する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-10 16:15:49</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[SSH]</b> <b>[ftp]</b> <b>[sublime]</b> <b>[sftp]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>前に後輩と、vi, emacs, sublimeの比較話をしていたときに、ssh経由でファイル編集する方法がemacsであるよという話をし、そういえば、sublimeではできないのかと思い出した。<br>
もちろんできます。ということでやってみよう。</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<p>今回使うのは、SFTP Packageというもの、これはssh経由、ftp経由で指定したディレクトリをローカルとシンクし、アップロードできるというパッケージ。<br>
Package Control: Install Packageから、SFTPで検索すればでてくるので、インストール。コマーシャル版だそうだけど、扱いはsublimeと同等で基本的にFreeで使える模様。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>まずローカルのディレクトリに、シンクさせるためのディレクトリを用意します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir sftpsync
</pre></div></div>

<p>サイドバーのプロジェクトフォルダを右クリックし、「SFTP/FTP」→「Map to Remote」を選択します。</p>

<p>すると、「sftp-config.json」という設定ファイルがプロジェクトフォルダのルートにできるので、このファイルを編集してサーバ情報などを設定していきます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>  1. {
  2. // The tab key will cycle through the settings when first created
  3. // Visit http://wbond.net/sublime_packages/sftp/settings for help
  4. // sftp, ftp or ftps
  5. "type": "sftp",
  6.  
  7. "save_before_upload": true,
  8. "upload_on_save": false,
  9. "sync_down_on_open": false,
  10. "sync_skip_deletes": false,
  11. "confirm_downloads": false,
  12. "confirm_sync": true,
  13. "confirm_overwrite_newer": false,
  14. "host": "example.com",
  15. "user": "username",
  16. //"password": "password",
  17. //"port": "22",
  18. "remote_path": "/example/path/",
  19. "ignore_regexes": [
  20. "\\.sublime-(project|workspace)", "sftp-config(-alt\\d?)?\\.json",
  21. "sftp-settings\\.json", "/venv/", "\\.svn", "\\.hg", "\\.git",
  22. "\\.bzr", "_darcs", "CVS", "\\.DS_Store", "Thumbs\\.db", "desktop\\.ini"
  23. ],
  24. //"file_permissions": "664",
  25. //"dir_permissions": "775",
  26. //"extra_list_connections": 0,
  27.  
  28. "connect_timeout": 30,
  29. //"keepalive": 120,
  30. //"ftp_passive_mode": true,
  31. //"ssh_key_file": "~/.ssh/id_rsa",
  32. //"sftp_flags": ["-F", "/path/to/ssh_config"],
  33. //"preserve_modification_times": false,
  34. //"remote_time_offset_in_hours": 0,
  35. //"remote_encoding": "utf-8",
  36. //"remote_locale": "C",
  37. }
</pre></div></div>

<p>上記のhost, user, remote_pathを自分の設定にして保存します。</p>

<p>注意：remote_pathはsyncしたサーバ側のディレクトリの絶対パスを指定してください。また、指定したディレクトリ下をすべてsyncするので、大量のデータが入っているディレクトリを扱う場合は注意が必要です。</p>

<p>次に、remoteにあるディレクトリをローカルに持ってきます。サイドバーにあるディレクトリを右クリック。SFTP/FTPのタブを開き、Sync Remote -&gt; Local… を実行します。syncプロセスの後、サーバサイドのソースがローカルにsyncされます。後は編集し、上記、画面のUpload FolderやファイルごとにUpload Fileを行うことで、編集したデータをサーバサイドに反映することができます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>31</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/9d87d793a493295e08f0">gitolite: ライトユースなリモートgitリポジトリを作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-20 18:30:21</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[Git]</b> <b>[gitolite]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>github以外でリモートのgitリポジトリを作りたくなったことはないだろうか？自分のローカルのソースを会社や研究室の誰かと共有したくなったとき、でもメインのリポジトリはsubversionで運用されていてgitのはない。対して、githubで有料なプライベートgitリポジトリを持つほどではない。そんなリクエストを持つライトユースなgitリポジトリをgitoliteで作る方法を紹介します。</p>

<p>※なお、ここではクライアントはLinux, Mac OS X、サーバはubuntuで作業する前提で話を進めます。Windowsでも作業内容自体は変わらないと思いますが、コマンドラインベースには進めないと思うので、割愛します。</p>

<h1>
<span id="インストール方法" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>インストール方法</h1>

<p>セットアップには、クライアントパソコン（自分のパソコン）でやる作業と、リポジトリをおくサーバサイドのパソコンでやる作業の２つがあります。</p>

<h2>
<span id="下準備クライアントパソコンで" class="fragment"></span><a href="#%E4%B8%8B%E6%BA%96%E5%82%99%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%83%91%E3%82%BD%E3%82%B3%E3%83%B3%E3%81%A7"><i class="fa fa-link"></i></a>下準備：クライアントパソコンで</h2>

<p>まず、サーバのリポジトリをセットアップするために、admin用の公開鍵、秘密鍵を作成する必要があります。admin用のものを作ってもかまわないし、自分の公開鍵・秘密鍵を転用してもかまいません。まだ、作っていない場合は以下のコマンドで作成します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ssh-keygen -t rsa -f &lt;keyname&gt;
</pre></div></div>

<p>keyname、keyname.pubという2つのファイルが作られます。そのうち、keyname.pubをサーバにコピーします。</p>

<h2>
<span id="サーバでのgitoliteのセットアップ" class="fragment"></span><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%81%A7%E3%81%AEgitolite%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>サーバでのgitoliteのセットアップ</h2>

<p>サーバマシンがubuntuであると想定して、gitoliteをインストールし、セットアップします。事前にカレントディレクトリに上記のkeyname.pubがコピーされているとするとセットアップは以下のコマンド群でできます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo apt-get install gitolite
$ sudo adduser --system --disabled-password --shell /bin/bash --group gitolite --home /var/gitolite
$ sudo -H -u gitolite gl-setup keyname.pub
</pre></div></div>

<p>上から</p>

<ul>
<li>gitoliteのインストール</li>
<li>パスワードなし、ホームディレクトリが/var/gitoliteにあるgitoliteユーザを作成</li>
<li>gitoliteコマンドを使ったセットアップ</li>
</ul>

<p>を行っています。</p>

<p>ユーザの作成時点では、ホームディレクトリなど各ユーザで入れたいところが異なると思うので、適宜変更してください。</p>

<p>また、<code>gl-setup</code>はセットアップ途中で、viを用いて設定ファイルの確認を行います。vimでもないため、viユーザ以外は使いにくい。確認用のエディタを変更したい場合は以下のようにすると良いでしょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo -H -u gitolite EDITOR=emacs gl-setup keyname.pub
</pre></div></div>

<p>上記は、エディタとしてemacsを設定している例です。成功すると、以下のファイル・ディレクトリが作成されます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>├── .gitolite
├── .gitolite.rc
├── projects.list
├── repositories
</pre></div></div>

<h1>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h1>

<h2>
<span id="基本公開鍵秘密鍵の設定" class="fragment"></span><a href="#%E5%9F%BA%E6%9C%AC%E5%85%AC%E9%96%8B%E9%8D%B5%E7%A7%98%E5%AF%86%E9%8D%B5%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>基本：公開鍵・秘密鍵の設定</h2>

<p>何はともあれ、秘密鍵を設定して、ssh経由でリポジトリにアクセスする必要があります。作成した秘密鍵を.ssh以下に配置しましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cp keyname ~/.ssh/id_rsa
$ chmod 600 ~/.ssh/id_rsa
</pre></div></div>

<h2>
<span id="管理者のお仕事" class="fragment"></span><a href="#%E7%AE%A1%E7%90%86%E8%80%85%E3%81%AE%E3%81%8A%E4%BB%95%E4%BA%8B"><i class="fa fa-link"></i></a>管理者のお仕事</h2>

<p>管理者のお仕事は、</p>

<ul>
<li>ユーザの追加</li>
<li>作られたリポジトリのアクセス権の制御</li>
</ul>

<p>です。この作業を設定ファイルをまとめるリポジトリを編集することで行います。まず、管理者用のリポジトリgitolite-adminのクローンを自分のマシンに作成します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>git clone gitolite@&lt;hostname&gt;:gitolite-admin
</pre></div></div>

<p>成功すると以下のディレクトリ構成が得られます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>├── conf
│   └── gitolite.conf
└── keydir
    ├── username.pub
</pre></div></div>

<p>ユーザの追加はkeydirの中にアクセスしたいユーザの公開鍵を作ってもらって、それを配置することで行います。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cp username.pub keydir/.
$ git add keydir/username.pub
$ git commit -m "add user, &lt;username&gt;"
$ git push
</pre></div></div>

<p>上記では、公開鍵をkeydirに配置し、リポジトリに登録、コミットしてその設定をリモートリポジトリに反映しています。</p>

<p>次にリポジトリのアクセス権は、conf/gitolite.confを編集することで行います。conf/gitolite.confの内容は以下のようになっており、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>repo    gitolite-admin
        RW+     =   username

repo    testing
        RW+     =   @all

repo    hoge
        RW+     =   @all

</pre></div></div>

<p>各リポジトリの定義とそのアクセス権が設定されています。現状、testing, hogeというプロジェクトに対して、すべてのユーザがアクセスできるという定義になっています。このアクセス権はこの設定ファイルを編集することで変更することができ、例えば、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>repo    hoge
        RW+     =   username
</pre></div></div>

<p>とすることで、hogeというリポジトリにはusernameというユーザのみがアクセスできるようにアクセス権を変更することができます。</p>

<h2>
<span id="ユーザのお仕事" class="fragment"></span><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%AE%E3%81%8A%E4%BB%95%E4%BA%8B"><i class="fa fa-link"></i></a>ユーザのお仕事</h2>

<p>ユーザがする作業は大きく分けて、</p>

<ol>
<li>公開鍵を管理者に渡して、ユーザ登録してもらう</li>
<li>必要なリポジトリを作成する</li>
<li>作成したリポジトリを使って、コーディングする</li>
</ol>

<p>の3つです。最初の作業は公開鍵・秘密鍵の作り方自体は前述で紹介したので、作成した公開鍵を管理者に渡してください。次に、自分のローカルで作成しているリポジトリをリモートリポジトリに反映します。なお、git pushが反映されるためには、事前に管理者が上記のgitolite.confに対応するリポジトリ（下記の場合、project）を作成していなければなりません。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd &lt;project&gt;
$ git remote add origin gitolite@&lt;hostname&gt;:&lt;project&gt;
$ git push origin master
</pre></div></div>

<p>管理者からユーザの追加最後の作業はgit共通の作業なので割愛します。以下を参照してください。</p>

<ul>
<li><a href="http://qiita.com/mountcedar/items/682743c95fd3b8fc274b" class="autolink" id="reference-cb6a5fb241e9bbcbef17">http://qiita.com/mountcedar/items/682743c95fd3b8fc274b</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>26</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/e20251b811b491666d48">Guavaライブラリのconcurrentパッケージの使い方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-22 15:36:19</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[guava]</b> <b>[concurrent]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>GuavaライブラリはJavaにおけるコーディングを簡単化するための様々なユーティリティを提供するライブラリである．Googleの多くのJavaベースのプロジェクトで使用されているらしく、apacheのcommonsライブラリと似た機能を提供する．</p>

<p>このページは、自分でGuavaライブラリを使ってみて使い方が分かったものから随時まとめる備忘録である．書き始めとして、日本語や英語のブログを見てもなかなか見つからないcom.google.common.util.concurrentパッケージについてまとめる．確かに面倒だし、かなり大規模な実装プランがないと手を出さないかも知れないけど折角だからまとめてほしかったと他のブログを読んで思ったので、自分でまとめてみる．</p>

<p>concurrentパッケージは、スレッド制御に関する便利機能を提供するパッケージである．スレッドを直接制御するのではなく各種ExecutorServiceを作ることで様々なスレッド制御のテンプレートパターンを活用することができる．すべてを紹介することはできないが、ここでは、ListenableFutureについて紹介する（他のも使ったら、随時更新する予定である）</p>

<h1>
<span id="listenablefutureクラス" class="fragment"></span><a href="#listenablefuture%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>ListenableFutureクラス</h1>

<p>ListenableFutureは、従来のjava.util.concurrentのFutureクラスの拡張で、Futureは非同期計算（処理）の結果を扱うためのクラスである．計算が完了したかどうかのチェック、完了までの待機、計算結果の取得などを行うためのメソッドが用意されている．ListenableFutureは、計算が完了した後に、その結果を用いて次の処理を行うListenerを登録できるFutureクラスの拡張である．</p>

<ul>
<li><a href="http://www.javacodegeeks.com/2013/02/listenablefuture-in-guava.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.javacodegeeks.com/2013/02/listenablefuture-in-guava.html</a></li>
</ul>

<p>上記のjavacodegeeksで紹介されている例を簡略化した（urlのコンテンツへのアクセスは行わない）コード例を以下に示す（長いのでmain関数の中身のみ書くことにする）</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">URL</span><span class="o">[]</span> <span class="n">topSites</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">topSites</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">[]</span> <span class="o">{</span><span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"http://www.google.com"</span><span class="o">)};</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e1</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e1</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>

<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"in main"</span><span class="o">);</span>
<span class="n">ListeningExecutorService</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">MoreExecutors</span><span class="o">.</span><span class="na">listeningDecorator</span><span class="o">(</span><span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>
<span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="n">URL</span> <span class="n">siteUrl</span> <span class="o">:</span> <span class="n">topSites</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"in call()"</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">siteUrl</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">});</span>

    <span class="n">future</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"listener[1]: {}"</span><span class="o">,</span> <span class="n">contents</span><span class="o">);</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"job completed."</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">},</span> <span class="n">pool</span><span class="o">);</span>

    <span class="n">future</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"listener[2]: {}"</span><span class="o">,</span> <span class="n">contents</span><span class="o">);</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"job completed."</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">},</span> <span class="n">pool</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">300</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
<span class="n">pool</span><span class="o">.</span><span class="na">shutdownNow</span><span class="o">();</span>
</pre></div></div>

<p>コード全体は以下を参照。<br>
* <a href="https://github.com/mountcedar/GuavaTest/blob/master/src/concurrent/App.java" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mountcedar/GuavaTest/blob/master/src/concurrent/App.java</a></p>

<p>コードの処理内容を以下にまとめる．</p>

<ul>
<li>urlの配列を作る</li>
<li>urlを文字列化して100ms待つCallableインタフェースの登録、実行を行い、ListenableFutureを得る</li>
<li>得られたListenableFutureに対して結果文字列を出力して、100ms待つ処理を行うListenerを2つ登録する</li>
<li>すべての処理が終わるまで待って、終了する</li>
</ul>

<p>このソースの実行結果を以下に示す．</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>14:55:58.286 [main] DEBUG concurrent.App - in main
14:55:58.300 [pool-1-thread-1] DEBUG concurrent.App - in call()
14:55:58.401 [pool-1-thread-2] DEBUG concurrent.App - listener[1]: http://www.google.com
14:55:58.401 [pool-1-thread-3] DEBUG concurrent.App - listener[2]: http://www.google.com
14:55:58.502 [pool-1-thread-3] DEBUG concurrent.App - job completed.
14:55:58.502 [pool-1-thread-2] DEBUG concurrent.App -  job completed.
</pre></div></div>

<p>結果の読み方は、左から、実行された時間、スレッド名、デバッグモード、呼ばれたクラス、出力文字列となっている．実行時間とスレッド名を見るとcallが呼ばれて、約100msec後に登録された2つのリスナーがcallメソッドが実行されたスレッドとはそれぞれ別のスレッドで同時実行されていることが確認できる．Listenerが同時実行されたのは、ListenableFutureのaddListenerメソッドの第二引数にスレッドプールのExecutorServiceを登録しているからであり、例えば、以下のようにMoreExecutors.sameThreadExecutor()（callメソッドと同じスレッドを使うよう）に切り替えると</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>    <span class="n">future</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"listener[2]: {}"</span><span class="o">,</span> <span class="n">contents</span><span class="o">);</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"job completed."</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">},</span> <span class="n">MoreExecutors</span><span class="o">.</span><span class="na">sameThreadExecutor</span><span class="o">());</span>
</pre></div></div>

<p>結果は以下のようになる．</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>15:14:42.126 [main] DEBUG concurrent.App - in main
15:14:42.141 [pool-1-thread-1] DEBUG concurrent.App - in call()
15:14:42.242 [pool-1-thread-1] DEBUG concurrent.App - listener[1]: http://www.google.com
15:14:42.343 [pool-1-thread-1] DEBUG concurrent.App - job completed.
15:14:42.343 [pool-1-thread-1] DEBUG concurrent.App - listener[2]: http://www.google.com
15:14:42.444 [pool-1-thread-1] DEBUG concurrent.App - job completed.
</pre></div></div>

<p>同じく実行時間とスレッド名に着目しながら見ると、callメソッドで使われたスレッドと同じスレッドを用いて、2つのListenerメソッドが順次実行されていることが読み取れる．</p>

<p>このように、ListenableFutureを使うと、パイプ処理のように実行結果を受けた処理をつなげる設計ができ、ExecutorServiceを変更することでシーケンシャルに実行するのか、並列処理するのかなどの柔軟な制御を行うことができる．</p>

<h2>
<span id="各種実装の解説" class="fragment"></span><a href="#%E5%90%84%E7%A8%AE%E5%AE%9F%E8%A3%85%E3%81%AE%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>各種実装の解説</h2>

<p>ここでは、コードの内容について簡単に説明する．</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">ListeningExecutorService</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">MoreExecutors</span><span class="o">.</span><span class="na">listeningDecorator</span><span class="o">(</span><span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>
</pre></div></div>

<p>ExecutorServiceに、スレッドプールの中のスレッドを利用するようにするExecutorServiceを設定している．ListeningExecutorServiceは、ListenableFutureを返すExecutorServiceの実装で、MoreExecutors.listeningDecorator()で，java.util.concurrent.Executorsで作成したスレッドプールを使うExecutorServiceをラッピングしている．</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">final</span> <span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"in call()"</span><span class="o">);</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">siteUrl</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div></div>

<p>Callableインタフェースの実装とその実行を指示し、その未来の計算結果として、ListenableFutureインスタンスを取得している．</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span>    <span class="n">future</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"listener[1]: {}"</span><span class="o">,</span> <span class="n">contents</span><span class="o">);</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"job completed."</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">},</span> <span class="n">pool</span><span class="o">);</span>
</pre></div></div>

<p>得られたFutureクラスに、Runnableの実装を登録している．Listenerというけど中身はRunnableの実装である．runメソッド中では、futureから計算結果を取得し、その後の処理が続く．</p>

<h1>
<span id="listenablescheduledfutureクラス" class="fragment"></span><a href="#listenablescheduledfuture%E3%82%AF%E3%83%A9%E3%82%B9"><i class="fa fa-link"></i></a>ListenableScheduledFutureクラス</h1>

<p>ListenableFutureをスケジューラで使いたい場合のコードが以下。ListeningExecutorServiceの代わりに、ListeningScheduledExecutorServiceが、ListenableFutureの代わりに<br>
ListenableScheduledFutureがそれぞれ用意されている。以下のコードは自分の書いたコードをシンプル化したものだけど、まだテストしていないからバグがあるかも・・</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataClowler</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">DataClowler</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">protected</span> <span class="n">ListenableScheduledFuture</span> <span class="n">future</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">ListeningScheduledExecutorService</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">ListeningExecutorService</span> <span class="n">pool</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">threadPoolNum</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kt">long</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">DataClowler</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">scheduler</span> <span class="o">=</span> <span class="n">MoreExecutors</span><span class="o">.</span><span class="na">listeningDecorator</span><span class="o">(</span><span class="n">Executors</span><span class="o">.</span><span class="na">newScheduledThreadPool</span><span class="o">(</span><span class="n">threadPoolNum</span><span class="o">));</span>
        <span class="k">this</span><span class="o">.</span><span class="na">pool</span> <span class="o">=</span> <span class="n">MoreExecutors</span><span class="o">.</span><span class="na">listeningDecorator</span><span class="o">(</span><span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">threadPoolNum</span><span class="o">));</span>
        <span class="k">this</span><span class="o">.</span><span class="na">uri</span> <span class="o">=</span> <span class="n">url</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">delay</span> <span class="o">=</span> <span class="mi">2000</span><span class="o">;</span> <span class="c1">// msec</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span> <span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">resource</span> <span class="o">=</span> <span class="n">Resources</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uri</span><span class="o">),</span> <span class="n">Charsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">scheduler</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">delay</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
            <span class="n">future</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="k">new</span> <span class="n">Echo</span><span class="o">(</span><span class="n">future</span><span class="o">),</span> <span class="k">this</span><span class="o">.</span><span class="na">pool</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">resource</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * タスクを開始(再開)する。</span>
<span class="cm">     */</span>    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">scheduler</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">delay</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
        <span class="n">future</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="k">new</span> <span class="n">DataClowler</span><span class="o">(</span><span class="n">core</span><span class="o">,</span> <span class="n">future</span><span class="o">),</span> <span class="k">this</span><span class="o">.</span><span class="na">pool</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * schedulerに登録したタスクを停止する。</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">future</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">future</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * schedulerをシャットダウンする</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">scheduler</span><span class="o">.</span><span class="na">shutdownNow</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>上述のコードのEchoクラスの実装は以下の通り。ListenableFutureのコード例と違い、独立して定義する場合、futureオブジェクトをコンストラクタに渡しておくと良い。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Echo</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="n">ListenableScheduledFuture</span> <span class="n">future</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Echo</span><span class="o">(</span><span class="n">ListenableScheduledFuture</span> <span class="n">future</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">future</span> <span class="o">=</span> <span class="n">future</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"listener[1]: {}"</span><span class="o">,</span> <span class="n">contents</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"job completed."</span><span class="o">);</span>
        <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div></div>

<p>以上、ScheduledExecutorServiceと連携する場合の実装を紹介した。できれば、scheduleAtFixedRate()関数と一緒に使いたいところだけど、今のところ、<br>
Callableインタフェースを登録できないので、使えない模様。画竜点睛を欠く感じで今後の実装に期待したい。</p>

<ul>
<li><a href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/util/concurrent/ListeningScheduledExecutorService.html" rel="nofollow noopener" target="_blank">ListeningScheduledExecutorService</a></li>
</ul>

<h2>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h2>

<ul>
<li><a href="http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/util/concurrent/ListenableFuture.html" class="autolink" rel="nofollow noopener" target="_blank">http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/util/concurrent/ListenableFuture.html</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>26</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/a241b967cd9c3ffc17d4">redmineのチケットの使い方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-10 16:17:08</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Redmine]</b> <b>[ticket]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>何回か質問されているので、まとめてみました。簡単に使い方をまとめているページはいっぱいあるので、そのリンク集にします。</p>

<h2>
<span id="全体の概念" class="fragment"></span><a href="#%E5%85%A8%E4%BD%93%E3%81%AE%E6%A6%82%E5%BF%B5"><i class="fa fa-link"></i></a>全体の概念</h2>

<p>チケットは、ToDo管理の進化版です。登録する→やったで終わるのではなく、書いた人が「誰に」「いつまで」やってほしいのか、その進捗はどうなのか（New-&gt;On going-&gt;Done-&gt;Closeといったような）という一つのワークフローを「チケット」という単位で管理します。<br>
メールのやりとりでもこのような流れを返信でつなげて、数十件になっているメール案件を見たことがあると思います。これをもう少し賢くやりましょうというのが、redmineのチケットです。ソフトウェア開発のために開発されたので、以下の資料もソフトウェア寄りですが、資料作成だろうが、イベント運営だろうが基本的なフローは一緒なので、redmineのチケットシステムは実は大体のグループタスクに使えるGeneralなものであると言えます。</p>

<ul>
<li><a href="http://fr.slideshare.net/akipii.oga/redmine-presentation-846109" class="autolink" rel="nofollow noopener" target="_blank">http://fr.slideshare.net/akipii.oga/redmine-presentation-846109</a></li>
</ul>

<h2>
<span id="チケットの作り方" class="fragment"></span><a href="#%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>チケットの作り方</h2>

<p>チケットは、redmineのプロジェクトサイトのタブの「新しいチケット」というページから作ります。題名・説明を書けば、作れてしまうのですが、それだけを記入して作られたチケットはあまり活用されません。プロジェクトのメンバの「誰に」作業を振り、「いつまで」にやって欲しいかを登録することでそのメンバにメールで通知が送られます。そのメンバがそのチケットに応えることで、コミュニケーションが生まれるというのが、チケット運用の基本的な概念です。一見、パッシブなシステムですが、メール通知機能を持つことでインタラクティブ性をもったシステムになっています。具体的な作り方は以下を参照のこと</p>

<ul>
<li><a href="http://redmine.jp/tech_note/first-step/user/create-issue/" class="autolink" rel="nofollow noopener" target="_blank">http://redmine.jp/tech_note/first-step/user/create-issue/</a></li>
</ul>

<h2>
<span id="チケットの更新" class="fragment"></span><a href="#%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E6%9B%B4%E6%96%B0"><i class="fa fa-link"></i></a>チケットの更新</h2>

<p>チケットをアサインされた人は、チケットを更新することで仕事を進めます。プロジェクトのチケットタブから、いつでもそのプロジェクトのチケット一覧は確認できますが、慣れてくるとこのページからチケットの確認をするのはリーダーさんだけになります。それより「マイページ」の自分のチケット一覧、もしくはメール通知のリンクから、辿って更新することが多くなります。</p>

<p>大事なことは、更新するときに、「担当者」をしっかりとアサインすることです。例えば、仕事をする上で疑問点がでてきて質問を書き込んだのに、担当者が自分のままだと質問にこたえるべき人がその内容に気づかないことがあります。メーリングリストで全体に質問を投げても返ってこないことがあるように、メッセージのキャッチボールを意識して、担当者の変更は適切にしましょう。</p>

<ul>
<li><a href="http://redmine.jp/tech_note/first-step/user/issue/" class="autolink" rel="nofollow noopener" target="_blank">http://redmine.jp/tech_note/first-step/user/issue/</a></li>
<li><a href="http://redmine.jp/tech_note/first-step/user/update-issue/" class="autolink" rel="nofollow noopener" target="_blank">http://redmine.jp/tech_note/first-step/user/update-issue/</a></li>
</ul>

<h2>
<span id="終わったチケットは必ずクローズしよう" class="fragment"></span><a href="#%E7%B5%82%E3%82%8F%E3%81%A3%E3%81%9F%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E3%81%AF%E5%BF%85%E3%81%9A%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%BA%E3%81%97%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>終わったチケットは必ずクローズしよう</h2>

<p>チケットシステムは、作成者（仕事をそもそも振ったリーダー）が存在します。担当者の仕事が終わっても、誰かがチケットをクローズしないとそのチケットはずっとアクティブな状態で残ります。これは、進捗確認をするときの一覧性を著しく下げるとともに、ToDoがごちゃごちゃになって、チケットで仕事を進める意欲を低下させます。</p>

<p>仕事でも、結局、作業確認がおこなわれず「あれ、どうなったんだっけ」「たしかhogeさんがやってたんですが、どうなったんでしょうね」という無責任なやりとりを一度ならず聞いたことがあると思いますが、チケットの仕組みでは、このような確認作業が必ず行われるように、ワークフローのDoneとCloseが明確に区別されています。なので、チケットを作成した人、もしくは担当者は確認作業をした後、しっかりとチケットをCloseしてとむらいましょう。</p>

<h2>
<span id="メールでいうとccに当たるwatcher" class="fragment"></span><a href="#%E3%83%A1%E3%83%BC%E3%83%AB%E3%81%A7%E3%81%84%E3%81%86%E3%81%A8cc%E3%81%AB%E5%BD%93%E3%81%9F%E3%82%8Bwatcher"><i class="fa fa-link"></i></a>メールでいうとCcに当たるWatcher</h2>

<p>チケットの担当者はこの人なんだけど、他の人にも見てもらいたい。メールでいうとCcに当たるようなことをチケットでもしたいことは良くあります。そのニーズを満たすために、ウォッチャーという機能がチケットに用意されています。ウォッチャーを登録すると、そのチケットの通知は作成者、担当者だけでなく、ウォッチャーとして登録された人にも届きます。必須ではないけど、コメントがあったらしてほしいといったようなニーズがあるときにはその人をウォッチャーとして登録しましょう。</p>

<ul>
<li><a href="http://redmine.jp/glossary/i/issue-watcher/" class="autolink" rel="nofollow noopener" target="_blank">http://redmine.jp/glossary/i/issue-watcher/</a></li>
</ul>

<h2>
<span id="親チケット子チケット" class="fragment"></span><a href="#%E8%A6%AA%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E5%AD%90%E3%83%81%E3%82%B1%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>親チケット・子チケット</h2>

<p>チケットの中にも、大枠のToDoと、その中の細分化されたToDoを登録したい場合があります。このようなニーズを満たすために、redmineでは、チケットに子チケットを作る機能があります。</p>

<ul>
<li><a href="http://blog.redmine.jp/articles/redmine-1_0-subtasking/" class="autolink" rel="nofollow noopener" target="_blank">http://blog.redmine.jp/articles/redmine-1_0-subtasking/</a></li>
</ul>

<p>以上。ここまで知っていれば、大抵のことはチケットで管理できると思います。頑張ってください！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/179fb0d9f4f87f9241c6">ubuntuとapacheを使ったdjangoサーバの運用</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-11 22:19:40</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Django]</b> <b>[Apache]</b> <b>[Ubuntu]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>Djangoは、Pythonで実装されたWebアプリケーションフレームワークで、複雑なデータベース主体のWebアプリケーションを設計・開発するのに役に立つ。導入時点では、</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ ./manager.py runserver
</pre></div></div>

<p>でテストしているが本格的に運用する段階になると、apacheと連携させたくなる。他にも紹介されているページは多くあるが、自分の作業の備忘録として、その運用の仕方をリマインダとして残しておく。</p>

<h1>
<span id="作業環境" class="fragment"></span><a href="#%E4%BD%9C%E6%A5%AD%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>作業環境</h1>

<p>作業環境は以下の通り</p>

<ul>
<li>ubuntu12.04</li>
<li>django 1.3.1</li>
<li>python 2.7.3</li>
</ul>

<p>その他、apacheの設定は以下の通り</p>

<ul>
<li>DocumentRoot: /data/www</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>/etc/apache2/sites-available/default:   DocumentRoot /data/www
</pre></div></div>

<ul>
<li>djangoプロジェクトのルートディレクトリ

<ul>
<li>~/webservices</li>
</ul>
</li>
<li>apache2上のディレクトリ

<ul>
<li>/data/www/webservices -&gt; ~/webservices</li>
</ul>
</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo ln -s ${HOME}/webservices /data/www/webservices
</pre></div></div>

<h1>
<span id="必要なパッケージのインストールとセットアップ" class="fragment"></span><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>必要なパッケージのインストールとセットアップ</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo apt-get install -y apache2 libapache2-mod-wsgi
$ sudo apt-get install -y python-django
$ django-admin startproject webservices
</pre></div></div>

<h1>
<span id="djangowsgiをつくる" class="fragment"></span><a href="#djangowsgi%E3%82%92%E3%81%A4%E3%81%8F%E3%82%8B"><i class="fa fa-link"></i></a>django.wsgiをつくる</h1>

<p>djangoのルートディレクトリにdjango.wsgiをつくる</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">django.wsgi</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'/data/www'</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'/data/www/webservices'</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'DJANGO_SETTINGS_MODULE'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'webservices.settings'</span>

<span class="kn">import</span> <span class="nn">django.core.handlers.wsgi</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">wsgi</span><span class="o">.</span><span class="n">WSGIHandler</span><span class="p">()</span>
</pre></div>
</div>

<h1>
<span id="apache2の設定" class="fragment"></span><a href="#apache2%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>apache2の設定</h1>

<p>/etc/apache2/sites-available/djangoをつくる。</p>

<div class="code-frame" data-lang="/etc/apache2/sites-available/django"><div class="highlight"><pre><span></span>WSGIScriptAlias /services /data/www/webservices/django.wsgi

&lt;Directory /data/www/webservices/&gt;
Order deny,allow
Allow from all
&lt;/Directory&gt;
</pre></div></div>

<p>上記の設定を有効にする</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ sudo a2ensite django
$ sudo apache2ctl restart
</pre></div></div>

<p>その他、データベースにsqlite3を用いる場合は、データベースへのアクセス権を設定する必要がある。仮にsqlite3のデータベースファイル名がdata.dbだった場合、djangoのルートディレクトリで以下の作業を行う</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ ./manager.py syncdb
…
$ chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>.www-data data.db
$ chmod g+w data.db
</pre></div></div>

<h1>
<span id="デバッグのあれこれ" class="fragment"></span><a href="#%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%AE%E3%81%82%E3%82%8C%E3%81%93%E3%82%8C"><i class="fa fa-link"></i></a>デバッグのあれこれ</h1>

<p>pythonの標準出力や、エラーメッセージは以下の場所に出力されている。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ less /var/log/apache2/error.log
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/6d97efc0ea6c68c7674f">MavericksでのOpenCVとOpenNI2のインストールとビルドテスト</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-10 21:26:51</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[homebrew]</b> <b>[OpenCV]</b> <b>[mavericks]</b> <b>[OpenNI2]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>OS X Mavericksになって、ひさしぶりにOpenCVとOpenNI2のインストールをしたので、そのメモを記録しておく。これまではSimpleOpenNI経由で、OpenNI_NITE_Installerを使った方が良かったりしたのが、すべてHomebrewでインストール可能になって、すっきりしたのは強調しておきたいところだ。また、大抵のブログでは、インストールまででビルド例が載っておらず、ライブラリのリンクパスなどを自分で調べることになって不便なので、そこまでしっかりとリマインダとして残しておく。</p>

<p>なお、OpenNI2をとりあえず使ってみたいだけの人には、Processing + SimpleOpenNiが面倒な作業が必要なく使いやすいので、おすすめ。</p>

<ul>
<li><a href="https://code.google.com/p/simple-openni/" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/simple-openni/</a></li>
</ul>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<p>すべてHomebrewでインストールできる。これからのサンプルビルドのために以下のソフトもインストールしておく。</p>

<ul>
<li>XCode Command Line Tools</li>
<li>cmake</li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ xcode-select --install
$ brew install cmake
</pre></div></div>

<p>なお、Homebrewを入れていない場合は以下のサイトからインストールすること。</p>

<ul>
<li><a href="http://brew.sh/" rel="nofollow noopener" target="_blank">Homebrew</a></li>
</ul>

<p>MacPortsと違い、ネイティブのライブラリを極力使うことにしているので、インストール時間が短いということ、最近、はやりなので、思い切って使ってみては。詳しくは上記のサイトで</p>

<h3>
<span id="opencvのインストール" class="fragment"></span><a href="#opencv%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>OpenCVのインストール</h3>

<p>Homebrewのデフォルトでは、opencvは入っていないので、scienceリポジトリをアクティベーションしてからインストールする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew tap homebrew/science
$ brew install opencv
</pre></div></div>

<h3>
<span id="openni2のインストール" class="fragment"></span><a href="#openni2%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>OpenNI2のインストール</h3>

<p>OpenNI2も同様にデフォルトでは入っていないので、openniリポジトリしてからインストールする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew tap totakke/openni2
$ brew install openni2
</pre></div></div>

<p>Kinect for XBox360を使いたい場合は以下もインストールしておく。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew install openni2-freenectdriver
</pre></div></div>

<p>原典は以下を参照のこと</p>

<ul>
<li><a href="https://github.com/totakke/homebrew-openni2" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/totakke/homebrew-openni2</a></li>
</ul>

<h2>
<span id="サンプルコードのビルド" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89"><i class="fa fa-link"></i></a>サンプルコードのビルド</h2>

<p>以下は、OpenNI2とOpenCVの両方を使ったコードのサンプルファイルだ。以下に添付しているファイルを引用のように同じディレクトリに配置し、cmakeでビルドする。</p>

<blockquote>
<p>.<br>
├── CMakeLists.txt<br>
└── main.cpp</p>
</blockquote>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir build
$ cd build
$ cmake ..
$ make
</pre></div></div>

<p>ビルドが成功すれば、問題なし。以下、サンプルのソースファイルとcmakeの設定ファイルを添付する。</p>

<p>サンプルのソースファイルは、以下のサイトのソースを持ってきて、ubuntu用に修正したものだ。</p>

<ul>
<li><a href="http://www.naturalsoftware.jp/blog/8001" class="autolink" rel="nofollow noopener" target="_blank">http://www.naturalsoftware.jp/blog/8001</a></li>
</ul>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">main.cpp</span></div>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;OpenNI.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">openni</span><span class="o">::</span><span class="n">OpenNI</span><span class="o">::</span><span class="n">initialize</span><span class="p">();</span>

        <span class="n">openni</span><span class="o">::</span><span class="n">Device</span> <span class="n">device</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="n">openni</span><span class="o">::</span><span class="n">ANY_DEVICE</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">ret</span> <span class="o">!=</span> <span class="n">openni</span><span class="o">::</span><span class="n">STATUS_OK</span> <span class="p">)</span> <span class="p">{</span>
     <span class="err">　　　　</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">openni</span><span class="o">::</span><span class="n">VideoStream</span> <span class="n">colorStream</span><span class="p">;</span>
        <span class="n">colorStream</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">openni</span><span class="o">::</span><span class="n">SENSOR_COLOR</span><span class="p">);</span>
        <span class="n">colorStream</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

        <span class="n">openni</span><span class="o">::</span><span class="n">Recorder</span> <span class="n">recorder</span><span class="p">;</span>
        <span class="n">recorder</span><span class="p">.</span><span class="n">create</span><span class="p">(</span> <span class="s">"kinect.oni"</span> <span class="p">);</span>
        <span class="n">recorder</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span> <span class="n">colorStream</span> <span class="p">);</span>
        <span class="n">recorder</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">openni</span><span class="o">::</span><span class="n">VideoStream</span><span class="o">*&gt;</span> <span class="n">streams</span><span class="p">;</span>
        <span class="n">streams</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">colorStream</span> <span class="p">);</span>

        <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">colorImage</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">changedIndex</span><span class="p">;</span>
            <span class="n">openni</span><span class="o">::</span><span class="n">OpenNI</span><span class="o">::</span><span class="n">waitForAnyStream</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">streams</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">changedIndex</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">changedIndex</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
                <span class="n">openni</span><span class="o">::</span><span class="n">VideoFrameRef</span> <span class="n">colorFrame</span><span class="p">;</span>
                <span class="n">colorStream</span><span class="p">.</span><span class="n">readFrame</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">colorFrame</span> <span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">colorFrame</span><span class="p">.</span><span class="n">isValid</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="n">colorImage</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(</span> <span class="n">colorStream</span><span class="p">.</span><span class="n">getVideoMode</span><span class="p">().</span><span class="n">getResolutionY</span><span class="p">(),</span> 
                        <span class="n">colorStream</span><span class="p">.</span><span class="n">getVideoMode</span><span class="p">().</span><span class="n">getResolutionX</span><span class="p">(),</span>
                        <span class="n">CV_8UC3</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">colorFrame</span><span class="p">.</span><span class="n">getData</span><span class="p">()</span> <span class="p">);</span>
                    <span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span> <span class="n">colorImage</span><span class="p">,</span> <span class="n">colorImage</span><span class="p">,</span> <span class="n">CV_BGR2RGB</span> <span class="p">);</span>

                    <span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span> <span class="s">"Color Camera"</span><span class="p">,</span> <span class="n">colorImage</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="kt">int</span> <span class="n">key</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span> <span class="mi">10</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">key</span> <span class="o">==</span> <span class="sc">'q'</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">openni</span><span class="o">::</span><span class="n">OpenNI</span><span class="o">::</span><span class="n">getExtendedError</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>cmakeの設定ファイルは、スクラッチで書いた。OpenNI2のパスの探し方は自己流なので、適宜変更してほしい。大抵はPathsにヘッダとライブラリがあるパスを追加すれば動く。今回は、上述のように/usr/local/lib/ni2にライブラリを、/usr/local/include/ni2にヘッダファイルがあるという前提で設定を編集した。</p>

<div class="code-frame" data-lang="cmake">
<div class="code-lang"><span class="bold">CMakeLists.txt</span></div>
<div class="highlight"><pre><span></span><span class="c"># -*- CMakeLists.txt -*-</span>

<span class="nb">cmake_minimum_required</span> <span class="p">(</span><span class="s">VERSION</span> <span class="s">2.8</span><span class="p">)</span>

 <span class="nb">if</span><span class="p">(</span><span class="s">COMMAND</span> <span class="s">cmake_policy</span><span class="p">)</span>
    <span class="nb">cmake_policy</span><span class="p">(</span><span class="s">SET</span> <span class="s">CMP0003</span> <span class="s">NEW</span><span class="p">)</span>
 <span class="nb">endif</span><span class="p">(</span><span class="s">COMMAND</span> <span class="s">cmake_policy</span><span class="p">)</span>

<span class="c"># プログラムの追加</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">view</span> <span class="s">main.cpp</span><span class="p">)</span>

<span class="c"># CFLAGSの追加</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CMAKE_CXX_FLAGS</span> <span class="s2">"-Wall -g -I${PROJECT_SRC_DIRECTORY}/include"</span><span class="p">)</span>

<span class="c"># LDFLAGSの追加</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CMAKE_EXE_LINKER_FLAGS</span> <span class="o">${</span><span class="nv">PLATFORM_LDFLAGS</span><span class="o">}</span><span class="p">)</span>

<span class="c"># ライブラリの追加</span>
<span class="nb">include_directories</span> <span class="p">(</span> <span class="s">/usr/local/include/ni2</span> <span class="p">)</span>
<span class="nb">link_directories</span> <span class="p">(</span> <span class="s">/usr/local/lib/ni2</span> <span class="p">)</span>
<span class="nb">find_package</span> <span class="p">(</span><span class="s">OpenCV</span> <span class="s">REQUIRED</span><span class="p">)</span>

<span class="nb">find_path</span><span class="p">(</span><span class="s">OpenNI2_INCLUDE_PATH</span> <span class="s">NAMES</span> <span class="s">OpenNI.h</span>
  <span class="s">PATH_SUFFIXES</span> <span class="s">ni2</span>
  <span class="s">PATHS</span>
    <span class="s">/usr/include</span>
    <span class="s">/usr/local/include</span><span class="p">)</span>

<span class="nb">find_library</span><span class="p">(</span><span class="s">OpenNI2_LIBRARY</span> <span class="s">NAMES</span> <span class="s">OpenNI2</span> <span class="s">libOpenNI2</span>
  <span class="s">PATHS</span>
    <span class="s">/usr/lib</span>
    <span class="s">/usr/local/lib</span>
    <span class="s">/usr/local/lib/ni2</span><span class="p">)</span>

<span class="nb">target_link_libraries</span> <span class="p">(</span><span class="s">view</span> <span class="o">${</span><span class="nv">OpenCV_LIBS</span><span class="o">}</span> <span class="o">${</span><span class="nv">OpenNI2_LIBRARY</span><span class="o">}</span> <span class="s">stdc++</span><span class="p">)</span>

<span class="c"># クリーン対象の追加</span>
<span class="nb">set_directory_properties</span> <span class="p">(</span>
  <span class="s">PROPERTIES</span>
  <span class="s">ADDITIONAL_MAKE_CLEAN_FILES</span>
  <span class="s2">"*~"</span>
  <span class="p">)</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/43157ff1225c56500655">sshで公開鍵認証を使ってアクセスする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-18 13:00:25</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[SSH]</b> <b>[公開鍵]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>あまりに基本的すぎるけど、基本的過ぎて、ときどき大事な設定を忘れている解説がある。念のため、備忘録としてまとめておく。なお、Linux, Mac OS XなどのUnix系統のパソコンじゃないとこの解説は意味がないので、windowsの人は無視すること</p>

<h2>
<span id="自分のパソコンですること" class="fragment"></span><a href="#%E8%87%AA%E5%88%86%E3%81%AE%E3%83%91%E3%82%BD%E3%82%B3%E3%83%B3%E3%81%A7%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>自分のパソコンですること</h2>

<p>公開鍵と秘密鍵を作ろう。どのディレクトリでもかまわないが、結局、.sshのディレクトリに移すことになるので、.sshの下でやるのが効率的だ。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd ~/.ssh
$ ssh-keygen -t rsa -f &lt;filename&gt;
</pre></div></div>

<p>上記のコマンドが実行されると、&lt;filename&gt;というファイルと、&lt;filename&gt;.pubというファイルができる（は適宜、自分で指定しよう）。前者が秘密鍵、後者が公開鍵。この後、公開鍵&lt;filename&gt;.pubを公開鍵認証でアクセスしたいサーバにコピーする</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ scp &lt;filename&gt;.pub &lt;hostname&gt;:.ssh/.
</pre></div></div>

<p>その後、.sshにid_rsaがない場合は、秘密鍵をid_rsaという名前に変更する</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mv &lt;filename&gt; id_rsa
$ chmod 600 id_rsa
</pre></div></div>

<p>最後のパーミッションの設定を忘れると動かないので注意</p>

<h2>
<span id="ホスト側" class="fragment"></span><a href="#%E3%83%9B%E3%82%B9%E3%83%88%E5%81%B4"><i class="fa fa-link"></i></a>ホスト側</h2>

<p>アクセスしたいホストコンピュータでも、.sshにコピーしたファイルを操作する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ssh &lt;hostname&gt;
&lt;パスワードによるログイン&gt;
$ cd .ssh
$ cat &lt;filename&gt;.pub &gt;&gt; authorized_keys
$ chmod 600 authorized_keys
$ exit

</pre></div></div>

<h2>
<span id="確認" class="fragment"></span><a href="#%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>確認</h2>

<p>ふたたび、ホストコンピュータにアクセスして、パスワードなしで入れれば、成功。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ssh &lt;hostname&gt;
$
</pre></div></div>

<h2>
<span id="トラブルシューティング" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0"><i class="fa fa-link"></i></a>トラブルシューティング</h2>

<h3>
<span id="sshディレクトリがない" class="fragment"></span><a href="#ssh%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>.sshディレクトリがない</h3>

<p>つくりましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir .ssh
$ chmod 700 .ssh
</pre></div></div>

<h3>
<span id="全部言われた通りに設定したのに動かない" class="fragment"></span><a href="#%E5%85%A8%E9%83%A8%E8%A8%80%E3%82%8F%E3%82%8C%E3%81%9F%E9%80%9A%E3%82%8A%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9F%E3%81%AE%E3%81%AB%E5%8B%95%E3%81%8B%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>全部言われた通りに設定したのに動かない</h3>

<p>大抵の場合、パーミッションの設定が間違っています。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ls -al .ssh
</pre></div></div>

<p>でアクセス権を確認して、クライアント、ホストコンピュータのid_rsa, authorized_keysのアクセス権が600になっているか確認しましょう。なっていなかったら、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ chmod 600 &lt;target&gt;
</pre></div></div>

<p>として変更しましょう。ごくまれに、authorized_keysと命名するべきなのに、authorized_keyと単数系にしたり、スペルミスでうまくいかないこともあります。</p>

<h3>
<span id="既にid_rsa-authorized_keysがある" class="fragment"></span><a href="#%E6%97%A2%E3%81%ABid_rsa-authorized_keys%E3%81%8C%E3%81%82%E3%82%8B"><i class="fa fa-link"></i></a>既にid_rsa, authorized_keysがある</h3>

<p>authorized_keysファイルが既に存在しても、そのファイルの続きに今回、作成した公開鍵を足せば動きます。id_rsaがある場合は、秘密鍵を別の名前で保持して、</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ssh -i ~/.ssh/&lt;privatekey&gt; &lt;hostname&gt;
</pre></div></div>

<p>とアクセス時に明示的に指定するか、.ssh/configファイルを作成し、その中で、どのホストにどの秘密鍵を使うのかを記述すると良いと思われます。以下、記述例です。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Host &lt;hostname or nickname&gt;
  HostName &lt;hostname or ip address&gt;
  User &lt;username&gt;
  Port &lt;port number&gt;
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile ~/.ssh/&lt;privatekey&gt;
  IdentitiesOnly yes
  LogLevel FATAL
</pre></div></div>

<p>&lt;&gt;の中身は、各設定に応じて変えてください。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>12</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/3a4d147d12e8b38cf6d0">Javaでスレッドセーフなコレクションクラスを作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-22 12:56:17</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><del>つい最近までは、スレッドセーフなハッシュマップやリストはjava.util.concurrentのConcurrentHashMapなどで作るもんだと思っていたけど、</del>スレッドセーフなコレクションクラスをどのように定義すれば良いか調べていたら最新のバージョンではCollections.synchronized***で作るのが良いらしい。ということで、簡単すぎるけど、例を紹介して備忘録とする。もちろん、中身はLinkedListなどでも良く、必要なデータ型の特性に合わせて使い分けることができる。ちょっと便利になった気がする。同時にVectorがもはや後方互換のためだけに存在することを知って、愕然としている。学生時代とはずいぶんと変わったものだ。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="err">…</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">sampleList</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">synchronizedList</span><span class="o">(</span><span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;());</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">sampleMap</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">synchronizedMap</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;());</span>
</pre></div></div>

<p>なお、同期制御をより効率的に行うためには、java.util.concurrentの中のクラスを使うと良いらしい。コメントで教えてもらったので、ここよりも詳細に解説しているurlも載せておく。</p>

<ul>
<li><a href="http://etc9.hatenablog.com/entry/20091211/1260625174" class="autolink" rel="nofollow noopener" target="_blank">http://etc9.hatenablog.com/entry/20091211/1260625174</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/f140837393a1697a8433">Mac OS X MavericksへのKakasiのインストール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-10 12:30:31</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[install]</b> <b>[mavericks]</b> <b>[kakasi]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>Kakasiは、日本語をローマ字に変換するまたはその逆を行うUnixコマンドである。もはや古い部類に属するコマンドだが、たまに日本語名だらけのリソースをシステムが扱いやすいように変換したい場合、それらの処理を自動化したい場合に効果を発揮する。</p>

<p>ここでは、リマインダとして、kakasiをmavericksにインストールする方法とその運用方法についてまとめる。</p>

<h1>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h1>

<p>以下のページから、kakasiの最新バージョンのtarballを持ってきて、解凍しビルドする。</p>

<ul>
<li><a href="http://kakasi.namazu.org/stable/" class="autolink" rel="nofollow noopener" target="_blank">http://kakasi.namazu.org/stable/</a></li>
</ul>

<p>ホストオプションをつけるのがポイント。現状で、2.3.5が最新だった。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ tar xzf kakasi-2.3.5.tar.gz
$ cd kakasi-2.3.5
$ configure —host=powerpc-apple-bsd
$ make
$ sudo make install
</pre></div></div>

<h1>
<span id="運用" class="fragment"></span><a href="#%E9%81%8B%E7%94%A8"><i class="fa fa-link"></i></a>運用</h1>

<p>kakasiはeuc-jpの文字コードをサポートしているので、mac標準のutf8の文字列をnkfで変換してから与えないと、変な変換をする</p>

<h2>
<span id="悪い例" class="fragment"></span><a href="#%E6%82%AA%E3%81%84%E4%BE%8B"><i class="fa fa-link"></i></a>悪い例</h2>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="s2">"あいうえお"</span> <span class="p">|</span> kakasi -Ha
?yu??うえお
</pre></div></div>

<h2>
<span id="良い例" class="fragment"></span><a href="#%E8%89%AF%E3%81%84%E4%BE%8B"><i class="fa fa-link"></i></a>良い例</h2>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="s2">"あいうえお"</span> <span class="p">|</span> nkf -e <span class="p">|</span> kakasi -Ha
aiueo
</pre></div></div>

<p>nkfがインストールされていないなら、homebrewでさくっとインストールする</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew install nkf
</pre></div></div>

<h2>
<span id="オプション" class="fragment"></span><a href="#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fa fa-link"></i></a>オプション</h2>

<p>入力の中のどの種の文字を変換するかは、前後二文字のオプションをつけて、指示する。それぞれの文字の意味は以下の通り</p>

<ul>
<li>a: ascii</li>
<li>j: jisroman</li>
<li>g: graphic</li>
<li>k: kana (j,k defined in jisx0201)</li>
<li>E: kigou</li>
<li>K: katakana</li>
<li>H: hiragana</li>
<li>J: kanji(E,K,H,J defined in jisx0208)</li>
</ul>

<p>上記の例では、ひらがなから、ローマ字(acciicode)に変換したかったので、-Haというオプションをつけた。漢字からローマ字の場合は、-Ja、カタカナからローマ字の場合は-Kaもつけること。</p>

<h1>
<span id="サンプル" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB"><i class="fa fa-link"></i></a>サンプル</h1>

<p>以下、同じディレクトリにある日本語名のファイルをkakasiを使って、英語名にするためのスクリプト例</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">translate_and_move.py</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">commands</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">'.'</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">inpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"\s"</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">)</span>
                <span class="n">status</span><span class="p">,</span> <span class="n">engfname</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="s1">'echo "</span><span class="si">%s</span><span class="s1">" | nkf -e | kakasi -Ha -ka -ja -Ja -Ka -Ea -ga'</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span> <span class="p">(</span><span class="s2">"error: status: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
                        <span class="k">continue</span>
                <span class="n">outpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">engfname</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span> <span class="p">(</span><span class="s1">'mv "</span><span class="si">%s</span><span class="s1">" "</span><span class="si">%s</span><span class="s1">"'</span> <span class="o">%</span> <span class="p">(</span><span class="n">inpath</span><span class="p">,</span> <span class="n">outpath</span><span class="p">))</span>
                <span class="n">status</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="s1">'mv "</span><span class="si">%s</span><span class="s1">" "</span><span class="si">%s</span><span class="s1">"'</span> <span class="o">%</span> <span class="p">(</span><span class="n">inpath</span><span class="p">,</span> <span class="n">outpath</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">error</span> <span class="p">(</span><span class="s2">"error: status: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
                        <span class="k">continue</span>
</pre></div>
</div>

<h1>
<span id="homebrewを使ったインストール" class="fragment"></span><a href="#homebrew%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>homebrewを使ったインストール</h1>

<p>Homebrewを使ってインストールしたい場合は以下で紹介されているタップを利用するといいらしい</p>

<ul>
<li><a href="http://koshigoeb.hateblo.jp/entry/2013/05/20/165310" class="autolink" rel="nofollow noopener" target="_blank">http://koshigoeb.hateblo.jp/entry/2013/05/20/165310</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>10</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/40d82cc52d0db1c2c49b">Pythonの配列処理をJavaで書く</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-14 17:55:03</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Mac]</b> <b>[array]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="最後尾の要素を持ってくる" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E5%B0%BE%E3%81%AE%E8%A6%81%E7%B4%A0%E3%82%92%E6%8C%81%E3%81%A3%E3%81%A6%E3%81%8F%E3%82%8B"><i class="fa fa-link"></i></a>最後尾の要素を持ってくる</h2>

<p>Pythonでは以下のコードで書けるものが</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div></div>

<p>javaならこうなる．</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">};</span>
<span class="n">a</span><span class="o">[</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">];</span>
</pre></div></div>

<h2>
<span id="配列の結合" class="fragment"></span><a href="#%E9%85%8D%E5%88%97%E3%81%AE%E7%B5%90%E5%90%88"><i class="fa fa-link"></i></a>配列の結合</h2>

<p>Pythonでは以下のコードで書けるものが</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
<span class="n">concat</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div></div>

<p>javaならこうなる．</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">};</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="o">{</span><span class="mi">6</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">8</span><span class="o">};</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">concat</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">a</span><span class="o">.</span><span class="na">length</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>

<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">concat</span><span class="o">,</span> <span class="n">pos</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
<span class="n">pos</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
<span class="n">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">concat</span><span class="o">,</span> <span class="n">pos</span><span class="o">,</span> <span class="n">b</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</pre></div></div>

<p>System.arraycopyの引数の順番と役割を覚えておこう．</p>

<h2>
<span id="部分配列の作成" class="fragment"></span><a href="#%E9%83%A8%E5%88%86%E9%85%8D%E5%88%97%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>部分配列の作成</h2>

<p>Pythonでは以下のコードで書けるものが</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div></div>

<p>javaならこうなる．</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="err">…</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">};</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">copyOfRange</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</pre></div></div>

<h2>
<span id="map関数" class="fragment"></span><a href="#map%E9%96%A2%E6%95%B0"><i class="fa fa-link"></i></a>map関数</h2>

<p>Pythonのmap関数は配列の各要素に適用したい処理をループを使わずに実装できる。コード数が節約でき、コーディングスタンダードとすれば可読性も上がる。ただ、処理スピードに関しては、リスト内包表記の方が早いという報告があるので注意すること。また、itertools.imapを使える状況ならそちらを使う方が高速である場合が多い。ただ、ここでは、map関数をjavaで書くとどうなるのかという点に焦点を当てる．</p>

<p>Pythonでは以下のコードで書けるものが</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="nb">map</span><span class="p">(</span><span class="n">lamba</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div></div>

<p>javaならこうなる。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.apache.commons.lang3.ArrayUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.base.Function</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Collections2</span><span class="o">;</span>
<span class="err">…</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">};</span>
<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Collections2</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span>
        <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">ArraysUtils</span><span class="o">.</span><span class="na">toObject</span><span class="o">(</span><span class="n">a</span><span class="o">)),</span>
        <span class="k">new</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">apply</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span> 
                <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">);</span>
</pre></div></div>

<p>Collectionになってしまうのはご愛嬌。なお、この表現を使うには、</p>

<ul>
<li>commons-lang.jar</li>
<li>guava.jar</li>
</ul>

<p>が必要であり、それぞれ以下から取得できる．</p>

<ul>
<li>Apache Commons Lang: <a href="http://commons.apache.org/proper/commons-lang/" class="autolink" rel="nofollow noopener" target="_blank">http://commons.apache.org/proper/commons-lang/</a>
</li>
<li>guava-libraries: <a href="https://code.google.com/p/guava-libraries/" class="autolink" rel="nofollow noopener" target="_blank">https://code.google.com/p/guava-libraries/</a>
</li>
</ul>

<p>※apache commons langのArrayUtilsは、guava中の他のパッケージにある機能で置き換えられる可能性が高い（まだ不勉強なので、今回はcommons-langを使う．）。</p>

<p>簡単にコード中の処理について解説する．</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Collection&lt;Integer&gt; b = Collections2.transform(
    …
    );
</pre></div></div>

<p>Collections2.transform()関数は、map関数に当たる．第一引数で与えられた配列の各要素に対して、Functionの処理を適用する．</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>        Arrays.asList(ArraysUtils.toObject(a)),
</pre></div></div>

<p>この部分は、commons-langを使って、intの配列をprimitive型からobject型に変換した後に、List化している．</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>        new Function&lt;Integer, Integer&gt;() {
            …
        }
</pre></div></div>

<p>Functionのgeneric表現は、左が返り値、右が引数・配列の要素を表し，applyの返り値、引数はこれに対応していなければいけない．pythonのlambda関数に当たる．</p>

<p>これでは、for文を回した方が早いような気がするが、より複雑な処理をしたくなる（例えば、オブジェクトの中の特定のフィールド値に処理をかけ、その結果配列を得たい場合）と初めてこの表現が生きてくる．</p>

<h2>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h2>

<p>意外とjavaでも簡単に書けるものも多い．これからも気づいたらこのページに互換のコードをアップしていこうと思う．</p>

<h2>
<span id="両方の言語の動作確認のために" class="fragment"></span><a href="#%E4%B8%A1%E6%96%B9%E3%81%AE%E8%A8%80%E8%AA%9E%E3%81%AE%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>両方の言語の動作確認のために</h2>

<p>Pythonはインタラクティブシェルが存在するが、Javaには存在しない．ただ、この程度のサンプルを試すためにクラスの記述をいちいちするのも面倒だ．そのようなニーズのために，BeanShellというプログラムが公開されており，Javaの文法に基づいたスクリプティングができるツールが提供されている．Macには以下のサイトからインストールパッケージが提供されている．</p>

<ul>
<li><a href="https://github.com/mcandre/beanshell-mac" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mcandre/beanshell-mac</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/18c3518d8c384f93fac7">iTunesで取得したm4aをwavに変換する方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-10 14:24:57</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[ffmpeg]</b> <b>[wav]</b> <b>[m4a]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>普通にやろうとすると、soxでの変換になるが、soxはm4aのエンコーダを拡張子から解決できない。ffmpegで行うのが良い。</p>

<p>以下、同時変換用のpythonスクリプトの例を示す。日本語名を含むファイルが多数ある場合でも変換できるように書いた。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#!/usr/bin/env python

import os
import commands

import logging
import traceback

if __name__ == '__main__':
    outputdir = os.path.abspath(“&lt;path to output&gt;”)
    for root, dirs, files in os.walk('.'):
        for f in files:
            path = os.path.join(root, f)
            base, ext = os.path.splitext(f)
            outputpath = os.path.join(outputdir, base + ".wav")
            if ext == '.m4a':
                print 'converting %s to %s' % (path, outputpath)
                status, output = commands.getstatusoutput('ffmpeg -i "%s" "%s"' % (path, outputpath))
                if status:
                    logging.error (output)
</pre></div></div>

<p>&lt;path to output&gt;の部分は自分で設定すること。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/d3fe8dc9fc21d40fbaae">py2exeとsetuptoolsの連携</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-12 23:21:03</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[Windows]</b> <b>[setup.py]</b> <b>[py2exe]</b> <b>[setuptools]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>py2exeを使って、windowsでexeファイルを作るとき、意外とdistutilsとの組み合わせで書かれているサイトが多い。しかし、Linuxなどでpythonを使っていると、パッケージ化するときに、まず間違いなくdistribute(setuptools)と組み合わせて使いたくなる。setuptoolsパッケージはdistutilsを強化するもので、setuptoolsを入れるとdistutilsのsetup()関数に与えられるパラメータが強化されたり、egg形式でのパッケージ配布が可能になったり、easy_installと呼ばれるコマンドラインツールが使えるようになったりする。</p>

<del>このsetuptoolsは、最近、更新が止まっているのだが、その開発を引き継ぎ、完全互換なAPIを提供しているのがdistributeだ。今から使うなら、間違いなくdistributeを使ったほうが良い。早速、py2exeの説明をしたいところだが、おさらいもかねて、distributeから説明していく。（ちなみに、それぞれの概念は分離しているため、書くまでもないということなのかもしれない。そういう方にとっては、このページは役に立たない）</del>

<p>親切な方のコメントで、distributeが時代遅れになったことが判明。巡り巡って、setuptoolsを使った方が良いとのこと。</p>

<ul>
<li><a href="http://pythonhosted.org/distribute/" class="autolink" rel="nofollow noopener" target="_blank">http://pythonhosted.org/distribute/</a></li>
</ul>

<blockquote>
<p>Since the Setuptools 0.7 release, Setuptools and Distribute have merged and Distribute is no longer being maintained.</p>
</blockquote>

<h2>
<span id="setuptoolsの導入" class="fragment"></span><a href="#setuptools%E3%81%AE%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>setuptoolsの導入</h2>

<p>まず、一般的なsetuptoolsの導入の仕方を紹介。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ curl -O https://bitbucket.org/pypa/setuptools/downloads/ez_setup.py
$ sudo python ./dez_setup.py
</pre></div></div>

<p>setupスクリプトをダウンロードして実行するだけ。とても簡単。このパッケージを導入すると、easy_installというツールが使えるようになり、一般的なパッケージはこのツールを使って、site_packagesにインストールすることができるようになる（末尾のリンクを参照）。</p>

<p>ところで、ソースを配布するときは、setuptoolsのインストールが前提にできない。ドキュメントに「インストールしてね」と書くこともできるが、依存関係も解決できるpythonを使っているのに、そういうことをするのは、ちょっとカッコ悪い。そんな場合は、配布物にdistribute_setup.pyを含め、setup.pyの冒頭に以下のように記述する。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">setup.py</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">ez_setup</span>
<span class="n">ez_setup</span><span class="o">.</span><span class="n">use_setuptools</span><span class="p">()</span>
</pre></div>
</div>

<p>setup.pyの冒頭に上記のような記述をいれておくと、setup.pyのスクリプト導入時にdistributeパッケージのインストールを行う。</p>

<h2>
<span id="setuptoolspy2exeを組み合わせたsetuppyの書き方" class="fragment"></span><a href="#setuptoolspy2exe%E3%82%92%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B%E3%81%9Fsetuppy%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-link"></i></a>setuptools+py2exeを組み合わせたsetup.pyの書き方</h2>

<p>これまでの導入で、setuptoolsのインポートはできた。ここでは、setuptoolsとpy2exeを組み合わせたsetup.pyの書き方を紹介する。まず、最初にテンプレートは以下のとおりになる。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">setup.py</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="n">__author__</span>  <span class="o">=</span> <span class="s2">"&lt;author name&gt;"</span>
<span class="n">__author_email__</span> <span class="o">=</span> <span class="s2">"&lt;author's email&gt;"</span>
<span class="n">__date__</span>    <span class="o">=</span> <span class="s2">"&lt;date&gt;"</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">"&lt;version number&gt;"</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">splitext</span>

<span class="kn">import</span> <span class="nn">ez_setup</span>
<span class="n">ez_setup</span><span class="o">.</span><span class="n">use_setuptools</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="kn">import</span> <span class="nn">py2exe</span>

<span class="k">def</span> <span class="nf">find_py_modules</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
    <span class="n">py_modules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">'.py'</span> <span class="ow">and</span> <span class="n">base</span> <span class="o">!=</span> <span class="s1">'&lt;AppName&gt;'</span><span class="p">:</span> <span class="n">py_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">py_modules</span>

<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">fname</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'VideoRecorder'</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="n">__version__</span><span class="p">,</span>
      <span class="n">description</span><span class="o">=</span><span class="s1">'&lt;description&gt;'</span><span class="p">,</span>
      <span class="n">author</span><span class="o">=</span><span class="n">__author__</span><span class="p">,</span>
      <span class="n">author_email</span><span class="o">=</span><span class="n">__author_email__</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="s1">'&lt;project homepage&gt;'</span><span class="p">,</span>
      <span class="n">long_description</span><span class="o">=</span><span class="n">read</span><span class="p">(</span><span class="s1">'README'</span><span class="p">),</span>
      <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
      <span class="n">console</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">'script'</span><span class="p">:</span> <span class="s1">'&lt;main python module&gt;'</span><span class="p">,</span>
            <span class="s1">'icon_resources'</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'&lt;icon path&gt;'</span><span class="p">),],</span>
            <span class="p">},</span>
        <span class="p">],</span>
      <span class="n">package_dir</span> <span class="o">=</span> <span class="p">{</span><span class="s1">''</span><span class="p">:</span> <span class="s1">'src'</span><span class="p">},</span>
      <span class="n">py_modules</span><span class="o">=</span><span class="n">find_py_modules</span><span class="p">(</span><span class="s1">'src'</span><span class="p">),</span>
      <span class="n">package_data</span><span class="o">=</span><span class="p">{</span><span class="s1">''</span><span class="p">:[</span><span class="s1">'*.ini'</span><span class="p">,</span> <span class="s1">'*.gif'</span><span class="p">,</span> <span class="s1">'*.ico'</span><span class="p">]},</span>
      <span class="n">data_files</span><span class="o">=</span><span class="p">[(</span><span class="s2">""</span><span class="p">,</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">necessary</span> <span class="n">dlls</span><span class="o">&gt;</span><span class="p">]),],</span>
      <span class="n">zipfile</span><span class="o">=</span><span class="bp">None</span>
      <span class="p">)</span>
</pre></div>
</div>

<p>テンプレート中、&lt;&gt;で囲まれた部分は、作成者ごとに変更する部分である。以下にそのリストを挙げる。</p>

<table>
<thead>
<tr>
<th>変数</th>
<th>概要</th>
</tr>
</thead>
<tbody>
<tr>
<td>author</td>
<td>作成者名</td>
</tr>
<tr>
<td>author's email</td>
<td>作成者のEメールアドレスです</td>
</tr>
<tr>
<td>date</td>
<td>日付</td>
</tr>
<tr>
<td>version number</td>
<td>バージョン番号</td>
</tr>
<tr>
<td>app name</td>
<td>主要pythonモジュールのパス</td>
</tr>
<tr>
<td>description</td>
<td>概要</td>
</tr>
<tr>
<td>project homepage</td>
<td>プロジェクトのホームページ</td>
</tr>
<tr>
<td>icon path</td>
<td>アイコンのパス</td>
</tr>
<tr>
<td>necessary dlls</td>
<td>必要なファイルの配列、使用するパッケージによっては、dllや、フォントなどを含める必要がある。</td>
</tr>
</tbody>
</table>

<p>プロジェクトに合わせて上記の変数は調整する必要がある。distributeからインポートされるメソッドは、setupである。setup.pyのパラメータは以下のとおり。</p>

<table>
<thead>
<tr>
<th>パラメータ</th>
<th>概要</th>
</tr>
</thead>
<tbody>
<tr>
<td>version</td>
<td>ソフトウェアのバージョン番号</td>
</tr>
<tr>
<td>description</td>
<td>ソフトウェアの概要説明</td>
</tr>
<tr>
<td>author</td>
<td>作成者名</td>
</tr>
<tr>
<td>author_email</td>
<td>作成者の連絡先</td>
</tr>
<tr>
<td>url</td>
<td>プロジェクトのurl</td>
</tr>
<tr>
<td>license</td>
<td>ライセンス情報（テンプレートでは未記載）</td>
</tr>
<tr>
<td>keywords</td>
<td>キーワード情報（テンプレートでは未記載）</td>
</tr>
<tr>
<td>long_description</td>
<td>ソフトウェアのより詳細な説明</td>
</tr>
<tr>
<td>console/windows</td>
<td>エラーメッセージ出力を望むか、コンソールプログラムを動作させるならconsoleパラメータとして、純粋なUIアプリとして、動作させるなら、windowsパラメータとして宣言する。</td>
</tr>
<tr>
<td>options</td>
<td>辞書のキーとして、compressed, optimize, bundle_filesを指定する。（テンプレートでは未記載）</td>
</tr>
<tr>
<td>include_package_data</td>
<td>CVSやSubversion、MANIFEST.inファイルに指定されているファイルを含めるかどうかを示すbool値</td>
</tr>
<tr>
<td>package_dir</td>
<td>パッケージの基底となるディレクトリ情報</td>
</tr>
<tr>
<td>package_data</td>
<td>パッケージ名と、ファイル名のパターンのリストを対応付ける辞書</td>
</tr>
<tr>
<td>py_modules</td>
<td>パッケージ化されていないpythonモジュール群の指定</td>
</tr>
<tr>
<td>data_files</td>
<td>純正pythonパッケージ以外で配布物に含めるファイル群の指定</td>
</tr>
<tr>
<td>zipfile</td>
<td>pythonのモジュール群をzipfile化するかどうか指定</td>
</tr>
</tbody>
</table>

<p>※他にも様々なパラメータがある。詳しくはサイト末尾のリンクから調べると良い。</p>

<p>その他のメソッドについて、下記にその意味を解説していく。なお、これらの関数とテンプレートの中の&lt;&gt;変数に関しては、必須ではないので、プロジェクトに合わせて、各自変更すれば良い。</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_py_modules</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
    <span class="n">py_modules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">'.py'</span> <span class="ow">and</span> <span class="n">base</span> <span class="o">!=</span> <span class="s1">'&lt;AppName&gt;'</span><span class="p">:</span> <span class="n">py_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">py_modules</span>
</pre></div></div>

<p>find_py_modulesは、find_packagesのモジュール版（も簡易実装）である。外部パッケージを組み合わせたアプリケーションの場合、コアとなるソースはパッケージにするまでもない単位である場合がある。そのようなときは、packagesパラメータと、find_packagesメソッドの代わりに、py_modulesパラメータと、find_py_modulesメソッド（中身は各自、調整すること）を組み合わせると良い。</p>

<div class="code-frame" data-lang="python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">fname</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div></div>

<p>readメソッドは、long_descriptionの内容をファイルから読み込むためのメソッドである。descriptionでは説明が足りない規模のアプリケーションを作る場合に便利なメソッドである。</p>

<h2>
<span id="リンク" class="fragment"></span><a href="#%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>リンク</h2>

<p>setuptoolsそのものに関しては、正確で包括的な情報を有するブログがあるので、こちらを参照してほしい。</p>

<ul>
<li><a href="http://d.hatena.ne.jp/SumiTomohiko/20070609/1181406701" rel="nofollow noopener" target="_blank">SumiTomohikoの日記</a></li>
</ul>

<p>このサイトを作るときもこのサイトを参考にした。setuptoolsを扱う上で、起点となるサイトだと思う。その他、easy_installとdistributeに関してのリンクは以下のとおり。両方共、英語のサイトなので、もっと簡単な解説が欲しい場合は、以下のキーワード（+python）でGoogleで検索すると良い。</p>

<ul>
<li><del><a href="http://pypi.python.org/pypi/distribute" rel="nofollow noopener" target="_blank">distributeについて</a></del></li>
<li><a href="https://bitbucket.org/pypa/setuptools" rel="nofollow noopener" target="_blank">ez_setupについて</a></li>
<li>
<a href="https://pythonhosted.org/setuptools/easy_install.html" rel="nofollow noopener" target="_blank">easy_installについて</a>
 </li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>6</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/6fe47ce4231fe0a4360c">MacでPortAudioを使ってWavファイルを再生する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-15 15:50:58</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[C++]</b> <b>[Mac]</b> <b>[Play]</b> <b>[wav]</b> <b>[libsndfile]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>PortAudioはmac, linux, windowsと共通で使える音操作ライブラリなので、今後、音に関する実装をする場合は、なるべくportaudioを使っていこうと思う。StackOverflowでサンプルソースは載っているけど、前提となるライブラリのインストールに関しては、触れられていないので、macにおけるインストール・ビルド方法を簡単にまとめてみる。なお、パッケージ管理としてはhomebrewを使うことにして、MacPortsは使わない。なお、Linuxもほとんど手順が変わらないので、brewをapt-getに読みかえれば、この手順で進めることができると思う。</p>

<h2>
<span id="インストールセットアップ" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>インストール／セットアップ</h2>

<p>portaudioを使って、wavファイルを再生するためには以下の2つのライブラリをインストールする必要がある。</p>

<ul>
<li>libsndfile</li>
<li>portaudio</li>
</ul>

<p>portaudioは、普通にhomebrewでインストールできるが、sndfileは見つからなかったので、ソースからビルドすることにする。</p>

<h3>
<span id="libsndfileのインストール" class="fragment"></span><a href="#libsndfile%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>libsndfileのインストール</h3>

<p>以下のサイトから、ソースを持ってきて、ビルド・インストールする。</p>

<ul>
<li><a href="http://www.mega-nerd.com/libsndfile/" class="autolink" rel="nofollow noopener" target="_blank">http://www.mega-nerd.com/libsndfile/</a></li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ wget http://www.mega-nerd.com/libsndfile/files/libsndfile-1.0.25.tar.gz
$ cd libsndfile-1.0.25
$ ./configure
$ make
</pre></div></div>

<p>makeは最後までいかず、examplesのどれかで失敗する(Carbon.hが見つからないとエラーがでる)けど、ライブラリのビルドは終了しているので、気にせずインストールする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo make install
</pre></div></div>

<p>注意：/usr/local/libにインストールされるが、その後、brewのインストール時に警告が出る。出ないようにするには別のprefixを指定してインストールして、パスを指定する必要があるが、ここではやらない。</p>

<h3>
<span id="portaudioのインストール" class="fragment"></span><a href="#portaudio%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>portaudioのインストール</h3>

<p>portaudioはbrewでインストールできるので、さくっとインストールする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew install --universal portaudio
</pre></div></div>

<h1>
<span id="サンプルコード" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89"><i class="fa fa-link"></i></a>サンプルコード</h1>

<p>あとは自由にやれば良いが、ページ的に収まりが悪いので、サンプルのビルドも書いておく。サンプルは、Stackoverflowから持ってきた。</p>

<div class="code-frame" data-lang="C++">
<div class="code-lang"><span class="bold">main.cpp</span></div>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">"sndfile.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"portaudio.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="cm">/* the filename is defined here because this is just a demo */</span>
<span class="cp">#define FILE_NAME "test.wav"</span>


<span class="cm">/*</span>
<span class="cm">Data structure to pass to callback</span>
<span class="cm">includes the sound file, info about the sound file, and a position</span>
<span class="cm">cursor (where we are in the sound file)</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">OurData</span>
<span class="p">{</span>
  <span class="n">SNDFILE</span> <span class="o">*</span><span class="n">sndFile</span><span class="p">;</span>
  <span class="n">SF_INFO</span> <span class="n">sfInfo</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">position</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm">Callback function for audio output</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">Callback</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">input</span><span class="p">,</span>
             <span class="kt">void</span> <span class="o">*</span><span class="n">output</span><span class="p">,</span>
             <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">frameCount</span><span class="p">,</span>
             <span class="k">const</span> <span class="n">PaStreamCallbackTimeInfo</span><span class="o">*</span> <span class="n">paTimeInfo</span><span class="p">,</span>
             <span class="n">PaStreamCallbackFlags</span> <span class="n">statusFlags</span><span class="p">,</span>
             <span class="kt">void</span> <span class="o">*</span><span class="n">userData</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">OurData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">OurData</span> <span class="o">*</span><span class="p">)</span><span class="n">userData</span><span class="p">;</span> <span class="cm">/* we passed a data structure</span>
<span class="cm">into the callback so we have something to work with */</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">cursor</span><span class="p">;</span> <span class="cm">/* current pointer into the output  */</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">output</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">thisSize</span> <span class="o">=</span> <span class="n">frameCount</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">thisRead</span><span class="p">;</span>

  <span class="n">cursor</span> <span class="o">=</span> <span class="n">out</span><span class="p">;</span> <span class="cm">/* set the output cursor to the beginning */</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">thisSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="cm">/* seek to our current file position */</span>
    <span class="n">sf_seek</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">sndFile</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">);</span>

    <span class="cm">/* are we going to read past the end of the file?*/</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">thisSize</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">sfInfo</span><span class="p">.</span><span class="n">frames</span> <span class="o">-</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="cm">/*if we are, only read to the end of the file*/</span>
      <span class="n">thisRead</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">sfInfo</span><span class="p">.</span><span class="n">frames</span> <span class="o">-</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">;</span>
      <span class="cm">/* and then loop to the beginning of the file */</span>
      <span class="n">data</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="cm">/* otherwise, we'll just fill up the rest of the output buffer */</span>
      <span class="n">thisRead</span> <span class="o">=</span> <span class="n">thisSize</span><span class="p">;</span>
      <span class="cm">/* and increment the file position */</span>
      <span class="n">data</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">+=</span> <span class="n">thisRead</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* since our output format and channel interleaving is the same as</span>
<span class="cm">sf_readf_int's requirements */</span>
    <span class="cm">/* we'll just read straight into the output buffer */</span>
    <span class="n">sf_readf_int</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">sndFile</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">thisRead</span><span class="p">);</span>
    <span class="cm">/* increment the output cursor*/</span>
    <span class="n">cursor</span> <span class="o">+=</span> <span class="n">thisRead</span><span class="p">;</span>
    <span class="cm">/* decrement the number of samples left to process */</span>
    <span class="n">thisSize</span> <span class="o">-=</span> <span class="n">thisRead</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">paContinue</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">OurData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">OurData</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">OurData</span><span class="p">));</span>
  <span class="n">PaStream</span> <span class="o">*</span><span class="n">stream</span><span class="p">;</span>
  <span class="n">PaError</span> <span class="n">error</span><span class="p">;</span>
  <span class="n">PaStreamParameters</span> <span class="n">outputParameters</span><span class="p">;</span>

  <span class="cm">/* initialize our data structure */</span>
  <span class="n">data</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">data</span><span class="o">-&gt;</span><span class="n">sfInfo</span><span class="p">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="cm">/* try to open the file */</span>
  <span class="n">data</span><span class="o">-&gt;</span><span class="n">sndFile</span> <span class="o">=</span> <span class="n">sf_open</span><span class="p">(</span><span class="n">FILE_NAME</span><span class="p">,</span> <span class="n">SFM_READ</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">sfInfo</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">sndFile</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"error opening file</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* start portaudio */</span>
  <span class="n">Pa_Initialize</span><span class="p">();</span>

  <span class="cm">/* set the output parameters */</span>
  <span class="n">outputParameters</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">Pa_GetDefaultOutputDevice</span><span class="p">();</span> <span class="cm">/* use the</span>
<span class="cm">default device */</span>
  <span class="n">outputParameters</span><span class="p">.</span><span class="n">channelCount</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">sfInfo</span><span class="p">.</span><span class="n">channels</span><span class="p">;</span> <span class="cm">/* use the</span>
<span class="cm">same number of channels as our sound file */</span>
  <span class="n">outputParameters</span><span class="p">.</span><span class="n">sampleFormat</span> <span class="o">=</span> <span class="n">paInt32</span><span class="p">;</span> <span class="cm">/* 32bit int format */</span>
  <span class="n">outputParameters</span><span class="p">.</span><span class="n">suggestedLatency</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="cm">/* 200 ms ought to satisfy</span>
<span class="cm">even the worst sound card */</span>
  <span class="n">outputParameters</span><span class="p">.</span><span class="n">hostApiSpecificStreamInfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* no api specific data */</span>

  <span class="cm">/* try to open the output */</span>
  <span class="n">error</span> <span class="o">=</span> <span class="n">Pa_OpenStream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">,</span>  <span class="cm">/* stream is a 'token' that we need</span>
<span class="cm">to save for future portaudio calls */</span>
                        <span class="mi">0</span><span class="p">,</span>  <span class="cm">/* no input */</span>
                        <span class="o">&amp;</span><span class="n">outputParameters</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">-&gt;</span><span class="n">sfInfo</span><span class="p">.</span><span class="n">samplerate</span><span class="p">,</span>  <span class="cm">/* use the same</span>
<span class="cm">sample rate as the sound file */</span>
                        <span class="n">paFramesPerBufferUnspecified</span><span class="p">,</span>  <span class="cm">/* let</span>
<span class="cm">portaudio choose the buffersize */</span>
                        <span class="n">paNoFlag</span><span class="p">,</span>  <span class="cm">/* no special modes (clip off, dither off) */</span>
                        <span class="n">Callback</span><span class="p">,</span>  <span class="cm">/* callback function defined above */</span>
                        <span class="n">data</span> <span class="p">);</span> <span class="cm">/* pass in our data structure so the</span>
<span class="cm">callback knows what's up */</span>

  <span class="cm">/* if we can't open it, then bail out */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"error opening output, error code = %i</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="n">Pa_Terminate</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* when we start the stream, the callback starts getting called */</span>
  <span class="n">Pa_StartStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
  <span class="n">Pa_Sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="cm">/* pause for 2 seconds (2000ms) so we can hear a bit</span>
<span class="cm">of the output */</span>
  <span class="n">Pa_StopStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span> <span class="c1">// stop the stream</span>
  <span class="n">Pa_Terminate</span><span class="p">();</span> <span class="c1">// and shut down portaudio</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>

<p>後は、makefileを書くだけ、cmakeでビルドすることにする。サンプルだけにしては仰々しいが以下のファイル構成において、CMakeLists.txtを書いた。</p>

<p>├── CMakeLists.txt<br>
└── src<br>
    ├── CMakeLists.txt<br>
    └── main.cpp</p>

<p>cmakeがインストールされていない場合は、brewで入れておく</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ brew install cmake
</pre></div></div>

<p>以下、それぞれのCMakeLists.txtの中身。</p>

<div class="code-frame" data-lang="cmake">
<div class="code-lang"><span class="bold">CMakeLists.txt</span></div>
<div class="highlight"><pre><span></span><span class="c"># -*- CMakeLists.txt -*-</span>

<span class="nb">cmake_minimum_required</span> <span class="p">(</span><span class="s">VERSION</span> <span class="s">2.6</span><span class="p">)</span>

<span class="c"># バージョン番号</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">serial</span> <span class="s2">"0.0.1"</span><span class="p">)</span>

<span class="c"># 共有ライブラリのバージョン番号</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">soserial</span> <span class="s2">"0"</span><span class="p">)</span>

<span class="nb">project</span> <span class="p">(</span><span class="s">sound</span><span class="p">)</span>
<span class="nb">include_directories</span> <span class="p">(</span><span class="s2">"${PROJECT_SOURCE_DIR}/include"</span><span class="p">)</span>

<span class="c"># サブディレクトリの指定</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">src</span><span class="p">)</span>

<span class="c"># クリーン対象の追加</span>
<span class="nb">set_directory_properties</span> <span class="p">(</span>
  <span class="s">PROPERTIES</span>
  <span class="s">ADDITIONAL_MAKE_CLEAN_FILES</span> <span class="s2">"*~"</span>
  <span class="p">)</span>
</pre></div>
</div>

<div class="code-frame" data-lang="cmake">
<div class="code-lang"><span class="bold">src/CMakeLists.txt</span></div>
<div class="highlight"><pre><span></span><span class="c"># -*- CMakeLists.txt -*-</span>

<span class="c"># プログラムの追加</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">myplay</span> <span class="s">main.cpp</span><span class="p">)</span>

<span class="c"># CFLAGSの追加</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CMAKE_CXX_FLAGS</span> <span class="s2">"-Wall -I${PROJECT_SRC_DIRECTORY}/include"</span><span class="p">)</span>

<span class="c"># LDFLAGSの追加</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CMAKE_EXE_LINKER_FLAGS</span> <span class="o">${</span><span class="nv">PLATFORM_LDFLAGS</span><span class="o">}</span><span class="p">)</span>

<span class="c"># ライブラリの追加</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">LOCAL_LINK_LIBRARIES</span> <span class="s">portaudio</span> <span class="s">sndfile</span><span class="p">)</span>
<span class="nb">link_directories</span> <span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_SRC_DIRECTORY</span><span class="o">}</span><span class="s">/lib</span><span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span><span class="s">myplay</span> <span class="o">${</span><span class="nv">LOCAL_LINK_LIBRARIES</span><span class="o">}</span><span class="p">)</span>

<span class="c"># クリーン対象の追加</span>
<span class="nb">set_directory_properties</span> <span class="p">(</span>
  <span class="s">PROPERTIES</span>
  <span class="s">ADDITIONAL_MAKE_CLEAN_FILES</span>
  <span class="s2">"*~"</span>
  <span class="p">)</span>
</pre></div>
</div>

<p>後は、buildディレクトリでも作って、ビルドするだけ</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir build
$ cmake ..
$ make
$ myplay
</pre></div></div>

<p>使用するサウンドファイルはソースに定義されている引数で指定したい場合は各自、ソースを修正すること。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/0734ae1cac67d46896b9">Xcode5でboostライブラリを使う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-20 17:43:50</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[homebrew]</b> <b>[boost]</b> <b>[xcode5]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>僕はObjective Cが苦手だ。文法が分からない・・。しかし、現実の要求は、エンジニアに言語を選択する自由を与えてくれない。これは、既存のObjective Cのコードにサーバ機能をつけなくてはいけなくなった奮闘の記録（リマインダ）である。</p>

<h1>
<span id="環境" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83"><i class="fa fa-link"></i></a>環境</h1>

<p>XCodeのプログラムでboostを使う問題は、Stack Overflowでもいろいろ議論されており、バージョンが違うとインタフェースも変わってしまったり解決方法が適用できなくなったりするので、この記録が役に立つかは分からない。ただ、少なくとも動いた環境は明確にしておく。</p>

<ul>
<li>XCode Ver. 5.0.2</li>
<li>boost_1_55_0

<ul>
<li>homebrewによってインストールされている</li>
</ul>
</li>
<li>使用したパッケージ

<ul>
<li>boost::asio</li>
</ul>
</li>
</ul>

<p>既存のXCodeのプロジェクトにboost::asioを使ったサーバ機能を付加する目的で行った。また、実際に使ったプロジェクトのビルドに関するすべては膨大になるので、触れない。</p>

<h1>
<span id="前提" class="fragment"></span><a href="#%E5%89%8D%E6%8F%90"><i class="fa fa-link"></i></a>前提</h1>

<p>とりあえず、C++のソースを絡めてビルドするためのお約束は守る。</p>

<ul>
<li>ソースファイルが、&lt;filename&gt;.mだったら、&lt;filename&gt;.mmに変更する</li>
<li>Project設定のBuild Settingsで、LinkingのOther Linker Flagsに以下のフラグを追加

<ul>
<li>-L/usr/local/lib</li>
<li>-lboost_thread-mt</li>
<li>-lboost_system-mt</li>
<li>-lboost_date_time-mt</li>
<li>-lc++</li>
</ul>
</li>
</ul>

<p>※なお、必要なboostのライブラリはそれぞれ異なるので、必要に応じて、設定しよう</p>

<p>ここで、注目なのが、-lc++をリンクしているところだ。makeするときのように-lstdc++としたら、コンパイルが失敗した。</p>

<h1>
<span id="トライアル1-そのまま使う" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%AB1-%E3%81%9D%E3%81%AE%E3%81%BE%E3%81%BE%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>トライアル1: そのまま使う</h1>

<p>まず第一に思いつくのが、boostのヘッダをObjective-C++のコードに直接インクルードして使う方法。しかし、この試みは水泡に帰した。具体的には、has_binary_operator.hppというソースの以下の部分でビルドエラーが出る。</p>

<div class="code-frame" data-lang="c++"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Lhs</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Rhs</span> <span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">operator_exists</span> <span class="p">{</span>
   <span class="k">static</span> <span class="o">::</span><span class="n">boost</span><span class="o">::</span><span class="n">type_traits</span><span class="o">::</span><span class="n">yes_type</span> <span class="n">check</span><span class="p">(</span><span class="n">has_operator</span><span class="p">);</span> <span class="c1">// this version is preferred when operator exists</span>
   <span class="k">static</span> <span class="o">::</span><span class="n">boost</span><span class="o">::</span><span class="n">type_traits</span><span class="o">::</span><span class="n">no_type</span> <span class="n">check</span><span class="p">(</span><span class="n">no_operator</span><span class="p">);</span> <span class="c1">// this version is used otherwise</span>

   <span class="n">BOOST_STATIC_CONSTANT</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">check</span><span class="p">(((</span><span class="n">make</span><span class="o">&lt;</span><span class="n">Lhs</span><span class="o">&gt;</span><span class="p">()</span> <span class="n">BOOST_TT_TRAIT_OP</span> <span class="n">make</span><span class="o">&lt;</span><span class="n">Rhs</span><span class="o">&gt;</span><span class="p">()),</span><span class="n">make</span><span class="o">&lt;</span><span class="n">has_operator</span><span class="o">&gt;</span><span class="p">())))</span><span class="o">==</span><span class="k">sizeof</span><span class="p">(</span><span class="o">::</span><span class="n">boost</span><span class="o">::</span><span class="n">type_traits</span><span class="o">::</span><span class="n">yes_type</span><span class="p">)));</span>
<span class="p">};</span>
</pre></div></div>

<p>いろいろなところでマクロ設定すれば良いよなどと指摘されているが、うまくいかずに断念。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#define __ASSERT_MACROS_DEFINE_VERSIONS_WITHOUT_UNDERSCORES 0
</pre></div></div>

<h1>
<span id="トライアル2-boost機能部分をラップするライブラリ経由で使う" class="fragment"></span><a href="#%E3%83%88%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%AB2-boost%E6%A9%9F%E8%83%BD%E9%83%A8%E5%88%86%E3%82%92%E3%83%A9%E3%83%83%E3%83%97%E3%81%99%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E7%B5%8C%E7%94%B1%E3%81%A7%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>トライアル2: boost機能部分をラップするライブラリ経由で使う</h1>

<p>ヘッダのコンパイルが通らなかったからといって、あきらめるのは早すぎる！ということで、boostの必要部分をラップするライブラリlibwrapper.aを作って、再チャレンジ。注意点としては、インクルードするラッパーライブラリのヘッダの中でboostのヘッダファイルを呼ばないように気をつけること。どうしても、boostのクラスインスタンスがクラスの変数で必要な場合は、ソースファイルの中でstatic宣言などして、回避した。</p>

<p>ヘッダファイルをソースにコピーし、mmファイルにインクルードし、Build Settingsを以下のように書き換える。</p>

<ul>
<li>Other Linker Flag

<ul>
<li>-Llib</li>
<li>-lwrapper</li>
<li>-L/usr/local/lib</li>
<li>-lboost_thread-mt</li>
<li>-lboost_system-mt</li>
<li>-lboost_date_time-mt</li>
<li>-lc++</li>
</ul>
</li>
</ul>

<p>このとき、xcodeprojと並列のディレクトリにlibディレクトリをおき、中にlibwrapper.aを配置した。</p>

<p>これでビルドがうまく行った。boostを直接、使うことは難題だが、少しラップしてあげるとうまくいくらしい。めでたしめでたし。</p>

<h2>
<span id="libwrapperaのビルド方法" class="fragment"></span><a href="#libwrappera%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>libwrapper.aのビルド方法</h2>

<p>上記のファイル名は仮の名前だが、ビルドをしたときのコンパイラなどの設定は以下の通り</p>

<ul>
<li>CMAKE_AR:FILEPATH=/usr/bin/ar</li>
<li>CMAKE_CXX_COMPILER:FILEPATH=/usr/bin/c++</li>
</ul>

<p>ビルドは、cmakeを通して行い、そのときのコンパイラ・リンカは、上記のとおりである。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/9254a6bfb2c70c1c3e09">Javaのapache.commons.dbutilsパッケージのO/Rマッパーラッピング</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-18 14:12:08</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[processing]</b> <b>[SQLite3]</b> <b>[sqlite]</b> <b>[dbutils]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>apache.commons.dbutilsパッケージは、Javaでデータベースを扱うときに軽量のO/Rマッパーに近いインタフェースを提供するパッケージです。簡単な使い方は以下のページから見ることができます。</p>

<ul>
<li><a href="http://d.hatena.ne.jp/Kishi/20081212/1229076102" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/Kishi/20081212/1229076102</a></li>
</ul>

<p>普通にJavaのO/Rマッパーを使おうと思うと、かなり容量の大きいJarファイルをインポートする必要があり、かつxmlの設定などが必要だったりといろいろと面倒になります。このdbutilsは比較的薄いラッパーを提供するパッケージなので、容量が少なく、手軽に使えるのが特徴です。</p>

<p>ただ、sql文をそのまま使うためにO/Rマッパーというには少しもの足りない部分があります。今回は、その使い方をもう少しO/Rマッパーに近づけるため、ラッピングクラスを作ったので、自分のリマインダを兼ねてソースをさらしておきます。</p>

<p>注意：Processing用のコードとして使ったので、eclipseで使おうと思うと色々とWarningが出ると思いますが、適当に解決してください。</p>

<h2>
<span id="インストールセットアップ" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>インストール／セットアップ</h2>

<p>今回のコードサンプルを使うためには、以下のパッケージが必要です。</p>

<ul>
<li>sqlite-jdbc-3.7.2.jar</li>
<li>commons-dbutils-1.5.jar</li>
</ul>

<p>上の２つは、apache.commons.dbutilsパッケージを使うために必要です。それぞれ以下のサイトからダウンロードすることができます。</p>

<ul>
<li><a href="https://bitbucket.org/xerial/sqlite-jdbc/downloads" class="autolink" rel="nofollow noopener" target="_blank">https://bitbucket.org/xerial/sqlite-jdbc/downloads</a></li>
<li><a href="http://commons.apache.org/proper/commons-dbutils/download_dbutils.cgi" class="autolink" rel="nofollow noopener" target="_blank">http://commons.apache.org/proper/commons-dbutils/download_dbutils.cgi</a></li>
</ul>

<p>それ以外にも以下のパッケージを使用しています。</p>

<ul>
<li>logback-classic-0.9.30.jar</li>
<li>logback-core-0.9.30.jar</li>
<li>slf4j-api-1.6.3.jar </li>
</ul>

<p>上記のの3つはログ用に使用しています。以下のサイトから取得できますが、面倒なら、コードの中のlogger.error()という関数をSystem.err.println()に置き換えれば使う必要はありません。</p>

<ul>
<li><a href="http://logback.qos.ch/download.html" class="autolink" rel="nofollow noopener" target="_blank">http://logback.qos.ch/download.html</a></li>
<li><a href="http://www.slf4j.org/download.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.slf4j.org/download.html</a></li>
</ul>

<p>※なお、バージョン番号は最新のものになっているはずでずれている可能性があります。</p>

<h2>
<span id="ラッパークラスの実装" class="fragment"></span><a href="#%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>ラッパークラスの実装</h2>

<p>今回実装したのは以下の機能です。</p>

<ul>
<li>staticなcreateTableメソッド</li>
<li>各種insert, select, update, deleteメソッド</li>
</ul>

<p>createTableメソッドは、なぜ普通に実装されていないのか謎ですが、クラス定義を与えるとそのpublicなフィールドによって構成されるテーブルを作成するメソッドです。テーブル名は、クラス名になります。insert,select,update,deleteはメジャーな機能をそれぞれsql文なしで実現するという試みです。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">DBConnection.java</span></div>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Statement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.dbutils.QueryRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.dbutils.ResultSetHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.dbutils.handlers.BeanListHandler</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.Class</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DBConnection</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">DBConnection</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">DBConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">init</span> <span class="o">(</span><span class="n">String</span> <span class="n">dbpath</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">DBConnection</span><span class="o">.</span><span class="na">connection</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">DBConnection</span><span class="o">.</span><span class="na">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DBConnection</span> <span class="o">(</span><span class="n">dbpath</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">fieldTypeMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span> <span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">()</span> <span class="o">{{</span>
        <span class="n">put</span> <span class="o">(</span><span class="s">"int"</span><span class="o">,</span> <span class="s">"INT"</span><span class="o">);</span>
        <span class="n">put</span> <span class="o">(</span><span class="s">"long"</span><span class="o">,</span> <span class="s">"INT"</span><span class="o">);</span>
        <span class="n">put</span> <span class="o">(</span><span class="s">"double"</span><span class="o">,</span> <span class="s">"DOUBLE"</span><span class="o">);</span>
        <span class="n">put</span> <span class="o">(</span><span class="s">"float"</span><span class="o">,</span> <span class="s">"FLOAT"</span><span class="o">);</span>
        <span class="n">put</span> <span class="o">(</span><span class="s">"boolean"</span><span class="o">,</span> <span class="s">"BOOLEAN"</span><span class="o">);</span> 

        <span class="n">put</span> <span class="o">(</span><span class="s">"java.lang.Integer"</span><span class="o">,</span> <span class="s">"INT"</span><span class="o">);</span>
        <span class="n">put</span> <span class="o">(</span><span class="s">"java.lang.Long"</span><span class="o">,</span> <span class="s">"INT"</span><span class="o">);</span>
        <span class="n">put</span> <span class="o">(</span><span class="s">"java.lang.Double"</span><span class="o">,</span> <span class="s">"DOUBLE"</span><span class="o">);</span>
        <span class="n">put</span> <span class="o">(</span><span class="s">"java.lang.Float"</span><span class="o">,</span> <span class="s">"FLOAT"</span><span class="o">);</span>       
        <span class="n">put</span> <span class="o">(</span><span class="s">"java.lang.Boolean"</span><span class="o">,</span> <span class="s">"BOOLEAN"</span><span class="o">);</span>

        <span class="n">put</span> <span class="o">(</span><span class="s">"java.lang.String"</span><span class="o">,</span> <span class="s">"varchar(255)"</span><span class="o">);</span>
    <span class="o">}};</span>

    <span class="kd">protected</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">dropTableStatement</span> <span class="o">=</span> <span class="s">"drop table %s;"</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">createTableStatement</span> <span class="o">=</span> <span class="s">"create TABLE %s (%s);"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">createTable</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">forceDrop</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">forceDrop</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Statement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">setQueryTimeout</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">dropTableStatement</span><span class="o">,</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">()));</span>
                <span class="n">statement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">createTable</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">createTable</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Field</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getFields</span><span class="o">();</span>
            <span class="c1">// StringBuffer buf = new StringBuffer();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">declarations</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Field</span> <span class="n">f</span> <span class="o">:</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">fieldType</span> <span class="o">=</span> <span class="n">fieldTypeMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getType</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">fieldType</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">continue</span><span class="o">;</span>
                <span class="n">declarations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">fieldType</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">String</span> <span class="n">fieldDeclaration</span> <span class="o">=</span> <span class="n">concatWithCommas</span><span class="o">(</span><span class="n">declarations</span><span class="o">);</span>
            <span class="c1">//logger.debug(fieldDeclaration);</span>
            <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                <span class="n">createTableStatement</span><span class="o">,</span> 
                <span class="n">clazz</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">(),</span> 
                <span class="n">fieldDeclaration</span>
                <span class="o">);</span>
            <span class="c1">//logger.debug("query: {}", query);</span>
            <span class="n">DBConnection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">getInstance</span><span class="o">();</span>

            <span class="n">Statement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
            <span class="n">statement</span><span class="o">.</span><span class="na">setQueryTimeout</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>
            <span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>

            <span class="n">statement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">DBConnection</span> <span class="nf">getInstance</span> <span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">DBConnection</span><span class="o">.</span><span class="na">connection</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">dbpath</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">QueryRunner</span> <span class="n">qr</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">queryStatementMap</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>


    <span class="kd">public</span> <span class="nf">DBConnection</span> <span class="o">(</span><span class="n">String</span> <span class="n">dbpath</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dbpath</span> <span class="o">=</span> <span class="n">dbpath</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">qr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">connect</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">"failed to connect db."</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">registerTable</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Field</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getFields</span><span class="o">();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fieldNames</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">insertions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fieldEquations</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>

            <span class="k">for</span> <span class="o">(</span><span class="n">Field</span> <span class="n">f</span><span class="o">:</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">fieldNames</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
                <span class="n">insertions</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"?"</span><span class="o">);</span>
                <span class="n">fieldEquations</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s = ?"</span><span class="o">,</span> <span class="n">f</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
            <span class="o">}</span>

            <span class="n">String</span> <span class="n">insertStatement</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                <span class="s">"insert into %s(%s) values(%s)"</span><span class="o">,</span>
                <span class="n">clazz</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">(),</span>
                <span class="n">concatWithCommas</span><span class="o">(</span><span class="n">fieldNames</span><span class="o">),</span>
                <span class="n">concatWithCommas</span><span class="o">(</span><span class="n">insertions</span><span class="o">)</span>
                <span class="o">);</span>

            <span class="n">String</span> <span class="n">selectStatement</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                <span class="s">"select * from %s"</span><span class="o">,</span>
                <span class="n">clazz</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">()</span>
                <span class="o">);</span>

            <span class="n">String</span> <span class="n">updateStatement</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                <span class="s">"update %s set %s"</span><span class="o">,</span>
                <span class="n">clazz</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">(),</span>
                <span class="n">concatWithCommas</span><span class="o">(</span><span class="n">fieldEquations</span><span class="o">)</span>
                <span class="o">);</span>

            <span class="n">String</span> <span class="n">deleteStatement</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                <span class="s">"delete from %s"</span><span class="o">,</span>
                <span class="n">clazz</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">toLowerCase</span><span class="o">()</span>
                <span class="o">);</span>

            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">();</span>
            <span class="n">queryStatements</span><span class="o">.</span><span class="na">put</span> <span class="o">(</span><span class="s">"insert"</span><span class="o">,</span> <span class="n">insertStatement</span><span class="o">);</span>
            <span class="n">queryStatements</span><span class="o">.</span><span class="na">put</span> <span class="o">(</span><span class="s">"select"</span><span class="o">,</span> <span class="n">selectStatement</span><span class="o">);</span>
            <span class="n">queryStatements</span><span class="o">.</span><span class="na">put</span> <span class="o">(</span><span class="s">"update"</span><span class="o">,</span> <span class="n">updateStatement</span><span class="o">);</span>
            <span class="n">queryStatements</span><span class="o">.</span><span class="na">put</span> <span class="o">(</span><span class="s">"delete"</span><span class="o">,</span> <span class="n">deleteStatement</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">put</span> <span class="o">(</span><span class="n">clazz</span><span class="o">,</span> <span class="n">queryStatements</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">boolean</span> <span class="nf">connect</span> <span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"org.sqlite.JDBC"</span><span class="o">);</span>
            <span class="k">this</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">dbpath</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"class not found: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"SQL Exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> 
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">close</span> <span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="k">this</span><span class="o">.</span><span class="na">con</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"SQL Exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Exception: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>           
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">insert</span> <span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">insertStatement</span> <span class="o">=</span> <span class="n">queryStatements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"insert"</span><span class="o">);</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">fieldValues</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Field</span> <span class="n">f</span><span class="o">:</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getFields</span><span class="o">())</span> <span class="n">fieldValues</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">obj</span><span class="o">));</span>
            <span class="k">this</span><span class="o">.</span><span class="na">qr</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">,</span> <span class="n">insertStatement</span><span class="o">,</span> <span class="n">fieldValues</span><span class="o">.</span><span class="na">toArray</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">select</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">String</span> <span class="n">whereStatement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">ResultSetHandler</span> <span class="n">h</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BeanListHandler</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">selectStatement</span> <span class="o">=</span> <span class="n">queryStatements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"select"</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">whereStatement</span><span class="o">;</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">List</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">qr</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">,</span> <span class="n">selectStatement</span><span class="o">,</span> <span class="n">param</span><span class="o">,</span> <span class="n">h</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">select</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">String</span> <span class="n">whereStatement</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">ResultSetHandler</span> <span class="n">h</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BeanListHandler</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">selectStatement</span> <span class="o">=</span> <span class="n">queryStatements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"select"</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">whereStatement</span><span class="o">;</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">List</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">qr</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">,</span> <span class="n">selectStatement</span><span class="o">,</span> <span class="n">params</span><span class="o">,</span> <span class="n">h</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span> <span class="nf">all</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">ResultSetHandler</span> <span class="n">h</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BeanListHandler</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">selectStatement</span> <span class="o">=</span> <span class="n">queryStatements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"select"</span><span class="o">);</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">List</span><span class="o">)</span><span class="k">this</span><span class="o">.</span><span class="na">qr</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">,</span> <span class="n">selectStatement</span><span class="o">,</span> <span class="n">h</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">update</span> <span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="n">String</span> <span class="n">whereStatement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Field</span> <span class="n">f</span><span class="o">:</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getFields</span><span class="o">())</span> <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">obj</span><span class="o">));</span>
            <span class="n">params</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">param</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">updateStatement</span> <span class="o">=</span> <span class="n">queryStatements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"update"</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">whereStatement</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">qr</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">,</span> <span class="n">updateStatement</span><span class="o">,</span> <span class="n">params</span><span class="o">.</span><span class="na">toArray</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">update</span> <span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="n">String</span> <span class="n">whereStatement</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">params_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;();</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">Field</span> <span class="n">f</span><span class="o">:</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getFields</span><span class="o">())</span> <span class="n">params_</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">obj</span><span class="o">));</span>
            <span class="n">params_</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">params</span><span class="o">));</span>
            <span class="n">String</span> <span class="n">updateStatement</span> <span class="o">=</span> <span class="n">queryStatements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"update"</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">whereStatement</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">qr</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">,</span> <span class="n">updateStatement</span><span class="o">,</span> <span class="n">params_</span><span class="o">.</span><span class="na">toArray</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">delete</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">String</span> <span class="n">whereStatement</span><span class="o">,</span> <span class="n">Object</span> <span class="n">param</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">deleteStatement</span> <span class="o">=</span> <span class="n">queryStatements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"delete"</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">whereStatement</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">qr</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">,</span> <span class="n">deleteStatement</span><span class="o">,</span> <span class="n">param</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">delete</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">String</span> <span class="n">whereStatement</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queryStatements</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">queryStatementMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">deleteStatement</span> <span class="o">=</span> <span class="n">queryStatements</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"delete"</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">whereStatement</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">qr</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">con</span><span class="o">,</span> <span class="n">deleteStatement</span><span class="o">,</span> <span class="n">params</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Error: {}"</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">concatWithCommas</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">words</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">StringBuffer</span> <span class="n">wordList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">word</span> <span class="o">:</span> <span class="n">words</span><span class="o">)</span> <span class="n">wordList</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">word</span> <span class="o">+</span> <span class="s">","</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">wordList</span><span class="o">.</span><span class="na">deleteCharAt</span><span class="o">(</span><span class="n">wordList</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>

<p>このクラスはProcessingで使うために作ったので、以下にProcessingのサンプルコードを添付しておきます。もちろん、pure Javaでも使えると思いますが、パッケージ名の指定などが必要だと思われます。</p>

<div class="code-frame" data-lang="processing">
<div class="code-lang"><span class="bold">DBUtil.pde</span></div>
<div class="highlight"><pre><span></span>import java.util.List;

DBConnection connection = null;

public void setup () {
    String dbpath = "jdbc:sqlite://" + sketchPath + "/data.db";
    print ("dbpath: " + dbpath);
    connection.init(dbpath);

    connection = DBConnection.getInstance();
    try {
        test_run();
        } catch (Exception e) {
            System.out.println("test failed: " + e.getMessage());
        }
}

public void draw () {
}

public void test_run () throws Exception {
    DBConnection.createTable(User.class, true);
    DBConnection db = DBConnection.getInstance();
    db.registerTable(User.class);

    //挿入
    println ("#############################################################");
    println ("insertion");
    println ("#############################################################");

    println ("");
    println ("inserting (1, Kishi) ...");
    User user = new User();
    user.setId(1);
    user.setName("Kishi");
    db.insert(user);

    println ("");
    println ("inserting (2, Kawa) ...");
    User user1 = new User();
    user1.setId(2);
    user1.setName("Kawa");
    db.insert(user1);

    println ("");
    println ("confirmation");
    println ("--------------");
    for(User u : (List&lt;User&gt;)db.all(User.class)) println (u.getId() + ":" + u.getName());

    println ("");
    println ("#############################################################");
    println ("selection");
    println ("#############################################################");

    //検索
    println("selecting");
    println ("select with name = Kishi ...");
    List&lt;User&gt; users = db.select(User.class, "where name=?", "Kishi");

    println ("");
    println ("confirmation");
    println ("--------------");
    for(User u : users) println (u.getId() + ":" + u.getName());

    println ("select with name = Kishi and id = 1 ...");
    users = db.select(User.class, "where name=? and id=?", new Object [] {"Kishi", 1});

    println ("");
    println ("confirmation");
    println ("--------------");
    for(User u : users) println (u.getId() + ":" + u.getName());


    println ("select all ...");
    users = db.all(User.class);
    println ("");
    println ("confirmation");
    println ("--------------");
    for(User u : users) println (u.getId() + ":" + u.getName());

    println ("");
    println ("#############################################################");
    println ("update");
    println ("#############################################################");

    user = users.get(0);

    println("updating the row with id = 1");
    User user_ = new User();
    user_.setName("Shiki");
    user_.setId(2);
    db.update(user_, "where id = ?", user.getId());

    println ("");
    println ("confirmation");
    println ("--------------");
    for(User u : (List&lt;User&gt;)db.all(User.class)) System.out.println(u.getId() + ":" + u.getName());

    println("updating the row with id = 2 and name = Shiki");
    User user__ = new User();
    user__.setName("Hoge");
    user__.setId(10);
    db.update(user__, "where id = ? and name = ?", new Object [] {user_.getId(), user_.getName()});

    println ("");
    println ("confirmation");
    println ("--------------");
    for(User u : (List&lt;User&gt;)db.all(User.class)) System.out.println(u.getId() + ":" + u.getName());

    println ("");
    println ("#############################################################");
    println ("delete");
    println ("#############################################################");

    println ("delete with id = 10 ...");
    db.delete(User.class, "where id=?", 10);

    println ("");
    println ("confirmation");
    println ("--------------");
    for(User u : (List&lt;User&gt;)db.all(User.class)) System.out.println(u.getId() + ":" + u.getName());

    println ("");
    println ("delete with id = 2 and name = Kawa ...");
    db.delete(User.class, "where id=? and name=?", new Object [] {2, "Kawa"});

    println ("");
    println ("confirmation");
    println ("--------------");
    for(User u : (List&lt;User&gt;)db.all(User.class)) System.out.println(u.getId() + ":" + u.getName());

    println ("");
    println ("#############################################################");
    println ("");
    println ("all process completed ...");

    db.close();
}
</pre></div>
</div>

<p>大抵が、printlnですが、流れを追うことができると思います。</p>

<p>なお、今回使用しているUserクラスの定義は以下のとおりです。ラッパークラスを使うためにはフィールド値はpublicにする必要があるので、注意してください。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">User.java</span></div>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />22位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/cd0c29a539969ad5cbff">Processing2.0でSpheroを動かす</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-09 22:04:18</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[processing]</b> <b>[Sphero]</b> <b>[Py4j]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>Spheroは知る人ぞ知るiphoneやandroidから操作することが出来るロボットボールである。タッチやフリック操作で、ボールを自在に操ることが出来る他、ボールを手にもって動かすことで入力インタフェースにもできる使い勝手の良いデバイスである。</p>

<p><a href="https://camo.qiitausercontent.com/b40499367b7fd32e4a372a31a56b9bd11066206f/687474703a2f2f7777772e77697265642e636f6d2f726576696577732f77702d636f6e74656e742f75706c6f6164732f323031312f31322f53706865726f312e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b40499367b7fd32e4a372a31a56b9bd11066206f/687474703a2f2f7777772e77697265642e636f6d2f726576696577732f77702d636f6e74656e742f75706c6f6164732f323031312f31322f53706865726f312e6a7067" alt="Sphero" data-canonical-src="http://www.wired.com/reviews/wp-content/uploads/2011/12/Sphero1.jpg"></a></p>

<p>このSphero、もちろん、iOS用やAndroid用の開発apiが公開されているのだが、もう少し手軽にパソコン（もっというとMac）から操作できないかと思い調べてみたら、案の定、rubyやpythonなどのスクリプト言語からアクセスする非公式のライブラリが提供されていた。しかし、自分が最近使っているのはProcessingであるため、できればProcessingで動かせると良い。そこで、簡単なラッパーを作ってGithubで公開（晒）してみた。</p>

<p>備忘録としてここに使い方を書いておく。</p>

<p>ちなみに拙い英語で、GithubのREADME.mdに使い方を書いてあるので、別にここを読まなくても使うことはできる（というか以下はREADME.mdの和訳です）。</p>

<h1>
<span id="セットアップ" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>セットアップ</h1>

<p>このプロジェクトは、py4jというパッケージを利用して、JavaからPythonのコードを実行できるようにしたラッパーである。そのため、必要なライブラリを自分で取ってくる必要がある。</p>

<ul>
<li>py4j: Gateway Server/Clientを介して、JavaとPythonのコードを双方のプログラムから呼び出すことができるようにするパッケージ

<ul>
<li>以下からインストールすることができる <a href="http://py4j.sourceforge.net/download.html" class="autolink" rel="nofollow noopener" target="_blank">http://py4j.sourceforge.net/download.html</a>
</li>
</ul>
</li>
<li>sphero: PythonのSphero制御パッケージ

<ul>
<li>pipでインストールできる
<code>
$ pip install sphero
</code>
</li>
</ul>
</li>
<li>slf4j: Java用のロギングインターフェースパッケージ（必要ないっちゃ必要ないけど、いつも使うので入れてしまいました）

<ul>
<li>次からからダウンロードできます。
<a href="http://www.slf4j.org/download.html" class="autolink" rel="nofollow noopener" target="_blank">http://www.slf4j.org/download.html</a>
</li>
<li>最新バージョンをダウンロードして、解凍する</li>
<li>解凍するといろいろでてくるが、以下のjarファイルをプロジェクトのcodeディレクトリにコピーする（なかったら、作る）

<ul>
<li>slf4j-api.jar</li>
</ul>
</li>
</ul>
</li>
<li>logback: ロギングの実装パッケージ

<ul>
<li>次からダウンロードできます <a href="http://logback.qos.ch/download.html" class="autolink" rel="nofollow noopener" target="_blank">http://logback.qos.ch/download.html</a>
</li>
<li>最新バージョンをダウンロードして、解凍する</li>
<li>解凍するといろいろでてくるが、以下のjarファイルをプロジェクトのcodeディレクトリにコピーする（なかったら、作る）

<ul>
<li>logback-classic.jar</li>
<li>logback-core.jar</li>
</ul>
</li>
</ul>
</li>
</ul>

<p>プロジェクトのソースコードは、以下から持ってくることができる<br>
<code><br>
$ git clone https://github.com/mountcedar/SpheroControl.git<br>
</code></p>

<p>すべての準備が整うと、プロジェクトのソースツリーは以下のようになっているはず。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>SpheroControl/
├── GatewayServer.pde
├── README.md
├── Sphero.pde
├── SpheroControl.pde
├── code
│   ├── logback-classic-X.X.X.jar
│   ├── logback-core-X.X.X.jar
│   ├── py4jX.X.jar
│   └── slf4j-api-X.X.X.jar
└── engine
    ├── __init__.py
    └── gateway.py
</pre></div></div>

<h1>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h1>

<p>プロジェクトの実行方法は、以下の通り。後は自分のやりたいことに従って、改造してください。</p>

<ol>
<li>Spheroを振って、スリープ状態から起こす</li>
<li>SpheroControl.pdeを実行</li>
<li>つながるまでしばらく待ちます。</li>
<li>コネクションが確立するまで、Spheroは色を変えながら点滅していますが、確立すると青白い色で固定します。</li>
<li>サンプルプログラムで、drawが呼び出されるたびに色がランダムで変化するプログラムが走ります。</li>
<li>エスケープキーで終了します。

<ul>
<li>注意として、エスケープキーではなく、Closeボタンで終了してしまうとバックグラウンドで動かしているpythonプロセスが終了しないままJavaの方だけが終了し、Pythonの方がゾンビプロセスとして残ります。その場合はkillコマンドなり、アクティビティモニタなりでPythonプロセスを強制終了してください。</li>
</ul>
</li>
</ol>

<p>APIはそんなに難しくないので、ソースコードを読んでください。Pythonプロセスがゾンビになりやすいことも含めて、自己解決できない方は手を出さない方が賢明かと思います（自分で公開しておいてごめんなさい）</p>

<h1>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h1>

<p>ここまで書いて、ふと同じ時間でシリアル通信を使ったpure processingのコードも書けたのではないか・・と思い、若干後悔している。できれば、そちらにも手を出したい。こういうの作ったら、やっぱり、Sphero側に一報すべきなんだろうか・・</p>

<h1>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h1>

<ul>
<li><a href="http://www.gosphero.com/ja/" class="autolink" rel="nofollow noopener" target="_blank">http://www.gosphero.com/ja/</a></li>
<li><a href="https://github.com/faulkner/sphero" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/faulkner/sphero</a></li>
<li><a href="https://github.com/mountcedar/SpheroControl" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/mountcedar/SpheroControl</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />23位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/dec2f0b38c8da05461f2">ubuntu12.04でOpenCVとOpenNI2のインストール</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-10 19:13:19</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ubuntu]</b> <b>[Build]</b> <b>[OpenCV]</b> <b>[OpenNI2]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h2>

<p>Ubuntu12.04でのOpenCVやOpenNIのインストールに関するドキュメントは、だいたいインストールまででビルドに関する情報が抜けている場合が多い。リマインダのためにインストールからサンプルのビルドまでの行程をまとめる。</p>

<h2>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h2>

<p>ビルドやパッケージ取得に必要なソフトをインストールする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo apt-get install -yV build-essential git cmake
</pre></div></div>

<h3>
<span id="opencvのインストール" class="fragment"></span><a href="#opencv%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>OpenCVのインストール</h3>

<p>opencvはapt-getでインストールできる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo apt-get install -yV libcv-dev libhighgui-dev libcvaux-dev python-opencv opencv-doc
</pre></div></div>

<h3>
<span id="openni2のインストール" class="fragment"></span><a href="#openni2%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>OpenNI2のインストール</h3>

<p>いろいろと調べたが、apt-getでのインストールは難がありそうなので、githubからソースを持ってきてビルドするのが素直だと思う。詳細は、githubのREADMEに書いてあり、以下はそのインストラクションの中のlinux版のインストラクションの抜粋・作業記録になる。</p>

<ul>
<li><a href="https://github.com/OpenNI/OpenNI2" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/OpenNI/OpenNI2</a></li>
</ul>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo apt-get install -yV g++ python libusb-1.0.0-dev libudev-dev openjdk-6-jdk freeglut3-dev doxygen graphviz 
$ git clone https://github.com/OpenNI/OpenNI2.git
$ cd OpenNI2
$ make
</pre></div></div>

<p>問題なく、ビルドが出来たら以下の手順でインストールをおこなう。i686、x86_64のどちらかかわからないので、unameで確認しておこう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ uname -a
Linux vagrant-ubuntu-precise-32 3.2.0-55-generic #85-Ubuntu SMP Wed Oct 2 13:43:27 UTC 2013 i686 i686 i386 GNU/Linux
</pre></div></div>

<p>例は、vagrantでインストールしたx86用(i686)の仮想環境なので、x86環境のパッケージを作成し、適当な場所にインストールする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ cd Packaging
$ python ./ReleaseVersion.py x86
$ cd OpenNI-Linux-x86-2.2
$ cp -a Include /usr/local/include/ni2
$ cp -a Redist /usr/local/lib/ni2
</pre></div></div>

<p>なお、ReleaseVersion.pyには、[x86|x64|arm|android]のオプションがあるので、プラットフォームによって変更しよう。OpenNI-Linux-x86-2.2のようなディレクトリが作成される（リリースのバージョンやアーキテクチャでディレクトリ名がかわるので注意すること）。</p>

<p>この例では、/usr/localのプレフィックスの下にni2というディレクトリ下にヘッダファイルとライブラリを配置する。なお、これはOS Xのhomebrewでインストールする場合と同じパスにしただけで、他に適当なパスを指定しても良い。</p>

<h2>
<span id="サンプルのビルド" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89"><i class="fa fa-link"></i></a>サンプルのビルド</h2>

<p>以下は、OpenNI2とOpenCVの両方を使ったコードのサンプルファイルだ。以下に添付しているファイルを引用のように同じディレクトリに配置し、cmakeでビルドする。</p>

<blockquote>
<p>.<br>
├── CMakeLists.txt<br>
└── main.cpp</p>
</blockquote>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ mkdir build
$ cd build
$ cmake ..
$ make
</pre></div></div>

<p>ビルドが成功すれば、問題なし。テスト環境で実施した場合は、-lopencv_gpuが見つからないというエラーがでた。libopencv_gpu.soのインストールされているパスは、/usr/libの下だ。lsで調べてみると</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ls /usr/lib/libopencv_gpu*
/usr/lib/libopencv_gpu.so.2.3  /usr/lib/libopencv_gpu.so.2.3.1
</pre></div></div>

<p>と/usr/lib/libopencv_gpuへのリンクがない。そのため、リンクを追加する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo ln -s /usr/lib/libopencv_gpu.so.2.3 /usr/lib/libopencv_gpu.so
</pre></div></div>

<p>もう一度ビルドすると成功した。以下、サンプルのソースファイルとcmakeの設定ファイルを添付する。</p>

<p>サンプルのソースファイルは、以下のサイトのソースを持ってきて、ubuntu用に修正したものだ。</p>

<ul>
<li><a href="http://www.naturalsoftware.jp/blog/8001" class="autolink" rel="nofollow noopener" target="_blank">http://www.naturalsoftware.jp/blog/8001</a></li>
</ul>

<div class="code-frame" data-lang="c++">
<div class="code-lang"><span class="bold">main.cpp</span></div>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;OpenNI.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">openni</span><span class="o">::</span><span class="n">OpenNI</span><span class="o">::</span><span class="n">initialize</span><span class="p">();</span>

        <span class="n">openni</span><span class="o">::</span><span class="n">Device</span> <span class="n">device</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">device</span><span class="p">.</span><span class="n">open</span><span class="p">(</span> <span class="n">openni</span><span class="o">::</span><span class="n">ANY_DEVICE</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">ret</span> <span class="o">!=</span> <span class="n">openni</span><span class="o">::</span><span class="n">STATUS_OK</span> <span class="p">)</span> <span class="p">{</span>
     <span class="err">　　　　</span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">openni</span><span class="o">::</span><span class="n">VideoStream</span> <span class="n">colorStream</span><span class="p">;</span>
        <span class="n">colorStream</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">openni</span><span class="o">::</span><span class="n">SENSOR_COLOR</span><span class="p">);</span>
        <span class="n">colorStream</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

        <span class="n">openni</span><span class="o">::</span><span class="n">Recorder</span> <span class="n">recorder</span><span class="p">;</span>
        <span class="n">recorder</span><span class="p">.</span><span class="n">create</span><span class="p">(</span> <span class="s">"kinect.oni"</span> <span class="p">);</span>
        <span class="n">recorder</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span> <span class="n">colorStream</span> <span class="p">);</span>
        <span class="n">recorder</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">openni</span><span class="o">::</span><span class="n">VideoStream</span><span class="o">*&gt;</span> <span class="n">streams</span><span class="p">;</span>
        <span class="n">streams</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">colorStream</span> <span class="p">);</span>

        <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">colorImage</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">changedIndex</span><span class="p">;</span>
            <span class="n">openni</span><span class="o">::</span><span class="n">OpenNI</span><span class="o">::</span><span class="n">waitForAnyStream</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">streams</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">changedIndex</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">changedIndex</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
                <span class="n">openni</span><span class="o">::</span><span class="n">VideoFrameRef</span> <span class="n">colorFrame</span><span class="p">;</span>
                <span class="n">colorStream</span><span class="p">.</span><span class="n">readFrame</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">colorFrame</span> <span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">colorFrame</span><span class="p">.</span><span class="n">isValid</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="n">colorImage</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(</span> <span class="n">colorStream</span><span class="p">.</span><span class="n">getVideoMode</span><span class="p">().</span><span class="n">getResolutionY</span><span class="p">(),</span> 
                        <span class="n">colorStream</span><span class="p">.</span><span class="n">getVideoMode</span><span class="p">().</span><span class="n">getResolutionX</span><span class="p">(),</span>
                        <span class="n">CV_8UC3</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">colorFrame</span><span class="p">.</span><span class="n">getData</span><span class="p">()</span> <span class="p">);</span>
                    <span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span> <span class="n">colorImage</span><span class="p">,</span> <span class="n">colorImage</span><span class="p">,</span> <span class="n">CV_BGR2RGB</span> <span class="p">);</span>

                    <span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span> <span class="s">"Color Camera"</span><span class="p">,</span> <span class="n">colorImage</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="kt">int</span> <span class="n">key</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span> <span class="mi">10</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">key</span> <span class="o">==</span> <span class="sc">'q'</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">openni</span><span class="o">::</span><span class="n">OpenNI</span><span class="o">::</span><span class="n">getExtendedError</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>cmakeの設定ファイルは、スクラッチで書いた。OpenNI2のパスの探し方は自己流なので、適宜変更してほしい。大抵はPathsにヘッダとライブラリがあるパスを追加すれば動く。今回は、上述のように/usr/local/lib/ni2にライブラリを、/usr/local/include/ni2にヘッダファイルがあるという前提で設定を編集した。</p>

<div class="code-frame" data-lang="cmake">
<div class="code-lang"><span class="bold">CMakeLists.txt</span></div>
<div class="highlight"><pre><span></span><span class="c"># -*- CMakeLists.txt -*-</span>

<span class="nb">cmake_minimum_required</span> <span class="p">(</span><span class="s">VERSION</span> <span class="s">2.8</span><span class="p">)</span>

 <span class="nb">if</span><span class="p">(</span><span class="s">COMMAND</span> <span class="s">cmake_policy</span><span class="p">)</span>
    <span class="nb">cmake_policy</span><span class="p">(</span><span class="s">SET</span> <span class="s">CMP0003</span> <span class="s">NEW</span><span class="p">)</span>
 <span class="nb">endif</span><span class="p">(</span><span class="s">COMMAND</span> <span class="s">cmake_policy</span><span class="p">)</span>

<span class="c"># プログラムの追加</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">view</span> <span class="s">main.cpp</span><span class="p">)</span>

<span class="c"># CFLAGSの追加</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CMAKE_CXX_FLAGS</span> <span class="s2">"-Wall -g -I${PROJECT_SRC_DIRECTORY}/include"</span><span class="p">)</span>

<span class="c"># LDFLAGSの追加</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CMAKE_EXE_LINKER_FLAGS</span> <span class="o">${</span><span class="nv">PLATFORM_LDFLAGS</span><span class="o">}</span><span class="p">)</span>

<span class="c"># ライブラリの追加</span>
<span class="nb">include_directories</span> <span class="p">(</span> <span class="s">/usr/local/include/ni2</span> <span class="p">)</span>
<span class="nb">link_directories</span> <span class="p">(</span> <span class="s">/usr/local/lib/ni2</span> <span class="p">)</span>
<span class="nb">find_package</span> <span class="p">(</span><span class="s">OpenCV</span> <span class="s">REQUIRED</span><span class="p">)</span>

<span class="nb">find_path</span><span class="p">(</span><span class="s">OpenNI2_INCLUDE_PATH</span> <span class="s">NAMES</span> <span class="s">OpenNI.h</span>
  <span class="s">PATH_SUFFIXES</span> <span class="s">ni2</span>
  <span class="s">PATHS</span>
    <span class="s">/usr/include</span>
    <span class="s">/usr/local/include</span><span class="p">)</span>

<span class="nb">find_library</span><span class="p">(</span><span class="s">OpenNI2_LIBRARY</span> <span class="s">NAMES</span> <span class="s">OpenNI2</span> <span class="s">libOpenNI2</span>
  <span class="s">PATHS</span>
    <span class="s">/usr/lib</span>
    <span class="s">/usr/local/lib</span>
    <span class="s">/usr/local/lib/ni2</span><span class="p">)</span>

<span class="nb">target_link_libraries</span> <span class="p">(</span><span class="s">view</span> <span class="o">${</span><span class="nv">OpenCV_LIBS</span><span class="o">}</span> <span class="o">${</span><span class="nv">OpenNI2_LIBRARY</span><span class="o">}</span> <span class="s">stdc++</span><span class="p">)</span>

<span class="c"># クリーン対象の追加</span>
<span class="nb">set_directory_properties</span> <span class="p">(</span>
  <span class="s">PROPERTIES</span>
  <span class="s">ADDITIONAL_MAKE_CLEAN_FILES</span>
  <span class="s2">"*~"</span>
  <span class="p">)</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />24位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/e1c7d17d55975728cbd0">FacebookでURLを貼付けたときにでてくるサブネイルをカスタマイズする方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-02 13:11:16</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Facebook]</b> <b>[OGP]</b> <b>[thumbnail]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>自分で作ったWebページのURLなどをfacebookのポストに貼り付けて共有しようとすると、その内容が自分の思ったとおりにいかないことがある。特に先に最小限の体裁を整えて公開し、後で微修正しようなどとすると修正前の情報のままで固定されて、困ったことになる。ここでは、作成されるサブネイルをこちらの意図通りにカスタマイズする方法を紹介する（リマインダ）</p>

<h1>
<span id="手順" class="fragment"></span><a href="#%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>手順</h1>

<p>カスタマイズの手順は以下の通り</p>

<ol>
<li>作成したページのヘッダにOGプロトコルに基づいて、カスタマイズしたい情報をメタタグとして入力する</li>
<li>サブネイルキャッシュの更新ページに更新したいページのURLを貼付け、デバッグボタンを押す

<ul>
<li><a href="https://developers.facebook.com/tools/debug/" class="autolink" rel="nofollow noopener" target="_blank">https://developers.facebook.com/tools/debug/</a></li>
</ul>
</li>
</ol>

<p>単純に情報を更新したい場合は、2.だけで十分だ。さらに、その内容を自分の意図通りに更新したい場合は手順1.と2.を実行する。</p>

<h1>
<span id="ogプロトコルの編集" class="fragment"></span><a href="#og%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E3%81%AE%E7%B7%A8%E9%9B%86"><i class="fa fa-link"></i></a>OGプロトコルの編集</h1>

<p>OG(Open Graph)プロトコルは、webページがソーシャルグラフと連携することを可能にする。OGPをWebページに含めることで、そのページはFacebookページと同等に扱わる。でも、有り体に言えば、サブネイル作るときの詳細指定できるよ・・ってのが一番わかりやすい（もちろん、他の効果もあるのだろうけども）。</p>

<p>Facebookだけでなく、google+、gree、mixiなどでも使われているので、それらのSNSで共有されることを考えているならば、設定していて損はないし、そんなに手間でもない。具体的には以下のメタ情報をヘッダに書いておくだけ。</p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    …
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">"og:title"</span> <span class="na">content</span><span class="o">=</span><span class="s">"記事のタイトル"</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">"og:type"</span> <span class="na">content</span><span class="o">=</span><span class="s">"article"</span> <span class="p">/&gt;</span> //トップページはwebsite、個別ページはarticle
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">"og:description"</span> <span class="na">content</span><span class="o">=</span><span class="s">"記事の説明"</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">"og:url"</span> <span class="na">content</span><span class="o">=</span><span class="s">"記事のURL"</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">"og:image"</span> <span class="na">content</span><span class="o">=</span><span class="s">"画像のURL"</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">"og:site_name"</span> <span class="na">content</span><span class="o">=</span><span class="s">"サイトのタイトル"</span> <span class="p">/&gt;</span>
    …
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</pre></div></div>

<p>上記を書いておくと、手順2.のデバッグボタンを押したときにその情報の確認画面が出てきて、意図通りの内容であるかを確認できる。</p>

<p>以下は入れておいた方が良いらしいが、ないからといってサブネイルが作られないということはない。</p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">"og:locale"</span> <span class="na">content</span><span class="o">=</span><span class="s">"言語"</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">"fb:app_id"</span> <span class="na">content</span><span class="o">=</span><span class="s">"facebookのアプリID"</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">property</span><span class="o">=</span><span class="s">“fb:admins”</span> <span class="na">content</span><span class="o">=</span><span class="s">“facebookのユーザーID”</span> <span class="p">/&gt;</span> //できればfb:app_idを利用
</pre></div></div>

<p>また、htmlのxmlnsも設定した方が良いらしいが、なくても大丈夫だった。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja" dir="ltr" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml"&gt;
</pre></div></div>

<h1>
<span id="おわりに" class="fragment"></span><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><i class="fa fa-link"></i></a>おわりに</h1>

<p>昨今のWebページなら、SNSで共有されないことの方が珍しい。ほとんどコピペで作れるOGPのメタ情報は忘れずに入れておきたい。<br>
</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />25位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/6ee6b618e0509e9055cc">sublimeでutf8以外の文字コードのファイルを編集する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-10 16:29:14</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[sublime]</b> <b>[sjis]</b> <b>[convertoutf8]</b> <b>[utf8]</b> <b>[euc]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ConvertToUTF8というパッケージが存在する。Sublime自体は、utf8の文字コードで動作するが、ファイルのコンテンツをutfに変換表示し、保存するときにそのファイルの文字コードで書き戻してくれるらしい。これは便利だ。</p>

<p>インストール手順は以下のとおり。</p>

<ul>
<li>Command+Ctrl+P</li>
<li>Install PackegeでPackage Controlを呼び出す</li>
<li>ConvertToUTF8を指定する</li>
</ul>

<p>以上。細かい設定をやったら、また書き込むことにする。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />26位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/79d7aa7b0a26cf111e12">macにおけるpythonのハンドリング</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-10 16:11:30</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[Mac]</b> <b>[pythonbrew]</b> <b>[virtualenv]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ずっとActivePythonにお世話になってきたけど、いろいろなマイクロプロジェクトが出来上がってきたので、より柔軟にpythonのバージョンやパッケージ管理がしたくなって、pythonbrewと、virtualenvを利用した環境に移行しました。<br>
ここではその覚書を書いて、リマインダとしておきます。なお、全部ターミナルで実行するので、guiでやりたい人は読んでも意味ありません。<br>
（なので、指摘は歓迎ですが、この通りにやったけど、うまくいかなかったと文句言われても困ります）</p>

<p>追記(2013/10/02)：<br>
pythonbrewは作者が開発を続けないことをアナウンスしているので、時代遅れになりつつある。とはいえ、後継で開発が続いているpythonzは思想が異なることと、macでの仕様では<br>
pythonbrewの方が使いやすいことから、この事実を知った後でも、pythonbrewにする価値はあるように思う。</p>

<h2>
<span id="0-これまでの環境とのお別れ" class="fragment"></span><a href="#0-%E3%81%93%E3%82%8C%E3%81%BE%E3%81%A7%E3%81%AE%E7%92%B0%E5%A2%83%E3%81%A8%E3%81%AE%E3%81%8A%E5%88%A5%E3%82%8C"><i class="fa fa-link"></i></a>0. これまでの環境とのお別れ</h2>

<p>これまでお世話になったActivePythonの弔いをします。</p>

<ul>
<li><a href="http://docs.activestate.com/activepython/2.6/installnotes.html#osxpkg_uninstall" class="autolink" rel="nofollow noopener" target="_blank">http://docs.activestate.com/activepython/2.6/installnotes.html#osxpkg_uninstall</a></li>
</ul>

<p>上記のページに基づいて、以下のコマンドを実行して、ActivePythonをアンインストールします。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo /Library/Frameworks/Python.framework/Versions/2.6/Resources/Scripts/uninstall
</pre></div></div>

<p>2.7の場合は、パスの真ん中くらいにある2.6の部分を2.7にすればOK.</p>

<ol>
<li>pythonbrewのインストール</li>
</ol>

<p>ここからは、以下のページを参考に進めました。</p>

<ul>
<li><a href="http://d.hatena.ne.jp/pasela/20110704/pythonbrew" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/pasela/20110704/pythonbrew</a></li>
</ul>

<p>サクサクっと入れます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ curl -kLO https://github.com/utahta/pythonbrew/raw/master/pythonbrew-install
$ chmod +x pythonbrew-install
</pre></div></div>

<p>./pythonbrew-installパスを通すために、以下の一行を~/.bashrcに加えます。<br>
csh, tcsh, zshの人はそれぞれのrcファイルに加えましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>source ~/.pythonbrew/etc/bashrc
</pre></div></div>

<p>そのまま進む場合は、~/.bashrcをリロードしましょう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ source ~/.bashrc
</pre></div></div>

<h2>
<span id="2-pythonbrewによるpythonのインストール" class="fragment"></span><a href="#2-pythonbrew%E3%81%AB%E3%82%88%E3%82%8Bpython%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>2. pythonbrewによるPythonのインストール</h2>

<p>ここでは、一つのpythonのバージョンしかインストールしませんが、pythonbrewによって、いろいろなバージョンのpythonのインストールと、アクティブなpythonのバージョンの切り替えができます。リンクページに載っているので興味ある人は参照してください。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pythonbrew install 2.7.2 --framework
$ pythonbrew switch 2.7.2
</pre></div></div>

<p>※macユーザの場合は、--frameworkのオプションを付けておいた方が良いと思われます（このオプションmacしかないはず）。つけてないと、バリデーションなどでひっかかってパッケージが使えなくなることがあります。<br>
※ビルド時にビルドが失敗することがある。原因を探っていくと、xcodeのライセンスAgreementをしていないことが原因だと言われているので、以下のコマンドで、xcodeのライセンスの承認をして上げる必要がある場合がある。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo xcodebuild -license
</pre></div></div>

<h2>
<span id="3-virtualenvの導入" class="fragment"></span><a href="#3-virtualenv%E3%81%AE%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>3. virtualenvの導入</h2>

<p>virtualenvはpythonを実行するときのパッケージ群などの環境を仮想的に用意することができるソフトです。</p>

<p>ピンと来ないかもしれませんが、pythonのバージョン管理や、パッケージの依存関係解決って割とラフにできているので、このパッケージのこのバージョンの組み合わせでは動くけど、他では動かないっていうことが時々あります。そのたびに、パッケージの再インストールをしていたのではたまらないので、ヘビーユーザにとっては必須なソフトです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pip install virtualenv
$ pip install virtualenvwrapper
</pre></div></div>

<h2>
<span id="4-実践編" class="fragment"></span><a href="#4-%E5%AE%9F%E8%B7%B5%E7%B7%A8"><i class="fa fa-link"></i></a>4. 実践編</h2>

<p>これで、終わりですが、最後に簡単なvirtualenvの使い方をば</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ virtualenv sandbox
$ cd sandbox
$ source bin/activate
(sandbox) $ pip install numpy
(sandbox) $ python
Python 2.7.2 (default, Sep 26 2013, 15:18:47) 
[GCC 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import numpy

(sandbox) $ deactivate
$ python
&gt;&gt;&gt; import numpy
Traceback (most recent call last):File "&lt;stdin&gt;", line 1, in &lt;module&gt;ImportError: No module named numpy
</pre></div></div>

<p>上記では、sandboxというディレクトリに仮想環境を構築しています。構築した仮想環境を使用するためには、仮想環境の中のbin/activateというファイルを(sourceで)読み込みます。読み込んだ後は(環境名)というプレフィックスがついた状態になります。この状態でインストールしたパッケージはその仮想環境ではインストールされますが、仮想環境中で使えるdeactivateというコマンドでもとに戻った環境においてはインストールされていません。</p>

<p>このように仮想環境を使い分けることでより柔軟なソフト開発が可能になります。pythonヘビーユーザさんは是非どうぞ。ソフトウェアのテスト時の依存関係チェックにも便利です。</p>

<p>とはいっても、大抵のヘビーユーザは使っていると思うので、遅れているのは私だけでしょうね・・</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>mountcedarさんの<br />27位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/mountcedar/items/023325772241097662da">ubuntuにおけるpythonzの運用</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-10 16:02:25</center>
	</td>
	<td style="width:200px;">
		@mountcedar<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/30240/profile-images/1473685461">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ubuntu]</b> <b>[virtualenv]</b> <b>[Pythonz]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><h2>1. はじめに</h2>

<p>macでは有効に作用したpythonbrewですが、ubuntuでは、pipなどがデフォルトでインストールされておらず、あまり役に立たないので、現在も開発中のpythonzをインストール手順をまとめる。ただ、こちらは下記のリンクの写しがほとんど</p>

<p>※pythonbrew本体の開発はほとんど止まっています。</p>

<h2>2. インストール </h2>

<p>まず、必要なパッケージをインストールする。</p>

<blockquote>
<p>sudo apt-get install build-essential python-dev curl<br>
sudo apt-get install libncurses-dev libreadline6-dev libbz2-dev liblzma-dev libsqlite3-dev libgbm-dev </p>
</blockquote>

<p>次に、pythonzのインストールを行う。</p>

<blockquote>
<p>curl -kL <a href="https://raw.github.com/saghul/pythonz/master/pythonz-install" class="autolink" rel="nofollow noopener" target="_blank">https://raw.github.com/saghul/pythonz/master/pythonz-install</a> | bash</p>
</blockquote>

<p>.bashrcに以下の一行を追加し、パスの設定を行う。</p>

<blockquote>
<p>[[ -s $HOME/.pythonz/etc/bashrc ]] &amp;&amp; source $HOME/.pythonz/etc/bashrc</p>
</blockquote>

<p>んで、pythonzでpythonのインストールをする。</p>

<blockquote>
<p>source ~/.bashrc<br>
pythonz install 2.7.3</p>
</blockquote>

<p>ここからが、pythonbrewとの違い、switchコマンドがないため、普通にパスの設定を行わなければならない。~/.bashrcに以下の一行を追加しよう。</p>

<blockquote>
<p>export PATH=$HOME/.pythonz/pythons/CPython-2.7.3/bin:$PATH<br>
source ~/.bashrc</p>
</blockquote>

<p>続いて、pipのインストール</p>

<blockquote>
<p>curl <a href="http://peak.telecommunity.com/dist/ez_setup.py" class="autolink" rel="nofollow noopener" target="_blank">http://peak.telecommunity.com/dist/ez_setup.py</a> | python<br>
easy_install pip</p>
</blockquote>

<p>最後に、virtualenvのインストール</p>

<blockquote>
<p>pip install virtualenv<br>
pip install virtualenvwrapper</p>
</blockquote>

<p>これで、pythonbrewとほぼ同等の使い方ができる。</p>

<h2>
<span id="3-実践編" class="fragment"></span><a href="#3-%E5%AE%9F%E8%B7%B5%E7%B7%A8"><i class="fa fa-link"></i></a>3. 実践編</h2>

<p>これで、終わりですが、最後に簡単なvirtualenvの使い方をば</p>

<blockquote>
<p>$ virtualenv sandbox<br>
$ cd sandbox<br>
$ source bin/activate<br>
(sandbox) $ pip install numpy<br>
(sandbox) $ python<br>
Python 2.7.2 (default, Sep 26 2013, 15:18:47) <br>
[GCC 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)] on darwin<br>
Type "help", "copyright", "credits" or "license" for more information.<br>
import numpy<br>
(sandbox) $ deactivate<br>
$ python<br>
import numpy<br>
Traceback (most recent call last):File "", line 1, in <br>
ImportError: No module named numpy</p>
</blockquote>

<p>上記では、sandboxというディレクトリに仮想環境を構築しています。構築した仮想環境を使用するためには、仮想環境の中のbin/activateというファイルを(sourceで)読み込みます。読み込んだ後は(環境名)というプレフィックスがついた状態になります。この状態でインストールしたパッケージはその仮想環境ではインストールされますが、仮想環境中で使えるdeactivateというコマンドでもとに戻った環境においてはインストールされていません。</p>

<p>このように仮想環境を使い分けることでより柔軟なソフト開発が可能になります。pythonヘビーユーザさんは是非どうぞ。ソフトウェアのテスト時の依存関係チェックにも便利です。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
