<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (horimislime)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (horimislime さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1092</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/32acf0f1be33a269a309">APIドキュメントを書くのが楽になるツールまとめ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-22 00:01:43</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Markdown]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>さいきんREST APIのドキュメントを書いていて、wiki使うのだるいし他に良い方法ないかな〜と調べてた時に見つけたツール群をまとめてみます。</p>

<p>追記: こちらも便利そうなので参考にどうぞ。<br>
<a href="http://qiita.com/horimislime/items/38327a3f4166b7b39eb5?utm_source=chrome-extention&amp;utm_medium=browser-extention&amp;utm_content=notifications" id="reference-d6c3809fe455d2e62b92">REST APIドキュメント作成ツールはapiary.ioが決定版かもしれない - Qiita</a></p>

<h2>
<span id="swagger" class="fragment"></span><a href="#swagger"><i class="fa fa-link"></i></a>swagger</h2>

<p><a href="https://developers.helloreverb.com/swagger/" rel="nofollow noopener" target="_blank">Swagger: A simple, open standard for describing REST APIs with JSON | Reverb for Developers</a><br>
デモ: <a href="http://swagger.wordnik.com/" rel="nofollow noopener" target="_blank">Swagger UI</a></p>

<p>ソースコード中にAPIの概要を書いておくと、それを元にドキュメントを自動生成してくれる。wikiやmarkdownで書くのと決定的な違いは、↓のようにドキュメント上のformからAPIコールを試すことができる点。</p>

<p><a href="https://camo.qiitausercontent.com/ff0c70743fc16236d7137c09001a4373f1514c1e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f61653238383665312d303636622d656233612d656530662d3763373438303437643236622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/ff0c70743fc16236d7137c09001a4373f1514c1e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f61653238383665312d303636622d656233612d656530662d3763373438303437643236622e706e67" alt="1387628508.png" title="1387628508.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/7325/ae2886e1-066b-eb3a-ee0f-7c748047d26b.png"></a></p>

<p>様々な言語のWAFに対応したライブラリも開発されてる。<br>
<a href="https://github.com/wordnik/swagger-core/wiki" rel="nofollow noopener" target="_blank">Home · wordnik/swagger-core Wiki</a></p>

<ul>
<li><a href="http://dev.classmethod.jp/server-side/scalatra-swagger01/" rel="nofollow noopener" target="_blank">Scalatra2.2+scalatra-swaggerでREST APIのリファレンスを生成する #1 ｜ Developers.IO</a></li>
<li><a href="http://dev.classmethod.jp/server-side/scalatra-swagger02/" rel="nofollow noopener" target="_blank">Scalatra2.2+scalatra-swaggerでREST APIのリファレンスを生成する #2 ｜ Developers.IO</a></li>
</ul>

<h2>
<span id="iodocs" class="fragment"></span><a href="#iodocs"><i class="fa fa-link"></i></a>iodocs</h2>

<p><a href="https://github.com/mashery/iodocs" rel="nofollow noopener" target="_blank">mashery/iodocs</a></p>

<p>node.jsで動作するドキュメントツール。API概要の定義はjsonで記述するようになっていて、こちらもswaggerと同様にページ上でAPIコールを試せるようになっている。iodocsに関しては最近postしたのでこちらもどうぞ。<br>
<a href="http://qiita.com/horimislime/items/ed13637c070b99dae959" id="reference-4cc94ceda95896ae77bc">iodocsで便利なREST APIドキュメントを作成する - Qiita [キータ]</a></p>

<p><a href="https://camo.qiitausercontent.com/0f4bdb9d9ee08b56f25c935c9c4fc0a23e2dc10b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f62353064346331642d313938632d333532392d653463322d3032643066333961373664332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0f4bdb9d9ee08b56f25c935c9c4fc0a23e2dc10b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f62353064346331642d313938632d333532392d653463322d3032643066333961373664332e706e67" alt="iodocs-screen.png" title="iodocs-screen.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/7325/b50d4c1d-198c-3529-e4c2-02d0f39a76d3.png"></a></p>

<h2>
<span id="autodoc" class="fragment"></span><a href="#autodoc"><i class="fa fa-link"></i></a>autodoc</h2>

<p><a href="https://github.com/r7kamura/autodoc" rel="nofollow noopener" target="_blank">r7kamura/autodoc</a></p>

<p>APIのテストケースからドキュメントを自動生成してくれる。Markdownで出力してくれるので、別途Webサーバを起動する必要とかも無し。</p>

<ul>
<li><a href="http://r7kamura.github.io/2013/12/01/autodoc.html" rel="nofollow noopener" target="_blank">Autodoc - r7kamura blog</a></li>
<li><a href="http://blog.inouetakuya.info/entry/2013/10/20/132928" rel="nofollow noopener" target="_blank">Rails でつくる API のドキュメントを自動生成してくれる autodoc がすごい - 彼女からは、おいちゃんと呼ばれています</a></li>
</ul>

<h2>
<span id="restdoclet" class="fragment"></span><a href="#restdoclet"><i class="fa fa-link"></i></a>RESTdoclet</h2>

<p><a href="http://ig-group.github.io/RESTdoclet/" rel="nofollow noopener" target="_blank">RESTdoclet by IG-Group</a></p>

<p>JavaでSpringMVCな環境で使うツール。Mavenプラグインとして提供されている。ドキュメント生成にはJavadocやSpringのRequestMapping等のアノテーションを利用するので、生成のために余計なアノテーション等をコードに書かなくていいのが特徴的。</p>

<ul>
<li><a href="http://www.infoq.com/jp/news/2012/08/RESTDocletOpenSource" rel="nofollow noopener" target="_blank">IG GroupがRESTdocletをオープンソース化</a></li>
</ul>

<h2>
<span id="carte" class="fragment"></span><a href="#carte"><i class="fa fa-link"></i></a>carte</h2>

<p><a href="https://github.com/devo-ps/carte" rel="nofollow noopener" target="_blank">devo-ps/carte</a><br>
デモ: <a href="http://devo.ps/carte/" rel="nofollow noopener" target="_blank">Carte</a></p>

<p>Markdownでドキュメント記述ができる。Jekyllベース。swaggerやiodocsと比較してシンプルな作りになっており、APIコールを試す機能は無い。</p>

<p><a href="https://camo.qiitausercontent.com/591bcfd87cf2d21fec8408b356cc16fecfa4e292/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f63366563613933322d646539662d363963612d376630372d3538363131383062363032332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/591bcfd87cf2d21fec8408b356cc16fecfa4e292/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f63366563613933322d646539662d363963612d376630372d3538363131383062363032332e706e67" alt="1387628935.png" title="1387628935.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/7325/c6eca932-de9f-69ca-7f07-5861180b6023.png"></a></p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<p>この手の自動生成や効率化はやり方が沢山ある分、各ツールそれぞれのアプローチが見えて面白いなーと思いました。まだまだ開発途中のものもあり、ちょっと試してて不便に感じる所もあったのですが今後に期待。</p>

<p>wikiやGithub READMEを使い続けるのもいいですが、こうした支援ツールも一度検討してみてはどうでしょうか。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>286</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/a9b9cf89e13cc9639ff2">知らないと損しそうなApache Commonsの機能集</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-07 13:56:09</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>「えっ、こんなのあったの？」的なマイナー機能の紹介ではなく、あくまでプログラミング中によく出くわす場面で使いたい基本的な機能のまとめです。主にUtils系メソッドの話。</p>

<p>※ここのサンプルは以下のライブラリ/バージョンを使ってます。</p>

<ul>
<li>commons-io 2.4</li>
<li>commons-lang 2.6 </li>
<li>commons-httpclient 3.1</li>
<li>commons-collections 3.2.1</li>
</ul>

<h1>
<span id="文字列の処理" class="fragment"></span><a href="#%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>文字列の処理</h1>

<p>nullを考慮しながらStringが空文字列かどうかチェックする。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">StringUtils</span></div>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">str</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"strは空文字列かnull."</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>

<p>これを使わずにstr==null || str.length()==0 みたいな条件式書くと見づらいし、nullチェック忘れてlength()を呼んで不具合が出ることも。</p>

<p>同様にListのサイズチェクでは<strong>CollectionUtils.isEmpty</strong>が使えて、これもよく活用する。</p>

<h2>
<span id="日付のパース" class="fragment"></span><a href="#%E6%97%A5%E4%BB%98%E3%81%AE%E3%83%91%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>日付のパース</h2>

<p>文字列の日付をDate型に変換する。また書式だけでなく日付自体が異常じゃないか(4/32みたいに)もチェックしてくれる。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">DateUtils</span></div>
<div class="highlight"><pre><span></span><span class="n">String</span><span class="o">[]</span> <span class="n">acceptFormats</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"yyyy-MM-dd"</span> <span class="o">};</span> <span class="c1">//書式は複数指定できる</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">Date</span> <span class="n">yesterday</span> <span class="o">=</span> <span class="n">DateUtils</span><span class="o">.</span><span class="na">parseDateStrictly</span><span class="o">(</span><span class="s">"2013-04-06"</span><span class="o">,</span> <span class="n">acceptFormats</span><span class="o">);</span>
    <span class="n">Date</span> <span class="n">invalid</span> <span class="o">=</span> <span class="n">DateUtils</span><span class="o">.</span><span class="na">parseDateStrictly</span><span class="o">(</span><span class="s">"2013-04-32"</span><span class="o">,</span> <span class="n">acceptFormats</span><span class="o">);</span><span class="c1">// Exception</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ParseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// エラー処理...</span>
<span class="o">}</span>
</pre></div>
</div>

<p>参考：<a href="http://qiita.com/items/832723eba10d2b52d9bf">日付が正しいかどうかをチェックする #Java - Qiita</a></p>

<h2>
<span id="ファイル名取得" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>ファイル名取得</h2>

<p>ファイルのフルパスから、拡張子を除いたファイル名のみを取得したいようなケース。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">FilenameUtils</span></div>
<div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="s">"/path/to/sample.txt"</span><span class="o">;</span>
<span class="n">FilenameUtils</span><span class="o">.</span><span class="na">getBaseName</span><span class="o">(</span><span class="n">filePath</span><span class="o">);</span> <span class="c1">// "sample"</span>
</pre></div>
</div>

<p>ファイルの拡張子が欲しければ、FilenameUtils.getExtension(filePath)が使える。</p>

<h2>
<span id="渡された文字列が数字かどうかを判定する" class="fragment"></span><a href="#%E6%B8%A1%E3%81%95%E3%82%8C%E3%81%9F%E6%96%87%E5%AD%97%E5%88%97%E3%81%8C%E6%95%B0%E5%AD%97%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E3%82%92%E5%88%A4%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>渡された文字列が数字かどうかを判定する</h2>

<p>Validationとか使わず手っ取り早くチェックしたいときに。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">NumberUtils</span></div>
<div class="highlight"><pre><span></span><span class="n">NumberUtils</span><span class="o">.</span><span class="na">isDigits</span><span class="o">(</span><span class="s">"12345"</span><span class="o">);</span> <span class="c1">// true</span>
<span class="n">NumberUtils</span><span class="o">.</span><span class="na">isDigits</span><span class="o">(</span><span class="s">"12ab45"</span><span class="o">);</span> <span class="c1">// false</span>
</pre></div>
</div>

<h1>
<span id="ファイル関連の処理" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E9%96%A2%E9%80%A3%E3%81%AE%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>ファイル関連の処理</h1>

<h2>
<span id="テキストファイルの中身をstringで取得する" class="fragment"></span><a href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%AD%E8%BA%AB%E3%82%92string%E3%81%A7%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>テキストファイルの中身をStringで取得する</h2>

<p>地道にやるとFileからBufferedReaderを生成して、一行づつreadLine…みたいにするところも、FileUtilsを使えばカンタンに。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">FileUtils</span></div>
<div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">FileUtils</span><span class="o">.</span><span class="na">readFileToString</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"src.txt"</span><span class="o">));</span>
</pre></div>
</div>

<p>逆に、Stringの文字列をファイルに書き出したいときはこんな感じ。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">FileUtils</span></div>
<div class="highlight"><pre><span></span><span class="n">FileUtils</span><span class="o">.</span><span class="na">writeStringToFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"out.txt"</span><span class="o">),</span> <span class="s">"書き込む内容"</span><span class="o">);</span>
</pre></div>
</div>

<h2>
<span id="ファイルのコピー" class="fragment"></span><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%82%B3%E3%83%94%E3%83%BC"><i class="fa fa-link"></i></a>ファイルのコピー</h2>

<p>ファイルからファイルへのコピーもFileUtilsで。</p>

<div class="code-frame" data-lang="FileUtils"><div class="highlight"><pre><span></span>File src = new File("src.txt");
FileUtils.copyFile(src, new File("dest.txt"));
</pre></div></div>

<h1>
<span id="http通信" class="fragment"></span><a href="#http%E9%80%9A%E4%BF%A1"><i class="fa fa-link"></i></a>HTTP通信</h1>

<p>HttpClientのHandlerを使うと、IOException等が発生すると成功するまでリクエストを再送してくれる。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">HttpClient</span></div>
<div class="highlight"><pre><span></span><span class="n">DefaultHttpMethodRetryHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultHttpMethodRetryHandler</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">retryMethod</span><span class="o">(</span><span class="n">HttpMethod</span> <span class="n">method</span><span class="o">,</span> <span class="n">IOException</span> <span class="n">exception</span><span class="o">,</span> <span class="kt">int</span> <span class="n">executionCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">boolean</span> <span class="n">tryAgain</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">retryMethod</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">exception</span><span class="o">,</span> <span class="n">executionCount</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">tryAgain</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">tryAgain</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">};</span>

<span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="o">();</span>
<span class="n">GetMethod</span> <span class="n">method</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GetMethod</span><span class="o">(</span><span class="s">"http://localhost:8080"</span><span class="o">);</span>

<span class="n">method</span><span class="o">.</span><span class="na">getParams</span><span class="o">().</span><span class="na">setParameter</span><span class="o">(</span><span class="n">HttpMethodParams</span><span class="o">.</span><span class="na">RETRY_HANDLER</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>

<span class="n">httpClient</span><span class="o">.</span><span class="na">executeMethod</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
</pre></div>
</div>

<p>この例だとリクエストが成功するまで最大10回まで再試行する。HandlerにThread.sleepを入れておけば、次の試行までの間隔も調整できる。</p>

<h1>
<span id="ストリーム処理" class="fragment"></span><a href="#%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%A0%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>ストリーム処理</h1>

<h2>
<span id="inputstreamからoutputstreamへの変換" class="fragment"></span><a href="#inputstream%E3%81%8B%E3%82%89outputstream%E3%81%B8%E3%81%AE%E5%A4%89%E6%8F%9B"><i class="fa fa-link"></i></a>InputStreamからOutputStreamへの変換</h2>

<p>IOUtilsを使うと、InputStreamからreadしてOutputStreamにwriteして・・・といった面倒な処理は必要ナシ。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">IOUtils</span></div>
<div class="highlight"><pre><span></span><span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"src.txt"</span><span class="o">);</span>
<span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="s">"dest.txt"</span><span class="o">);</span>
<span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">out</span><span class="o">);</span>
</pre></div>
</div>

<h2>
<span id="streamのクローズ" class="fragment"></span><a href="#stream%E3%81%AE%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%BA"><i class="fa fa-link"></i></a>Streamのクローズ</h2>

<p>finallyブロックでStreamをクローズしたい場合、IOExceptionをハンドリングするためにブロックが深くなったりする。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">見づらいStream処理</span></div>
<div class="highlight"><pre><span></span><span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"input.txt"</span><span class="o">);</span>
    <span class="c1">// 何かの処理…</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"close失敗"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>

<p>これもIOUtilsを使うと簡潔に書ける。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">IOUtils</span></div>
<div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">{</span>
    <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">"input.txt"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">IOUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>

<h1>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h1>

<h2>
<span id="乱数の取得" class="fragment"></span><a href="#%E4%B9%B1%E6%95%B0%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>乱数の取得</h2>

<p>一度Randomインスタンスを生成して、rand.nextInt・・・みたいな処理も1行で。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">RandomUtils</span></div>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">RandomUtils</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">10</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>
</div>

<h2>
<span id="クラス間でフィールドをコピーする" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%B9%E9%96%93%E3%81%A7%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%82%92%E3%82%B3%E3%83%94%E3%83%BC%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>クラス間でフィールドをコピーする</h2>

<p>異なるクラスのインスタンス間で、同じ名前・同じ型のフィールドをコピーしたいとき。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">地道にフィールドをコピーする</span></div>
<div class="highlight"><pre><span></span><span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">getItem</span><span class="o">();</span> <span class="c1">//Itemインスタンス取得</span>
<span class="n">DetailItem</span> <span class="n">detail</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DetailItem</span><span class="o">();</span> <span class="c1">//Itemに加えて幾つかフィールドが追加されたクラス</span>
<span class="n">detail</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
<span class="n">detail</span><span class="o">.</span><span class="na">setPrice</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
<span class="c1">//Itemのフィールド数だけ繰り返す…</span>
</pre></div>
</div>

<p>BeanUtilsなら一行にまとめる事ができる。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">BeanUtils</span></div>
<div class="highlight"><pre><span></span><span class="n">BeanUtils</span><span class="o">.</span><span class="na">copyProperties</span><span class="o">(</span><span class="n">detail</span><span class="o">,</span> <span class="n">item</span><span class="o">);</span>
</pre></div>
</div>

<h2>
<span id="見やすいtostringを生成する" class="fragment"></span><a href="#%E8%A6%8B%E3%82%84%E3%81%99%E3%81%84tostring%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>見やすいtoStringを生成する</h2>

<p>ToStringBuilderでフィールド一覧を人間の見やすいフォーマットで返せる。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">ToStringBuilder</span></div>
<div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ToStringBuilder</span><span class="o">.</span><span class="na">reflectionToString</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">ToStringStyle</span><span class="o">.</span><span class="na">DEFAULT_STYLE</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>

<p>title・priceフィールドがあるItemクラスだったら、こんな感じにprintできるよう整形してくれる。</p>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">インスタンスをprintした結果</span></div>
<div class="highlight"><pre><span></span>com.example.Item@1aa8c488[title=sample,price=100]
</pre></div>
</div>

<p>指定するToStringStyleを変えること、フィールド単位で見やすく改行を入れてくれたりもする。<br>
<a href="http://yamkazu.hatenablog.com/entry/20090823/1251016360" rel="nofollow noopener" target="_blank">ToStringBuilerを使って簡単にBeanの中身を表示 - Yamkazu's Blog</a></p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>commonsには他にもloggingとかCLIとか便利なものが沢山あるけど、ひとまず今回はプログラミングで遭遇する頻度が高そうな処理で、commonsを使えば超簡単に解決できるものだけをまとめてみた。他にもオススメの機能があれば教えてください。</p>

<h2>
<span id="参考リンク" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>参考リンク</h2>

<ul>
<li><a href="http://www.ne.jp/asahi/hishidama/home/tech/java/" rel="nofollow noopener" target="_blank">Javaメモ目次(Hishidama's Java Memo)</a></li>
<li><a href="http://d.hatena.ne.jp/daisuke-m/searchdiary?word=%2A%5Bcommons%5D" rel="nofollow noopener" target="_blank">[commons] - 都元ダイスケ IT-PRESS</a></li>
<li><a href="http://d.hatena.ne.jp/Climber/20060117/1137487461" rel="nofollow noopener" target="_blank">HttpClient でウェイト付きリトライを行う。 - 考え得る最高を常に行う</a></li>
<li><a href="http://qiita.com/items/0a9fea8a226095b64729">簡単にtoString()を実装する #Java - Qiita</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>120</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/ed13637c070b99dae959">iodocsで便利なREST APIドキュメントを作成する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-05 14:48:08</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Node.js]</b> <b>[api]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>wikiとかでドキュメントを書くのが面倒で、良いツールを探していたら<a href="https://github.com/mashery/iodocs" rel="nofollow noopener" target="_blank">iodocs</a>というnode製ツールを見つけた。</p>

<p>これを使うとドキュメント作成が楽になるだけじゃなく、 <strong>ドキュメント上のformからAPIリクエストを試せて便利っぽい。</strong> </p>

<p><a href="https://camo.qiitausercontent.com/0f4bdb9d9ee08b56f25c935c9c4fc0a23e2dc10b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f62353064346331642d313938632d333532392d653463322d3032643066333961373664332e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/0f4bdb9d9ee08b56f25c935c9c4fc0a23e2dc10b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f62353064346331642d313938632d333532392d653463322d3032643066333961373664332e706e67" alt="iodocs-screen.png" title="iodocs-screen.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/7325/b50d4c1d-198c-3529-e4c2-02d0f39a76d3.png"></a></p>

<p>普段APIドキュメントを見つつcurlとかでリクエスト送信して試してたのが、全てドキュメント上で完結して良さげ。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p><a href="https://github.com/mashery/iodocs" rel="nofollow noopener" target="_blank">mashery/iodocs</a>からcloneしてアプリを起動すると、FoursquareやLinkedin APIを叩くサンプルをすぐに試せる。redisが必要なのでserver起動を忘れずに。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>~/ $ git clone http://github.com/mashery/iodocs.git
~/iodocs $ npm install
~/iodocs $ redis-server &amp;
~/iodocs $ npm start
</pre></div></div>

<p>ドキュメントは <code>public/data/</code> 下にjson形式で書くようになっていて、新しくドキュメントを追加したい場合は以下のように記述する。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">my-api.json</span></div>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">"endpoints"</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"Public API"</span><span class="p">,</span>
            <span class="s2">"methods"</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"MethodName"</span><span class="o">:</span> <span class="s2">"ユーザ情報取得API"</span><span class="p">,</span>
                    <span class="s2">"Synopsis"</span><span class="o">:</span> <span class="s2">"会員の詳細情報が取れるよ"</span><span class="p">,</span>
                    <span class="s2">"HTTPMethod"</span><span class="o">:</span> <span class="s2">"GET"</span><span class="p">,</span>
                    <span class="s2">"URI"</span><span class="o">:</span> <span class="s2">"/user"</span><span class="p">,</span>
                    <span class="s2">"RequiresOAuth"</span><span class="o">:</span> <span class="s2">"N"</span><span class="p">,</span>
                    <span class="s2">"parameters"</span><span class="o">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">"Name"</span><span class="o">:</span> <span class="s2">"user_id"</span><span class="p">,</span>
                            <span class="s2">"Required"</span><span class="o">:</span> <span class="s2">"Y"</span><span class="p">,</span>
                            <span class="s2">"Default"</span><span class="o">:</span> <span class="s2">""</span><span class="p">,</span>
                            <span class="s2">"Type"</span><span class="o">:</span> <span class="s2">"string"</span><span class="p">,</span>
                            <span class="s2">"Description"</span><span class="o">:</span> <span class="s2">"会員IDです"</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"Private API"</span><span class="p">,</span>
            <span class="s2">"methods"</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"MethodName"</span><span class="o">:</span> <span class="s2">"ユーザ設定変更API"</span><span class="p">,</span>
                    <span class="s2">"Synopsis"</span><span class="o">:</span> <span class="s2">"ユーザの設定情報が見れるよ"</span><span class="p">,</span>
                    <span class="s2">"HTTPMethod"</span><span class="o">:</span> <span class="s2">"POST"</span><span class="p">,</span>
                    <span class="s2">"URI"</span><span class="o">:</span> <span class="s2">"/user/setting"</span><span class="p">,</span>
                    <span class="s2">"RequiresOAuth"</span><span class="o">:</span> <span class="s2">"Y"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>

<p>あとは <code>public/data/apiconfig.json</code> に作成したドキュメントのjsonファイル名と、formからリクエストを投げるAPIサーバの情報を書いておく。</p>

<div class="code-frame" data-lang="javascript">
<div class="code-lang"><span class="bold">apiconfig.jsonに追記</span></div>
<div class="highlight"><pre><span></span><span class="s2">"my-api"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"My API"</span><span class="p">,</span>
    <span class="s2">"protocol"</span><span class="o">:</span> <span class="s2">"http"</span><span class="p">,</span>
    <span class="s2">"baseURL"</span><span class="o">:</span> <span class="s2">"127.0.0.1"</span><span class="p">,</span>
    <span class="s2">"publicPath"</span><span class="o">:</span> <span class="s2">"/api/v1"</span><span class="p">,</span>
    <span class="s2">"auth"</span><span class="o">:</span> <span class="s2">"key"</span><span class="p">,</span>
    <span class="s2">"keyParam"</span><span class="o">:</span> <span class="s2">"api_key_var_name"</span><span class="p">,</span>
    <span class="s2">"headers"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"Accept"</span><span class="o">:</span> <span class="s2">"application/json"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>

<p>あとはnodeを立ち上げるだけ。APIリクエスト用のformもjsonの内容から自動生成してくれる。</p>

<p>ドキュメントを不慣れな記法で書きつつレイアウトやらfontサイズやら考えなくて済むし、APIコールを試す側の手間も省けて便利。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>117</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/84fa431460c8d39f37e6">git mergeでコンフリクトが発生するか前もって調べる方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-15 19:37:43</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Git]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>利用シーン少なそうですが、mergeを実行する前にコンフリクトが起こるかどうかチェックしたくて調べたのでメモ。</p>

<h1>
<span id="git-merge-no-commit" class="fragment"></span><a href="#git-merge-no-commit"><i class="fa fa-link"></i></a>git merge —no-commit</h1>

<p>topic-branchをmasterにマージしようとしてコンフリクトするケースを想定します。</p>

<p>まず試してみたのは--no-commitオプション。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">—no-commit付きでmerge</span></div>
<div class="highlight"><pre><span></span> <span class="o">(</span>master<span class="o">)</span> ✘ git merge topic-branch --no-commit
Auto-merging src/hello.py
CONFLICT <span class="o">(</span>content<span class="o">)</span>: Merge conflict in src/hello.py
Automatic merge failed<span class="p">;</span> fix conflicts and <span class="k">then</span> commit the result.
</pre></div>
</div>

<p>これを付けておくとマージ時に自動コミットがされなくなりますが、コンフリクトが起こる場合もローカルファイルにはマージが実行されてしまいます。</p>

<h1>
<span id="git-format-patch" class="fragment"></span><a href="#git-format-patch"><i class="fa fa-link"></i></a>git format-patch</h1>

<p>予めパッチを用意しておくと、マージを適用する前にコンフリクトするかどうかをチェックすることができるようです。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">バッチ作成</span></div>
<div class="highlight"><pre><span></span><span class="o">(</span>topic-branch<span class="o">)</span> ✘ git format-patch master  --stdout &gt; test.patch <span class="c1">#パッチ作成</span>
<span class="o">(</span>topic-branch<span class="o">)</span> ✘ git checkout - 
Switched to branch <span class="s1">'master'</span>
<span class="o">(</span>master<span class="o">)</span> ✘ git apply test.patch --check <span class="c1">#パッチが適用できるかチェック</span>
error: patch failed: src/hello.py:6
error: src/hello.py: patch does not apply
</pre></div>
</div>

<p>コンフリクトが起こる場合はエラーが発生するので未然に気づけるように。これならファイルに変更が加わってgit merge —abortする必要もなし。</p>

<p>毎回この手順を踏むのは面倒なのでコマンド一行でチェックできるようにします。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">直前のbranchを現在のbranchにマージできるかチェックする</span></div>
<div class="highlight"><pre><span></span>git format-patch <span class="sb">`</span>git rev-parse --abbrev-ref HEAD<span class="sb">`</span>..<span class="sb">`</span>git rev-parse --abbrev-ref @<span class="o">{</span>-1<span class="o">}</span><span class="sb">`</span> --stdout <span class="p">|</span> git apply --check
</pre></div>
</div>

<p>カレントブランチ(<code>git rev-parse --abbrev-ref HEAD</code>)と直前にcheckoutしていたbranch(<code>git rev-parse --abbrev-ref @{-1}</code>)間での差分を出力して、パッチが適用できるかチェックしています。</p>

<p>hookとかに入れておけば、マージ先ブランチをcheckoutするタイミングでコンフリクトが発生するかチェックできて便利そう。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>115</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/cc4897f8fbf8b8358fe5">Githubの特定ブランチにpushした時だけhookでjenkinsビルドする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-22 13:22:28</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[GitHub]</b> <b>[Jenkins]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>hookを使ってるとリポジトリへpushしてすぐにjenkinsをビルドできて便利だけど、どのブランチにpushしてもhook URLが呼ばれてちょっと不便。<br>
例えばdevelopブランチにpushされた時だけ、hookでdevelopのビルドジョブを実行する、みたいな事がやりたくて調べてみた。</p>

<h1>
<span id="やり方" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E6%96%B9"><i class="fa fa-link"></i></a>やり方</h1>

<p>自前のgitリポジトリだと.git/hooksで特定ブランチへのpush時だけhookする設定が書けるけど、Githubでは同じような事ができないので<br>
Jenkins側で受け取ったhookがどのブランチへのpushによるものかを判定してみる。手順は以下のとおり。</p>

<h2>
<span id="hook受取り用ジョブの作成" class="fragment"></span><a href="#hook%E5%8F%97%E5%8F%96%E3%82%8A%E7%94%A8%E3%82%B8%E3%83%A7%E3%83%96%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>hook受取り用ジョブの作成</h2>

<p>ビルドジョブとは別でGithubからhookを受け取る専用のジョブを用意しておく。</p>

<p>ジョブはパラメータ付きビルドにしておき、下のように <code>payload</code> という名前でパラメータを受け取れるようにする。デフォルト値は適当に。<br>
<a href="https://camo.qiitausercontent.com/46909e5b7a928263efbcd6b7bd7451b16b686faf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f64613730366431392d306565622d373534312d656339322d6133366632646133336364322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/46909e5b7a928263efbcd6b7bd7451b16b686faf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f64613730366431392d306565622d373534312d656339322d6133366632646133336364322e706e67" alt="スクリーンショット 2013-10-21 10.09.03.png" title="スクリーンショット 2013-10-21 10.09.03.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/7325/da706d19-0eeb-7541-ec92-a36f2da33cd2.png"></a></p>

<p>この<code>payload</code>を設定しておくと、Githubからジョブのhook URLが叩かれた際に送られてくるJSONが受け取れる。中身はこんな感じで、pushされたブランチ名やcommit IDなどが含まれている。</p>

<div class="code-frame" data-lang="json">
<div class="code-lang"><span class="bold">Githubから受け取るJSON</span></div>
<div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">"ref"</span><span class="p">:</span><span class="s2">"refs/heads/develop"</span><span class="p">,</span>
    <span class="nt">"after"</span><span class="p">:</span><span class="s2">"44c877612fe7187f6167ef01f465b96a5868e82b"</span><span class="p">,</span>
    <span class="nt">"before"</span><span class="p">:</span><span class="s2">"4acbee81fc4f2b0e2dc8cdf962294d8619ca18eb"</span><span class="p">,</span>
    <span class="nt">"created"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
    <span class="nt">"deleted"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
    <span class="nt">"forced"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
    <span class="nt">"compare"</span><span class="p">:</span><span class="s2">"https://github.com/organization-name/project-name/compare/4acbee81fc4f...44c877612fe7"</span><span class="p">,</span>
    <span class="nt">"commits"</span><span class="p">:[</span>
      <span class="p">{</span>
        <span class="nt">"id"</span><span class="p">:</span><span class="s2">"5dea536624b8b74599d2ef6efc612e37998bb3e0"</span><span class="p">,</span>
<span class="err">...</span>
</pre></div>
</div>

<p>詳細はこちらで。<a href="https://help.github.com/articles/post-receive-hooks" rel="nofollow noopener" target="_blank">Post-Receive Hooks · GitHub Help</a></p>

<p>これでhook受取りジョブ側でブランチの情報を得られるようになったので、次はこのJSONでビルドジョブを回すかどうかを判定する。</p>

<h2>
<span id="run-condition-pluginの導入" class="fragment"></span><a href="#run-condition-plugin%E3%81%AE%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a><a href="https://wiki.jenkins-ci.org/display/JENKINS/Run+Condition+Plugin" rel="nofollow noopener" target="_blank">Run Condition Plugin</a>の導入</h2>

<p>payloadで渡されたJSONの内容をチェックするためにこのプラグインを入れておく。</p>

<p>例えば受け取ったhookが<code>develop</code>ブランチへのpushによるものかどうか判定したければ、<code>ビルド手順の追加</code>→<code>Conditional step (single)</code>で以下のような設定を入れる。</p>

<p><a href="https://camo.qiitausercontent.com/22c3c89b661b5b9f1550cf1d259a2d3251fadc42/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f66303366303961332d613466612d633636642d653563642d6564306432303762373739342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/22c3c89b661b5b9f1550cf1d259a2d3251fadc42/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f66303366303961332d613466612d633636642d653563642d6564306432303762373739342e706e67" alt="スクリーンショット 2013-10-21 10.09.36.png" title="スクリーンショット 2013-10-21 10.09.36.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/7325/f03f09a3-a4fa-c66d-e5cd-ed0d207b7794.png"></a></p>

<p>この設定では<code>payload</code>の中身に"refs/heads/develop"の文字列が含まれるか正規表現で判定する。</p>

<p>次に<code>Builder</code>の<code>Trigger/call builds…</code>でビルドジョブ名を指定しておくと、正規表現でdevelopへのpushと判定した時のみビルドを走らせることができる。またdevelop以外へのpushによるhookを無視したければ、<code>高度な設定</code>から判定失敗時は何もしないように設定する。最終形は下のような感じ。</p>

<p><a href="https://camo.qiitausercontent.com/03238dae31d47166edb060ac3ca44259c04037d4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f34343536376166342d376232392d646537652d653838322d6537306630366239653532342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/03238dae31d47166edb060ac3ca44259c04037d4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f373332352f34343536376166342d376232392d646537652d653838322d6537306630366239653532342e706e67" alt="スクリーンショット 2013-10-21 10.10.14.png" title="スクリーンショット 2013-10-21 10.10.14.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/7325/44567af4-7b29-de7e-e882-e70f06b9e524.png"></a></p>

<p>これでdevelopへpushした際のhookを受け取った時のみビルドジョブが呼び出され、それ以外は何も起こらないようになる。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>100</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/46545bdbb9629c4d3860">serverspecでテスト駆動サーバ構築</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-12 16:19:34</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[TDD]</b> <b>[chef]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://d.hatena.ne.jp/inouetakuya/20130511/1368271417" rel="nofollow noopener" target="_blank">Chef と Puppet の勉強会というよりも、むしろ時代は serverspec だった #pfcasual - 彼女からは、おいちゃんと呼ばれています</a><br>
こちらの記事で<a href="http://serverspec.org/" rel="nofollow noopener" target="_blank">serverspec</a>を見て、テストファーストでサーバ構築できたら良さげだなーと思って使ってみました。</p>

<h2>
<span id="導入" class="fragment"></span><a href="#%E5%B0%8E%E5%85%A5"><i class="fa fa-link"></i></a>導入</h2>

<p>gemからserverspecインストール。serverspec-initでSSH経由でサーバをテストするようにホスト名を入力。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ gem install serverspec
$ serverspec-init                                                                                                
Select a backend type:

  1) SSH
  2) Exec (local)
  3) Puppet providers (local)

Select number: 1

Input target host name: test-server1
 + spec/
 + spec/test-server1/
...
</pre></div></div>

<p>test-server1にはvagrantで作ったまっさらなVMを使ってみます。</p>

<h2>
<span id="テスト" class="fragment"></span><a href="#%E3%83%86%E3%82%B9%E3%83%88"><i class="fa fa-link"></i></a>テスト</h2>

<p>spec/下に指定したホスト名でディレクトリができてるので、試しに以下のようなテストを用意。apacheとtomcat(+管理ツール)がインストール済みかつ起動状態かどうか確認します。</p>

<div class="code-frame" data-lang="conf">
<div class="code-lang"><span class="bold">example_spec.rb</span></div>
<div class="highlight"><pre><span></span>require 'spec_helper'

#==========
# Apache
#==========
describe 'apache2' do
  it { should be_installed }
  it { should be_enabled   }
  it { should be_running   }
end
describe 'port 80' do
  it { should be_listening }
end

#==========
# Tomcat7
#==========
describe 'tomcat7' do
  it { should be_installed }
  it { should be_enabled }
  it { should be_running }

  # admin
  describe 'tomcat7-admin' do
    it { should be_installed }

    # 設定ファイルのチェック
    describe '/etc/tomcat7/tomcat-users.xml' do
      it { should contain '&lt;role rolename="manager-gui"/&gt;' }
      it { should contain '&lt;user username="tomcat" password="tomcat" roles="manager-gui"/&gt;' }
    end
  end
end 
describe 'port 8080' do
  it { should be_listening }
end
</pre></div>
</div>

<p>test-server1にテストを実行。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rake spec
...........FFFFFFFFFFF

Failures:

  1) apache2
     Failure/Error: it { should be_installed }
       sudo dpkg -s apache2
       Package `apache2' is not installed and no info is available.
       Use dpkg --info (= dpkg-deb --info) to examine archive files,
       and dpkg --contents (= dpkg-deb --contents) to list their contents.
...
...

</pre></div></div>

<p>まだ何もセットアップしてない状態なのでエラー。chef-soloなり手動なりでセットアップして再テスト。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ rake spec
...........

Finished in 0.47476 seconds
11 examples, 0 failures
$ 
</pre></div></div>

<p>今度はOK。更にもう一台test-server2をVMで作成して、test-server1と同様にテストしてみます。</p>

<p>test-server2には同じテストを実施したいので、spec/下にtest-server1へのsymlinkを作成。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ln -s test-server1 spec/test-server2
$ tree spec/                                                                                                         
spec/
├── spec_helper.rb
├── test-server1
│   └── example_spec.rb
└── test-server2 -&gt; test-server1
</pre></div></div>

<p>雑な感じだけど、ひとまず動けばいいという事で・・。これで2台目のマシンにもテストが走るようになるので、あとはテストが通るまで繰り返せばOK。テスト駆動がサーバ構築でも行えていい感じ！</p>

<p><a href="http://serverspec.org/matchers.html" rel="nofollow noopener" target="_blank">他にもテストのmatcherが色々用意されているので</a>、これから試していきたいなーと思います。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>63</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/e3dbb6d6a3dadc498393">シェルスクリプトの実行・管理が楽になるRerunの紹介</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-15 15:29:34</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> <b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>普段使っているシェルスクリプトの数が増えてきて、うまく管理できるツール無いかなーと思っていたところに<a href="http://rerun.github.io/rerun/" rel="nofollow noopener" target="_blank">Rerun</a>というのを見つけたので紹介してみます。</p>

<h1>
<span id="rerunって" class="fragment"></span><a href="#rerun%E3%81%A3%E3%81%A6"><i class="fa fa-link"></i></a>Rerunって？</h1>

<p><a href="http://rerun.github.io/rerun/" rel="nofollow noopener" target="_blank">Rerun by rerun</a></p>

<blockquote>
<p>Rerun is a simple command runner that turns loose shell scripts into modular automation.</p>
</blockquote>

<p>rerunは複数のスクリプトを<strong>モジュール</strong>として取りまとめ、スクリプトの管理と呼び出しをサポートしてくれるツールです。</p>

<p>実際に導入しながらどんなものか見ていきます。</p>

<h1>
<span id="インストール" class="fragment"></span><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>インストール</h1>

<p><a href="https://github.com/rerun/rerun/wiki/Installation" rel="nofollow noopener" target="_blank">Installation · rerun/rerun Wiki</a> を参考に。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone git://github.com/rerun/rerun.git
$ cd rerun
</pre></div></div>

<h1>
<span id="モジュールコマンド作成" class="fragment"></span><a href="#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E4%BD%9C%E6%88%90"><i class="fa fa-link"></i></a>モジュール・コマンド作成</h1>

<p>まずはモジュールを作ってみます。rerunにはstubbsというモジュール作成の為のモジュールが入っているので、これを使います。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ./rerun stubbs:add-module --description "sample local module" --module "local"
$ ./rerun
Available modules in "/Users/horimislime/Desktop/software/rerun/modules":
  local: "sample local module" - 1.0.0
  stubbs: "Simple rerun module builder" - 1.0.2
</pre></div></div>

<p>試しにstubbsのadd-moduleコマンドで、ローカル作業に関するスクリプトをひとまとめにする"local"モジュールを作成しました。rerunを引数なしで実行すると、使用できるモジュール一覧が確認できます。</p>

<p>次にモジュールへ<strong>コマンド</strong>を追加してみます。コマンドとはモジュール内で管理するシェルスクリプトとそのメタデータをひとまとめにしたモノで、さっきと同じくstubbsで作成します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ./rerun stubbs:add-command --module local --command hello --description "Hello world comamnd"
$ ./rerun local 
Available commands in module, "/Users/horimislime/Desktop/software/rerun/modules/local":
hello: "Hello world comamnd"
</pre></div></div>

<p>これでrerunディレクトリ下に modules/local/commands/hello/ が作成されます。helloディレクトリ下には実行するスクリプトのひな形である<strong>script</strong>と、作成時に指定したdescription等の情報が入った　<strong>metadata</strong>ファイルが出来上がっています。</p>

<p>scriptにはひな形で色々書かれていますが、ひとまず無視して最下部の方に処理を追加します。</p>

<div class="code-frame" data-lang="sh">
<div class="code-lang"><span class="bold">script</span></div>
<div class="highlight"><pre><span></span><span class="c1"># Command implementation</span>
<span class="c1"># ----------------------</span>

<span class="c1"># - - -</span>
<span class="c1"># Put the command implementation here.</span>
<span class="c1"># - - -</span>

<span class="nb">echo</span> <span class="s1">'Hello rerun command!'</span>

<span class="c1"># Done. Exit with last command exit status.</span>
<span class="nb">exit</span> <span class="nv">$?</span>
</pre></div>
</div>

<h1>
<span id="実行" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>実行</h1>

<p>作成したスクリプトを呼び出してみます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ ./rerun local:hello
Hello rerun command!
</pre></div></div>

<p>こんな感じです。扱っているスクリプトが増えれば増えるほど、rerunのモジュールを使ったグループ化が役に立ちそうです。あとモジュールやコマンド毎に概要やバージョン番号のメタデータを付けられるのもいいですね。仮に作ったコマンドを忘れてしまっても、 rerun [モジュール名] でコマンド一覧といっしょにその概要も見ることができます。</p>

<p>以上がrerunの基本的な機能ですが、他にも<a href="https://github.com/rerun/rerun/blob/master/README.md#command-execution" rel="nofollow noopener" target="_blank">モジュールをアーカイブ化</a>して配布可能にできたり、まだまだ便利な使い方がありそうです。 <a href="https://github.com/rerun-modules" rel="nofollow noopener" target="_blank">rerun-modules</a> にはモジュールがいくつか公開されているので、コマンドの拡張方法とかはこっちを参考にすると良さそうです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>58</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/387fa7805d1552149edb">SpringMVCでリダイレクト先ページにパラメータを渡す方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-09-08 14:18:34</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[spring]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>コントローラのハンドラからハンドラにリダイレクトする際、パラメータを渡してリダイレクト先のJSP等に表示する方法。</p>

<h2>
<span id="modelを使う" class="fragment"></span><a href="#model%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>Modelを使う</h2>

<p>以下コントローラのサンプル。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="c1">//ここにアクセスすると...</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/from"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">from</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//メッセージhogehogeを渡す</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"hogehoge"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"redirect:/to"</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">//こっちにリダイレクトする</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/to"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">to</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"message"</span><span class="o">)</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 受け取ったmessageをJSPなどに表示する</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"view_massage"</span><span class="o">;</span>
<span class="o">}</span>   
</pre></div></div>

<div class="code-frame" data-lang="html">
<div class="code-lang"><span class="bold">view_message.jsp</span></div>
<div class="highlight"><pre><span></span><span class="c">&lt;!-- /to ハンドラが表示するJSP --&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="c">&lt;!--hogehogeが表示される--&gt;</span>
    Message=${message}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</pre></div>
</div>

<p>Model#addAttributeでセットした値は、[URL]/to?message=hogehoge といったように、リダイレクト先URLのGETパラメータに入ってしまうのでちょっときもち悪い。もし日本語などを渡したいときはURLEncodeも意識しないといけないので面倒。</p>

<h2>
<span id="redirectattributesを使う" class="fragment"></span><a href="#redirectattributes%E3%82%92%E4%BD%BF%E3%81%86"><i class="fa fa-link"></i></a>RedirectAttributesを使う</h2>

<p>Spring3.1以降ではRedirectAttributesを使ってよりシンプルに書くことができる。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="c1">//ここにアクセスすると...</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/from"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">from</span><span class="o">(</span><span class="n">RedirectAttributes</span> <span class="n">attributes</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//メッセージhogehogeを渡す</span>
    <span class="n">attributes</span><span class="o">.</span><span class="na">addFlashAttribute</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span><span class="s">"hogehoge"</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"redirect:/to"</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">//こっちにリダイレクトする</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/to"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">to</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"view_massage"</span><span class="o">;</span>
<span class="o">}</span>   
</pre></div></div>

<p>3.1ではFlash Scopeというものが導入されていて、RedirectAttributesではそこにデータを格納してリダイレクトするかたち。日本語もencode/decode無しに送れるし、リダイレクト先コントローラでModelに値をセットする作業もいらなくて楽。</p>

<p>※Bean設定に &lt;mvc:annotation-diven /&gt; を書かないとこの機能が有効化されないので注意</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>47</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/325848fcf1e3dc6bd53a">ブラウザにファイルを強制ダウンロードさせるContent-Type</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-30 10:24:45</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[HTTP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ブラウザでリンクを開くと自動的にファイルダウンロードを開始させる方法。レスポンスヘッダのContent-Typeに<strong>application/force-download</strong>を指定しておくと、ファイル形式に関係なくダウンロードを開始させられる。</p>

<p>例えば、 http://[ドメイン]/downloadpdf にアクセスが来るとPDFファイルをダウンロードさせたい時のコード。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">PDFファイルを返すController</span></div>
<div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/downloadpdf"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">downloadPdf</span><span class="o">(</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

     <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/pdf"</span><span class="o">);</span>

     <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span>
          <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"/Users/horimislime/Desktop/sample.pdf"</span><span class="o">));</span>
     <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>

     <span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">out</span><span class="o">);</span> <span class="c1">//PDFファイルをレスポンスで返す</span>
<span class="o">}</span>
</pre></div>
</div>

<p>ChromeなどPDFのインライン表示をサポートしているブラウザでは、/downloadpdfを開くとファイルをダウンロードせずブラウザ上に表示してしまう。以下のようにContent-Typeを指定するとダウンロードを強制させられる。</p>

<div class="code-frame" data-lang="java">
<div class="code-lang"><span class="bold">　</span></div>
<div class="highlight"><pre><span></span><span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/force-download"</span><span class="o">);</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>28</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/832723eba10d2b52d9bf">日付が正しいかどうかをチェックする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-09-08 10:18:28</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>文字列で渡された日付が、"2012/09/32"といったように不正な値かどうかを確認する方法。</p>

<h2>
<span id="simpledateformat" class="fragment"></span><a href="#simpledateformat"><i class="fa fa-link"></i></a>SimpleDateFormat</h2>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">DateFormat</span> <span class="n">format</span><span class="o">=</span><span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd"</span><span class="o">);</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="n">format</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2012-09-01"</span><span class="o">);</span><span class="c1">//成功</span>
    <span class="n">format</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2012-09-32"</span><span class="o">);</span><span class="c1">//成功</span>

    <span class="n">format</span><span class="o">.</span><span class="na">setLenient</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">format</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2012-09-32"</span><span class="o">);</span><span class="c1">//Exception</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ParseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//失敗時の処理…</span>
<span class="o">}</span>
</pre></div></div>

<p>SimpleDateFormatはデフォルトでは書式フォーマットのみをチェックするので、32日のような不正値で例外が投げられない。<br>
不正な日付をチェックしたい場合は、setLenientでfalseをセットする。</p>

<h2>
<span id="commons-dateutils" class="fragment"></span><a href="#commons-dateutils"><i class="fa fa-link"></i></a>Commons DateUtils</h2>

<p>commons-langに含まれているDateUtilsを使う場合は以下のように。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">{</span>
    <span class="n">DateUtils</span><span class="o">.</span><span class="na">parseDateStrictly</span><span class="o">(</span><span class="s">"2012-09-01"</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"yyyy-MM-dd"</span><span class="o">});</span>
    <span class="n">DateUtils</span><span class="o">.</span><span class="na">parseDateStrictly</span><span class="o">(</span><span class="s">"2012-09-32"</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"yyyy-MM-dd"</span><span class="o">});</span><span class="c1">//Exception</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ParseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// エラー処理...</span>
<span class="o">}</span>
</pre></div></div>

<p>これも内部的にはSimpleDateFormatを使った実装。こちらは書式フォーマットをString配列で複数指定できるようになっている。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>24</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/28b652971170d5ca6dfc">実行中のスクリプトが完了したらiPhoneにPush通知する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-19 09:07:03</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[iPhone]</b> <b>[Zsh]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>処理がなかなか終わらないスクリプトを放置しといて、出先で完了したら通知を受け取れないかな〜と思ったらすごく簡単だったのでメモ。<br>
参考：<a href="http://conditional.github.io/blog/2013/03/14/take-a-nap-with-prowl/" rel="nofollow noopener" target="_blank">Prowl+zshで快適お昼寝タイム - a lonely miner</a></p>

<p>コマンド実行が完了したらiPhoneにインストールした<a href="http://im.kayac.com/" rel="nofollow noopener" target="_blank">im.kayac</a>へcurlで通知を投げてみます。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">スクリプトが実行完了したらim.kayacで通知</span></div>
<div class="highlight"><pre><span></span>$ sh long_proc.sh <span class="o">&amp;&amp;</span> curl -d <span class="s2">"message=おわったよ"</span> http://im.kayac.com/api/post/<span class="o">[</span>user_name<span class="o">]</span>
</pre></div>
</div>

<p>スクリプトの後に&amp;&amp;で通知処理を繋げるだけ。</p>

<p>さらにスクリプトの標準出力内容も通知してみる。もうちょいキレイに書く方法ないかな。。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">実行結果を通知</span></div>
<div class="highlight"><pre><span></span>$ <span class="nv">result</span><span class="o">=</span><span class="k">$(</span>sh long_proc.sh<span class="k">)</span> <span class="o">&amp;&amp;</span> curl -d <span class="s2">"message=</span><span class="nv">$result</span><span class="s2">"</span> http://im.kayac.com/api/post/<span class="o">[</span>user_name<span class="o">]</span>
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>19</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/c1bb272942fe99221e24">ブラウザで保存したファイルをダウンロード元サイト別にフォルダ分け</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-19 15:51:55</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Python]</b> <b>[MacOSX]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ブラウザのファイル保存先は一つしか選べませんが、pixivから保存した画像は2次元フォルダ、DMMから保存したものは3次元フォルダに分けたい！！みたいなニーズがあったので手法をメモしておきます。</p>

<h1>
<span id="準備" class="fragment"></span><a href="#%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>準備</h1>

<p>pipかeasy_installでxattrをインストール。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>pip install xattr
</pre></div></div>

<p>Automator.appを起動してフォルダアクションを新規作成します。ライブラリから<strong>シェルスクリプトを実行</strong>を追加して、実行するスクリプトに下の内容を貼り付けます。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">find_by_xattr.py</span></div>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">xattr</span>
<span class="n">watchdir</span><span class="o">=</span><span class="s1">'/Users/horimislime/Desktop/'</span>
<span class="c1">#search files downloaded from pixiv</span>
<span class="n">domain</span><span class="o">=</span><span class="s1">'www.pixiv.net'</span>

<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">watchdir</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fullpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">watchdir</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xattr</span><span class="o">.</span><span class="n">getxattr</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span><span class="s1">'com.apple.metadata:kMDItemWhereFroms'</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">fullpath</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>

<p>このスクリプトだとpixivからDesktop上にダウンロードしてきたファイルを振り分けます。</p>

<p>次に<strong>Finder項目を移動</strong>を追加して、ファイルの振り分け先ディレクトリを選択。完成形はこんな感じです。</p>

<p><a href="https://camo.qiitausercontent.com/83afcffb8f7122769147565b551819c5ab777da4/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f313632333135382f696d6167652f71696974612f6175746f6d61746f722d74696479322e6a7067" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/83afcffb8f7122769147565b551819c5ab777da4/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f313632333135382f696d6167652f71696974612f6175746f6d61746f722d74696479322e6a7067" alt="automator" data-canonical-src="https://dl.dropboxusercontent.com/u/1623158/image/qiita/automator-tidy2.jpg"></a></p>

<h1>
<span id="実行" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>実行</h1>

<p>最後に適当な名前でフォルダアクションを保存しておわり。pixivから画像を保存したら指定したディレクトリに移動しているはず。</p>

<h1>
<span id="仕組み" class="fragment"></span><a href="#%E4%BB%95%E7%B5%84%E3%81%BF"><i class="fa fa-link"></i></a>仕組み</h1>

<p>MacではExtended Attributesというファイルの拡張情報があり、xattrを使うとここに含まれているファイルのダウンロード元ドメイン等を読み込むことができます。　</p>

<p><a href="https://camo.qiitausercontent.com/c96fc19eaaa7ba028315757248f11d565decc06a/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f313632333135382f696d6167652f71696974612f78617474722d636d642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/c96fc19eaaa7ba028315757248f11d565decc06a/68747470733a2f2f646c2e64726f70626f7875736572636f6e74656e742e636f6d2f752f313632333135382f696d6167652f71696974612f78617474722d636d642e706e67" alt="xattrコマンド" data-canonical-src="https://dl.dropboxusercontent.com/u/1623158/image/qiita/xattr-cmd.png"></a></p>

<p>これでデスクトップがアレなファイルで埋め尽くされなくなりました。Automator便利！</p>

<p>Firefoxユーザは拡張機能で同じ事ができるらしい？<br>
<a href="https://addons.mozilla.org/ja/firefox/addon/automatic-save-folder/" rel="nofollow noopener" target="_blank">Automatic Save Folder :: Add-ons for Firefox</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/0771b4c0b7efbdd92b50">SSH公開鍵をさくっとサーバへコピー</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-01-24 11:37:37</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>cat ~/.ssh/id_rsa.pub <span class="p">|</span> ssh myname@remotehost <span class="s2">"cat &gt;&gt; ~/.ssh/authorized_keys"</span>
</pre></div></div>

<p>ローカルからコマンド一発</p>

<p>※追記：ssh-copy-idというコマンドで同じ事が出来るようです。Macだとbrew install ssh-copy-idとかで導入可。<br>
okkezさんコメントありがとうございます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/589f261cac65e21c853d">ファイルの形式を判定する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2012-11-29 00:44:37</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://sourceforge.net/projects/mime-util/" rel="nofollow noopener" target="_blank">mime-util</a>というライブラリを利用すると、拡張子等に関わらずファイルヘッダからMIMEタイプを判定してくれる。以下利用例。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">MimeUtil</span><span class="o">.</span><span class="na">registerMimeDetector</span><span class="o">(</span>
    <span class="s">"eu.medsea.mimeutil.detector.MagicMimeMimeDetector"</span><span class="o">);</span>

<span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"/Users/horimislime/Desktop/image.jpeg"</span><span class="o">);</span>  <span class="c1">//ホントはpng</span>
<span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">mimeTypes</span> <span class="o">=</span> <span class="n">MimeUtil</span><span class="o">.</span><span class="na">getMimeTypes</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</pre></div></div>

<p>mimeTypesには"image/png"が入る。1行目で指定しているクラスはMIMEタイプの判定器で、ここではファイルヘッダから形式を判定してくれるMagicMimeMimeDetectorを選択。他にも拡張子を元に判定を行うExtensionMimeDetector等いろいろあるけど、ここでは省略。</p>

<p>ローカルファイルだけでなく、Web上のファイルURLも直接指定できる。</p>

<div class="code-frame" data-lang="java"><div class="highlight"><pre><span></span><span class="n">URL</span> <span class="n">myPicture</span> <span class="o">=</span> 
    <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">"https://si0.twimg.com/profile_images/2519939119/bk1_normal.png"</span><span class="o">);</span>

<span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">mimeTypes</span> <span class="o">=</span> <span class="n">MimeUtil</span><span class="o">.</span><span class="na">getMimeTypes</span><span class="o">(</span><span class="n">myPicture</span><span class="o">);</span> <span class="c1">// image/png</span>
</pre></div></div>

<p>FileやURL以外にも、InputStreamやbyte配列も引数に渡せて使いやすい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/e74da198a144e1d8e9b5">pvmで複数バージョンのplay環境を構築</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-04 09:05:35</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PlayFramework]</b> <b>[Play2]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>playでもrbenvみたいなノリでバージョン管理をやってみた。</p>

<p>※<a href="http://www.csm.ornl.gov/pvm/" rel="nofollow noopener" target="_blank">Parallel Virtual Machine</a>ではなく<a href="https://github.com/kaiinkinen/pvm" rel="nofollow noopener" target="_blank">Play Version Manager</a>です</p>

<h3>
<span id="セットアップ" class="fragment"></span><a href="#%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97"><i class="fa fa-link"></i></a>セットアップ</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ git clone git://github.com/kaiinkinen/pvm.git ~/bin/pvm
$ echo '. ~/bin/pvm/pvm.sh' &gt;&gt; ~/.bashrc
</pre></div></div>

<p>rbenvみたくxcodeも必要無いので、git cloneしてきただけで準備完了。</p>

<p><a href="https://github.com/kaiinkinen/pvm#problems" rel="nofollow noopener" target="_blank">本家</a>の情報だと、pvmをドットで始まるディレクトリ(<strong>~/.pvm</strong>とか)に格納するとplay1.2.x系の実行時に問題が起こるらしいので~/bin下に入れてみた。pvmで入れた2.1.0環境ではざっと確認した限りは問題ないみたい</p>

<h3>
<span id="playをインストール" class="fragment"></span><a href="#play%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>playをインストール</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ pvm install 2.1.0
$ pvm use 2.1.0
</pre></div></div>

<p>これでplayの実行環境出来上がり。他のバージョンにしたければ同様にinstall+useで切り替え。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/3abd247b21458faf1c48">zshの履歴でコマンド実行時刻を見れるようにする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-02-24 21:02:31</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Zsh]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>historyコマンドで-dを指定するとコマンドを実行した時刻が表示できる。年月日も見たい場合は-f。</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>$ <span class="nb">history</span> -d
...
 <span class="m">8464</span>  <span class="m">18</span>:17  emacs .zshrc
 <span class="m">8465</span>  <span class="m">18</span>:19  less .zsh_history
</pre></div></div>

<p>　<br>
このままだと現在のセッションで実行したコマンドの時刻しか見れないので、.zsh_historyに実行時刻を記録するよう設定を追加する。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">.zshrc</span></div>
<div class="highlight"><pre><span></span>setopt extended_history <span class="c1">#share_historyでもOK</span>
</pre></div>
</div>

<p>　<br>
この設定を加えると、.zsh_historyに実行コマンドと合わせてタイムスタンプが記録されるようになる。</p>

<div class="code-frame" data-lang="sh">
<div class="code-lang"><span class="bold">.zsh_history</span></div>
<div class="highlight"><pre><span></span>$ tail -3 .zsh_history
<span class="nb">echo</span> foobar
emacs .zshrc
: <span class="m">1361702407</span>:0<span class="p">;</span>tail -3 .zsh_history
</pre></div>
</div>

<p>これで閉じたセッションで実行したコマンドもhistoryで時刻を確認できるようになる。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>10</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/7c958b93199195baa4b6">コマンドの実行結果を入れ子にする　</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-01-17 23:40:43</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>バッククォートを使うと無理だけど、</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>: pwdの結果をsedで置換した結果を…
<span class="nb">cd</span> /Users/foo
<span class="nb">echo</span> parent <span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span> <span class="p">|</span> sed -e <span class="s2">"s/foo//"</span><span class="sb">`</span>
zsh: parse error near <span class="sb">`</span><span class="p">|</span><span class="err">'</span>
zsh: parse error in <span class="nb">command</span> substitution
</pre></div></div>

<p>$()を使うと、</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span><span class="nb">echo</span> parent <span class="nv">dir</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span> <span class="p">|</span> sed -e <span class="s2">"s/\/foo//"</span><span class="k">)</span>
parent <span class="nv">dir</span><span class="o">=</span>/Users

: pwdの結果をsedで置換した結果をsedで置換し...
<span class="nb">echo</span> root <span class="nv">dir</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="k">$(</span><span class="nb">echo</span> <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span> <span class="p">|</span> sed -e <span class="s2">"s/\/foo//"</span><span class="k">)</span> <span class="p">|</span> sed -e <span class="s2">"s/Users//"</span><span class="k">)</span>
root <span class="nv">dir</span><span class="o">=</span>/
</pre></div></div>

<p>何重にでもできる。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>horimislimeさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/horimislime/items/a468c449449aad7524ad">Mavenで生成したtargetフォルダ下の権限を変更する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-27 00:18:41</center>
	</td>
	<td style="width:200px;">
		@horimislime<br />(Toreta 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/7325/profile-images/1473684151">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Java]</b> <b>[Maven]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>src/main/resources下に置いているファイル達は、元の権限がどうであれtarget/classes下に吐き出されると644になってしまう。resources下に実行形式ファイルを置いている関係で、どうしてもclasses下のファイルを755にする必要があったので方法をメモってみる。</p>

<p>やり方としてはpomに以下のpluginを追加する。</p>

<div class="code-frame" data-lang="xml">
<div class="code-lang"><span class="bold">pom.xml</span></div>
<div class="highlight"><pre><span></span><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>maven-antrun-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.6<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>process-classes<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>process-classes<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;target&gt;</span>
                    <span class="nt">&lt;chmod</span> <span class="na">file=</span><span class="s">"target/classes/chromedriver"</span> <span class="na">perm=</span><span class="s">"755"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/target&gt;</span>
            <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
                <span class="nt">&lt;goal&gt;</span>run<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
    <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>

<p>このプラグインはmavenの任意フェーズにantタスクを仕込めるもの。自分の環境ではtestフェーズより前でJUnitから利用するSeleniumドライバに実行権を与える必要があったので、process-classesでドライバの権限を755にしてる。</p>

<p>他にもmaven-assembly-pluginを使う方法もあるみたいだけど、こっちはうまく権限が変えられなかった。<br>
<a href="http://stackoverflow.com/questions/7478495/how-do-i-set-directory-permissions-in-maven-output" rel="nofollow noopener" target="_blank">How do I set directory permissions in maven output? - Stack Overflow</a></p>

<p>antrun pluginはもちろんbuild.xmlも実行できるので、今回の例以外にもいろいろ使えそう。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
