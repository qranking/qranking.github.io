<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (kawaz)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (kawaz さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>818</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/07d67a851fd49c1c183e">S3の料金体系が分かりにくいと聞かれたので纏めた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-19 11:42:26</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[S3]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="課金ポイントは3つ" class="fragment"></span><a href="#%E8%AA%B2%E9%87%91%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%AF3%E3%81%A4"><i class="fa fa-link"></i></a>課金ポイントは3つ</h1>

<p>そんなに難しいことはないと思いますが <strong>課金ポイントは3つ</strong> あります。</p>

<h2>
<span id="ストレージ容量" class="fragment"></span><a href="#%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E5%AE%B9%E9%87%8F"><i class="fa fa-link"></i></a>ストレージ容量</h2>

<p>単純に保存容量に対して課金されます。<br>
低冗長化ストレージを指定すると2割くらい安くできます。</p>

<p>ログだとか家族写真の保存だとかメインだとデータ転送よりここにお金がかかってきます。（容量でかいけど古いやつは殆どアクセスしないようなのはライフサイクル設定でGlacierに移動する手もあります）</p>

<h2>
<span id="データ転送" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E8%BB%A2%E9%80%81"><i class="fa fa-link"></i></a>データ転送</h2>

<p>課金されるのは送信だけです。受信（S3へのアップロード）は無料です。</p>

<p>また、<code>インターネットへの送信</code>と<code>別のAWSリージョンまたはCloudFrontへの送信</code>で別料金が設定されてますが、小～中規模のシステムならサーバ群は1リージョンに纏まってることが多いでしょうから、CroudFront利用時くらいにしかその料金は発生しないと思います。しかもCroudFront利用時は殆どのトラフィックはCroudFrontで処理されるから転送量はそっちに計上されて、S3からの送信は殆ど無視出来る感じになるでしょう。</p>

<p>あと <strong>同一リージョン内の(AZ非依存な)AWSサービスとの通信は無料</strong> です。例えば同一リージョンのEC2とS3間の通信は送信も受信も無料。</p>

<p>なので特殊な用途以外では、 <strong>一番高いインターネットへのデータ送信だけ考えておけばよい</strong> と思います。</p>

<h2>
<span id="リクエスト数" class="fragment"></span><a href="#%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E6%95%B0"><i class="fa fa-link"></i></a>リクエスト数</h2>

<p>多分これがあるせいでS3の料金が分かりにくいって言われるんでしょうね。<br>
S3ではGET/PUT/POST/LIST/COPYなどのリクエスト数に対しての課金もあります。</p>

<ul>
<li>GET は安い（$0.0037/10,000req、OPTION/HEADとかも、↓以外は全部この料金）</li>
<li>PUT/POST/LIST/COPY は高め（$0.0047/1,000req、GETの12.7倍）</li>
<li>DELETE は無料</li>
</ul>

<p>例えば1日100万GETされると月に3千万リクエストで課金は$11.1になります。<br>
データ転送コストの一部という感覚です。</p>

<h1>
<span id="適当に計算してみた感じ" class="fragment"></span><a href="#%E9%81%A9%E5%BD%93%E3%81%AB%E8%A8%88%E7%AE%97%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F%E6%84%9F%E3%81%98"><i class="fa fa-link"></i></a>適当に計算してみた感じ</h1>

<p>CDN用途で使ったとして、キャッシュとか考えずに適当に計算してみると↓こんな感じ。<br>
※2014/07/04に東京リージョンで計算した値です（前の価格覚えてないけど消費税UPで変わったかもしれないので再計算）。<br>
※2014/12/01にAWS初の<a href="http://aws.amazon.com/jp/blogs/aws/aws-data-transfer-price-reduction/" rel="nofollow noopener" target="_blank">データ転送量値下げ</a>キタ！後で再計算予定だけどとりあえず<font color="red">下の表の転送料金部分を25%OFFくらいで見ておけ</font>ばOK!<br>
※数字の単位は K=1024, G=1024*1024, T=1024^3, P=1024^4 です。</p>

<table>
<thead>
<tr>
<th style="text-align: right">GETリクエスト数</th>
<th style="text-align: right">平均ファイルサイズ</th>
<th style="text-align: right">データ転送量</th>
<th style="text-align: right">転送料金</th>
<th style="text-align: right">リクエスト料金</th>
<th style="text-align: right">合計料金</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right">3千万(100万/日)</td>
<td style="text-align: right">1KB</td>
<td style="text-align: right">28.6GB</td>
<td style="text-align: right">$5 .55</td>
<td style="text-align: right">$11 .10</td>
<td style="text-align: right">$16 .65</td>
</tr>
<tr>
<td style="text-align: right">3千万(100万/日)</td>
<td style="text-align: right">1.95KB</td>
<td style="text-align: right">55.8GB</td>
<td style="text-align: right"><strong>$11 .01</strong></td>
<td style="text-align: right"><strong>$11 .10</strong></td>
<td style="text-align: right">$22 .11</td>
</tr>
<tr>
<td style="text-align: right">3千万(100万/日)</td>
<td style="text-align: right">50KB</td>
<td style="text-align: right">1.4TB</td>
<td style="text-align: right">$287 .33</td>
<td style="text-align: right">$11 .10</td>
<td style="text-align: right">$298 .43</td>
</tr>
<tr>
<td style="text-align: right">3千万(100万/日)</td>
<td style="text-align: right">100KB</td>
<td style="text-align: right">2.8TB</td>
<td style="text-align: right">$574 .86</td>
<td style="text-align: right">$11 .10</td>
<td style="text-align: right">$585 .96</td>
</tr>
<tr>
<td style="text-align: right">3千万(100万/日)</td>
<td style="text-align: right">1MB</td>
<td style="text-align: right">28.6TB</td>
<td style="text-align: right">$5,068 .03</td>
<td style="text-align: right">$11 .10</td>
<td style="text-align: right">$5,080 .13</td>
</tr>
<tr>
<td style="text-align: right">3億(1千万/日)</td>
<td style="text-align: right">1KB</td>
<td style="text-align: right">286.1GB</td>
<td style="text-align: right">$57 .31</td>
<td style="text-align: right">$111 .00</td>
<td style="text-align: right">$168 .31</td>
</tr>
<tr>
<td style="text-align: right">3億(1千万/日)</td>
<td style="text-align: right">1.95KB</td>
<td style="text-align: right">557.9GB</td>
<td style="text-align: right"><strong>$111 .94</strong></td>
<td style="text-align: right"><strong>$111 .10</strong></td>
<td style="text-align: right">$222 .94</td>
</tr>
<tr>
<td style="text-align: right">3億(1千万/日)</td>
<td style="text-align: right">50KB</td>
<td style="text-align: right">14.0TB</td>
<td style="text-align: right">$2700 .33</td>
<td style="text-align: right">$111 .10</td>
<td style="text-align: right">$2,811 .33</td>
</tr>
<tr>
<td style="text-align: right">3億(1千万/日)</td>
<td style="text-align: right">100KB</td>
<td style="text-align: right">27.9TB</td>
<td style="text-align: right">$4,960 .54</td>
<td style="text-align: right">$111 .10</td>
<td style="text-align: right">$5,071 .54</td>
</tr>
<tr>
<td style="text-align: right">3億(1千万/日)</td>
<td style="text-align: right">1MB</td>
<td style="text-align: right">286.1TB</td>
<td style="text-align: right">$40,258 .35</td>
<td style="text-align: right">$111 .10</td>
<td style="text-align: right">$40,369 .35</td>
</tr>
<tr>
<td style="text-align: right">30億(1億/日)</td>
<td style="text-align: right">1KB</td>
<td style="text-align: right">2.8TB</td>
<td style="text-align: right">$574 .86</td>
<td style="text-align: right">$1,111 .00</td>
<td style="text-align: right">$1,684 .86</td>
</tr>
<tr>
<td style="text-align: right">30億(1億/日)</td>
<td style="text-align: right">1.95KB</td>
<td style="text-align: right">5.4TB</td>
<td style="text-align: right"><strong>$1,121 .18</strong></td>
<td style="text-align: right"><strong>$1,111 .00</strong></td>
<td style="text-align: right">$2.231 .18</td>
</tr>
<tr>
<td style="text-align: right">30億(1億/日)</td>
<td style="text-align: right">50KB</td>
<td style="text-align: right">139.7TB</td>
<td style="text-align: right">$21,113 .33</td>
<td style="text-align: right">$1,111 .00</td>
<td style="text-align: right">$22.223 .33</td>
</tr>
<tr>
<td style="text-align: right">30億(1億/日)</td>
<td style="text-align: right">100KB</td>
<td style="text-align: right">279.4TB</td>
<td style="text-align: right">$39,386 .31</td>
<td style="text-align: right">$1,111 .00</td>
<td style="text-align: right">$40,496 .31</td>
</tr>
<tr>
<td style="text-align: right">30億(1億/日)</td>
<td style="text-align: right">1MB</td>
<td style="text-align: right">3.1PB</td>
<td style="text-align: right">お問い合わせ</td>
<td style="text-align: right">$1,111 .00</td>
<td style="text-align: right">お問い合わせ</td>
</tr>
</tbody>
</table>

<ul>
<li>平均ファイルサイズが2KB以下だと、<code>リクエスト数</code> &gt; <code>データ転送</code> &gt; <code>ストレージ容量</code>
</li>
<li>平均ファイルサイズが2KB以上だと、<code>データ転送</code> &gt; <code>リクエスト数</code> &gt; <code>ストレージ容量</code>
</li>
</ul>

<p>という順番でお金がかるっぽいです。</p>

<p>なので分割されたJS/CSSはconcatして小さい画像はCSSスプライトも活用してリクエスト数を減らしてやりましょう、サイトパフォーマンスが上がるだけじゃなく財布にも優しくなります。</p>

<p>それからやっぱ転送量が一番金がかかるのでクライアントキャッシュ出来るものはどんどんキャッシュさせて圧縮できるものは圧縮しときましょう。</p>

<p>ちなみにS3の前にCloudFrontを挟むとS3のリクエスト数とデータ転送量は大幅に減ります。ですが減った分はCloudFront側で計上されるのでゼロになるわけじゃありません、データ転送料金はCloudFrontの方が多少安く設定されています。特にデータ転送量が巨大になってきた場合はCloudFrontを経由したほうが、ボリュームディスカウントが効いてきたり、またリザーブド契約をすることで大幅な割引を受けたりも出来るので是非検討しましょう。特に年間とおして月平均10TB以上使う場合はCloudFrontの営業に連絡を取るべきです。</p>

<h1>
<span id="月額計算機amazon-web-services-simple-monthly-calculator" class="fragment"></span><a href="#%E6%9C%88%E9%A1%8D%E8%A8%88%E7%AE%97%E6%A9%9Famazon-web-services-simple-monthly-calculator"><i class="fa fa-link"></i></a>月額計算機（Amazon Web Services Simple Monthly Calculator）</h1>

<p>とりあえずAWSの課金で悩んだら以下のページから見積もりできるので、実際の数字を入れて見てみるのが理解への近道です。<br>
<a href="https://calculator.s3.amazonaws.com/calc5.html?lng=ja_JP" rel="nofollow noopener" target="_blank">Amazon Web Services Simple Monthly Calculator</a></p>

<p>S3の料金なら、左メニューからAmazon S3をクリックして、リージョン選択をしてとりあえずは、ストレージ&gt;ストレージ、データ転送&gt;データ転送、リクエスト&gt;GET、の値を入力しておけば十分でしょう。</p>

<p>あとこの計算機は、デフォで <strong>右上の分かりにくいところにある初年度無料枠のチェックボックス</strong> がONになってるので長期的な見積もりをしたい場合は外しておきましょう。</p>

<h1>
<span id="値下げについて" class="fragment"></span><a href="#%E5%80%A4%E4%B8%8B%E3%81%92%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>値下げについて</h1>

<ul>
<li>容量に対する課金は過去に何度も値下げがされています。きっと今後も定期的に値下げがあることが期待できます。</li>
<li>
<strike>データ転送量と</strike>あとコール回数依存の課金（S3の場合はリクエスト数）に関しては、僕の記憶が確かなら全AWSサービスに対しても一度も値下げが無いと思います。特にデータ転送に関わる部分は高額になりがちなので安くなると嬉しいなーと毎回思うけどビクともしません、聖域なんですかね？

<ul>
<li>2014年12月1日から、多分AWSで初の<a href="http://aws.amazon.com/jp/blogs/aws/aws-data-transfer-price-reduction/" rel="nofollow noopener" target="_blank">データ転送量の値下げ</a>キター！！全体的に大体25%くらいは安くなるぞぉぉぉおーー！</li>
</ul>
</li>
</ul>

<h1>
<span id="関連リンク" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>関連リンク</h1>

<p><a href="http://aws.amazon.com/jp/s3/pricing/" rel="nofollow noopener" target="_blank">Amazon S3 料金表</a><br>
<a href="https://calculator.s3.amazonaws.com/calc5.html?lng=ja_JP" rel="nofollow noopener" target="_blank">Amazon Web Services Simple Monthly Calculator</a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />2位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>427</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/363f430d21ec729f1b7d">AngularJSのDIの仕組み、minify対策は覚えておこう！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-04 04:09:01</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[AngularJS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>DI (Dependency Injection)ってのは日本語では依存性注入とも呼ばれ、大雑把に言うとAngularJSがコントローラなどに必要とされているコンポーネント(オブジェクト)をいい感じに渡してやる機能です。</p>

<p>ここでは特にAngularJSのDIがどのような仕組で動いてるか、そしてその独特なDIの実装にまつわるトラブルケースを説明します。</p>

<h1>
<span id="angularjsのコントローラの書き方" class="fragment"></span><a href="#angularjs%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i class="fa fa-link"></i></a>AngularJSのコントローラの書き方</h1>

<p>まずはAngularJSの中心的な機能であるコントローラの書き方には、簡単版と面倒版の複数の書き方があることを抑えておきましょう。</p>

<h2>
<span id="パターン1グローバル関数パターン" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B31%E3%82%B0%E3%83%AD%E3%83%BC%E3%83%90%E3%83%AB%E9%96%A2%E6%95%B0%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>パターン1（グローバル関数パターン）</h2>

<p>サンプルとかでよく見るのは↓こういうグローバル関数の形のコントローラです。</p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-app</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-controller</span><span class="o">=</span><span class="s">"HogeCtrl"</span><span class="p">&gt;</span>（略）<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">HogeCtrl</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//略</span>
<span class="p">}</span>
</pre></div></div>

<p>シンプルでとっつきやすいです。初心者にも優しくデモ向きですね。<br>
AngularJSの素敵さ(不思議さ)がよく分かる形です。</p>

<h2>
<span id="パターン2モジュール作ってcontrollerメソッドパターン" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B32%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E4%BD%9C%E3%81%A3%E3%81%A6controller%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>パターン2（モジュール作って.controllerメソッドパターン）</h2>

<p>そしてもう一つは↓このようなキチンとしたモジュール定義の形です。</p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-app</span><span class="o">=</span><span class="s">"myApp"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-controller</span><span class="o">=</span><span class="s">"HogeCtrl"</span><span class="p">&gt;</span>（略）<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">myApp</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'HogeCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//略</span>
<span class="p">}]);</span>
</pre></div></div>

<p>なんか急に複雑で、初心者お断りな雰囲気になりましたね…。</p>

<p>これからAngularJSやってみようかって人が最初にこれ見たら、その時点で半分は逃げ出しちゃいそうです。AngularJSの素敵さを説明するには本質以外の部分が多いのでデモには向かない形かもです。</p>

<p>でもAngularJSでちゃんとしたアプリを作ろうと思ったら覚えなきゃいけない形です。理由は続きを読めば分かります。</p>

<h2>
<span id="パターン3inject-annotationパターン" class="fragment"></span><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B33inject-annotation%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fa fa-link"></i></a>パターン3（$inject Annotationパターン）</h2>

<p>1にかなり近い形だけど2ほど面倒じゃなくて、でもAngularJS的には一応キチンとしてて1よりはベターな↓こんな形もあります。</p>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-app</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-controller</span><span class="o">=</span><span class="s">"HogeCtrl"</span><span class="p">&gt;</span>（略）<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div></div>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">HogeCtrl</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//略</span>
<span class="p">}</span>
<span class="nx">HogeCtrl</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">];</span>
</pre></div></div>

<p>2つ目の形を覚えたくないならこの形も一応アリ、但しコントローラの機能しか使わないのであれば、だけど。フィルター定義とかしたくなったら結局は2つ目の形を覚える必要があるので、むしろこの形は一番覚える必要が無いとも言えます。</p>

<p>これの意味するところも最後まで読めば分かります。</p>

<h2>
<span id="angular公式の推奨は2つ目の書き方多分" class="fragment"></span><a href="#angular%E5%85%AC%E5%BC%8F%E3%81%AE%E6%8E%A8%E5%A5%A8%E3%81%AF2%E3%81%A4%E7%9B%AE%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E5%A4%9A%E5%88%86"><i class="fa fa-link"></i></a>Angular公式の推奨は2つ目の書き方（多分）</h2>

<p>上記の3種類の書き方はどれも同じように動くけど、公式ドキュメントの<a href="http://docs.angularjs.org/guide/controller" rel="nofollow noopener" target="_blank">Understanding Controllers</a>のページでは、以下に引用するように上記2つ目の <strong>.controllerメソッドを利用した形を推奨</strong> する文章があります。</p>

<blockquote>
<p><strong>NOTE</strong>: Many of the examples in the documentation show the creation of functions in the global scope. This is only for demonstration purposes - in a real application you should use the .controller method of your Angular module for your application as follows: ...</p>
</blockquote>

<p>↓超訳</p>

<blockquote>
<p>ドキュメント上のサンプルではグローバル関数でコントローラ定義してるのが多いけど、それはあくまでデモの分かりやすさを優先してるからだよ。ちゃんとしたアプリを作るときは、アプリ用のモジュールを作ってその.controllerメソッドを使ってコンポーネント名を列挙した書き方をする <strong>べき(should)</strong> だ。</p>
</blockquote>

<h1>
<span id="angularjsのdiの仕組み" class="fragment"></span><a href="#angularjs%E3%81%AEdi%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF"><i class="fa fa-link"></i></a>AngularJSのDIの仕組み</h1>

<h2>
<span id="angularjsの不思議" class="fragment"></span><a href="#angularjs%E3%81%AE%E4%B8%8D%E6%80%9D%E8%AD%B0"><i class="fa fa-link"></i></a>AngularJSの不思議</h2>

<p>AngularJSのコントローラーの引数って<code>$scope</code>や<code>$route</code>や<code>$window</code>って名前が当たり前のように使われてますが、これってただの慣習的なものじゃないんですよね。試しに引数の変数名をscopeとかrとかに変えると動かなくなってしまいます。</p>

<p>それに、コントローラ関数の<code>$scope</code>とか<code>$route</code>という引数の順番を変えても動くことにも不思議を感じませんか？これ関数の引数になってるからグローバル変数でもありえないしどうなってんの、と。</p>

<p>その答えは実は、AngularJSのちょっと特殊（変態的）なDIの仕組みにあります。</p>

<h2>
<span id="実装の秘密変数名でdi" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E3%81%AE%E7%A7%98%E5%AF%86%E5%A4%89%E6%95%B0%E5%90%8D%E3%81%A7di"><i class="fa fa-link"></i></a>実装の秘密（変数名でDI）</h2>

<p>AngularJSの不思議の鍵はその実装方法にあります。</p>

<p>実はAngularJSはコントローラに指定された関数定義を <strong>文字列としてパース</strong> して、引数の <strong>変数名</strong> からコントローラ関数に渡すべきオブジェクトを決定するというかなり特殊（ぶっちゃけ変態的）なアプローチを取っているんです。だからこんなJavascript的には一見不思議なDIが可能なんですね。</p>

<p>このあたりのは<code>$injector</code>内の<code>annotate(fn)</code>という関数の<a href="https://github.com/angular/angular.js/blob/aa268560064e5875bd471da3f7d1ebc2f9e6b3b7/src/auto/injector.js#L64-L116" rel="nofollow noopener" target="_blank">実装</a>を見ると分かります。関数オブジェクトに対して<code>HogeCtrl.toString()</code>すると関数定義全体が文字列として取得できることを利用しているんですね。</p>

<h1>
<span id="minifyにまつわるトラブル" class="fragment"></span><a href="#minify%E3%81%AB%E3%81%BE%E3%81%A4%E3%82%8F%E3%82%8B%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB"><i class="fa fa-link"></i></a>minifyにまつわるトラブル</h1>

<p>勘の良い人ならもう気づいてると思いますが、AngularJSのDIが上述のような仕組みで動いている為、AngularJS用のソースコードはminify(文字数節約による圧縮)やobfuscate(難読化)等に弱いんです。</p>

<p>例えば、<code>function($scope){...}</code>が<code>function(s){...}</code>とかに変換されてしまうと、引数の変数名を見ても$scopeのオブジェクトを渡すべきってことが分からなくなってしまうのですね。</p>

<p>これを知らないとminifyしたとたんに動かなくなって、Angularがバグってやがる、とかminifierのバグだ、とか見当違いのデバッグ作業で時間を無駄にすることになったります。</p>

<p>公式ドキュメントのコメントとかにも「サンプル動かねーんだけど！」って声がよくあるのは、大抵このパターンだと思います。フレームワークで最初から勝手にminifyされるのに慣れちゃってるような人がよくハマる罠です。</p>

<h2>
<span id="解決策パターン2の書き方を推奨する理由" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E7%AD%96%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B32%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%82%92%E6%8E%A8%E5%A5%A8%E3%81%99%E3%82%8B%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>解決策（パターン2の書き方を推奨する理由）</h2>

<p>この問題の解決策として用意されているのが、コントローラの書き方パターン2の「.controllerメソッドを使うパターン」です。</p>

<p>minifyやobfuscateプログラムは文字列の値は弄りませんから、渡してほしいオブジェクト名を文字列として明示的に指示してやることで、AngularJSはわざわざfunctionオブジェクトをパースせずとも「1番目の引数として<code>$scope</code>を渡してやればいいんだな」ということが知ることが出来、結果としてアノテート対象の関数の引数名が何であろうと第1引数に<code>$scope</code>という名前のオブジェクトを受け取れるようになるわけです。</p>

<p>そんなわけで、導入としては便利だしとっつきやすいから1番目の書き方もできるけど、本格的に開発したりライブラリとして第3者に利用されることも考えたコードを書くなら、minifyが導入される可能性も考慮してパターン2の「モジュール作って.controllerメソッドを利用する」書き方を推奨してるのです。</p>

<h2>
<span id="蛇足パターン3の書き方でもよい理由" class="fragment"></span><a href="#%E8%9B%87%E8%B6%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B33%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%81%A7%E3%82%82%E3%82%88%E3%81%84%E7%90%86%E7%94%B1"><i class="fa fa-link"></i></a>蛇足（パターン3の書き方でもよい理由）</h2>

<p>ちなみに、パターン1で関数を文字列パースして分かった引数名は最終的には関数オブジェクトの<code>$inject</code>というプロパティにキャッシュとして保存されて、以降Angularは$injectプロパティから要求されているコンポーネント名を取得するようになってます。</p>

<p>最初に紹介したパターン3の形はこの内部実装を利用した抜け道なわけですね。これは一応公式ドキュメントでも<a href="http://docs.angularjs.org/guide/di" rel="nofollow noopener" target="_blank">$inject Annotation</a>として紹介されている方法ですが、実装に依存してる感は拭いきれず気持ち悪いので個人的にはあんまし使わないです。</p>

<h1>
<span id="コントローラに限った話ではない" class="fragment"></span><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AB%E9%99%90%E3%81%A3%E3%81%9F%E8%A9%B1%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>コントローラに限った話ではない</h1>

<p>ここではコントローラを中心に説明しましたが、このDIの仕組みとminify問題は、全てのコンポーネント（フィルター、サービス、ディレクティブ、コンフィグ、etc）でも基本みんな同じです。それぞれ<code>.filter</code>とか<code>.service</code>とか<code>.factory</code>とか<code>.directive</code>とか<code>.config</code>とか…、要は<a href="http://docs.angularjs.org/api/angular.Module" rel="nofollow noopener" target="_blank">angular.Module</a>で定義されてるメソッドで関数を渡すべき場所ではみんな、関数単体を渡す代わりにコンポーネント名と関数を纏めた配列で渡すことができるし、そうすべきだよってことです。</p>

<p>ちなみにコントローラもコンポーネントのうちです。何かの折に名前で関数オブジェクトとして取得されて使われることもあります、テストとかね。</p>

<h2>
<span id="例えばrouteprovider使った場合のコントローラの指定とかも" class="fragment"></span><a href="#%E4%BE%8B%E3%81%88%E3%81%B0routeprovider%E4%BD%BF%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%AE%E6%8C%87%E5%AE%9A%E3%81%A8%E3%81%8B%E3%82%82"><i class="fa fa-link"></i></a>例えば$routeProvider使った場合のコントローラの指定とかも</h2>

<p>↓こんな感じに<code>.controller</code>で指定したコントローラ名を文字列で渡してやればminify対策が出来るようになってます。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[</span><span class="s1">''</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'ListCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span><span class="cm">/* 略 */</span><span class="p">}])</span>
  <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'HogeCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span><span class="cm">/* 略 */</span><span class="p">}])</span>
  <span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s2">"$routeProvider"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$routeProvider</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$routeProvider</span><span class="p">.</span>
      <span class="nx">when</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">{</span><span class="nx">controller</span><span class="o">:</span><span class="s2">"ListCtrl"</span><span class="p">,</span> <span class="nx">templateUrl</span><span class="o">:</span><span class="s1">'list.html'</span><span class="p">}).</span>
      <span class="nx">when</span><span class="p">(</span><span class="s1">'/hoge'</span><span class="p">,</span> <span class="p">{</span><span class="nx">controller</span><span class="o">:</span><span class="s2">"HogeCtrl"</span><span class="p">,</span> <span class="nx">templateUrl</span><span class="o">:</span><span class="s1">'hoge.html'</span><span class="p">});</span>
  <span class="p">}]);</span>
</pre></div></div>

<p><code>$routeProvider.when(path, route)</code>の<a href="http://docs.angularjs.org/api/ng.%24routeProvider" rel="nofollow noopener" target="_blank">ドキュメント</a>にも文字列or関数で指定すると書いてあります。</p>

<blockquote>
<p>route - {Object}<br>
・controller – {(string|function()=} – Controller fn that should be associated with newly created scope or the name of a registered controller if passed as a string.</p>
</blockquote>

<h1>
<span id="参考url" class="fragment"></span><a href="#%E5%8F%82%E8%80%83url"><i class="fa fa-link"></i></a>参考URL</h1>

<ul>
<li>
<p>公式系</p>

<ul>
<li><a href="http://docs.angularjs.org/guide/controller" rel="nofollow noopener" target="_blank">AngularJS: Understanding Controllers</a></li>
<li><a href="https://github.com/angular/angular.js/blob/master/src/auto/injector.js#L41-L71" rel="nofollow noopener" target="_blank">angular.js/src/auto/injector.js at master · angular/angular.js · GitHub</a></li>
<li><a href="http://docs.angularjs.org/guide/di" rel="nofollow noopener" target="_blank">AngularJS: Dependency Injection</a></li>
<li><a href="http://docs.angularjs.org/api/angular.Module" rel="nofollow noopener" target="_blank">AngularJS: Module</a></li>
<li><a href="http://docs.angularjs.org/api/ng.%24routeProvider" rel="nofollow noopener" target="_blank">AngularJS: $routeProvider</a></li>
</ul>
</li>
<li>
<p>役に立つ情報</p>

<ul>
<li><a href="https://github.com/mgechev/angularjs-style-guide/blob/master/README-ja-jp.md" rel="nofollow noopener" target="_blank">AngularJS style guide (日本語訳)</a></li>
</ul>
</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />3位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>338</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/f90810b9ea823b6556a8">認証局を立ててぼろもうけしたいんですが＞無理な理由を理解しよう</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-04 13:48:03</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[SSL]</b> <b>[pki]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="sslの認証局とか証明書とか勉強し始めはホント難いよね" class="fragment"></span><a href="#ssl%E3%81%AE%E8%AA%8D%E8%A8%BC%E5%B1%80%E3%81%A8%E3%81%8B%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%A8%E3%81%8B%E5%8B%89%E5%BC%B7%E3%81%97%E5%A7%8B%E3%82%81%E3%81%AF%E3%83%9B%E3%83%B3%E3%83%88%E9%9B%A3%E3%81%84%E3%82%88%E3%81%AD"><i class="fa fa-link"></i></a>SSLの認証局とか証明書とか勉強し始めはホント難いよね</h1>

<p>このへんのSSL/TLSの仕組みって勉強し始めの頃は凄く難しく感じるのよね。分かりやすく解説してくれてるサイトってあんま見たこと無いし。</p>

<p>んで、 &gt;&gt;300,304 みたいなことは僕も昔考えたことあったわー、と懐かしみを覚えたのでレスってみた。</p>

<p>証明書を発行できるかどうかは証明書のフラグで決まっている、という &gt;&gt;303 の指摘も重要よね。</p>

<h2>
<span id="以下2chスレより引用" class="fragment"></span><a href="#%E4%BB%A5%E4%B8%8B2ch%E3%82%B9%E3%83%AC%E3%82%88%E3%82%8A%E5%BC%95%E7%94%A8"><i class="fa fa-link"></i></a>以下2chスレより引用</h2>

<p>丁寧過ぎると評判のレスをしてるID:UyEJo1f2が僕なわけだがｗ　2chだとそのうち倉庫に行っちゃうかもしれないのでここにメモ。</p>

<p>【認証局】SSLに関するスレ 2枚目【ぼろ儲け】<br>
<a href="http://hayabusa6.2ch.net/test/read.cgi/mysv/1286532904/298-309" class="autolink" rel="nofollow noopener" target="_blank">http://hayabusa6.2ch.net/test/read.cgi/mysv/1286532904/298-309</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>298 ：DNS未登録さん：2013/05/31(金) 13:31:04.18 ID:???
認証局を立ててぼろもうけしたいんですが、 
親にしたい認証局で何を買ってくればいいんですか？ 

299 ：DNS未登録さん：2013/05/31(金) 16:48:31.50 ID:ha9l9tT5
&gt;&gt;298 
馬鹿なの？ 

マジレスすると自分の作ったCA証明書を、 
各種ブラウザやアプリやOSにデフォルトでインストールしてくれるよう 
全世界に対して頑張って営業すればよい。 

300 ：DNS未登録さん：2013/06/02(日) 08:35:31.77 ID:???
(1) RapidSSLで安いサーバー証明書を1個買う 
(2) 自分で中間認証局を作り、RapidSSLのサーバー証明書を割り当てる 
(3) 自分で、自分用の他のサーバー証明書を量産する 
ってことはできるものでしょうか？ 
要するに、自分で運営しているWebサイト（ドメインがいろいろある）を(1)でまかなうケチケチ作戦です（・∀・） 
ttp://e-words.jp/w/E4B8ADE99693E8AA8DE8A8BCE5B180.html 
ttps://www.verisign.co.jp/basic/pki/trust/index_4.html 

301 ：DNS未登録さん：2013/06/02(日) 19:01:05.76 ID:???
できない。 
あなたのサーバ用の証明書は、そのサーバ（ドメイン）でしか使えない。 
中間認証局用のキーは別に存在する。 

まえに中間認証局用のキーが漏れたことがあって、大量に証明書を偽装する事件があったが。 

302 ：DNS未登録さん：2013/06/02(日) 19:06:03.97 ID:???
あった、あった、結構最近だったｗ 

http://internet.watch.impress.co.jp/docs/news/20130107_580795.html 

303 ：DNS未登録さん：2013/06/03(月) 07:50:44.66 ID:???
&gt;&gt;300 
証明書には「その証明書で他の証明書を発行していいか」 
(中間証明書になってもいいか)というフラグがあり、 
通常の証明書ではそれがfalseになっているので、無理。 

具体的にはX509v3 Basic Constraints: CAの値。 
もちろんそれも証明書の署名範囲内なので、無理矢理書き換えれば無効な証明書になる。 

304 ：DNS未登録さん：2013/06/04(火) 09:57:43.60 ID:???
&gt;&gt;301-303 参考になりました。どうもありがとうございます。 
中間証明書というのがないと、自分で公的な中間認証局を設置できないんですね＞＜ 

→自分で中間認証局を作りたい場合、中間証明書ってのは、販売されているものなのでしょうか？（聞いたことないです） 
普通の用途とは違って、特別なかんじがするから、販売されていたとしても、条件が厳しい・値段が高そうですね？ 

305 ：DNS未登録さん：2013/06/04(火) 10:50:28.97 ID:???
リセラーで調べたら 

306 ：DNS未登録さん：2013/06/04(火) 11:39:58.91 ID:UyEJo1f2
&gt;&gt;304 

いまいち理解してないようだが、認証局作るだけならopenssl使って誰も普通に作れるよ。 
で、自分で作った認証局でいくらでも証明書の発行するのも自由。 

自分のブラウザに「自分の認証局の証明書をインストール」さえしておけば、 
自分で発行した証明書もブラウザは正規の証明書として認識するようになる。 
そういう意味では発行し放題。 


でもその行為（＝得体のしれない認証局の証明書をインストール）は、 
要は自分のブラウザのセキュリティを下げてるってことなのよ。 
だって、google や yahoo の偽物証明書が返ってきたとしてもエラーにならないから 
フィッシングやウィルスの仕込みだってやりたい放題になる。 
それが自分にインストール済みの認証局が発行したものだったらブラウザは信じちゃうわけだからね。 

なのでテスト目的で自分で作った自分が信頼する認証局を使って自分でやる分には問題ないし。 
自分がホンの欠片も疑いを持たないような全幅の信頼を置いている友人が立てた認証局を信頼するのであればやってもよいことになる。 
まぁ、俺なら例え友人や家族だろうと素人が立てた認証局なんてインストールしたくないわ。 

要は認証局とか証明書っていうのは、信頼の連鎖なわけよ。 
俺が信頼すると決めた奴の言うことは俺も100%信頼する、という、さ。 


公的な認証局になるってことは他人のセキュリティを支配可能になるということとほぼ同じ。 
だから国とか特別な公的な団体とか色んな人間に日々監査され信頼された大企業とか、 
特別に「信頼出来る組織」が運用してる認証局しか基本使えないし、使わないの。 
OSやブラウザにデフォルトでインストールされている認証局ってのはそういう存在なの。 


これだけ説明すれば個人が公的な認証局になるなんてことはほぼ不可能だと分かるだろ？ 

307 ：DNS未登録さん：2013/06/04(火) 11:47:16.27 ID:???
丁寧すぎワロタｗ 

308 ：DNS未登録さん：2013/06/04(火) 11:56:02.85 ID:UyEJo1f2
ついでに言うと、 
だったらその「公的に認められた認証局」の中に悪人がいたらどうすんの？ 
って思うかもしれないね。 

うん、勿論大変なことになる。 
でももし一度でもそんなことをしたらその認証局は誰にも信頼されなくなるよね。 
その瞬間から、世界中から「お前はもう信頼しねー」と思われ「あいつは信頼してはいけない」と言われる存在になってしまう。 


現実にはそれによって何が起こるかというと、 
全世界的にブラックリストな認証局として記録・公開される。 
マトモなOSやブラウザなら、デフォルトインストールの認証局リストからそいつを排除するし。 
その認証局の証明書をアンインストールするパッチを配布する。 

そうなったらもうその認証局は実質的に存在できなくなるわけだ。 
発行した証明書はブラウザで警告が表示されて誰も信じてくれない。 
当然、証明書の発行を商売にしてたとしたら誰も買わなくなるから潰れる。 
世界中から訴訟も起こされるかもしれない。 


認証局自身も過ちを犯してしまったらそうなることが分かってるから、 
全力で自分の組織を健全に保とうと努力するし、内部からも外部からも監査を徹底することになる。 
それは監査を受けることはその組織にとって自分を守ることでもあるわけだ。 

そういう目に見えない力が働くことによって、世の中の信頼の連鎖が今日も保たれてるのだよ。 


分かった？ 

309 ：DNS未登録さん：2013/06/04(火) 12:44:01.25 ID:???
外部から不正侵入されて偽証明書を発行してしまったオランダの認証局は 
信用を失ってその後破産しました。 
</pre></div></div>

<h2>
<span id="追記ca認定を受ける方法" class="fragment"></span><a href="#%E8%BF%BD%E8%A8%98ca%E8%AA%8D%E5%AE%9A%E3%82%92%E5%8F%97%E3%81%91%E3%82%8B%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>追記：CA認定を受ける方法</h2>

<p>実際の認定条件とかは知らなかったんだが、はてぶでコメントが付いてたので引用させていただく。</p>

<blockquote>
<p>id:masabossa CAで事業するならWebTrust for CAに認定されている必要がある。それがブラウザ等にルートCA証明書を搭載してもらうための標準的な条件となっている。日本国のGPKIも認定してもらっている→ <a href="https://www.gpki.go.jp" class="autolink" rel="nofollow noopener" target="_blank">https://www.gpki.go.jp</a> </p>
</blockquote>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />4位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>237</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/96af6fa59fdf999b94bd">既存プロセスの標準出力と標準エラーを奪う</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-06 14:00:32</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Bash]</b> <b>[Linux]</b> <b>[gdb]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://yudoufu.hatenablog.jp/entry/2014/02/06/001440" class="autolink" rel="nofollow noopener" target="_blank">http://yudoufu.hatenablog.jp/entry/2014/02/06/001440</a><br>
↑この記事に触発されてスクリプト化してみた。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">grabtty.sh</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># 既存プロセスの標準出力と標準エラーを奪う http://bit.ly/1neWKth</span>

<span class="c1"># ターゲットのPID</span>
<span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
<span class="o">[[</span> -d /proc/<span class="nv">$1</span>/fd <span class="o">]]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>

<span class="c1"># 出力先はttyやファイルを指定</span>
<span class="nv">out</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>

<span class="c1"># 出力先の指定がない場合は現在のttyを出力先にする</span>
<span class="k">if</span> <span class="o">[[</span> -z <span class="nv">$out</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="c1"># プロセスに紐付いたttyを取得する http://bit.ly/1eDpRpu</span>
  <span class="k">function</span> search_tty<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$$</span><span class="si">}</span> <span class="nv">tty</span><span class="o">=</span><span class="s2">""</span>
    <span class="k">while</span> <span class="o">[[</span> <span class="m">1</span> -lt <span class="nv">$pid</span> <span class="o">]]</span><span class="p">;</span> <span class="k">do</span>
      <span class="o">[[</span> -d /proc/<span class="nv">$pid</span>/fd <span class="o">]]</span> <span class="o">||</span> <span class="nb">break</span>
      <span class="nv">tty</span><span class="o">=</span><span class="k">$(</span>readlink /proc/<span class="nv">$pid</span>/fd/1 <span class="m">2</span>&gt;/dev/null <span class="p">|</span> awk <span class="s1">'{print $1}'</span><span class="k">)</span>
      <span class="o">[[</span> -c <span class="nv">$tty</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$tty</span><span class="s2">"</span><span class="p">;</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span> <span class="o">}</span>
      <span class="nv">pid</span><span class="o">=</span><span class="k">$(</span>perl -pe <span class="s1">'s/\(.*\)/()/'</span> /proc/<span class="nv">$pid</span>/stat <span class="p">|</span> awk <span class="s1">'{print $4}'</span><span class="k">)</span>
    <span class="k">done</span>
    <span class="k">return</span> <span class="m">1</span>
  <span class="o">}</span>
  <span class="nv">out</span><span class="o">=</span><span class="k">$(</span>search_tty<span class="k">)</span>
<span class="k">fi</span>

<span class="o">[[</span> -n <span class="nv">$out</span> <span class="o">]]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="o">[[</span> -e <span class="nv">$out</span> <span class="o">]]</span> <span class="o">||</span> touch <span class="s2">"</span><span class="nv">$out</span><span class="s2">"</span>
<span class="o">[[</span> -e <span class="nv">$out</span> <span class="o">]]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>

<span class="c1"># gdbスクリプトを作る</span>
<span class="nv">tmpfile</span><span class="o">=</span><span class="s2">"/tmp/</span><span class="k">$(</span>basename -- <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="k">)</span><span class="s2">.tmp.</span><span class="nv">$$</span><span class="s2">"</span>
<span class="o">(</span> <span class="nb">echo</span> <span class="s2">"p close(1)"</span>
  <span class="nb">echo</span> <span class="s2">"p open(\"</span><span class="nv">$out</span><span class="s2">\", 1)"</span>
  <span class="nb">echo</span> <span class="s2">"p close(2)"</span>
  <span class="nb">echo</span> <span class="s2">"p open(\"</span><span class="nv">$out</span><span class="s2">\", 1)"</span>
  <span class="nb">echo</span> <span class="s2">"detach"</span>
  <span class="nb">echo</span> <span class="s2">"quit"</span>
<span class="o">)</span> &gt; <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>

<span class="c1"># ターゲットプロセスに対してgdbスクリプト実行</span>
gdb -p <span class="s2">"</span><span class="nv">$pid</span><span class="s2">"</span> -x <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>

<span class="c1"># 後始末</span>
rm -f <span class="s2">"</span><span class="nv">$tmpfile</span><span class="s2">"</span>
</pre></div>
</div>

<p>出力を奪いたいプロセスIDを指定して↓こんなふうに使える。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>./grabtty.sh <span class="m">12345</span>
</pre></div></div>

<p>出力先をファイルにしてもOK</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>./grabtty.sh <span class="m">12345</span> /tmp/output
</pre></div></div>

<p>この場合は<code>tail -F</code>とかで見てると増えてくのが確認できます。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<ul>
<li><a href="http://yudoufu.hatenablog.jp/entry/2014/02/06/001440" rel="nofollow noopener" target="_blank">コンソールから切れたプロセスを標準出力につなげなおす - 絶品ゆどうふのタレ</a></li>
<li><a href="http://qiita.com/kawaz/items/bd33fe1e29876939dddb" id="reference-e6ace1b3f1cd64fcb742">Linux - プロセスに紐付いたttyを取得する - Qiita [キータ]</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />5位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>236</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/1b61ee2dd4d1acc7cc94">Bashでコマンドの存在チェックはwhichよりhashの方が良いかも→いやtypeが最強</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-05 15:59:10</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>コマンドのパスを知りたいんじゃなく、コマンドの存在をチェックしたいだけなら<code>which</code>より<code>hash</code>を使ったほうが良いかもっていう話。→追記: <code>type</code>が最強っぽい。</p>

<h1>
<span id="比較してみる" class="fragment"></span><a href="#%E6%AF%94%E8%BC%83%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>比較してみる</h1>

<h2>
<span id="whichよりhashよりtypeが高速typeの勝ち" class="fragment"></span><a href="#which%E3%82%88%E3%82%8Ahash%E3%82%88%E3%82%8Atype%E3%81%8C%E9%AB%98%E9%80%9Ftype%E3%81%AE%E5%8B%9D%E3%81%A1"><i class="fa fa-link"></i></a>whichよりhashよりtypeが高速→typeの勝ち</h2>

<p>whichは実ファイルという実体があるプログラムです。hashとtypeはbashの組み込みコマンドです。なので当然ですがプログラムの起動コストがない分hashやtypeの方が速いです。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ <span class="nb">time</span> bash -c <span class="s1">'for((i=0;i&lt;10000;i++));do which perl; done &gt;/dev/null'</span>
real    0m7.739s
user    0m2.928s
sys     0m5.923s

$ <span class="nb">time</span> bash -c <span class="s1">'for((i=0;i&lt;10000;i++));do hash perl; done'</span>
real    0m0.633s
user    0m0.240s
sys     0m0.391s

$ <span class="nb">time</span> bash -c <span class="s1">'for((i=0;i&lt;10000;i++));do type perl; done &gt;/dev/null'</span>
real    0m0.603s
user    0m0.168s
sys     0m0.434s
</pre></div></div>

<p>1万回回してますがhashやtypeはwhichの10倍以上速い。そして僅差ですがtypeの方がhashより速いっぽいです、これは何回やっても同じくらい速い。ってことでtypeの勝ち。</p>

<h2>
<span id="探せるものの違いtypeの勝ち" class="fragment"></span><a href="#%E6%8E%A2%E3%81%9B%E3%82%8B%E3%82%82%E3%81%AE%E3%81%AE%E9%81%95%E3%81%84type%E3%81%AE%E5%8B%9D%E3%81%A1"><i class="fa fa-link"></i></a>探せるものの違い→typeの勝ち</h2>

<p>コマンドとして使えそうなものとしては、プログラム・組み込みコマンド・エイリアス・関数・あとはifなどの予約後があり、whichとhashとtypeでは探せるものに違いがあります。</p>

<table>
<thead>
<tr>
<th style="text-align: left"></th>
<th style="text-align: left">例</th>
<th style="text-align: center">which</th>
<th style="text-align: center">hash</th>
<th style="text-align: center">type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">プログラム</td>
<td style="text-align: left">/usr/bin/perl</td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
</tr>
<tr>
<td style="text-align: left">組み込みコマンド</td>
<td style="text-align: left">cd, alias, read, hash, ...</td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
</tr>
<tr>
<td style="text-align: left">エイリアス</td>
<td style="text-align: left">alias ll='ls -l'</td>
<td style="text-align: center">○</td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
</tr>
<tr>
<td style="text-align: left">関数</td>
<td style="text-align: left">f(){ echo func; }, nvm</td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
</tr>
<tr>
<td style="text-align: left">予約後</td>
<td style="text-align: left">if, for, ...</td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
</tr>
</tbody>
</table>

<p>とりあえずtype最強のようです。</p>

<p>nvmとかのように関数として定義されるコマンドをチェックしたい場合は基本、whichでは探せません。</p>

<h3>
<span id="補足whichで関数を探す" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3which%E3%81%A7%E9%96%A2%E6%95%B0%E3%82%92%E6%8E%A2%E3%81%99"><i class="fa fa-link"></i></a>補足（whichで関数を探す）</h3>

<p>一応whichでも、非常にアクロバティックな書き方ですが関数定義があるかどうかのチェックができなくはないです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ f() { echo func; }
$ declare -f | command which --read-functions f
f ()
{
    echo func
}
$ echo $?
0
</pre></div></div>

<p>declare -f で関数定義をダンプします。その関数定義のダンプを標準入力から読み込んだ上で --read-functions オプションをつけると、その読み込んだ関数定義内に引数で渡された関数が存在するかのチェックができます。これはman whichに書いてありますが、さすがにこんなの普通は使わないと思うｗｗｗ</p>

<h2>
<span id="環境非依存度hashtypeの勝ち" class="fragment"></span><a href="#%E7%92%B0%E5%A2%83%E9%9D%9E%E4%BE%9D%E5%AD%98%E5%BA%A6hashtype%E3%81%AE%E5%8B%9D%E3%81%A1"><i class="fa fa-link"></i></a>環境非依存度→hash,typeの勝ち</h2>

<p>Bashスクリプトを書こうとしている以上は組み込みコマンドである<code>hash</code>と<code>type</code>は常に存在を保証されています。それに対して<code>which</code>は外部プログラムであるがゆえにインストールされていないこともあり環境非依存度という点では劣ります。（まぁ、組み込みとかでない限り大抵のディストリビューションでは普通入ってますけどね）<br>
というわけで、hashとtypeの勝ち。</p>

<h2>
<span id="キャッシュの影響による正確さwhichの勝ち" class="fragment"></span><a href="#%E3%82%AD%E3%83%A3%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E5%BD%B1%E9%9F%BF%E3%81%AB%E3%82%88%E3%82%8B%E6%AD%A3%E7%A2%BA%E3%81%95which%E3%81%AE%E5%8B%9D%E3%81%A1"><i class="fa fa-link"></i></a>キャッシュの影響による正確さ→whichの勝ち？</h2>

<p>hashとtypeは組み込みコマンドだけあって毎回ゼロから起動されるwhichよりも賢いです。<br>
実はbashは、初めてperlとかを実行した際にPATHを前から順にチェックして /usr/bin/perlがあることを発見したらperl=/usr/bin/perlということをメモリ内に学習して、2度目以降perlを実行する際にはPATHのチェックせずにいきなり/usr/bin/perlを実行します。そして<code>hash</code>と<code>type</code>はまずこのbash内部のハッシュテーブルをチェックして、エントリが無ければPATH環境変数を元にコマンドを探し始めます。組み込みコマンドな上にメモリキャッシュも活用してるからwhichより早いのは当然ですね。</p>

<p>ただしあらゆるキャッシュにつきもののトラブルですが、この学習が邪魔になることもあります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># 前準備
mkdir /tmp/test
cp /bin/cat /tmp/test/copycat
export PATH="/tmp/test:$PATH"

# これは当然どっちも問題なし
which copycat # 見つかる→正解
hash copycat  # 見つかる→正解
type copycat  # 見つかる→正解

# さっきまであったコマンドを消してみる
rm -f /tmp/test/copycat
which copycat # 見つからない→正解
hash copycat  # 見つかる→不正解
type copycat  # 見つかる→不正解

# type -aだとハッシュを見なくなる
type -a copycat  # 見つからない→正解

# ハッシュをクリアすると再度PATHをチェックする
hash -r
hash copycat  # 見つからない→正解
type copycat  # 見つからない→正解
</pre></div></div>

<p>というわけでコマンドの存在チェックとしての正確さでは、毎回律儀にチェックする（むしろそれしか出来ない）<code>which</code>に軍配が上がりそう？それに対してhashとtypeはハッシュクリア対応可能、またtypeは追加オプションでも対応可能ってことで優劣はつけがたいかも。</p>

<h2>
<span id="複数コマンドを纏めて探す引き分け" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E7%BA%8F%E3%82%81%E3%81%A6%E6%8E%A2%E3%81%99%E5%BC%95%E3%81%8D%E5%88%86%E3%81%91"><i class="fa fa-link"></i></a>複数コマンドを纏めて探す→引き分け</h2>

<p><code>which perl python ruby</code>や<code>hash perl python ruby</code>や<code>type perl python ruby</code>という感じで、複数コマンドのありかを纏めてチェックするのはwhichでもhashでも出来ます。どちらもこの場合、全てが見つかったら成功で一つでも見つからなかったら失敗という判定になります。</p>

<h2>
<span id="hashは標準出力が出ないのでちょっとだけ記述が楽hashの勝ち" class="fragment"></span><a href="#hash%E3%81%AF%E6%A8%99%E6%BA%96%E5%87%BA%E5%8A%9B%E3%81%8C%E5%87%BA%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A7%E3%81%A1%E3%82%87%E3%81%A3%E3%81%A8%E3%81%A0%E3%81%91%E8%A8%98%E8%BF%B0%E3%81%8C%E6%A5%BDhash%E3%81%AE%E5%8B%9D%E3%81%A1"><i class="fa fa-link"></i></a>hashは標準出力が出ないのでちょっとだけ記述が楽→hashの勝ち</h2>

<p>そもそも別の用途のコマンドなんで仕様上当然なんですが以下の様な出力の違いがあります。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>$ which perl<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>
/usr/bin/perl
<span class="m">0</span>
$ which aaa<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>
/usr/bin/which: no aaa in <span class="o">(</span>/usr/local/bin:/bin:/usr/bin<span class="o">)</span>
<span class="m">1</span>

$ <span class="nb">hash</span> perl<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>
<span class="m">0</span>
$ <span class="nb">hash</span> aaa<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>
-bash: hash: aaa: not found
<span class="m">1</span>

$ <span class="nb">type</span> perl<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>
<span class="m">0</span>
$ <span class="nb">type</span> aaa<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>
-bash: type: aaa: not found
<span class="m">1</span>
</pre></div></div>

<p>なので、if文で使うときは邪魔な標準出力やエラー出力を隠すために↓こうなります。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="k">if</span> which python &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span> <span class="k">then</span>
  <span class="c1"># some code...</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="nb">hash</span> python <span class="m">2</span>&gt;/dev/null<span class="p">;</span> <span class="k">then</span>
  <span class="c1"># some code...</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="nb">type</span> python &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span> <span class="k">then</span>
  <span class="c1"># some code...</span>
<span class="k">fi</span>
</pre></div></div>

<p><code>2&gt;&amp;1</code> が不要になった分、<code>&gt;/dev/null</code>が<code>2&gt;/dev/null</code>になってますがトータルでhashの方が3文字少ないのでhashの勝ち。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>こんな感じに、思いついた争点を列挙してみたわけで結果は以下のとおり。</p>

<table>
<thead>
<tr>
<th></th>
<th style="text-align: center">which</th>
<th style="text-align: center">hash</th>
<th style="text-align: center">type</th>
</tr>
</thead>
<tbody>
<tr>
<td>速度</td>
<td style="text-align: center">×</td>
<td style="text-align: center">○</td>
<td style="text-align: center">◎</td>
</tr>
<tr>
<td>探せるもの</td>
<td style="text-align: center">△</td>
<td style="text-align: center">○</td>
<td style="text-align: center">◎</td>
</tr>
<tr>
<td>環境非依存度</td>
<td style="text-align: center">△</td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
</tr>
<tr>
<td>正確さ</td>
<td style="text-align: center">○</td>
<td style="text-align: center">△</td>
<td style="text-align: center">△</td>
</tr>
<tr>
<td>タイプ数</td>
<td style="text-align: center">△</td>
<td style="text-align: center">○</td>
<td style="text-align: center">△</td>
</tr>
<tr>
<td>複数同時チェック</td>
<td style="text-align: center">引き分け</td>
<td style="text-align: center">引き分け</td>
<td style="text-align: center">引き分け</td>
</tr>
</tbody>
</table>

<p>異論あるかもしれんが、<del>総じて<code>hash</code>の勝ち</del>→異論あった結果<code>type</code>最強っぽいです！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />6位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>185</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/d462a05c113b8e063736">maxlengthを使ってはいけない。特にパスワード入力欄で使っちゃ駄目！</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-18 14:06:51</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[HTML]</b> <b>[JavaScript]</b> <b>[UI]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>今日自分が体験したトラブル事例に、ユーザビリティ向上のための気づきがあったのでメモしておきます。</p>

<p>※本文よりまず、<strong><a href="http://qiita.com/kawaz/items/d462a05c113b8e063736#comment-31858b02023fac3424de">このコメント</a></strong>、こっちに言いたいことが集約されてるのでまずはこっちを読むと早いです。<br>
※本文よりまず、<strong><a href="http://qiita.com/kawaz/items/d462a05c113b8e063736#comment-31858b02023fac3424de">このコメント</a></strong>、こっちに言いたいことが集約されてるのでまずはこっちを読むと早いです。<br>
※本文よりまず、<strong><a href="http://qiita.com/kawaz/items/d462a05c113b8e063736#comment-31858b02023fac3424de">このコメント</a></strong>、こっちに言いたいことが集約されてるのでまずはこっちを読むと早いです。</p>

<h1>
<span id="事例登録時のパスワードでログイン出来ない" class="fragment"></span><a href="#%E4%BA%8B%E4%BE%8B%E7%99%BB%E9%8C%B2%E6%99%82%E3%81%AE%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%81%A7%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E5%87%BA%E6%9D%A5%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>事例：登録時のパスワードでログイン出来ない！？</h1>

<p>今日、とあるWEBサイトでユーザ登録を行った際に、登録時に入力したパスワードでログイン出来ないというトラブルがありました。<br>
普通は自分の入力ミスを疑うところですが、登録もログインもコピペで入力しているので入力ミスはありえ無いと思っていました。</p>

<h2>
<span id="お問い合わせフォームからバグ報告" class="fragment"></span><a href="#%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%8B%E3%82%89%E3%83%90%E3%82%B0%E5%A0%B1%E5%91%8A"><i class="fa fa-link"></i></a>お問い合わせフォームからバグ報告</h2>

<p>というわけでこれはバグだろうと、お問い合せフォームから以下のような内容の報告をしました。</p>

<blockquote>
<p>バグ報告</p>

<p>新規登録時に設定するパスワード入力フォームでは20文字のパスワードで新規登録を行いました。<br>
ですがそのパスワードでログインしようとするとパスワードが間違っているとのエラーでログインが出来ません。<br>
仕方ないのでパスワード再発行ページから新しいパスワードを入力した所、パスワードは12文字以内というエラーが出ました。<br>
もしかしてと思い、最初に入力した20文字のパスワードの頭12文字だけを入力したらログインできてしまいました。<br>
恐らく登録時にサーバ側では何も言わずに12文字で切って保存されているのではないでしょうか？</p>

<p>これは登録フォームのバグだと思うので修正された方が良いかと思います。</p>
</blockquote>

<p>上記の問い合わせを行ってから30分ほどするとサポートから以下の返答がありました。</p>

<blockquote>
<p>サーバ側ではそのような処理を行ってないのですが、どこの登録フォームから登録したか教えてもらえますでしょうか？</p>
</blockquote>

<p>なので、僕も確認のためにシークレットウィンドウを開いて、再度最初の登録からやりなおして再現手順を報告しなおすことにしました。</p>

<h2>
<span id="再度のお問い合せ報告" class="fragment"></span><a href="#%E5%86%8D%E5%BA%A6%E3%81%AE%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%81%9B%E5%A0%B1%E5%91%8A"><i class="fa fa-link"></i></a>再度のお問い合せ報告</h2>

<p>再現手順を確認してみた結果、僕の最初の報告内容に間違いがあったことに気が付いたので以下の内容の報告を再度行いました。</p>

<blockquote>
<p>再度登録処理を行なってみたところ、先ほどの問い合わせに書いた内容とは少し違っていたようですので改めてご説明いたします。</p>

<p>■問題の説明<br>
問題のフォームですが、登録自体はどこから行なってもよく、新規登録時に送られてくる確認メール内のワンタイムURLをクリックした後のパスワード登録フォームが問題のフォームになります。</p>

<p>ここで僕は、他ウィンドウで生成したランダムな20文字のパスワードをフォームに <strong>コピペで貼り付け</strong> て登録をしました。<br>
ですがパスワードのinputタグに<code>maxlength="12"</code>が付いていたために実際は12文字以降の文字が削られており、 <strong>実際フォームに入力されていたのは12文字だけ</strong> でした。その為、サーバ側には12文字の値が送信されており問題なく登録が行われていた、というのが真相でした。</p>

<p>maxlengthがついたフォームは手動入力時には制限に気づけるかもしれませんが、コピペ入力の場合はエラーにもならず勝手に後ろがなくなるというのがブラウザの挙動です。<br>
これは特に、パスワードのように伏字になる入力欄でかつ12文字や20文字などの長い文字列では、後ろが削られたことに非常に気づきにくいです。<br>
その為、 <strong>僕は20文字のパスワードを入力したと誤解したまま</strong> 登録が完了してしまったわけです。</p>

<p>それに対してログインフォームのパスワード欄にはmaxlengthの指定がなく20文字の貼り付けが出来てしまうので、パスワードが一致しないという自体に陥っていたようです。</p>

<p>■対応方法<br>
対応方法は2つあると思います。</p>

<p>一つはログインフォームのパスワード入力欄にも maxlength="12" を付けてしまうことです。この場合は登録フォームと同様に余分な文字が勝手に削られるので同じくコピペでログインしようとする限りは気づかずにログインできてしまうでしょう。<br>
ですが、ユーザは「 <strong>20文字のパスワードを設定したはず</strong> 」と誤解したまま利用を続けることになり、将来的に入力フォームの改修があった際に同様の問題が顕在化する危険があります。</p>

<p>より良いのは、登録フォームのmaxlengthを外して12文字を超える入力が出来るようにした上で、Javascriptやサーバサイドでのチェックでエラー表示をすることだと思います。<br>
こうしたやりかたなら、ユーザは改めてパスワードは12文字までと意識した上で登録をすることになるので問題は起きにくいと思います。</p>
</blockquote>

<h1>
<span id="教訓最大長チェックはmaxlengthではなくjavascriptとサーバサイドでやろう" class="fragment"></span><a href="#%E6%95%99%E8%A8%93%E6%9C%80%E5%A4%A7%E9%95%B7%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%AFmaxlength%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8Fjavascript%E3%81%A8%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%E3%81%A7%E3%82%84%E3%82%8D%E3%81%86"><i class="fa fa-link"></i></a>教訓：最大長チェックはmaxlengthではなくJavascriptとサーバサイドでやろう！</h1>

<p>ここで言うJavascriptってのは入力欄がリアルタイムで赤くなったり「12文字以内で入力してください」て横に表示されたりするアレのことです。</p>

<h2>
<span id="パスワード入力欄にmaxlengthを設定してはいけない" class="fragment"></span><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E5%85%A5%E5%8A%9B%E6%AC%84%E3%81%ABmaxlength%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%A6%E3%81%AF%E3%81%84%E3%81%91%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>パスワード入力欄にmaxlengthを設定してはいけない</h2>

<p>maxlengthが設定されていると、コピペ入力時に後ろの文字列が削られたことに気づかないということが分かりました。</p>

<p><strong>特にパスワード入力欄のような伏字のフォームでは後ろの文字が切れたことに気付けません！</strong></p>

<p>なので最大長を超えた入力を許した上で、Javascriptとサーバサイドのバリデーションでエラー表示をするのが親切だと思います。</p>

<h2>
<span id="パスワード入力欄以外でもmaxlengthは使わないほうが良い" class="fragment"></span><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E5%85%A5%E5%8A%9B%E6%AC%84%E4%BB%A5%E5%A4%96%E3%81%A7%E3%82%82maxlength%E3%81%AF%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84%E3%81%BB%E3%81%86%E3%81%8C%E8%89%AF%E3%81%84"><i class="fa fa-link"></i></a>パスワード入力欄以外でもmaxlengthは使わないほうが良い</h2>

<p>郵便番号や電話番号の入力欄でもハイフンや空白の考慮が無く、277-0001 と入力したつもりが 277-000 となったり、090-1234-5678 と入力したつもりが 090-1234-56 となってしまったりして、イラッとしながらハイフンを削った後に更に後ろの数字を入力しなおしたりといった経験があると思います。<br>
こんな場合も maxlength は外しておいてくれた方が嬉しいです。</p>

<p>これもやはり最大長を超えた入力を許した上で、Javascriptとサーバサイドのバリデーションでエラー表示をするのが親切だと思います。</p>

<h2>
<span id="例外使っても良いケース" class="fragment"></span><a href="#%E4%BE%8B%E5%A4%96%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%82%E8%89%AF%E3%81%84%E3%82%B1%E3%83%BC%E3%82%B9"><i class="fa fa-link"></i></a>例外：使っても良いケース</h2>

<p>例えばどういうケースで嬉しいか再度考えてみた。<br>
その結果、変換不要で分割不要な1~4文字くらいまでの入力制限をしたい用途ならあってもいいのかな？と思えてきた。</p>

<ul>
<li>4文字くらいまでの固定長の入力

<h2>
<span id="--例えば暗証番号とかクレジットカードのセキュリティコードとか" class="fragment"></span><a href="#--%E4%BE%8B%E3%81%88%E3%81%B0%E6%9A%97%E8%A8%BC%E7%95%AA%E5%8F%B7%E3%81%A8%E3%81%8B%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%82%AB%E3%83%BC%E3%83%89%E3%81%AE%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A8%E3%81%8B"><i class="fa fa-link"></i></a>- 例えば暗証番号とかクレジットカードのセキュリティコードとか</h2>
</li>
</ul>

<p>もし他に目から鱗で便利になるケースがあるようでしたら参考までに是非教えてください！</p>

<h1>
<span id="補足" class="fragment"></span><a href="#%E8%A3%9C%E8%B6%B3"><i class="fa fa-link"></i></a>補足</h1>

<p>誤解される方もいるようなので補足しておきます。</p>

<p>ここでのmaxlengthの代わりのJavascript推奨は、あくまでUIの使い勝手向上の為であり、不正な値のポストを防ごうというのが目的ではありません。ぶっちゃけJSは無くても構いません。<br>
ですが当然、 <strong>サーバサイドでのバリデーションは必須</strong> ですよ。</p>

<p>本質的にはJavascriptは不要で「maxlengthを外してサーバサイドバリデーション」これが提言の最小形です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />7位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>163</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/1e51c374b7a13c21b7e2">CORSリクエストでクレデンシャル(≒クッキー)を必要とする場合の注意点</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-22 14:36:57</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[jQuery]</b> <b>[Ajax]</b> <b>[AngularJS]</b> <b>[htaccess]</b> <b>[CORS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="クレデンシャルの送信" class="fragment"></span><a href="#%E3%82%AF%E3%83%AC%E3%83%87%E3%83%B3%E3%82%B7%E3%83%A3%E3%83%AB%E3%81%AE%E9%80%81%E4%BF%A1"><i class="fa fa-link"></i></a>クレデンシャルの送信</h1>

<p>クロスオリジンのAJAXリクエストでクレデンシャル（クッキーの送信またはBASIC認証）を必要とする場合は、それを許可するオプションをフロント側Javascriptで付けておく必要があります。デフォルトではCORSリクエストでクッキーは送信されませんし、BASIC認証は送れません。</p>

<h2>
<span id="fetch-api-の場合" class="fragment"></span><a href="#fetch-api-%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>Fetch API の場合</h2>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">mode</span><span class="o">:</span> <span class="s1">'cors'</span><span class="p">,</span> <span class="c1">//クロスオリジンリクエストをするのでCORSモードにする</span>
  <span class="nx">credentials</span><span class="o">:</span> <span class="s1">'include'</span> <span class="c1">//クレデンシャルを含める指定</span>
<span class="p">})</span>
</pre></div></div>

<h2>
<span id="jqueryの場合" class="fragment"></span><a href="#jquery%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>jQueryの場合</h2>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s2">"http://example.jp/api/user"</span><span class="p">,</span>
  <span class="nx">xhrFields</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">withCredentials</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">})</span>
</pre></div></div>

<p>毎回付けるのが面倒なら↓こうしておいてもよいです。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span><span class="nx">xhrFields</span><span class="o">:</span><span class="p">{</span><span class="nx">withCredentials</span><span class="o">:</span><span class="kc">true</span><span class="p">}});</span>
</pre></div></div>

<h2>
<span id="angularjs1x系の場合" class="fragment"></span><a href="#angularjs1x%E7%B3%BB%E3%81%AE%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>AngularJS(1.x系)の場合</h2>

<p>AngularJSの場合はこんな感じか。</p>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="nx">yourapp</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$httpProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$httpProvider</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</pre></div></div>

<h2>
<span id="xmlhttprequest-を直接使う場合" class="fragment"></span><a href="#xmlhttprequest-%E3%82%92%E7%9B%B4%E6%8E%A5%E4%BD%BF%E3%81%86%E5%A0%B4%E5%90%88"><i class="fa fa-link"></i></a>XMLHttpRequest を直接使う場合</h2>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</pre></div></div>

<h1>
<span id="access-control-allow-origin--は駄目" class="fragment"></span><a href="#access-control-allow-origin--%E3%81%AF%E9%A7%84%E7%9B%AE"><i class="fa fa-link"></i></a>Access-Control-Allow-Origin: * は駄目</h1>

<p>クレデンシャルを必要とするリクエストの場合、Access-Control-Allow-Originにワイルドカードは使えまえん。キチンと許可オリジンを指定しましょう。</p>

<p>そうは言ってもワイルドカード的に受け付けたい場合はあるので手軽に.htaccessで何とかする設定メモ。これは送られてきたOriginを許可オリジンとしてオウム返しする設定です。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">.htaccess</span></div>
<div class="highlight"><pre><span></span>RewriteCond %{HTTP:Origin} (.+)
RewriteRule . - [E=CORS_ORIGIN:%1]
Header set Access-Control-Allow-Origin %{CORS_ORIGIN}e env=CORS_ORIGIN
</pre></div>
</div>

<p>CORSアクセスを許可するOriginを限定したいなら↓こんな風に書いてやればOK</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">.htaccess</span></div>
<div class="highlight"><pre><span></span>RewriteCond %{HTTP:Origin} (https?://([a-zA-Z0-9\-\.]+\.)?(example\.com|example\.jp)(:[0-9]+)?)$
RewriteRule . - [E=CORS_ORIGIN:%1]
Header set Access-Control-Allow-Origin %{CORS_ORIGIN}e env=CORS_ORIGIN
</pre></div>
</div>

<h1>
<span id="access-control-allow-credentials-true-も付けましょう" class="fragment"></span><a href="#access-control-allow-credentials-true-%E3%82%82%E4%BB%98%E3%81%91%E3%81%BE%E3%81%97%E3%82%87%E3%81%86"><i class="fa fa-link"></i></a>Access-Control-Allow-Credentials: true も付けましょう</h1>

<p>クレデンシャルを必要とする場合はこのヘッダがないとブラウザはレスポンスを捨ててしまうのでセットで付けておきましょう。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">.htaccess</span></div>
<div class="highlight"><pre><span></span>Header set Access-Control-Allow-Credentials true
</pre></div>
</div>

<h1>
<span id="その他基本のキ" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E5%9F%BA%E6%9C%AC%E3%81%AE%E3%82%AD"><i class="fa fa-link"></i></a>その他基本のキ</h1>

<p>よく使うヘッダのコピペ用設定。アプリのフレームワークによっては X-Csrftoken ヘッダも通しておくなど。</p>

<p>ベタ書き版</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">.htaccess</span></div>
<div class="highlight"><pre><span></span>Header set Access-Control-Allow-Methods "GET, PUT, POST, DELETE, HEAD, OPTIONS"
Header set Access-Control-Allow-Headers "X-Requested-With, Origin, X-Csrftoken, Content-Type, Accept"
</pre></div>
</div>

<h2>
<span id="クライアントのリクエストに合わせて許可する版" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%AE%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%81%AB%E5%90%88%E3%82%8F%E3%81%9B%E3%81%A6%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B%E7%89%88"><i class="fa fa-link"></i></a>クライアントのリクエストに合わせて許可する版</h2>

<div class="code-frame" data-lang="apacheconf">
<div class="code-lang"><span class="bold">httpd.conf</span></div>
<div class="highlight"><pre><span></span><span class="c"># CORS対応</span>

<span class="c">## Originの許可（オウム返し）</span>
<span class="nb">RewriteCond</span> %{HTTP:Origin} (https?://([a-z0-9\-\.]+\.)?example\.com)$
<span class="nb">RewriteRule</span> . - [E=CORS_ORIGIN:%1]
<span class="nb">Header</span> set Access-Control-Allow-Origin %{CORS_ORIGIN}e env=CORS_ORIGIN

<span class="c">## リクエストメソッドの利用許可（オウム返し）</span>
<span class="nb">RewriteCond</span> %{ENV:CORS_ORIGIN} ^http
<span class="nb">RewriteCond</span> %{HTTP:Access-Control-Request-Method} ^([A-Z]+)$
<span class="nb">RewriteRule</span> . - [E=CORS_METHOD:%1,E=CORS_PREFLIGHT:1]
<span class="nb">Header</span> set Access-Control-Allow-Methods <span class="s2">"GET, POST, HEAD, OPTIONS, %{CORS_METHOD}e"</span> env=CORS_METHOD

<span class="c">## リクエストヘッダの利用許可（オウム返し）</span>
<span class="nb">RewriteCond</span> %{ENV:CORS_ORIGIN} ^http
<span class="nb">RewriteCond</span> %{HTTP:Access-Control-Request-Headers} <span class="s2">"^([a-zA-Z0-9-]+(, ?[a-zA-Z0-9-]+)*)$"</span>
<span class="nb">RewriteRule</span> . - [E=CORS_HEADERS:%1,E=CORS_PREFLIGHT:1]
<span class="nb">Header</span> set Access-Control-Allow-Headers <span class="s2">"%{CORS_HEADERS}e"</span> env=CORS_HEADERS

<span class="c">## レスポンスヘッダの利用許可</span>
<span class="c"># Header set Access-Control-Expose-Headers "* or X-Hoge, X-Fuga" env=CORS_ORIGIN</span>

<span class="c">## クレデンシャルの送信許可（クッキー,Authorizationヘッダ）</span>
<span class="c"># Header set Access-Control-Allow-Credentials true env=CORS_ORIGIN</span>

<span class="c">## CORS許可のキャッシュ（プリフライトリクエストを暫く投げない許可）</span>
<span class="nb">Header</span> set Access-Control-Max-Age <span class="s2">"3600"</span> env=CORS_PREFLIGHT
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />8位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>152</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/5f03dde3c219bdbffc3b">Feedly APIメモ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-12 15:49:13</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Feedly]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>多分現在主流のRSSリーダーであるFeedlyが少し前にようやくAPIを公開してくれたので、オレオレリーダーを作る為の下調べをしてみた。最初戸惑ったが色々API叩いてるうちに大体わかってきたのでメモる。</p>

<p>APIドキュメント: <a href="http://developer.feedly.com/v3/" class="autolink" rel="nofollow noopener" target="_blank">http://developer.feedly.com/v3/</a></p>

<h1>
<span id="idの種類と形式" class="fragment"></span><a href="#id%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%A8%E5%BD%A2%E5%BC%8F"><i class="fa fa-link"></i></a>IDの種類と形式</h1>

<ul>
<li>userId - <code>user/:userId</code>
</li>
<li>feedId - <code>feed/:feedUri</code>
</li>
<li>categoryId - <code>:userId/category/:categoryName</code>

<ul>
<li>特殊カテゴリ: <code>global.all</code>, <code>global.uncategorized</code>
</li>
</ul>
</li>
<li>tagId - <code>:userId/tag/:tagName</code>

<ul>
<li>特殊タグ: <code>global.saved</code>
</li>
</ul>
</li>
</ul>

<h1>
<span id="認証手順" class="fragment"></span><a href="#%E8%AA%8D%E8%A8%BC%E6%89%8B%E9%A0%86"><i class="fa fa-link"></i></a>認証手順</h1>

<ul>
<li>普通のOAuth2.0だが現在は<code>redirect_uri</code>が制限されているためサイト間認証は使えない。</li>
<li>
<code>http://localhost</code>や<code>urn:ietf:wg:oauth:2.0:oob</code>は許可されてるのでローカルアプリで使う分にはとりあえず問題ない。</li>
<li>OAuthのプロセス中に出てくるclient_idだのclient_secretだのは全部Sandbox用の固定値を使えばとりあえず自分のアクセストークンを取る分には問題ない。</li>
</ul>

<h2>
<span id="やってみる" class="fragment"></span><a href="#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>やってみる</h2>

<ol>
<li>
<a href="https://cloud.feedly.com/v3/auth/auth?client_id=feedly&amp;redirect_uri=http://localhost&amp;scope=https://cloud.feedly.com/subscriptions&amp;response_type=code&amp;provider=google&amp;migrate=false" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.feedly.com/v3/auth/auth?client_id=feedly&amp;redirect_uri=http://localhost&amp;scope=https://cloud.feedly.com/subscriptions&amp;response_type=code&amp;provider=google&amp;migrate=false</a>
をブラウザで開く。（パラメータは全部固定でOK）</li>
<li>認証後 <code>http://localhost/?code=XXX&amp;state=</code> に飛ばされるのでアドレスバーから <code>XXX</code> の部分をコピーする。</li>
<li><p><a href="https://cloud.feedly.com/v3/auth/token" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.feedly.com/v3/auth/token</a> へ <code>client_id=feedly&amp;client_secret=0XP4XQ07VVMDWBKUHTJM4WUQ&amp;grant_type=authorization_code&amp;redirect_uri=http%3A%2F%2Fwww.feedly.com%2Ffeedly.html&amp;code=XXX</code> の最後のXXX部分を先ほど取得したcodeの値で置き換えたものをPOSTする。こんな感じ＞<code>$ curl -s -d 'client_id=feedly&amp;client_secret=0XP4XQ07VVMDWBKUHTJM4WUQ&amp;grant_type=authorization_code&amp;redirect_uri=http%3A%2F%2Fwww.feedly.com%2Ffeedly.html&amp;code=XXX' https://cloud.feedly.com/v3/auth/token</code></p></li>
<li><p>おなじみのaccess_tokenとrefresh_tokenがとれるので以降のAPIリクエストにはここで取得した<code>access_foken</code>の値をヘッダに付けて行うようにする。</p></li>
<li><p>使用例はこんな感じ＞<code>$ curl -s -H 'Authorization: Bearer ACCESS_TOKEN' https://cloud.feedly.com/v3/profile</code> （ACCESS_TOKENには3で取得したaccess_tokenの値で置き換え）</p></li>
</ol>

<h1>
<span id="profile" class="fragment"></span><a href="#profile"><i class="fa fa-link"></i></a>Profile</h1>

<ul>
<li>ユーザプロファイルを取得する</li>
</ul>

<p><a href="https://cloud.feedly.com/v3/profile" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.feedly.com/v3/profile</a></p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"fullName"</span><span class="p">:</span> <span class="s2">"Yoshiaki Kawazu"</span><span class="p">,</span>
  <span class="nt">"locale"</span><span class="p">:</span> <span class="s2">"ja"</span><span class="p">,</span>
  <span class="nt">"picture"</span><span class="p">:</span> <span class="s2">"https://lh3.googleusercontent.com/-ECJgMVZ8twg/AAAAAAAAAAI/AAAAAAAAAVM/vdZM4-BFTMs/photo.jpg"</span><span class="p">,</span>
  <span class="nt">"gender"</span><span class="p">:</span> <span class="s2">"male"</span><span class="p">,</span>
  <span class="nt">"email"</span><span class="p">:</span> <span class="s2">"kawazzz@gmail.com"</span><span class="p">,</span>
  <span class="nt">"google"</span><span class="p">:</span> <span class="s2">"107778016735353586604"</span><span class="p">,</span>
  <span class="nt">"givenName"</span><span class="p">:</span> <span class="s2">"Yoshiaki"</span><span class="p">,</span>
  <span class="nt">"familyName"</span><span class="p">:</span> <span class="s2">"Kawazu"</span><span class="p">,</span>
  <span class="nt">"client"</span><span class="p">:</span> <span class="s2">"feedly"</span><span class="p">,</span>
  <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"43d020e7-87a7-4e7f-a8e9-cacb54acd1b5"</span><span class="p">,</span>
  <span class="nt">"wave"</span><span class="p">:</span> <span class="s2">"2013.11"</span><span class="p">,</span>
  <span class="nt">"windowsLiveConnected"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">"wordPressConnected"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">"facebookConnected"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">"reader"</span><span class="p">:</span> <span class="s2">"01581900768824391990"</span><span class="p">,</span>
  <span class="nt">"evernoteConnected"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">"pocketConnected"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">"twitterConnected"</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="markers" class="fragment"></span><a href="#markers"><i class="fa fa-link"></i></a>Markers</h1>

<h2>
<span id="markerscounts" class="fragment"></span><a href="#markerscounts"><i class="fa fa-link"></i></a>markers/counts</h2>

<ul>
<li>フィードの未読数が取得できる</li>
<li>登録してるfeedが全て取得できるっぽい</li>
<li>フィードカテゴリやALLなどの特殊なidのやつも返ってくる</li>
</ul>

<p><a href="https://cloud.feedly.com/v3/markers/counts" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.feedly.com/v3/markers/counts</a></p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"unreadcounts"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"updated"</span><span class="p">:</span> <span class="mi">1394598427423</span><span class="p">,</span>
      <span class="nt">"count"</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"feed/http://feedproxy.google.com/hatena/b/hotentry"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"updated"</span><span class="p">:</span> <span class="mi">1394137265230</span><span class="p">,</span>
      <span class="nt">"count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"feed/http://aws.amazon.com/rss/whats-new.rss"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"updated"</span><span class="p">:</span> <span class="mi">1394599287257</span><span class="p">,</span>
      <span class="nt">"count"</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/global.all"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"updated"</span><span class="p">:</span> <span class="mi">1394599287257</span><span class="p">,</span>
      <span class="nt">"count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/知り合い"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"updated"</span><span class="p">:</span> <span class="mi">1394582230100</span><span class="p">,</span>
      <span class="nt">"count"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/エロ"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"updated"</span><span class="p">:</span> <span class="mi">1394599287257</span><span class="p">,</span>
      <span class="nt">"count"</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/global.uncategorized"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="stream" class="fragment"></span><a href="#stream"><i class="fa fa-link"></i></a>Stream</h1>

<h2>
<span id="streamsids" class="fragment"></span><a href="#streamsids"><i class="fa fa-link"></i></a>streams/ids</h2>

<ul>
<li>ストリームIDにぶら下がったエントリのID一覧を取得する。</li>
<li>取得済みエントリIDはキャッシュしておき新着チェックに使うのが目的のAPIと思われ。

<ul>
<li>コンテンツまで一発で取得したい場合は<code>streams/contents</code>を使えば良い。</li>
<li>エントリIDからコンテンツを取得するには<code>entries/:entryId</code>もしくは<code>entries/.mget</code>を使う。</li>
</ul>
</li>
<li>streamIdに指定できるのは<code>categoryId</code> <code>feedId</code> <code>tagId</code>のどれか。</li>
<li>
<code>streams/:streamId/ids</code>というURLも使えるとドキュメントにあったがクエリで渡しても良い。

<ul>
<li>
<code>:streamId</code>の部分に埋める場合は必ず、ID中の<code>/</code>も含めてURLエンコードしておく必要がある。</li>
</ul>
</li>
</ul>

<p><a href="https://cloud.feedly.com/v3/streams/ids?streamId=user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/global.all&amp;count=5" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.feedly.com/v3/streams/ids?streamId=user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/global.all&amp;count=5</a><br>
または<br>
<a href="https://cloud.feedly.com/v3/streams/user%2F43d020e7-87a7-4e7f-a8e9-cacb54acd1b5%2Fcategory%2Fglobal.all/ids?count=5" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.feedly.com/v3/streams/user%2F43d020e7-87a7-4e7f-a8e9-cacb54acd1b5%2Fcategory%2Fglobal.all/ids?count=5</a></p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"ids"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"vd6/vZ0gPFJR0iUi25Q38MITxKq1RRhf/pxYrAJpSMQ=_144b479e861:7f050e:5f76ba1"</span><span class="p">,</span>
    <span class="s2">"RkLxQmvOp/nc7DIgnc7qmGmho0aOcNwtk5qewRZKloo=_144b47765db:78700b:57158c7e"</span><span class="p">,</span>
    <span class="s2">"SzCknK5yCfKi0NrRCLzY3clkPWypMPSgdsVAzzPiIEk=_144b472c945:1f479:3a1395db"</span><span class="p">,</span>
    <span class="s2">"gHDibUzBXqLZr4i7DfbTJIWTMbq4x72ysmvnyHLsh54=_144b46fc344:768b12:57158c7e"</span><span class="p">,</span>
    <span class="s2">"gHDibUzBXqLZr4i7DfbTJIWTMbq4x72ysmvnyHLsh54=_144b46fc344:768b11:57158c7e"</span>
  <span class="p">],</span>
  <span class="nt">"continuation"</span><span class="p">:</span> <span class="s2">"144b46fc344:768b11:57158c7e"</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="streamscontents" class="fragment"></span><a href="#streamscontents"><i class="fa fa-link"></i></a>streams/contents</h2>

<ul>
<li>ストリームIDにぶら下がったエントリのコンテンツ一覧を取得する。</li>
<li>streamIdに指定できるのは<code>categoryId</code> <code>feedId</code> <code>tagId</code>のどれか。</li>
<li>
<code>streams/:streamId/contents</code>というURLも使えるとドキュメントにあったがクエリで渡しても良い。

<ul>
<li>
<code>:streamId</code>の部分に埋める場合は必ず、ID中の<code>/</code>も含めてURLエンコードしておく必要がある。</li>
</ul>
</li>
</ul>

<p><a href="https://cloud.feedly.com/v3/streams/contents?streamId=user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/global.all&amp;count=2" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.feedly.com/v3/streams/contents?streamId=user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/global.all&amp;count=2</a><br>
または<br>
<a href="https://cloud.feedly.com/v3/streams/user%2F43d020e7-87a7-4e7f-a8e9-cacb54acd1b5%2Fcategory%2Fglobal.all/contents?count=2" class="autolink" rel="nofollow noopener" target="_blank">https://cloud.feedly.com/v3/streams/user%2F43d020e7-87a7-4e7f-a8e9-cacb54acd1b5%2Fcategory%2Fglobal.all/contents?count=2</a></p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"items"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"engagementRate"</span><span class="p">:</span> <span class="mf">0.36</span><span class="p">,</span>
      <span class="nt">"engagement"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="nt">"crawled"</span><span class="p">:</span> <span class="mi">1394598626006</span><span class="p">,</span>
      <span class="nt">"author"</span><span class="p">:</span> <span class="s2">"jniino"</span><span class="p">,</span>
      <span class="nt">"summary"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"direction"</span><span class="p">:</span> <span class="s2">"ltr"</span><span class="p">,</span>
        <span class="nt">"content"</span><span class="p">:</span> <span class="s2">"光ネットワークや無線ネットワーク、パケット通信など種類の異なる複数のネットワーク..."</span>
      <span class="p">},</span>
      <span class="nt">"content"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"direction"</span><span class="p">:</span> <span class="s2">"ltr"</span><span class="p">,</span>
        <span class="nt">"content"</span><span class="p">:</span> <span class="s2">"光ネットワークや無線ネットワーク、パケット通信など種類の異なる複数のネットワークの情報を統一的に定義し、上位レイヤから簡単に扱えるようにしたSoftware-Defined Networkingの技術を、NTT、NTTコム、富士通、日立、NECが共同で発表しました。 これにより通信事業者などが広域にわたる複数のネットワークを柔軟に組み合わせて仮想ネットワークを構築しつつ、全体の状況を把握したり、各レイヤのネットワーク装置を連係させることで、要求に応じたネットワークの設計、構築……"</span>
      <span class="p">},</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"/4r8BU2nbsgJrgfRKK3amXnaOxpprjCJvWjoCKjAPwY=_144b48e42d6:852591:5f76ba1"</span><span class="p">,</span>
      <span class="nt">"originId"</span><span class="p">:</span> <span class="s2">"tag:www.publickey1.jp,2014://2.2804"</span><span class="p">,</span>
      <span class="nt">"keywords"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"blog"</span><span class="p">,</span>
        <span class="s2">"Software-Defined Network"</span><span class="p">,</span>
        <span class="s2">"ネットワーク"</span>
      <span class="p">],</span>
      <span class="nt">"fingerprint"</span><span class="p">:</span> <span class="s2">"9703a9db"</span><span class="p">,</span>
      <span class="nt">"alternate"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"text/html"</span><span class="p">,</span>
          <span class="nt">"href"</span><span class="p">:</span> <span class="s2">"http://www.publickey1.jp/blog/14/software-defined_networkingnttnttnec.html"</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">"title"</span><span class="p">:</span> <span class="s2">"Software-Defined Networkingで広域ネットワークを総合的に扱う基本技術を確立。NTT、NTTコム、富士通、日立、NECが共同で発表"</span><span class="p">,</span>
      <span class="nt">"updated"</span><span class="p">:</span> <span class="mi">1394597056000</span><span class="p">,</span>
      <span class="nt">"published"</span><span class="p">:</span> <span class="mi">1394596984000</span><span class="p">,</span>
      <span class="nt">"origin"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"streamId"</span><span class="p">:</span> <span class="s2">"feed/http://www.publickey1.jp/atom.xml"</span><span class="p">,</span>
        <span class="nt">"title"</span><span class="p">:</span> <span class="s2">"Publickey"</span><span class="p">,</span>
        <span class="nt">"htmlUrl"</span><span class="p">:</span> <span class="s2">"http://www.publickey1.jp/"</span>
      <span class="p">},</span>
      <span class="nt">"sid"</span><span class="p">:</span> <span class="s2">"+d0QLpjFyPQ0+bv2Zs0tZe8M5+yaZXD0xyM5xDZrw6I="</span><span class="p">,</span>
      <span class="nt">"visual"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"none"</span>
      <span class="p">},</span>
      <span class="nt">"unread"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"unread"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nt">"visual"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"none"</span>
      <span class="p">},</span>
      <span class="nt">"origin"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"streamId"</span><span class="p">:</span> <span class="s2">"feed/http://kernel.org/kdist/rss.xml"</span><span class="p">,</span>
        <span class="nt">"title"</span><span class="p">:</span> <span class="s2">"Latest Linux Kernel Versions"</span><span class="p">,</span>
        <span class="nt">"htmlUrl"</span><span class="p">:</span> <span class="s2">"http://www.kernel.org"</span>
      <span class="p">},</span>
      <span class="nt">"fingerprint"</span><span class="p">:</span> <span class="s2">"1870aafa"</span><span class="p">,</span>
      <span class="nt">"originId"</span><span class="p">:</span> <span class="s2">"kernel.org,linux-next,next-20140311,2014-03-12"</span><span class="p">,</span>
      <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"3n4rP10OBRjEEdn8ddzpt3a6rmsfO/6fqgXkJR2bJ5s=_144b48dda3b:850d01:5f76ba1"</span><span class="p">,</span>
      <span class="nt">"summary"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"direction"</span><span class="p">:</span> <span class="s2">"ltr"</span><span class="p">,</span>
        <span class="nt">"content"</span><span class="p">:</span> <span class="s2">"&lt;table&gt;\n&lt;tr&gt;&lt;th align=\"right\"&gt;Version:&lt;/th&gt;&lt;td&gt;&lt;strong&gt;next-20140311&lt;/strong&gt; (linux-next)&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;th align=\"right\"&gt;Released:&lt;/th&gt;&lt;td&gt;2014-03-12&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;"</span>
      <span class="p">},</span>
      <span class="nt">"crawled"</span><span class="p">:</span> <span class="mi">1394598599227</span><span class="p">,</span>
      <span class="nt">"alternate"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"text/html"</span><span class="p">,</span>
          <span class="nt">"href"</span><span class="p">:</span> <span class="s2">"http://www.kernel.org/"</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">"title"</span><span class="p">:</span> <span class="s2">"next-20140311: linux-next"</span><span class="p">,</span>
      <span class="nt">"published"</span><span class="p">:</span> <span class="mi">1394595471000</span>
    <span class="p">},</span>
  <span class="p">],</span>
  <span class="nt">"continuation"</span><span class="p">:</span> <span class="s2">"144b48b3b1f:8441c8:5f76ba1"</span><span class="p">,</span>
  <span class="nt">"updated"</span><span class="p">:</span> <span class="mi">1394598626006</span><span class="p">,</span>
  <span class="nt">"id"</span><span class="p">:</span> <span class="s2">"user/43d020e7-87a7-4e7f-a8e9-cacb54acd1b5/category/global.all"</span>
<span class="p">}</span>
</pre></div></div>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>↑とりあえずこれだけ例を上げとけば普通のRSSリーダは作れそうだな。<br>
最初ALLの内容をどうやって取るのかが分からんくて非常に悩んだ。global.allカテゴリのコンテンツをEntryかStreamから取れば良いまで分かれば後はどうとでもなる。<br>
あとは既読マークとかは Markers に適当にPOSTしとけば良い。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />9位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>124</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/ed0030cb29c7d0497b63">80番ポートへ届いたパケットをiptablesでローカルの上位ポートに転送する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-09 15:28:05</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iptables]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>例えばNode.jsとかで作ったWEBサービスを外部に公開しようとした時に、80番ポートで公開したいけど一般ユーザだと1024番より上のポートしか使えない、かと言ってrootで実行はしたくない。そんなときは iptables でREDIRECTまたはDNATしてしまうのが便利です。</p>

<p>雑然としたメモレベルだけど備忘録として書いておく。</p>

<h1>
<span id="簡単な例" class="fragment"></span><a href="#%E7%B0%A1%E5%8D%98%E3%81%AA%E4%BE%8B"><i class="fa fa-link"></i></a>簡単な例</h1>

<p>3000番ポートで動かしているサービスを80番で公開する例はこんなコマンドを打てはOK。</p>

<div class="code-frame" data-lang="iptables"><div class="highlight"><pre><span></span>iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 3000
</pre></div></div>

<p>設定ファイルに保存する場合はfilterとは別にnatテーブルの設定を追加して↓こんなふうに書けばよいです。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/sysconfig/iptables</span></div>
<div class="highlight"><pre><span></span>*nat
:PREROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
-A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 3000
COMMIT

*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
# filter settings here...
COMMIT
</pre></div>
</div>

<p>で <code>service iptables restart</code> とかしてやれば反映される。</p>

<h1>
<span id="複数ipが割り当てられてるサーバで受けたipによって転送先のローカルポートを変える例" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0ip%E3%81%8C%E5%89%B2%E3%82%8A%E5%BD%93%E3%81%A6%E3%82%89%E3%82%8C%E3%81%A6%E3%82%8B%E3%82%B5%E3%83%BC%E3%83%90%E3%81%A7%E5%8F%97%E3%81%91%E3%81%9Fip%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E8%BB%A2%E9%80%81%E5%85%88%E3%81%AE%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%9D%E3%83%BC%E3%83%88%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B%E4%BE%8B"><i class="fa fa-link"></i></a>複数IPが割り当てられてるサーバで受けたIPによって転送先のローカルポートを変える例</h1>

<p>例えば 10.0.0.80 と 10.0.0.81 のIPを持っていた場合に、10.0.0.81に来たパケットは3001番ポートへ転送、それ以外のIPで受けた場合は3000番ポートへ転送とかする場合は↓こんな風に書けばいいです。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/sysconfig/iptables</span></div>
<div class="highlight"><pre><span></span>*nat
:PREROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
-A PREROUTING -p tcp -d 10.0.0.81 --dport 80 -j REDIRECT --to-port 3001
-A PREROUTING -p tcp              --dport 80 -j REDIRECT --to-port 3000
COMMIT

*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
# filter settings here...
COMMIT
</pre></div>
</div>

<p>こうすることで1台のサーバで開発環境と本番環境を別ポートで使い分けつつ、ポート指定無しのURLでアクセスが出来るようになります。</p>

<h1>
<span id="ローカルプロセスからの通信にも対応する場合はoutputチェーンで書き換える" class="fragment"></span><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%8B%E3%82%89%E3%81%AE%E9%80%9A%E4%BF%A1%E3%81%AB%E3%82%82%E5%AF%BE%E5%BF%9C%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AFoutput%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3%E3%81%A7%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>ローカルプロセスからの通信にも対応する場合はOUTPUTチェーンで書き換える</h1>

<p>上述の設定だと外からきたパケットに対しては上手く働くけどローカルのプロセスで発生したパケットには効きません。ローカルプロセスで発生したパケットはPREROUTINGチェインを通らないからです。代わりにOUTEPUTチェインを通ります。なので外からとローカルからの両方対応しようとすると↓こうなります。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">/etc/sysconfig/iptables</span></div>
<div class="highlight"><pre><span></span>*nat
:PREROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
-A PREROUTING -p tcp -d 10.0.0.81 --dport 80 -j REDIRECT --to-port 3001
-A OUTPUT     -p tcp -d 10.0.0.81 --dport 80 -j REDIRECT --to-port 3001
-A PREROUTING -p tcp -d 10.0.0.80 --dport 80 -j REDIRECT --to-port 3000
-A OUTPUT     -p tcp -d 10.0.0.80 --dport 80 -j REDIRECT --to-port 3000
-A OUTPUT     -p tcp -d 127.0.0.1 --dport 80 -j REDIRECT --to-port 3000
COMMIT

*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
# filter settings here...
COMMIT
</pre></div>
</div>

<p>OUTPUTチェーンで80版を全部書き換えてしまうと外部へのhttpアクセスもできなくなってしまうので、面倒ですが<code>-d</code>で自分のIP全てを列挙した書き換えを行ってやる必要があります。</p>

<h1>
<span id="dnatでも出来る" class="fragment"></span><a href="#dnat%E3%81%A7%E3%82%82%E5%87%BA%E6%9D%A5%E3%82%8B"><i class="fa fa-link"></i></a>DNATでも出来る</h1>

<p>DNATの場合は↓こうなる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination :3000
</pre></div></div>

<p>またDNATの場合はポートと一緒にIPも書き換えることが出来るという違いがある。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 10.0.0.90:3000
</pre></div></div>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p>natテーブルのPREROUTINGチェインがどこに効くかとかは<a href="http://www.atmarkit.co.jp/ait/articles/1002/09/news119.html" rel="nofollow noopener" target="_blank">↓このへんの図</a>とかが分かりやすいです。<br>
<a href="https://camo.qiitausercontent.com/99186062b98098c9e375019df22f87bffb507c56/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f62333766316533392d363532372d303937662d376536652d3536383962313337303332312e6a706567" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/99186062b98098c9e375019df22f87bffb507c56/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f62333766316533392d363532372d303937662d376536652d3536383962313337303332312e6a706567" alt="r10fig01.jpg" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/18726/b37f1e39-6527-097f-7e6e-5689b1370321.jpeg"></a></p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />10位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>104</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/6fd4cd86ca98af644a05">パイプ出力を現在のシェル上のwhileに喰わせる上手いやり方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-31 06:29:17</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ここに書くTipsは、そもそもパイプとwhileにまつわる問題を経験したことないと何を言ってるか分からないと思うのでまず経緯から書く。</p>

<h2>
<span id="よくやる失敗例" class="fragment"></span><a href="#%E3%82%88%E3%81%8F%E3%82%84%E3%82%8B%E5%A4%B1%E6%95%97%E4%BE%8B"><i class="fa fa-link"></i></a>よくやる失敗例</h2>

<p>シェルスクリプトを書いていると以下の様に<code>while</code>と<code>read</code>を組み合わせたコードを書くことがよくあります。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>find -type f <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> -r f<span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> <span class="c1">#ここのコードは色々</span>
<span class="k">done</span>
</pre></div></div>

<p>これはコマンドの標準出力を1行ずつ f という変数に読み込んで何らかの処理を行うってやつです。<br>
whileの中でやることがファイル操作などの一般的なことならこれで全然問題ないんですが、実行中のシェル環境に対する処理（具体的には変数の設定など）を行おうとすると期待通りにいってくれなくなります。例えばこんな感じ↓</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="c1"># findで見つけたファイル名をfilesという配列変数に詰め込みたい</span>
<span class="nv">files</span><span class="o">=()</span>
find -type f <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> -r f<span class="p">;</span> <span class="k">do</span>
  <span class="nv">files</span><span class="o">+=(</span><span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="o">)</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span> <span class="c1"># 確かにfilesに値を入れた筈なのに空が出力される？？</span>
</pre></div></div>

<p>これはパイプで繋げると後ろのwhileがサブシェルで実行されてしまうために起こる現象です。噛み砕いて説明すると…</p>

<ul>
<li>現在findを実行中のbashとは別に、パイプの後ろでもう一つのbashが起動されてその子プロセスのbash上でfiles変数をセットしていることになります。</li>
<li>すると当然、子プロセスが終了(whileの全てが終了)した時点で子bashプロセス上に設定されたfiles変数の中身も消え去ります。</li>
<li>親プロセスのfilesは最初に初期化したままなので空が出力されることになります。</li>
</ul>

<h2>
<span id="解決編" class="fragment"></span><a href="#%E8%A7%A3%E6%B1%BA%E7%B7%A8"><i class="fa fa-link"></i></a>解決編</h2>

<p>これ実は上手い解決策に結構悩みます、パイプしたいのにパイプすると駄目なんだから…あーもー。となって、んで一時ファイルを作ってから &lt;tmpfile とかで標準入力に流しこでとりあえず解決しちゃったりするわけです。ですがそうすると一時ファイルの後処理をしなくちゃいけないし見た目も汚いしでやっぱ気持ち悪いです。</p>

<p>そこで登場するのが <a href="http://qiita.com/items/98768ba5eea8d6fe6a19">Process Substitution</a> という機能です。よく2つのコマンドの標準出力のdiffを取るとかの例で紹介されてるやつです。この機能が今回のwhile問題にも活用出来ます。<br>
まずは上述の失敗例を解決したコードを書いてから説明します。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="c1"># findで見つけたファイル名をfilesという配列変数に詰め込みたい</span>
<span class="nv">files</span><span class="o">=()</span>
<span class="k">while</span> <span class="nb">read</span> -r f<span class="p">;</span> <span class="k">do</span>
  <span class="nv">files</span><span class="o">+=(</span><span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span><span class="o">)</span>
<span class="k">done</span> &lt; &lt;<span class="o">(</span>find -type f<span class="o">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">files</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span> <span class="c1"># 期待通りファイル名の一覧が出力される！</span>
</pre></div></div>

<p>まぁ見たまんまですが、結構これが思いつかないんですよね(^^;</p>

<p>ただし1つだけ注意点があって、標準入力に突っ込む<code>&lt; &lt;(...)</code>のところですが<code>&lt;</code>と<code>&lt;(...)</code>の間にスペースを空けてるのが重要です。この空白が無いと<code>&lt;&lt;</code>がヒアドキュメントの開始と解釈されてエラーになってしまいます。それさえ気をつければOKです。</p>

<p>まぁ、シェルスクリプト書きまくってる人でもなければあまり使うケースは無いかもしれませんが、覚えておくと便利です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />11位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>89</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/6a22c2c970c8d932a3a1">XHR2でサブドメインのワイルドカードOriginに対してCORSを許可する設定、他。</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-09-10 14:04:51</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[HTTP]</b> <b>[CORS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="はじめに" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fa fa-link"></i></a>はじめに</h1>

<p>今どきのブラウザはではルールに従うことでクロスドメイン(クロスオリジン)のAJAXが出来ます。ルールというのは最低限、AJAXで取得するデータがある先のサーバが<code>Access-Control-Allow-Origin</code>ヘッダを返すことです。</p>

<p>ただしこの仕様には関連ヘッダがやたら沢山あるので、やりたいことにたいして適切な設定するには記事後半の関連ヘッダまとめまで目を通しておくことをおすすめします。</p>

<h1>
<span id="単純なケースの-htaccess-による設定例オリジンの許可例" class="fragment"></span><a href="#%E5%8D%98%E7%B4%94%E3%81%AA%E3%82%B1%E3%83%BC%E3%82%B9%E3%81%AE-htaccess-%E3%81%AB%E3%82%88%E3%82%8B%E8%A8%AD%E5%AE%9A%E4%BE%8B%E3%82%AA%E3%83%AA%E3%82%B8%E3%83%B3%E3%81%AE%E8%A8%B1%E5%8F%AF%E4%BE%8B"><i class="fa fa-link"></i></a>単純なケースの .htaccess による設定例（オリジンの許可例）</h1>

<p>これらの設定サンプルは認証を必要としないシンプルなGETリクエストでCORSを行う為の設定です。</p>

<h2>
<span id="全て許可" class="fragment"></span><a href="#%E5%85%A8%E3%81%A6%E8%A8%B1%E5%8F%AF"><i class="fa fa-link"></i></a>全て許可</h2>

<p>一番簡単なのは以下のような設定です。これを .htaccess ファイルに書いておけばそのサイト上のコンテンツは他サイトから取得し放題ということになります。</p>

<div class="code-frame" data-lang="apache"><div class="highlight"><pre><span></span><span class="nb">Header</span> set Access-Control-Allow-Origin <span class="s2">"*"</span>
</pre></div></div>

<h2>
<span id="特定ドメインからのajax取得を許可" class="fragment"></span><a href="#%E7%89%B9%E5%AE%9A%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%8B%E3%82%89%E3%81%AEajax%E5%8F%96%E5%BE%97%E3%82%92%E8%A8%B1%E5%8F%AF"><i class="fa fa-link"></i></a>特定ドメインからのAJAX取得を許可</h2>

<p>自分が管理している一つないしは数個程度のドメインからのみAJAX取得を許可したい場合は以下のようにします。</p>

<div class="code-frame" data-lang="apache"><div class="highlight"><pre><span></span><span class="nb">Header</span> set Access-Control-Allow-Origin <span class="s2">"http://www.example.jp"</span>
</pre></div></div>

<p>数個程度のオリジンであれば以下のように空白区切りで列挙可能です。</p>

<div class="code-frame" data-lang="apache"><div class="highlight"><pre><span></span><span class="nb">Header</span> set Access-Control-Allow-Origin <span class="s2">"http://www.example.jp https://www.example.jp http://sub.example.jp"</span>
</pre></div></div>

<h2>
<span id="特定サブドメインからのajax取得を許可" class="fragment"></span><a href="#%E7%89%B9%E5%AE%9A%E3%82%B5%E3%83%96%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%8B%E3%82%89%E3%81%AEajax%E5%8F%96%E5%BE%97%E3%82%92%E8%A8%B1%E5%8F%AF"><i class="fa fa-link"></i></a>特定サブドメインからのAJAX取得を許可</h2>

<p>これはちょっと面倒です。　<code>*.example.jp</code> といった値が指定できれば良いのですが、仕様では <a href="http://www.example.jp" class="autolink" rel="nofollow noopener" target="_blank">http://www.example.jp</a> などといった完全な形のオリジンか、全部許可の<code>*</code>か、全部拒否の<code>null</code> しか指定することが出来ず、部分的なワイルドカードは許可されていません。<br>
なので仕方がないので mod_rewrite を使って以下のように対応します。</p>

<h3>
<span id="簡易版" class="fragment"></span><a href="#%E7%B0%A1%E6%98%93%E7%89%88"><i class="fa fa-link"></i></a>簡易版</h3>

<p>以下の設定は<code>*.example.jp</code>への許可と同じように動作します。ホントは受け取ったOriginをそのまま返してやってもいいのですが、どうせRewriteCondで既に制限されている部分なのでとりあえず<code>*</code>を返して済ましています。</p>

<div class="code-frame" data-lang="apache"><div class="highlight"><pre><span></span><span class="nb">RewriteCond</span> %{HTTP:Origin} \.example\.jp$
<span class="nb">RewriteRule</span> . - [E=CORS_OK:1]
<span class="nb">Header</span> set Access-Control-Allow-Origin <span class="s2">"*"</span> env=CORS_OK
</pre></div></div>

<h3>
<span id="クレデンシャルcookieとかbasic認証対応版" class="fragment"></span><a href="#%E3%82%AF%E3%83%AC%E3%83%87%E3%83%B3%E3%82%B7%E3%83%A3%E3%83%ABcookie%E3%81%A8%E3%81%8Bbasic%E8%AA%8D%E8%A8%BC%E5%AF%BE%E5%BF%9C%E7%89%88"><i class="fa fa-link"></i></a>クレデンシャル(CookieとかBASIC認証)対応版</h3>

<p>クレデンシャルを必要とする場合は<code>*</code>での許可は使えないので注意が必要です。やっぱりキチンと許可オリジンを明記してやる必要があります。以下は送られてきたOriginを許可オリジンとしてオウム返しする設定です。これならクレデンシャルを扱う場合も対応できてベストですね。</p>

<div class="code-frame" data-lang="apache"><div class="highlight"><pre><span></span><span class="nb">RewriteCond</span> %{HTTP:Origin} (.+\.example\.jp)$
<span class="nb">RewriteRule</span> . - [E=CORS_ORIGIN:%1]
<span class="nb">Header</span> set Access-Control-Allow-Origin %{CORS_ORIGIN}e env=CORS_ORIGIN
</pre></div></div>

<h1>
<span id="その他" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E4%BB%96"><i class="fa fa-link"></i></a>その他</h1>

<h2>
<span id="関連ヘッダー" class="fragment"></span><a href="#%E9%96%A2%E9%80%A3%E3%83%98%E3%83%83%E3%83%80%E3%83%BC"><i class="fa fa-link"></i></a>関連ヘッダー</h2>

<p>シンプルなGETだけなら↑これだけでよいですが、認証用のCookieを受け入れたりPOSTメソッドを受け入れたりも出来るようにしたりなどを考えてるなら、他にも以下のヘッダについても学んでおく必要があります。必要になったら調べましょう。</p>

<ul>
<li>
<p>オリジンチェック (これは上で説明した)</p>

<ul>
<li>
<code>Origin</code> Request Header (オリジンを伝える、これはCORSの際にブラウザが自動で送信するものでJSによる指定は出来ない)</li>
<li>
<code>Access-Control-Allow-Origin</code> Response Header (許可オリジンを列挙、半角空白区切り)</li>
<li>これらが一致しないと、仮にコンテンツが返ってきたとしてもブラウザはレスポンスを捨てるため使用できない。</li>
</ul>
</li>
<li>
<p>クレデンシャルチェック(Cookie,BASIC認証ヘッダの使用許可、更にJS側はxhr.withCredentials=trueも必要)</p>

<ul>
<li>
<code>Access-Control-Allow-Credentials</code> Response Header (クレデンシャル情報の使用許可を true|false で返す)</li>
<li>認証が必要なコンテンツを取得する場合に必要な手順。</li>
<li>この許可が無いと、仮にコンテンツが返ってきたとしてもブラウザはレスポンスを捨てるため使用できない。</li>
</ul>
</li>
<li>
<p>メソッドチェック(GET以外のメソッドを使いたい場合はプリフライトリクエストで確認が入る)</p>

<ul>
<li>
<code>Access-Control-Request-Method</code> Request Header (使用希望メソッドを一つだけ表明)</li>
<li>
<code>Access-Control-Allow-Methods</code> Response Header (使用可能メソッドを全て列挙して返す)</li>
<li>これらが一致しないと、ブラウザは実際のリクエストを行わない。</li>
</ul>
</li>
<li>
<p>レスポンスヘッダの使用許可（プリフライトリクエストで確認が入る）</p>

<ul>
<li>
<code>Access-Control-Request-Headers</code> Request Header (使用希望リクエストヘッダ名を表明、カンマ区切り)</li>
<li>
<code>Access-Control-Allow-Headers</code> Response Header (使用希望されたヘッダ名を列挙して許可する、カンマ区切り)</li>
<li>
<code>Access-Control-Expose-Headers</code> Response Header (↑に関係なく使用可能なリクエストヘッダをサーバが列挙、カンマ区切り)</li>
<li>これらが一致しないと、ブラウザは実際のリクエストを行わない？もしくはそのヘッダを送らない？（要確認）</li>
</ul>
</li>
<li>
<p>プリフライトリクエストのレスポンスに対するキャッシュ許可</p>

<ul>
<li>
<code>Access-Control-Max-Age</code> Response Header (プリフライトリクエスト結果のキャッシュ可能期限を秒数で指示)</li>
<li>繰り返し行われるCORSリクエスト毎にプリフライトリクエストするのはちょっと無駄だしね。</li>
</ul>
</li>
</ul>

<h2>
<span id="jquery-でcorsするするときにやるべきこと" class="fragment"></span><a href="#jquery-%E3%81%A7cors%E3%81%99%E3%82%8B%E3%81%99%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AB%E3%82%84%E3%82%8B%E3%81%B9%E3%81%8D%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>jQuery でCORSするするときにやるべきこと。</h2>

<ul>
<li>
<code>$.support.cors = true;</code> をajax実行前にセットしておく。これやらないとそもそもCORS出来ません。</li>
<li>それからクレデンシャル使う場合はajaxオプションに<code>xhrFields: {withCredentials: true}</code>も追加しておく。認証情報を使わない/使いたくない場合は指定不要。</li>
</ul>

<h1>
<span id="参考リンク" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF"><i class="fa fa-link"></i></a>参考リンク</h1>

<ul>
<li><a href="http://www.w3.org/TR/cors/" class="autolink" rel="nofollow noopener" target="_blank">http://www.w3.org/TR/cors/</a></li>
<li><a href="https://developer.mozilla.org/ja/docs/HTTP_access_control" class="autolink" rel="nofollow noopener" target="_blank">https://developer.mozilla.org/ja/docs/HTTP_access_control</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />12位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>85</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/00a4b1693bf4cf67e8ca">readするときはIFS=を付けておくとstrictな感じで気持ちが良い</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-31 07:43:22</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><code>while read</code>するなら<code>while IFS= read</code>した方が良いかもよっていう話です。</p>

<p>説明は後にして、まずはlsしたファイル名をechoする例で違いを見てみます。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ touch " abc  " "ho  ge" $'\txyz' #3つのファイルを作成します

## 普通にwhile readした場合
$ ls | while read f; do echo "[$f]"; done
[xyz]
[abc]
[ho  ge]

## IFS= を付けた場合
$ ls | while IFS= read f; do echo "[$f]"; done
[   xyz]
[ abc  ]
[ho  ge]
</pre></div></div>

<p>違いは一目瞭然ですね。単にreadをした場合は、前後のタブや空白が全て消えてしまっていますが、IFS= をつけた場合はタブや空白もオリジナルのまま読み込めています。ちなみに <em>ho  ge</em> の間は空白2つなんですが中にある空白文字はIFS関係なしにそのまま残ります。</p>

<h2>
<span id="解説" class="fragment"></span><a href="#%E8%A7%A3%E8%AA%AC"><i class="fa fa-link"></i></a>解説</h2>

<p>ここで登場した<code>IFS</code>ってのはbashの環境変数で、デフォルトでは<code>$' ¥t¥n'</code>(スペース・タブ・改行)が入っています。bashはこれらの文字を単語の区切りとして認識することになっており、結構色んな所で使われている値です。<br>
普段意識することは少ないですが、この存在を忘れているとイリーガルなケースに出会ったときに痛い目を見ることになるので頭の片隅で常に意識しておいたほうが良いでしょう。</p>

<p>さて上記の例の説明ですが、前者の例では前後の半角スペースとタブがIFSに含まれるために消されてしまっています。後者は勝手に文字を消されるのを防ぐために<code>IFS=</code>を付けてIFSに空文字を代入した状態でreadを実行させています。そのおかげで変数には無加工の値を得ることが出来ました。</p>

<h2>
<span id="注意" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F"><i class="fa fa-link"></i></a>注意</h2>

<p>ちなみに IFS= をやるのは基本 IFS= read foo のようにコマンドの前に付けてコマンドと一緒に実行するようにしておきましょう。<br>
もし普通に IFS= とだけ書いて現在のシェルの変数自体をを変更してしまうと、デフォルトに想定していた挙動が変わってしまうため、色んな部分で想定外の不具合が出てくる可能性がありますので注意です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />13位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>83</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/b82da76ac93b32ddc364">Bashの配列でjoinやsplitする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-31 15:26:21</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>※ここに書いた僕のコードはBashの基本ルールを確認しながら構築した手法って感じですが、コメントでは別の良いやり方が紹介されてるのでそちらも要チェックです！</p>

<p>※この記事の手法は、区切り文字が1文字のみが対象です。2文字以上の区切り文字でjoin/splitをしたい場合はこの記事の手法は使えないので他の方法を頑張ってください。</p>

<h1>
<span id="join" class="fragment"></span><a href="#join"><i class="fa fa-link"></i></a>join</h1>

<p>多分一番スマートと思われる方法。<code>IFS</code>変更の影響をサブシェルに閉じ込めて捨ててるのがポイント。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">join-example.sh</span></div>
<div class="highlight"><pre><span></span><span class="nv">arr</span><span class="o">=(</span>a <span class="s2">"b c"</span> <span class="s1">$'d\ne'</span> f<span class="o">)</span>

<span class="c1"># join実行</span>
<span class="nv">str</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span><span class="nv">IFS</span><span class="o">=</span>,<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="si">${</span><span class="nv">arr</span><span class="p">[*]</span><span class="si">}</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span>

<span class="c1"># 確認</span>
<span class="nb">echo</span> <span class="s2">"=== before ==="</span>
<span class="k">for</span> v in <span class="s2">"</span><span class="si">${</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"[</span><span class="nv">$v</span><span class="s2">]"</span>
<span class="k">done</span>
<span class="nb">echo</span> <span class="s2">"=== after ==="</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$str</span><span class="s2">"</span>
</pre></div>
</div>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">output</span></div>
<div class="highlight"><pre><span></span>=== before ===
[a]
[b c]
[d
e]
[f]
=== after ===
a,b c,d
e,f
</pre></div>
</div>

<h1>
<span id="split" class="fragment"></span><a href="#split"><i class="fa fa-link"></i></a>split</h1>

<p>splitをスマートに書くのは無理ぽいので、普通に<code>IFS</code>を一時退避して戻すという手順をとる。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">split-example.sh</span></div>
<div class="highlight"><pre><span></span><span class="nv">str</span><span class="o">=</span><span class="s1">$'a,b c,d\ne,f'</span>

<span class="c1"># split実行</span>
<span class="nv">IFS_ORIGINAL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$IFS</span><span class="s2">"</span>
<span class="nv">IFS</span><span class="o">=</span>,
<span class="nv">arr</span><span class="o">=(</span><span class="nv">$str</span><span class="o">)</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$IFS_ORIGINAL</span><span class="s2">"</span>

<span class="c1"># 確認</span>
<span class="nb">echo</span> <span class="s2">"=== before ==="</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$str</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"=== after ==="</span>
<span class="k">for</span> v in <span class="s2">"</span><span class="si">${</span><span class="nv">arr</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">"[</span><span class="nv">$v</span><span class="s2">]"</span>
<span class="k">done</span>
</pre></div>
</div>

<div class="code-frame" data-lang="">
<div class="code-lang"><span class="bold">output</span></div>
<div class="highlight"><pre><span></span>=== before ===
a,b c,d
e,f
=== after ===
[a]
[b c]
[d
e]
[f]
</pre></div>
</div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />14位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>81</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/92457e3d1664383b18bc">historyにコマンドの実行時刻が表示されるようにする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-29 16:57:22</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>作業の痕跡を探るには<code>history</code>コマンドが使えます。でも更に、このコマンドを実行したのは何時頃だっけ？ということを調べたくなったりします。例えば何かトラブルをやらかしてしまったときの原因調査の時とかね。ですがデフォルトでは実行時刻は分かりません。</p>

<p>そんな時に困ることが無いよう、普段から以下の設定をしておけばhistoryで各コマンドの実行時刻が表示出来るようになります。環境変数にexportせず単に変数をセットしておくだけでOKです。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">~/.bashrc</span></div>
<div class="highlight"><pre><span></span># history にコマンド実行時刻を記録する
HISTTIMEFORMAT='%Y-%m-%dT%T%z '
</pre></div>
</div>

<p>これがセットされていると ~/.bash_history ファイルには以下のようにコマンド毎の実行時刻がUNIXタイムでメモが残されて…</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">~/.bash_history</span></div>
<div class="highlight"><pre><span></span>#1364542436
history
#1364542451
ls -al
#1364542454
ps axf
#1364542456
pwd
#1364542458
history
</pre></div>
</div>

<p>更に<code>history</code>を実行時にはその時間が<code>HISTTIMEFORMAT</code>で指定したフォーマットに従って以下のように表示してくれるようになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span> $ history
 1796  2013-03-29T16:34:11+0900 ls -al
 1797  2013-03-29T16:34:14+0900 ps axf
 1798  2013-03-29T16:34:16+0900 pwd
 1799  2013-03-29T16:34:18+0900 history
</pre></div></div>

<p>便利なので僕は新環境をセットアップしたら常に設定するようにしてます。</p>

<p>この設定が生きるのはbashのバージョン3.0からですが、変数設定するだけなので古いbashで実行しても特に害は無いので安心です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />15位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>74</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/211266021515b3f033a3">Bashで変数を大文字小文字変換(uppercase/lowercase)する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-23 16:08:47</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>bashのバージョン4以降から使えるようになった構文なんだけど、大文字小文字無視した文字列で比較したい時とかに地味に便利なのでメモ。</p>

<table>
<thead>
<tr>
<th style="text-align: left">記述</th>
<th style="text-align: left">説明</th>
<th style="text-align: left">例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><code>${v^}</code></td>
<td style="text-align: left">大文字化(１文字目のみ)</td>
<td style="text-align: left">
<code>v="ho ge"; echo ${v^}</code>→Ho ge</td>
</tr>
<tr>
<td style="text-align: left"><code>${v^^}</code></td>
<td style="text-align: left">大文字化(全文字)</td>
<td style="text-align: left">
<code>v="ho ge"; echo ${v^^}</code>→HO GE</td>
</tr>
<tr>
<td style="text-align: left"><code>${v,}</code></td>
<td style="text-align: left">小文字化(１文字目のみ)</td>
<td style="text-align: left">
<code>v="HO GE"; echo ${v,}</code>→hO GE</td>
</tr>
<tr>
<td style="text-align: left"><code>${v,,}</code></td>
<td style="text-align: left">小文字化(全文字)</td>
<td style="text-align: left">
<code>v="HO GE"; echo ${v,,}</code>→ho ge</td>
</tr>
<tr>
<td style="text-align: left"><code>${v~}</code></td>
<td style="text-align: left">大小反転(１文字目のみ※)</td>
<td style="text-align: left">
<code>v="ho GE"; echo ${v~}</code>→Ho gE</td>
</tr>
<tr>
<td style="text-align: left"><code>${v~~}</code></td>
<td style="text-align: left">大小反転(全文字)</td>
<td style="text-align: left">
<code>v="ho GE"; echo ${v~~}</code>→HO GE</td>
</tr>
</tbody>
</table>

<p>※何故か、大小反転だけは空白を含む文字列に対して、空白毎にその後の１文字を変換するという変な動作になる。大文字化と小文字化に関しては空白があっても特別なことは起こらない。</p>

<h2>
<span id="利用例" class="fragment"></span><a href="#%E5%88%A9%E7%94%A8%E4%BE%8B"><i class="fa fa-link"></i></a>利用例</h2>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span> -n <span class="s2">"押すなよ！絶対押すなよ！ [y/N]"</span>
<span class="nb">read</span> confirm
<span class="k">if</span> <span class="o">[[</span> <span class="si">${</span><span class="nv">confirm</span><span class="p">,,</span><span class="si">}</span> <span class="o">=</span> y <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"素直か！"</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">"どーん！"</span>
<span class="k">fi</span>
</pre></div></div>

<h2>
<span id="bashが古い場合は" class="fragment"></span><a href="#bash%E3%81%8C%E5%8F%A4%E3%81%84%E5%A0%B4%E5%90%88%E3%81%AF"><i class="fa fa-link"></i></a>bashが古い場合は…</h2>

<p><code>tr</code>でも使っとけばいいんじゃね。</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>$ tr <span class="s1">'[a-z]'</span> <span class="s1">'[A-Z]'</span> <span class="o">&lt;&lt;&lt;</span>hoge
HOGE
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />16位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>70</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/ba0e75b6828bd3951e52">リンク切れのシンボリックリンクを探す方法</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-04 14:06:12</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="結論" class="fragment"></span><a href="#%E7%B5%90%E8%AB%96"><i class="fa fa-link"></i></a>結論</h2>

<p>を先に書くと</p>

<blockquote>
<p><strong>リンク切れのシンボリックリンクは <code>find -xtype l</code> で探せる</strong></p>
</blockquote>

<p>よ！</p>

<h2>
<span id="manによると" class="fragment"></span><a href="#man%E3%81%AB%E3%82%88%E3%82%8B%E3%81%A8"><i class="fa fa-link"></i></a>manによると</h2>

<blockquote>
<p>-xtype c<br>
 ファイルがシンボリックリンク以外の場合は -type と同じ。シンボリックリンクに対しては以下のように判断される。この判別式の前に -follow が指定されていなかった場合は、リンク先のファイルのタイプが c ならば真。 -follow が指定されていた場合は c が ‘l’ ならば真。つまりシンボリックリンクに対して、 -xtype は -type がチェックしない側をチェックする。</p>
</blockquote>

<p>となっており、うーん分かりにくい…。</p>

<h2>
<span id="-typeと-xtypeの違いを確認" class="fragment"></span><a href="#-type%E3%81%A8-xtype%E3%81%AE%E9%81%95%E3%81%84%E3%82%92%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a>-typeと-xtypeの違いを確認</h2>

<p>まず試験用のファイルを作って…</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ touch file
$ ln -s file link-file
$ ln -s link-file link-link-file
$ ln -sf null link-null
$ mkdir dir
$ find -ls
113575 4 drwxr-xr-x 2 root root 4096  4月  4 13:19 .
113698 4 drwxr-xr-x 1 root root 4096  4月  4 13:19 ./dir
113638 0 -rw-r--r-- 1 root root    0  4月  4 13:17 ./file
113984 0 lrwxrwxrwx 1 root root    4  4月  4 13:17 ./link-file -&gt; file
113985 0 lrwxrwxrwx 1 root root    9  4月  4 13:18 ./link-link-file -&gt; link-file
113593 0 lrwxrwxrwx 1 root root    4  4月  4 13:19 ./link-null -&gt; null
</pre></div></div>

<p>で、<code>-type</code>と<code>-xtype</code>、それから<code>-follow</code>をつけると動作が変わるらしいのでそれらを比較。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ find -type f
./file

$ find -type l
./link-file
./link-link-file
./link-null

$ find -xtype f
./file
./link-file
./link-link-file

$ find -xtype l
./link-null

$ find -follow -xtype f
./file

$ find -follow -xtype l
./link-file
./link-link-file
./link-null

$ find -empty
./dir
./file
</pre></div></div>

<p>なるほど。ついでに<code>-empty</code>の動作も再確認してみたがこれは<code>-type</code>が<code>f</code>か<code>d</code>のときしか反応しない、と。</p>

<h3>
<span id="比較しやすいようテーブルにしてみる" class="fragment"></span><a href="#%E6%AF%94%E8%BC%83%E3%81%97%E3%82%84%E3%81%99%E3%81%84%E3%82%88%E3%81%86%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AB%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>比較しやすいようテーブルにしてみる</h3>

<table>
<thead>
<tr>
<th style="text-align: right"></th>
<th style="text-align: center">dir</th>
<th style="text-align: center">file</th>
<th style="text-align: center">link-file</th>
<th style="text-align: center">link-link-file</th>
<th style="text-align: center">link-null</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right">-type f</td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: right">-type l</td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
</tr>
<tr>
<td style="text-align: right">-xtype f</td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: right"><strong>-xtype l</strong></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
</tr>
<tr>
<td style="text-align: right">-follow -xtype f</td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: right">-follow -xtype l</td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
</tr>
<tr>
<td style="text-align: right">-empty</td>
<td style="text-align: center">○</td>
<td style="text-align: center">○</td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
<td style="text-align: center"></td>
</tr>
</tbody>
</table>

<p><code>-follow</code>が付いてると<code>-xtype</code>は<code>-type</code>と同じ動作になるっぽい、まぁ意味的に当然そうなるわな。<code>-follow</code>自体は<code>-xtype</code>だけで使うオプションではないのでその事自体は別によい。</p>

<h3>
<span id="注意な" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E3%81%AA"><i class="fa fa-link"></i></a>注意な</h3>

<p>わざわざ<code>-follow</code>について言及するのは、大事なのは、</p>

<blockquote>
<p><strong>-followが付いてる時、-xtypeはあなたが期待するのと違う動作になってる可能性が高いから注意しろよ</strong></p>
</blockquote>

<p>ってことだと思う。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />17位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>68</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/98768ba5eea8d6fe6a19">標準出力をファイルのように扱う方法、例えば2つのコマンドの出力結果のdiffを取るとか</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-31 06:06:19</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>結論を先に書くと↓例えばこんなことが出来ます。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>diff &lt;<span class="o">(</span>command1<span class="o">)</span> &lt;<span class="o">(</span>command2<span class="o">)</span>
</pre></div></div>

<p>これは以下のようなことを、一時ファイルを作らずに行なっているのと同じです。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>command1 &gt; out1
command2 &gt; out2
diff out1 out2
rm -f out1 out2
</pre></div></div>

<p>これは <strong>Process Substitution</strong> という名前の機能です。</p>

<p>ちなみに <code>echo &lt;(command)</code> すると <code>/dev/fd/63</code> などと表示されます。<br>
これは一時的に作られたファイルディスクリプタの名前で、そのファイルディスクリプタは実行された<code>command</code>の標準出力に繋がっており、他のプログラムからはファイルと同じように扱うことが出来る、というわけです。<br>
とっても便利なので、覚えといて損はないです。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />18位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>67</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/481a5af428c97ef55b14">S3の特定バケットだけを&quot;AWS Consoleを使って&quot;操作できるIAMユーザを作る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-24 20:02:37</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[S3]</b> <b>[IAM]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>適当にIAMユーザを作って以下のようなポリシーを設定すれば良い。</p>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
  <span class="nt">"Statement"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
      <span class="nt">"Action"</span><span class="p">:</span> <span class="s2">"s3:*"</span><span class="p">,</span>
      <span class="nt">"Resource"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"arn:aws:s3:::example-bucket"</span><span class="p">,</span>
        <span class="s2">"arn:aws:s3:::example-bucket/*"</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
      <span class="nt">"Action"</span><span class="p">:</span> <span class="s2">"s3:ListAllMyBuckets"</span><span class="p">,</span>
      <span class="nt">"Resource"</span><span class="p">:</span> <span class="s2">"*"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div></div>

<p>Statementを２つ設定してやるのがポイント。</p>

<ul>
<li>１つ目のStatementは example-bucket に対するフル権限を与えている。Resourcesが<code>/*</code>付きのバケット名だけだとバケットのルートディレクトリで一覧取得できないので、バケット名そのものにも権限を与えている。</li>
<li>2つ目のStatementはバケット一覧を取得する権限を与えている。これはAWS ConsoleからS3の操作をする際に必要です(単にREST APIでS3にアクセスするだけなら不要)。example-bucket以外のバケット名も見えてしまうのは諦めるしか無い。バケット名は見えても操作は一切できないので問題無いと割り切る。</li>
</ul>

<p>AWSコンソールを使う必要がなければ１つ目のStatementだけで十分です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />19位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>51</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/87b521e4e9e919caec55">SSLサーバ証明書のSANsとは</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-04 13:47:50</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[SSL]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="sslサーバ証明書のsansとは" class="fragment"></span><a href="#ssl%E3%82%B5%E3%83%BC%E3%83%90%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AEsans%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>SSLサーバ証明書のSANsとは</h1>

<p>Subject Alternate Names の略で、サーバ証明書のCN（Common Name）の別名というか追加名のこと。</p>

<p>普通サーバ証明書を買うと <a href="http://www.example.com" rel="nofollow noopener" target="_blank">www.example.com</a> など一つのホスト名がCNとして設定されたものが発行される。<br>
ブラウザ等はサブドメインまで含めて完全一致でこのホスト名をチェックするから、www2.exmaple.com や example.com なんかのホスト名でアクセスすると証明書エラーが出る。でも <a href="http://www.example.com" rel="nofollow noopener" target="_blank">www.example.com</a> と example.com はサイトの中身同じだしどっちでもアクセスできるようにしたい。</p>

<p>だけどその為に証明書2枚も買うのはもったないし設定も面倒…。というのに対する一つの回答がSANという機能と思えば良い。より詳しいことは「<a href="https://www.google.com/search?q=Subject+Alternate+Names" rel="nofollow noopener" target="_blank">Subject Alternate Names</a>」でググれば分かる。</p>

<p>要は一つの証明書の中に2つ以上のホスト名を列挙することが出来る機能なわけだ。</p>

<p>サーバ側の設定もこの1つの証明書をセットしておけばSANsに含まれる全ホスト名に対応できるので楽ちん。</p>

<h2>
<span id="sansな証明書が発行出来るかどうかは認証局次第" class="fragment"></span><a href="#sans%E3%81%AA%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%8C%E7%99%BA%E8%A1%8C%E5%87%BA%E6%9D%A5%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E3%81%AF%E8%AA%8D%E8%A8%BC%E5%B1%80%E6%AC%A1%E7%AC%AC"><i class="fa fa-link"></i></a>SANsな証明書が発行出来るかどうかは認証局次第</h2>

<p>普通は <a href="http://www.example.com" rel="nofollow noopener" target="_blank">www.example.com</a> の証明書を取得したら example.com は含まれないとこが多い気がする。<br>
追加料金で両方含められたり、逆にexample.comは最初から勝手に含まれてたり、果てはうちはSANsやってないんでーってとこもそれなりにある。認証局によって違う。 <br>
これボッタクリだろｗｗって値段のとこも多いし、色々検討すると良いだろう。</p>

<p>調べるのが面倒くさいので各認証局の対応具合や値段の列挙とかはここではしない。各自自分で調べてお気に入りの認証局を探せば良いと思う。ここで列挙しても数年立場値段とかも変わってその時代のベストな情報じゃ無くなっちゃうしね。</p>

<h3>
<span id="ちなみに僕はstartsslをよく使ってる" class="fragment"></span><a href="#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB%E5%83%95%E3%81%AFstartssl%E3%82%92%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%8B"><i class="fa fa-link"></i></a>ちなみに僕はStartSSLをよく使ってる</h3>

<p>StartSSLではサブドメインを含まない example.com みたいなホスト名（ネイキッドドメインっていうのかな）は勝手にCNもしくはSANsに入ってくる。逆に言うとこれを除く方法が無い気もする(^^;<br>
しかも、ここは ワイルドカード証明書だろうがSANsだろうが何でも対応してるので便利。<br>
さらにそれら全部、無料で発行してもらえるしね！</p>

<p>基本無料だけど、個人認証や組織認証するのにはお金がかかる。それをすると発行できる証明書の期限を長くしたりEV証明書も発行できるようになったりなど色々便利になる。<br>
ネックは英語でメッセージや書類のやり取りしなきゃならんのが結構大変なことかな…。</p>

<p>あと個人名やメールアドレスが証明書に含まれるのでそれを</p>

<p>あと自社用ならこれで良いんだけど、特殊メールアドレス(<a href="mailto:hostmaster@example.com" class="autolink">hostmaster@example.com</a>とか)へのメール送信による所有者チェック以外に、それなりにちゃんと人出でのドメインの所有組織のチェックも行われているようなので、偶に証明書の取得代行を頼まれて申請してみても「このドメインお前が持ってるやつじゃないだろ？」と英語で返信が来て発行が却下されることもStartSSLにはよくある。<br>
ちなみにホントに偶に自分が持ってるドメインなのに却下されて、ちげーよちゃんと僕のだよ、と英語で証拠を示す問答とかが発生したりすることも2度ほど経験した(^^;</p>

<p>つまり、メールだけ転送して貰って代行するってことはStartSSLでは出来ないんだわ。そういう場合(他人の代行)は諦めてRapidSSLとかそういうとこで個別にお金払って代行したりすることになる。本人所有以外のドメインの証明書は発行できないから、代行したい場合はその人にまずはアカウント作ってもらえって規約とかFAQにも書いてあるしな。</p>

<h2>
<span id="ブラウザサポートの問題も" class="fragment"></span><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AE%E5%95%8F%E9%A1%8C%E3%82%82"><i class="fa fa-link"></i></a>ブラウザサポートの問題も</h2>

<p>あと何気にこのSANsって機能、ガラケーや古いAndroid端末（確かver 2.x）とかだとサポートしてなかったりするので若干困る。だがまぁそういうのは時代が進むに連れて減るだろうから気にしない！</p>

<p>それから、そういう古い端末は大抵SNI（1個のIPとポートの組み合わせで複数証明書を切り替える機能）とかも対応してないから、対応しようと思ったら諦めて複数証明を取得して、複数IPで運用するしか無いね。</p>

<p>まぁ、大抵の問題はお金で解決するから心配無用。</p>

<h1>
<span id="元々は2chのレス" class="fragment"></span><a href="#%E5%85%83%E3%80%85%E3%81%AF2ch%E3%81%AE%E3%83%AC%E3%82%B9"><i class="fa fa-link"></i></a>元々は2chのレス</h1>

<p>下のスレのID:fRd8fKHoは僕なわけだが2chだとそのうち倉庫に行っちゃうかもしれないので補足も兼ねて↑にメモった。</p>

<p>【認証局】SSLに関するスレ 2枚目【ぼろ儲け】<br>
<a href="http://engawa.2ch.net/test/read.cgi/mysv/1286532904/294-297" class="autolink" rel="nofollow noopener" target="_blank">http://engawa.2ch.net/test/read.cgi/mysv/1286532904/294-297</a></p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>294 ：DNS未登録さん：2013/05/30(木) 10:25:29.56 ID:???
example.comでwwwサーバ、メールサーバ、sshサーバを運営したいんだけど、 
www有りのコモンネームで証明書を取得すれば、SANsの機能で 
www有り・無し関係なくSSL通信ができるという認識であってますか？ 

295 ：DNS未登録さん：2013/05/30(木) 12:54:39.57 ID:fRd8fKHo
&gt;&gt;294 
example.com と www.example.com の両方がSANで含まれた証明書ならね。 
でも、普通は www.example.com の証明書を取得したら example.com は含まれないと考えるべき。 
追加料金で両方含めれたり、逆にexample.comは最初から勝手に含まれてたりとか、認証局によって違う。 

296 ：DNS未登録さん：2013/05/31(金) 07:49:15.56 ID:???
&gt;&gt;295 
example.com (wwwなし)の証明書って必要？ 

297 ：DNS未登録さん：2013/05/31(金) 12:17:19.50 ID:???
ComodoのPositive SSLって安いな 
ttp://www.gogetssl.com/domain-validation/ 

Positive SSL CNがexample.comにSANでwww.example.com 
Rapid SSL CNがwww.example.comにSANでexample.com 
だったはず 
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />20位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>42</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/3bfdec221ee1485b7d0c">AWSの一括請求に関するアレコレ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-30 15:54:09</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[EC2]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="一括請求consolidated-billingとは" class="fragment"></span><a href="#%E4%B8%80%E6%8B%AC%E8%AB%8B%E6%B1%82consolidated-billing%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>一括請求(Consolidated Billing)とは？</h1>

<p>複数のAWSアカウントの請求を1つのアカウントに紐付けて請求を一本化する機能です。<br>
主に複数プロジェクトを抱える組織などで便利な機能だと思いますが、これを活用することで受けられるメリットもいくつかあるので覚えておくと良いです。</p>

<p>一括請求に関する詳細は、<a href="http://docs.aws.amazon.com/ja_jp/awsaccountbilling/latest/about/consolidatedbilling.html" rel="nofollow noopener" target="_blank">公式ドキュメント</a>や、ぐぐれば他にもっと手順や何やらを詳しく説明しているサイトがあるのでそっちを見てください。</p>

<p>ここはそれらのざっとググった情報からは見つけることが出来なかった、一括請求に関する細かい点を調査して補足するメモです。前半にざっとメリットなども書いてますが、 <strong>後半の「注意点」以降がこの記事のメイン</strong> です。</p>

<h1>
<span id="メリット" class="fragment"></span><a href="#%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>メリット</h1>

<h2>
<span id="請求を1箇所にまとめられる" class="fragment"></span><a href="#%E8%AB%8B%E6%B1%82%E3%82%921%E7%AE%87%E6%89%80%E3%81%AB%E3%81%BE%E3%81%A8%E3%82%81%E3%82%89%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>請求を1箇所にまとめられる</h2>

<p>一番よくある活用方法は、プロジェクトや顧客ごとに新規AWSアカウントを作って分けて使うことでしょう。こうすることでプロジェクト毎の利用額が全体に混ざること無く単体プロジェクト毎の利用額が簡単に把握できて便利です。<br>
しかも一括請求が設定してあれば親のアカウントに全請求が合算されて便利です。</p>

<p>あとは、子アカウント利用者に対して、請求に関する情報を秘匿できるのが嬉しいというケースもあるかもしれません。</p>

<h2>
<span id="ボリューム割引が全アカウントの合計で適用される" class="fragment"></span><a href="#%E3%83%9C%E3%83%AA%E3%83%A5%E3%83%BC%E3%83%A0%E5%89%B2%E5%BC%95%E3%81%8C%E5%85%A8%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AE%E5%90%88%E8%A8%88%E3%81%A7%E9%81%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%82%8B"><i class="fa fa-link"></i></a>ボリューム割引が全アカウントの合計で適用される</h2>

<p>データ転送量の合計とかRI購入額とかいろんな部分にボリューム割引というものが設定されています。<br>
個別のアカウント毎にはボリューム割引を受けられる量を使っていなくても、一括請求を設定することで全アカウントで合算をもとにボリューム割引が受けられるようになるというメリットがあります。</p>

<p>ただ、どのボリューム割引も結構半端無い額を使ってる場合にしか用はありません。月に高々数万～数10万程度の利用額だとまだあんまり関係ないですね…。</p>

<h2>
<span id="リザーブドインスタンス以下riの未使用時間分の割引価格を他アカウントに適用出来る" class="fragment"></span><a href="#%E3%83%AA%E3%82%B6%E3%83%BC%E3%83%96%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E4%BB%A5%E4%B8%8Bri%E3%81%AE%E6%9C%AA%E4%BD%BF%E7%94%A8%E6%99%82%E9%96%93%E5%88%86%E3%81%AE%E5%89%B2%E5%BC%95%E4%BE%A1%E6%A0%BC%E3%82%92%E4%BB%96%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AB%E9%81%A9%E7%94%A8%E5%87%BA%E6%9D%A5%E3%82%8B"><i class="fa fa-link"></i></a>リザーブドインスタンス(以下RI)の未使用時間分の割引価格を他アカウントに適用出来る</h2>

<p>親Aの下に子B,Cが一括請求設定でぶら下がっており、子BがRIを購入してた場合は以下のように割引価格が適用されます。基本的にはRI所有者がまず最優先で割引料金を適用されて、所有者がRI適合インスタンスを使っていない残りの時間分だけ</p>

<p>Q1. 子Bが月100%の時間、RI条件に一致するインスタンスを使った場合<br>
A1. 子Bは月100%分の割引料金が適用される。親Aや子BはRI条件に一致するインスタンスを使っていても全てオンデマンド価格が出来用される。</p>

<p>Q2. 子Bが100時間だけ、子Cが月100%の時間、RI条件に一致するインスタンスを使った場合<br>
A1. 子Bは100時間分の割引料金が適用される。子Cは100時間分だけオンデマンド料金が適用され、残りの時間は割引料金が適用される。</p>

<p>Q2. 子Bが100時間だけ、親Aと子Cが月100%の時間、RI条件に一致するインスタンスを使った場合<br>
A1. 子Bは100時間分の割引料金が適用される。親Aと子Cは50時間分ずつだけオンデマンド料金が適用され、残りの時間は割引料金が適用される。</p>

<h1>
<span id="注意点細かい仕様" class="fragment"></span><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9%E7%B4%B0%E3%81%8B%E3%81%84%E4%BB%95%E6%A7%98"><i class="fa fa-link"></i></a>注意点／細かい仕様</h1>

<p>ドキュメントからは見つけることが出来なかった、または曖昧な表現を、独自に調査したり問い合わせてまとめたのがここに上げる注意点です。</p>

<h2>
<span id="無料利用枠は合算されません" class="fragment"></span><a href="#%E7%84%A1%E6%96%99%E5%88%A9%E7%94%A8%E6%9E%A0%E3%81%AF%E5%90%88%E7%AE%97%E3%81%95%E3%82%8C%E3%81%BE%E3%81%9B%E3%82%93"><i class="fa fa-link"></i></a>無料利用枠は合算されません</h2>

<p>新規アカウントが3つぶら下がってたとしても、月にt1.microを3つ分を無料でフル起動するようなことは出来ません。全アカウント通して1アカウント分の無料枠しか適用されません。</p>

<p>まぁ、これは普通に一括請求のドキュメントにも書いてあるのであえてここで上げる必要は無いかなと思ったけど一応。</p>

<h2>
<span id="riのキャパシティ予約はri購入アカウント以外には適用されない" class="fragment"></span><a href="#ri%E3%81%AE%E3%82%AD%E3%83%A3%E3%83%91%E3%82%B7%E3%83%86%E3%82%A3%E4%BA%88%E7%B4%84%E3%81%AFri%E8%B3%BC%E5%85%A5%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E4%BB%A5%E5%A4%96%E3%81%AB%E3%81%AF%E9%81%A9%E7%94%A8%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>RIのキャパシティ予約はRI購入アカウント以外には適用されない</h2>

<p>RI購入アカウント以外のアカウントでは、キャパシティ予約（処理能力の予約）は効きません。アカウント間で融通可能なのは割引料金に関してのみです。</p>

<p>まぁ、これも普通に一括請求のドキュメントにも書いてあるのであえてここで上げる必要は無いかなと思ったけど一応。</p>

<h2>
<span id="riの割引メリットの共有がアカウント間でaz名が一致しない場合は使えないことがある" class="fragment"></span><a href="#ri%E3%81%AE%E5%89%B2%E5%BC%95%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%AE%E5%85%B1%E6%9C%89%E3%81%8C%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E9%96%93%E3%81%A7az%E5%90%8D%E3%81%8C%E4%B8%80%E8%87%B4%E3%81%97%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%AF%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%81%8C%E3%81%82%E3%82%8B"><i class="fa fa-link"></i></a>RIの割引メリットの共有が、アカウント間でAZ名が一致しない場合は使えないことがある</h2>

<p>まず前提としてアカウント毎にAZ名のリストが一致しないことがあることを抑えておきましょう。<br>
<a href="http://qiita.com/kawaz/items/cecab993f2180c07db5f" id="reference-d1c381189adbedc8ca21">AWSの複数アカウントのAZ名の対応を調査する - Qiita [キータ]</a></p>

<p>で、これに絡んでRIの割引メリットの融通が出来ない以下の様なケースもあるので注意しましょう。</p>

<p>アカウントAのus-east-1のAZリストが us-east-1a, us-east-1b, us-east-1d の3つで、<br>
アカウントBのus-east-1のAZリストは us-east-1b, us-east-1c, us-east-1d の3つになっているケース。<br>
つまり、アカウントAにあるus-east-1aがアカウントBには無い場合です。</p>

<p>このケースの場合、アカウントAがus-east-1aで購入したRIの割引メリットは、どうやってもアカウントBで使うことは出来ません！（us-east-1bとus-east-1dは両者に共通してあるAZなのでここで購入したRIは割引料金の融通が可能です）</p>

<p><strong>購入したRIに書いてあるAZ名</strong>、これが一致することが余ったRI割引メリットを他アカウントで受ける条件です。なのでRIのAZ名が自分のアカウントにない場合は割引メリットの恩恵をうけることは出来ません。</p>

<p>これはもうそういう仕様です。運が悪かったと諦めましょう。</p>

<p>サポートにも問い合わせて確認済みです。</p>

<h2>
<span id="awsクレジットはそのクレジットの所有アカウントでしか使えない全アカウント分を合算して使える" class="fragment"></span><a href="#aws%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%81%AF%E3%81%9D%E3%81%AE%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%81%AE%E6%89%80%E6%9C%89%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%A7%E3%81%97%E3%81%8B%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84%E5%85%A8%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E5%88%86%E3%82%92%E5%90%88%E7%AE%97%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>AWSクレジットは<del>そのクレジットの所有アカウントでしか使えない</del>→<strong>全アカウント分を合算して使える。</strong>
</h2>

<p><strong>追記：下記はそれぞれ自分でも試しつつAWSのサポートにも確認して得た回答だったんですが、当時の確認に間違いがあったのかいつの間にか仕様が変わったのか…、少なくとも現在は全アカウントのクレジットが合算して使えてるようです。</strong></p>

<p><a href="http://docs.aws.amazon.com/ja_jp/awsaccountbilling/latest/about/consolidatedbilling.html#consolidatedbilling-credits" rel="nofollow noopener" target="_blank">一括請求（コンソリデーティッドビリング） - AWS Account Billing</a> の「AWSクレジット」のセクションには以下のようにさらっと書いてあります。</p>

<blockquote>
<p>支払いアカウントの所有者への請求が最低価格で済むように、支払いアカウントおよび連結アカウントが持つすべての AWS クレジットは一括請求（コンソリデーティッドビリング）に適用されます。</p>
</blockquote>

<p>これを読むとRIの余った割引メリットの共有と同じように、全アカウントのもつAWSクレジットが合算されて一括請求に適用され<del>るかのように読めますが、それは間違いのようです。AWSクレジットはそれの各所有アカウントで発生した料金にしか適用されません。</del>→<strong>合算して適用されます！</strong></p>

<p>以下に具体的な例をいくつかあげておきます。</p>

<h3>
<span id="q1-一括請求の子が親のクレジットを使えるのでしょうか" class="fragment"></span><a href="#q1-%E4%B8%80%E6%8B%AC%E8%AB%8B%E6%B1%82%E3%81%AE%E5%AD%90%E3%81%8C%E8%A6%AA%E3%81%AE%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AE%E3%81%A7%E3%81%97%E3%82%87%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>Q1. 一括請求の子が親のクレジットを使えるのでしょうか？</h3>

<p><del>使えません。</del><br>
→<strong>使えます。</strong></p>

<h3>
<span id="q2-一括請求の親が子のクレジットを使えるのでしょうか" class="fragment"></span><a href="#q2-%E4%B8%80%E6%8B%AC%E8%AB%8B%E6%B1%82%E3%81%AE%E8%A6%AA%E3%81%8C%E5%AD%90%E3%81%AE%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AE%E3%81%A7%E3%81%97%E3%82%87%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>Q2. 一括請求の親が子のクレジットを使えるのでしょうか？</h3>

<p><del>使えません。</del><br>
→<strong>使えます。</strong></p>

<h3>
<span id="q3-親と子が50ずつのクレジットを持っており子が75の利用料を発生させた場合それぞれのクレジットはどのように消費されるのでしょうか" class="fragment"></span><a href="#q3-%E8%A6%AA%E3%81%A8%E5%AD%90%E3%81%8C50%E3%81%9A%E3%81%A4%E3%81%AE%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%82%92%E6%8C%81%E3%81%A3%E3%81%A6%E3%81%8A%E3%82%8A%E5%AD%90%E3%81%8C75%E3%81%AE%E5%88%A9%E7%94%A8%E6%96%99%E3%82%92%E7%99%BA%E7%94%9F%E3%81%95%E3%81%9B%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%9D%E3%82%8C%E3%81%9E%E3%82%8C%E3%81%AE%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%81%AF%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E6%B6%88%E8%B2%BB%E3%81%95%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%A7%E3%81%97%E3%82%87%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>Q3. 親と子が$50ずつのクレジットを持っており、子が$75の利用料を発生させた場合、それぞれのクレジットはどのように消費されるのでしょうか？</h3>

<p><del>子の\$50クレジットが消費されて、親に$25の請求が行きます。親の\$50クレジットはそのままです。</del><br>
→<strong>子の\$75は全てクレジットから支払われ、請求額は\$0になります。<br>
また、両クレジットの有効期限が同じなら子のクレジット残高がゼロ、親のクレジット残高が\$25になります。ですが有効期限が異なる場合は期限が近い方のクレジットから順に消費されます。例えばこのケースで親のクレジット期限の方が短ければ親のクレジット残高がゼロ、子のクレジット残高が\$25になります。</strong></p>

<h3>
<span id="q4-一括請求の親aの子bがクレジットを持っており子cがaws利用料を発生させた場合子bのクレジットは使えるのでしょうか" class="fragment"></span><a href="#q4-%E4%B8%80%E6%8B%AC%E8%AB%8B%E6%B1%82%E3%81%AE%E8%A6%AAa%E3%81%AE%E5%AD%90b%E3%81%8C%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%82%92%E6%8C%81%E3%81%A3%E3%81%A6%E3%81%8A%E3%82%8A%E5%AD%90c%E3%81%8Caws%E5%88%A9%E7%94%A8%E6%96%99%E3%82%92%E7%99%BA%E7%94%9F%E3%81%95%E3%81%9B%E3%81%9F%E5%A0%B4%E5%90%88%E5%AD%90b%E3%81%AE%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%81%AF%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AE%E3%81%A7%E3%81%97%E3%82%87%E3%81%86%E3%81%8B"><i class="fa fa-link"></i></a>Q4. 一括請求の親Aの子Bがクレジットを持っており、子CがAWS利用料を発生させた場合、子Bのクレジットは使えるのでしょうか？</h3>

<p><del>使えません。</del><br>
→<strong>使えます。</strong></p>

<h3>
<span id="q5-合算して使えるって言うから試したのにクレジット使われなかったんだけど" class="fragment"></span><a href="#q5-%E5%90%88%E7%AE%97%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%A3%E3%81%A6%E8%A8%80%E3%81%86%E3%81%8B%E3%82%89%E8%A9%A6%E3%81%97%E3%81%9F%E3%81%AE%E3%81%AB%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E4%BD%BF%E3%82%8F%E3%82%8C%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%82%93%E3%81%A0%E3%81%91%E3%81%A9"><i class="fa fa-link"></i></a>Q5. 合算して使えるって言うから試したのにクレジット使われなかったんだけど！？</h3>

<p>一括請求のアカウント統合をした当月分の請求に関しては残クレジットのアカウント間の融通は行われません。ただし翌月以降の請求に関しては互いのクレジットを消費し合えるようになるようです。</p>

<p>ドキュメントなどはありませんが色々試した結果そういう仕様のようです。</p>

<p>実は最初の頃にクレジット融通は出来ないっぽいと判断したのはこれが理由の検証ミスだったんじゃないかと思います。またサポートに問い合わせたときの回答も1ヶ月位かかった上で出来ませんという答えだったので、あちらでもサポートの人が実際にアカウントを作って挙動を確認したうえで回答してくれたんだと思います。サポートの人の誤回答も多分も初月の結果だけを見たて判断してしまったが故のものとと思われます。</p>

<h2>
<span id="作成から2週間以内のアカウントは統合できない-出来る" class="fragment"></span><a href="#%E4%BD%9C%E6%88%90%E3%81%8B%E3%82%892%E9%80%B1%E9%96%93%E4%BB%A5%E5%86%85%E3%81%AE%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AF%E7%B5%B1%E5%90%88%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84-%E5%87%BA%E6%9D%A5%E3%82%8B"><i class="fa fa-link"></i></a>作成から2週間以内のアカウントは統合<del>できない</del> →出来る</h2>

<p><del>昔はこんな制限なかったと思うが、最近出来た制限のようだ。<br>
作ったばかりのAWSアカウントを一括請求の子として追加しようとすると以下の様なエラーが出る。（エラーメッセージコピペし忘れた…？）</del></p>

<p>→最近試したら、作ったばかりのアカウントもすぐに統合できた。AWS側のポリシーがその時々でこっそり変わったり戻ったりしてるのかもしれません。アンドキュメントでAmazonの機嫌しだいの部分なので、まぁ参考程度に…。</p>

<h2>
<span id="連続で複数アカウントを作成統合してるとエラーになる" class="fragment"></span><a href="#%E9%80%A3%E7%B6%9A%E3%81%A7%E8%A4%87%E6%95%B0%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E7%B5%B1%E5%90%88%E3%81%97%E3%81%A6%E3%82%8B%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>連続で複数アカウントを作成・統合してるとエラーになる</h2>

<p>普通はこんなことする人は少ないだろうけど、大量のアカウントを作って一括請求に統合しようとすると７，８アカウント分くらい(?)の作業した時点でエラーになる。</p>

<p>多分自動化ボットとかによる悪事防止策だと思います。<br>
一応半日か1日くらい待てば制限解除されるようなので、地道に毎日少しずつアカウントを作っては統合してを繰り返せば最終的には目的達成できます。</p>

<p>ちなみに上記行為は利用料を綺麗に分けたいために案件毎にアカウントを分けて請求は纏めるということをしたかったという正当な目的による作業をしていて分かったことです。なお一括請求アカウントはデフォルトで20アカウントまでの制限がありますが、サポート経由で理由を話してお願いすると結構あっさり100とかに上げてもらえます。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />21位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>41</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/65cdbeaa739c4e6b7776">PS4の設定でシェルスクリプトのデバッグが捗る</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-10 09:53:42</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>.bashrc とかに以下の設定を書いておくと、<code>bash -x</code> や <code>set -x</code> 状態でスクリプト実行したときに、出力がリッチになってデバッグが捗ります。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="c1"># PS4の設定でシェルスクリプトのデバッグが捗る http://bit.ly/1gncKrn</span>
<span class="nb">export</span> <span class="nv">PS4</span><span class="o">=</span><span class="s1">'+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME:+$FUNCNAME(): }'</span>
</pre></div></div>

<h1>
<span id="サンプルスクリプト" class="fragment"></span><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88"><i class="fa fa-link"></i></a>サンプルスクリプト</h1>

<p>↓こんな感じの２つのスクリプトがあるとします。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">test.sh</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"i am test.sh"</span>
. func.sh
foo hoge
</pre></div>
</div>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">func.sh</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"i am func.sh"</span>
<span class="k">function</span> foo<span class="o">()</span> <span class="o">{</span>
  bar <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="o">}</span>
<span class="k">function</span> bar<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> bar <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="o">}</span>
</pre></div>
</div>

<h1>
<span id="通常の実行例" class="fragment"></span><a href="#%E9%80%9A%E5%B8%B8%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%BE%8B"><i class="fa fa-link"></i></a>通常の実行例</h1>

<p>デフォルトでは <code>PS4='+ '</code> となっており、その場合の出力は以下のようになります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>+ echo 'i am test.sh'
i am test.sh
+ . func.sh
++ echo 'i am func.sh'
i am func.sh
+ foo hoge
+ bar hoge
+ echo bar hoge
bar hoge
</pre></div></div>

<p>一応source読み込みで入れ子になってるスクリプトで実行されたコマンドは ++ 表記で２段目の入れ子ファイル上のコマンドですよーてことは分かりますがそれだけです。</p>

<h1>
<span id="いい感じの実行例" class="fragment"></span><a href="#%E3%81%84%E3%81%84%E6%84%9F%E3%81%98%E3%81%AE%E5%AE%9F%E8%A1%8C%E4%BE%8B"><i class="fa fa-link"></i></a>いい感じの実行例</h1>

<p>冒頭のPS4を設定しておくと以下の様な感じになります。</p>

<div class="code-frame" data-lang="test"><div class="highlight"><pre><span></span>$ bash -x test.sh
+(test.sh:2): echo 'i am test.sh'
i am test.sh
+(test.sh:3): . func.sh
++(func.sh:2): echo 'i am func.sh'
i am func.sh
+(test.sh:4): foo hoge
+(func.sh:4): foo(): bar hoge
+(func.sh:7): bar(): echo bar hoge
bar hoge

</pre></div></div>

<p>ファイル名や実行中コマンドのスクリプト内行番号や、関数中ならその関数名まで表示してくれます。便利！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />22位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>39</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/7b15e18ca8e072c1dc57">tmuxでマウスモードのON/OFFを単一キーで簡単に切り替える</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-28 13:25:21</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[tmux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>tmuxのマウスモードってたまに使いたくなるんだけど常時ONだと邪魔に感じることもしばしば。それでマウス関連の設定を簡単にON/OFF出来るようにしたいなーと思って試行錯誤した歴史。</p>

<h1>
<span id="tmux21以降" class="fragment"></span><a href="#tmux21%E4%BB%A5%E9%99%8D"><i class="fa fa-link"></i></a>tmux2.1以降</h1>

<p>tmux 2.1でマウス関連のオプションが全部 <code>mouse</code> ていうオプションにまとめられたようなので↓これだけで良くなった模様。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">~/.tmux.conf</span></div>
<div class="highlight"><pre><span></span># マウス関連（デフォルトはOFFにしておいて、prefix+mで切替える）http://bit.ly/1N6URvr
set-option -g mouse off
bind-key m if-shell "tmux show-options -g mouse | grep off" "set-option -g mouse on" "set-option -g mouse off"
</pre></div>
</div>

<p>但しこれだけだとホイールスクロールはまだ効かないらしい。だが自分はどうやらマウスホイールでtmuxをスクロールする操作を殆どやらないっぽいので切替設定作るの面倒なので割愛。<br>
必要な人は、<a href="http://qiita.com/jyotti/items/70a3a8035d767f99f93d" id="reference-afa4d6ecf9786283ddd8">tmux v2.1からmouse関連の設定が変わった - Qiita</a> とかを見てください。</p>

<h1>
<span id="tmux20以前" class="fragment"></span><a href="#tmux20%E4%BB%A5%E5%89%8D"><i class="fa fa-link"></i></a>tmux2.0以前</h1>

<p>昔頑張った設定。但し最新のtmuxだと以下はどれもエラーになるオプションになった過去の遺物と化した。</p>

<h2>
<span id="初期とりあえずマウス使ってみよう" class="fragment"></span><a href="#%E5%88%9D%E6%9C%9F%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%83%9E%E3%82%A6%E3%82%B9%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i class="fa fa-link"></i></a>初期：とりあえずマウス使ってみよう</h2>

<p>マウス関連オプションを全部有効にする設定を<code>~/.tmux.conf</code>にこんな感じに書いていた。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">~/.tmux.conf</span></div>
<div class="highlight"><pre><span></span># マウス関連
set-option -gw mode-mouse on
set-option -g mouse-utf8 on
set-option -g mouse-resize-pane on
set-option -g mouse-select-pane on
set-option -g mouse-select-window on
</pre></div>
</div>

<p>当然これだと常にマウスは有効。でもたまにネイティブのマウス動作を使いたくなった時に詰むので、適当なキーバインドで切り替えたいなーと思い始める。</p>

<h2>
<span id="中期mとmで切り替えられるようにする" class="fragment"></span><a href="#%E4%B8%AD%E6%9C%9Fm%E3%81%A8m%E3%81%A7%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%89%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>中期：<code>m</code>と<code>M</code>で切り替えられるようにする</h2>

<p>とりあえずデフォルトONのまま、以下のようなキーバインドを更に追加してみた。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">~/.tmux.conf</span></div>
<div class="highlight"><pre><span></span># prefix + m/M でマウスのON/OFFが切り替えられるようにする
bind-key m \
  set-option -g mode-mouse on \; \
  set-option -g mouse-utf8 on \; \
  set-option -g mouse-resize-pane on \; \
  set-option -g mouse-select-pane on \; \
  set-option -g mouse-select-window on \; \
  display-message "Mouse: ON"
bind-key M \
  set-option -g mode-mouse off \; \
  set-option -g mouse-utf8 off \; \
  set-option -g mouse-resize-pane off \; \
  set-option -g mouse-select-pane off \; \
  set-option -g mouse-select-window off \; \
  display-message "Mouse: off"
</pre></div>
</div>

<p>bind-keyのコマンドが<code>\;</code>で繋ぐと複数コマンドを実行できるという発見に喜びつつも、それはすぐに落胆に変わる。この設定には欠点があったのだ！<br>
やってみてすぐに気がついたんだが、C-z した後の M(Shift-m) は非常に押しづらいという…。でもマウスを連想させる m/M 以外のキーに変えたら多分僕には覚えられないことも分かっていたので他のキーに変えることも出来なかった。<br>
他にいい案が思い浮かばなかったのでしばらく運用してみることした。</p>

<h2>
<span id="最終版mだけで切り替えたい" class="fragment"></span><a href="#%E6%9C%80%E7%B5%82%E7%89%88m%E3%81%A0%E3%81%91%E3%81%A7%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%81%9F%E3%81%84"><i class="fa fa-link"></i></a>最終版：<code>m</code>だけで切り替えたい！</h2>

<p>やっぱり<code>C-z M</code>の入力は僕には敷居が高すぎた。<br>
1週間もしないうちに嫌になった。前回は諦めたけど何とか覚えるキーを1つだけで切り替えが出来ないかと考え始める。<br>
単一キーでON/OFFを切替えるならif文が必要だと思って調べたら<code>if-shell</code>というコマンドを発見した。でもif-shellは複数コマンド群を纏めて実行することは出来ないっぽいので、bind-keyにif-shellを繋げるやり方にしてみた。ちょっと長くなったけど上手く行った。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">~/.tmux.conf</span></div>
<div class="highlight"><pre><span></span># マウス関連（デフォルトはOFFにしておいて、prefix+mでマウスモードを切替える）http://bit.ly/ZzG7iN
set-option -gw mode-mouse off
bind-key m \
  if-shell "tmux show-options -gw mode-mouse | grep off" "set-option -gq mouse-utf8 on" "set-option -gq mouse-utf8 off" \;\
  if-shell "tmux show-options -gw mode-mouse | grep off" "set-option -gq mouse-resize-pane on" "set-option -gq mouse-resize-pane off" \;\
  if-shell "tmux show-options -gw mode-mouse | grep off" "set-option -gq mouse-select-pane on" "set-option -gq mouse-select-pane off" \;\
  if-shell "tmux show-options -gw mode-mouse | grep off" "set-option -gq mouse-select-window on" "set-option -gq mouse-select-window off" \;\
  if-shell "tmux show-options -gw mode-mouse | grep off" "set-option -gw mode-mouse on" "set-option -gw mode-mouse off"
</pre></div>
</div>

<p>これで<code>prefix + m</code>だけで、マウスの有効無効が切り替え出来るようになった。快適！<br>
ついでにステータスラインのどっかに</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>#(tmux show-option -gw mode-mouse|sed 's/mode-//;s/ /:/')
</pre></div></div>

<p>とかを足しておくと、<code>mouse:off</code>とか<code>mouse:on</code>とかって風に今のマウスモードが確認できて便利かもです。</p>

<p>ちなみに、上記設定の最後の1つ以外の set-option で -q を付けてるのは、どうやらif-shellの第2第3引数のtmuxコマンドは第1引数のシェル実行完了後に非同期で実行しされるようで、切り替えを実行する度にステータスラインに表示されるメッセージ(最後に実行されたset-optionの出力)が変わってウザいからである。</p>

<h3>
<span id="16系への対応" class="fragment"></span><a href="#16%E7%B3%BB%E3%81%B8%E3%81%AE%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>1.6系への対応</h3>

<p>コメントで指摘されたので補足。<br>
set-optionの<code>-q</code>オプションは1.7から追加されたものなので、1.6系をお使いの方は最終形の設定から -q を外してやればOKです。但しステータスラインに表示されるメッセージは切り替えの度に異なって何かウザいのを我慢してください(^^</p>

<h1>
<span id="はてダからのセルフ転載です" class="fragment"></span><a href="#%E3%81%AF%E3%81%A6%E3%83%80%E3%81%8B%E3%82%89%E3%81%AE%E3%82%BB%E3%83%AB%E3%83%95%E8%BB%A2%E8%BC%89%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>はてダからのセルフ転載です</h1>

<p>via. <a href="http://d.hatena.ne.jp/y-kawaz/20130308/1362735393" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/y-kawaz/20130308/1362735393</a><br>
新はてダの存在により旧はてダが阻害されてる感に辟易したので脱出中</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />23位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>35</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/dc33294c907755e9ee44">VMイメージ内でMACアドレスとインターフェース名(eth0とか)の関係が固定化されるのを防ぐ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-11 13:25:58</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>今時のLinuxはudevが親切にもネットワークインターフェース名とMACアドレスの関係を固定化してくれるんだが、この機能って同じディスクイメージの複製が使いまわされることが前提の仮想マシンを前提にすると非常に邪魔になる。具体的にはコピーしたイメージ上ではeth0が出来なかったり、eth1になっちゃったりとか…。</p>

<p>このMACアドレスの固定化設定は<code>/etc/udev/rules.d/70-persistent-net.rules</code>というファイルにシェルスクリプトして保存されている。なのでこれを削除してやれば次回起動時は期待通りにeth0が使えるようになる、のだがその際にまたこのファイルが再生成されてしまうので非常に邪魔！</p>

<p>というわけでVMイメージの場合は消すだけじゃなく、以下のようにファイルが出来るべき場所にディレクトリを作っておくことでファイル作成が出来ないようにして防ぐってことをしている。</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>rm -f /etc/udev/rules.d/70-persistent-net.rules
mkdir /etc/udev/rules.d/70-persistent-net.rules
<span class="c1"># 後で見た人がこのディレクトリの意味で悩まないよう、メモを残しておく</span>
<span class="nb">echo</span> http://bit.ly/Zobiu3 &gt;/etc/udev/rules.d/70-persistent-net.rules/README
</pre></div></div>

<p>一応これで良い感じにMACアドレスの固定化を避ける事が出来るようになる。<br>
元に戻したければこのディレクトリを削除してやれば良い。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>rm -rf /etc/udev/rules.d/70-persistent-net.rules
</pre></div></div>

<p>もしもっとスマートな方法があるよ、ってのがあれば教えてください(^^;</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />24位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>32</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/cecab993f2180c07db5f">AWSの複数アカウントのAZ名の対応を調査する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-29 22:37:51</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="az名と実データセンターの対応はアカウント毎に異なるということ" class="fragment"></span><a href="#az%E5%90%8D%E3%81%A8%E5%AE%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%E3%81%AE%E5%AF%BE%E5%BF%9C%E3%81%AF%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E6%AF%8E%E3%81%AB%E7%95%B0%E3%81%AA%E3%82%8B%E3%81%A8%E3%81%84%E3%81%86%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>AZ名と実データセンターの対応はアカウント毎に異なるということ</h1>

<p>AWSのアベイラビリティゾーン名（以下AZ名）と実データセンターの対応は実はユーザ毎に異なります。<br>
これは多分使用されるAZが偏ることを防止する為だと思われます（一番上のAZを選ぶユーザが多いと予想される）が、まぁ真相はわかりません(^^;</p>

<h2>
<span id="az名の対応不一致に関わる問題" class="fragment"></span><a href="#az%E5%90%8D%E3%81%AE%E5%AF%BE%E5%BF%9C%E4%B8%8D%E4%B8%80%E8%87%B4%E3%81%AB%E9%96%A2%E3%82%8F%E3%82%8B%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>AZ名の対応不一致に関わる問題</h2>

<p>AZの不一致はアカウント間のデータ転送料金に影響してきます。<br>
同一AZ同士の通信（Availability Zone Data Transfer）は無料ですが、同一リージョンの別AZ間の通信（Regional Data Transfer）は低価格ながら料金が発生するからです。</p>

<p>要はアカウントAの<code>ap-northeast-1a</code>とアカウントBの<code>ap-northeast-1a</code>の間で通信を行う際は、どちらも<code>ap-northeast-1a</code>というAZ名ですが、それぞれのAZ名が本当に同一AZなのかどうかを確認しておかない限りはそのデータ転送が無料なのか有料なのかが不定で困ります。</p>

<p>まぁ、AZ間通信の料金はそんな高くないから神経質になる程のものではないんだけど、知らないままよりは把握してた方が気分が良いし確認手段は持っておいて損はないからね。</p>

<p>あとそこまで神経質になる程ではないだろうけどレイテンシにも影響しますね。</p>

<h2>
<span id="アカウント間のaz名対応の確認方法" class="fragment"></span><a href="#%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E9%96%93%E3%81%AEaz%E5%90%8D%E5%AF%BE%E5%BF%9C%E3%81%AE%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>アカウント間のAZ名対応の確認方法</h2>

<p>まず公式にはこれを確認できる画面のようなものはありません。なので自分で何かしらの手段で調べる他ありません。</p>

<p>最初に簡単に思いつくのはグローバルIPのアドレス帯を比べてみたり、アカウント間でtracerouteしてホップ数を調べたりする方法ですが、結構これ面倒くさいです。それに調査のためにインスタンスを起動したり実際に通信を行ってみる必要があるため多少ながらもお金がかかってしまいます。</p>

<p>そこでオススメなのがスポットインスタンスの料金履歴を比較する方法です。アカウントAのあるAZのスポット料金グラフと、アカウントBのあるAZのスポット料金のグラフが一致していればそれは同じAZと断定してよいはずです。というか全インスタンスタイプ×全OSタイプ×全時間変化の履歴が全て一致していれば断定というより完全一致とみなしてよいでしょう。<br>
この手法の良い所はプログラマブルに処理しやすいことと、調査にかかる費用はゼロということです。</p>

<h1>
<span id="調査用スクリプトを作った" class="fragment"></span><a href="#%E8%AA%BF%E6%9F%BB%E7%94%A8%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F"><i class="fa fa-link"></i></a>調査用スクリプトを作った</h1>

<p>ここでは1日分のスポットインスタンスの価格履歴情報を使うことで、手っ取り早く、しかも無料で調査する方法をとってみます。 その調査用スクリプトが以下です。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">calc-aws-az-hash.sh</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
ec2-describe-regions <span class="p">|</span>
<span class="k">while</span> <span class="nb">read</span> dummy region dummy<span class="p">;</span> <span class="k">do</span>
  <span class="k">for</span> az in a b c d<span class="p">;</span> <span class="k">do</span>
    <span class="nv">history</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>ec2-describe-spot-price-history <span class="se">\</span>
      --region <span class="nv">$region</span> <span class="se">\</span>
      -s <span class="s2">"</span><span class="k">$(</span>date -u -d <span class="s2">"2 day ago"</span> +%Y-%m-%dT00:00:00<span class="k">)</span><span class="s2">"</span> <span class="se">\</span>
      -e <span class="s2">"</span><span class="k">$(</span>date -u -d <span class="s2">"1 day ago"</span> +%Y-%m-%dT00:00:00<span class="k">)</span><span class="s2">"</span> <span class="se">\</span>
      -a <span class="nv">$region$az</span> <span class="m">2</span>&gt;/dev/null <span class="p">|</span> sed -e s/<span class="nv">$region$az</span>// <span class="p">|</span> sort
    <span class="k">)</span><span class="s2">"</span>
    <span class="k">if</span> <span class="o">[[</span> -n <span class="nv">$history</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
      <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$region$az</span><span class="s2"> </span><span class="k">$(</span>sha1sum<span class="o">&lt;&lt;&lt;</span><span class="s2">"</span><span class="nv">$history</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span>
    <span class="k">fi</span>
  <span class="k">done</span>
<span class="k">done</span>
</pre></div>
</div>

<p>※ 実行の前提として、Access KeyとSecret Access Keyが環境変数<code>AWS_ACCESS_KEY</code>と<code>AWS_SECRET_KEY</code>で設定されているか、または実行中インスタンスにIAMロールが設定されている必要があります。</p>

<h2>
<span id="使い方" class="fragment"></span><a href="#%E4%BD%BF%E3%81%84%E6%96%B9"><i class="fa fa-link"></i></a>使い方</h2>

<p>上記スクリプトは<a href="https://gist.github.com/kawaz/6103296" rel="nofollow noopener" target="_blank">Gist</a>に保存してあるので以下のように実行可能です。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>curl -L https://gist.github.com/kawaz/6103296/raw/a33282169bff70aa53b09338b6f125fd3185fe8f/calc-aws-az-hash.sh <span class="p">|</span> bash

<span class="c1"># または短縮URLで</span>
curl -L http://bit.ly/154Hifb <span class="p">|</span> bash
</pre></div></div>

<p>これを各アカウントのアクセスキーで実行してやることでAZ毎の1日分の料金表のハッシュ値を一覧できます。この値を複数アカウント間で比べることでAZ名の対応を確認することが出来ます。</p>

<p>※ 直近の1日分を元にハッシュを計算しているので別の日に取得したハッシュ値リストを比べても無意味です。同じ日に複数アカウントで実行して比べてください。</p>

<h2>
<span id="実行例" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E4%BE%8B"><i class="fa fa-link"></i></a>実行例</h2>

<h3>
<span id="アカウントaでの出力" class="fragment"></span><a href="#%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88a%E3%81%A7%E3%81%AE%E5%87%BA%E5%8A%9B"><i class="fa fa-link"></i></a>アカウントAでの出力</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>eu-west-1a 17e8315fe5b4aa486ec536ce810e4bf24309ba02  -
eu-west-1b 12549e7c02ad5b65be4cbc7bb55e2a4a76a58fcd  -
eu-west-1c f8f899d9a8c4cd31de6e54bca6863526323bd6e8  -
sa-east-1a 21eff3974acec88e893bbab897db977636892aa1  -
sa-east-1b 161d52ac3341fcb9a18679216756ad95ab97069e  -
us-east-1b 316a5a3a7322481e3838a1fa214f7ca642d83035  -
us-east-1c 3122bb9130554d086ddf0fc8b0c84f6bed89df55  -
us-east-1d 4872eaa5b1b3c1075a46ffd2cf03ae8af8efcb51  -
ap-northeast-1a e16e96781d6194cb96c03bd965d6a1a0bd029d2e  -
ap-northeast-1c f62f5300138346db4f84c33cd86deb11574e5501  -
us-west-2a 7f5833cfb883ac6839be234ec03d0975985a0b79  -
us-west-2b 99bcfa3f2e0b8c257846b0af350c173ac7a6b12f  -
us-west-2c 490c895ae3bca355b1d6b7e58ce7132091ac779a  -
us-west-1a e9163d61923a35da64a407505d267f8217c9e661  -
us-west-1c e17e8905b08e7e3d7a3625579f55788567a565db  -
ap-southeast-1a b8b2a38f9168b62eb2b7d036fd826b1620277531  -
ap-southeast-1b 16cad4e6d6cc0e6b109fdb67ca1fbebc967fa005  -
ap-southeast-2a 0b71661f82e3ffa9c517db94d96649e1ae357f67  -
ap-southeast-2b 349e1da2a79e421387af116c31faf5a737af210d  -
</pre></div></div>

<h3>
<span id="アカウントbでの出力" class="fragment"></span><a href="#%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88b%E3%81%A7%E3%81%AE%E5%87%BA%E5%8A%9B"><i class="fa fa-link"></i></a>アカウントBでの出力</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>eu-west-1a f8f899d9a8c4cd31de6e54bca6863526323bd6e8  -
eu-west-1b 17e8315fe5b4aa486ec536ce810e4bf24309ba02  -
eu-west-1c 12549e7c02ad5b65be4cbc7bb55e2a4a76a58fcd  -
sa-east-1a 21eff3974acec88e893bbab897db977636892aa1  -
sa-east-1b 161d52ac3341fcb9a18679216756ad95ab97069e  -
us-east-1a 3122bb9130554d086ddf0fc8b0c84f6bed89df55  -
us-east-1b 4872eaa5b1b3c1075a46ffd2cf03ae8af8efcb51  -
us-east-1d 316a5a3a7322481e3838a1fa214f7ca642d83035  -
ap-northeast-1a e16e96781d6194cb96c03bd965d6a1a0bd029d2e  -
ap-northeast-1c f62f5300138346db4f84c33cd86deb11574e5501  -
us-west-2a 99bcfa3f2e0b8c257846b0af350c173ac7a6b12f  -
us-west-2b 7f5833cfb883ac6839be234ec03d0975985a0b79  -
us-west-2c 490c895ae3bca355b1d6b7e58ce7132091ac779a  -
us-west-1a e17e8905b08e7e3d7a3625579f55788567a565db  -
us-west-1b e9163d61923a35da64a407505d267f8217c9e661  -
ap-southeast-1a b8b2a38f9168b62eb2b7d036fd826b1620277531  -
ap-southeast-1b 16cad4e6d6cc0e6b109fdb67ca1fbebc967fa005  -
ap-southeast-2a 349e1da2a79e421387af116c31faf5a737af210d  -
ap-southeast-2b 0b71661f82e3ffa9c517db94d96649e1ae357f67  -
</pre></div></div>

<h3>
<span id="判明した対応表" class="fragment"></span><a href="#%E5%88%A4%E6%98%8E%E3%81%97%E3%81%9F%E5%AF%BE%E5%BF%9C%E8%A1%A8"><i class="fa fa-link"></i></a>判明した対応表</h3>

<table>
<thead>
<tr>
<th style="text-align: left">アカウントA</th>
<th style="text-align: left">アカウントB</th>
<th style="text-align: left">ハッシュ値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">eu-west-1a</td>
<td style="text-align: left">eu-west-1b</td>
<td style="text-align: left">17e8315fe5b4aa486ec536ce810e4bf24309ba02</td>
</tr>
<tr>
<td style="text-align: left">eu-west-1b</td>
<td style="text-align: left">eu-west-1c</td>
<td style="text-align: left">12549e7c02ad5b65be4cbc7bb55e2a4a76a58fcd</td>
</tr>
<tr>
<td style="text-align: left">eu-west-1c</td>
<td style="text-align: left">eu-west-1a</td>
<td style="text-align: left">f8f899d9a8c4cd31de6e54bca6863526323bd6e8</td>
</tr>
<tr>
<td style="text-align: left">sa-east-1a</td>
<td style="text-align: left">sa-east-1a</td>
<td style="text-align: left">21eff3974acec88e893bbab897db977636892aa1</td>
</tr>
<tr>
<td style="text-align: left">sa-east-1b</td>
<td style="text-align: left">sa-east-1b</td>
<td style="text-align: left">161d52ac3341fcb9a18679216756ad95ab97069e</td>
</tr>
<tr>
<td style="text-align: left">us-east-1b</td>
<td style="text-align: left">us-east-1d</td>
<td style="text-align: left">316a5a3a7322481e3838a1fa214f7ca642d83035</td>
</tr>
<tr>
<td style="text-align: left"><strong>us-east-1c</strong></td>
<td style="text-align: left"><strong>us-east-1a</strong></td>
<td style="text-align: left">3122bb9130554d086ddf0fc8b0c84f6bed89df55</td>
</tr>
<tr>
<td style="text-align: left">us-east-1d</td>
<td style="text-align: left">us-east-1b</td>
<td style="text-align: left">4872eaa5b1b3c1075a46ffd2cf03ae8af8efcb51</td>
</tr>
<tr>
<td style="text-align: left">ap-northeast-1a</td>
<td style="text-align: left">ap-northeast-1a</td>
<td style="text-align: left">e16e96781d6194cb96c03bd965d6a1a0bd029d2e</td>
</tr>
<tr>
<td style="text-align: left">ap-northeast-1c</td>
<td style="text-align: left">ap-northeast-1c</td>
<td style="text-align: left">f62f5300138346db4f84c33cd86deb11574e5501</td>
</tr>
<tr>
<td style="text-align: left">us-west-2a</td>
<td style="text-align: left">us-west-2b</td>
<td style="text-align: left">7f5833cfb883ac6839be234ec03d0975985a0b79</td>
</tr>
<tr>
<td style="text-align: left">us-west-2b</td>
<td style="text-align: left">us-west-2a</td>
<td style="text-align: left">99bcfa3f2e0b8c257846b0af350c173ac7a6b12f</td>
</tr>
<tr>
<td style="text-align: left">us-west-2c</td>
<td style="text-align: left">us-west-2c</td>
<td style="text-align: left">490c895ae3bca355b1d6b7e58ce7132091ac779a</td>
</tr>
<tr>
<td style="text-align: left">us-west-1a</td>
<td style="text-align: left">us-west-1b</td>
<td style="text-align: left">e9163d61923a35da64a407505d267f8217c9e661</td>
</tr>
<tr>
<td style="text-align: left">us-west-1b</td>
<td style="text-align: left">us-west-1a</td>
<td style="text-align: left">e17e8905b08e7e3d7a3625579f55788567a565db</td>
</tr>
<tr>
<td style="text-align: left">ap-southeast-1a</td>
<td style="text-align: left">ap-southeast-1a</td>
<td style="text-align: left">b8b2a38f9168b62eb2b7d036fd826b1620277531</td>
</tr>
<tr>
<td style="text-align: left">ap-southeast-1b</td>
<td style="text-align: left">ap-southeast-1b</td>
<td style="text-align: left">16cad4e6d6cc0e6b109fdb67ca1fbebc967fa005</td>
</tr>
<tr>
<td style="text-align: left">ap-southeast-2a</td>
<td style="text-align: left">ap-southeast-2b</td>
<td style="text-align: left">0b71661f82e3ffa9c517db94d96649e1ae357f67</td>
</tr>
<tr>
<td style="text-align: left">ap-southeast-2b</td>
<td style="text-align: left">ap-southeast-2a</td>
<td style="text-align: left">349e1da2a79e421387af116c31faf5a737af210d</td>
</tr>
</tbody>
</table>

<p>※ところでこの例だと <strong>us-east-1</strong> がそうなんですが、アカウント毎にAZ名の対応が違うどころかアカウントによっては同名のAZが無いなんてこともあります。こういう場合は更に別の問題も発生しうるので注意しまましょう。（<a href="http://qiita.com/kawaz/items/3bfdec221ee1485b7d0c" id="reference-76e86fa4787040260808">こちらの記事</a>の注意点参照）</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />25位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>32</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/1620300551b5b3f2eccc">危険な crontab -r を封印する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-29 17:33:00</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>cronの設定するとき<code>crontab -e</code>って使うよね？でもこれ結構危険なんです。キーボードの<code>e</code>の隣にある<code>r</code>、これを間違えて<code>crontab -r</code>なんてやってしまったら目も当てられない。何の警告もなしにいきなりcrontabの設定が全部消えちゃうんです！</p>

<p>怖いですねー。実際のところは過去何百回と<code>crontab -e</code>を打ってきたけどこの打ち間違えはしたことがない。でも今日までは大丈夫でも明日やってしまうかもしれない…、そんな不安を少しでも拭えればと最近は bashrc に以下の設定をしています。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">~/.bashrc</span></div>
<div class="highlight"><pre><span></span># crontab -r を封印する
function crontab() {
  local opt
  for opt in "$@"; do
    if [[ $opt == -r ]]; then
      echo 'crontab -r is sealed!'
      return 1
    fi
  done
  command crontab "$@"
}
</pre></div>
</div>

<p>これで間違えて<code>crontab -r</code>を実行しちゃっても大丈夫です。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ crontab -r
crontab -r is sealed!
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />26位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>29</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/f46a484604a07f779989">Qiitaに要望：思ってること色々吐き出してみた</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-07 04:13:16</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="qiitaへの声" class="fragment"></span><a href="#qiita%E3%81%B8%E3%81%AE%E5%A3%B0"><i class="fa fa-link"></i></a>Qiitaへの声</h1>

<h2>
<span id="要望タグごとの人気投稿一覧関連度が高いユーザ一覧がほしい" class="fragment"></span><a href="#%E8%A6%81%E6%9C%9B%E3%82%BF%E3%82%B0%E3%81%94%E3%81%A8%E3%81%AE%E4%BA%BA%E6%B0%97%E6%8A%95%E7%A8%BF%E4%B8%80%E8%A6%A7%E9%96%A2%E9%80%A3%E5%BA%A6%E3%81%8C%E9%AB%98%E3%81%84%E3%83%A6%E3%83%BC%E3%82%B6%E4%B8%80%E8%A6%A7%E3%81%8C%E3%81%BB%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a><a href="http://qiita.com/items/ecb590318bd8ce7a789b">【要望】タグごとの人気投稿一覧、関連度が高いユーザ一覧がほしい</a>
</h2>

<p>僕が下書き書いてる間に似たような投稿があった模様ｗ</p>

<p>そうそう、タグごとの人気投稿とかユーザとか欲しいですよね！</p>

<h2>
<span id="qiitaに要望googleanalyticsに対応してほしい-の-s025236-さんのコメント" class="fragment"></span><a href="#qiita%E3%81%AB%E8%A6%81%E6%9C%9Bgoogleanalytics%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%97%E3%81%A6%E3%81%BB%E3%81%97%E3%81%84-%E3%81%AE-s025236-%E3%81%95%E3%82%93%E3%81%AE%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a><a href="http://qiita.com/items/6afd31583082fdbccb13">Qiitaに要望：GoogleAnalyticsに対応してほしい</a> の <a href="/s025236" class="user-mention js-hovercard" title="s025236" data-hovercard-target-type="user" data-hovercard-target-name="s025236">@s025236</a> さんのコメント</h2>

<blockquote>
<p><a href="http://qiita.com/items/60ff78e93e395ea739b2">1記事投稿してみました</a>がやっぱり次からはブログに書こうか悩んでます。</p>

<p>このサイトへの思いをtwitterに書かせていただきました。<br>
是非ご一読ください＞運営の方</p>

<p><a href="https://twitter.com/s025236/status/342663320811208705" class="autolink" rel="nofollow noopener" target="_blank">https://twitter.com/s025236/status/342663320811208705</a><br>
他の記事みてもLGTM押されてる記事が少ないのだけど何のためについてるの？<br>
<a href="https://twitter.com/s025236/status/342664869302124544" class="autolink" rel="nofollow noopener" target="_blank">https://twitter.com/s025236/status/342664869302124544</a><br>
記事を書いて十分に(6時間以上)時間を置いてもviewが増えないので、(はてなの人には申し訳ないけど)知り合いに協力してもらい無理やり3ハテブしてもらった所Viewが3倍以上に増えました。他のサービスに比べてこのサービスを使うメリットが(今の所)見えません<br>
<a href="https://twitter.com/s025236/status/342666302449664000" class="autolink" rel="nofollow noopener" target="_blank">https://twitter.com/s025236/status/342666302449664000</a><br>
そもそも技術者が集まるサイトなら、(海外では無名に近いもしれませんが)国内では技術者の利用数者が多いはてなブックマークが付きやすい性格のはずですが、他の記事を見ても生活時間の半日放置されてる記事にハテブが付かないというのは如何なものでしょうか？<br>
<a href="https://twitter.com/s025236/status/342668448993796096" class="autolink" rel="nofollow noopener" target="_blank">https://twitter.com/s025236/status/342668448993796096</a><br>
開発者(プログラマ)向けと銘売っていますが、(本来そういった事に疎いはずである)個人の開発者でさえ当たり前のように行ってる事すらしてないように見えます。このサイトは開発者向け(開発者の為に)にどういった努力をされていますか？</p>
</blockquote>

<p>この <a href="/s025236" class="user-mention js-hovercard" title="s025236" data-hovercard-target-type="user" data-hovercard-target-name="s025236">@s025236</a> さんの意見に僕もかなり同意。<br>
Qiitaって実際のところMarkdownで書けるってくらいしか技術者向けっぽいところが無いよね…。</p>

<p>LGTMは分かりにくいのが問題だと思う。わざわざLGTMとは？をマウスオーバーして「（問題無さそう!）の意味です」とか解説書くくらいだったら<code>問題無さそう！</code>ボタンにすればいいのに。→追記20130619：「役に立った」ボタンに変わってた。でも役に立った数は不明？多分色々実装中でたまたまいまないだけかな。</p>

<h3>
<span id="諸々の意見中の人はどう思ってるんだろう" class="fragment"></span><a href="#%E8%AB%B8%E3%80%85%E3%81%AE%E6%84%8F%E8%A6%8B%E4%B8%AD%E3%81%AE%E4%BA%BA%E3%81%AF%E3%81%A9%E3%81%86%E6%80%9D%E3%81%A3%E3%81%A6%E3%82%8B%E3%82%93%E3%81%A0%E3%82%8D%E3%81%86"><i class="fa fa-link"></i></a>諸々の意見、中の人はどう思ってるんだろう？</h3>

<p>コメントとか何も出てこないから何考えてるのかさっぱりわからない。</p>

<p>Markdownプレビュー/テキストエリア内の変な補完/ドラッグドロップでS3へ画像を直アップロードとか、このサイト自体の裏で動いてるオモシロポイントはあるけど、どれも<strong>ユーザにより便利に使ってもらうってよりも、作り手側の気持ちばかりが見える感</strong>、こういう機能作ってみましたどうですか？っていう。技術者向けサイトっていうよりも技術好きが技術ネタのアウトプットとして作ってるサイト、の方がしっくり来るんだよね。</p>

<h1>
<span id="もうついでに思ってること色々書いてみるわ" class="fragment"></span><a href="#%E3%82%82%E3%81%86%E3%81%A4%E3%81%84%E3%81%A7%E3%81%AB%E6%80%9D%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%93%E3%81%A8%E8%89%B2%E3%80%85%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B%E3%82%8F"><i class="fa fa-link"></i></a>もう、ついでに思ってること色々書いてみるわ。</h1>

<ul>
<li>
<p>投稿検索（見せ方）が酷い</p>

<ul>
<li>新着順表示しか出来ないのは相当酷い。過去の有益な投稿がもったいない。</li>
<li>ストック数/閲覧数/コメント数のソートや、それらの週刊/月刊/年間のランキングくらいは欲しいところ。</li>
<li>今良く読まれてる記事くらいトップで見せてくれないと投稿してる人以外には、ただメモの掃き溜めにしか見えないんじゃ…</li>
<li>追記20130619：タグ毎の投稿一覧ページだけ新着ストック順(?)ソートが出来るようになってる！？これはこれで面白いソートキーかも。</li>
</ul>
</li>
<li>
<p>ユーザ検索が酷い</p>

<ul>
<li>
<a href="http://qiita.com/users">ユーザ一覧</a>を見ると…これは酷いと言わざるを得ない(--;。id列挙しただけで投稿数や被ストック数の表示すら無いってどういうこと…。ランキングとかそういうのを期待する以前の問題。</li>
<li>
<a href="http://qiita.com/recommended_users">お勧めユーザページ</a>も、IDだけ並べてその人が何してるのかも分からないのにフォローボタンも何もないですよね。</li>
</ul>
</li>
<li>
<p>コメントのMarkdownソースを見れるようにしてほしい→追記20130621：実装されたとのコメントいただけましたｗ</p>

<ul>
<li>コメントにもMarkdownが使えるのはとても便利ですが、コメントの内容を修正したいと思ったら削除しか出来ません。まぁ、それはいいです。コピペで再投稿しますから。</li>
<li>でもここで気付く、Markdown駆使して書いた力作コメントが一度投稿したら変換後のテキストコピーしか出来ないじゃん！泣く泣く装飾部分をプレビュー見ながら再度追記する羽目になります。これはなんとかしてほしい。</li>
</ul>
</li>
<li>
<p>問合せ窓口が酷い</p>

<ul>
<li>技術者向けをうたうなら、想定ユーザが見慣れてるであろう要望/意見/バグ報告とか登録できてその進捗が見られるバグトラックのような機能がほしい。内製大変なら適当な外部のGithubのIssue活用とかでもいいと思う。</li>
<li>現状はメール/ツイッター/投稿で書くくらいしかなくそれらも見てるのか見てないのかよく分からん。偶に要望投稿がストックされたりしてるから一応見てるっぽい？</li>
<li>これまでもどの手段で意見を言っても中の人のコメントやレスポンスが来たことが無いし届いてるのかすら分からない、暖簾に腕押し。反応がないのがとにかく虚しい。</li>
</ul>
</li>
<li>
<p>通知を強化してほしい</p>

<ul>
<li>自分がストックした投稿にコメントが付いたら続きみたいから通知してほしいな。返信するのにメンション付けてくれる人なんて殆どいないし（そもそもメンション機能知らない人も多いんじゃ…書式ヘルプの<a href="http://qiita.com/items/c686397e4a0f4f11683d">Qiita Markdown</a>にも載ってないし知る機会が無い気が…）追記：なんかこれもいつの間にかお知らせに実装されてる！？</li>
<li>追記：そういえば被ストック通知が欲しいって言ったやつはコメントや返信やアナウンスを見た覚えは無いけど、お知らせにいつの間にか実装されてるのに最近気づいた。</li>
</ul>
</li>
<li>
<p>自分の投稿への反応が分かりにくい</p>

<ul>
<li>Google Analytics とか使えるようにしてほしい（これは数日前に書いたこと）→追記20130625：<a href="http://qiita.com/Qiita/items/c7f704e3786df3aa7a11" id="reference-e45472bfc0f0365a49f3">実装された！</a>
</li>
<li>記事ページのURLにユーザ名を含めてほしい。記事にコメントつけてくれる人はいい、はてブしてくれる人もまだ一覧ページではてブカウター画像で一応雰囲気わかるからまぁいい、でもそうじゃない人も多いからツイートのエゴサーチとかしたい、のに出来ない。別にURLにIDを使うのは構わんのよ、自分のブログならハッシュURLで十分だしドメインやディレクトリ名でサイトURLが絞れるからね、でもQiitaのは無理、全くエゴれないのは何とかして欲しい。そんなこと思ってるの僕だけかな？…Gistも少し前にユーザ名含むURLへリダイレクトするようになったよね、あんな感じ希望なんだが。→追記20130619：いつの間にかURLにユーザ名含むようになってる！過渡期は過去のはてブ数とかが断絶しちゃうから非難もあるだろうけど僕は歓迎です。</li>
</ul>
</li>
<li>
<p>Qiitaの自己主張が激しい</p>

<ul>
<li>タイトルにハッシュタグを入れないで欲しい。特に色んなジャンルの複合ネタな記事を書いた時とか、Qiitaの仕様を知らずに複数タグ付けてると酷いことになる。ツイートやソーシャルブックマークとかで拾われたタイトルがゴチャゴチャしすぎて見辛くてツイートする気も失せる。多分自分だけじゃなく他にもそういう人が居るだろうから得られたであろう反応も減ってしまってると思う。→追記20130619：これもいつの間にかハッシュタグ消えてた！</li>
<li>ツイートボタンの<code>data-text</code>の<code>on @Qiita_jp</code>てのも要らないと思う。タイトルにQiitaってあるから十分じゃ？→追記20130619：少し改善(?)、<a href="/Qiita_jp" class="user-mention js-hovercard" title="Qiita_jp" data-hovercard-target-type="user" data-hovercard-target-name="Qiita_jp">@Qiita_jp</a>じゃなく<a href="/Qiita" class="user-mention js-hovercard" title="Qiita" data-hovercard-target-type="user" data-hovercard-target-name="Qiita">@Qiita</a>になった？</li>
<li>ツイッターカードの<code>twitter:site</code>が<code>@Qiita_jp</code>なのもどうなんだ？Twitterアカウントに連携してたらその人のアカウントにしておいて欲しい。表示されたカード見ると自分が書いたコンテンツなのにまるでQiitaの中の人が書いたみたい、寄稿したつもりじゃないんだけどなぁ。追記：コメントで指摘あったけどsiteはそのままで<code>twitter:creator</code>を付けてくれたら良いのかも。→追記20130619：<code>twitter:creator</code>が付くようになってた！</li>
</ul>
</li>
</ul>

<p>なんかもっとあった気がするけど今出てきたのはとりあえずこんだけ。</p>

<p>QiitaのMarkdownの書きやすさはかなりいいんだけどなー、Qiitaを使ってみようともわせる唯一にして最大のメリット。だが他がイマイチ過ぎるのが残念でならない。</p>

<p>最悪またどっか別のブログにでも戻るかもしれない。→追記20130619：アナウンスは内容だけど、この記事投稿から2週間足らずの現時点までに凄い勢いで実装されてて凄い！</p>

<h1>
<span id="コメントも是非" class="fragment"></span><a href="#%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%82%E6%98%AF%E9%9D%9E"><i class="fa fa-link"></i></a>コメントも是非！</h1>

<p>こんだけ書いても運営の目に止まらずに全部流れたら悲しいので、他の人も思ってることあったらコメントに表明してくれるといいんじゃないかな。→追記20130619：かなり頑張っていただいているみたい。ありがたいです(^^;</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />27位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>28</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/67c00a7fe9de45e0128a">sshの接続先毎にメモを表示させる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-17 13:16:13</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[SSH]</b> <b>[Security]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>凄くニッチな需要だと思うメモ。</p>

<p>ssh接続自体は公開鍵認証で楽ちんログインしてるんだけど…</p>

<ul>
<li>接続先サーバで<code>su</code>する際のパスワードを覚えてられない</li>
<li>パスワードを変更する権限が自分にないし、NOPASSWORDでsudoする設定も禁止</li>
<li>接続先サーバ上にpassword.txtとかっていうあからさまなメモを置くのもはばかられる</li>
</ul>

<p>などという理由で仕方なく毎回自分の手元にあるパスワードメモファイルを探して開いてコピペするという作業をしてる人用の設定。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">~/.ssh/config</span></div>
<div class="highlight"><pre><span></span>Host example.jp
  User oreore
  PermitLocalCommand yes
  LocalCommand echo 'rootの成り方: sudo su #pass:xyzabc'
</pre></div>
</div>

<p>こんな風にしておけばログインした時に、コピペ用のパスワードがぶっちゃけ表示されますｗ<br>
もちろんセキュリティ的にはアレなので、ローカルの~/.ssh/configの管理をしっかりした上に、ショルダーハックされないような状況でしか使うべきではないので、多用厳禁ですよ！<br>
でも年に1度入るかどうかていうサーバのパスワードとか正直覚えてないし、そのサーバ情報の資料を探すのも大変な時があるのでね、うん…。</p>

<p>ちなみに oreore でログイン後、oreore_admin に一度<code>su</code>して、更にoreore_admin状態で<code>sudo su</code>する必要があるような場合は↓こんなふうにすれば一発でsuとsudo suが出来るのでこれをechoしとくもよし。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>su oreore_admin --session-command <span class="s2">"exec sudo su"</span> <span class="c1">#pass:xyzabc</span>
</pre></div></div>

<p>suでコマンド実行するときは -c てオプションもあるけどsudoの場合は普通ttyを要求されるので --session-command オプションの方を使うのが良い。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />28位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>23</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/a86370c9908367bcb509">IAMで特定セキュリティグループの設定の追加削除が出来るようにする設定</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-03 20:12:18</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[IAM]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>IPがコロコロ変わる人が居て、毎回IP追加のお願いに対応するのが面倒なので、もうIP変わる度に自分でsshの接続元設定を追加削除してくれやー。</p>

<p>でも特定セキュリティグループの設定以外は何もかも出来なくしたIAMユーザを使わせたい、というときに設定するポリシー。</p>

<p>SecurityGroupAccessとか適当な名前を付けて設定する。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "Stmt1393841669000",
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeSecurityGroups"
      ],
      "Resource": "*"
    },
    {
      "Sid": "Stmt1393841669001",
      "Effect": "Allow",
      "Action": [
        "ec2:AuthorizeSecurityGroupEgress",
        "ec2:AuthorizeSecurityGroupIngress",
        "ec2:RevokeSecurityGroupEgress",
        "ec2:RevokeSecurityGroupIngress"
      ],
      "Resource": [
        "arn:aws:ec2:ap-northeast-1:123456789012:security-group/sg-aabbccdd"
      ]
    }
  ]
}
</pre></div></div>

<p><code>ap-northeast-1</code>とか<code>123456789012</code>とか<code>sg-aabbccdd</code>は、それぞれリージョン、アカウントID、セキュリティグループIDに書き換えて使う。</p>

<p>DescribeSecurityGroupsはセキュリティグループ一覧の表示に必要なので "<em>" にせざるを得ない。不要なセキュリティグループの設定も見れてしまうが見れるだけで修正は出来ないから割りきって諦める。<br>
AuthorizeSecurityGroup</em>は設定の追加、RevokeSecurityGroup*は設定の削除に必要な権限、EgressとIngressはそれぞれOutboundルールとInboundルールのこと。Inboundの設定追加と削除だけなら*Egressの権限は付けなくて良かったね。</p>

<p>ホントはAllTraficを許可したり好きなポートを開けたり出来ないよう、更に指定できるポートの条件も追加したいとこで、多分Condition設定を追加すれば出来るかもしれないが今日はそこまで調べてない。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />29位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>20</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/b29eef5e1934b1995949">Bashでn進数を扱うには</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-29 13:09:36</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Bashの算術式では<code>0755</code>で8進数や<code>0x1a</code>で16進数といった表記をを扱うことが出来ますが、<code>基数#数字…</code> で2～64進数までの全てが使えることは余り知られてないと思うのでメモ。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="c1"># 2進数</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">2#101</span> <span class="k">))</span>         <span class="c1"># 5</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">2#101</span> <span class="o">&amp;</span> <span class="m">2#100</span> <span class="k">))</span> <span class="c1"># 4 (=2#100)</span>

<span class="c1"># 8進数</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">0744</span> <span class="k">))</span>   <span class="c1"># 484</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">8#744</span> <span class="k">))</span>  <span class="c1"># 484</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">8#0744</span> <span class="k">))</span> <span class="c1"># 484</span>

<span class="c1"># 16進数</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">0</span>xff <span class="k">))</span>  <span class="c1"># 255</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">16#</span>ff <span class="k">))</span> <span class="c1"># 255</span>

<span class="c1"># 62進数 fの続きはzまで行って更にA～Zへと続く！</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">62#</span>f <span class="o">+</span> <span class="m">62#</span>z <span class="o">+</span> <span class="m">62#</span>A <span class="o">+</span> <span class="m">62#</span>Z <span class="k">))</span> <span class="c1"># 147 (=15+35+36+61)</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">62#10</span> <span class="k">))</span> <span class="c1"># 62</span>

<span class="c1"># 64進数 Zの続きは @ と _ だ！もはやイミフｗ</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">64#</span>Z <span class="k">))</span>  <span class="c1"># 61</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">64#</span>@ <span class="k">))</span>  <span class="c1"># 62</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">64#</span>_ <span class="k">))</span>  <span class="c1"># 63</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">64#10</span> <span class="k">))</span> <span class="c1"># 64</span>

<span class="c1"># 65進数～は扱えないようだ</span>
<span class="nb">echo</span> <span class="k">$((</span> <span class="m">65#10</span> <span class="k">))</span> <span class="c1"># invalid arithmetic base (error token is "65#10")</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />30位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/1b64defd2997feb3f924">IEの互換モードを無視して標準モードで動かす</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-27 16:03:38</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[jQuery]</b> <b>[IE]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>普段IE使わないから互換モードの設定によってCORSなAJAXが出来ない問題とかでハマった、のでメモ。</p>

<h2>
<span id="互換モードを無視して常に標準モードで表示されるようにする" class="fragment"></span><a href="#%E4%BA%92%E6%8F%9B%E3%83%A2%E3%83%BC%E3%83%89%E3%82%92%E7%84%A1%E8%A6%96%E3%81%97%E3%81%A6%E5%B8%B8%E3%81%AB%E6%A8%99%E6%BA%96%E3%83%A2%E3%83%BC%E3%83%89%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>互換モードを無視して常に標準モードで表示されるようにする</h2>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content</span><span class="o">=</span><span class="s">"IE=Edge"</span> <span class="p">/&gt;</span>
</pre></div></div>

<p>このmetaタグを書いておけば互換モードで表示されるのを防げる。</p>

<h2>
<span id="jqueryでクロスドメインなajaxする場合の互換性対策" class="fragment"></span><a href="#jquery%E3%81%A7%E3%82%AF%E3%83%AD%E3%82%B9%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%AAajax%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E4%BA%92%E6%8F%9B%E6%80%A7%E5%AF%BE%E7%AD%96"><i class="fa fa-link"></i></a>jQueryでクロスドメインなAJAXする場合の互換性対策</h2>

<div class="code-frame" data-lang="html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span> <span class="na">src</span><span class="o">=</span><span class="s">"//cdnjs.cloudflare.com/ajax/libs/jquery-ajaxtransport-xdomainrequest/1.0.1/jquery.xdomainrequest.min.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div></div>

<p>とかも入れておくとよい。</p>

<h2>
<span id="あとスキーマ問題も" class="fragment"></span><a href="#%E3%81%82%E3%81%A8%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E5%95%8F%E9%A1%8C%E3%82%82"><i class="fa fa-link"></i></a>あとスキーマ問題も</h2>

<p><code>$.getJSON("https://〜")</code> とかじゃなく <code>$.getJSON("//〜")</code> に変えておくとスキーマが違うエラーを回避できる。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />31位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/ddc50dc2cada3024720e">一括請求で連結したアカウントを横断してEC2インスタンスリストを表示してリザーブドインスタンスを最適化する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-03-06 14:06:08</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[EC2]</b> <b>[IAM]</b> <b>[STS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>AWSには<a href="http://docs.aws.amazon.com/ja_jp/awsaccountbilling/latest/about/consolidatedbilling.html" rel="nofollow noopener" target="_blank">一括請求（ConsolidatedBilling）</a>という機能があります。これは複数アカウントの請求を一つの親アカウントに結合して決済を行う機能ですが、そのメリットは請求の一元化だけに留まらず、ボリュームディスカウント対象の容量統合や未使用リザーブドインスタンスの共用など、金銭面のメリットも大きいという嬉しい機能です。</p>

<p>さてそんなメリットですが、複数案件でAWSアカウントを分けて使ってそれぞれのアカウントでEC2インスタンスを起動したりReservedInstanceを購入して更にいくつかの案件はもう終わっててーみたいな運用を続けていると、全体でいくつのインスタンスが起動していてRIを余らせたりしていないか？などの把握が段々難しくなってきます。</p>

<p>特にせっかくRIを持ってるのにAZが違っていて適用されてないだとかは非常に勿体無い、更にはMulti-AZでオートスケールしてるインスタンスがたまたまaゾーンに偏っててcゾーン用のRIが余る状況が出来ちゃったりとかもあるし。</p>

<p>そんな理由から全アカウントを横断して describe-instances と describe-reserved-instances を実行して一覧表示したりしたいと思ったわけです。</p>

<h1>
<span id="作り途中のチラ見せスクリーンショット" class="fragment"></span><a href="#%E4%BD%9C%E3%82%8A%E9%80%94%E4%B8%AD%E3%81%AE%E3%83%81%E3%83%A9%E8%A6%8B%E3%81%9B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88"><i class="fa fa-link"></i></a>作り途中のチラ見せスクリーンショット</h1>

<p>とりあえず今直近でやりたかったことはReservedInstanceの棚卸しでSTSの実験がてらシコシコと作ったツールのスクショがこちらです。</p>

<p><a href="https://camo.qiitausercontent.com/9a8572470484cbaf3b2982b0f9dc997832c3277a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f31613261613034322d366230652d633031612d633136632d3033363162633566643739302e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/9a8572470484cbaf3b2982b0f9dc997832c3277a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f31613261613034322d366230652d633031612d633136632d3033363162633566643739302e706e67" alt="4114711.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/18726/1a2aa042-6b0e-c01a-c16c-0361bc5fd790.png"></a></p>

<ul>
<li>上の方は起動中のEC2インスタンスとリザーブドインスタンスをずらっとダンプしたもので、頭の数字は起動数で、@がついてるのはスポットインスタンス、マイナスがついてるのはReservedInstanceです。</li>
<li>下の方は見やすくまとめたやつで頭の数字は、オンデマンドインスタンスとリザーブドインスタンスの相殺数、オンデマンドインスタンス数、リザーブドインスタンス数、スポットインスタンス数となっています。</li>
<li>重要なのは頭のsumの数字ですこれが…

<ul>
<li>0だとリザーブドインスタンスがキッチリ使えてていい感じ</li>
<li>プラスの場合はリザーブドインスタンスが適用されてないのでRI購入を検討する</li>
<li>マイナスの場合はリザーブドインスタンスが余ってるので勿体無い！</li>
<li>特に同じインスタンスファミリーでプラスとマイナスが両方あるというミスマッチが最悪です。お金の無駄です。要はインスタンスタイプやAZが一致していなくて割引が適用されていないという状況です。</li>
</ul>
</li>
</ul>

<p>で、コレを見ながら余ってるRIをmodifyして別のインスタンスタイプに分割や統合したり、AZの変更をしたりすることで無駄を取り除いてコストを最適化したりするわけです。<br>
今後の利用計画の絡みもあるはずなので、完全にプラマイゼロは目指さずに適当なバランスまでいけたとこで妥協します。</p>

<p>あと特に想定外だったのは、Multi-AZのオートスケールを複数設定してたら運悪く端数分のインスタンスが一つのAZに偏ってしまって、反対のAZのRIを無駄にした上に高額料金を支払っていることに気がつかない。なんて勿体無いことがあります。こういうのは早めに気がついて直したいですよね。<br>
とりあえず今日は一覧が出来るようになったので、次はRIのタイプやAZの偏りを発見したらその調整まで自動で行なってくれるようにしようかなぁと企んでます。</p>

<p>今はまだかなり恥ずかしい感じのコードなので整理してそのうちGithub辺りに公開しておきます。需要があるかは知らんけどｗ</p>

<h1>
<span id="実装方法" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>実装方法</h1>

<p>横断的にdescribeする為に、対象の全アカウントのアクセスキーとシークレットをコピペで集めて一箇所で管理するのはセキュリティ的にも運用的にもあまりかっこよくないので、<a href="http://docs.aws.amazon.com/STS/latest/APIReference/Welcome.html" rel="nofollow noopener" target="_blank">AWS Security Token Service</a>を使っています。STSは何かというと、適切な権限を持った有効期限付きのアクセスキーを一時的に発行したり出来るという地味に重要なサービスです。</p>

<p>流れとしては、以下の様な感じになってます。</p>

<h2>
<span id="まず下準備" class="fragment"></span><a href="#%E3%81%BE%E3%81%9A%E4%B8%8B%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>まず下準備</h2>

<ul>
<li>親アカウントにIAMロール<code>ConsolidatedAuditor</code>を作る（別に一括請求の親アカウントである必要は特に無い）</li>
<li>全アカウントにIAMロール<code>ConsolidatedReader</code>を作る（親アカウントの情報も知りたいので親でも作る）</li>
<li>親のConsolidatedAuditorロールのPermissionに以下のポリシーを設定する。これは他アカウントのConsolidatedReaderという名前のIAMロールに対してAssumeRoleを実行出来るようにする設定です。（ここではAssumeRoleのAPIコールの実行を許可しただけで、実際に権限をもらえるかどうかは相手側の許可も必要です）</li>
</ul>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
  <span class="nt">"Statement"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"Sid"</span><span class="p">:</span> <span class="s2">"Stmt1388045626000"</span><span class="p">,</span>
      <span class="nt">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
      <span class="nt">"Action"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"sts:AssumeRole"</span>
      <span class="p">],</span>
      <span class="nt">"Resource"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"arn:aws:iam::*:role/ConsolidatedReader"</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div></div>

<ul>
<li>全アカウントのConsolidatedReaderロールのパーミッションにPolicyTemplateからRead Only Accessを選んで追加する。（今はEC2インスタンスとリザーブドインスタンスの一覧を取得したいだけだけど、今後RDSとかElastiCacheとかRoute53のゾーンリストとか色々見たくなると思うので。気前よくReadOnlyAccessを使った）</li>
<li>更にConsolidatedReaderロールの<code>Trust Relationships</code>に以下のJSONを設定する。（Principal-&gt;AWSに設定しているのはConsolidatedAuditorのARNです。これによってアカウントをまたいだロール権限の引き渡しができるようになります。STSのキモです。）</li>
</ul>

<div class="code-frame" data-lang="json"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
  <span class="nt">"Statement"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"Sid"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="nt">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
      <span class="nt">"Principal"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"AWS"</span><span class="p">:</span> <span class="s2">"arn:aws:iam::112233445566:role/ConsolidatedAuditor"</span>
      <span class="p">},</span>
      <span class="nt">"Action"</span><span class="p">:</span> <span class="s2">"sts:AssumeRole"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div></div>

<h2>
<span id="apiコールの流れ" class="fragment"></span><a href="#api%E3%82%B3%E3%83%BC%E3%83%AB%E3%81%AE%E6%B5%81%E3%82%8C"><i class="fa fa-link"></i></a>APIコールの流れ</h2>

<p>IAM関連の準備ができたところで、今度は実際に各アカウント毎にDescribeInstancesとかを呼びまります。基本的な手順は以下のようになります。</p>

<ul>
<li>まず親アカウントでConsolidatedAuditorロールを付けたEC2インスタンスを起動します。t1.microで十分です。以後の作業はこのインスタンス上で行います。</li>
<li>全アカウントのConsolidatedReaderロールのARNリストは事前に集めておいて配列か何かで持っておきます。</li>
<li>各アカウントのロールARNの権限をよこせーと、順番にAWS.STSのassumeRoleを実行しまくります。</li>
<li>AssumeRoleが成功すれば各アカウントの有効期限付きのクレデンシャル（アクセスキーとシークレットとセッショントークン）が取得できます。（他のAPI使う度に取得してたら大変なのでこれはキャッシュしておくと後の作業が捗ります）</li>
<li>各アカウントのクレデンシャルを使ってDescribeInstancesとか必要なAPIを必要なだけ呼びまくる。</li>
</ul>

<p>以上です。IAMとSTSの全体像が分かってしまえば案外シンプルですが最初はかなり戸惑うことだと思います。やりたいことを思い浮かべながら何度かIAM設定の下準備辺りをやってみれば何となく分かってくるかと…。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />32位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>18</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/a538a7aa0342335d922d">tmuxのステータスラインの色を起動したホスト毎に変える</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-28 13:41:59</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[tmux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="動機" class="fragment"></span><a href="#%E5%8B%95%E6%A9%9F"><i class="fa fa-link"></i></a>動機</h1>

<ol>
<li>自宅でMBAでtmux起動して作業したり、会社のPCでtmuxして作業したり、リモートにsshしてからtmux起動して作業したり、しかも更にそれらを入れ子で行ったり、といったふうに使い方に応じて色んな場所でtmuxを起動してるんだが…。</li>
<li>たまに今作業してる端末がどこのtmuxなのか勘違いしたまま作業をしてしまい、あれ？てなることがあります。</li>
<li>一応ステータスラインの脇の方にホスト名は表示してるので確認すればわかるんだけど、普段はあまり目に入らない模様。</li>
<li>そんなわけでより目に入りやすいステータスライン全体の色を変えたら良いんじゃないかなってことで試してみた。</li>
</ol>

<h1>
<span id="設定内容" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E5%86%85%E5%AE%B9"><i class="fa fa-link"></i></a>設定内容</h1>

<p>自分用の設定ファイルは基本<a href="https://github.com/kawaz/dotfiles" rel="nofollow noopener" target="_blank">github</a>で管理しててどのホストでも共通のを使ってるので環境変数をみて切り替えるようにしてみた。</p>

<h2>
<span id="tmuxconf-の抜粋" class="fragment"></span><a href="#tmuxconf-%E3%81%AE%E6%8A%9C%E7%B2%8B"><i class="fa fa-link"></i></a>~/.tmux.conf の抜粋。</h2>

<p>デフォルト(その他サーバ)はマゼンダ、仕事PC(ホスト名:trooper)はシアン、MacbookAirは緑にしてます。</p>

<div class="code-frame" data-lang="text">
<div class="code-lang"><span class="bold">~/.tmux.conf</span></div>
<div class="highlight"><pre><span></span>set-option -g status-bg magenta
if-shell '[[ "$HOSTNAME" == "trooper" ]]' "set-option -g status-bg cyan"
if-shell '[[ "${OSTYPE:0:6}" == "darwin" ]]' "set-option -g status-bg green"
</pre></div>
</div>

<p><code>if-shell</code>は便利です、ここでは適当に環境変数をみて設定を上書きしてます。</p>

<ul>
<li>
<code>HOSTNAME</code>は言わずもがな</li>
<li>
<code>OSTYPE</code>が<code>darwin</code>ってのはMac OSチェックです。</li>
</ul>

<h2>
<span id="適用後の見た目" class="fragment"></span><a href="#%E9%81%A9%E7%94%A8%E5%BE%8C%E3%81%AE%E8%A6%8B%E3%81%9F%E7%9B%AE"><i class="fa fa-link"></i></a>適用後の見た目</h2>

<p>こんな感じ。<br>
<a href="https://camo.qiitausercontent.com/236dfad9693d53d6a096dd47fafbb5a1868e47bc/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f792d6b6177617a2f32303133303331392f32303133303331393134323730382e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/236dfad9693d53d6a096dd47fafbb5a1868e47bc/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f792d6b6177617a2f32303133303331392f32303133303331393134323730382e706e67" alt="screenshot" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/y-kawaz/20130319/20130319142708.png"></a></p>

<p>現在の作業端末がわかりやすくなって満足です。</p>

<p>ところでこの入れ子のスクリーンショット取ってて気づいてしまったんだが、各ホストで時計ズレ過ぎｗｗ この後ntpdateした上でntpdが起動するようにしておきました(^^;</p>

<h1>
<span id="はてダからのセルフ転載です" class="fragment"></span><a href="#%E3%81%AF%E3%81%A6%E3%83%80%E3%81%8B%E3%82%89%E3%81%AE%E3%82%BB%E3%83%AB%E3%83%95%E8%BB%A2%E8%BC%89%E3%81%A7%E3%81%99"><i class="fa fa-link"></i></a>はてダからのセルフ転載です</h1>

<p>via. <a href="http://d.hatena.ne.jp/y-kawaz/20130319/1363672391" class="autolink" rel="nofollow noopener" target="_blank">http://d.hatena.ne.jp/y-kawaz/20130319/1363672391</a><br>
新はてダの存在により旧はてダが阻害されてる感に辟易したのでQiitaへ脱出中</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />33位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>17</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/23f23b89aab978e60f71">Google日本語入力の辞書を複数PCでクラウド同期させる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-28 01:27:09</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> <b>[Windows]</b> <b>[Google日本語入力]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="同期辞書の廃止が決定oｵﾜﾀ" class="fragment"></span><a href="#%E5%90%8C%E6%9C%9F%E8%BE%9E%E6%9B%B8%E3%81%AE%E5%BB%83%E6%AD%A2%E3%81%8C%E6%B1%BA%E5%AE%9Ao%EF%BD%B5%EF%BE%9C%EF%BE%80"><i class="fa fa-link"></i></a>同期辞書の廃止が決定！＼(^o^)／ｵﾜﾀ</h1>

<p><a href="http://googledevjp.blogspot.jp/2013/12/google.html" rel="nofollow noopener" target="_blank">Google 日本語入力開発版の同期機能廃止について - Google Japan Developer Relations Blog</a></p>

<p>これによると2013年12月9日をもって終了らしいです。</p>

<p>廃止理由も書かずにサラッと終了とか…、Google Readerのトラウマに続いてまたかって感じですね。もうGoogleのプロダクトやサービスは安心して使えないとみんな学習しだしてると思う。</p>

<p>多分今後Googleが何か新サービス出してもみんな警戒してすぐには使わない→ユーザ伸びない→廃止っていう駄目スパイラルになってくんじゃないかしら。</p>

<h1>
<span id="以下元々の本文" class="fragment"></span><a href="#%E4%BB%A5%E4%B8%8B%E5%85%83%E3%80%85%E3%81%AE%E6%9C%AC%E6%96%87"><i class="fa fa-link"></i></a>以下、元々の本文。</h1>

<h2>
<span id="序文読み飛ばして良い" class="fragment"></span><a href="#%E5%BA%8F%E6%96%87%E8%AA%AD%E3%81%BF%E9%A3%9B%E3%81%B0%E3%81%97%E3%81%A6%E8%89%AF%E3%81%84"><i class="fa fa-link"></i></a>序文（読み飛ばして良い）</h2>

<p>僕は自宅やノートPCや会社や実家などいろんな環境でPCを使っています。最近はIMEならGoogle日本語入力、ブラウザはChrome、後は適当なターミナルソフト、この３大アプリがあればWindowsだろうがMacだろうがLinuxだろうがほぼ同じ環境みたいなもんで作業の９割はできちゃいます。Googleのお陰で便利になったもんだｗｗ</p>

<p>んで、便利といえばChromeのブックマークやパスワード同期ですがこれが超便利。複数PCどころかスマホでも同期できちゃうしね！</p>

<p>そんな便利なクラウド同期機能なんだけど、Google日本語入力の辞書も同期したいよねー、Googleなのに何で無いの？と最近まで思ってたんですが…、実はもう１年くらい前から辞書のクラウド同期ができるようになってたんですね！</p>

<p>当然のことながら、Windows、Macの両方で対応してて双方向に同期できます！</p>

<h1>
<span id="設定方法" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95"><i class="fa fa-link"></i></a>設定方法</h1>

<p>前置きが長くなりましたが設定方法です。Google日本語入力の設定画面のどこを探してもクラウド同期機能なんて見つからない？それもそのはず、実はまだ辞書のクラウド同期は <strong>開発版にしか無い</strong> んです！そりゃーいくら探したって見つからないわけだ…。</p>

<h2>
<span id="開発版をインストール" class="fragment"></span><a href="#%E9%96%8B%E7%99%BA%E7%89%88%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fa fa-link"></i></a>開発版をインストール</h2>

<p>お手元のGoogle日本語入力が通常版なら、まずは開発版にアップデートするとこから始まります。ダウンロードは↓こちらから（これ実は通常版のダウンロードページの下の方からもこっそりリンクが張ってあります）。<br>
<a href="https://tools.google.com/dlpage/japaneseinput/eula.html?hl=ja&amp;extra=dev" class="autolink" rel="nofollow noopener" target="_blank">https://tools.google.com/dlpage/japaneseinput/eula.html?hl=ja&amp;extra=dev</a></p>

<p>開発版なだけに通常版よりも同意項目が多いですが、同意しないとインストール出来ませんのでまぁそこは各人でご判断ください。</p>

<h2>
<span id="クラウドタブ登場" class="fragment"></span><a href="#%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E3%82%BF%E3%83%96%E7%99%BB%E5%A0%B4"><i class="fa fa-link"></i></a>クラウドタブ登場</h2>

<p>さて無事、開発版Google日本語入力のインストールが済みましたらおもむろに設定画面を開いてみましょう。</p>

<p><a href="https://camo.qiitausercontent.com/589e4ed02bacde9d401a13b8d7a77e145dc9f4c9/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f792d6b6177617a2f32303133303432382f32303133303432383030343831322e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/589e4ed02bacde9d401a13b8d7a77e145dc9f4c9/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f792d6b6177617a2f32303133303432382f32303133303432383030343831322e706e67" alt="クラウドタブ" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/y-kawaz/20130428/20130428004812.png"></a><br>
はい出た！クラウドタブが出ました！あとはボタンをぽちっと押して指示通りにGoogleにログインして連携設定すればOKです。</p>

<h2>
<span id="同期用辞書" class="fragment"></span><a href="#%E5%90%8C%E6%9C%9F%E7%94%A8%E8%BE%9E%E6%9B%B8"><i class="fa fa-link"></i></a>同期用辞書</h2>

<p>するとユーザ辞書内に<code>同期用辞書</code>ってのが出来てるはずなので、ここに適当な単語を追加しておくとそれが全PCでほぼリアルタイムで有効になるわけですね。<br>
<a href="https://camo.qiitausercontent.com/e41ed8fd46a48cbc48e5bcd5b765363d51a2664d/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f792d6b6177617a2f32303133303432382f32303133303432383031313734355f6f726967696e616c2e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/e41ed8fd46a48cbc48e5bcd5b765363d51a2664d/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f792f792d6b6177617a2f32303133303432382f32303133303432383031313734355f6f726967696e616c2e706e67" alt="クラウド辞書" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/y/y-kawaz/20130428/20130428011745_original.png"></a></p>

<p>んー、便利！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />34位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/0c3535f57e5aec63635b">Parallels内Windows上のGoogle日本語入力のIMEの有効無効を英数とかなキーで切り替える</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-11-01 16:35:16</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Mac]</b> <b>[Parallels]</b> <b>[IME]</b> <b>[日本語入力]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Parallels使ってるとMacbookAirのキーボードには半角全角キーが無いのでIME切替で困る。なのでMacと同じようにParallelsの中でも英数・かなキーで切り替えられるようにするメモ。</p>

<ol>
<li>Parallels内のGoogle日本語入力のプロパティを開く</li>
<li>一般タブ→キー設定の選択→編集…をクリック</li>
<li>まず入力キーでソートする</li>
<li>
<code>Eisu</code>と<code>Muhenkan</code>キーに対して全てのモードのコマンドを<code>IMEを無効化</code>にする</li>
<li>
<code>Hiragana</code>キーに対して全てのモードのコマンドを<code>IMEを有効化</code>にする</li>
</ol>

<p><code>Eisu</code>だけじゃなく<code>Muhenkan</code>にも設定していけないといけなかった。<br>
まぁ、多分不要なモード設定もしてるかもしれないけどとりあえずこれで期待通りの動作になるし細かくモード考えるより分かりやすい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />35位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/fe1fe8361e375f61b54a">unsetの-fと-v、もしくは関数と変数の名前空間について</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-05 13:43:07</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Bashスクリプトで変数を削除するときに<code>unset</code>を使いますが、これは関数定義の削除にも使えます。<code>-f</code>と<code>-v</code>オプションは関数と変数のどっちを削除したいかを明確にするオプションです。</p>

<h3>
<span id="bashにおける関数と変数の名前空間" class="fragment"></span><a href="#bash%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E9%96%A2%E6%95%B0%E3%81%A8%E5%A4%89%E6%95%B0%E3%81%AE%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93"><i class="fa fa-link"></i></a>Bashにおける関数と変数の名前空間</h3>

<p>は、分かれています。なので以下のように同名の関数と変数を作っても区別して使えます。</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>f<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> func<span class="p">;</span> <span class="o">}</span>
<span class="nv">f</span><span class="o">=</span>valiable
f        <span class="c1"># func が表示される</span>
<span class="nb">echo</span> <span class="nv">$f</span>  <span class="c1"># valiable が表示される</span>
</pre></div></div>

<h3>
<span id="unsetで削除されるのは" class="fragment"></span><a href="#unset%E3%81%A7%E5%89%8A%E9%99%A4%E3%81%95%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%AF"><i class="fa fa-link"></i></a>unsetで削除されるのは？</h3>

<p><code>unset</code>は変数も関数も削除できます。では同名の関数と変数があった場合はどうなるんでしょう？</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>f<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> func<span class="p">;</span> <span class="o">}</span>
<span class="nv">f</span><span class="o">=</span>valiable

<span class="nb">unset</span> f  <span class="c1"># オプション無しでunset</span>
f        <span class="c1"># func が表示される　…関数は残ってる</span>
<span class="nb">echo</span> <span class="nv">$f</span>  <span class="c1"># (空)　…変数だけ削除された！</span>

<span class="nb">unset</span> f  <span class="c1"># もう1回unsetしてみる</span>
f        <span class="c1"># -bash: f: command not found　…関数も削除された！</span>
<span class="nb">echo</span> <span class="nv">$f</span>  <span class="c1"># (空)</span>
</pre></div></div>

<p>というわけで同名の関数と変数がある場合は変数だけが削除されて、同名の変数が無ければ関数が削除されます。</p>

<h3>
<span id="関数または変数を狙って消すには" class="fragment"></span><a href="#%E9%96%A2%E6%95%B0%E3%81%BE%E3%81%9F%E3%81%AF%E5%A4%89%E6%95%B0%E3%82%92%E7%8B%99%E3%81%A3%E3%81%A6%E6%B6%88%E3%81%99%E3%81%AB%E3%81%AF"><i class="fa fa-link"></i></a>関数または変数を狙って消すには？</h3>

<p>そこで登場するのが<code>-f</code>と<code>-v</code>です。<code>-f</code>は関数のみを消すオプションで、<code>-v</code>は変数のみを消すオプションです。</p>

<div class="code-frame" data-lang="sh"><div class="highlight"><pre><span></span>f<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> func<span class="p">;</span> <span class="o">}</span>
<span class="nv">f</span><span class="o">=</span>valiable
<span class="nb">unset</span> -f f  <span class="c1"># 関数を消す！</span>
f           <span class="c1"># -bash: f: command not found　…関数が消えた！</span>
<span class="nb">echo</span> <span class="nv">$f</span>     <span class="c1"># valiableが表示される …変数は残ってる！</span>

f<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> func<span class="p">;</span> <span class="o">}</span>
<span class="nv">f</span><span class="o">=</span>valiable
<span class="nb">unset</span> -v f  <span class="c1"># 変数を消す！</span>
f           <span class="c1"># funcが表示される　…関数は残ってる</span>
<span class="nb">echo</span> <span class="nv">$f</span>     <span class="c1"># (空)              …変数が消えた</span>

f<span class="o">()</span> <span class="o">{</span> <span class="nb">echo</span> func<span class="p">;</span> <span class="o">}</span>
<span class="nv">f</span><span class="o">=</span>valiable
<span class="nb">unset</span> -fv f
<span class="c1"># -bash: unset: cannot simultaneously unset a function and a variable</span>
<span class="c1"># 一緒に消すことは出来ないみたいです</span>

usnet -f f<span class="p">;</span> <span class="nb">unset</span> -v f <span class="c1"># 改めて両方消します</span>
<span class="c1"># この状態で更にunsetしても特にエラーは出ません</span>
<span class="nb">unset</span> -f f<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>  <span class="c1"># 0</span>
<span class="nb">unset</span> -v f<span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>  <span class="c1"># 0</span>
<span class="nb">unset</span> f   <span class="p">;</span> <span class="nb">echo</span> <span class="nv">$?</span>  <span class="c1"># 0</span>
</pre></div></div>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<ul>
<li>bashにおける関数と変数の名前空間は別である</li>
<li>オプション無しで<code>unset</code>するとその時の状態により関数が消えたり変数が消えたりする</li>
<li>自分が何を消したいのかをハッキリさせるには<code>unset</code>に<code>-f</code>や<code>-v</code>を付けるべし（潔癖症）</li>
<li>そもそも関数と変数に同じ名前を使わない方が良いｗ（普通の人）</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />36位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>16</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/ba6140bca32bbd3cb928">nvmとかnpmとかrvmとかの補完スクリプトを遅延読込させる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-29 18:13:44</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Ruby]</b> <b>[ShellScript]</b> <b>[Bash]</b> <b>[Node.js]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>bash_completionの話です。<code>npm</code>とか<code>nvm</code>とか<code>rvm</code>とかにはそれ自身のコマンドライン補完を補助するスクリプトがついていて、~/.bashrc とかでそれを読み込んでおけば便利に使えるように出来ています。</p>

<p>例えば今までは↓こんなふうにしてました。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">~/.bashrc</span></div>
<div class="highlight"><pre><span></span># npm の補完が効くようにする
which npm &gt;/dev/null 2&gt;&amp;1 &amp;&amp; . &lt;(npm completion)
# nvm の補完が効くようにする
[[ -f ~/.nvm/bash_completion ]] &amp;&amp; . ~/.nvm/bash_completion
# rvm の補完が効くようにする
[[ -f ~/.rvm/scripts/completion ]] &amp;&amp; . ~/.rvm/scripts/completion
</pre></div>
</div>

<p>ですがいつもこれらコマンドを使うわけでもないのにそこそこ大きい補完スクリプトを、毎回読み込んでるのは、メモリの無駄だし起動時間だって1ミリ秒も無駄にしたくない。そう思って以下のように設定を変えてみました。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">~/.bashrc</span></div>
<div class="highlight"><pre><span></span># 初めてnpmの補完を実行するまで読み込みを遅延する
function _npm_completion() {
  unset _npm_completion
  complete -r npm
  if which npm &gt;/dev/null 2&gt;&amp;1; then
    . &lt;(npm completion) &amp;&amp; return 124
  fi
}
complete -F _npm_completion npm

# 初めてnvmの補完を実行するまで読み込みを遅延する
function _nvm_completion() {
  unset _nvm_completion
  complete -r nvm
  if [[ -f ~/.nvm/bash_completion ]]; then
    . ~/.nvm/bash_completion &amp;&amp; return 124
  fi
}
complete -F _nvm_completion nvm

# 初めてrvmの補完を実行するまで読み込みを遅延する
function _rvm_completion() {
  unset _rvm_completion
  complete -r rvm
  if [[ -f ~/.rvm/scripts/completion ]]; then
    . ~/.rvm/scripts/completion &amp;&amp; return 124
  fi
}
complete -F _rvm_completion rvm
</pre></div>
</div>

<p>こうすることで初めて補完が呼ばれた時に本物の補完スクリプトを読み込まれるようになる、という見たまんまの感じです。</p>

<p>工夫があるとしたら最後に return 124 を返しているところです。補完関数が124を返した場合はbashは補完をもう一度実行することになっています。どういうことかというと↓こういうことです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># return 124 しない場合
nvm [TAB][TAB]
     ↑    ↑ 
     │  なのでもう一度TABを押して初めて本来の補完関数が実行される
ここで本物の補完関数が読み込まれる(が、この時点で本物の補完関数は呼ばれない)

# return 124 する場合
nvm [TAB]
     ↑
ここで本物の補完関数が読み込まれる＆読み込んだ補完関数がこの時点で再実行される
</pre></div></div>

<p>まぁ、実際は殆ど気づかないだろうけど遅延読み込みのせいでTABを1回余分に押すハメになるのを防げるという意味があります。</p>

<p>おしまい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />37位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>15</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/bd33fe1e29876939dddb">プロセスに紐付いたttyを取得する</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-07 13:15:30</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Bash]</b> <b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>現在の端末デバイス名（/dev/pts/1とか）を取得するには通常は<code>tty</code>というコマンドで探せるが、これはあくまで現在入力中プロセスの端末名しか取得できない。つまりスクリプト内などで起動元プロセスの端末名を取得するのには使えない。</p>

<p>なので自分で親プロセスを辿ってttyを探すスクリプトを作ってみた。</p>

<div class="code-frame" data-lang="bash">
<div class="code-lang"><span class="bold">search_tty.sh</span></div>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># プロセスに紐付いたttyを取得する http://bit.ly/1eDpRpu</span>
<span class="k">function</span> search_tty<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$$</span><span class="si">}</span> <span class="nv">tty</span><span class="o">=</span><span class="s2">""</span>
  <span class="k">while</span> <span class="o">[[</span> <span class="m">1</span> -lt <span class="nv">$pid</span> <span class="o">]]</span><span class="p">;</span> <span class="k">do</span>
    <span class="o">[[</span> -d /proc/<span class="nv">$pid</span>/fd <span class="o">]]</span> <span class="o">||</span> <span class="nb">break</span>
    <span class="nv">tty</span><span class="o">=</span><span class="k">$(</span>readlink /proc/<span class="nv">$pid</span>/fd/1 <span class="m">2</span>&gt;/dev/null <span class="p">|</span> awk <span class="s1">'{print $1}'</span><span class="k">)</span>
    <span class="o">[[</span> -c <span class="nv">$tty</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$tty</span><span class="s2">"</span><span class="p">;</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span> <span class="o">}</span>
    <span class="nv">pid</span><span class="o">=</span><span class="k">$(</span>perl -pe <span class="s1">'s/\(.*\)/()/'</span> /proc/<span class="nv">$pid</span>/stat <span class="p">|</span> awk <span class="s1">'{print $4}'</span><span class="k">)</span>
  <span class="k">done</span>
  <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

search_tty <span class="nv">$1</span>
</pre></div>
</div>

<p>これは第1引数に指定されたプロセスIDに紐付いたttyを探すスクリプトです。<br>
PIDが渡されなかった場合は現在のプロセスIDを元にttyを探します。<br>
他でコピペ利用しやすいようBash関数にしてからに実行してます。</p>

<h1>
<span id="利用例" class="fragment"></span><a href="#%E5%88%A9%E7%94%A8%E4%BE%8B"><i class="fa fa-link"></i></a>利用例</h1>

<ul>
<li><a href="http://qiita.com/kawaz/items/96af6fa59fdf999b94bd" id="reference-96364e1beb507ed457b8">Linux - 既存プロセスの標準出力と標準エラーを奪う - Qiita [キータ]</a></li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />38位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>14</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/18888fe0a3f0ef664890">プライベートIPからのみSSH接続出来るようにするauthorized_keysの書き方</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-29 03:13:06</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[Security]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>テンプレとしてメモ</p>

<div class="code-frame" data-lang="authorized_keys"><div class="highlight"><pre><span></span>from="10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,127.0.0.0/8" ssh-rsa AAAA... KEYNAME
</pre></div></div>

<p><code>from=""</code> のダブルクオートはダブルクオートでなければいけないので注意。シングルクォーテーションを使ってみたり、ダブルクオーテーションを省略したりすると認証出来ない。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />39位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/7b9a58d633695bcc86cb">コマンドの補完リストをgrepしたいときはcompgenを使うと便利</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-24 17:17:16</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Bash]</b> <b>[Linux]</b> <b>[AWS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>AWS関連コマンドとか ec2-xxxx-yyyy-zzzzz みたいなコマンドが大量にありすぎて、TAB補完しても目的のコマンドが全然探せない！</p>

<p>じゃーgrepすりゃいいかって思った瞬間に気づく…、補完候補ってってパイプに流せないじゃん！？</p>

<h2>
<span id="そこでcompgenですよ" class="fragment"></span><a href="#%E3%81%9D%E3%81%93%E3%81%A7compgen%E3%81%A7%E3%81%99%E3%82%88"><i class="fa fa-link"></i></a>そこでcompgenですよ。</h2>

<p>実のところbashの補完機能の裏ではまさにこの<code>compgen</code>という組み込みコマンドが大活躍してる。こいつが全ての補完候補を作ってくれていると言っても過言ではないだろう。なので、補完リストを取りたいんならcompgenを直接使いこなしてしまうのが一番ってわけだ。</p>

<p>何かいっぱいオプションあるけど、<strong>-c オプションを抑えておけば十分</strong>です。</p>

<p><code>compgen -c ec2-</code>とかやるとec2-まで入力してTAB補完したのとほぼ同じリストが出力される（aliasとかfunctionとかはこれだと出ないけど割愛）。</p>

<h2>
<span id="利用例" class="fragment"></span><a href="#%E5%88%A9%E7%94%A8%E4%BE%8B"><i class="fa fa-link"></i></a>利用例</h2>

<p>だからインスタンス操作系のコマンドって何があるのかなーと思ったら↓こんな感じで探せる。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ compgen -c ec2- | sort | grep instance
ec2-bundle-instance
ec2-cancel-reserved-instances-listing
ec2-cancel-spot-instance-requests
ec2-confirm-product-instance
ec2-create-instance-export-task
ec2-create-reserved-instances-listing
ec2-describe-instance-attribute
ec2-describe-instance-status
ec2-describe-instances
ec2-describe-reserved-instances
ec2-describe-reserved-instances-listings
ec2-describe-reserved-instances-offerings
ec2-describe-spot-instance-requests
ec2-import-instance
ec2-modify-instance-attribute
ec2-monitor-instances
ec2-purchase-reserved-instances-offering
ec2-reboot-instances
ec2-report-instance-status
ec2-request-spot-instances
ec2-reset-instance-attribute
ec2-run-instances
ec2-start-instances
ec2-stop-instances
ec2-terminate-instances
ec2-unmonitor-instances
</pre></div></div>

<p>AWSのインスタンス操作系コマンドはそれだけでも数が多い方からこれでも多く見えるけど…、ec2-での候補は<strong>166個</strong>もあったのにinstanceでgrepしたら<strong>22個</strong>だよ！</p>

<p>かなり探しやすくなったでしょ？</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />40位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>11</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/44b52a4ed4bbabbef724">cd /path/to/file→失敗→fileを削って再びcd /path/to　をもうやりたくないお</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-29 17:16:10</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>ログとかからファイルのフルパスをコピペしてそのファイルのあるディレクトリへ<code>cd</code>したいことってよくありますよね？そんなときこの記事タイトルのようなことをやった経験が誰にもあると思います。少なくとも僕はよくやるし、長いファイル名をBS連打で削るのがもう嫌です。</p>

<blockquote>
<p>cd先がファイルだったらそのファイルがあるディレクトリに行きたいって思ってるに決まってるじゃん。分かるでしょ？だからもう勝手にファイル名削ってcdしちゃってよ！</p>
</blockquote>

<p>って夢が叶うのが以下の設定です。</p>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">~/.bashrc</span></div>
<div class="highlight"><pre><span></span># cd file でそのfileのあるディレクトリに移動する
function cd() {
  if [[ -e $1 &amp;&amp; ! -d $1 ]]; then
    builtin cd -- "$(dirname -- "$1")"
  else
    builtin cd "$@"
  fi
}
</pre></div>
</div>

<p>この結果…</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># httpd.confを弄ろう…
$ sudo vim /etc/httpd/conf/httpd.conf

# ちょっとヒストリ1個戻ってconfディレクトリに行きたいな…
$ cd /etc/httpd/conf/httpd.conf

# しまったファイル名のままcdしちまった
# あれ？　エラーが出ない…だと！？

$ pwd
/etc/httpd/conf

# これは楽ちん！
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />41位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>10</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/e8ff6e1b7af93e7caa39">シェルスクリプトでTCPの読み書きをする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-01-07 16:40:42</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Bash]</b> <b>[Linux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>LinuxではシェルスクリプトだけでTCPの読み書きが出来るのでやり方をメモ。</p>

<h1>
<span id="bashでtcpクライアント" class="fragment"></span><a href="#bash%E3%81%A7tcp%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88"><i class="fa fa-link"></i></a>BASHでTCPクライアント</h1>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="c1">#適当なファイルディスクリプタでTCPを開く（0,1,2は標準入力/出力/エラーで使われてるからそれ以外）</span>
<span class="nb">exec</span> <span class="m">5</span>&lt;&gt;/dev/tcp/www.google.com/80

<span class="c1">#先程のディスクリプタに対して書き込む</span>
<span class="nb">echo</span> <span class="s2">"GET / HTTP/1.1"</span> &gt;<span class="p">&amp;</span><span class="m">5</span>
<span class="nb">echo</span> <span class="s2">"Host: www.google.com"</span> &gt;<span class="p">&amp;</span><span class="m">5</span>
<span class="nb">echo</span> &gt;<span class="p">&amp;</span><span class="m">5</span>

<span class="c1">#レスポンスをディスクリプタから読み込む</span>
cat &lt;<span class="p">&amp;</span><span class="m">5</span>
HTTP/1.1 <span class="m">302</span> Found
Location: http://www.google.co.jp/?gws_rd<span class="o">=</span>cr<span class="p">&amp;</span><span class="nv">ei</span><span class="o">=</span>5azLUvfcBczRkwXW4oCADw
Cache-Control: private
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
Set-Cookie: <span class="nv">PREF</span><span class="o">=</span><span class="nv">ID</span><span class="o">=</span>bcfe5bc4c98312a1:FF<span class="o">=</span><span class="m">0</span>:TM<span class="o">=</span><span class="m">1389079781</span>:LM<span class="o">=</span><span class="m">1389079781</span>:S<span class="o">=</span>syDn3Htc1dVCRLQ8<span class="p">;</span> <span class="nv">expires</span><span class="o">=</span>Thu, <span class="m">07</span>-Jan-2016 <span class="m">07</span>:29:41 GMT<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/<span class="p">;</span> <span class="nv">domain</span><span class="o">=</span>.google.com
Set-Cookie: <span class="nv">NID</span><span class="o">=</span><span class="nv">67</span><span class="o">=</span>hRM9vKYySsBxDFxWTWC92D5ThwJy08b4A894fGt6ZyXIIhaWkbfB-vpdO44-jb6LJIO_dJnMVGaP_5QIus2HNqHNvSHc9tq84lLIBA6N-YWwKizdOpVIyPvqKDiPieX3<span class="p">;</span> <span class="nv">expires</span><span class="o">=</span>Wed, <span class="m">09</span>-Jul-2014 <span class="m">07</span>:29:41 GMT<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/<span class="p">;</span> <span class="nv">domain</span><span class="o">=</span>.google.com<span class="p">;</span> HttpOnly
P3P: <span class="nv">CP</span><span class="o">=</span><span class="s2">"This is not a P3P policy! See http://www.google.com/support/accounts/bin/answer.py?hl=en&amp;answer=151657 for more info."</span>
Date: Tue, <span class="m">07</span> Jan <span class="m">2014</span> <span class="m">07</span>:29:41 GMT
Server: gws
Content-Length: <span class="m">261</span>
X-XSS-Protection: <span class="m">1</span><span class="p">;</span> <span class="nv">mode</span><span class="o">=</span>block
X-Frame-Options: SAMEORIGIN
Alternate-Protocol: <span class="m">80</span>:quic

&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv<span class="o">=</span><span class="s2">"content-type"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"text/html;charset=utf-8"</span>&gt;
&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;302 Moved&lt;/H1&gt;
The document has moved
&lt;A <span class="nv">HREF</span><span class="o">=</span><span class="s2">"http://www.google.co.jp/?gws_rd=cr&amp;amp;ei=5azLUvfcBczRkwXW4oCADw"</span>&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;
</pre></div></div>

<h1>
<span id="bashでtcpサーバ" class="fragment"></span><a href="#bash%E3%81%A7tcp%E3%82%B5%E3%83%BC%E3%83%90"><i class="fa fa-link"></i></a>BASHでTCPサーバ</h1>

<p>残念ながらBash単体ではTCPのbind(LISTEN)は出来ないのでTCPサーバにはなれません。他のコマンド使って下さい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />42位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>9</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/b48d42c379e83dff75c4">緯度(latitude)と経度(longitude)の覚え方。</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-10-25 12:02:54</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[geo]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>latitudeとlongitudeは基本「long=長い」で覚える。</p>

<h3>
<span id="緯度と経度はどっちがlatitudeでlongitude" class="fragment"></span><a href="#%E7%B7%AF%E5%BA%A6%E3%81%A8%E7%B5%8C%E5%BA%A6%E3%81%AF%E3%81%A9%E3%81%A3%E3%81%A1%E3%81%8Clatitude%E3%81%A7longitude"><i class="fa fa-link"></i></a>緯度と経度はどっちがlatitudeでlongitude？</h3>

<p>緯度(いど)＜経度(けーど) →longitude！</p>

<p>てことは緯度がlatitude！</p>

<h3>
<span id="緯度と経度はどっちが縦南北方向で横赤道方向" class="fragment"></span><a href="#%E7%B7%AF%E5%BA%A6%E3%81%A8%E7%B5%8C%E5%BA%A6%E3%81%AF%E3%81%A9%E3%81%A3%E3%81%A1%E3%81%8C%E7%B8%A6%E5%8D%97%E5%8C%97%E6%96%B9%E5%90%91%E3%81%A7%E6%A8%AA%E8%B5%A4%E9%81%93%E6%96%B9%E5%90%91"><i class="fa fa-link"></i></a>緯度と経度はどっちが縦(南北方向)で横(赤道方向)？</h3>

<p>縦は±90度＜横は±180度 →横が長い→longitude！</p>

<p>てことは縦がlatitude！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />43位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/b733f3a41332107d74c4">AWS SDK for PHPをPEARで入れる</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-13 20:00:21</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[PHP]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>現在最新のAWS SDKはcomposerで入れるようになっています。最新バージョンは<a href="https://packagist.org/packages/aws/aws-sdk-php" rel="nofollow noopener" target="_blank">こちら</a>で確認して、composer.jsonのrequireに追加してやってください。</p>

<h1>
<span id="古い内容" class="fragment"></span><a href="#%E5%8F%A4%E3%81%84%E5%86%85%E5%AE%B9"><i class="fa fa-link"></i></a>古い内容</h1>

<p><a href="http://pear.amazonwebservices.com/" rel="nofollow noopener" target="_blank">公式ドキュメント</a>の通りに実行するだけだと</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>$ sudo pear channel-discover pear.amazonwebservices.com
Adding Channel "pear.amazonwebservices.com" succeeded
Discovery of channel "pear.amazonwebservices.com" succeeded
$ sudo pear install aws/sdk
Unknown remote channel: guzzlephp.org/pear
aws/sdk requires package "channel://guzzlephp.org/pear/Guzzle" (version &gt;= 3.0.3)
No valid packages found
install failed
</pre></div></div>

<p>と怒られる。</p>

<p>ので、オプション1個追加するだけだがコピペ用に以下をメモしておく。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>sudo pear channel-discover pear.amazonwebservices.com
sudo pear -D <span class="nv">auto_discover</span><span class="o">=</span><span class="m">1</span> install aws/sdk
</pre></div></div>

<p>そしてAwsをuseする前に以下を書いておく。</p>

<div class="code-frame" data-lang="php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">'AWSSDKforPHP/aws.phar'</span><span class="p">;</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />44位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>8</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/9bccd1d3f51ba46b25a0">AWS CLIの --query オプションが便利。</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-04 16:21:30</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[cli]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>結構前から <code>--query</code> オプションが増えてたのは気づいてたんだが <code>jq</code> で困ってなかったので使い方調べてなかったんだけどこれ便利だね！ついでに <code>--output</code> も。</p>

<p>今まで↓こんな風にしていたことが</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>aws ec2 describe-images --owner self <span class="p">|</span> jq <span class="s2">".Images[].ImageId"</span> -r
</pre></div></div>

<p>jq とか無しで↓こんな風に書けるようになった。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span>aws ec2 describe-images --owner self --query <span class="s2">"Images[*].ImageId"</span> --output text
</pre></div></div>

<p>あれ？比べてみると長くなってるねｗ でもawsコマンド単体で完結できる点がとてもよい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />45位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>7</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/2535b066c6e59fff94a7">スプレッドシートの特定カラムの値を元に行色付けして見やすくする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2014-02-20 12:51:15</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[GoogleAppsScript]</b> <b>[gas]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Googleスプレッドシートで表が横にでかくなってくると纏まり毎に横線を引いたりカレントカーソル行をハイライトしたくなってくる。でもカレント行をハイライトするのは難しそうなので行をスプライトに色付けすることにしてみた。</p>

<h1>
<span id="スクリプト設定" class="fragment"></span><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>スクリプト設定</h1>

<ul>
<li>まずは対象のスプレッドシートを開いて「ツール」→「スクリプトエディタ」を開く。</li>
<li>すると「コード.gs」ていうファイルの編集画面が表示されるのでそこに以下のコードを貼り付ける。</li>
</ul>

<div class="code-frame" data-lang="js"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">switchRowColor</span><span class="p">(</span><span class="nx">targetColumn</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">targetColumn</span> <span class="o">=</span> <span class="nx">targetColumn</span> <span class="o">?</span> <span class="nx">targetColumn</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActiveSheet</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">lastRow</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getLastRow</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">lastColumn</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getLastColumn</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">colorIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'#ffffff'</span><span class="p">,</span> <span class="s1">'#ffffdd'</span><span class="p">,</span> <span class="s1">'#ffddff'</span><span class="p">,</span> <span class="s1">'#ffdddd'</span><span class="p">,</span> <span class="s1">'#ddffff'</span><span class="p">,</span> <span class="s1">'#ddffdd'</span><span class="p">,</span> <span class="s1">'#ddddff'</span><span class="p">,</span> <span class="s1">'#dddddd'</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">startRow</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getFrozenRows</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">startRow</span><span class="p">,</span> <span class="nx">targetColumn</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
  <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">startRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">lastRow</span><span class="p">,</span> <span class="nx">lastColumn</span><span class="p">).</span><span class="nx">setBackground</span><span class="p">(</span><span class="s2">""</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">startRow</span><span class="p">;</span> <span class="nx">row</span> <span class="o">&lt;=</span> <span class="nx">lastRow</span><span class="p">;</span> <span class="nx">row</span><span class="o">++</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="nx">targetColumn</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">value</span> <span class="o">!=</span> <span class="nx">lastValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">sheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">startRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">row</span> <span class="o">-</span> <span class="nx">startRow</span><span class="p">,</span> <span class="nx">lastColumn</span><span class="p">).</span><span class="nx">setBackground</span><span class="p">(</span><span class="nx">colors</span><span class="p">[</span><span class="nx">colorIndex</span><span class="p">]);</span>
      <span class="nx">colorIndex</span> <span class="o">=</span> <span class="p">(</span><span class="nx">colorIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="nx">startRow</span> <span class="o">=</span> <span class="nx">row</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">lastValue</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>  
<span class="p">}</span>
</pre></div></div>

<ul>
<li>「ファイル」→「保存」でスクリプトを保存する。その際プロエクト名が聞かれるので、適当に「行で色付け」などとしておく。</li>
<li>もうスクリプトエディタは閉じても良いし、実行ボタンを何回か押して動作を確認してみても良い。</li>
<li>元のスプレッドシートに戻ったら色付けしたいシートを表示したまま「ツール」→「スクリプトマネージャ」を開く。</li>
<li>先ほど作った「行で色付け」が表示されているのでそれを選択して実行すると色付けが行われる。</li>
<li>この際初めての実行時はOAuth認証が求められるので自分の判断で承認する。２回目以降の実行時には聞かれなくなる。</li>
<li>自動的に色付けしてくれるわけじゃないので色々編集したら、再度実行すればまた綺麗になる。</li>
</ul>

<h1>
<span id="実行イメージ" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>実行イメージ</h1>

<p>↓こんな風になる。</p>

<p><a href="https://camo.qiitausercontent.com/11af74235fdd01dd299b7fe810dd028b829e2b4a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f35383436383138642d373933622d346330332d646663382d3432393331653434633630642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/11af74235fdd01dd299b7fe810dd028b829e2b4a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f35383436383138642d373933622d346330332d646663382d3432393331653434633630642e706e67" alt="screenshot.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/18726/5846818d-793b-4c03-dfc8-42931e44c60d.png"></a></p>

<p>固定行はカラーリング対象から除くようにしてある。あと色付け基準のカラム番号はスクリプト内に1と書いてるのでこれをダイアログで毎回聞くようにしても良いし、スクリプトのデフォルト値を他に変えて使っても良い、好みで。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />46位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>5</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/6afd31583082fdbccb13">Qiitaに要望：GoogleAnalyticsに対応してほしい</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-05 10:33:12</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>追記：コメントに色々要望とか書いてみたので他のQiitaユーザの意見も聞いてみたいです。</p>

<p>自分の設定画面で Google Analytics のアカウントID (UA-XXXXXX-X) 形式のIDを設定しておいたら、自分の投稿やプロフィールのページに Analytics のタグを埋めてくれる機能がほしい。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />47位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/35fa177642c7939d6bce">タブ移動で戻ってくると検索窓にフォーカスしておく</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-05 19:10:40</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[JavaScript]</b> <b>[HTML5]</b> <b>[Chrome]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Googleを開いたらChromeのJavascriptコンソールで以下を貼り付けておく。貼り付け終わったらデベロッパーツールは閉じておく。</p>

<div class="code-frame" data-lang="javascript"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"webkitvisibilitychange"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="s2">"visible"</span> <span class="o">==</span> <span class="nb">document</span><span class="p">.</span><span class="nx">webkitVisibilityState</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"input[name=q]"</span><span class="p">);</span>
    <span class="nx">q</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
    <span class="nx">q</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</pre></div></div>

<h1>
<span id="後でchrome拡張にする" class="fragment"></span><a href="#%E5%BE%8C%E3%81%A7chrome%E6%8B%A1%E5%BC%B5%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>後でChrome拡張にする</h1>

<p>Google検索はAJAXで動いててリロードしないから一度実行しておけばずっと使えるけど。楽天の検索窓とかでも使おうとすると検索実行でリロードされてリスナが消えてしまうので、勝手にリスナ登録が出来るよう後でブラウザ拡張を作る予定。</p>

<h2>
<span id="chrome拡張にした" class="fragment"></span><a href="#chrome%E6%8B%A1%E5%BC%B5%E3%81%AB%E3%81%97%E3%81%9F"><i class="fa fa-link"></i></a>Chrome拡張にした</h2>

<p><a href="https://chrome.google.com/webstore/detail/focus-on-tabchanged/cncjnkphionepgfggbgdicdecbfamica/details" class="autolink" rel="nofollow noopener" target="_blank">https://chrome.google.com/webstore/detail/focus-on-tabchanged/cncjnkphionepgfggbgdicdecbfamica/details</a></p>

<p>とりあえず自分がよく使うGoogle検索と楽天ブックス検索と楽天購入履歴検索に対応。</p>

<h2>
<span id="ソースはこちら" class="fragment"></span><a href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AF%E3%81%93%E3%81%A1%E3%82%89"><i class="fa fa-link"></i></a>ソースはこちら</h2>

<p><a href="https://github.com/kawaz/focus-on-tabchaged.crx" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/kawaz/focus-on-tabchaged.crx</a></p>

<p>ところでroadchangeっていうCHANGELOGとROADMAPを綺麗に表示してくれるサービスを初めて使ってみたんだけど便利ねこれｗ</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />48位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/5c9b766e20ceb8da88c2">AWSクレジットでRI買えないみたいなので注意なｗ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-08-01 16:39:34</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> <b>[EC2]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h1>
<span id="awsクレジットの一覧画面" class="fragment"></span><a href="#aws%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E3%81%AE%E4%B8%80%E8%A6%A7%E7%94%BB%E9%9D%A2"><i class="fa fa-link"></i></a>AWSクレジットの一覧画面</h1>

<p>↓こんな感じでAWSクレジットがいっぱい手に入ったので、さくっとリザーブドインスタンスでも買ってしまおうかとポチってみたんだ。</p>

<p><a href="https://camo.qiitausercontent.com/bf7cf154e40c27003d3bb6e6050efad06b38fdfc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f37396537636434652d326662632d646362392d326539342d6535643864333738623731362e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/bf7cf154e40c27003d3bb6e6050efad06b38fdfc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f37396537636434652d326662632d646362392d326539342d6535643864333738623731362e706e67" alt="credit.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/18726/79e7cd4e-2fbc-dcb9-2e94-e5d8d378b716.png"></a></p>

<p>EC2ってあるから当然RI購入もできるんだろうなーって思ったのよ。</p>

<h1>
<span id="その結果" class="fragment"></span><a href="#%E3%81%9D%E3%81%AE%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>その結果…</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>＿人人 人人＿
＞ 突然の死 ＜
￣Y^Y^Y^Y￣
</pre></div></div>

<p><a href="https://camo.qiitausercontent.com/79cb92d1dd9d302247f85a87813c25d40781539f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f66343932383632322d313766612d333563652d613336612d3766653039366337343939612e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/79cb92d1dd9d302247f85a87813c25d40781539f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f66343932383632322d313766612d333563652d613336612d3766653039366337343939612e706e67" alt="invoice.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/18726/f4928622-17fa-35ce-a36a-7fe096c7499a.png"></a></p>

<p>クレジットの適用が$0.00ｗｗ　普通に全額請求が回ってきてたｗ</p>

<p>当然だけどone time feeじゃない部分はちゃんとクレジット適用されて請求ゼロ円になってたけどさ。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />49位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/6bc7b7e76ff05a69e14e">AWSクレジットの消費優先順位</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-30 16:12:42</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>1つのアカウントに複数のAWSクレジットを適用(Redeem)していた場合、各クレジットの消費優先順位は失効期限のみに準じるらしいです。</p>

<ul>
<li>失効日が一番早いクレジットから使われる。</li>
<li>失効日が同一のクレジットが複数ある場合は、ランダムな順番で消費される。</li>
<li>クレジットの適用時期やクレジットの金額は関係ない。</li>
</ul>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />50位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>4</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/f334f9b676a9019f82ad">iPhoneアドレス帳の検索対策のバッドノウハウ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-04 18:02:33</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[iPhone]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>iPhoneのアドレス帳検索が糞なので文句を書きなぐって発散するエントリー。</p>

<p>まず、人名なんかは姓と名を普通に分けて振り仮名書いとけば十分、あとは渾名とかあればニックネームに入れとけば大抵十分。更に渾名が複数あったりする場合やそいつを思い出すためのキーワードがあるなら検索用に、追加フィールドで「メモ」とかに列挙しちゃってる。</p>

<h2>
<span id="企業名とかお店の名前とか" class="fragment"></span><a href="#%E4%BC%81%E6%A5%AD%E5%90%8D%E3%81%A8%E3%81%8B%E3%81%8A%E5%BA%97%E3%81%AE%E5%90%8D%E5%89%8D%E3%81%A8%E3%81%8B"><i class="fa fa-link"></i></a>企業名とかお店の名前とか</h2>

<p>問題になるのは大抵これ。この場合、姓か名に1行で書いちゃうことが多いと思う。でもその時に例えば<code>柏レーザー脱毛クリニック</code>の振り仮名を<code>かしわれーざーだつもうくりにっく</code>とかにしちゃうと後で後悔するよ。<br>
何故かというと検索で<code>だつもう</code>とか<code>くりにっく</code>で検索しても出てこないから…。そもそも病院の名前とか覚えてないから脱毛とか適当なキーワードでまず探すじゃん？そのときに出ないのよ。そんなときは<code>かしわ れーざー だつもう くりにっく</code>とかにしとけば大体は検索できるようになる。<br>
だから単語が連なるような名前のふりがなは基本 <strong>分かち書き</strong> しておこう！</p>

<h2>
<span id="あいおい損保とか最悪" class="fragment"></span><a href="#%E3%81%82%E3%81%84%E3%81%8A%E3%81%84%E6%90%8D%E4%BF%9D%E3%81%A8%E3%81%8B%E6%9C%80%E6%82%AA"><i class="fa fa-link"></i></a>あいおい損保とか最悪</h2>

<p>その中でも「何でだよ！」って思ったのがこれよ。</p>

<p><code>あいおい損保</code>の、振り仮名を分かち書きしないと<code>そんぽ</code>で出ないとかはもう基本だわ。<code>あ</code>では出るのに<code>あい</code>や<code>あいお</code>で見つからない、…のもまだ許そう。でも…</p>

<blockquote>
<p><strong><code>あいおい</code>で見つからないとかどういうことだよ！？</strong></p>
</blockquote>

<p>ふりがなを<code>あいおい そんぽ</code>って風に分かち書きしてすら駄目だよ！<br>
仕方がないからこいつに関してははもうこんな風にしちゃったよ。これでやっと<code>あいおい</code>で検索できた…。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>  姓 あいおい損保
せい あいおい そんぽ
  名 (空)
めい あいおい
</pre></div></div>

<h2>
<span id="根本解決してほしい" class="fragment"></span><a href="#%E6%A0%B9%E6%9C%AC%E8%A7%A3%E6%B1%BA%E3%81%97%E3%81%A6%E3%81%BB%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>根本解決してほしい</h2>

<p>てかAppleさんよー、アドレス帳なんて大したサイズじゃないんだからもう <strong>N=2のNグラム</strong> でインデックス作っちゃってよ、お願いだから！</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />51位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/a92a46293f03be4c1c1f">AWSクレジットの引き換えエラーメッセージまとめ</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-12-04 17:35:04</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>普通はAWSクレジットを使う機会ってそんなに無いとは思うんだけど、AWSクレジットの引き換え可否って結構色んな条件があるので気をつけましょう。ここでは僕が見たことがあるエラーメッセージについてメモしておきます。</p>

<h1>
<span id="クーポンコードが間違っている" class="fragment"></span><a href="#%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%81%8C%E9%96%93%E9%81%95%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B"><i class="fa fa-link"></i></a>クーポンコードが間違っている</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>We were unable to redeem the credit you entered. Please check the code and try again.
</pre></div></div>

<p>適当なコードを入れたらエラーになります。当然ですねｗ</p>

<h1>
<span id="クーポンコードは既に引き換え済み" class="fragment"></span><a href="#%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AF%E6%97%A2%E3%81%AB%E5%BC%95%E3%81%8D%E6%8F%9B%E3%81%88%E6%B8%88%E3%81%BF"><i class="fa fa-link"></i></a>クーポンコードは既に引き換え済み</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Attempting to redeem a promotion code that has already been redeemed : XXXXXXXXXXXXXXX
</pre></div></div>

<p>既に引き換え済みのコードを入れると表示されるエラーです。これも当然ですねｗ</p>

<h1>
<span id="1アカウントに適用できる上限回数エラー" class="fragment"></span><a href="#1%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%AB%E9%81%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E4%B8%8A%E9%99%90%E5%9B%9E%E6%95%B0%E3%82%A8%E3%83%A9%E3%83%BC"><i class="fa fa-link"></i></a>1アカウントに適用できる上限回数エラー</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>The account 123456789012 exceeds the limit of 1 for for the maximum number of codes currently redeemed per account.
</pre></div></div>

<p>これは普通の人は見る機会が少ないエラーかもです。</p>

<p>例えば、WEBフォームからアンケート登録するだけで$100のAWSクレジットが貰えるキャンペーンなどがあったとしましょう。こういうのがあると複数メアドを使って大量のクレジットコードを取得してウマーとか考えるもんですが、大抵このようなキャンペーンで発行されたコードには1アカウントに1回しか適用出来ないという制限がかかっており、有効な2つ目のコードを引き換えようとすると上記エラーを目にすることになります。もちろんその2つ目のコードは他のアカウントに対しては適用可能なんですが。</p>

<p>この設定は１なコードが多いですがたまにアカウント毎に3つまで適用可能なコードとかもあるようです。</p>

<p>ちなみにコードを配布している主催者が説明などしてくれない限りはそのコードが１アカウントに何回適用できるかどうかは引き換えを実行してみないと分かりません。とにかくAWSコードは交換してみるまでそのコードに関する情報は何も分からないのです。</p>

<h1>
<span id="引き換え期限切れ" class="fragment"></span><a href="#%E5%BC%95%E3%81%8D%E6%8F%9B%E3%81%88%E6%9C%9F%E9%99%90%E5%88%87%E3%82%8C"><i class="fa fa-link"></i></a>引き換え期限切れ</h1>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>Attempting to redeem a promotion code that has been deleted :  XXXXXXXXXXXXXXX
</pre></div></div>

<p>AWSクレジットには使用期限の他に、引き換え期限が設定されていることがあるようです。</p>

<p>例えば 2013/08/01 に発行されたコードで、引替すると 2013/10/30 の有効期限が設定されたクレジットが貰えるとします。これの引き換えをさっさとせずに10月に入ってから入力したら、月末まで有効なクレジットのはずなのに、実は引き換え期限が2013/09/30に設定されていたために引き換え自体が出来ませんでした！ということが起こります。そういうときに上記エラーを見ることになります。非常に残念な状態です…。</p>

<p>例によって実際に引き換えエラーが出るまでそんな期限が設定されているとはわからないし、引き換え成功した場合もやはりそんな情報は教えてもらえません。とにかく貰ったコードはさっさと適用するに限る！ということですね。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />52位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>3</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/7534866f0627ec218ff4">initスクリプトでserviceを使うことを強制しくれたら楽なのに</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-26 11:15:21</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[ShellScript]</b> <b>[Bash]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p><a href="http://heartbeats.jp/hbblog/2013/06/service-start-stop.html" rel="nofollow noopener" target="_blank">デーモンの起動・終了にはserviceコマンドを利用しよう - インフラエンジニアway - Powered by HEARTBEATS</a> ていうエントリを見て、なるほどこれは<code>service</code>使うべきだなって思った。</p>

<p>でもbash_completionとか入れてないとサービス名の補完されないしやっぱ /etc/init.d/xxx って打ちたくなっちゃうときはあるよね？んで、実行する側がそんなの気にするの面倒じゃん？人は何でも忘れるし。</p>

<p>だから全ての/etc/init.d/xxxスクリプトの先頭にこんなのが書いてあったら楽なのになー。などと妄想したんだけどどうだろう？</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="c1"># service を使うことを強制</span>
<span class="o">[[</span> -n <span class="nv">$USER</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">type</span> service &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">exec</span> service <span class="s2">"</span><span class="si">${</span><span class="nv">0</span><span class="p">##*/</span><span class="si">}</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</pre></div></div>

<p>あ、でもこれだとちゃんと/etc/init.d/xxxに配備されてないスクリプトがテスト出来ない上に本番サービスに誤爆する危険とかあるから駄目か。</p>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="c1"># service を使うことを強制</span>
<span class="o">[[</span> -n <span class="nv">$USER</span> <span class="o">&amp;&amp;</span> <span class="nv">$0</span> ~<span class="o">=</span> ^/etc/init¥¥.d/ <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">type</span> service &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">exec</span> service <span class="s2">"</span><span class="si">${</span><span class="nv">0</span><span class="p">##*/</span><span class="si">}</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
</pre></div></div>

<p>とかにしとけばいいか？なんかまだトラブルケースがありそうな予感もする…。やっぱやめたほうが良いかもなｗ</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />53位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/ca2983ac2535e4af4e29">slideshareの最終ページ後の「他のスライドもありますよ的な画面」を無効にする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-07-01 11:14:28</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Chrome]</b> <b>[slideshare]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><blockquote>
<p>slideshareって最後のページまで来た時に更に次ページ押してしまうと、他のスライドもありますよ的な画面になるのが超ウザい。そこまで行っちゃうとページ戻れないしみんなどうしてるの…？</p>
</blockquote>

<p>と思ったので無効にしてみた。</p>

<h1>
<span id="chrome拡張作った" class="fragment"></span><a href="#chrome%E6%8B%A1%E5%BC%B5%E4%BD%9C%E3%81%A3%E3%81%9F"><i class="fa fa-link"></i></a>Chrome拡張作った</h1>

<p><a href="https://chrome.google.com/webstore/detail/slideshare-lastscreen-dis/fhddffkedbdcdpnofkbdjfhgbhhfookj/details" rel="nofollow noopener" target="_blank">Chrome ウェブストア - slideshare lastscreen disabler</a></p>

<p>これを入れるのが一番簡単。</p>

<h1>
<span id="stylishでやる場合は" class="fragment"></span><a href="#stylish%E3%81%A7%E3%82%84%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AF"><i class="fa fa-link"></i></a>Stylishでやる場合は</h1>

<ul>
<li>
<a href="https://chrome.google.com/webstore/detail/stylish/fjnbnpbmkenffdnngjfgmeleoegfcffe?hl=ja" rel="nofollow noopener" target="_blank">Stylish</a> というChrome拡張を入れる。</li>
<li>ChromeのツールバーのStylishアイコンを右クリック→オプションを開く</li>
<li>
<code>新しいスタイルを作成</code>ボタンを押して以下の設定を作って保存</li>
</ul>

<p><a href="https://camo.qiitausercontent.com/a17e553e5f73bf261e1b5b564cc239214d4620c5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f64386630333134372d633239312d383134322d363731632d6533666635383330373037622e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/a17e553e5f73bf261e1b5b564cc239214d4620c5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31383732362f64386630333134372d633239312d383134322d363731632d6533666635383330373037622e706e67" alt="979e1837569e6993cdd7e7ba8da1d32c.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/18726/d8f03147-c291-8142-671c-e3ff5830707b.png"></a></p>

<ul>
<li>
<code>名前</code>の「sldeshare-lastscreen-disabler」は適当</li>
<li>
<code>適用先</code>に「次で始まるURL <a href="http://www.slideshare.net/%E3%80%8D%E3%82%92%E8%A8%AD%E5%AE%9A" class="autolink" rel="nofollow noopener" target="_blank">http://www.slideshare.net/」を設定</a>
</li>
<li>以下のコードをコピペして保存する</li>
</ul>

<div class="code-frame" data-lang="css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">jsplLastScreenOverlay</span><span class="o">,</span>
<span class="p">.</span><span class="nc">lastScreenContainer</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span><span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div></div>

<p>ただStylishだと複数環境にそれぞれ設定してやらないといけないのが面倒。</p>

<p>面倒嫌なのでChrome拡張作った。Chrome拡張の方はクラウド同期されて楽ちんなのでおすすめ。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />54位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/06742701e611e65f4a27">Qiitaの要望窓口？</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-25 13:00:40</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>Qiitaの不具合や要望ってどこに言えばよいのか分かりにくい気がする。</p>

<h1>
<span id="現状の窓口" class="fragment"></span><a href="#%E7%8F%BE%E7%8A%B6%E3%81%AE%E7%AA%93%E5%8F%A3"><i class="fa fa-link"></i></a>現状の窓口</h1>

<p>多分この辺りが見られてる？</p>

<h2>
<span id="メールサイトに記載がある公式窓口" class="fragment"></span><a href="#%E3%83%A1%E3%83%BC%E3%83%AB%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AB%E8%A8%98%E8%BC%89%E3%81%8C%E3%81%82%E3%82%8B%E5%85%AC%E5%BC%8F%E7%AA%93%E5%8F%A3"><i class="fa fa-link"></i></a>メール（サイトに記載がある公式窓口）</h2>

<p>一応、ページ下部のサポートから辿るとメールで不具合要望を受け付けてるようです。</p>

<p>ですが要望に対する他の人の反応も聞いてみたいからみんなが見えるところに書きたいなって気持ちはあります。</p>

<h2>
<span id="twitterサイトに記載がないけど見てるっぽい" class="fragment"></span><a href="#twitter%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AB%E8%A8%98%E8%BC%89%E3%81%8C%E3%81%AA%E3%81%84%E3%81%91%E3%81%A9%E8%A6%8B%E3%81%A6%E3%82%8B%E3%81%A3%E3%81%BD%E3%81%84"><i class="fa fa-link"></i></a>Twitter（サイトに記載がないけど見てるっぽい）</h2>

<p>それとは別に、Twitterでも<a href="https://twitter.com/Qiita_jp" rel="nofollow noopener" target="_blank">@Qiita_jp</a>宛てメンションや<a href="https://twitter.com/search?q=%23Qiita&amp;src=typd" rel="nofollow noopener" target="_blank">#Qiita</a>のハッシュタグも見てるようで、ツイートしてくれれば要望受け付けますとも言ってるようだけど、でもそっちに関してはサイト上では特に案内されてないですし目にとまるかどうかは運の要素もありそう。</p>

<h2>
<span id="qiita投稿サイトに記載がないけど見てるっぽい" class="fragment"></span><a href="#qiita%E6%8A%95%E7%A8%BF%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AB%E8%A8%98%E8%BC%89%E3%81%8C%E3%81%AA%E3%81%84%E3%81%91%E3%81%A9%E8%A6%8B%E3%81%A6%E3%82%8B%E3%81%A3%E3%81%BD%E3%81%84"><i class="fa fa-link"></i></a>Qiita投稿（サイトに記載がないけど見てるっぽい）</h2>

<p>あと<code>Qiita</code>と<code>要望</code>のタグを付けた投稿を<a href="http://qiita.com/items/398ae4c93d402539d990">1週間くらい前にしてみた</a>ら、結構すぐに中の人にストックされたようで、この方法でも意見が届くようです。</p>

<p>反応無ければ一応サポート宛にメールも投げとこうとも思ったけど見られてるみたいだからメールはいっかな、と送っていない。</p>

<h1>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h1>

<p>色んな所で意見や要望を拾ってくれてるようなのでそれはそれで嬉しいんだけど、サイト上での公式のアナウンスは無いから、それらがホントに届くのかどうなのかはよく分からなくてモヤモヤする。みたいな(^^;</p>

<p>この辺見てますよっていうサイト上での公式アナウンスの問題、なのかな？</p>

<p>何気に、現状＋ご意見ありがとうございますっていう自動応答があるだけでも気が済んでしまいな自分もいるｗ</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />55位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/2cb739bff6e838265aed">Qiitaに要望：お知らせ機能を強化して欲しい</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-25 12:20:11</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Qiita]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>現状だと以下のケースでメールでお知らせしてくれるようです（他にもあるかもしれないけど自分が気づいた範囲ではこんだけ）。</p>

<ul>
<li>自分の投稿にコメントが付いた</li>
<li>自分の投稿に編集リクエストが来た</li>
<li>フォローされた</li>
<li>メンションが来た</li>
</ul>

<p>ですが、他のSNSを使ってるとQiitaにもこんな機能があると嬉しいのになぁと思うことが結構あるので要望まとめてみました。</p>

<h1>
<span id="要望" class="fragment"></span><a href="#%E8%A6%81%E6%9C%9B"><i class="fa fa-link"></i></a>要望</h1>

<h2>
<span id="お知らせの種類を増やしてほしい" class="fragment"></span><a href="#%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%82%92%E5%A2%97%E3%82%84%E3%81%97%E3%81%A6%E3%81%BB%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>お知らせの種類を増やしてほしい</h2>

<ul>
<li>他人の投稿にコメントした後、その投稿に新たなコメントが付いた</li>
<li>自分の投稿がストックされた</li>
<li>自分の投稿がLGTMされた</li>
</ul>

<p>これらは全部メールでくるとウザいことも多そうなので個別にON/OFF出来ると良さそう。<br>
で、メールは要らないけど知りたいなぁという人もまた多いと思うので↓次の要望です。</p>

<h2>
<span id="お知らせ一覧ページが欲しい" class="fragment"></span><a href="#%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B%E4%B8%80%E8%A6%A7%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%8C%E6%AC%B2%E3%81%97%E3%81%84"><i class="fa fa-link"></i></a>お知らせ一覧ページが欲しい</h2>

<p>現状だとお知らせはメールが飛んでくるのみだけど、メールって読みのがしたり、読んでもレスポンししようと思ったままお知らせがあった事自体を忘却したり、そもそもメール通知自体がウザいのでSPAM行きになってることも多いとおもいます。</p>

<p>そこでユーザが好きなタイミングで自分にどんなお知らせが来てるのかを確認出来るよう、お知らせ一覧ページがあると嬉しいです。</p>

<p>でも「(誰か)が自分の投稿Aにコメント/ストック/LGTMした」って情報は重複して表示されると邪魔なので折りたたんでくれたらなお良いですね。イメージは「Facebookのお知らせ一覧」や「Twitterの＠つながり」みたいな奴です。</p>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />56位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/ce80d9342e32bd1e3c15">as-create-or-update-auto-scaling-group.sh 作った</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-23 17:26:01</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[AWS]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>AWSのオートスケーリンググループを作る際に、新規はcreateすればいいけど更新はupdate使わなきゃいけない＆<strong>一部オプションはupdateで使えない</strong>という違いがあって不便なので、同じ引数でupdateもcreateも出来るコマンド作った。</p>

<h2>
<span id="仕様" class="fragment"></span><a href="#%E4%BB%95%E6%A7%98"><i class="fa fa-link"></i></a>仕様</h2>

<ul>
<li>同名のAutoScalingGroupNameが既に存在すればupdate、無ければcreateを実行する。</li>
<li>updateで使えない引数は勝手に除外してくれる。</li>
</ul>

<div class="code-frame" data-lang="shell">
<div class="code-lang"><span class="bold">as-create-or-update-auto-scaling-group.sh</span></div>
<div class="highlight"><pre><span></span>#!/bin/bash
#
# 同じ引数でcreateもupdateも出来る便利コマンド
#
update_opts=() create_opts=("$@") name="$1"
while [[ $# != 0 ]]; do
  if [[ $1 == --load-balancers || $1 == --tag ]]; then
    echo "Skip options for update: $1 $2"
    shift 2
  else
    update_opts+=("$1")
    shift
  fi
done
if as-describe-auto-scaling-groups "$name" | grep -q ^AUTO-SCALING-GROUP; then
  as-update-auto-scaling-group "${update_opts[@]}"
else
  as-create-auto-scaling-group "${create_opts[@]}"
fi
</pre></div>
</div>

<h2>
<span id="実行例" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C%E4%BE%8B"><i class="fa fa-link"></i></a>実行例</h2>

<h3>
<span id="今まで" class="fragment"></span><a href="#%E4%BB%8A%E3%81%BE%E3%81%A7"><i class="fa fa-link"></i></a>今まで</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># 新規作成
as-create-auto-scaling-group \
  my-asg \
  --launch-configuration my-lc \
  --min-size 1 \
  --max-size 5 \
  --load-balancers my-lb \
  --tag "k=Name, v=my-autolaunch" \
  --availability-zones ap-northeast-1a
OK-Created AutoScalingGroup

# ちょっと修正したいのでヒストリーやコピペをupdateに変えて実行
as-update-auto-scaling-group \
  my-asg \
  --launch-configuration my-lc \
  --min-size 1 \
  --max-size 9 \
  --load-balancers my-lb \
  --tag "k=Name, v=my-autolaunch" \
  --availability-zones ap-northeast-1a
as-update-auto-scaling-group:  Malformed input-Unrecognized option:  --load-balancers
Usage: …

# なんかエラーになった！使えないオプションを削って再実行
as-update-auto-scaling-group \
  my-asg \
  --launch-configuration my-lc \
  --min-size 1 \
  --max-size 9 \
  --availability-zones ap-northeast-1a
OK-Updated AutoScalingGroup

# ちょっとの手間だけど面倒だなぁ…
</pre></div></div>

<h3>
<span id="これから" class="fragment"></span><a href="#%E3%81%93%E3%82%8C%E3%81%8B%E3%82%89"><i class="fa fa-link"></i></a>これから</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># 新規作成
./as-create-or-update-auto-scaling-group.sh \
  my-asg \
  --launch-configuration my-lc \
  --min-size 1 \
  --max-size 5 \
  --load-balancers my-lb \
  --tag "k=Name, v=my-autolaunch" \
  --availability-zones ap-northeast-1a
OK-Created AutoScalingGroup

# ちょっと修正したいのでヒストリやコピペから値を変えて再実行
./as-create-or-update-auto-scaling-group.sh \
  my-asg \
  --launch-configuration my-lc \
  --min-size 1 \
  --max-size 9 \
  --load-balancers my-lb \
  --tag "k=Name, v=myserver-autolaunch" \
  --availability-zones ap-northeast-1a
Skip options for update: --load-balancers my-lb
Skip options for update: --tag k=Name, v=my-autolaunch
OK-Updated AutoScalingGroup

# 楽ちん！
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />57位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/3a2b3ba94da8fde33644">vagrant-1.2.1@Linuxでbox add出来ない問題の対処</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-04-19 03:07:37</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[vagrant]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>vagrantの1.1以降はgemではなくパッケージインストールの形になったようなのでとりあえず最新の1.2.1をインストールしてみた。</p>

<h2>
<span id="vagrant-box-add-がエラーになる" class="fragment"></span><a href="#vagrant-box-add-%E3%81%8C%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AB%E3%81%AA%E3%82%8B"><i class="fa fa-link"></i></a>vagrant box add がエラーになる</h2>

<p>早速適当なboxを動かsしてみようと思ったんだが、何故かbox addしようとすると↓のようなエラーが出てbox addが出来ない…。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># vagrant box add ce6 http://developer.nrel.gov/downloads/vagrant-boxes/CentOS-6.4-x86_64-v20130309.box
Downloading or copying the box...
An error occurred while downloading the remote file. The error
message, if any, is reproduced below. Please fix this error and try
again.

Failed initialization
</pre></div></div>

<p>ちなみにMacのvagrant-1.2.1は問題なく動いたのになぁ…。</p>

<h2>
<span id="適当パッチ" class="fragment"></span><a href="#%E9%81%A9%E5%BD%93%E3%83%91%E3%83%83%E3%83%81"><i class="fa fa-link"></i></a>適当パッチ</h2>

<p>で色々追ってみたらどうやら curl の起動に失敗しているようだ。PATHがどこでどうなって駄目な感じになったのかは追ってないが、とりあえず以下のように修正したら直った。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span># diff -r /opt/vagrant/embedded/gems/gems/vagrant-1.2.1/lib/vagrant/util/downloader.rb.orig  /opt/vagrant/embedded/gems/gems/vagrant-1.2.1/lib/vagrant/util/downloader.rb
122c122
&lt;           Subprocess.execute("curl", *options, &amp;data_proc)
---
&gt;           Subprocess.execute("/usr/bin/curl", *options, &amp;data_proc)
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />58位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>2</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/0cd28a955205c79ec7e3">tmuxで既存セッションがあればnew-sessionせずにアタッチする</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-03-28 12:52:18</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[tmux]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>tmux関連ネタとしてよくみる奴だけど、発動条件に自分なりのこだわり条件をつけたものを使ってます。</p>

<h2>
<span id="やりたいこと" class="fragment"></span><a href="#%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8"><i class="fa fa-link"></i></a>やりたいこと</h2>

<ul>
<li>tmuxに引数がついている場合は何か別のことをしたいはずなのでそのまま通す</li>
<li>tmuxに引数が無くかつ既存セッションが存在する場合のみattach-sessionに差し替える</li>
<li>不要な定義でメモリを消費したくない

<ul>
<li>環境変数<code>TMUX</code>をチェックしてtmux外にいる場合のみ適用</li>
<li>環境変数<code>PS1</code>をチェックしてインタラクティブシェルのときだけ適用</li>
</ul>
</li>
</ul>

<h2>
<span id="bashrcの記述" class="fragment"></span><a href="#bashrc%E3%81%AE%E8%A8%98%E8%BF%B0"><i class="fa fa-link"></i></a>bashrcの記述</h2>

<div class="code-frame" data-lang="bash"><div class="highlight"><pre><span></span><span class="c1">#tmuxで既存セッションがあればnew-sessionせずにアタッチする</span>
<span class="k">if</span> <span class="o">[[</span> -z <span class="nv">$TMUX</span> <span class="o">&amp;&amp;</span> -n <span class="nv">$PS1</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="k">function</span> tmux<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$#</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> tmux has-session <span class="m">2</span>&gt;/dev/null<span class="p">;</span> <span class="k">then</span>
      <span class="nb">command</span> tmux attach-session
    <span class="k">else</span>
      <span class="nb">command</span> tmux <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
    <span class="k">fi</span>
  <span class="o">}</span>
<span class="k">fi</span>
</pre></div></div>
</div>
	</td>
</tr>
</table>
<br />
<table border="1">
<tr>
	<td rowspan="3"><center>kawazさんの<br />59位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>1</kbd>
		<a target="_blank" href="https://qiita.com/kawaz/items/f776c0160c37a87200bb">直接アクセスを拒否するけどSSIのincludeアクセスは許可したい時の.htaccess設定</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-05-30 15:17:20</center>
	</td>
	<td style="width:200px;">
		@kawaz<br />(株式会社ずんシステム 所属)<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/18726/profile-images/1473682513">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[Linux]</b> <b>[httpd]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;"><p>SSIで読み込むファイルが入ったディレクトリへの直接アクセスを禁止したいと思った時にハマって、そして解決したのでメモ。</p>

<h1>
<span id="設定例" class="fragment"></span><a href="#%E8%A8%AD%E5%AE%9A%E4%BE%8B"><i class="fa fa-link"></i></a>設定例</h1>

<p>/_ssi/ というディレクトリにSSI用のファイルがあって、ここへの直接アクセスを禁止したい。</p>

<h2>
<span id="失敗例" class="fragment"></span><a href="#%E5%A4%B1%E6%95%97%E4%BE%8B"><i class="fa fa-link"></i></a>失敗例</h2>

<p><code>.htaccess</code>に以下のように単純に書くと失敗します。</p>

<div class="code-frame" data-lang="apache"><div class="highlight"><pre><span></span><span class="nb">RewriteEngine</span> <span class="k">on</span>
<span class="nb">RewriteRule</span> ^/?_ssi/ - [F]
</pre></div></div>

<p>確認のために <a href="http://example.com/_ssi/" class="autolink" rel="nofollow noopener" target="_blank">http://example.com/_ssi/</a> へ直接アクセスしてみると全て 403 Forbidden になって出来たー。と思うのもつかの間、実はこれだと<strong>SSIのinclude読み込みまでも拒否してしまう</strong>ので全然駄目です…orz</p>

<h2>
<span id="成功例" class="fragment"></span><a href="#%E6%88%90%E5%8A%9F%E4%BE%8B"><i class="fa fa-link"></i></a>成功例</h2>

<p>SSIでの読み込みか直接アクセスなのかを区別したいときには<code>%{IS_SUBREQ}</code>というのが使えます。これはそのリクエストが通常のリクエストなのかhttpd内部でのサブリクエストかどうかを判定する為の<a href="http://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewritecond" rel="nofollow noopener" target="_blank">RewriteCondで使える特殊変数</a>で、trueかfalseが入っています。</p>

<div class="code-frame" data-lang="apache"><div class="highlight"><pre><span></span><span class="nb">RewriteEngine</span> <span class="k">on</span>
<span class="nb">RewriteCond</span> %{IS_SUBREQ} =false
<span class="nb">RewriteRule</span> ^/?_ssi/ - [F]
</pre></div></div>

<p>なので、こんな感じの設定をしてやれば「SSIでは読み込めるけど直接アクセスは禁止」が実現できるってわけですす。</p>

<h1>
<span id="参考" class="fragment"></span><a href="#%E5%8F%82%E8%80%83"><i class="fa fa-link"></i></a>参考</h1>

<p><a href="http://httpd.apache.org/docs/current/mod/mod_rewrite.html#rewritecond" rel="nofollow noopener" target="_blank">mod_rewrite - Apache HTTP Server</a></p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
