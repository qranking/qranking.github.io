<html>
	<head><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110075493-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-110075493-1');
</script>
<!-- Google AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6168511236629369",
    enable_page_level_ads: true
  });
</script>

		<meta charset="UTF-8" />
		<title>Qiita Ranking (ukitaka)</title>
		<link rel="stylesheet" type="text/css" href="../qranking.css">
	</head>
	<body>
<div class="headerContainer">
<h1>Qiitaいいね数ランキング (ukitaka さんの投稿分)</h1>
</div><!--class="headerContainer"-->
<p><a href="#" onclick="javascript:window.history.back(-1);return false;">[戻る]</a></p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>が同じ値の場合は投稿日時の新しいものが上位としています。</p>
<p><i><img width="16" height="16" src="../thumb-up-120px.png" /></i>がついていない記事は表示していません。</p>
<table border="1">
<tr>
	<td rowspan="3"><center>ukitakaさんの<br />1位</center></td>
	<td colspan="3">
		<kbd><i><img alt="いいね" width="16" height="16" src="../thumb-up-120px.png" /></i>864</kbd>
		<a target="_blank" href="https://qiita.com/ukitaka/items/64e4589e37944bf032d9">Googleから学ぶ ヌルヌルサクサクなスライドメニュー</a>
	</td>
</tr>
<tr>
	<td style="width:100px;"><center>投稿日時</center></td>
	<td style="width:200px;"><center>投稿者</center></td>
	<td style="width:150px;"><center>タグ</center></td>
	<td style="width:350px;"><center>本文</center></td>
</tr>
<tr>
	<td style="width:100px;">
		<!--投稿日時--><center>2013-06-08 02:10:03</center>
	</td>
	<td style="width:200px;">
		@ukitaka<br><img width="80" height="80" src="https://qiita-image-store.s3.amazonaws.com/0/14846/profile-images/1474100048">
	</td>
	<td style="width:150px;">
		<!--タグ-->
		<center><b>[CSS]</b> <b>[JavaScript]</b> </center>
	</td>
	<td style="width:350px;">
		<!--本文-->
		<div style="width:350px;height:150px;overflow-x:hidden;overflow-y:scroll;">
<h2>
<span id="スマフォwebページのスライドメニュー" class="fragment"></span><a href="#%E3%82%B9%E3%83%9E%E3%83%95%E3%82%A9web%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC"><i class="fa fa-link"></i></a>スマフォwebページのスライドメニュー</h2>

<p>アプリでは当たり前のように実装されているスライドメニューですが、webページではなかなか使い心地のよいスライドメニューが実装されているのは見かけません。<br>
スマートフォンのブラウザではjavascriptでのアニメーションはどうしてもガタガタになってしまうし、ちらつきやスクロール制御のめんどくささからもうwebページでネイティブアプリ並のスライドメニューを実装するなんて無理と思っていました。<br>
Facebookのwebページですらボタンの反応は悪いしアニメーションも動かないし最悪です。</p>

<h2>
<span id="一方google先生はパーフェクトなスライドメニューを実装していた" class="fragment"></span><a href="#%E4%B8%80%E6%96%B9google%E5%85%88%E7%94%9F%E3%81%AF%E3%83%91%E3%83%BC%E3%83%95%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AA%E3%82%B9%E3%83%A9%E3%82%A4%E3%83%89%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F"><i class="fa fa-link"></i></a>一方Google先生はパーフェクトなスライドメニューを実装していた</h2>

<p><a href="https://camo.qiitausercontent.com/b1853a3ff142315fbbd1d4c326eb53191a252ddf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31343834362f33313230363662322d663565632d396436612d373333332d3134376263623835396232342e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/b1853a3ff142315fbbd1d4c326eb53191a252ddf/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f31343834362f33313230363662322d663565632d396436612d373333332d3134376263623835396232342e706e67" alt="写真 2013-06-07 22 17 19.png" title="Googleのスマフォwebページ" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/14846/312066b2-f5ec-9d6a-7333-147bcb859b24.png"></a></p>

<p><strong>さすがGoogle先生！ 俺達に出来ないことを(</strong></p>

<p>Googleのスライドメニューは以下の点でパーフェクトです。<br>
1. スライドのアニメーションがとても滑らか・ちらつかない<br>
2.  ボタンの反応にストレスを感じない<br>
3.  メインコンテンツ部分のどこをさわってもメニューが閉じる<br>
4.  横スクロール対策がしっかりされている<br>
5. メニューだけスクロールできる</p>

<p><strong>今回はこれらがどのように実装されているのか調査しながら、jQueryのプラグインとしてスライドメニューを実装しました。</strong><br>
<strong>具体的なソースはあまり載せていないので、この記事の最後に貼ってあるサンプルページとgithubを見てみてください。</strong></p>

<h2>
<span id="アニメーションについて" class="fragment"></span><a href="#%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>アニメーションについて</h2>

<p>GoogleといえばFlash使わずjavascriptでなんでもやっちゃうイメージが強かったので、当然<strong>スライドのアニメーションもjavascriptを使っている</strong>と思ってソースを眺めていると、CSSにこんな記述がありました。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>    -webkit-transform: translateX(0);
    -webkit-transition: .2s -webkit-transform ease-in-out;
</pre></div></div>

<p>CSS3のアニメーション...だと...！<br>
<a href="http://www.htmq.com/css3/transform.shtml" rel="nofollow noopener" target="_blank">参考 CSS3 - transform</a></p>

<p><strong>スマートフォンではjavascriptではクラスの切り替えのみを行い、アニメーションはCSSに任せるのが定石</strong>のようですねー。<br>
また、Googleは<code>translateX</code>を使っていますが、よくある実装としては<code>translate3d</code>を使い<strong>GPUアクセラレーター</strong>を有効にすることでにぬるぬる描画を実現していることが多いです。</p>

<p>あとソースを読んでいて気づいた細かいテクニックとしては</p>

<h4>
<span id="実際に動かすのはコンテンツ部分" class="fragment"></span><a href="#%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%8B%95%E3%81%8B%E3%81%99%E3%81%AE%E3%81%AF%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E9%83%A8%E5%88%86"><i class="fa fa-link"></i></a>実際に動かすのはコンテンツ部分</h4>

<p>　　メニューはz-indexに負の値をもって奥に隠れているだけです。<br>
　　横スクロール対策にもなっている</p>

<h4>
<span id="目立たない要素はアニメーション時はhiddenにする" class="fragment"></span><a href="#%E7%9B%AE%E7%AB%8B%E3%81%9F%E3%81%AA%E3%81%84%E8%A6%81%E7%B4%A0%E3%81%AF%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E6%99%82%E3%81%AFhidden%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>目立たない要素はアニメーション時はhiddenにする</h4>

<p>　　アニメーションを軽くするための努力</p>

<h4>
<span id="はじっこのちらつきは背景色でカバーする" class="fragment"></span><a href="#%E3%81%AF%E3%81%98%E3%81%A3%E3%81%93%E3%81%AE%E3%81%A1%E3%82%89%E3%81%A4%E3%81%8D%E3%81%AF%E8%83%8C%E6%99%AF%E8%89%B2%E3%81%A7%E3%82%AB%E3%83%90%E3%83%BC%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a>はじっこのちらつきは背景色でカバーする</h4>

<p>　　実装してみてわかってのですが、メニュークローズ時にbodyの色がちらつきます。<br>
　　Googleではメニューとちらつく部分の背景色を同じにすることで対策しているようです。</p>

<h2>
<span id="イベントについて" class="fragment"></span><a href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>イベントについて</h2>

<p>Facebookのスライドメニューの反応が悪いように感じるのは、おそらく<code>onclick</code>でアニメーションを発火しているからです。<br>
スマートフォンでは<code>onclick</code>の発生が遅いので、スマフォ特有の<code>ontouchstart</code>や<code>ontouchend</code>を使うことでストレスなく操作できます。</p>

<p><strong>メニューオープンはメニューボタンのontouchend、クローズはコンテンツ部分のontouchstart</strong>にするのがよさそうです。</p>

<h2>
<span id="メニューのスクロールについて" class="fragment"></span><a href="#%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%81%AE%E3%82%B9%E3%82%AF%E3%83%AD%E3%83%BC%E3%83%AB%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>メニューのスクロールについて</h2>

<p>今回実装する上で一番苦労したがこれでした。<br>
実際にさわってみるとわかりますがGoogleのスライドメニューはネイティブアプリと同じようにメニュー部分だけがスクロールでき、項目が多い場合でも対応できます。</p>

<p>なぜ苦労したか、<strong>結論から言うとスクロールの処理を自前で書いていたからです。</strong></p>

<p>まず考えたのはメニュー部分を<code>overflow: scroll</code>などでスクロール可能にし、<code>event.preventDefault()</code>でページ全体にイベント伝播しないようにする方法でしたが、結局うまくいかず。<br>
困って再度Googleのソースを見てみるとメニューを囲っているdivに怪しい記述が...</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre><span></span>style="-webkit-transform:translate3d(0px, 0px, 0px)"
</pre></div></div>

<p>さきほども登場した<code>translate3d</code>ですね！<br>
Googleのjsは当然 圧縮難読化されているので実際に確認してはいないのですが、どうやら<strong>メニュー部分の<code>ontouchmove</code>を拾って、styleにy軸方向の値を設定した<code>translate3d</code>を連続的に書き込むこと</strong>でスライドを実装しているようです。<br>
実際この実装方法でうまくいきました。</p>

<h2>
<span id="今回作成したプログラムのソース--サンプルページ" class="fragment"></span><a href="#%E4%BB%8A%E5%9B%9E%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9--%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%9A%E3%83%BC%E3%82%B8"><i class="fa fa-link"></i></a>今回作成したプログラムのソース &amp; サンプルページ</h2>

<p>今回作ったものを載せておきます<br>
<a href="http://encircle.jp/sp/" rel="nofollow noopener" target="_blank">サンプルページ</a><br>
※iPhone5でのみ動作確認してあります<br>
※PCでは動きません(ontouch系が使えないので)</p>

<p>githubにもおいてあります<br>
<a href="https://github.com/ukitaka/jSlideMenu" rel="nofollow noopener" target="_blank">github - jSlideMenu</a></p>

<h2>
<span id="まとめ" class="fragment"></span><a href="#%E3%81%BE%E3%81%A8%E3%82%81"><i class="fa fa-link"></i></a>まとめ</h2>

<h4>
<span id="javascriptでなくcss3のアニメーションを使おう" class="fragment"></span><a href="#javascript%E3%81%A7%E3%81%AA%E3%81%8Fcss3%E3%81%AE%E3%82%A2%E3%83%8B%E3%83%A1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86"><i class="fa fa-link"></i></a>・javascriptでなくCSS3のアニメーションを使おう</h4>

<h4>
<span id="ちらつくならtranslate3dを使おう" class="fragment"></span><a href="#%E3%81%A1%E3%82%89%E3%81%A4%E3%81%8F%E3%81%AA%E3%82%89translate3d%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86"><i class="fa fa-link"></i></a>・ちらつくならtranslate3dを使おう</h4>

<h4>
<span id="ontouch系を使おう" class="fragment"></span><a href="#ontouch%E7%B3%BB%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86"><i class="fa fa-link"></i></a>・ontouch系を使おう</h4>

<h2>
<span id="最後に" class="fragment"></span><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB"><i class="fa fa-link"></i></a>最後に</h2>

<h4>
<span id="css3すげぇ" class="fragment"></span><a href="#css3%E3%81%99%E3%81%92%E3%81%87"><i class="fa fa-link"></i></a>CSS3すげぇ</h4>

<p>　角丸くできるだけかと思ってました。ごめんなさい。</p>

<h4>
<span id="googleすげぇ" class="fragment"></span><a href="#google%E3%81%99%E3%81%92%E3%81%87"><i class="fa fa-link"></i></a>Googleすげぇ</h4>

<p>　とても参考になりました。</p>
</div>
	</td>
</tr>
</table>
<br />
	</body>
</html>
